"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[239],{34239:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var s=n(97598),a=n.n(s),r=n(86326),i=n(99993),l=n(53562),o=n(59141),c=n(7800),u=n(16588);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},d.apply(this,arguments)}const{formatDate:p}=l.utils;function m(e){const{children:t,dataSource:n,displaySets:s,viewportIndex:a,viewportLabel:m,viewportOptions:S,servicesManager:I,extensionManager:g}=e,{displaySetService:y,cornerstoneViewportService:f,measurementService:h}=I.services;if(s.length>1)throw new Error("SR viewport should only have a single display set");const v=s[0],[D,b]=(0,c.ih)(),[w,x]=(0,r.useState)(0),[E,k]=(0,r.useState)(1),[M,U]=(0,r.useState)(null),[P,N]=(0,r.useState)(null),[T,C]=(0,r.useState)(null),{viewports:O,activeViewportIndex:R}=D;let A,L;if(g.registeredExtensionIds.includes("@ohif/extension-measurement-tracking")){const e=g.getModuleEntry("@ohif/extension-measurement-tracking.contextModule.TrackedMeasurementsContext"),t=(0,r.useContext)(e.context);A=t?.[0],L=t?.[1]}L||(A=null,L=(e,{displaySetInstanceUID:t})=>{h.clearMeasurements();const{SeriesInstanceUIDs:n}=(0,u.A)({servicesManager:I,extensionManager:g},t),s=y.getDisplaySetsForSeries(n[0]);s.length&&b.setDisplaySetsForViewports([{viewportIndex:R,displaySetInstanceUIDs:[s[0].displaySetInstanceUID]}])});const V=(0,r.useCallback)((e=>{const{measurements:t}=v;(0,o.m1)(T,t.map((e=>e.TrackingUniqueIdentifier)),e)}),[T,w,v]),j=e=>{C(e.detail.element)},F=(0,r.useCallback)((e=>{const{StudyInstanceUID:t,displaySetInstanceUID:n,sopClassUids:s}=v;t&&n&&(s&&s.length>1&&console.warn("More than one SOPClassUID in the same series is not yet supported."),async function(e,t,n){const{measurements:s}=e,a=s[t],{displaySetInstanceUID:r}=a,i=n.getDisplaySetByUID(r),l=i.images[0],o={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices};return{referencedDisplaySetMetadata:o,referencedDisplaySet:i}}(v,e,y).then((({referencedDisplaySet:t,referencedDisplaySetMetadata:n})=>{if(x(e),U(t),N(n),t.displaySetInstanceUID===M?.displaySetInstanceUID){const{measurements:t}=v,n=f.getViewportInfoByIndex(a),s=f.getCornerstoneViewport(n.getViewportId()),r=s.getImageIds().indexOf(t[e].imageId);-1!==r&&s.setImageIdIndex(r)}})))}),[n,v,M,a]),B=(0,r.useCallback)((()=>{if(!M)return null;const{component:t}=g.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{measurements:n}=v,s=n[w];if(!s)return null;const a=M.images.findIndex((e=>e.imageId===s.imageId));return r.createElement(t,d({},e,{displaySets:[M],viewportOptions:{...S,toolGroupId:"SRToolGroup",viewportType:"stack",positionIds:null},onElementEnabled:j,initialImageIndex:a}))}),[M,a,w]),q=(0,r.useCallback)((e=>{let t=w;"right"===e?(t++,t>=E&&(t=0)):(t--,t<0&&(t=E-1)),V(t),F(t)}),[w,E,F,V]);(0,r.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=O[R];e.includes(t.displaySetInstanceUID)&&b.setDisplaySetsForViewport({viewportIndex:R,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{v.isLoaded||v.load();const e=v.measurements.length;k(e)}),[v]),(0,r.useEffect)((()=>{T&&v.isLoaded&&V(w)}),[w,T,V,v]);let _=A?.context?.trackedSeries?.length>0;(0,r.useEffect)((()=>{_=A?.context?.trackedSeries?.length>0}),[A]),(0,r.useEffect)((()=>{F(w)}),[n,v]);let $=null;if(!M||!P)return null;t&&t.length&&($=t.map(((e,t)=>e&&r.cloneElement(e,{viewportIndex:a,key:t}))));const{PatientID:G,PatientName:H,PatientSex:Y,PatientAge:z,SliceThickness:J,ManufacturerModelName:K,StudyDate:Q,SeriesDescription:W,SpacingBetweenSlices:X,SeriesNumber:Z}=P;return r.createElement(r.Fragment,null,r.createElement(c.cS,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:q,getStatusComponent:()=>function({srDisplaySet:e,viewportIndex:t,isRehydratable:n,isLocked:s,sendTrackedMeasurementsEvent:a}){const l=()=>{a("HYDRATE_SR",{displaySetInstanceUID:e.displaySetInstanceUID,viewportIndex:t})},{t:o}=(0,i.Bd)("Common"),u=o("LOAD"),d=n&&!s?3:n&&s?2:1;let p=null,m=null;switch(d){case 1:m=()=>r.createElement(c.In,{name:"status-alert"}),p=()=>r.createElement("div",null,"This structured report is not compatible",r.createElement("br",null),"with this application.");break;case 2:m=()=>r.createElement(c.In,{name:"status-locked"}),p=()=>r.createElement("div",null,"This structured report is currently read-only",r.createElement("br",null),"because you are tracking measurements in",r.createElement("br",null),"another viewport.");break;case 3:m=()=>r.createElement(c.In,{name:"status-untracked"}),p=()=>r.createElement("div",null,`Click ${u} to restore measurements.`)}const S=()=>r.createElement("div",{className:"flex h-6 leading-6 cursor-default text-sm text-white"},r.createElement("div",{className:"min-w-[45px] flex items-center p-1 rounded-l-xl rounded-r bg-customgray-100"},r.createElement(m,null),r.createElement("span",{className:"ml-1"},"SR")),3===d&&r.createElement("div",{className:"ml-1 px-1.5 rounded cursor-pointer hover:text-black bg-primary-main hover:bg-primary-light",onMouseUp:l},u));return r.createElement(r.Fragment,null,p&&r.createElement(c.m_,{content:r.createElement(p,null),position:"bottom-left"},r.createElement(S,null)),!p&&r.createElement(S,null))}({srDisplaySet:v,viewportIndex:a,isTracked:!1,isRehydratable:v.isRehydratable,isLocked:_,sendTrackedMeasurementsEvent:L}),studyData:{label:m,useAltStyling:!0,studyDate:p(Q),currentSeries:Z,seriesDescription:W||"",patientInformation:{patientName:H?l.Ay.utils.formatPN(H.Alphabetic):"",patientSex:Y||"",patientAge:z||"",MRN:G||"",thickness:J?`${J.toFixed(2)}mm`:"",spacing:void 0!==X?`${X.toFixed(2)}mm`:"",scanner:K||""}}}),r.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},B(),$))}m.propTypes={displaySets:a().arrayOf(a().object),viewportIndex:a().number.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,customProps:a().object,viewportOptions:a().object,viewportLabel:a().string,servicesManager:a().instanceOf(l.CS).isRequired,extensionManager:a().instanceOf(l.nH).isRequired},m.defaultProps={customProps:{}};const S=m}}]);
//# sourceMappingURL=239.bundle.e510f21e789af76600cb.js.map