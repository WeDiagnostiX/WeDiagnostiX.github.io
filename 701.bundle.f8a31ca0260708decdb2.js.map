{"version":3,"file":"701.bundle.f8a31ca0260708decdb2.js","mappings":"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","sources":["webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/CustomizableViewportOverlay.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/utils.ts","webpack:///../../../extensions/cornerstone/src/contextProviders/ViewportActionCornersProvider.tsx","webpack:///../../../extensions/cornerstone/src/initWADOImageLoader.js","webpack:///../../../extensions/cornerstone/src/utils/callInputDialog.tsx","webpack:///../../../extensions/cornerstone/src/utils/getActiveViewportEnabledElement.ts","webpack:///../../../extensions/cornerstone/src/tools/CalibrationLineTool.ts","webpack:///../../../extensions/cornerstone/src/tools/OverlayPlaneModuleProvider.ts","webpack:///../../../extensions/cornerstone/src/tools/ImageOverlayViewerTool.tsx","webpack:///../../../extensions/cornerstone/src/initCornerstoneTools.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/constants/supportedTools.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/Length.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/getHandlesFromPoints.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/selection.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/getDisplayUnit.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/Bidirectional.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/getValueDisplayString.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/EllipticalROI.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/CircleROI.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/ArrowAnnotate.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/CobbAngle.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/Angle.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/PlanarFreehandROI.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/RectangleROI.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/SplineROI.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/LivewireContour.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/Probe.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/UltrasoundDirectional.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/measurementServiceMappingsFactory.ts","webpack:///../../../extensions/cornerstone/src/initMeasurementService.ts","webpack:///../../../extensions/cornerstone/src/initCineService.ts","webpack:///../../../extensions/cornerstone/src/initStudyPrefetcherService.ts","webpack:///../../../extensions/cornerstone/src/utils/interleaveCenterLoader.ts","webpack:///../../../extensions/cornerstone/src/utils/getInterleavedFrames.js","webpack:///../../../extensions/cornerstone/src/utils/nthLoader.ts","webpack:///../../../extensions/cornerstone/src/utils/interleave.js","webpack:///../../../extensions/cornerstone/src/utils/getNthFrames.js","webpack:///../../../extensions/cornerstone/src/utils/interleaveTopToBottom.ts","webpack:///../../../extensions/cornerstone/src/utils/findNearbyToolData.ts","webpack:///../../../extensions/cornerstone/src/initContextMenu.ts","webpack:///../../../extensions/cornerstone/src/initDoubleClick.ts","webpack:///../../../extensions/cornerstone/src/utils/initViewTiming.ts","webpack:///../../../extensions/cornerstone/src/utils/colormaps.js","webpack:///../../../extensions/cornerstone/src/init.tsx","webpack:///../../../extensions/cornerstone/src/utils/DicomFileUploader.ts","webpack:///../../../extensions/cornerstone/src/components/DicomUpload/DicomUploadProgressItem.tsx","webpack:///../../../extensions/cornerstone/src/components/DicomUpload/DicomUploadProgress.tsx","webpack:///../../../extensions/cornerstone/src/components/DicomUpload/DicomUpload.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/defaultWindowLevelPresets.ts","webpack:///../../../extensions/cornerstone/src/getCustomizationModule.ts","webpack:///../../../extensions/cornerstone/src/utils/CornerstoneViewportDownloadForm.tsx","webpack:///../../../extensions/cornerstone/src/utils/imageSliceSync/toggleImageSliceSync.ts","webpack:///../../../extensions/cornerstone/src/utils/toggleVOISliceSync.ts","webpack:///../../../extensions/cornerstone/src/commandsModule.ts","webpack:///../../../extensions/cornerstone/src/hps/fourUp.ts","webpack:///../../../extensions/cornerstone/src/hps/main3D.ts","webpack:///../../../extensions/cornerstone/src/hps/mpr.ts","webpack:///../../../extensions/cornerstone/src/hps/mprAnd3DVolumeViewport.ts","webpack:///../../../extensions/cornerstone/src/hps/only3D.ts","webpack:///../../../extensions/cornerstone/src/hps/panoramicViewport.ts","webpack:///../../../extensions/cornerstone/src/hps/primary3D.ts","webpack:///../../../extensions/cornerstone/src/hps/primaryAxial.ts","webpack:///../../../extensions/cornerstone/src/getHangingProtocolModule.ts","webpack:///../../../extensions/cornerstone/src/getToolbarModule.tsx","webpack:///../../../extensions/cornerstone/src/services/ToolGroupService/ToolGroupService.ts","webpack:///../../../extensions/cornerstone/src/services/ToolGroupService/index.js","webpack:///../../../extensions/cornerstone/src/services/SyncGroupService/SyncGroupService.ts","webpack:///../../../extensions/cornerstone/src/services/SyncGroupService/index.js","webpack:///../../../extensions/cornerstone/src/utils/transitions.ts","webpack:///../../../extensions/cornerstone/src/services/SegmentationService/SegmentationService.ts","webpack:///../../../extensions/cornerstone/src/services/SegmentationService/RTSTRUCT/mapROIContoursToRTStructData.ts","webpack:///../../../extensions/cornerstone/src/services/SegmentationService/index.js","webpack:///../../../extensions/cornerstone/src/utils/getCornerstoneViewportType.ts","webpack:///../../../extensions/cornerstone/src/services/CornerstoneCacheService/CornerstoneCacheService.ts","webpack:///../../../extensions/cornerstone/src/services/CornerstoneCacheService/index.js","webpack:///../../../extensions/cornerstone/src/services/ViewportService/constants.ts","webpack:///../../../extensions/cornerstone/src/services/ViewportService/Viewport.ts","webpack:///../../../extensions/cornerstone/src/utils/getCornerstoneOrientation.ts","webpack:///../../../extensions/cornerstone/src/utils/getCornerstoneBlendMode.ts","webpack:///../../../extensions/cornerstone/src/utils/JumpPresets.ts","webpack:///../../../extensions/cornerstone/src/services/ViewportService/CornerstoneViewportService.ts","webpack:///../../../extensions/cornerstone/src/types/Colorbar.ts","webpack:///../../../extensions/cornerstone/src/services/ColorbarService/ColorbarService.ts","webpack:///../../../extensions/cornerstone/src/services/ColorbarService/index.ts","webpack:///../../../extensions/default/src/Panels/PanoramicUtils/pngUtils.js","webpack:///../../../extensions/default/src/Panels/PanoramicUtils/computeDentalCurveUtils.js","webpack:///../../../extensions/default/src/Panels/PanoramicUtils/computeDentascansUtils.ts","webpack:///../../../extensions/default/src/Panels/PanoramicUtils/generatePanoramic.ts","webpack:///../../../extensions/default/src/Panels/PanoramicUtils/computePanoramicUtils.js","webpack:///../../../extensions/cornerstone/src/services/PanoramicService/PanoramicService.ts","webpack:///../../../extensions/cornerstone/src/services/PanoramicService/index.ts","webpack:///../../../extensions/cornerstone/src/utils/dicomLoaderService.js","webpack:///../../../extensions/cornerstone/src/id.js","webpack:///../../../extensions/cornerstone/src/components/ViewportWindowLevel/getViewportVolumeHistogram.ts","webpack:///../../../extensions/cornerstone/src/components/ViewportWindowLevel/ViewportWindowLevel.tsx","webpack:///../../../extensions/cornerstone/src/components/ActiveViewportWindowLevel/ActiveViewportWindowLevel.tsx","webpack:///../../../extensions/cornerstone/src/synchronizers/frameViewSynchronizer.ts","webpack:///../../../extensions/cornerstone/src/index.tsx","webpack:///../../../extensions/cornerstone/src/services/ViewportActionCornersService/ViewportActionCornersService.ts","webpack:///../../../extensions/cornerstone/src/state.ts","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/getSOPInstanceAttributes.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { vec3 } from 'gl-matrix';\r\nimport PropTypes from 'prop-types';\r\nimport { metaData, Enums, utilities } from '@cornerstonejs/core';\r\nimport { ImageSliceData } from '@cornerstonejs/core/dist/esm/types';\r\nimport { ViewportOverlay } from '@ohif/ui';\r\nimport { InstanceMetadata } from '@ohif/core/src/types';\r\nimport { formatPN, formatDICOMDate, formatDICOMTime, formatNumberPrecision } from './utils';\r\nimport { StackViewportData, VolumeViewportData } from '../../types/CornerstoneCacheService';\r\n\r\nimport './CustomizableViewportOverlay.css';\r\n\r\nconst EPSILON = 1e-4;\r\n\r\ntype ViewportData = StackViewportData | VolumeViewportData;\r\n\r\ninterface OverlayItemProps {\r\n  element: HTMLElement;\r\n  viewportData: ViewportData;\r\n  imageSliceData: ImageSliceData;\r\n  servicesManager: AppTypes.ServicesManager;\r\n  viewportId: string;\r\n  instance: InstanceMetadata;\r\n  customization: any;\r\n  formatters: {\r\n    formatPN: (val) => string;\r\n    formatDate: (val) => string;\r\n    formatTime: (val) => string;\r\n    formatNumberPrecision: (val, number) => string;\r\n  };\r\n\r\n  // calculated values\r\n  voi: {\r\n    windowWidth: number;\r\n    windowCenter: number;\r\n  };\r\n  instanceNumber?: number;\r\n  scale?: number;\r\n}\r\n\r\nconst OverlayItemComponents = {\r\n  'ohif.overlayItem': OverlayItem,\r\n  'ohif.overlayItem.windowLevel': VOIOverlayItem,\r\n  'ohif.overlayItem.zoomLevel': ZoomOverlayItem,\r\n  'ohif.overlayItem.instanceNumber': InstanceNumberOverlayItem,\r\n};\r\n\r\n\r\nconst studyDateItem = {\r\n  id: 'StudyDate',\r\n  customizationType: 'ohif.overlayItem',\r\n  label: '',\r\n  title: 'Study date',\r\n  condition: ({ referenceInstance }) => referenceInstance?.StudyDate,\r\n  contentF: ({ referenceInstance, formatters: { formatDate } }) => formatDate(referenceInstance.StudyDate),\r\n};\r\n\r\nconst seriesDescriptionItem = {\r\n  id: 'SeriesDescription',\r\n  customizationType: 'ohif.overlayItem',\r\n  label: '',\r\n  title: 'Series description',\r\n  condition: ({ referenceInstance }) => {\r\n    return referenceInstance && referenceInstance.SeriesDescription;\r\n  },\r\n  contentF: ({ referenceInstance }) => referenceInstance.SeriesDescription\r\n};\r\n\r\nconst patientNameItem = {\r\n  id: 'PatientNameOverlay',\r\n  // Note below that here we are using the customization prototype of\r\n  // `ohif.overlayItem` which was registered to the customization module in\r\n  // `ohif/extension-default` extension.\r\n  customizationType: 'ohif.overlayItem',\r\n  // the following props are passed to the `ohif.overlayItem` prototype\r\n  // which is used to render the overlay item based on the label, color,\r\n  // conditions, etc.\r\n  attribute: 'PatientName',\r\n  label: 'PN:',\r\n  title: 'Patient Name',\r\n  color: 'yellow',\r\n  condition: ({ instance }) => instance?.PatientName,\r\n  contentF: ({ instance, formatters: { formatPN } }) =>\r\n  formatPN(instance.PatientName) + (instance.PatientSex ? ' (' + instance.PatientSex + ')' : ''),\r\n}\r\n\r\nconst topLeftItems = { id: 'cornerstoneOverlayTopLeft', items: [studyDateItem, seriesDescriptionItem] };\r\n\r\nconst topRightItems = { id: 'cornerstoneOverlayTopRight', items: [patientNameItem] };\r\n\r\nconst bottomLeftItems = {\r\n  id: 'cornerstoneOverlayBottomLeft', items: [\r\n    {\r\n      id: 'WindowLevel',\r\n      customizationType: 'ohif.overlayItem.windowLevel',\r\n    },\r\n    {\r\n      id: 'ZoomLevel',\r\n      customizationType: 'ohif.overlayItem.zoomLevel',\r\n      condition: (props) => {\r\n        const activeToolName = props.toolGroupService.getActiveToolForViewport(props.viewportId);\r\n        return activeToolName === 'Zoom';\r\n      },\r\n    },\r\n  ]\r\n};\r\n\r\nconst bottomRightItems = {\r\n  id: 'cornerstoneOverlayBottomRight',\r\n  items: [\r\n    {\r\n      id: 'InstanceNumber',\r\n      customizationType: 'ohif.overlayItem.instanceNumber',\r\n    },\r\n  ]\r\n};\r\n\r\n/**\r\n * The @ohif/cornerstoneOverlay is a default value for a customization\r\n * for the cornerstone overlays.  The intent is to allow it to be extended\r\n * without needing to re-write the individual overlays by using the append\r\n * mechanism.  Individual attributes can be modified individually without\r\n * affecting the other items by using the append as well, with position\r\n * based replacement.\r\n * This is used as a default in the getCustomizationModule so that it\r\n * is available early for additional customization extensions.\r\n */\r\nconst CornerstoneOverlay = {\r\n  id: '@ohif/cornerstoneOverlay',\r\n  topLeftItems,\r\n  topRightItems,\r\n  bottomLeftItems,\r\n  bottomRightItems,\r\n};\r\n\r\n/**\r\n * Customizable Viewport Overlay\r\n */\r\nfunction CustomizableViewportOverlay({\r\n  element,\r\n  viewportData,\r\n  imageSliceData,\r\n  viewportId,\r\n  servicesManager,\r\n}: {\r\n  element: HTMLElement;\r\n  viewportData: ViewportData;\r\n  imageSliceData: ImageSliceData;\r\n  viewportId: string;\r\n  servicesManager: AppTypes.ServicesManager;\r\n}) {\r\n  const { cornerstoneViewportService, customizationService, toolGroupService, displaySetService } =\r\n    servicesManager.services;\r\n  const [voi, setVOI] = useState({ windowCenter: null, windowWidth: null });\r\n  const [scale, setScale] = useState(1);\r\n  const { imageIndex } = imageSliceData;\r\n\r\n  // The new customization is 'cornerstoneOverlay', with an append or replace\r\n  // on the individual items rather than defining individual items.\r\n  const cornerstoneOverlay = customizationService.getCustomization('@ohif/cornerstoneOverlay');\r\n\r\n  // Historical usage defined the overlays as separate items due to lack of\r\n  // append functionality.  This code enables the historical usage, but\r\n  // the recommended functionality is to append to the default values in\r\n  // cornerstoneOverlay rather than defining individual items.\r\n  const topLeftCustomization = customizationService.getCustomization(\r\n    'cornerstoneOverlayTopLeft'\r\n  ) || cornerstoneOverlay?.topLeftItems;\r\n  const topRightCustomization = customizationService.getCustomization(\r\n    'cornerstoneOverlayTopRight'\r\n  ) || cornerstoneOverlay?.topRightItems;\r\n  const bottomLeftCustomization = customizationService.getCustomization(\r\n    'cornerstoneOverlayBottomLeft'\r\n  ) || cornerstoneOverlay?.bottomLeftItems;\r\n  const bottomRightCustomization = customizationService.getCustomization(\r\n    'cornerstoneOverlayBottomRight'\r\n  ) || cornerstoneOverlay?.bottomRightItems;\r\n\r\n\r\n  const instanceNumber = useMemo(\r\n    () =>\r\n      viewportData\r\n        ? getInstanceNumber(viewportData, viewportId, imageIndex, cornerstoneViewportService)\r\n        : null,\r\n    [viewportData, viewportId, imageIndex, cornerstoneViewportService]\r\n  );\r\n\r\n  const displaySetProps = useMemo(() => {\r\n    const displaySets = getDisplaySets(viewportData, displaySetService);\r\n    if (!displaySets) {\r\n      return null;\r\n    }\r\n    const [displaySet] = displaySets;\r\n    const { instances, instance: referenceInstance } = displaySet;\r\n    return {\r\n      displaySets,\r\n      displaySet,\r\n      instance: instances[imageIndex],\r\n      instances,\r\n      referenceInstance,\r\n    };\r\n  }, [viewportData, viewportId, instanceNumber, cornerstoneViewportService]);\r\n\r\n\r\n  /**\r\n   * Updating the VOI when the viewport changes its voi\r\n   */\r\n  useEffect(() => {\r\n    const updateVOI = eventDetail => {\r\n      const { range } = eventDetail.detail;\r\n\r\n      if (!range) {\r\n        return;\r\n      }\r\n\r\n      const { lower, upper } = range;\r\n      const { windowWidth, windowCenter } = utilities.windowLevel.toWindowLevel(lower, upper);\r\n\r\n      setVOI({ windowCenter, windowWidth });\r\n    };\r\n\r\n    element.addEventListener(Enums.Events.VOI_MODIFIED, updateVOI);\r\n\r\n    return () => {\r\n      element.removeEventListener(Enums.Events.VOI_MODIFIED, updateVOI);\r\n    };\r\n  }, [viewportId, viewportData, voi, element]);\r\n\r\n  /**\r\n   * Updating the scale when the viewport changes its zoom\r\n   */\r\n  useEffect(() => {\r\n    const updateScale = eventDetail => {\r\n      const { previousCamera, camera } = eventDetail.detail;\r\n\r\n      if (\r\n        previousCamera.parallelScale !== camera.parallelScale ||\r\n        previousCamera.scale !== camera.scale\r\n      ) {\r\n        const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n        if (!viewport) {\r\n          return;\r\n        }\r\n\r\n        const scale = viewport.getZoom();\r\n\r\n        setScale(scale);\r\n      }\r\n    };\r\n\r\n    element.addEventListener(Enums.Events.CAMERA_MODIFIED, updateScale);\r\n\r\n    return () => {\r\n      element.removeEventListener(Enums.Events.CAMERA_MODIFIED, updateScale);\r\n    };\r\n  }, [viewportId, viewportData, cornerstoneViewportService, element]);\r\n\r\n  const _renderOverlayItem = useCallback(\r\n    (item, props) => {\r\n      const overlayItemProps = {\r\n        ...props,\r\n        element,\r\n        viewportData: viewportData,\r\n        imageSliceData,\r\n        viewportId,\r\n        servicesManager,\r\n        customization: item,\r\n        formatters: {\r\n          formatPN,\r\n          formatDate: formatDICOMDate,\r\n          formatTime: formatDICOMTime,\r\n          formatNumberPrecision,\r\n        },\r\n      };\r\n\r\n      if (!item) {\r\n        return null;\r\n      }\r\n\r\n      const { customizationType } = item;\r\n      const OverlayItemComponent = OverlayItemComponents[customizationType];\r\n\r\n      if (OverlayItemComponent) {\r\n        return <OverlayItemComponent {...overlayItemProps} />;\r\n      } else {\r\n        const renderItem = customizationService.transform(item);\r\n\r\n        if (typeof renderItem.contentF === 'function') {\r\n          return renderItem.contentF(overlayItemProps);\r\n        }\r\n      }\r\n    },\r\n    [\r\n      element,\r\n      viewportData,\r\n      imageSliceData,\r\n      viewportId,\r\n      servicesManager,\r\n      customizationService,\r\n      displaySetProps,\r\n      voi,\r\n      scale,\r\n      instanceNumber,\r\n    ]\r\n  );\r\n\r\n  const getContent = useCallback(\r\n    (customization, keyPrefix) => {\r\n      if (!customization?.items) {\r\n        return null;\r\n      }\r\n      const { items } = customization;\r\n      const props = {\r\n        ...displaySetProps,\r\n        formatters: { formatDate: formatDICOMDate },\r\n        voi,\r\n        scale,\r\n        instanceNumber,\r\n        viewportId,\r\n        toolGroupService,\r\n      };\r\n\r\n      return (\r\n        <>\r\n          {items.map((item, index) => (\r\n            <div key={`${keyPrefix}_${index}`}>\r\n              {(!item?.condition || item.condition(props)) && _renderOverlayItem(item, props) || null}\r\n            </div>\r\n          ))}\r\n        </>\r\n      );\r\n    },\r\n    [_renderOverlayItem]\r\n  );\r\n\r\n\r\n  return (\r\n    <ViewportOverlay\r\n      topLeft={getContent(topLeftCustomization, 'topLeftOverlayItem')}\r\n      topRight={getContent(topRightCustomization, 'topRightOverlayItem')}\r\n      bottomLeft={getContent(bottomLeftCustomization, 'bottomLeftOverlayItem')}\r\n      bottomRight={getContent(bottomRightCustomization, 'bottomRightOverlayItem')}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Gets an array of display sets for the given viewport, based on the viewport data.\r\n * Returns null if none found.\r\n */\r\nfunction getDisplaySets(viewportData, displaySetService) {\r\n  if (!viewportData?.data?.length) {\r\n    return null;\r\n  }\r\n  const displaySets = viewportData.data.map(datum => displaySetService.getDisplaySetByUID(datum.displaySetInstanceUID)).filter(it => !!it);\r\n  if (!displaySets.length) {\r\n    return null;\r\n  }\r\n  return displaySets;\r\n}\r\n\r\nconst getInstanceNumber = (viewportData, viewportId, imageIndex, cornerstoneViewportService) => {\r\n  let instanceNumber;\r\n\r\n  switch (viewportData.viewportType) {\r\n    case Enums.ViewportType.STACK:\r\n      instanceNumber = _getInstanceNumberFromStack(viewportData, imageIndex);\r\n      break;\r\n    case Enums.ViewportType.ORTHOGRAPHIC:\r\n      instanceNumber = _getInstanceNumberFromVolume(\r\n        viewportData,\r\n        viewportId,\r\n        cornerstoneViewportService,\r\n        imageIndex\r\n      );\r\n      break;\r\n  }\r\n\r\n  return Number.isNaN(instanceNumber) ? null : instanceNumber ?? null;\r\n};\r\n\r\nfunction _getInstanceNumberFromStack(viewportData, imageIndex) {\r\n  const imageIds = viewportData.data[0].imageIds;\r\n  const imageId = imageIds[imageIndex];\r\n\r\n  if (!imageId) {\r\n    return;\r\n  }\r\n\r\n  const generalImageModule = metaData.get('generalImageModule', imageId) || {};\r\n  const { instanceNumber } = generalImageModule;\r\n\r\n  const stackSize = imageIds.length;\r\n\r\n  if (stackSize <= 1) {\r\n    return;\r\n  }\r\n\r\n  return parseInt(instanceNumber);\r\n}\r\n\r\n\r\n// Since volume viewports can be in any view direction, they can render\r\n// a reconstructed image which don't have imageIds; therefore, no instance and instanceNumber\r\n// Here we check if viewport is in the acquisition direction and if so, we get the instanceNumber\r\nfunction _getInstanceNumberFromVolume(\r\n  viewportData,\r\n  viewportId,\r\n  cornerstoneViewportService,\r\n  imageIndex\r\n) {\r\n  const volumes = viewportData.data;\r\n\r\n  if (!volumes) {\r\n    return;\r\n  }\r\n\r\n  // Todo: support fusion of acquisition plane which has instanceNumber\r\n  const { volume } = volumes[0];\r\n  const { direction, imageIds } = volume;\r\n\r\n  const cornerstoneViewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n  if (!cornerstoneViewport) {\r\n    return;\r\n  }\r\n\r\n  const camera = cornerstoneViewport.getCamera();\r\n  const { viewPlaneNormal } = camera;\r\n  // checking if camera is looking at the acquisition plane (defined by the direction on the volume)\r\n\r\n  const scanAxisNormal = direction.slice(6, 9);\r\n\r\n  // check if viewPlaneNormal is parallel to scanAxisNormal\r\n  const cross = vec3.cross(vec3.create(), viewPlaneNormal, scanAxisNormal);\r\n  const isAcquisitionPlane = vec3.length(cross) < EPSILON;\r\n\r\n  if (isAcquisitionPlane) {\r\n    const imageId = imageIds[imageIndex];\r\n\r\n    if (!imageId) {\r\n      return {};\r\n    }\r\n\r\n    const { instanceNumber } = metaData.get('generalImageModule', imageId) || {};\r\n    return parseInt(instanceNumber);\r\n  }\r\n}\r\n\r\nfunction OverlayItem(props) {\r\n  const { instance, customization = {} } = props;\r\n  const { color, attribute, title, label, background } = customization;\r\n  const value = customization.contentF?.(props, customization) ?? instance?.[attribute];\r\n  if (value === undefined || value === null) {\r\n    return null;\r\n  }\r\n  return (\r\n    <div\r\n      className=\"overlay-item flex flex-row\"\r\n      style={{ color, background }}\r\n      title={title}\r\n    >\r\n      {label ? (<span className=\"mr-1 shrink-0\">{label}</span>) : null}\r\n      <span className=\"ml-1 mr-2 shrink-0\">{value}</span>\r\n    </div>);\r\n}\r\n\r\n/**\r\n * Window Level / Center Overlay item\r\n */\r\nfunction VOIOverlayItem({ voi, customization }: OverlayItemProps) {\r\n  const { windowWidth, windowCenter } = voi;\r\n  if (typeof windowCenter !== 'number' || typeof windowWidth !== 'number') {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"overlay-item flex flex-row\"\r\n      style={{ color: customization?.color }}\r\n    >\r\n      <span className=\"mr-1 shrink-0\">W:</span>\r\n      <span className=\"ml-1 mr-2 shrink-0\">{windowWidth.toFixed(0)}</span>\r\n      <span className=\"mr-1 shrink-0\">L:</span>\r\n      <span className=\"ml-1 shrink-0\">{windowCenter.toFixed(0)}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Zoom Level Overlay item\r\n */\r\nfunction ZoomOverlayItem({ scale, customization }: OverlayItemProps) {\r\n  return (\r\n    <div\r\n      className=\"overlay-item flex flex-row\"\r\n      style={{ color: (customization && customization.color) || undefined }}\r\n    >\r\n      <span className=\"mr-1 shrink-0\">Zoom:</span>\r\n      <span>{scale.toFixed(2)}x</span>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Instance Number Overlay Item\r\n */\r\nfunction InstanceNumberOverlayItem({\r\n  instanceNumber,\r\n  imageSliceData,\r\n  customization,\r\n}: OverlayItemProps) {\r\n  const { imageIndex, numberOfSlices } = imageSliceData;\r\n\r\n  return (\r\n    <div\r\n      className=\"overlay-item flex flex-row\"\r\n      style={{ color: (customization && customization.color) || undefined }}\r\n    >\r\n      <span>\r\n        {instanceNumber !== undefined && instanceNumber !== null ? (\r\n          <>\r\n            <span className=\"mr-1 shrink-0\">I:</span>\r\n            <span>{`${instanceNumber} (${imageIndex + 1}/${numberOfSlices})`}</span>\r\n          </>\r\n        ) : (\r\n          `${imageIndex + 1}/${numberOfSlices}`\r\n        )}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\nCustomizableViewportOverlay.propTypes = {\r\n  viewportData: PropTypes.object,\r\n  imageIndex: PropTypes.number,\r\n  viewportId: PropTypes.string,\r\n};\r\n\r\nexport default CustomizableViewportOverlay;\r\n\r\nexport { CustomizableViewportOverlay, CornerstoneOverlay };\r\n","import moment from 'moment';\r\nimport { metaData } from '@cornerstonejs/core';\r\n\r\n/**\r\n * Checks if value is valid.\r\n *\r\n * @param {number} value\r\n * @returns {boolean} is valid.\r\n */\r\nexport function isValidNumber(value) {\r\n  return typeof value === 'number' && !isNaN(value);\r\n}\r\n\r\n/**\r\n * Formats number precision.\r\n *\r\n * @param {number} number\r\n * @param {number} precision\r\n * @returns {number} formatted number.\r\n */\r\nexport function formatNumberPrecision(number, precision = 0) {\r\n  if (number !== null) {\r\n    return parseFloat(number).toFixed(precision);\r\n  }\r\n}\r\n\r\n/**\r\n * Formats DICOM date.\r\n *\r\n * @param {string} date\r\n * @param {string} strFormat\r\n * @returns {string} formatted date.\r\n */\r\nexport function formatDICOMDate(date, strFormat = 'MMM D, YYYY') {\r\n  return moment(date, 'YYYYMMDD').format(strFormat);\r\n}\r\n\r\n/**\r\n *    DICOM Time is stored as HHmmss.SSS, where:\r\n *      HH 24 hour time:\r\n *        m mm        0..59   Minutes\r\n *        s ss        0..59   Seconds\r\n *        S SS SSS    0..999  Fractional seconds\r\n *\r\n *        Goal: '24:12:12'\r\n *\r\n * @param {*} time\r\n * @param {string} strFormat\r\n * @returns {string} formatted name.\r\n */\r\nexport function formatDICOMTime(time, strFormat = 'HH:mm:ss') {\r\n  return moment(time, 'HH:mm:ss').format(strFormat);\r\n}\r\n\r\n/**\r\n * Formats a patient name for display purposes\r\n *\r\n * @param {string} name\r\n * @returns {string} formatted name.\r\n */\r\nexport function formatPN(name) {\r\n  if (!name) {\r\n    return '';\r\n  }\r\n  if (typeof name === 'object') {\r\n    name = name.Alphabetic;\r\n    if (!name) {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  const cleaned = name\r\n    .split('^')\r\n    .filter(s => !!s)\r\n    .join(', ')\r\n    .trim();\r\n  return cleaned === ',' || cleaned === '' ? '' : cleaned;\r\n}\r\n\r\n/**\r\n * Gets compression type\r\n *\r\n * @param {number} imageId\r\n * @returns {string} compression type.\r\n */\r\nexport function getCompression(imageId) {\r\n  const generalImageModule = metaData.get('generalImageModule', imageId) || {};\r\n  const { lossyImageCompression, lossyImageCompressionRatio, lossyImageCompressionMethod } =\r\n    generalImageModule;\r\n\r\n  if (lossyImageCompression === '01' && lossyImageCompressionRatio !== '') {\r\n    const compressionMethod = lossyImageCompressionMethod || 'Lossy: ';\r\n    const compressionRatio = formatNumberPrecision(lossyImageCompressionRatio, 2);\r\n    return compressionMethod + compressionRatio + ' : 1';\r\n  }\r\n\r\n  return 'Lossless / Uncompressed';\r\n}\r\n","import React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useReducer,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Types, ViewportActionCornersLocations } from '@ohif/ui';\r\nimport ViewportActionCornersService, {\r\n  ActionComponentInfo,\r\n} from '../services/ViewportActionCornersService/ViewportActionCornersService';\r\n\r\ninterface StateComponentInfo extends Types.ViewportActionCornersComponentInfo {\r\n  indexPriority: number;\r\n}\r\n\r\ntype State = Record<string, Record<ViewportActionCornersLocations, Array<StateComponentInfo>>>;\r\n\r\nconst DEFAULT_STATE: State = {\r\n  // default here is the viewportId of the default viewport\r\n  default: {\r\n    [ViewportActionCornersLocations.topLeft]: [],\r\n    [ViewportActionCornersLocations.topRight]: [],\r\n    [ViewportActionCornersLocations.bottomLeft]: [],\r\n    [ViewportActionCornersLocations.bottomRight]: [],\r\n  },\r\n  // [anotherViewportId]: { ..... }\r\n};\r\n\r\nexport const ViewportActionCornersContext = createContext(DEFAULT_STATE);\r\n\r\nexport function ViewportActionCornersProvider({ children, service }) {\r\n  const viewportActionCornersReducer = (state, action) => {\r\n    switch (action.type) {\r\n      case 'SET_ACTION_COMPONENT': {\r\n        const { viewportId, id, component, location, indexPriority = 0 } = action.payload;\r\n        // Get the components at the specified location of the specified viewport.\r\n        let locationComponents = state?.[viewportId]?.[location]\r\n          ? [...state[viewportId][location]]\r\n          : [];\r\n\r\n        // If the component (id) already exists at the location specified in the payload,\r\n        // then it must be replaced with the component in the payload so first\r\n        // remove it from that location.\r\n        const deletionIndex = locationComponents.findIndex(component => component.id === id);\r\n        if (deletionIndex !== -1) {\r\n          locationComponents = [\r\n            ...locationComponents.slice(0, deletionIndex),\r\n            ...locationComponents.slice(deletionIndex + 1),\r\n          ];\r\n        }\r\n\r\n        // Insert the component from the payload but\r\n        // do not insert an undefined or null component.\r\n        if (component) {\r\n          const insertionIndex = locationComponents.findIndex(\r\n            component => indexPriority <= component.indexPriority\r\n          );\r\n          locationComponents = [\r\n            ...locationComponents.slice(0, insertionIndex),\r\n            {\r\n              id,\r\n              component,\r\n              indexPriority,\r\n            },\r\n            ...locationComponents.slice(insertionIndex + 1),\r\n          ];\r\n        }\r\n\r\n        return {\r\n          ...state,\r\n          ...{\r\n            [viewportId]: {\r\n              ...state[viewportId],\r\n              [location]: locationComponents,\r\n            },\r\n          },\r\n        };\r\n      }\r\n      case 'CLEAR_ACTION_COMPONENTS': {\r\n        const viewportId = action.payload;\r\n        const nextState = { ...state };\r\n        delete nextState[viewportId];\r\n        return nextState;\r\n      }\r\n      default:\r\n        return { ...state };\r\n    }\r\n  };\r\n\r\n  const [viewportActionCornersState, dispatch] = useReducer(\r\n    viewportActionCornersReducer,\r\n    DEFAULT_STATE\r\n  );\r\n\r\n  const getState = useCallback(() => {\r\n    return viewportActionCornersState;\r\n  }, [viewportActionCornersState]);\r\n\r\n  const setComponent = useCallback(\r\n    (actionComponentInfo: ActionComponentInfo) => {\r\n      dispatch({ type: 'SET_ACTION_COMPONENT', payload: actionComponentInfo });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setComponents = useCallback(\r\n    (actionComponentInfos: Array<ActionComponentInfo>) => {\r\n      actionComponentInfos.forEach(actionComponentInfo =>\r\n        dispatch({ type: 'SET_ACTION_COMPONENT', payload: actionComponentInfo })\r\n      );\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const clear = useCallback(\r\n    (viewportId: string) => dispatch({ type: 'CLEAR_ACTION_COMPONENTS', payload: viewportId }),\r\n    [dispatch]\r\n  );\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({\r\n        getState,\r\n        setComponent,\r\n        setComponents,\r\n        clear,\r\n      });\r\n    }\r\n  }, [getState, service, setComponent, setComponents]);\r\n\r\n  // run many of the calls through the service itself since we want to publish events\r\n  const api = {\r\n    getState,\r\n    setComponent: props => service.setComponent(props),\r\n    setComponents: props => service.setComponents(props),\r\n    clear: props => service.clear(props),\r\n  };\r\n\r\n  const contextValue = useMemo(\r\n    () => [viewportActionCornersState, api],\r\n    [viewportActionCornersState, api]\r\n  );\r\n\r\n  return (\r\n    <ViewportActionCornersContext.Provider value={contextValue}>\r\n      {children}\r\n    </ViewportActionCornersContext.Provider>\r\n  );\r\n}\r\n\r\nViewportActionCornersProvider.propTypes = {\r\n  children: PropTypes.node,\r\n  service: PropTypes.instanceOf(ViewportActionCornersService).isRequired,\r\n};\r\n\r\nexport const useViewportActionCornersContext = () => useContext(ViewportActionCornersContext);\r\n","import * as cornerstone from '@cornerstonejs/core';\r\nimport { volumeLoader } from '@cornerstonejs/core';\r\nimport {\r\n  cornerstoneStreamingImageVolumeLoader,\r\n  cornerstoneStreamingDynamicImageVolumeLoader,\r\n} from '@cornerstonejs/streaming-image-volume-loader';\r\nimport dicomImageLoader, { webWorkerManager } from '@cornerstonejs/dicom-image-loader';\r\nimport dicomParser from 'dicom-parser';\r\nimport { errorHandler, utils } from '@ohif/core';\r\n\r\nconst { registerVolumeLoader } = volumeLoader;\r\n\r\nlet initialized = false;\r\n\r\nfunction initWebWorkers(appConfig) {\r\n  const config = {\r\n    maxWebWorkers: Math.min(\r\n      Math.max(navigator.hardwareConcurrency - 1, 1),\r\n      appConfig.maxNumberOfWebWorkers\r\n    ),\r\n    startWebWorkersOnDemand: true,\r\n    taskConfiguration: {\r\n      decodeTask: {\r\n        initializeCodecsOnStartup: false,\r\n        usePDFJS: false,\r\n        strict: false,\r\n      },\r\n    },\r\n  };\r\n\r\n  if (!initialized) {\r\n    dicomImageLoader.webWorkerManager.initialize(config);\r\n    initialized = true;\r\n  }\r\n}\r\n\r\nexport default function initWADOImageLoader(\r\n  userAuthenticationService,\r\n  appConfig,\r\n  extensionManager\r\n) {\r\n  dicomImageLoader.external.cornerstone = cornerstone;\r\n  dicomImageLoader.external.dicomParser = dicomParser;\r\n\r\n  registerVolumeLoader('cornerstoneStreamingImageVolume', cornerstoneStreamingImageVolumeLoader);\r\n\r\n  registerVolumeLoader(\r\n    'cornerstoneStreamingDynamicImageVolume',\r\n    cornerstoneStreamingDynamicImageVolumeLoader\r\n  );\r\n\r\n  dicomImageLoader.configure({\r\n    decodeConfig: {\r\n      // !! IMPORTANT !!\r\n      // We should set this flag to false, since, by default @cornerstonejs/dicom-image-loader\r\n      // will convert everything to integers (to be able to work with cornerstone-2d).\r\n      // Until the default is set to true (which is the case for cornerstone3D),\r\n      // we should set this flag to false.\r\n      convertFloatPixelDataToInt: false,\r\n      use16BitDataType:\r\n        Boolean(appConfig.useNorm16Texture) || Boolean(appConfig.preferSizeOverAccuracy),\r\n    },\r\n    beforeSend: function (xhr) {\r\n      //TODO should be removed in the future and request emitted by DicomWebDataSource\r\n      const sourceConfig = extensionManager.getActiveDataSource()?.[0].getConfig() ?? {};\r\n      const headers = userAuthenticationService.getAuthorizationHeader();\r\n      const acceptHeader = utils.generateAcceptHeader(\r\n        sourceConfig.acceptHeader,\r\n        sourceConfig.requestTransferSyntaxUID,\r\n        sourceConfig.omitQuotationForMultipartRequest\r\n      );\r\n\r\n      const xhrRequestHeaders = {\r\n        Accept: acceptHeader,\r\n      };\r\n\r\n      if (headers) {\r\n        Object.assign(xhrRequestHeaders, headers);\r\n      }\r\n\r\n      return xhrRequestHeaders;\r\n    },\r\n    errorInterceptor: error => {\r\n      errorHandler.getHTTPErrorHandler(error);\r\n    },\r\n  });\r\n\r\n  initWebWorkers(appConfig);\r\n}\r\n\r\nexport function destroy() {\r\n  // Note: we don't want to call .terminate on the webWorkerManager since\r\n  // that resets the config\r\n  const webWorkers = webWorkerManager.webWorkers;\r\n  for (let i = 0; i < webWorkers.length; i++) {\r\n    webWorkers[i].worker.terminate();\r\n  }\r\n  webWorkers.length = 0;\r\n}\r\n","import React from 'react';\r\nimport { Input, Dialog, ButtonEnums, LabellingFlow } from '@ohif/ui';\r\n\r\n/**\r\n *\r\n * @param {*} data\r\n * @param {*} data.text\r\n * @param {*} data.label\r\n * @param {*} event\r\n * @param {*} callback\r\n * @param {*} isArrowAnnotateInputDialog\r\n * @param {*} dialogConfig\r\n * @param {string?} dialogConfig.dialogTitle - title of the input dialog\r\n * @param {string?} dialogConfig.inputLabel - show label above the input\r\n */\r\n\r\nfunction callInputDialog(\r\n  uiDialogService,\r\n  data,\r\n  callback,\r\n  isArrowAnnotateInputDialog = true,\r\n  dialogConfig: any = {}\r\n) {\r\n  const dialogId = 'dialog-enter-annotation';\r\n  const label = data ? (isArrowAnnotateInputDialog ? data.text : data.label) : '';\r\n  const {\r\n    dialogTitle = 'Annotation',\r\n    inputLabel = 'Enter your annotation',\r\n    validateFunc = value => true,\r\n  } = dialogConfig;\r\n\r\n  const onSubmitHandler = ({ action, value }) => {\r\n    switch (action.id) {\r\n      case 'save':\r\n        if (typeof validateFunc === 'function' && !validateFunc(value.label)) {\r\n          return;\r\n        }\r\n\r\n        callback(value.label, action.id);\r\n        break;\r\n      case 'cancel':\r\n        callback('', action.id);\r\n        break;\r\n    }\r\n    uiDialogService.dismiss({ id: dialogId });\r\n  };\r\n\r\n  if (uiDialogService) {\r\n    uiDialogService.create({\r\n      id: dialogId,\r\n      centralize: true,\r\n      isDraggable: false,\r\n      showOverlay: true,\r\n      content: Dialog,\r\n      contentProps: {\r\n        title: dialogTitle,\r\n        value: { label },\r\n        noCloseButton: true,\r\n        onClose: () => uiDialogService.dismiss({ id: dialogId }),\r\n        actions: [\r\n          { id: 'cancel', text: 'Cancel', type: ButtonEnums.type.secondary },\r\n          { id: 'save', text: 'Save', type: ButtonEnums.type.primary },\r\n        ],\r\n        onSubmit: onSubmitHandler,\r\n        body: ({ value, setValue }) => {\r\n          return (\r\n            <Input\r\n              autoFocus\r\n              className=\"border-primary-main bg-black\"\r\n              type=\"text\"\r\n              id=\"annotation\"\r\n              label={inputLabel}\r\n              labelClassName=\"text-white text-[14px] leading-[1.2]\"\r\n              value={value.label}\r\n              onChange={event => {\r\n                event.persist();\r\n                setValue(value => ({ ...value, label: event.target.value }));\r\n              }}\r\n              onKeyPress={event => {\r\n                if (event.key === 'Enter') {\r\n                  onSubmitHandler({ value, action: { id: 'save' } });\r\n                }\r\n              }}\r\n            />\r\n          );\r\n        },\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport function callLabelAutocompleteDialog(uiDialogService, callback, dialogConfig, labelConfig) {\r\n  const exclusive = labelConfig ? labelConfig.exclusive : false;\r\n  const dropDownItems = labelConfig ? labelConfig.items : [];\r\n\r\n  const { validateFunc = value => true } = dialogConfig;\r\n\r\n  const labellingDoneCallback = value => {\r\n    if (typeof value === 'string') {\r\n      if (typeof validateFunc === 'function' && !validateFunc(value)) {\r\n        return;\r\n      }\r\n      callback(value, 'save');\r\n    } else {\r\n      callback('', 'cancel');\r\n    }\r\n    uiDialogService.dismiss({ id: 'select-annotation' });\r\n  };\r\n\r\n  uiDialogService.create({\r\n    id: 'select-annotation',\r\n    centralize: true,\r\n    isDraggable: false,\r\n    showOverlay: true,\r\n    content: LabellingFlow,\r\n    contentProps: {\r\n      labellingDoneCallback: labellingDoneCallback,\r\n      measurementData: { label: '' },\r\n      componentClassName: {},\r\n      labelData: dropDownItems,\r\n      exclusive: exclusive,\r\n    },\r\n  });\r\n}\r\n\r\nexport function showLabelAnnotationPopup(measurement, uiDialogService, labelConfig) {\r\n  const exclusive = labelConfig ? labelConfig.exclusive : false;\r\n  const dropDownItems = labelConfig ? labelConfig.items : [];\r\n  return new Promise<Map<any, any>>((resolve, reject) => {\r\n    const labellingDoneCallback = value => {\r\n      uiDialogService.dismiss({ id: 'select-annotation' });\r\n      if (typeof value === 'string') {\r\n        measurement.label = value;\r\n      }\r\n      resolve(measurement);\r\n    };\r\n\r\n    uiDialogService.create({\r\n      id: 'select-annotation',\r\n      isDraggable: false,\r\n      showOverlay: true,\r\n      content: LabellingFlow,\r\n      defaultPosition: {\r\n        x: window.innerWidth / 2,\r\n        y: window.innerHeight / 2,\r\n      },\r\n      contentProps: {\r\n        labellingDoneCallback: labellingDoneCallback,\r\n        measurementData: measurement,\r\n        componentClassName: {},\r\n        labelData: dropDownItems,\r\n        exclusive: exclusive,\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default callInputDialog;\r\n","import { getEnabledElement } from '@cornerstonejs/core';\r\nimport { IEnabledElement } from '@cornerstonejs/core/dist/esm/types';\r\n\r\nimport { getEnabledElement as OHIFgetEnabledElement } from '../state';\r\n\r\nexport default function getActiveViewportEnabledElement(viewportGridService): IEnabledElement {\r\n  const { activeViewportId } = viewportGridService.getState();\r\n  const { element } = OHIFgetEnabledElement(activeViewportId) || {};\r\n  const enabledElement = getEnabledElement(element);\r\n  return enabledElement;\r\n}\r\n","import { LengthTool, utilities } from '@cornerstonejs/tools';\r\nimport callInputDialog from '../utils/callInputDialog';\r\nimport getActiveViewportEnabledElement from '../utils/getActiveViewportEnabledElement';\r\n\r\nconst { calibrateImageSpacing } = utilities;\r\n\r\n/**\r\n * Calibration Line tool works almost the same as the\r\n */\r\nclass CalibrationLineTool extends LengthTool {\r\n  static toolName = 'CalibrationLine';\r\n\r\n  _renderingViewport: any;\r\n  _lengthToolRenderAnnotation = this.renderAnnotation;\r\n\r\n  renderAnnotation = (enabledElement, svgDrawingHelper) => {\r\n    const { viewport } = enabledElement;\r\n    this._renderingViewport = viewport;\r\n    return this._lengthToolRenderAnnotation(enabledElement, svgDrawingHelper);\r\n  };\r\n\r\n  _getTextLines(data, targetId) {\r\n    const [canvasPoint1, canvasPoint2] = data.handles.points.map(p =>\r\n      this._renderingViewport.worldToCanvas(p)\r\n    );\r\n    // for display, round to 2 decimal points\r\n    const lengthPx = Math.round(calculateLength2(canvasPoint1, canvasPoint2) * 100) / 100;\r\n\r\n    const textLines = [`${lengthPx}px`];\r\n\r\n    return textLines;\r\n  }\r\n}\r\n\r\nfunction calculateLength2(point1, point2) {\r\n  const dx = point1[0] - point2[0];\r\n  const dy = point1[1] - point2[1];\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nfunction calculateLength3(pos1, pos2) {\r\n  const dx = pos1[0] - pos2[0];\r\n  const dy = pos1[1] - pos2[1];\r\n  const dz = pos1[2] - pos2[2];\r\n\r\n  return Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n}\r\n\r\nexport default CalibrationLineTool;\r\n\r\nexport function onCompletedCalibrationLine(\r\n  servicesManager: AppTypes.ServicesManager,\r\n  csToolsEvent\r\n) {\r\n  const { uiDialogService, viewportGridService } = servicesManager.services;\r\n\r\n  // calculate length (mm) with the current Pixel Spacing\r\n  const annotationAddedEventDetail = csToolsEvent.detail;\r\n  const {\r\n    annotation: { metadata, data: annotationData },\r\n  } = annotationAddedEventDetail;\r\n  const { referencedImageId: imageId } = metadata;\r\n  const enabledElement = getActiveViewportEnabledElement(viewportGridService);\r\n  const { viewport } = enabledElement;\r\n\r\n  const length =\r\n    Math.round(\r\n      calculateLength3(annotationData.handles.points[0], annotationData.handles.points[1]) * 100\r\n    ) / 100;\r\n\r\n  const adjustCalibration = newLength => {\r\n    const spacingScale = newLength / length;\r\n\r\n    // trigger resize of the viewport to adjust the world/pixel mapping\r\n    calibrateImageSpacing(imageId, viewport.getRenderingEngine(), {\r\n      type: 'User',\r\n      scale: 1 / spacingScale,\r\n    });\r\n  };\r\n\r\n  return new Promise((resolve, reject) => {\r\n    if (!uiDialogService) {\r\n      reject('UIDialogService is not initiated');\r\n      return;\r\n    }\r\n\r\n    callInputDialog(\r\n      uiDialogService,\r\n      {\r\n        text: '',\r\n        label: `${length}`,\r\n      },\r\n      (value, id) => {\r\n        if (id === 'save') {\r\n          adjustCalibration(Number.parseFloat(value));\r\n          resolve(true);\r\n        } else {\r\n          reject('cancel');\r\n        }\r\n      },\r\n      false,\r\n      {\r\n        dialogTitle: 'Calibration',\r\n        inputLabel: 'Actual Physical distance (mm)',\r\n\r\n        // the input value must be a number\r\n        validateFunc: val => {\r\n          try {\r\n            const v = Number.parseFloat(val);\r\n            return !isNaN(v) && v !== 0.0;\r\n          } catch {\r\n            return false;\r\n          }\r\n        },\r\n      }\r\n    );\r\n  });\r\n}\r\n","import { metaData } from '@cornerstonejs/core';\r\n\r\nconst _cachedOverlayMetadata: Map<string, any[]> = new Map();\r\n\r\n/**\r\n * Image Overlay Viewer tool is not a traditional tool that requires user interactin.\r\n * But it is used to display Pixel Overlays. And it will provide toggling capability.\r\n *\r\n * The documentation for Overlay Plane Module of DICOM can be found in [C.9.2 of\r\n * Part-3 of DICOM standard](https://dicom.nema.org/medical/dicom/2018b/output/chtml/part03/sect_C.9.2.html)\r\n *\r\n * Image Overlay rendered by this tool can be toggled on and off using\r\n * toolGroup.setToolEnabled() and toolGroup.setToolDisabled()\r\n */\r\nconst OverlayPlaneModuleProvider = {\r\n  /** Adds the metadata for overlayPlaneModule */\r\n  add: (imageId, metadata) => {\r\n    if (_cachedOverlayMetadata.get(imageId) === metadata) {\r\n      // This is a no-op here as the tool re-caches the data\r\n      return;\r\n    }\r\n    _cachedOverlayMetadata.set(imageId, metadata);\r\n  },\r\n\r\n  /** Standard getter for metadata */\r\n  get: (type: string, query: string | string[]) => {\r\n    if (Array.isArray(query)) {\r\n      return;\r\n    }\r\n    if (type !== 'overlayPlaneModule') {\r\n      return;\r\n    }\r\n    return _cachedOverlayMetadata.get(query);\r\n  },\r\n};\r\n\r\n// Needs to be higher priority than default provider\r\nmetaData.addProvider(OverlayPlaneModuleProvider.get, 10_000);\r\n\r\nexport default OverlayPlaneModuleProvider;\r\n","import { VolumeViewport, metaData, utilities } from '@cornerstonejs/core';\r\nimport { IStackViewport, IVolumeViewport, Point3 } from '@cornerstonejs/core/dist/esm/types';\r\nimport { AnnotationDisplayTool, drawing } from '@cornerstonejs/tools';\r\nimport { guid, b64toBlob } from '@ohif/core/src/utils';\r\nimport OverlayPlaneModuleProvider from './OverlayPlaneModuleProvider';\r\n\r\ninterface CachedStat {\r\n  color: number[]; // [r, g, b, a]\r\n  overlays: {\r\n    // ...overlayPlaneModule\r\n    _id: string;\r\n    type: 'G' | 'R'; // G for Graphics, R for ROI\r\n    color?: number[]; // Rendered color [r, g, b, a]\r\n    dataUrl?: string; // Rendered image in Data URL expression\r\n  }[];\r\n}\r\n\r\n/**\r\n * Image Overlay Viewer tool is not a traditional tool that requires user interactin.\r\n * But it is used to display Pixel Overlays. And it will provide toggling capability.\r\n *\r\n * The documentation for Overlay Plane Module of DICOM can be found in [C.9.2 of\r\n * Part-3 of DICOM standard](https://dicom.nema.org/medical/dicom/2018b/output/chtml/part03/sect_C.9.2.html)\r\n *\r\n * Image Overlay rendered by this tool can be toggled on and off using\r\n * toolGroup.setToolEnabled() and toolGroup.setToolDisabled()\r\n */\r\nclass ImageOverlayViewerTool extends AnnotationDisplayTool {\r\n  static toolName = 'ImageOverlayViewer';\r\n\r\n  /**\r\n   * The overlay plane module provider add method is exposed here to be used\r\n   * when updating the overlay for this tool to use for displaying data.\r\n   */\r\n  public static addOverlayPlaneModule = OverlayPlaneModuleProvider.add;\r\n\r\n  constructor(\r\n    toolProps = {},\r\n    defaultToolProps = {\r\n      supportedInteractionTypes: [],\r\n      configuration: {\r\n        fillColor: [255, 127, 127, 255],\r\n      },\r\n    }\r\n  ) {\r\n    super(toolProps, defaultToolProps);\r\n  }\r\n\r\n  onSetToolDisabled = (): void => {};\r\n\r\n  protected getReferencedImageId(viewport: IStackViewport | IVolumeViewport): string {\r\n    if (viewport instanceof VolumeViewport) {\r\n      return;\r\n    }\r\n\r\n    const targetId = this.getTargetId(viewport);\r\n    return targetId.split('imageId:')[1];\r\n  }\r\n\r\n  renderAnnotation = (enabledElement, svgDrawingHelper) => {\r\n    const { viewport } = enabledElement;\r\n\r\n    const imageId = this.getReferencedImageId(viewport);\r\n    if (!imageId) {\r\n      return;\r\n    }\r\n\r\n    const overlayMetadata = metaData.get('overlayPlaneModule', imageId);\r\n    const overlays = overlayMetadata?.overlays;\r\n\r\n    // no overlays\r\n    if (!overlays?.length) {\r\n      return;\r\n    }\r\n\r\n    // Fix the x, y positions\r\n    overlays.forEach(overlay => {\r\n      overlay.x ||= 0;\r\n      overlay.y ||= 0;\r\n    });\r\n\r\n    // Will clear cached stat data when the overlay data changes\r\n    ImageOverlayViewerTool.addOverlayPlaneModule(imageId, overlayMetadata);\r\n\r\n    this._getCachedStat(imageId, overlayMetadata, this.configuration.fillColor).then(cachedStat => {\r\n      cachedStat.overlays.forEach(overlay => {\r\n        this._renderOverlay(enabledElement, svgDrawingHelper, overlay);\r\n      });\r\n    });\r\n\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * Render to DOM\r\n   *\r\n   * @param enabledElement\r\n   * @param svgDrawingHelper\r\n   * @param overlayData\r\n   * @returns\r\n   */\r\n  private _renderOverlay(enabledElement, svgDrawingHelper, overlayData) {\r\n    const { viewport } = enabledElement;\r\n    const imageId = this.getReferencedImageId(viewport);\r\n    if (!imageId) {\r\n      return;\r\n    }\r\n\r\n    // Decide the rendering position of the overlay image on the current canvas\r\n    const { _id, columns: width, rows: height, x, y } = overlayData;\r\n    const overlayTopLeftWorldPos = utilities.imageToWorldCoords(imageId, [\r\n      x - 1, // Remind that top-left corner's (x, y) is be (1, 1)\r\n      y - 1,\r\n    ]);\r\n    const overlayTopLeftOnCanvas = viewport.worldToCanvas(overlayTopLeftWorldPos);\r\n    const overlayBottomRightWorldPos = utilities.imageToWorldCoords(imageId, [width, height]);\r\n    const overlayBottomRightOnCanvas = viewport.worldToCanvas(overlayBottomRightWorldPos);\r\n\r\n    // add image to the annotations svg layer\r\n    const svgns = 'http://www.w3.org/2000/svg';\r\n    const svgNodeHash = `image-overlay-${_id}`;\r\n    const existingImageElement = svgDrawingHelper.getSvgNode(svgNodeHash);\r\n\r\n    const attributes = {\r\n      'data-id': svgNodeHash,\r\n      width: overlayBottomRightOnCanvas[0] - overlayTopLeftOnCanvas[0],\r\n      height: overlayBottomRightOnCanvas[1] - overlayTopLeftOnCanvas[1],\r\n      x: overlayTopLeftOnCanvas[0],\r\n      y: overlayTopLeftOnCanvas[1],\r\n      href: overlayData.dataUrl,\r\n    };\r\n\r\n    if (\r\n      isNaN(attributes.x) ||\r\n      isNaN(attributes.y) ||\r\n      isNaN(attributes.width) ||\r\n      isNaN(attributes.height)\r\n    ) {\r\n      console.warn('Invalid rendering attribute for image overlay', attributes['data-id']);\r\n      return false;\r\n    }\r\n\r\n    if (existingImageElement) {\r\n      drawing.setAttributesIfNecessary(attributes, existingImageElement);\r\n      svgDrawingHelper.setNodeTouched(svgNodeHash);\r\n    } else {\r\n      const newImageElement = document.createElementNS(svgns, 'image');\r\n      drawing.setNewAttributesIfValid(attributes, newImageElement);\r\n      svgDrawingHelper.appendNode(newImageElement, svgNodeHash);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private async _getCachedStat(\r\n    imageId: string,\r\n    overlayMetadata,\r\n    color: number[]\r\n  ): Promise<CachedStat> {\r\n    const missingOverlay = overlayMetadata.overlays.filter(\r\n      overlay => overlay.pixelData && !overlay.dataUrl\r\n    );\r\n    if (missingOverlay.length === 0) {\r\n      return overlayMetadata;\r\n    }\r\n\r\n    const overlays = await Promise.all(\r\n      overlayMetadata.overlays\r\n        .filter(overlay => overlay.pixelData)\r\n        .map(async (overlay, idx) => {\r\n          let pixelData = null;\r\n          if (overlay.pixelData.Value) {\r\n            pixelData = overlay.pixelData.Value;\r\n          } else if (overlay.pixelData instanceof Array) {\r\n            pixelData = overlay.pixelData[0];\r\n          } else if (overlay.pixelData.retrieveBulkData) {\r\n            pixelData = await overlay.pixelData.retrieveBulkData();\r\n          } else if (overlay.pixelData.InlineBinary) {\r\n            const blob = b64toBlob(overlay.pixelData.InlineBinary);\r\n            const arrayBuffer = await blob.arrayBuffer();\r\n            pixelData = arrayBuffer;\r\n          }\r\n\r\n          if (!pixelData) {\r\n            return;\r\n          }\r\n\r\n          const dataUrl = this._renderOverlayToDataUrl(\r\n            { width: overlay.columns, height: overlay.rows },\r\n            overlay.color || color,\r\n            pixelData\r\n          );\r\n\r\n          return {\r\n            ...overlay,\r\n            _id: guid(),\r\n            dataUrl, // this will be a data url expression of the rendered image\r\n            color,\r\n          };\r\n        })\r\n    );\r\n    overlayMetadata.overlays = overlays;\r\n\r\n    return overlayMetadata;\r\n  }\r\n\r\n  /**\r\n   * compare two RGBA expression of colors.\r\n   *\r\n   * @param color1\r\n   * @param color2\r\n   * @returns\r\n   */\r\n  private _isSameColor(color1: number[], color2: number[]) {\r\n    return (\r\n      color1 &&\r\n      color2 &&\r\n      color1[0] === color2[0] &&\r\n      color1[1] === color2[1] &&\r\n      color1[2] === color2[2] &&\r\n      color1[3] === color2[3]\r\n    );\r\n  }\r\n\r\n  /**\r\n   * pixelData of overlayPlane module is an array of bits corresponding\r\n   * to each of the underlying pixels of the image.\r\n   * Let's create pixel data from bit array of overlay data\r\n   *\r\n   * @param pixelDataRaw\r\n   * @param color\r\n   * @returns\r\n   */\r\n  private _renderOverlayToDataUrl({ width, height }, color, pixelDataRaw) {\r\n    const pixelDataView = new DataView(pixelDataRaw);\r\n    const totalBits = width * height;\r\n\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, width, height); // make it transparent\r\n    ctx.globalCompositeOperation = 'copy';\r\n\r\n    const imageData = ctx.getImageData(0, 0, width, height);\r\n    const data = imageData.data;\r\n    for (let i = 0, bitIdx = 0, byteIdx = 0; i < totalBits; i++) {\r\n      if (pixelDataView.getUint8(byteIdx) & (1 << bitIdx)) {\r\n        data[i * 4] = color[0];\r\n        data[i * 4 + 1] = color[1];\r\n        data[i * 4 + 2] = color[2];\r\n        data[i * 4 + 3] = color[3];\r\n      }\r\n\r\n      // next bit, byte\r\n      if (bitIdx >= 7) {\r\n        bitIdx = 0;\r\n        byteIdx++;\r\n      } else {\r\n        bitIdx++;\r\n      }\r\n    }\r\n    ctx.putImageData(imageData, 0, 0);\r\n\r\n    return canvas.toDataURL();\r\n  }\r\n}\r\n\r\nexport default ImageOverlayViewerTool;\r\n","import {\r\n  PanTool,\r\n  WindowLevelTool,\r\n  StackScrollTool,\r\n  StackScrollMouseWheelTool,\r\n  ZoomTool,\r\n  VolumeRotateMouseWheelTool,\r\n  MIPJumpToClickTool,\r\n  LengthTool,\r\n  RectangleROITool,\r\n  RectangleROIThresholdTool,\r\n  RectangleROIStartEndThresholdTool,\r\n  EllipticalROITool,\r\n  CircleROITool,\r\n  BidirectionalTool,\r\n  ArrowAnnotateTool,\r\n  DragProbeTool,\r\n  ProbeTool,\r\n  AngleTool,\r\n  CobbAngleTool,\r\n  MagnifyTool,\r\n  CrosshairsTool,\r\n  SegmentationDisplayTool,\r\n  RectangleScissorsTool,\r\n  SphereScissorsTool,\r\n  CircleScissorsTool,\r\n  BrushTool,\r\n  PaintFillTool,\r\n  init,\r\n  addTool,\r\n  annotation,\r\n  ReferenceLinesTool,\r\n  TrackballRotateTool,\r\n  AdvancedMagnifyTool,\r\n  UltrasoundDirectionalTool,\r\n  PlanarFreehandROITool,\r\n  PlanarFreehandContourSegmentationTool,\r\n  SplineROITool,\r\n  LivewireContourTool,\r\n  OrientationMarkerTool,\r\n  WindowLevelRegionTool,\r\n  UndoTool\r\n} from '@cornerstonejs/tools';\r\n\r\nimport CalibrationLineTool from './tools/CalibrationLineTool';\r\nimport ImageOverlayViewerTool from './tools/ImageOverlayViewerTool';\r\n\r\nexport default function initCornerstoneTools(configuration = {}) {\r\n  CrosshairsTool.isAnnotation = false;\r\n  ReferenceLinesTool.isAnnotation = false;\r\n  AdvancedMagnifyTool.isAnnotation = false;\r\n\r\n  init(configuration);\r\n  addTool(PanTool);\r\n  addTool(WindowLevelTool);\r\n  addTool(StackScrollMouseWheelTool);\r\n  addTool(StackScrollTool);\r\n  addTool(ZoomTool);\r\n  addTool(ProbeTool);\r\n  addTool(VolumeRotateMouseWheelTool);\r\n  addTool(MIPJumpToClickTool);\r\n  addTool(LengthTool);\r\n  addTool(RectangleROITool);\r\n  addTool(RectangleROIThresholdTool);\r\n  addTool(RectangleROIStartEndThresholdTool);\r\n  addTool(EllipticalROITool);\r\n  addTool(CircleROITool);\r\n  addTool(BidirectionalTool);\r\n  addTool(ArrowAnnotateTool);\r\n  addTool(DragProbeTool);\r\n  addTool(AngleTool);\r\n  addTool(CobbAngleTool);\r\n  addTool(MagnifyTool);\r\n  addTool(CrosshairsTool);\r\n  addTool(SegmentationDisplayTool);\r\n  addTool(RectangleScissorsTool);\r\n  addTool(SphereScissorsTool);\r\n  addTool(CircleScissorsTool);\r\n  addTool(BrushTool);\r\n  addTool(PaintFillTool);\r\n  addTool(ReferenceLinesTool);\r\n  addTool(CalibrationLineTool);\r\n  addTool(TrackballRotateTool);\r\n  addTool(ImageOverlayViewerTool);\r\n  addTool(AdvancedMagnifyTool);\r\n  addTool(UltrasoundDirectionalTool);\r\n  addTool(PlanarFreehandROITool);\r\n  addTool(SplineROITool);\r\n  addTool(LivewireContourTool);\r\n  addTool(OrientationMarkerTool);\r\n  addTool(WindowLevelRegionTool);\r\n  addTool(PlanarFreehandContourSegmentationTool);\r\n  addTool(UndoTool);\r\n\r\n  // Modify annotation tools to use dashed lines on SR\r\n  const annotationStyle = {\r\n    textBoxFontSize: '15px',\r\n    lineWidth: '1.5',\r\n  };\r\n\r\n  const defaultStyles = annotation.config.style.getDefaultToolStyles();\r\n  annotation.config.style.setDefaultToolStyles({\r\n    global: {\r\n      ...defaultStyles.global,\r\n      ...annotationStyle,\r\n    },\r\n  });\r\n}\r\n\r\nconst toolNames = {\r\n  Pan: PanTool.toolName,\r\n  ArrowAnnotate: ArrowAnnotateTool.toolName,\r\n  WindowLevel: WindowLevelTool.toolName,\r\n  StackScroll: StackScrollTool.toolName,\r\n  StackScrollMouseWheel: StackScrollMouseWheelTool.toolName,\r\n  Zoom: ZoomTool.toolName,\r\n  VolumeRotateMouseWheel: VolumeRotateMouseWheelTool.toolName,\r\n  MipJumpToClick: MIPJumpToClickTool.toolName,\r\n  Length: LengthTool.toolName,\r\n  DragProbe: DragProbeTool.toolName,\r\n  Probe: ProbeTool.toolName,\r\n  RectangleROI: RectangleROITool.toolName,\r\n  RectangleROIThreshold: RectangleROIThresholdTool.toolName,\r\n  RectangleROIStartEndThreshold: RectangleROIStartEndThresholdTool.toolName,\r\n  EllipticalROI: EllipticalROITool.toolName,\r\n  CircleROI: CircleROITool.toolName,\r\n  Bidirectional: BidirectionalTool.toolName,\r\n  Angle: AngleTool.toolName,\r\n  CobbAngle: CobbAngleTool.toolName,\r\n  Magnify: MagnifyTool.toolName,\r\n  Crosshairs: CrosshairsTool.toolName,\r\n  SegmentationDisplay: SegmentationDisplayTool.toolName,\r\n  Brush: BrushTool.toolName,\r\n  PaintFill: PaintFillTool.toolName,\r\n  ReferenceLines: ReferenceLinesTool.toolName,\r\n  CalibrationLine: CalibrationLineTool.toolName,\r\n  TrackballRotateTool: TrackballRotateTool.toolName,\r\n  CircleScissors: CircleScissorsTool.toolName,\r\n  RectangleScissors: RectangleScissorsTool.toolName,\r\n  SphereScissors: SphereScissorsTool.toolName,\r\n  ImageOverlayViewer: ImageOverlayViewerTool.toolName,\r\n  AdvancedMagnify: AdvancedMagnifyTool.toolName,\r\n  UltrasoundDirectional: UltrasoundDirectionalTool.toolName,\r\n  SplineROI: SplineROITool.toolName,\r\n  LivewireContour: LivewireContourTool.toolName,\r\n  PlanarFreehandROI: PlanarFreehandROITool.toolName,\r\n  OrientationMarker: OrientationMarkerTool.toolName,\r\n  WindowLevelRegion: WindowLevelRegionTool.toolName,\r\n  PlanarFreehandContourSegmentation: PlanarFreehandContourSegmentationTool.toolName,\r\n  Undo: UndoTool.toolName,\r\n};\r\n\r\nexport { toolNames };\r\n","export default [\r\n  'Length',\r\n  'EllipticalROI',\r\n  'CircleROI',\r\n  'Bidirectional',\r\n  'ArrowAnnotate',\r\n  'Angle',\r\n  'CobbAngle',\r\n  'Probe',\r\n  'RectangleROI',\r\n  'PlanarFreehandROI',\r\n  'SplineROI',\r\n  'LivewireContour',\r\n  'Probe',\r\n  'UltrasoundDirectionalTool',\r\n];\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\n\r\nconst Length = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return [];\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { length, unit = 'mm' } = targetStats;\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      unit,\r\n      length,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:Length');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { length, unit } = annotation;\r\n    columns.push(`Length`);\r\n    values.push(length);\r\n    columns.push('Unit');\r\n    values.push(unit);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { length, SeriesNumber, SOPInstanceUID, frameNumber, unit } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  if (length === null || length === undefined) {\r\n    return displayText;\r\n  }\r\n  const roundedLength = utils.roundNumber(length, 2);\r\n  displayText.push(`${roundedLength} ${unit} (S: ${SeriesNumber}${instanceText}${frameText})`);\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default Length;\r\n","export default function getHandlesFromPoints(points) {\r\n  if (points.longAxis && points.shortAxis) {\r\n    const handles = {};\r\n    handles.start = points.longAxis[0];\r\n    handles.end = points.longAxis[1];\r\n    handles.perpendicularStart = points.longAxis[0];\r\n    handles.perpendicularEnd = points.longAxis[1];\r\n    return handles;\r\n  }\r\n\r\n  return points\r\n    .map((p, i) => (i % 10 === 0 ? { start: p } : { end: p }))\r\n    .reduce((obj, item) => Object.assign(obj, { ...item }), {});\r\n}\r\n","import { annotation as cs3dToolAnnotationUtils } from '@cornerstonejs/tools';\r\n\r\n/**\r\n * Check whether an annotation from imaging library is selected or not.\r\n * @param {string} annotationUID uid of imaging library annotation\r\n * @returns boolean\r\n */\r\nfunction isAnnotationSelected(annotationUID: string): boolean {\r\n  return cs3dToolAnnotationUtils.selection.isAnnotationSelected(annotationUID);\r\n}\r\n\r\n/**\r\n * Change an annotation from imaging library's selected property.\r\n * @param annotationUID - uid of imaging library annotation\r\n * @param selected - new value for selected\r\n */\r\nfunction setAnnotationSelected(annotationUID: string, selected: boolean): void {\r\n  const isCurrentSelected = isAnnotationSelected(annotationUID);\r\n  // branch cut, avoid invoking imaging library unnecessarily.\r\n  if (isCurrentSelected !== selected) {\r\n    cs3dToolAnnotationUtils.selection.setAnnotationSelected(annotationUID, selected);\r\n  }\r\n}\r\n\r\nfunction getFirstAnnotationSelected(element) {\r\n  const [selectedAnnotationUID] = cs3dToolAnnotationUtils.selection.getAnnotationsSelected() || [];\r\n\r\n  if (selectedAnnotationUID) {\r\n    return cs3dToolAnnotationUtils.state.getAnnotation(selectedAnnotationUID);\r\n  }\r\n}\r\n\r\nexport { isAnnotationSelected, setAnnotationSelected, getFirstAnnotationSelected };\r\n","const getDisplayUnit = unit => (unit == null ? '' : unit);\r\n\r\nexport default getDisplayUnit;\r\n","import { annotation } from '@cornerstonejs/tools';\r\n\r\nimport SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\nimport { getDisplayUnit } from './utils';\r\n\r\nconst Bidirectional = {\r\n  toAnnotation: measurement => {},\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId, referencedSeriesInstanceUID } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return [];\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { length, width, unit } = targetStats;\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      unit,\r\n      length,\r\n      width,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:Bidirectional');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { length, width, unit } = annotation;\r\n    columns.push(`Length`, `Width`, 'Unit');\r\n    values.push(length, width, unit);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { length, width, unit, SeriesNumber, SOPInstanceUID, frameNumber } = mappedAnnotations[0];\r\n  const roundedLength = utils.roundNumber(length, 2);\r\n  const roundedWidth = utils.roundNumber(width, 2);\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  displayText.push(\r\n    `L: ${roundedLength} ${getDisplayUnit(unit)} (S: ${SeriesNumber}${instanceText}${frameText})`\r\n  );\r\n  displayText.push(`W: ${roundedWidth} ${getDisplayUnit(unit)}`);\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default Bidirectional;\r\n","import { utils } from '@ohif/core';\r\nimport getDisplayUnit from './getDisplayUnit';\r\n\r\nexport const getStatisticDisplayString = (numbers, unit, key) => {\r\n  if (Array.isArray(numbers) && numbers.length > 0) {\r\n    const results = numbers.map(number => utils.roundNumber(number, 2));\r\n    return `${key.charAt(0).toUpperCase() + key.slice(1)}: ${results.join(', ')} <small>${getDisplayUnit(unit)}</small>`;\r\n  }\r\n\r\n  const result = utils.roundNumber(numbers, 2);\r\n  return `${key.charAt(0).toUpperCase() + key.slice(1)}: ${result} <small>${getDisplayUnit(unit)}</small>`;\r\n};\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\nimport { getStatisticDisplayString } from './utils/getValueDisplayString';\r\n\r\nconst EllipticalROI = {\r\n  toAnnotation: measurement => {},\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return [];\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { mean, stdDev, max, area, Modality, areaUnit, modalityUnit } = targetStats;\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      Modality,\r\n      unit: modalityUnit,\r\n      areaUnit,\r\n      mean,\r\n      stdDev,\r\n      max,\r\n      area,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:EllipticalROI');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { mean, stdDev, max, area, unit, areaUnit } = annotation;\r\n\r\n    if (!mean || !unit || !max || !area) {\r\n      return;\r\n    }\r\n\r\n    columns.push(`max (${unit})`, `mean (${unit})`, `std (${unit})`, 'Area', 'Unit');\r\n    values.push(max, mean, stdDev, area, areaUnit);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { area, SOPInstanceUID, frameNumber, areaUnit } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  const roundedArea = utils.roundNumber(area, 2);\r\n  displayText.push(`${roundedArea} ${getDisplayUnit(areaUnit)}`);\r\n\r\n  // Todo: we need a better UI for displaying all these information\r\n  mappedAnnotations.forEach(mappedAnnotation => {\r\n    const { unit, max, SeriesNumber } = mappedAnnotation;\r\n\r\n    const maxStr = getStatisticDisplayString(max, unit, 'max');\r\n    const str = `${maxStr}(S:${SeriesNumber}${instanceText}${frameText})`;\r\n    if (!displayText.includes(str)) {\r\n      displayText.push(str);\r\n    }\r\n  });\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default EllipticalROI;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\nimport { getStatisticDisplayString } from './utils/getValueDisplayString';\r\n\r\nconst CircleROI = {\r\n  toAnnotation: measurement => {},\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return [];\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { mean, stdDev, max, area, Modality, areaUnit, modalityUnit } = targetStats;\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      Modality,\r\n      unit: modalityUnit,\r\n      mean,\r\n      stdDev,\r\n      max,\r\n      area,\r\n      areaUnit,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:CircleROI');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { mean, stdDev, max, area, unit, areaUnit } = annotation;\r\n\r\n    if (!mean || !unit || !max || !area) {\r\n      return;\r\n    }\r\n\r\n    columns.push(`max (${unit})`, `mean (${unit})`, `std (${unit})`, 'Area', 'Unit');\r\n    values.push(max, mean, stdDev, area, areaUnit);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { area, SOPInstanceUID, frameNumber, areaUnit } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  // Area sometimes becomes undefined if `preventHandleOutsideImage` is off.\r\n  const roundedArea = utils.roundNumber(area || 0, 2);\r\n  displayText.push(`${roundedArea} ${getDisplayUnit(areaUnit)}`);\r\n\r\n  // Todo: we need a better UI for displaying all these information\r\n  mappedAnnotations.forEach(mappedAnnotation => {\r\n    const { unit, max, SeriesNumber } = mappedAnnotation;\r\n\r\n    const maxStr = getStatisticDisplayString(max, unit, 'max');\r\n\r\n    const str = `${maxStr}(S:${SeriesNumber}${instanceText}${frameText})`;\r\n    if (!displayText.includes(str)) {\r\n      displayText.push(str);\r\n    }\r\n  });\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default CircleROI;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\n\r\nconst Length = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.text,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport: () => {\r\n        throw new Error('Not implemented');\r\n      },\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { text } = data;\r\n  const { referencedImageId } = metadata;\r\n\r\n  const annotations = [];\r\n\r\n  const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n    referencedImageId,\r\n    displaySetService,\r\n    annotation\r\n  );\r\n\r\n  const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n  const { SeriesNumber } = displaySet;\r\n\r\n  annotations.push({\r\n    SeriesInstanceUID,\r\n    SOPInstanceUID,\r\n    SeriesNumber,\r\n    frameNumber,\r\n    text,\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { SeriesNumber, SOPInstanceUID, frameNumber } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  displayText.push(`(S: ${SeriesNumber}${instanceText}${frameText})`);\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default Length;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\n\r\nconst CobbAngle = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Cobb Angle tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations?.[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return;\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { angle } = targetStats;\r\n    const unit = '\\u00B0';\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      unit,\r\n      angle,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:CobbAngle');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { angle, unit } = annotation;\r\n    columns.push(`Angle (${unit})`);\r\n    values.push(angle);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { angle, unit, SeriesNumber, SOPInstanceUID, frameNumber } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n  if (angle === undefined) {\r\n    return displayText;\r\n  }\r\n  const roundedAngle = utils.roundNumber(angle, 2);\r\n  displayText.push(\r\n    `${roundedAngle} ${getDisplayUnit(unit)} (S: ${SeriesNumber}${instanceText}${frameText})`\r\n  );\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default CobbAngle;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\n\r\nconst Angle = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      frameNumber: mappedAnnotations?.[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n      referencedImageId,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return;\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { angle } = targetStats;\r\n    const unit = '\\u00B0';\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      unit,\r\n      angle,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:Angle');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { angle, unit } = annotation;\r\n    columns.push(`Angle (${unit})`);\r\n    values.push(angle);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { angle, unit, SeriesNumber, SOPInstanceUID, frameNumber } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n  if (angle === undefined) {\r\n    return displayText;\r\n  }\r\n  const roundedAngle = utils.roundNumber(angle, 2);\r\n  displayText.push(\r\n    `${roundedAngle} ${getDisplayUnit(unit)} (S: ${SeriesNumber}${instanceText}${frameText})`\r\n  );\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default Angle;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { getDisplayUnit } from './utils';\r\nimport { utils } from '@ohif/core';\r\n\r\n/**\r\n * Represents a mapping utility for Planar Freehand ROI measurements.\r\n */\r\nconst PlanarFreehandROI = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} csToolsEventDetail Cornerstone event data\r\n   * @param {DisplaySetService} DisplaySetService Service for managing display sets\r\n   * @param {CornerstoneViewportService} CornerstoneViewportService Service for managing viewports\r\n   * @param {Function} getValueTypeFromToolType Function to get value type from tool type\r\n   * @returns {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('PlanarFreehandROI tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n    if (!validToolType) {\r\n      throw new Error(`Tool ${toolName} not supported`);\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber, StudyInstanceUID } =\r\n      getSOPInstanceAttributes(referencedImageId, displaySetService, annotation);\r\n\r\n    let displaySet;\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points: data.contour.polyline,\r\n      textBox: data.handles.textBox,\r\n      metadata,\r\n      frameNumber,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: getDisplayText(annotation, displaySet, customizationService, displaySetService),\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport: () => getColumnValueReport(annotation, customizationService),\r\n    };\r\n  },\r\n};\r\n\r\n/**\r\n * This function is used to convert the measurement data to a\r\n * format that is suitable for report generation (e.g. for the csv report).\r\n * The report returns a list of columns and corresponding values.\r\n *\r\n * @param {object} annotation\r\n * @returns {object} Report's content from this tool\r\n */\r\nfunction getColumnValueReport(annotation, customizationService) {\r\n  const { PlanarFreehandROI } = customizationService.get('cornerstone.measurements');\r\n  const { report } = PlanarFreehandROI;\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  /** Add type */\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:PlanarFreehandROI');\r\n\r\n  /** Add cachedStats */\r\n  const { metadata, data } = annotation;\r\n  const stats = data.cachedStats[`imageId:${metadata.referencedImageId}`];\r\n\r\n  report.forEach(({ name, value }) => {\r\n    columns.push(name);\r\n    stats[value] ? values.push(stats[value]) : values.push('not available');\r\n  });\r\n\r\n  /** Add FOR */\r\n  if (metadata.FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(metadata.FrameOfReferenceUID);\r\n  }\r\n\r\n  /** Add points */\r\n  if (data.contour.polyline) {\r\n    columns.push('points');\r\n    values.push(data.contour.polyline.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return { columns, values };\r\n}\r\n\r\n/**\r\n * Retrieves the display text for an annotation in a display set.\r\n *\r\n * @param {Object} annotation - The annotation object.\r\n * @param {Object} displaySet - The display set object.\r\n * @returns {string[]} - An array of display text.\r\n */\r\nfunction getDisplayText(annotation, displaySet, customizationService, displaySetService) {\r\n  const { PlanarFreehandROI } = customizationService.get('cornerstone.measurements');\r\n  const { displayText } = PlanarFreehandROI;\r\n\r\n  const { metadata, data } = annotation;\r\n\r\n  const { SOPInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n    metadata.referencedImageId,\r\n    displaySetService,\r\n    annotation\r\n  );\r\n\r\n  const displayTextArray = [];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  const { SeriesNumber } = displaySet;\r\n  if (SeriesNumber) {\r\n    displayTextArray.push(`S: ${SeriesNumber}${instanceText}${frameText}`);\r\n  }\r\n\r\n  const stats =\r\n    data.cachedStats[`imageId:${metadata.referencedImageId}`] ||\r\n    Array.from(Object.values(data.cachedStats))[0];\r\n\r\n  if (!stats) {\r\n    return displayTextArray;\r\n  }\r\n\r\n  const roundValues = values => {\r\n    if (Array.isArray(values)) {\r\n      return values.map(value => {\r\n        if (isNaN(value)) {\r\n          return value;\r\n        }\r\n        return utils.roundNumber(value, 2);\r\n      });\r\n    }\r\n    return isNaN(values) ? values : utils.roundNumber(values, 2);\r\n  };\r\n\r\n  const findUnitForValue = (displayTextItems, value) =>\r\n    displayTextItems.find(({ type, for: filter }) => type === 'unit' && filter.includes(value))\r\n      ?.value;\r\n\r\n  const formatDisplayText = (displayName, result, unit) =>\r\n    `${displayName}: ${Array.isArray(result) ? roundValues(result).join(', ') : roundValues(result)} ${unit}`;\r\n\r\n  displayText.forEach(({ displayName, value, type }) => {\r\n    if (type === 'value') {\r\n      const result = stats[value];\r\n      const unit = stats[findUnitForValue(displayText, value)] || '';\r\n      displayTextArray.push(formatDisplayText(displayName, result, unit));\r\n    }\r\n  });\r\n\r\n  return displayTextArray;\r\n}\r\n\r\nexport default PlanarFreehandROI;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\nimport { getStatisticDisplayString } from './utils/getValueDisplayString';\r\n\r\nconst RectangleROI = {\r\n  toAnnotation: measurement => {},\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Rectangle ROI tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points, textBox } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      textBox,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return [];\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { mean, stdDev, max, area, Modality, modalityUnit, areaUnit } = targetStats;\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      Modality,\r\n      unit: modalityUnit,\r\n      mean,\r\n      stdDev,\r\n      metadata,\r\n      max,\r\n      area,\r\n      areaUnit,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:RectangleROI');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { mean, stdDev, max, area, unit, areaUnit } = annotation;\r\n\r\n    if (!mean || !unit || !max || !area) {\r\n      return;\r\n    }\r\n\r\n    columns.push(`Maximum`, `Mean`, `Std Dev`, 'Pixel Unit', `Area`, 'Unit');\r\n    values.push(max, mean, stdDev, unit, area, areaUnit);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    // points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n    // convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n    // so that it can be used in the csv report\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  // Area is the same for all series\r\n  const { area, SOPInstanceUID, frameNumber, areaUnit } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  // Area sometimes becomes undefined if `preventHandleOutsideImage` is off.\r\n  const roundedArea = utils.roundNumber(area || 0, 2);\r\n  displayText.push(`${roundedArea} ${getDisplayUnit(areaUnit)}`);\r\n\r\n  // Todo: we need a better UI for displaying all these information\r\n  mappedAnnotations.forEach(mappedAnnotation => {\r\n    const { unit, max, SeriesNumber } = mappedAnnotation;\r\n\r\n    const maxStr = getStatisticDisplayString(max, unit, 'max');\r\n\r\n    const str = `${maxStr}(S:${SeriesNumber}${instanceText}${frameText})`;\r\n    if (!displayText.includes(str)) {\r\n      displayText.push(str);\r\n    }\r\n  });\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default RectangleROI;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\n\r\n/**\r\n * Represents a mapping utility for Spline ROI measurements.\r\n */\r\nconst SplineROI = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} csToolsEventDetail Cornerstone event data\r\n   * @param {DisplaySetService} DisplaySetService Service for managing display sets\r\n   * @param {CornerstoneViewportService} CornerstoneViewportService Service for managing viewports\r\n   * @param {Function} getValueTypeFromToolType Function to get value type from tool type\r\n   * @returns {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    DisplaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('SplineROI tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n    if (!validToolType) {\r\n      throw new Error(`Tool ${toolName} not supported`);\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber, StudyInstanceUID } =\r\n      getSOPInstanceAttributes(referencedImageId);\r\n\r\n    let displaySet;\r\n    if (SOPInstanceUID) {\r\n      displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = DisplaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\r\n    }\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points: data.contour.polyline,\r\n      textBox: data.handles.textBox,\r\n      metadata,\r\n      frameNumber,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: getDisplayText(annotation, displaySet, customizationService),\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport: () => getColumnValueReport(annotation, customizationService),\r\n    };\r\n  },\r\n};\r\n\r\n/**\r\n * This function is used to convert the measurement data to a\r\n * format that is suitable for report generation (e.g. for the csv report).\r\n * The report returns a list of columns and corresponding values.\r\n *\r\n * @param {object} annotation\r\n * @returns {object} Report's content from this tool\r\n */\r\nfunction getColumnValueReport(annotation, customizationService) {\r\n  const { SplineROI } = customizationService.get('cornerstone.measurements');\r\n  const { report } = SplineROI;\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  /** Add type */\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:SplineROI');\r\n\r\n  /** Add cachedStats */\r\n  const { metadata, data } = annotation;\r\n  const stats = data.cachedStats[`imageId:${metadata.referencedImageId}`];\r\n\r\n  report.forEach(({ name, value }) => {\r\n    columns.push(name);\r\n    stats[value] ? values.push(stats[value]) : values.push('not available');\r\n  });\r\n\r\n  /** Add FOR */\r\n  if (metadata.FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(metadata.FrameOfReferenceUID);\r\n  }\r\n\r\n  /** Add points */\r\n  if (data.contour.polyline) {\r\n    /**\r\n     * Points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n     * convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n     * so that it can be used in the CSV report\r\n     */\r\n    columns.push('points');\r\n    values.push(data.contour.polyline.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return { columns, values };\r\n}\r\n\r\n/**\r\n * Retrieves the display text for an annotation in a display set.\r\n *\r\n * @param {Object} annotation - The annotation object.\r\n * @param {Object} displaySet - The display set object.\r\n * @returns {string[]} - An array of display text.\r\n */\r\nfunction getDisplayText(annotation, displaySet, customizationService) {\r\n  const { SplineROI } = customizationService.get('cornerstone.measurements');\r\n  const { displayText } = SplineROI;\r\n  const { metadata, data } = annotation;\r\n\r\n  if (!data.cachedStats || !data.cachedStats[`imageId:${metadata.referencedImageId}`]) {\r\n    return [];\r\n  }\r\n  const { SOPInstanceUID, frameNumber } = getSOPInstanceAttributes(metadata.referencedImageId);\r\n\r\n  const displayTextArray = [];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  const { SeriesNumber } = displaySet;\r\n  if (SeriesNumber) {\r\n    displayTextArray.push(`S: ${SeriesNumber}${instanceText}${frameText}`);\r\n  }\r\n\r\n  const stats = data.cachedStats[`imageId:${metadata.referencedImageId}`];\r\n\r\n  const roundValues = values => {\r\n    if (Array.isArray(values)) {\r\n      return values.map(value => {\r\n        if (isNaN(value)) {\r\n          return value;\r\n        }\r\n        return utils.roundNumber(value);\r\n      });\r\n    }\r\n    return isNaN(values) ? values : utils.roundNumber(values);\r\n  };\r\n\r\n  const findUnitForValue = (displayTextItems, value) =>\r\n    displayTextItems.find(({ type, for: filter }) => type === 'unit' && filter.includes(value))\r\n      ?.value;\r\n\r\n  const formatDisplayText = (displayName, result, unit) =>\r\n    `${displayName}: ${Array.isArray(result) ? roundValues(result).join(', ') : roundValues(result)} ${unit}`;\r\n\r\n  displayText.forEach(({ displayName, value, type }) => {\r\n    if (type === 'value') {\r\n      const result = stats[value];\r\n      const unit = stats[findUnitForValue(displayText, value)] || '';\r\n      displayTextArray.push(formatDisplayText(displayName, result, unit));\r\n    }\r\n  });\r\n\r\n  return displayTextArray;\r\n}\r\n\r\nexport default SplineROI;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { getDisplayUnit } from './utils';\r\nimport { utils } from '@ohif/core';\r\n\r\n/**\r\n * Represents a mapping utility for Livewire measurements.\r\n */\r\nconst LivewireContour = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} csToolsEventDetail Cornerstone event data\r\n   * @param {DisplaySetService} DisplaySetService Service for managing display sets\r\n   * @param {CornerstoneViewportService} CornerstoneViewportService Service for managing viewports\r\n   * @param {Function} getValueTypeFromToolType Function to get value type from tool type\r\n   * @returns {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    DisplaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Livewire tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n    if (!validToolType) {\r\n      throw new Error(`Tool ${toolName} not supported`);\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber, StudyInstanceUID } =\r\n      getSOPInstanceAttributes(referencedImageId);\r\n\r\n    let displaySet;\r\n    if (SOPInstanceUID) {\r\n      displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = DisplaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\r\n    }\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points: data.contour.polyline,\r\n      textBox: data.handles.textBox,\r\n      metadata,\r\n      frameNumber,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: getDisplayText(annotation, displaySet, customizationService),\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport: () => getColumnValueReport(annotation, customizationService),\r\n    };\r\n  },\r\n};\r\n\r\n/**\r\n * This function is used to convert the measurement data to a\r\n * format that is suitable for report generation (e.g. for the csv report).\r\n * The report returns a list of columns and corresponding values.\r\n *\r\n * @param {object} annotation\r\n * @returns {object} Report's content from this tool\r\n */\r\nfunction getColumnValueReport(annotation, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  /** Add type */\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:Livewire');\r\n\r\n  /** Add cachedStats */\r\n  const { metadata, data } = annotation;\r\n\r\n  /** Add FOR */\r\n  if (metadata.FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(metadata.FrameOfReferenceUID);\r\n  }\r\n\r\n  /** Add points */\r\n  if (data.contour.polyline) {\r\n    /**\r\n     * Points has the form of [[x1, y1, z1], [x2, y2, z2], ...]\r\n     * convert it to string of [[x1 y1 z1];[x2 y2 z2];...]\r\n     * so that it can be used in the CSV report\r\n     */\r\n    columns.push('points');\r\n    values.push(data.contour.polyline.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return { columns, values };\r\n}\r\n\r\n/**\r\n * Retrieves the display text for an annotation in a display set.\r\n *\r\n * @param {Object} annotation - The annotation object.\r\n * @param {Object} displaySet - The display set object.\r\n * @returns {string[]} - An array of display text.\r\n */\r\nfunction getDisplayText(annotation, displaySet, customizationService) {\r\n  const { metadata, data } = annotation;\r\n\r\n  if (!data.cachedStats || !data.cachedStats[`imageId:${metadata.referencedImageId}`]) {\r\n    return [];\r\n  }\r\n\r\n  const { area, areaUnit } = data.cachedStats[`imageId:${metadata.referencedImageId}`];\r\n\r\n  const { SOPInstanceUID, frameNumber } = getSOPInstanceAttributes(metadata.referencedImageId);\r\n\r\n  const displayText = [];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n\r\n  const { SeriesNumber } = displaySet;\r\n  if (SeriesNumber) {\r\n    displayText.push(`S: ${SeriesNumber}${instanceText}${frameText}`);\r\n  }\r\n\r\n  if (area) {\r\n    /**\r\n     * Add Area\r\n     * Area sometimes becomes undefined if `preventHandleOutsideImage` is off\r\n     */\r\n    const roundedArea = utils.roundNumber(area || 0, 2);\r\n    displayText.push(`${roundedArea} ${getDisplayUnit(areaUnit)}`);\r\n  }\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default LivewireContour;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\n\r\nconst Probe = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n    }\r\n\r\n    const { points } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      referencedImageId,\r\n      frameNumber: mappedAnnotations?.[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, displaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return;\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } = getSOPInstanceAttributes(\r\n      referencedImageId,\r\n      displaySetService,\r\n      annotation\r\n    );\r\n\r\n    const displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { value } = targetStats;\r\n    const unit = 'HU';\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      unit,\r\n      value,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:Probe');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { value, unit } = annotation;\r\n    columns.push(`Probe (${unit})`);\r\n    values.push(value);\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  const { value, unit, SeriesNumber, SOPInstanceUID, frameNumber } = mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n  if (value === undefined) {\r\n    return displayText;\r\n  }\r\n  const roundedValue = utils.roundNumber(value, 2);\r\n  displayText.push(\r\n    `${roundedValue} ${getDisplayUnit(unit)} (S: ${SeriesNumber}${instanceText}${frameText})`\r\n  );\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default Probe;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport { getDisplayUnit } from './utils';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport { utils } from '@ohif/core';\r\n\r\nconst UltrasoundDirectional = {\r\n  toAnnotation: measurement => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsEventDetail,\r\n    displaySetService,\r\n    CornerstoneViewportService,\r\n    getValueTypeFromToolType,\r\n    customizationService\r\n  ) => {\r\n    const { annotation, viewportId } = csToolsEventDetail;\r\n    const { metadata, data, annotationUID } = annotation;\r\n\r\n    if (!metadata || !data) {\r\n      console.warn('Length tool: Missing metadata or data');\r\n      return null;\r\n    }\r\n\r\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\r\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } =\r\n      getSOPInstanceAttributes(referencedImageId);\r\n\r\n    let displaySet;\r\n\r\n    if (SOPInstanceUID) {\r\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\r\n        SOPInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n    } else {\r\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\r\n    }\r\n\r\n    const { points } = data.handles;\r\n\r\n    const mappedAnnotations = getMappedAnnotations(annotation, displaySetService);\r\n\r\n    const displayText = getDisplayText(mappedAnnotations, displaySet, customizationService);\r\n    const getReport = () =>\r\n      _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService);\r\n\r\n    return {\r\n      uid: annotationUID,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      points,\r\n      metadata,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      frameNumber: mappedAnnotations?.[0]?.frameNumber || 1,\r\n      toolName: metadata.toolName,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: data.label,\r\n      displayText: displayText,\r\n      data: data.cachedStats,\r\n      type: getValueTypeFromToolType(toolName),\r\n      getReport,\r\n    };\r\n  },\r\n};\r\n\r\nfunction getMappedAnnotations(annotation, DisplaySetService) {\r\n  const { metadata, data } = annotation;\r\n  const { cachedStats } = data;\r\n  const { referencedImageId } = metadata;\r\n  const targets = Object.keys(cachedStats);\r\n\r\n  if (!targets.length) {\r\n    return;\r\n  }\r\n\r\n  const annotations = [];\r\n  Object.keys(cachedStats).forEach(targetId => {\r\n    const targetStats = cachedStats[targetId];\r\n\r\n    if (!referencedImageId) {\r\n      throw new Error('Non-acquisition plane measurement mapping not supported');\r\n    }\r\n\r\n    const { SOPInstanceUID, SeriesInstanceUID, frameNumber } =\r\n      getSOPInstanceAttributes(referencedImageId);\r\n\r\n    const displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n      SOPInstanceUID,\r\n      SeriesInstanceUID,\r\n      frameNumber\r\n    );\r\n\r\n    const { SeriesNumber } = displaySet;\r\n    const { xValues, yValues, units, isUnitless, isHorizontal } = targetStats;\r\n\r\n    annotations.push({\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      SeriesNumber,\r\n      frameNumber,\r\n      xValues,\r\n      yValues,\r\n      units,\r\n      isUnitless,\r\n      isHorizontal,\r\n    });\r\n  });\r\n\r\n  return annotations;\r\n}\r\n\r\n/*\r\nThis function is used to convert the measurement data to a format that is\r\nsuitable for the report generation (e.g. for the csv report). The report\r\nreturns a list of columns and corresponding values.\r\n*/\r\nfunction _getReport(mappedAnnotations, points, FrameOfReferenceUID, customizationService) {\r\n  const columns = [];\r\n  const values = [];\r\n\r\n  // Add Type\r\n  columns.push('AnnotationType');\r\n  values.push('Cornerstone:UltrasoundDirectional');\r\n\r\n  mappedAnnotations.forEach(annotation => {\r\n    const { xValues, yValues, units, isUnitless } = annotation;\r\n    if (isUnitless) {\r\n      columns.push('Length' + units[0]);\r\n      values.push(utils.roundNumber(xValues[0], 2));\r\n    } else {\r\n      const dist1 = Math.abs(xValues[1] - xValues[0]);\r\n      const dist2 = Math.abs(yValues[1] - yValues[0]);\r\n      columns.push('Time' + units[0]);\r\n      values.push(utils.roundNumber(dist1, 2));\r\n      columns.push('Length' + units[1]);\r\n      values.push(utils.roundNumber(dist2, 2));\r\n    }\r\n  });\r\n\r\n  if (FrameOfReferenceUID) {\r\n    columns.push('FrameOfReferenceUID');\r\n    values.push(FrameOfReferenceUID);\r\n  }\r\n\r\n  if (points) {\r\n    columns.push('points');\r\n    values.push(points.map(p => p.join(' ')).join(';'));\r\n  }\r\n\r\n  return {\r\n    columns,\r\n    values,\r\n  };\r\n}\r\n\r\nfunction getDisplayText(mappedAnnotations, displaySet, customizationService) {\r\n  if (!mappedAnnotations || !mappedAnnotations.length) {\r\n    return '';\r\n  }\r\n\r\n  const displayText = [];\r\n\r\n  const { xValues, yValues, units, isUnitless, SeriesNumber, SOPInstanceUID, frameNumber } =\r\n    mappedAnnotations[0];\r\n\r\n  const instance = displaySet.images.find(image => image.SOPInstanceUID === SOPInstanceUID);\r\n\r\n  let InstanceNumber;\r\n  if (instance) {\r\n    InstanceNumber = instance.InstanceNumber;\r\n  }\r\n\r\n  const instanceText = InstanceNumber ? ` I: ${InstanceNumber}` : '';\r\n  const frameText = displaySet.isMultiFrame ? ` F: ${frameNumber}` : '';\r\n  const seriesText = `(S: ${SeriesNumber}${instanceText}${frameText})`;\r\n\r\n  if (xValues === undefined || yValues === undefined) {\r\n    return displayText;\r\n  }\r\n\r\n  if (isUnitless) {\r\n    displayText.push(`${utils.roundNumber(xValues[0], 2)} ${units[0]} ${seriesText}`);\r\n  } else {\r\n    const dist1 = Math.abs(xValues[1] - xValues[0]);\r\n    const dist2 = Math.abs(yValues[1] - yValues[0]);\r\n    displayText.push(`${utils.roundNumber(dist1)} ${units[0]} ${seriesText}`);\r\n    displayText.push(`${utils.roundNumber(dist2)} ${units[1]} ${seriesText}`);\r\n  }\r\n\r\n  return displayText;\r\n}\r\n\r\nexport default UltrasoundDirectional;\r\n","import { MeasurementService } from '@ohif/core';\r\nimport Length from './Length';\r\nimport Bidirectional from './Bidirectional';\r\nimport EllipticalROI from './EllipticalROI';\r\nimport CircleROI from './CircleROI';\r\nimport ArrowAnnotate from './ArrowAnnotate';\r\nimport CobbAngle from './CobbAngle';\r\nimport Angle from './Angle';\r\nimport PlanarFreehandROI from './PlanarFreehandROI';\r\nimport RectangleROI from './RectangleROI';\r\nimport SplineROI from './SplineROI';\r\nimport LivewireContour from './LivewireContour';\r\nimport Probe from './Probe';\r\nimport UltrasoundDirectional from './UltrasoundDirectional';\r\n\r\nconst measurementServiceMappingsFactory = (\r\n  measurementService: MeasurementService,\r\n  displaySetService,\r\n  cornerstoneViewportService,\r\n  customizationService\r\n) => {\r\n  /**\r\n   * Maps measurement service format object to cornerstone annotation object.\r\n   *\r\n   * @param measurement The measurement instance\r\n   * @param definition The source definition\r\n   * @return Cornerstone annotation data\r\n   */\r\n\r\n  const _getValueTypeFromToolType = toolType => {\r\n    const { POLYLINE, ELLIPSE, CIRCLE, RECTANGLE, BIDIRECTIONAL, POINT, ANGLE } =\r\n      MeasurementService.VALUE_TYPES;\r\n\r\n    // TODO -> I get why this was attempted, but its not nearly flexible enough.\r\n    // A single measurement may have an ellipse + a bidirectional measurement, for instances.\r\n    // You can't define a bidirectional tool as a single type..\r\n    const TOOL_TYPE_TO_VALUE_TYPE = {\r\n      Length: POLYLINE,\r\n      EllipticalROI: ELLIPSE,\r\n      CircleROI: CIRCLE,\r\n      RectangleROI: RECTANGLE,\r\n      PlanarFreehandROI: POLYLINE,\r\n      Bidirectional: BIDIRECTIONAL,\r\n      ArrowAnnotate: POINT,\r\n      CobbAngle: ANGLE,\r\n      Angle: ANGLE,\r\n      SplineROI: POLYLINE,\r\n      LivewireContour: POLYLINE,\r\n      Probe: POINT,\r\n      UltrasoundDirectional: POLYLINE,\r\n    };\r\n\r\n    return TOOL_TYPE_TO_VALUE_TYPE[toolType];\r\n  };\r\n\r\n  const factories = {\r\n    Length: {\r\n      toAnnotation: Length.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        Length.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n      ],\r\n    },\r\n    Bidirectional: {\r\n      toAnnotation: Bidirectional.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        Bidirectional.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        // TODO -> We should eventually do something like shortAxis + longAxis,\r\n        // But its still a little unclear how these automatic interpretations will work.\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n      ],\r\n    },\r\n\r\n    EllipticalROI: {\r\n      toAnnotation: EllipticalROI.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        EllipticalROI.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.ELLIPSE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    CircleROI: {\r\n      toAnnotation: CircleROI.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        CircleROI.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.CIRCLE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    RectangleROI: {\r\n      toAnnotation: RectangleROI.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        RectangleROI.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    PlanarFreehandROI: {\r\n      toAnnotation: PlanarFreehandROI.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        PlanarFreehandROI.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    SplineROI: {\r\n      toAnnotation: SplineROI.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        SplineROI.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    LivewireContour: {\r\n      toAnnotation: LivewireContour.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        LivewireContour.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    ArrowAnnotate: {\r\n      toAnnotation: ArrowAnnotate.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        ArrowAnnotate.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POINT,\r\n          points: 1,\r\n        },\r\n      ],\r\n    },\r\n\r\n    Probe: {\r\n      toAnnotation: Probe.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        Probe.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POINT,\r\n          points: 1,\r\n        },\r\n      ],\r\n    },\r\n\r\n    CobbAngle: {\r\n      toAnnotation: CobbAngle.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        CobbAngle.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.ANGLE,\r\n        },\r\n      ],\r\n    },\r\n\r\n    Angle: {\r\n      toAnnotation: Angle.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        Angle.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.ANGLE,\r\n        },\r\n      ],\r\n    },\r\n    UltrasoundDirectional: {\r\n      toAnnotation: UltrasoundDirectional.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        UltrasoundDirectional.toMeasurement(\r\n          csToolsAnnotation,\r\n          displaySetService,\r\n          cornerstoneViewportService,\r\n          _getValueTypeFromToolType,\r\n          customizationService\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n      ],\r\n    },\r\n  };\r\n\r\n  return factories;\r\n};\r\n\r\nexport default measurementServiceMappingsFactory;\r\n","import { eventTarget } from '@cornerstonejs/core';\r\nimport { Enums, annotation } from '@cornerstonejs/tools';\r\nimport { DicomMetadataStore } from '@ohif/core';\r\nimport { toolNames } from './initCornerstoneTools';\r\nimport { onCompletedCalibrationLine } from './tools/CalibrationLineTool';\r\n\r\nimport measurementServiceMappingsFactory from './utils/measurementServiceMappings/measurementServiceMappingsFactory';\r\nimport getSOPInstanceAttributes from './utils/measurementServiceMappings/utils/getSOPInstanceAttributes';\r\n\r\nconst { removeAnnotation } = annotation.state;\r\n\r\nconst csToolsEvents = Enums.Events;\r\n\r\nconst CORNERSTONE_3D_TOOLS_SOURCE_NAME = 'Cornerstone3DTools';\r\nconst CORNERSTONE_3D_TOOLS_SOURCE_VERSION = '0.1';\r\n\r\nconst initMeasurementService = (\r\n  measurementService,\r\n  displaySetService,\r\n  cornerstoneViewportService,\r\n  customizationService\r\n) => {\r\n  /* Initialization */\r\n  const {\r\n    Length,\r\n    Bidirectional,\r\n    EllipticalROI,\r\n    CircleROI,\r\n    ArrowAnnotate,\r\n    Angle,\r\n    CobbAngle,\r\n    RectangleROI,\r\n    PlanarFreehandROI,\r\n    SplineROI,\r\n    LivewireContour,\r\n    Probe,\r\n    UltrasoundDirectional,\r\n  } = measurementServiceMappingsFactory(\r\n    measurementService,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    customizationService\r\n  );\r\n  const csTools3DVer1MeasurementSource = measurementService.createSource(\r\n    CORNERSTONE_3D_TOOLS_SOURCE_NAME,\r\n    CORNERSTONE_3D_TOOLS_SOURCE_VERSION\r\n  );\r\n\r\n  /* Mappings */\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'Length',\r\n    Length.matchingCriteria,\r\n    Length.toAnnotation,\r\n    Length.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'Crosshairs',\r\n    Length.matchingCriteria,\r\n    () => {\r\n      console.warn('Crosshairs mapping not implemented.');\r\n      return {};\r\n    },\r\n    () => {\r\n      console.warn('Crosshairs mapping not implemented.');\r\n      return {};\r\n    }\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'Bidirectional',\r\n    Bidirectional.matchingCriteria,\r\n    Bidirectional.toAnnotation,\r\n    Bidirectional.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'EllipticalROI',\r\n    EllipticalROI.matchingCriteria,\r\n    EllipticalROI.toAnnotation,\r\n    EllipticalROI.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'CircleROI',\r\n    CircleROI.matchingCriteria,\r\n    CircleROI.toAnnotation,\r\n    CircleROI.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'ArrowAnnotate',\r\n    ArrowAnnotate.matchingCriteria,\r\n    ArrowAnnotate.toAnnotation,\r\n    ArrowAnnotate.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'CobbAngle',\r\n    CobbAngle.matchingCriteria,\r\n    CobbAngle.toAnnotation,\r\n    CobbAngle.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'Angle',\r\n    Angle.matchingCriteria,\r\n    Angle.toAnnotation,\r\n    Angle.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'RectangleROI',\r\n    RectangleROI.matchingCriteria,\r\n    RectangleROI.toAnnotation,\r\n    RectangleROI.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'PlanarFreehandROI',\r\n    PlanarFreehandROI.matchingCriteria,\r\n    PlanarFreehandROI.toAnnotation,\r\n    PlanarFreehandROI.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'SplineROI',\r\n    SplineROI.matchingCriteria,\r\n    SplineROI.toAnnotation,\r\n    SplineROI.toMeasurement\r\n  );\r\n\r\n  // On the UI side, the Calibration Line tool will work almost the same as the\r\n  // Length tool\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'CalibrationLine',\r\n    Length.matchingCriteria,\r\n    Length.toAnnotation,\r\n    Length.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'LivewireContour',\r\n    LivewireContour.matchingCriteria,\r\n    LivewireContour.toAnnotation,\r\n    LivewireContour.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'Probe',\r\n    Probe.matchingCriteria,\r\n    Probe.toAnnotation,\r\n    Probe.toMeasurement\r\n  );\r\n\r\n  measurementService.addMapping(\r\n    csTools3DVer1MeasurementSource,\r\n    'UltrasoundDirectionalTool',\r\n    UltrasoundDirectional.matchingCriteria,\r\n    UltrasoundDirectional.toAnnotation,\r\n    UltrasoundDirectional.toMeasurement\r\n  );\r\n\r\n  return csTools3DVer1MeasurementSource;\r\n};\r\n\r\nconst connectToolsToMeasurementService = (servicesManager: AppTypes.ServicesManager) => {\r\n  const {\r\n    measurementService,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    customizationService,\r\n  } = servicesManager.services;\r\n  const csTools3DVer1MeasurementSource = initMeasurementService(\r\n    measurementService,\r\n    displaySetService,\r\n    cornerstoneViewportService,\r\n    customizationService\r\n  );\r\n  connectMeasurementServiceToTools(\r\n    measurementService,\r\n    cornerstoneViewportService,\r\n    csTools3DVer1MeasurementSource\r\n  );\r\n  const { annotationToMeasurement, remove } = csTools3DVer1MeasurementSource;\r\n\r\n  //\r\n  function addMeasurement(csToolsEvent) {\r\n    try {\r\n      const annotationAddedEventDetail = csToolsEvent.detail;\r\n      const {\r\n        annotation: { metadata, annotationUID },\r\n      } = annotationAddedEventDetail;\r\n      const { toolName } = metadata;\r\n\r\n      if (csToolsEvent.type === completedEvt && toolName === toolNames.CalibrationLine) {\r\n        // show modal to input the measurement (mm)\r\n        onCompletedCalibrationLine(servicesManager, csToolsEvent)\r\n          .then(\r\n            () => {\r\n              console.log('calibration applied');\r\n            },\r\n            () => true\r\n          )\r\n          .finally(() => {\r\n            // we don't need the calibration line lingering around, remove the\r\n            // annotation from the display\r\n            removeAnnotation(annotationUID);\r\n            removeMeasurement(csToolsEvent);\r\n            // this will ensure redrawing of annotations\r\n            cornerstoneViewportService.resize();\r\n          });\r\n      } else {\r\n        // To force the measurementUID be the same as the annotationUID\r\n        // Todo: this should be changed when a measurement can include multiple annotations\r\n        // in the future\r\n        annotationAddedEventDetail.uid = annotationUID;\r\n        annotationToMeasurement(toolName, annotationAddedEventDetail);\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to update measurement:', error);\r\n    }\r\n  }\r\n\r\n  function updateMeasurement(csToolsEvent) {\r\n    try {\r\n      const annotationModifiedEventDetail = csToolsEvent.detail;\r\n\r\n      const {\r\n        annotation: { metadata, annotationUID },\r\n      } = annotationModifiedEventDetail;\r\n\r\n      // If the measurement hasn't been added, don't modify it\r\n      const measurement = measurementService.getMeasurement(annotationUID);\r\n\r\n      if (!measurement) {\r\n        return;\r\n      }\r\n      const { toolName } = metadata;\r\n\r\n      annotationModifiedEventDetail.uid = annotationUID;\r\n      // Passing true to indicate this is an update and NOT a annotation (start) completion.\r\n      annotationToMeasurement(toolName, annotationModifiedEventDetail, true);\r\n    } catch (error) {\r\n      console.warn('Failed to update measurement:', error);\r\n    }\r\n  }\r\n  function selectMeasurement(csToolsEvent) {\r\n    try {\r\n      const annotationSelectionEventDetail = csToolsEvent.detail;\r\n\r\n      const { added: addedSelectedAnnotationUIDs, removed: removedSelectedAnnotationUIDs } =\r\n        annotationSelectionEventDetail;\r\n\r\n      if (removedSelectedAnnotationUIDs) {\r\n        removedSelectedAnnotationUIDs.forEach(annotationUID =>\r\n          measurementService.setMeasurementSelected(annotationUID, false)\r\n        );\r\n      }\r\n\r\n      if (addedSelectedAnnotationUIDs) {\r\n        addedSelectedAnnotationUIDs.forEach(annotationUID =>\r\n          measurementService.setMeasurementSelected(annotationUID, true)\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to select and unselect measurements:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When csTools fires a removed event, remove the same measurement\r\n   * from the measurement service\r\n   *\r\n   * @param {*} csToolsEvent\r\n   */\r\n  function removeMeasurement(csToolsEvent) {\r\n    try {\r\n      try {\r\n        const annotationRemovedEventDetail = csToolsEvent.detail;\r\n        const {\r\n          annotation: { annotationUID },\r\n        } = annotationRemovedEventDetail;\r\n\r\n        const measurement = measurementService.getMeasurement(annotationUID);\r\n\r\n        if (measurement) {\r\n          console.log('~~ removeEvt', csToolsEvent);\r\n          remove(annotationUID, annotationRemovedEventDetail);\r\n        }\r\n      } catch (error) {\r\n        console.warn('Failed to update measurement:', error);\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to remove measurement:', error);\r\n    }\r\n  }\r\n\r\n  // on display sets added, check if there are any measurements in measurement service that need to be\r\n  // put into cornerstone tools\r\n  const addedEvt = csToolsEvents.ANNOTATION_ADDED;\r\n  const completedEvt = csToolsEvents.ANNOTATION_COMPLETED;\r\n  const updatedEvt = csToolsEvents.ANNOTATION_MODIFIED;\r\n  const removedEvt = csToolsEvents.ANNOTATION_REMOVED;\r\n  const selectionEvt = csToolsEvents.ANNOTATION_SELECTION_CHANGE;\r\n\r\n  eventTarget.addEventListener(addedEvt, addMeasurement);\r\n  eventTarget.addEventListener(completedEvt, addMeasurement);\r\n  eventTarget.addEventListener(updatedEvt, updateMeasurement);\r\n  eventTarget.addEventListener(removedEvt, removeMeasurement);\r\n  eventTarget.addEventListener(selectionEvt, selectMeasurement);\r\n\r\n  return csTools3DVer1MeasurementSource;\r\n};\r\n\r\nconst connectMeasurementServiceToTools = (\r\n  measurementService,\r\n  cornerstoneViewportService,\r\n  measurementSource\r\n) => {\r\n  const { MEASUREMENT_REMOVED, MEASUREMENTS_CLEARED, MEASUREMENT_UPDATED, RAW_MEASUREMENT_ADDED } =\r\n    measurementService.EVENTS;\r\n\r\n  const csTools3DVer1MeasurementSource = measurementService.getSource(\r\n    CORNERSTONE_3D_TOOLS_SOURCE_NAME,\r\n    CORNERSTONE_3D_TOOLS_SOURCE_VERSION\r\n  );\r\n\r\n  measurementService.subscribe(MEASUREMENTS_CLEARED, ({ measurements }) => {\r\n    if (!Object.keys(measurements).length) {\r\n      return;\r\n    }\r\n\r\n    for (const measurement of Object.values(measurements)) {\r\n      const { uid, source } = measurement;\r\n      if (source.name !== CORNERSTONE_3D_TOOLS_SOURCE_NAME) {\r\n        continue;\r\n      }\r\n\r\n      removeAnnotation(uid);\r\n    }\r\n  });\r\n\r\n  measurementService.subscribe(\r\n    MEASUREMENT_UPDATED,\r\n    ({ source, measurement, notYetUpdatedAtSource }) => {\r\n      if (source.name !== CORNERSTONE_3D_TOOLS_SOURCE_NAME) {\r\n        return;\r\n      }\r\n\r\n      if (notYetUpdatedAtSource === false) {\r\n        // This event was fired by cornerstone telling the measurement service to sync.\r\n        // Already in sync.\r\n        return;\r\n      }\r\n\r\n      const { uid, label } = measurement;\r\n\r\n      const sourceAnnotation = annotation.state.getAnnotation(uid);\r\n      const { data, metadata } = sourceAnnotation;\r\n\r\n      if (!data) {\r\n        return;\r\n      }\r\n\r\n      if (data.label !== label) {\r\n        data.label = label;\r\n      }\r\n\r\n      if (metadata.toolName === 'ArrowAnnotate') {\r\n        data.text = label;\r\n      }\r\n\r\n      // Todo: trigger render for annotation\r\n    }\r\n  );\r\n\r\n  measurementService.subscribe(\r\n    RAW_MEASUREMENT_ADDED,\r\n    ({ source, measurement, data, dataSource }) => {\r\n      if (source.name !== CORNERSTONE_3D_TOOLS_SOURCE_NAME) {\r\n        return;\r\n      }\r\n\r\n      const { referenceSeriesUID, referenceStudyUID, SOPInstanceUID } = measurement;\r\n\r\n      const instance = DicomMetadataStore.getInstance(\r\n        referenceStudyUID,\r\n        referenceSeriesUID,\r\n        SOPInstanceUID\r\n      );\r\n\r\n      let imageId;\r\n      let frameNumber = 1;\r\n\r\n      if (measurement?.metadata?.referencedImageId) {\r\n        imageId = measurement.metadata.referencedImageId;\r\n        frameNumber = getSOPInstanceAttributes(measurement.metadata.referencedImageId).frameNumber;\r\n      } else {\r\n        imageId = dataSource.getImageIdsForInstance({ instance });\r\n      }\r\n\r\n      /**\r\n       * This annotation is used by the cornerstone viewport.\r\n       * This is not the read-only annotation rendered by the SR viewport.\r\n       */\r\n      const annotationManager = annotation.state.getAnnotationManager();\r\n      annotationManager.addAnnotation({\r\n        annotationUID: measurement.uid,\r\n        highlighted: false,\r\n        isLocked: false,\r\n        invalidated: false,\r\n        metadata: {\r\n          toolName: measurement.toolName,\r\n          FrameOfReferenceUID: measurement.FrameOfReferenceUID,\r\n          referencedImageId: imageId,\r\n        },\r\n        data: {\r\n          /**\r\n           * Don't remove this destructuring of data here.\r\n           * This is used to pass annotation specific data forward e.g. contour\r\n           */\r\n          ...(data.annotation.data || {}),\r\n          text: data.annotation.data.text,\r\n          handles: { ...data.annotation.data.handles },\r\n          cachedStats: { ...data.annotation.data.cachedStats },\r\n          label: data.annotation.data.label,\r\n          frameNumber,\r\n        },\r\n      });\r\n    }\r\n  );\r\n\r\n  measurementService.subscribe(\r\n    MEASUREMENT_REMOVED,\r\n    ({ source, measurement: removedMeasurementId }) => {\r\n      if (source?.name && source.name !== CORNERSTONE_3D_TOOLS_SOURCE_NAME) {\r\n        return;\r\n      }\r\n      removeAnnotation(removedMeasurementId);\r\n      const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n      // Note: We could do a better job by triggering the render on the\r\n      // viewport itself, but the removeAnnotation does not include that info...\r\n      renderingEngine.render();\r\n    }\r\n  );\r\n};\r\n\r\nexport {\r\n  initMeasurementService,\r\n  connectToolsToMeasurementService,\r\n  connectMeasurementServiceToTools,\r\n};\r\n","import { cache } from '@cornerstonejs/core';\r\nimport { utilities } from '@cornerstonejs/tools';\r\n\r\nfunction _getVolumesFromViewport(viewport) {\r\n  return viewport ? viewport.getActors().map(actor => cache.getVolume(actor.uid)) : [];\r\n}\r\n\r\nfunction _getVolumeFromViewport(viewport) {\r\n  const volumes = _getVolumesFromViewport(viewport).filter(volume => volume);\r\n  const dynamicVolume = volumes.find(volume => volume.isDynamicVolume());\r\n\r\n  return dynamicVolume ?? volumes[0];\r\n}\r\n\r\n/**\r\n * Return all viewports that needs to be synchronized with the source\r\n * viewport passed as parameter when cine is updated.\r\n * @param servicesManager ServiceManager\r\n * @param srcViewportIndex Source viewport index\r\n * @returns array with viewport information.\r\n */\r\nfunction _getSyncedViewports(servicesManager: AppTypes.ServicesManager, srcViewportId) {\r\n  const { viewportGridService, cornerstoneViewportService } = servicesManager.services;\r\n\r\n  const { viewports: viewportsStates } = viewportGridService.getState();\r\n  const srcViewportState = viewportsStates.get(srcViewportId);\r\n\r\n  if (srcViewportState?.viewportOptions?.viewportType !== 'volume') {\r\n    return [];\r\n  }\r\n\r\n  const srcViewport = cornerstoneViewportService.getCornerstoneViewport(srcViewportId);\r\n\r\n  const srcVolume = srcViewport ? _getVolumeFromViewport(srcViewport) : null;\r\n\r\n  if (!srcVolume?.isDynamicVolume()) {\r\n    return [];\r\n  }\r\n\r\n  const { volumeId: srcVolumeId } = srcVolume;\r\n\r\n  return Array.from(viewportsStates.values())\r\n    .filter(({ viewportId }) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n      return viewportId !== srcViewportId && viewport?.hasVolumeId(srcVolumeId);\r\n    })\r\n    .map(({ viewportId }) => ({ viewportId }));\r\n}\r\n\r\nfunction initCineService(servicesManager: AppTypes.ServicesManager) {\r\n  const { cineService } = servicesManager.services;\r\n\r\n  const getSyncedViewports = viewportId => {\r\n    return _getSyncedViewports(servicesManager, viewportId);\r\n  };\r\n\r\n  const playClip = (element, playClipOptions) => {\r\n    return utilities.cine.playClip(element, playClipOptions);\r\n  };\r\n\r\n  const stopClip = (element, stopClipOptions) => {\r\n    return utilities.cine.stopClip(element, stopClipOptions);\r\n  };\r\n\r\n  cineService.setServiceImplementation({\r\n    getSyncedViewports,\r\n    playClip,\r\n    stopClip,\r\n  });\r\n}\r\n\r\nexport default initCineService;\r\n","import { cache, imageLoadPoolManager, imageLoader, Enums, eventTarget, EVENTS as csEvents } from '@cornerstonejs/core';\r\n\r\nfunction initStudyPrefetcherService(servicesManager: AppTypes.ServicesManager) {\r\n  const { studyPrefetcherService } = servicesManager.services;\r\n\r\n  studyPrefetcherService.requestType = Enums.RequestType.Prefetch;\r\n  studyPrefetcherService.imageLoadPoolManager = imageLoadPoolManager;\r\n  studyPrefetcherService.imageLoader = imageLoader;\r\n\r\n  studyPrefetcherService.cache = {\r\n    isImageCached(imageId: string): boolean {\r\n      return !!cache.getImageLoadObject(imageId);\r\n    }\r\n  }\r\n\r\n  studyPrefetcherService.imageLoadEventsManager = {\r\n    addEventListeners(onImageLoaded, onImageLoadFailed) {\r\n      eventTarget.addEventListener(csEvents.IMAGE_LOADED, onImageLoaded);\r\n      eventTarget.addEventListener(csEvents.IMAGE_LOAD_FAILED, onImageLoadFailed);\r\n\r\n      return [\r\n        {\r\n          unsubscribe: () => eventTarget.removeEventListener(csEvents.IMAGE_LOADED, onImageLoaded)\r\n        },\r\n        {\r\n          unsubscribe: () => eventTarget.removeEventListener(csEvents.IMAGE_LOAD_FAILED, onImageLoadFailed)\r\n        },\r\n      ]\r\n    }\r\n  }\r\n}\r\n\r\nexport default initStudyPrefetcherService;\r\n","import { cache, imageLoadPoolManager, Enums } from '@cornerstonejs/core';\r\nimport getInterleavedFrames from './getInterleavedFrames';\r\nimport { compact, flatten, zip } from 'lodash';\r\n\r\n// Map of volumeId and SeriesInstanceId\r\nconst volumeIdMapsToLoad = new Map<string, string>();\r\nconst viewportIdVolumeInputArrayMap = new Map<string, unknown[]>();\r\n\r\n/**\r\n * This function caches the volumeUIDs until all the volumes inside the\r\n * hanging protocol are initialized. Then it goes through the imageIds\r\n * of the volumes, and interleave them, in order for the volumes to be loaded\r\n * together from middle to the start and the end.\r\n * @param {Object} props image loading properties from Cornerstone ViewportService\r\n * @returns\r\n */\r\nexport default function interleaveCenterLoader({\r\n  data: { viewportId, volumeInputArray },\r\n  displaySetsMatchDetails,\r\n  viewportMatchDetails: matchDetails,\r\n}) {\r\n  viewportIdVolumeInputArrayMap.set(viewportId, volumeInputArray);\r\n\r\n  // Based on the volumeInputs store the volumeIds and SeriesInstanceIds\r\n  // to keep track of the volumes being loaded\r\n  for (const volumeInput of volumeInputArray) {\r\n    const { volumeId } = volumeInput;\r\n    const volume = cache.getVolume(volumeId);\r\n\r\n    if (!volume) {\r\n      return;\r\n    }\r\n\r\n    // if the volumeUID is not in the volumeUIDs array, add it\r\n    if (!volumeIdMapsToLoad.has(volumeId)) {\r\n      const { metadata } = volume;\r\n      volumeIdMapsToLoad.set(volumeId, metadata.SeriesInstanceUID);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The following is checking if all the viewports that were matched in the HP has been\r\n   * successfully created their cornerstone viewport or not. Todo: This can be\r\n   * improved by not checking it, and as soon as the matched DisplaySets have their\r\n   * volume loaded, we start the loading, but that comes at the cost of viewports\r\n   * not being created yet (e.g., in a 10 viewport ptCT fusion, when one ct viewport and one\r\n   * pt viewport are created we have a guarantee that the volumes are created in the cache\r\n   * but the rest of the viewports (fusion, mip etc.) are not created yet. So\r\n   * we can't initiate setting the volumes for those viewports. One solution can be\r\n   * to add an event when a viewport is created (not enabled element event) and then\r\n   * listen to it and as the other viewports are created we can set the volumes for them\r\n   * since volumes are already started loading.\r\n   */\r\n  const uniqueViewportVolumeDisplaySetUIDs = new Set();\r\n  viewportIdVolumeInputArrayMap.forEach((volumeInputArray, viewportId) => {\r\n    volumeInputArray.forEach(volumeInput => {\r\n      const { volumeId } = volumeInput;\r\n      uniqueViewportVolumeDisplaySetUIDs.add(volumeId);\r\n    });\r\n  });\r\n\r\n  const uniqueMatchedDisplaySetUIDs = new Set();\r\n\r\n  matchDetails.forEach(matchDetail => {\r\n    const { displaySetsInfo } = matchDetail;\r\n    displaySetsInfo.forEach(({ displaySetInstanceUID }) => {\r\n      uniqueMatchedDisplaySetUIDs.add(displaySetInstanceUID);\r\n    });\r\n  });\r\n\r\n  if (uniqueViewportVolumeDisplaySetUIDs.size !== uniqueMatchedDisplaySetUIDs.size) {\r\n    return;\r\n  }\r\n\r\n  const volumeIds = Array.from(volumeIdMapsToLoad.keys()).slice();\r\n  // get volumes from cache\r\n  const volumes = volumeIds.map(volumeId => {\r\n    return cache.getVolume(volumeId);\r\n  });\r\n\r\n  // iterate over all volumes, and get their imageIds, and interleave\r\n  // the imageIds and save them in AllRequests for later use\r\n  const AllRequests = [];\r\n  volumes.forEach(volume => {\r\n    const requests = volume.getImageLoadRequests();\r\n\r\n    if (!requests.length || !requests[0] || !requests[0].imageId) {\r\n      return;\r\n    }\r\n\r\n    const requestImageIds = requests.map(request => {\r\n      return request.imageId;\r\n    });\r\n\r\n    const imageIds = getInterleavedFrames(requestImageIds);\r\n\r\n    const reOrderedRequests = imageIds.map(({ imageId }) => {\r\n      const request = requests.find(req => req.imageId === imageId);\r\n      return request;\r\n    });\r\n\r\n    AllRequests.push(reOrderedRequests);\r\n  });\r\n\r\n  // flatten the AllRequests array, which will result in a list of all the\r\n  // imageIds for all the volumes but interleaved\r\n  const interleavedRequests = compact(flatten(zip(...AllRequests)));\r\n\r\n  // set the finalRequests to the imageLoadPoolManager\r\n  const finalRequests = [];\r\n  interleavedRequests.forEach(request => {\r\n    const { imageId } = request;\r\n\r\n    AllRequests.forEach(volumeRequests => {\r\n      const volumeImageIdRequest = volumeRequests.find(req => req.imageId === imageId);\r\n      if (volumeImageIdRequest) {\r\n        finalRequests.push(volumeImageIdRequest);\r\n      }\r\n    });\r\n  });\r\n\r\n  const requestType = Enums.RequestType.Prefetch;\r\n  const priority = 0;\r\n\r\n  finalRequests.forEach(({ callLoadImage, additionalDetails, imageId, imageIdIndex, options }) => {\r\n    const callLoadImageBound = callLoadImage.bind(null, imageId, imageIdIndex, options);\r\n\r\n    imageLoadPoolManager.addRequest(callLoadImageBound, requestType, additionalDetails, priority);\r\n  });\r\n\r\n  // clear the volumeIdMapsToLoad\r\n  volumeIdMapsToLoad.clear();\r\n\r\n  // copy the viewportIdVolumeInputArrayMap\r\n  const viewportIdVolumeInputArrayMapCopy = new Map(viewportIdVolumeInputArrayMap);\r\n\r\n  // reset the viewportIdVolumeInputArrayMap\r\n  viewportIdVolumeInputArrayMap.clear();\r\n\r\n  return viewportIdVolumeInputArrayMapCopy;\r\n}\r\n","export default function getInterleavedFrames(imageIds) {\r\n  const minImageIdIndex = 0;\r\n  const maxImageIdIndex = imageIds.length - 1;\r\n\r\n  const middleImageIdIndex = Math.floor(imageIds.length / 2);\r\n\r\n  let lowerImageIdIndex = middleImageIdIndex;\r\n  let upperImageIdIndex = middleImageIdIndex;\r\n\r\n  // Build up an array of images to prefetch, starting with the current image.\r\n  const imageIdsToPrefetch = [\r\n    { imageId: imageIds[middleImageIdIndex], imageIdIndex: middleImageIdIndex },\r\n  ];\r\n\r\n  const prefetchQueuedFilled = {\r\n    currentPositionDownToMinimum: false,\r\n    currentPositionUpToMaximum: false,\r\n  };\r\n\r\n  // Check if on edges and some criteria is already fulfilled\r\n\r\n  if (middleImageIdIndex === minImageIdIndex) {\r\n    prefetchQueuedFilled.currentPositionDownToMinimum = true;\r\n  } else if (middleImageIdIndex === maxImageIdIndex) {\r\n    prefetchQueuedFilled.currentPositionUpToMaximum = true;\r\n  }\r\n\r\n  while (\r\n    !prefetchQueuedFilled.currentPositionDownToMinimum ||\r\n    !prefetchQueuedFilled.currentPositionUpToMaximum\r\n  ) {\r\n    if (!prefetchQueuedFilled.currentPositionDownToMinimum) {\r\n      // Add imageId below\r\n      lowerImageIdIndex--;\r\n      imageIdsToPrefetch.push({\r\n        imageId: imageIds[lowerImageIdIndex],\r\n        imageIdIndex: lowerImageIdIndex,\r\n      });\r\n\r\n      if (lowerImageIdIndex === minImageIdIndex) {\r\n        prefetchQueuedFilled.currentPositionDownToMinimum = true;\r\n      }\r\n    }\r\n\r\n    if (!prefetchQueuedFilled.currentPositionUpToMaximum) {\r\n      // Add imageId above\r\n      upperImageIdIndex++;\r\n      imageIdsToPrefetch.push({\r\n        imageId: imageIds[upperImageIdIndex],\r\n        imageIdIndex: upperImageIdIndex,\r\n      });\r\n\r\n      if (upperImageIdIndex === maxImageIdIndex) {\r\n        prefetchQueuedFilled.currentPositionUpToMaximum = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return imageIdsToPrefetch;\r\n}\r\n","import { cache, imageLoadPoolManager, Enums } from '@cornerstonejs/core';\r\nimport getNthFrames from './getNthFrames';\r\nimport interleave from './interleave';\r\n\r\n// Map of volumeId and SeriesInstanceId\r\nconst volumeIdMapsToLoad = new Map<string, string>();\r\nconst viewportIdVolumeInputArrayMap = new Map<string, unknown[]>();\r\n\r\n/**\r\n * This function caches the volumeUIDs until all the volumes inside the\r\n * hanging protocol are initialized. Then it goes through the requests and\r\n * chooses a sub-selection starting the the first few objects, center objects\r\n * and last objects, and then the remaining nth images until all instances are\r\n * retrieved.  This causes the image to have a progressive load order and looks\r\n * visually much better.\r\n * @param {Object} props image loading properties from Cornerstone ViewportService\r\n */\r\nexport default function interleaveNthLoader({\r\n  data: { viewportId, volumeInputArray },\r\n  displaySetsMatchDetails,\r\n}) {\r\n  viewportIdVolumeInputArrayMap.set(viewportId, volumeInputArray);\r\n\r\n  // Based on the volumeInputs store the volumeIds and SeriesInstanceIds\r\n  // to keep track of the volumes being loaded\r\n  for (const volumeInput of volumeInputArray) {\r\n    const { volumeId } = volumeInput;\r\n    const volume = cache.getVolume(volumeId);\r\n\r\n    if (!volume) {\r\n      console.log(\"interleaveNthLoader::No volume, can't load it\");\r\n      return;\r\n    }\r\n\r\n    // if the volumeUID is not in the volumeUIDs array, add it\r\n    if (!volumeIdMapsToLoad.has(volumeId)) {\r\n      const { metadata } = volume;\r\n      volumeIdMapsToLoad.set(volumeId, metadata.SeriesInstanceUID);\r\n    }\r\n  }\r\n\r\n  const volumeIds = Array.from(volumeIdMapsToLoad.keys()).slice();\r\n  // get volumes from cache\r\n  const volumes = volumeIds.map(volumeId => {\r\n    return cache.getVolume(volumeId);\r\n  });\r\n\r\n  // iterate over all volumes, and get their imageIds, and interleave\r\n  // the imageIds and save them in AllRequests for later use\r\n  const originalRequests = volumes\r\n    .map(volume => volume.getImageLoadRequests())\r\n    .filter(requests => requests?.[0]?.imageId);\r\n\r\n  const orderedRequests = originalRequests.map(request => getNthFrames(request));\r\n\r\n  // set the finalRequests to the imageLoadPoolManager\r\n  const finalRequests = interleave(orderedRequests);\r\n\r\n  const requestType = Enums.RequestType.Prefetch;\r\n  const priority = 0;\r\n\r\n  finalRequests.forEach(({ callLoadImage, additionalDetails, imageId, imageIdIndex, options }) => {\r\n    const callLoadImageBound = callLoadImage.bind(null, imageId, imageIdIndex, options);\r\n\r\n    imageLoadPoolManager.addRequest(callLoadImageBound, requestType, additionalDetails, priority);\r\n  });\r\n\r\n  // clear the volumeIdMapsToLoad\r\n  volumeIdMapsToLoad.clear();\r\n\r\n  // copy the viewportIdVolumeInputArrayMap\r\n  const viewportIdVolumeInputArrayMapCopy = new Map(viewportIdVolumeInputArrayMap);\r\n\r\n  // reset the viewportIdVolumeInputArrayMap\r\n  viewportIdVolumeInputArrayMap.clear();\r\n\r\n  return viewportIdVolumeInputArrayMapCopy;\r\n}\r\n","/**\r\n * Interleave the items from all the lists so that the first items are first\r\n * in the returned list, the second items are next etc.\r\n * Does this in a O(n) fashion, and return lists[0] if there is only one list.\r\n *\r\n * @param {[]} lists\r\n * @returns [] reordered to be breadth first traversal of lists\r\n */\r\nexport default function interleave(lists) {\r\n  if (!lists || !lists.length) {\r\n    return [];\r\n  }\r\n  if (lists.length === 1) {\r\n    return lists[0];\r\n  }\r\n  console.time('interleave');\r\n  const useLists = [...lists];\r\n  const ret = [];\r\n  for (let i = 0; useLists.length > 0; i++) {\r\n    for (const list of useLists) {\r\n      if (i >= list.length) {\r\n        useLists.splice(useLists.indexOf(list), 1);\r\n        continue;\r\n      }\r\n      ret.push(list[i]);\r\n    }\r\n  }\r\n  console.timeEnd('interleave');\r\n  return ret;\r\n}\r\n","/**\r\n * Returns a re-ordered array consisting of, in order:\r\n *    1. First few objects\r\n *    2. Center objects\r\n *    3. Last few objects\r\n *    4. nth Objects (n=7), set 2\r\n *    5. nth Objects set 5,\r\n *    6. Remaining objects\r\n * What this does is return the first/center/start objects, as those\r\n * are often used first, then a selection of objects scattered over the\r\n * instances in order to allow making requests over a set of image instances.\r\n *\r\n * @param {[]} imageIds\r\n * @returns [] reordered to be an nth selection\r\n */\r\nexport default function getNthFrames(imageIds) {\r\n  const frames = [[], [], [], [], []];\r\n  const centerStart = imageIds.length / 2 - 3;\r\n  const centerEnd = centerStart + 6;\r\n\r\n  for (let i = 0; i < imageIds.length; i++) {\r\n    if (i < 2 || i > imageIds.length - 4 || (i > centerStart && i < centerEnd)) {\r\n      frames[0].push(imageIds[i]);\r\n    } else if (i % 7 === 2) {\r\n      frames[1].push(imageIds[i]);\r\n    } else if (i % 7 === 5) {\r\n      frames[2].push(imageIds[i]);\r\n    } else {\r\n      frames[(i % 2) + 3].push(imageIds[i]);\r\n    }\r\n  }\r\n  const ret = [...frames[0], ...frames[1], ...frames[2], ...frames[3], ...frames[4]];\r\n  return ret;\r\n}\r\n","import { cache, imageLoadPoolManager, Enums } from '@cornerstonejs/core';\r\nimport { compact, flatten, zip } from 'lodash';\r\n\r\n// Map of volumeId and SeriesInstanceId\r\nconst volumeIdMapsToLoad = new Map<string, string>();\r\nconst viewportIdVolumeInputArrayMap = new Map<string, unknown[]>();\r\n\r\n/**\r\n * This function caches the volumeIds until all the volumes inside the\r\n * hanging protocol are initialized. Then it goes through the imageIds\r\n * of the volumes, and interleave them, in order for the volumes to be loaded\r\n * together from middle to the start and the end.\r\n * @param {Object} {viewportData, displaySetMatchDetails}\r\n * @returns\r\n */\r\nexport default function interleaveTopToBottom({\r\n  data: { viewportId, volumeInputArray },\r\n  displaySetsMatchDetails,\r\n  viewportMatchDetails: matchDetails,\r\n}) {\r\n  viewportIdVolumeInputArrayMap.set(viewportId, volumeInputArray);\r\n\r\n  // Based on the volumeInputs store the volumeIds and SeriesInstanceIds\r\n  // to keep track of the volumes being loaded\r\n  for (const volumeInput of volumeInputArray) {\r\n    const { volumeId } = volumeInput;\r\n    const volume = cache.getVolume(volumeId);\r\n\r\n    if (!volume) {\r\n      return;\r\n    }\r\n\r\n    // if the volumeUID is not in the volumeUIDs array, add it\r\n    if (!volumeIdMapsToLoad.has(volumeId)) {\r\n      const { metadata } = volume;\r\n      volumeIdMapsToLoad.set(volumeId, metadata.SeriesInstanceUID);\r\n    }\r\n  }\r\n\r\n  const filteredMatchDetails = [];\r\n  const displaySetsToLoad = new Set();\r\n\r\n  // Check all viewports that have a displaySet to be loaded. In some cases\r\n  // (eg: line chart viewports which is not a Cornerstone viewport) the\r\n  // displaySet is created on the client and there are no instances to be\r\n  // downloaded. For those viewports the displaySet may have the `skipLoading`\r\n  // option set to true otherwise it may block the download of all other\r\n  // instances resulting in blank viewports.\r\n  Array.from(matchDetails.values()).forEach(curMatchDetails => {\r\n    const { displaySetsInfo } = curMatchDetails;\r\n    let numDisplaySetsToLoad = 0;\r\n\r\n    displaySetsInfo.forEach(({ displaySetInstanceUID, displaySetOptions }) => {\r\n      if (!displaySetOptions?.options?.skipLoading) {\r\n        numDisplaySetsToLoad++;\r\n        displaySetsToLoad.add(displaySetInstanceUID);\r\n      }\r\n    });\r\n\r\n    if (numDisplaySetsToLoad) {\r\n      filteredMatchDetails.push(curMatchDetails);\r\n    }\r\n  });\r\n\r\n  /**\r\n   * The following is checking if all the viewports that were matched in the HP has been\r\n   * successfully created their cornerstone viewport or not. Todo: This can be\r\n   * improved by not checking it, and as soon as the matched DisplaySets have their\r\n   * volume loaded, we start the loading, but that comes at the cost of viewports\r\n   * not being created yet (e.g., in a 10 viewport ptCT fusion, when one ct viewport and one\r\n   * pt viewport are created we have a guarantee that the volumes are created in the cache\r\n   * but the rest of the viewports (fusion, mip etc.) are not created yet. So\r\n   * we can't initiate setting the volumes for those viewports. One solution can be\r\n   * to add an event when a viewport is created (not enabled element event) and then\r\n   * listen to it and as the other viewports are created we can set the volumes for them\r\n   * since volumes are already started loading.\r\n   */\r\n  const uniqueViewportVolumeDisplaySetUIDs = new Set();\r\n  viewportIdVolumeInputArrayMap.forEach((volumeInputArray, viewportId) => {\r\n    volumeInputArray.forEach(volumeInput => {\r\n      const { volumeId } = volumeInput;\r\n      uniqueViewportVolumeDisplaySetUIDs.add(volumeId);\r\n    });\r\n  });\r\n\r\n  const uniqueMatchedDisplaySetUIDs = new Set();\r\n\r\n  matchDetails.forEach(matchDetail => {\r\n    const { displaySetsInfo } = matchDetail;\r\n    displaySetsInfo.forEach(({ displaySetInstanceUID }) => {\r\n      uniqueMatchedDisplaySetUIDs.add(displaySetInstanceUID);\r\n    });\r\n  });\r\n\r\n  if (uniqueViewportVolumeDisplaySetUIDs.size !== uniqueMatchedDisplaySetUIDs.size) {\r\n    return;\r\n  }\r\n\r\n  const volumeIds = Array.from(volumeIdMapsToLoad.keys()).slice();\r\n  // get volumes from cache\r\n  const volumes = volumeIds.map(volumeId => {\r\n    return cache.getVolume(volumeId);\r\n  });\r\n\r\n  // iterate over all volumes, and get their imageIds, and interleave\r\n  // the imageIds and save them in AllRequests for later use\r\n  const AllRequests = [];\r\n  volumes.forEach(volume => {\r\n    const requests = volume.getImageLoadRequests();\r\n\r\n    if (!requests.length || !requests[0] || !requests[0].imageId) {\r\n      return;\r\n    }\r\n\r\n    // reverse the requests\r\n    AllRequests.push(requests.reverse());\r\n  });\r\n\r\n  // flatten the AllRequests array, which will result in a list of all the\r\n  // imageIds for all the volumes but interleaved\r\n  const interleavedRequests = compact(flatten(zip(...AllRequests)));\r\n\r\n  // set the finalRequests to the imageLoadPoolManager\r\n  const finalRequests = [];\r\n  interleavedRequests.forEach(request => {\r\n    const { imageId } = request;\r\n\r\n    AllRequests.forEach(volumeRequests => {\r\n      const volumeImageIdRequest = volumeRequests.find(req => req.imageId === imageId);\r\n      if (volumeImageIdRequest) {\r\n        finalRequests.push(volumeImageIdRequest);\r\n      }\r\n    });\r\n  });\r\n\r\n  const requestType = Enums.RequestType.Prefetch;\r\n  const priority = 0;\r\n\r\n  finalRequests.forEach(({ callLoadImage, additionalDetails, imageId, imageIdIndex, options }) => {\r\n    const callLoadImageBound = callLoadImage.bind(null, imageId, imageIdIndex, options);\r\n\r\n    imageLoadPoolManager.addRequest(callLoadImageBound, requestType, additionalDetails, priority);\r\n  });\r\n\r\n  // clear the volumeIdMapsToLoad\r\n  volumeIdMapsToLoad.clear();\r\n\r\n  // copy the viewportIdVolumeInputArrayMap\r\n  const viewportIdVolumeInputArrayMapCopy = new Map(viewportIdVolumeInputArrayMap);\r\n\r\n  // reset the viewportIdVolumeInputArrayMap\r\n  viewportIdVolumeInputArrayMap.clear();\r\n\r\n  return viewportIdVolumeInputArrayMapCopy;\r\n}\r\n","/**\r\n * Finds tool nearby event position triggered.\r\n *\r\n * @param {Object} commandsManager mannager of commands\r\n * @param {Object} event that has being triggered\r\n * @returns cs toolData or undefined if not found.\r\n */\r\nexport const findNearbyToolData = (commandsManager, evt) => {\r\n  if (!evt?.detail) {\r\n    return;\r\n  }\r\n  const { element, currentPoints } = evt.detail;\r\n  return commandsManager.runCommand(\r\n    'getNearbyAnnotation',\r\n    {\r\n      element,\r\n      canvasCoordinates: currentPoints?.canvas,\r\n    },\r\n    'CORNERSTONE'\r\n  );\r\n};\r\n","import { eventTarget, EVENTS } from '@cornerstonejs/core';\r\nimport { Enums } from '@cornerstonejs/tools';\r\nimport { setEnabledElement } from './state';\r\nimport { findNearbyToolData } from './utils/findNearbyToolData';\r\n\r\nconst cs3DToolsEvents = Enums.Events;\r\n\r\nconst DEFAULT_CONTEXT_MENU_CLICKS = {\r\n  button1: {\r\n    commands: [\r\n      {\r\n        commandName: 'closeContextMenu',\r\n      },\r\n    ],\r\n  },\r\n  button3: {\r\n    commands: [\r\n      {\r\n        commandName: 'showCornerstoneContextMenu',\r\n        commandOptions: {\r\n          requireNearbyToolData: true,\r\n          menuId: 'measurementsContextMenu',\r\n        },\r\n      },\r\n    ],\r\n  },\r\n};\r\n\r\n/**\r\n * Generates a name, consisting of:\r\n *    * alt when the alt key is down\r\n *    * ctrl when the cctrl key is down\r\n *    * shift when the shift key is down\r\n *    * 'button' followed by the button number (1 left, 3 right etc)\r\n */\r\nfunction getEventName(evt) {\r\n  const button = evt.detail.event.which;\r\n  const nameArr = [];\r\n  if (evt.detail.event.altKey) {\r\n    nameArr.push('alt');\r\n  }\r\n  if (evt.detail.event.ctrlKey) {\r\n    nameArr.push('ctrl');\r\n  }\r\n  if (evt.detail.event.shiftKey) {\r\n    nameArr.push('shift');\r\n  }\r\n  nameArr.push('button');\r\n  nameArr.push(button);\r\n  return nameArr.join('');\r\n}\r\n\r\nfunction initContextMenu({\r\n  cornerstoneViewportService,\r\n  customizationService,\r\n  commandsManager,\r\n}): void {\r\n  /*\r\n   * Run the commands associated with the given button press,\r\n   * defaults on button1 and button2\r\n   */\r\n  const cornerstoneViewportHandleEvent = (name, evt) => {\r\n    const customizations =\r\n      customizationService.get('cornerstoneViewportClickCommands') || DEFAULT_CONTEXT_MENU_CLICKS;\r\n    const toRun = customizations[name];\r\n\r\n    if (!toRun) {\r\n      return;\r\n    }\r\n\r\n    // only find nearbyToolData if required, for the click (which closes the context menu\r\n    // we don't need to find nearbyToolData)\r\n    let nearbyToolData = null;\r\n    if (toRun.commands.some(command => command.commandOptions?.requireNearbyToolData)) {\r\n      nearbyToolData = findNearbyToolData(commandsManager, evt);\r\n    }\r\n\r\n    const options = {\r\n      nearbyToolData,\r\n      event: evt,\r\n    };\r\n    commandsManager.run(toRun, options);\r\n  };\r\n\r\n  const cornerstoneViewportHandleClick = evt => {\r\n    const name = getEventName(evt);\r\n    cornerstoneViewportHandleEvent(name, evt);\r\n  };\r\n\r\n  function elementEnabledHandler(evt) {\r\n    const { viewportId, element } = evt.detail;\r\n    const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n    if (!viewportInfo) {\r\n      return;\r\n    }\r\n    // TODO check update upstream\r\n    setEnabledElement(viewportId, element);\r\n\r\n    element.addEventListener(cs3DToolsEvents.MOUSE_CLICK, cornerstoneViewportHandleClick);\r\n  }\r\n\r\n  function elementDisabledHandler(evt) {\r\n    const { element } = evt.detail;\r\n\r\n    element.removeEventListener(cs3DToolsEvents.MOUSE_CLICK, cornerstoneViewportHandleClick);\r\n  }\r\n\r\n  eventTarget.addEventListener(EVENTS.ELEMENT_ENABLED, elementEnabledHandler.bind(null));\r\n\r\n  eventTarget.addEventListener(EVENTS.ELEMENT_DISABLED, elementDisabledHandler.bind(null));\r\n}\r\n\r\nexport default initContextMenu;\r\n","import { eventTarget, EVENTS } from '@cornerstonejs/core';\r\nimport { Enums } from '@cornerstonejs/tools';\r\nimport { CommandsManager, CustomizationService, Types } from '@ohif/core';\r\nimport { findNearbyToolData } from './utils/findNearbyToolData';\r\n\r\n\r\nconst cs3DToolsEvents = Enums.Events;\r\n\r\nconst DEFAULT_DOUBLE_CLICK = {\r\n  doubleClick: {\r\n    commandName: 'toggleOneUp',\r\n    commandOptions: {},\r\n  },\r\n};\r\n\r\n/**\r\n * Generates a double click event name, consisting of:\r\n *    * alt when the alt key is down\r\n *    * ctrl when the cctrl key is down\r\n *    * shift when the shift key is down\r\n *    * 'doubleClick'\r\n */\r\nfunction getDoubleClickEventName(evt: CustomEvent) {\r\n  const nameArr = [];\r\n  if (evt.detail.event.altKey) {\r\n    nameArr.push('alt');\r\n  }\r\n  if (evt.detail.event.ctrlKey) {\r\n    nameArr.push('ctrl');\r\n  }\r\n  if (evt.detail.event.shiftKey) {\r\n    nameArr.push('shift');\r\n  }\r\n  nameArr.push('doubleClick');\r\n  return nameArr.join('');\r\n}\r\n\r\nexport type initDoubleClickArgs = {\r\n  customizationService: CustomizationService;\r\n  commandsManager: CommandsManager;\r\n};\r\n\r\nfunction initDoubleClick({ customizationService, commandsManager }: initDoubleClickArgs): void {\r\n  const cornerstoneViewportHandleDoubleClick = (evt: CustomEvent) => {\r\n    // Do not allow double click on a tool.\r\n    const nearbyToolData = findNearbyToolData(commandsManager, evt);\r\n    if (nearbyToolData) {\r\n      return;\r\n    }\r\n\r\n    const eventName = getDoubleClickEventName(evt);\r\n\r\n    // Allows for the customization of the double click on a viewport.\r\n    const customizations =\r\n      customizationService.get('cornerstoneViewportClickCommands') || DEFAULT_DOUBLE_CLICK;\r\n\r\n    const toRun = customizations[eventName];\r\n    console.log('toRun', toRun, customizations, eventName)\r\n\r\n    if (!toRun) {\r\n      return;\r\n    }\r\n\r\n    commandsManager.run(toRun);\r\n  };\r\n\r\n  function elementEnabledHandler(evt: CustomEvent) {\r\n    const { element } = evt.detail;\r\n\r\n    element.addEventListener(\r\n      cs3DToolsEvents.MOUSE_DOUBLE_CLICK,\r\n      cornerstoneViewportHandleDoubleClick\r\n    );\r\n  }\r\n\r\n  function elementDisabledHandler(evt: CustomEvent) {\r\n    const { element } = evt.detail;\r\n\r\n    element.removeEventListener(\r\n      cs3DToolsEvents.MOUSE_DOUBLE_CLICK,\r\n      cornerstoneViewportHandleDoubleClick\r\n    );\r\n  }\r\n\r\n  eventTarget.addEventListener(EVENTS.ELEMENT_ENABLED, elementEnabledHandler.bind(null));\r\n\r\n  eventTarget.addEventListener(EVENTS.ELEMENT_DISABLED, elementDisabledHandler.bind(null));\r\n}\r\n\r\nexport default initDoubleClick;\r\n","import { log, Enums } from '@ohif/core';\r\nimport { EVENTS } from '@cornerstonejs/core';\r\n\r\nconst IMAGE_TIMING_KEYS = [];\r\n\r\nconst imageTiming = {\r\n  viewportsWaiting: 0,\r\n};\r\n\r\n/**\r\n * Defines the initial view timing reporting.\r\n * This allows knowing how many viewports are waiting for initial views and\r\n * when the IMAGE_RENDERED gets sent out.\r\n * The first image rendered will fire the FIRST_IMAGE timeEnd logs, while\r\n * the last of the enabled viewport will fire the ALL_IMAGES timeEnd logs.\r\n *\r\n */\r\n\r\nexport default function initViewTiming({ element }) {\r\n  if (!IMAGE_TIMING_KEYS.length) {\r\n    // Work around a bug in WebPack that doesn't getting the enums initialized\r\n    // quite fast enough to be declared statically.\r\n    const { TimingEnum } = Enums;\r\n\r\n    IMAGE_TIMING_KEYS.push(\r\n      TimingEnum.DISPLAY_SETS_TO_ALL_IMAGES,\r\n      TimingEnum.DISPLAY_SETS_TO_FIRST_IMAGE,\r\n      TimingEnum.STUDY_TO_FIRST_IMAGE,\r\n    );\r\n  }\r\n\r\n  if (!IMAGE_TIMING_KEYS.find(key => log.timingKeys[key])) {\r\n    return;\r\n  }\r\n  imageTiming.viewportsWaiting += 1;\r\n  element.addEventListener(EVENTS.IMAGE_RENDERED, imageRenderedListener);\r\n}\r\n\r\nfunction imageRenderedListener(evt) {\r\n  if (evt.detail.viewportStatus === 'preRender') {\r\n    return;\r\n  }\r\n  const { TimingEnum } = Enums;\r\n  log.timeEnd(TimingEnum.DISPLAY_SETS_TO_FIRST_IMAGE);\r\n  log.timeEnd(TimingEnum.STUDY_TO_FIRST_IMAGE);\r\n  log.timeEnd(TimingEnum.SCRIPT_TO_VIEW);\r\n  imageTiming.viewportsWaiting -= 1;\r\n  evt.detail.element.removeEventListener(EVENTS.IMAGE_RENDERED, imageRenderedListener);\r\n  if (!imageTiming.viewportsWaiting) {\r\n    log.timeEnd(TimingEnum.DISPLAY_SETS_TO_ALL_IMAGES);\r\n  }\r\n}\r\n","const colormaps = [\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'Grayscale',\r\n    name: 'Grayscale',\r\n    NanColor: [1, 0, 0],\r\n    RGBPoints: [0, 0, 0, 0, 1, 1, 1, 1],\r\n    description: 'Grayscale',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'X Ray',\r\n    name: 'X Ray',\r\n    NanColor: [1, 0, 0],\r\n    RGBPoints: [0, 1, 1, 1, 1, 0, 0, 0],\r\n    description: 'X Ray',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'hsv',\r\n    name: 'hsv',\r\n    RGBPoints: [\r\n      -1, 1, 0, 0, -0.666666, 1, 0, 1, -0.333333, 0, 0, 1, 0, 0, 1, 1, 0.33333, 0, 1, 0, 0.66666, 1,\r\n      1, 0, 1, 1, 0, 0,\r\n    ],\r\n    description: 'HSV',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'hot_iron',\r\n    name: 'hot_iron',\r\n    RGBPoints: [\r\n      0.0, 0.0039215686, 0.0039215686, 0.0156862745, 0.00392156862745098, 0.0039215686,\r\n      0.0039215686, 0.0156862745, 0.00784313725490196, 0.0039215686, 0.0039215686, 0.031372549,\r\n      0.011764705882352941, 0.0039215686, 0.0039215686, 0.0470588235, 0.01568627450980392,\r\n      0.0039215686, 0.0039215686, 0.062745098, 0.0196078431372549, 0.0039215686, 0.0039215686,\r\n      0.0784313725, 0.023529411764705882, 0.0039215686, 0.0039215686, 0.0941176471,\r\n      0.027450980392156862, 0.0039215686, 0.0039215686, 0.1098039216, 0.03137254901960784,\r\n      0.0039215686, 0.0039215686, 0.1254901961, 0.03529411764705882, 0.0039215686, 0.0039215686,\r\n      0.1411764706, 0.0392156862745098, 0.0039215686, 0.0039215686, 0.1568627451,\r\n      0.043137254901960784, 0.0039215686, 0.0039215686, 0.1725490196, 0.047058823529411764,\r\n      0.0039215686, 0.0039215686, 0.1882352941, 0.050980392156862744, 0.0039215686, 0.0039215686,\r\n      0.2039215686, 0.054901960784313725, 0.0039215686, 0.0039215686, 0.2196078431,\r\n      0.05882352941176471, 0.0039215686, 0.0039215686, 0.2352941176, 0.06274509803921569,\r\n      0.0039215686, 0.0039215686, 0.2509803922, 0.06666666666666667, 0.0039215686, 0.0039215686,\r\n      0.262745098, 0.07058823529411765, 0.0039215686, 0.0039215686, 0.2784313725,\r\n      0.07450980392156863, 0.0039215686, 0.0039215686, 0.2941176471, 0.0784313725490196,\r\n      0.0039215686, 0.0039215686, 0.3098039216, 0.08235294117647059, 0.0039215686, 0.0039215686,\r\n      0.3254901961, 0.08627450980392157, 0.0039215686, 0.0039215686, 0.3411764706,\r\n      0.09019607843137255, 0.0039215686, 0.0039215686, 0.3568627451, 0.09411764705882353,\r\n      0.0039215686, 0.0039215686, 0.3725490196, 0.09803921568627451, 0.0039215686, 0.0039215686,\r\n      0.3882352941, 0.10196078431372549, 0.0039215686, 0.0039215686, 0.4039215686,\r\n      0.10588235294117647, 0.0039215686, 0.0039215686, 0.4196078431, 0.10980392156862745,\r\n      0.0039215686, 0.0039215686, 0.4352941176, 0.11372549019607843, 0.0039215686, 0.0039215686,\r\n      0.4509803922, 0.11764705882352942, 0.0039215686, 0.0039215686, 0.4666666667,\r\n      0.12156862745098039, 0.0039215686, 0.0039215686, 0.4823529412, 0.12549019607843137,\r\n      0.0039215686, 0.0039215686, 0.4980392157, 0.12941176470588237, 0.0039215686, 0.0039215686,\r\n      0.5137254902, 0.13333333333333333, 0.0039215686, 0.0039215686, 0.5294117647,\r\n      0.13725490196078433, 0.0039215686, 0.0039215686, 0.5450980392, 0.1411764705882353,\r\n      0.0039215686, 0.0039215686, 0.5607843137, 0.1450980392156863, 0.0039215686, 0.0039215686,\r\n      0.5764705882, 0.14901960784313725, 0.0039215686, 0.0039215686, 0.5921568627,\r\n      0.15294117647058825, 0.0039215686, 0.0039215686, 0.6078431373, 0.1568627450980392,\r\n      0.0039215686, 0.0039215686, 0.6235294118, 0.1607843137254902, 0.0039215686, 0.0039215686,\r\n      0.6392156863, 0.16470588235294117, 0.0039215686, 0.0039215686, 0.6549019608,\r\n      0.16862745098039217, 0.0039215686, 0.0039215686, 0.6705882353, 0.17254901960784313,\r\n      0.0039215686, 0.0039215686, 0.6862745098, 0.17647058823529413, 0.0039215686, 0.0039215686,\r\n      0.7019607843, 0.1803921568627451, 0.0039215686, 0.0039215686, 0.7176470588,\r\n      0.1843137254901961, 0.0039215686, 0.0039215686, 0.7333333333, 0.18823529411764706,\r\n      0.0039215686, 0.0039215686, 0.7490196078, 0.19215686274509805, 0.0039215686, 0.0039215686,\r\n      0.7607843137, 0.19607843137254902, 0.0039215686, 0.0039215686, 0.7764705882, 0.2,\r\n      0.0039215686, 0.0039215686, 0.7921568627, 0.20392156862745098, 0.0039215686, 0.0039215686,\r\n      0.8078431373, 0.20784313725490197, 0.0039215686, 0.0039215686, 0.8235294118,\r\n      0.21176470588235294, 0.0039215686, 0.0039215686, 0.8392156863, 0.21568627450980393,\r\n      0.0039215686, 0.0039215686, 0.8549019608, 0.2196078431372549, 0.0039215686, 0.0039215686,\r\n      0.8705882353, 0.2235294117647059, 0.0039215686, 0.0039215686, 0.8862745098,\r\n      0.22745098039215686, 0.0039215686, 0.0039215686, 0.9019607843, 0.23137254901960785,\r\n      0.0039215686, 0.0039215686, 0.9176470588, 0.23529411764705885, 0.0039215686, 0.0039215686,\r\n      0.9333333333, 0.23921568627450984, 0.0039215686, 0.0039215686, 0.9490196078,\r\n      0.24313725490196078, 0.0039215686, 0.0039215686, 0.9647058824, 0.24705882352941178,\r\n      0.0039215686, 0.0039215686, 0.9803921569, 0.25098039215686274, 0.0039215686, 0.0039215686,\r\n      0.9960784314, 0.2549019607843137, 0.0039215686, 0.0039215686, 0.9960784314,\r\n      0.25882352941176473, 0.0156862745, 0.0039215686, 0.9803921569, 0.2627450980392157,\r\n      0.031372549, 0.0039215686, 0.9647058824, 0.26666666666666666, 0.0470588235, 0.0039215686,\r\n      0.9490196078, 0.27058823529411763, 0.062745098, 0.0039215686, 0.9333333333,\r\n      0.27450980392156865, 0.0784313725, 0.0039215686, 0.9176470588, 0.2784313725490196,\r\n      0.0941176471, 0.0039215686, 0.9019607843, 0.2823529411764706, 0.1098039216, 0.0039215686,\r\n      0.8862745098, 0.28627450980392155, 0.1254901961, 0.0039215686, 0.8705882353,\r\n      0.2901960784313726, 0.1411764706, 0.0039215686, 0.8549019608, 0.29411764705882354,\r\n      0.1568627451, 0.0039215686, 0.8392156863, 0.2980392156862745, 0.1725490196, 0.0039215686,\r\n      0.8235294118, 0.30196078431372547, 0.1882352941, 0.0039215686, 0.8078431373,\r\n      0.3058823529411765, 0.2039215686, 0.0039215686, 0.7921568627, 0.30980392156862746,\r\n      0.2196078431, 0.0039215686, 0.7764705882, 0.3137254901960784, 0.2352941176, 0.0039215686,\r\n      0.7607843137, 0.3176470588235294, 0.2509803922, 0.0039215686, 0.7490196078,\r\n      0.3215686274509804, 0.262745098, 0.0039215686, 0.7333333333, 0.3254901960784314, 0.2784313725,\r\n      0.0039215686, 0.7176470588, 0.32941176470588235, 0.2941176471, 0.0039215686, 0.7019607843,\r\n      0.3333333333333333, 0.3098039216, 0.0039215686, 0.6862745098, 0.33725490196078434,\r\n      0.3254901961, 0.0039215686, 0.6705882353, 0.3411764705882353, 0.3411764706, 0.0039215686,\r\n      0.6549019608, 0.34509803921568627, 0.3568627451, 0.0039215686, 0.6392156863,\r\n      0.34901960784313724, 0.3725490196, 0.0039215686, 0.6235294118, 0.35294117647058826,\r\n      0.3882352941, 0.0039215686, 0.6078431373, 0.3568627450980392, 0.4039215686, 0.0039215686,\r\n      0.5921568627, 0.3607843137254902, 0.4196078431, 0.0039215686, 0.5764705882,\r\n      0.36470588235294116, 0.4352941176, 0.0039215686, 0.5607843137, 0.3686274509803922,\r\n      0.4509803922, 0.0039215686, 0.5450980392, 0.37254901960784315, 0.4666666667, 0.0039215686,\r\n      0.5294117647, 0.3764705882352941, 0.4823529412, 0.0039215686, 0.5137254902,\r\n      0.3803921568627451, 0.4980392157, 0.0039215686, 0.4980392157, 0.3843137254901961,\r\n      0.5137254902, 0.0039215686, 0.4823529412, 0.38823529411764707, 0.5294117647, 0.0039215686,\r\n      0.4666666667, 0.39215686274509803, 0.5450980392, 0.0039215686, 0.4509803922,\r\n      0.396078431372549, 0.5607843137, 0.0039215686, 0.4352941176, 0.4, 0.5764705882, 0.0039215686,\r\n      0.4196078431, 0.403921568627451, 0.5921568627, 0.0039215686, 0.4039215686,\r\n      0.40784313725490196, 0.6078431373, 0.0039215686, 0.3882352941, 0.4117647058823529,\r\n      0.6235294118, 0.0039215686, 0.3725490196, 0.41568627450980394, 0.6392156863, 0.0039215686,\r\n      0.3568627451, 0.4196078431372549, 0.6549019608, 0.0039215686, 0.3411764706,\r\n      0.4235294117647059, 0.6705882353, 0.0039215686, 0.3254901961, 0.42745098039215684,\r\n      0.6862745098, 0.0039215686, 0.3098039216, 0.43137254901960786, 0.7019607843, 0.0039215686,\r\n      0.2941176471, 0.43529411764705883, 0.7176470588, 0.0039215686, 0.2784313725,\r\n      0.4392156862745098, 0.7333333333, 0.0039215686, 0.262745098, 0.44313725490196076,\r\n      0.7490196078, 0.0039215686, 0.2509803922, 0.4470588235294118, 0.7607843137, 0.0039215686,\r\n      0.2352941176, 0.45098039215686275, 0.7764705882, 0.0039215686, 0.2196078431,\r\n      0.4549019607843137, 0.7921568627, 0.0039215686, 0.2039215686, 0.4588235294117647,\r\n      0.8078431373, 0.0039215686, 0.1882352941, 0.4627450980392157, 0.8235294118, 0.0039215686,\r\n      0.1725490196, 0.4666666666666667, 0.8392156863, 0.0039215686, 0.1568627451,\r\n      0.4705882352941177, 0.8549019608, 0.0039215686, 0.1411764706, 0.4745098039215686,\r\n      0.8705882353, 0.0039215686, 0.1254901961, 0.4784313725490197, 0.8862745098, 0.0039215686,\r\n      0.1098039216, 0.48235294117647065, 0.9019607843, 0.0039215686, 0.0941176471,\r\n      0.48627450980392156, 0.9176470588, 0.0039215686, 0.0784313725, 0.49019607843137253,\r\n      0.9333333333, 0.0039215686, 0.062745098, 0.49411764705882355, 0.9490196078, 0.0039215686,\r\n      0.0470588235, 0.4980392156862745, 0.9647058824, 0.0039215686, 0.031372549, 0.5019607843137255,\r\n      0.9803921569, 0.0039215686, 0.0156862745, 0.5058823529411764, 0.9960784314, 0.0039215686,\r\n      0.0039215686, 0.5098039215686274, 0.9960784314, 0.0156862745, 0.0039215686,\r\n      0.5137254901960784, 0.9960784314, 0.031372549, 0.0039215686, 0.5176470588235295, 0.9960784314,\r\n      0.0470588235, 0.0039215686, 0.5215686274509804, 0.9960784314, 0.062745098, 0.0039215686,\r\n      0.5254901960784314, 0.9960784314, 0.0784313725, 0.0039215686, 0.5294117647058824,\r\n      0.9960784314, 0.0941176471, 0.0039215686, 0.5333333333333333, 0.9960784314, 0.1098039216,\r\n      0.0039215686, 0.5372549019607843, 0.9960784314, 0.1254901961, 0.0039215686,\r\n      0.5411764705882353, 0.9960784314, 0.1411764706, 0.0039215686, 0.5450980392156862,\r\n      0.9960784314, 0.1568627451, 0.0039215686, 0.5490196078431373, 0.9960784314, 0.1725490196,\r\n      0.0039215686, 0.5529411764705883, 0.9960784314, 0.1882352941, 0.0039215686,\r\n      0.5568627450980392, 0.9960784314, 0.2039215686, 0.0039215686, 0.5607843137254902,\r\n      0.9960784314, 0.2196078431, 0.0039215686, 0.5647058823529412, 0.9960784314, 0.2352941176,\r\n      0.0039215686, 0.5686274509803921, 0.9960784314, 0.2509803922, 0.0039215686,\r\n      0.5725490196078431, 0.9960784314, 0.262745098, 0.0039215686, 0.5764705882352941, 0.9960784314,\r\n      0.2784313725, 0.0039215686, 0.5803921568627451, 0.9960784314, 0.2941176471, 0.0039215686,\r\n      0.5843137254901961, 0.9960784314, 0.3098039216, 0.0039215686, 0.5882352941176471,\r\n      0.9960784314, 0.3254901961, 0.0039215686, 0.592156862745098, 0.9960784314, 0.3411764706,\r\n      0.0039215686, 0.596078431372549, 0.9960784314, 0.3568627451, 0.0039215686, 0.6, 0.9960784314,\r\n      0.3725490196, 0.0039215686, 0.6039215686274509, 0.9960784314, 0.3882352941, 0.0039215686,\r\n      0.6078431372549019, 0.9960784314, 0.4039215686, 0.0039215686, 0.611764705882353, 0.9960784314,\r\n      0.4196078431, 0.0039215686, 0.615686274509804, 0.9960784314, 0.4352941176, 0.0039215686,\r\n      0.6196078431372549, 0.9960784314, 0.4509803922, 0.0039215686, 0.6235294117647059,\r\n      0.9960784314, 0.4666666667, 0.0039215686, 0.6274509803921569, 0.9960784314, 0.4823529412,\r\n      0.0039215686, 0.6313725490196078, 0.9960784314, 0.4980392157, 0.0039215686,\r\n      0.6352941176470588, 0.9960784314, 0.5137254902, 0.0039215686, 0.6392156862745098,\r\n      0.9960784314, 0.5294117647, 0.0039215686, 0.6431372549019608, 0.9960784314, 0.5450980392,\r\n      0.0039215686, 0.6470588235294118, 0.9960784314, 0.5607843137, 0.0039215686,\r\n      0.6509803921568628, 0.9960784314, 0.5764705882, 0.0039215686, 0.6549019607843137,\r\n      0.9960784314, 0.5921568627, 0.0039215686, 0.6588235294117647, 0.9960784314, 0.6078431373,\r\n      0.0039215686, 0.6627450980392157, 0.9960784314, 0.6235294118, 0.0039215686,\r\n      0.6666666666666666, 0.9960784314, 0.6392156863, 0.0039215686, 0.6705882352941176,\r\n      0.9960784314, 0.6549019608, 0.0039215686, 0.6745098039215687, 0.9960784314, 0.6705882353,\r\n      0.0039215686, 0.6784313725490196, 0.9960784314, 0.6862745098, 0.0039215686,\r\n      0.6823529411764706, 0.9960784314, 0.7019607843, 0.0039215686, 0.6862745098039216,\r\n      0.9960784314, 0.7176470588, 0.0039215686, 0.6901960784313725, 0.9960784314, 0.7333333333,\r\n      0.0039215686, 0.6941176470588235, 0.9960784314, 0.7490196078, 0.0039215686,\r\n      0.6980392156862745, 0.9960784314, 0.7607843137, 0.0039215686, 0.7019607843137254,\r\n      0.9960784314, 0.7764705882, 0.0039215686, 0.7058823529411765, 0.9960784314, 0.7921568627,\r\n      0.0039215686, 0.7098039215686275, 0.9960784314, 0.8078431373, 0.0039215686,\r\n      0.7137254901960784, 0.9960784314, 0.8235294118, 0.0039215686, 0.7176470588235294,\r\n      0.9960784314, 0.8392156863, 0.0039215686, 0.7215686274509804, 0.9960784314, 0.8549019608,\r\n      0.0039215686, 0.7254901960784313, 0.9960784314, 0.8705882353, 0.0039215686,\r\n      0.7294117647058823, 0.9960784314, 0.8862745098, 0.0039215686, 0.7333333333333333,\r\n      0.9960784314, 0.9019607843, 0.0039215686, 0.7372549019607844, 0.9960784314, 0.9176470588,\r\n      0.0039215686, 0.7411764705882353, 0.9960784314, 0.9333333333, 0.0039215686,\r\n      0.7450980392156863, 0.9960784314, 0.9490196078, 0.0039215686, 0.7490196078431373,\r\n      0.9960784314, 0.9647058824, 0.0039215686, 0.7529411764705882, 0.9960784314, 0.9803921569,\r\n      0.0039215686, 0.7568627450980392, 0.9960784314, 0.9960784314, 0.0039215686,\r\n      0.7607843137254902, 0.9960784314, 0.9960784314, 0.0196078431, 0.7647058823529411,\r\n      0.9960784314, 0.9960784314, 0.0352941176, 0.7686274509803922, 0.9960784314, 0.9960784314,\r\n      0.0509803922, 0.7725490196078432, 0.9960784314, 0.9960784314, 0.0666666667,\r\n      0.7764705882352941, 0.9960784314, 0.9960784314, 0.0823529412, 0.7803921568627451,\r\n      0.9960784314, 0.9960784314, 0.0980392157, 0.7843137254901961, 0.9960784314, 0.9960784314,\r\n      0.1137254902, 0.788235294117647, 0.9960784314, 0.9960784314, 0.1294117647, 0.792156862745098,\r\n      0.9960784314, 0.9960784314, 0.1450980392, 0.796078431372549, 0.9960784314, 0.9960784314,\r\n      0.1607843137, 0.8, 0.9960784314, 0.9960784314, 0.1764705882, 0.803921568627451, 0.9960784314,\r\n      0.9960784314, 0.1921568627, 0.807843137254902, 0.9960784314, 0.9960784314, 0.2078431373,\r\n      0.8117647058823529, 0.9960784314, 0.9960784314, 0.2235294118, 0.8156862745098039,\r\n      0.9960784314, 0.9960784314, 0.2392156863, 0.8196078431372549, 0.9960784314, 0.9960784314,\r\n      0.2509803922, 0.8235294117647058, 0.9960784314, 0.9960784314, 0.2666666667,\r\n      0.8274509803921568, 0.9960784314, 0.9960784314, 0.2823529412, 0.8313725490196079,\r\n      0.9960784314, 0.9960784314, 0.2980392157, 0.8352941176470589, 0.9960784314, 0.9960784314,\r\n      0.3137254902, 0.8392156862745098, 0.9960784314, 0.9960784314, 0.3333333333,\r\n      0.8431372549019608, 0.9960784314, 0.9960784314, 0.3490196078, 0.8470588235294118,\r\n      0.9960784314, 0.9960784314, 0.3647058824, 0.8509803921568627, 0.9960784314, 0.9960784314,\r\n      0.3803921569, 0.8549019607843137, 0.9960784314, 0.9960784314, 0.3960784314,\r\n      0.8588235294117647, 0.9960784314, 0.9960784314, 0.4117647059, 0.8627450980392157,\r\n      0.9960784314, 0.9960784314, 0.4274509804, 0.8666666666666667, 0.9960784314, 0.9960784314,\r\n      0.4431372549, 0.8705882352941177, 0.9960784314, 0.9960784314, 0.4588235294,\r\n      0.8745098039215686, 0.9960784314, 0.9960784314, 0.4745098039, 0.8784313725490196,\r\n      0.9960784314, 0.9960784314, 0.4901960784, 0.8823529411764706, 0.9960784314, 0.9960784314,\r\n      0.5058823529, 0.8862745098039215, 0.9960784314, 0.9960784314, 0.5215686275,\r\n      0.8901960784313725, 0.9960784314, 0.9960784314, 0.537254902, 0.8941176470588236, 0.9960784314,\r\n      0.9960784314, 0.5529411765, 0.8980392156862745, 0.9960784314, 0.9960784314, 0.568627451,\r\n      0.9019607843137255, 0.9960784314, 0.9960784314, 0.5843137255, 0.9058823529411765,\r\n      0.9960784314, 0.9960784314, 0.6, 0.9098039215686274, 0.9960784314, 0.9960784314, 0.6156862745,\r\n      0.9137254901960784, 0.9960784314, 0.9960784314, 0.631372549, 0.9176470588235294, 0.9960784314,\r\n      0.9960784314, 0.6470588235, 0.9215686274509803, 0.9960784314, 0.9960784314, 0.6666666667,\r\n      0.9254901960784314, 0.9960784314, 0.9960784314, 0.6823529412, 0.9294117647058824,\r\n      0.9960784314, 0.9960784314, 0.6980392157, 0.9333333333333333, 0.9960784314, 0.9960784314,\r\n      0.7137254902, 0.9372549019607843, 0.9960784314, 0.9960784314, 0.7294117647,\r\n      0.9411764705882354, 0.9960784314, 0.9960784314, 0.7450980392, 0.9450980392156864,\r\n      0.9960784314, 0.9960784314, 0.7568627451, 0.9490196078431372, 0.9960784314, 0.9960784314,\r\n      0.7725490196, 0.9529411764705882, 0.9960784314, 0.9960784314, 0.7882352941,\r\n      0.9568627450980394, 0.9960784314, 0.9960784314, 0.8039215686, 0.9607843137254903,\r\n      0.9960784314, 0.9960784314, 0.8196078431, 0.9647058823529413, 0.9960784314, 0.9960784314,\r\n      0.8352941176, 0.9686274509803922, 0.9960784314, 0.9960784314, 0.8509803922,\r\n      0.9725490196078431, 0.9960784314, 0.9960784314, 0.8666666667, 0.9764705882352941,\r\n      0.9960784314, 0.9960784314, 0.8823529412, 0.9803921568627451, 0.9960784314, 0.9960784314,\r\n      0.8980392157, 0.984313725490196, 0.9960784314, 0.9960784314, 0.9137254902, 0.9882352941176471,\r\n      0.9960784314, 0.9960784314, 0.9294117647, 0.9921568627450981, 0.9960784314, 0.9960784314,\r\n      0.9450980392, 0.996078431372549, 0.9960784314, 0.9960784314, 0.9607843137, 1.0, 0.9960784314,\r\n      0.9960784314, 0.9607843137,\r\n    ],\r\n    description: 'Hot Iron',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'red_hot',\r\n    name: 'red_hot',\r\n    RGBPoints: [\r\n      0.0, 0.0, 0.0, 0.0, 0.00392156862745098, 0.0, 0.0, 0.0, 0.00784313725490196, 0.0, 0.0, 0.0,\r\n      0.011764705882352941, 0.0, 0.0, 0.0, 0.01568627450980392, 0.0039215686, 0.0039215686,\r\n      0.0039215686, 0.0196078431372549, 0.0039215686, 0.0039215686, 0.0039215686,\r\n      0.023529411764705882, 0.0039215686, 0.0039215686, 0.0039215686, 0.027450980392156862,\r\n      0.0039215686, 0.0039215686, 0.0039215686, 0.03137254901960784, 0.0039215686, 0.0039215686,\r\n      0.0039215686, 0.03529411764705882, 0.0156862745, 0.0, 0.0, 0.0392156862745098, 0.0274509804,\r\n      0.0, 0.0, 0.043137254901960784, 0.0392156863, 0.0, 0.0, 0.047058823529411764, 0.0509803922,\r\n      0.0, 0.0, 0.050980392156862744, 0.062745098, 0.0, 0.0, 0.054901960784313725, 0.0784313725,\r\n      0.0, 0.0, 0.05882352941176471, 0.0901960784, 0.0, 0.0, 0.06274509803921569, 0.1058823529, 0.0,\r\n      0.0, 0.06666666666666667, 0.1176470588, 0.0, 0.0, 0.07058823529411765, 0.1294117647, 0.0, 0.0,\r\n      0.07450980392156863, 0.1411764706, 0.0, 0.0, 0.0784313725490196, 0.1529411765, 0.0, 0.0,\r\n      0.08235294117647059, 0.1647058824, 0.0, 0.0, 0.08627450980392157, 0.1764705882, 0.0, 0.0,\r\n      0.09019607843137255, 0.1882352941, 0.0, 0.0, 0.09411764705882353, 0.2039215686, 0.0, 0.0,\r\n      0.09803921568627451, 0.2156862745, 0.0, 0.0, 0.10196078431372549, 0.2274509804, 0.0, 0.0,\r\n      0.10588235294117647, 0.2392156863, 0.0, 0.0, 0.10980392156862745, 0.2549019608, 0.0, 0.0,\r\n      0.11372549019607843, 0.2666666667, 0.0, 0.0, 0.11764705882352942, 0.2784313725, 0.0, 0.0,\r\n      0.12156862745098039, 0.2901960784, 0.0, 0.0, 0.12549019607843137, 0.3058823529, 0.0, 0.0,\r\n      0.12941176470588237, 0.3176470588, 0.0, 0.0, 0.13333333333333333, 0.3294117647, 0.0, 0.0,\r\n      0.13725490196078433, 0.3411764706, 0.0, 0.0, 0.1411764705882353, 0.3529411765, 0.0, 0.0,\r\n      0.1450980392156863, 0.3647058824, 0.0, 0.0, 0.14901960784313725, 0.3764705882, 0.0, 0.0,\r\n      0.15294117647058825, 0.3882352941, 0.0, 0.0, 0.1568627450980392, 0.4039215686, 0.0, 0.0,\r\n      0.1607843137254902, 0.4156862745, 0.0, 0.0, 0.16470588235294117, 0.431372549, 0.0, 0.0,\r\n      0.16862745098039217, 0.4431372549, 0.0, 0.0, 0.17254901960784313, 0.4588235294, 0.0, 0.0,\r\n      0.17647058823529413, 0.4705882353, 0.0, 0.0, 0.1803921568627451, 0.4823529412, 0.0, 0.0,\r\n      0.1843137254901961, 0.4941176471, 0.0, 0.0, 0.18823529411764706, 0.5098039216, 0.0, 0.0,\r\n      0.19215686274509805, 0.5215686275, 0.0, 0.0, 0.19607843137254902, 0.5333333333, 0.0, 0.0, 0.2,\r\n      0.5450980392, 0.0, 0.0, 0.20392156862745098, 0.5568627451, 0.0, 0.0, 0.20784313725490197,\r\n      0.568627451, 0.0, 0.0, 0.21176470588235294, 0.5803921569, 0.0, 0.0, 0.21568627450980393,\r\n      0.5921568627, 0.0, 0.0, 0.2196078431372549, 0.6078431373, 0.0, 0.0, 0.2235294117647059,\r\n      0.6196078431, 0.0, 0.0, 0.22745098039215686, 0.631372549, 0.0, 0.0, 0.23137254901960785,\r\n      0.6431372549, 0.0, 0.0, 0.23529411764705885, 0.6588235294, 0.0, 0.0, 0.23921568627450984,\r\n      0.6705882353, 0.0, 0.0, 0.24313725490196078, 0.6823529412, 0.0, 0.0, 0.24705882352941178,\r\n      0.6941176471, 0.0, 0.0, 0.25098039215686274, 0.7098039216, 0.0, 0.0, 0.2549019607843137,\r\n      0.7215686275, 0.0, 0.0, 0.25882352941176473, 0.7333333333, 0.0, 0.0, 0.2627450980392157,\r\n      0.7450980392, 0.0, 0.0, 0.26666666666666666, 0.7568627451, 0.0, 0.0, 0.27058823529411763,\r\n      0.768627451, 0.0, 0.0, 0.27450980392156865, 0.7843137255, 0.0, 0.0, 0.2784313725490196,\r\n      0.7960784314, 0.0, 0.0, 0.2823529411764706, 0.8117647059, 0.0, 0.0, 0.28627450980392155,\r\n      0.8235294118, 0.0, 0.0, 0.2901960784313726, 0.8352941176, 0.0, 0.0, 0.29411764705882354,\r\n      0.8470588235, 0.0, 0.0, 0.2980392156862745, 0.862745098, 0.0, 0.0, 0.30196078431372547,\r\n      0.8745098039, 0.0, 0.0, 0.3058823529411765, 0.8862745098, 0.0, 0.0, 0.30980392156862746,\r\n      0.8980392157, 0.0, 0.0, 0.3137254901960784, 0.9137254902, 0.0, 0.0, 0.3176470588235294,\r\n      0.9254901961, 0.0, 0.0, 0.3215686274509804, 0.937254902, 0.0, 0.0, 0.3254901960784314,\r\n      0.9490196078, 0.0, 0.0, 0.32941176470588235, 0.9607843137, 0.0, 0.0, 0.3333333333333333,\r\n      0.968627451, 0.0, 0.0, 0.33725490196078434, 0.9803921569, 0.0039215686, 0.0,\r\n      0.3411764705882353, 0.9882352941, 0.0078431373, 0.0, 0.34509803921568627, 1.0, 0.0117647059,\r\n      0.0, 0.34901960784313724, 1.0, 0.0235294118, 0.0, 0.35294117647058826, 1.0, 0.0352941176, 0.0,\r\n      0.3568627450980392, 1.0, 0.0470588235, 0.0, 0.3607843137254902, 1.0, 0.062745098, 0.0,\r\n      0.36470588235294116, 1.0, 0.0745098039, 0.0, 0.3686274509803922, 1.0, 0.0862745098, 0.0,\r\n      0.37254901960784315, 1.0, 0.0980392157, 0.0, 0.3764705882352941, 1.0, 0.1137254902, 0.0,\r\n      0.3803921568627451, 1.0, 0.1254901961, 0.0, 0.3843137254901961, 1.0, 0.137254902, 0.0,\r\n      0.38823529411764707, 1.0, 0.1490196078, 0.0, 0.39215686274509803, 1.0, 0.1647058824, 0.0,\r\n      0.396078431372549, 1.0, 0.1764705882, 0.0, 0.4, 1.0, 0.1882352941, 0.0, 0.403921568627451,\r\n      1.0, 0.2, 0.0, 0.40784313725490196, 1.0, 0.2156862745, 0.0, 0.4117647058823529, 1.0,\r\n      0.2274509804, 0.0, 0.41568627450980394, 1.0, 0.2392156863, 0.0, 0.4196078431372549, 1.0,\r\n      0.2509803922, 0.0, 0.4235294117647059, 1.0, 0.2666666667, 0.0, 0.42745098039215684, 1.0,\r\n      0.2784313725, 0.0, 0.43137254901960786, 1.0, 0.2901960784, 0.0, 0.43529411764705883, 1.0,\r\n      0.3019607843, 0.0, 0.4392156862745098, 1.0, 0.3176470588, 0.0, 0.44313725490196076, 1.0,\r\n      0.3294117647, 0.0, 0.4470588235294118, 1.0, 0.3411764706, 0.0, 0.45098039215686275, 1.0,\r\n      0.3529411765, 0.0, 0.4549019607843137, 1.0, 0.368627451, 0.0, 0.4588235294117647, 1.0,\r\n      0.3803921569, 0.0, 0.4627450980392157, 1.0, 0.3921568627, 0.0, 0.4666666666666667, 1.0,\r\n      0.4039215686, 0.0, 0.4705882352941177, 1.0, 0.4156862745, 0.0, 0.4745098039215686, 1.0,\r\n      0.4274509804, 0.0, 0.4784313725490197, 1.0, 0.4392156863, 0.0, 0.48235294117647065, 1.0,\r\n      0.4509803922, 0.0, 0.48627450980392156, 1.0, 0.4666666667, 0.0, 0.49019607843137253, 1.0,\r\n      0.4784313725, 0.0, 0.49411764705882355, 1.0, 0.4941176471, 0.0, 0.4980392156862745, 1.0,\r\n      0.5058823529, 0.0, 0.5019607843137255, 1.0, 0.5215686275, 0.0, 0.5058823529411764, 1.0,\r\n      0.5333333333, 0.0, 0.5098039215686274, 1.0, 0.5450980392, 0.0, 0.5137254901960784, 1.0,\r\n      0.5568627451, 0.0, 0.5176470588235295, 1.0, 0.568627451, 0.0, 0.5215686274509804, 1.0,\r\n      0.5803921569, 0.0, 0.5254901960784314, 1.0, 0.5921568627, 0.0, 0.5294117647058824, 1.0,\r\n      0.6039215686, 0.0, 0.5333333333333333, 1.0, 0.6196078431, 0.0, 0.5372549019607843, 1.0,\r\n      0.631372549, 0.0, 0.5411764705882353, 1.0, 0.6431372549, 0.0, 0.5450980392156862, 1.0,\r\n      0.6549019608, 0.0, 0.5490196078431373, 1.0, 0.6705882353, 0.0, 0.5529411764705883, 1.0,\r\n      0.6823529412, 0.0, 0.5568627450980392, 1.0, 0.6941176471, 0.0, 0.5607843137254902, 1.0,\r\n      0.7058823529, 0.0, 0.5647058823529412, 1.0, 0.7215686275, 0.0, 0.5686274509803921, 1.0,\r\n      0.7333333333, 0.0, 0.5725490196078431, 1.0, 0.7450980392, 0.0, 0.5764705882352941, 1.0,\r\n      0.7568627451, 0.0, 0.5803921568627451, 1.0, 0.7725490196, 0.0, 0.5843137254901961, 1.0,\r\n      0.7843137255, 0.0, 0.5882352941176471, 1.0, 0.7960784314, 0.0, 0.592156862745098, 1.0,\r\n      0.8078431373, 0.0, 0.596078431372549, 1.0, 0.8196078431, 0.0, 0.6, 1.0, 0.831372549, 0.0,\r\n      0.6039215686274509, 1.0, 0.8470588235, 0.0, 0.6078431372549019, 1.0, 0.8588235294, 0.0,\r\n      0.611764705882353, 1.0, 0.8745098039, 0.0, 0.615686274509804, 1.0, 0.8862745098, 0.0,\r\n      0.6196078431372549, 1.0, 0.8980392157, 0.0, 0.6235294117647059, 1.0, 0.9098039216, 0.0,\r\n      0.6274509803921569, 1.0, 0.9254901961, 0.0, 0.6313725490196078, 1.0, 0.937254902, 0.0,\r\n      0.6352941176470588, 1.0, 0.9490196078, 0.0, 0.6392156862745098, 1.0, 0.9607843137, 0.0,\r\n      0.6431372549019608, 1.0, 0.9764705882, 0.0, 0.6470588235294118, 1.0, 0.9803921569,\r\n      0.0039215686, 0.6509803921568628, 1.0, 0.9882352941, 0.0117647059, 0.6549019607843137, 1.0,\r\n      0.9921568627, 0.0156862745, 0.6588235294117647, 1.0, 1.0, 0.0235294118, 0.6627450980392157,\r\n      1.0, 1.0, 0.0352941176, 0.6666666666666666, 1.0, 1.0, 0.0470588235, 0.6705882352941176, 1.0,\r\n      1.0, 0.0588235294, 0.6745098039215687, 1.0, 1.0, 0.0745098039, 0.6784313725490196, 1.0, 1.0,\r\n      0.0862745098, 0.6823529411764706, 1.0, 1.0, 0.0980392157, 0.6862745098039216, 1.0, 1.0,\r\n      0.1098039216, 0.6901960784313725, 1.0, 1.0, 0.1254901961, 0.6941176470588235, 1.0, 1.0,\r\n      0.137254902, 0.6980392156862745, 1.0, 1.0, 0.1490196078, 0.7019607843137254, 1.0, 1.0,\r\n      0.1607843137, 0.7058823529411765, 1.0, 1.0, 0.1764705882, 0.7098039215686275, 1.0, 1.0,\r\n      0.1882352941, 0.7137254901960784, 1.0, 1.0, 0.2, 0.7176470588235294, 1.0, 1.0, 0.2117647059,\r\n      0.7215686274509804, 1.0, 1.0, 0.2274509804, 0.7254901960784313, 1.0, 1.0, 0.2392156863,\r\n      0.7294117647058823, 1.0, 1.0, 0.2509803922, 0.7333333333333333, 1.0, 1.0, 0.262745098,\r\n      0.7372549019607844, 1.0, 1.0, 0.2784313725, 0.7411764705882353, 1.0, 1.0, 0.2901960784,\r\n      0.7450980392156863, 1.0, 1.0, 0.3019607843, 0.7490196078431373, 1.0, 1.0, 0.3137254902,\r\n      0.7529411764705882, 1.0, 1.0, 0.3294117647, 0.7568627450980392, 1.0, 1.0, 0.3411764706,\r\n      0.7607843137254902, 1.0, 1.0, 0.3529411765, 0.7647058823529411, 1.0, 1.0, 0.3647058824,\r\n      0.7686274509803922, 1.0, 1.0, 0.3803921569, 0.7725490196078432, 1.0, 1.0, 0.3921568627,\r\n      0.7764705882352941, 1.0, 1.0, 0.4039215686, 0.7803921568627451, 1.0, 1.0, 0.4156862745,\r\n      0.7843137254901961, 1.0, 1.0, 0.431372549, 0.788235294117647, 1.0, 1.0, 0.4431372549,\r\n      0.792156862745098, 1.0, 1.0, 0.4549019608, 0.796078431372549, 1.0, 1.0, 0.4666666667, 0.8,\r\n      1.0, 1.0, 0.4784313725, 0.803921568627451, 1.0, 1.0, 0.4901960784, 0.807843137254902, 1.0,\r\n      1.0, 0.5019607843, 0.8117647058823529, 1.0, 1.0, 0.5137254902, 0.8156862745098039, 1.0, 1.0,\r\n      0.5294117647, 0.8196078431372549, 1.0, 1.0, 0.5411764706, 0.8235294117647058, 1.0, 1.0,\r\n      0.5568627451, 0.8274509803921568, 1.0, 1.0, 0.568627451, 0.8313725490196079, 1.0, 1.0,\r\n      0.5843137255, 0.8352941176470589, 1.0, 1.0, 0.5960784314, 0.8392156862745098, 1.0, 1.0,\r\n      0.6078431373, 0.8431372549019608, 1.0, 1.0, 0.6196078431, 0.8470588235294118, 1.0, 1.0,\r\n      0.631372549, 0.8509803921568627, 1.0, 1.0, 0.6431372549, 0.8549019607843137, 1.0, 1.0,\r\n      0.6549019608, 0.8588235294117647, 1.0, 1.0, 0.6666666667, 0.8627450980392157, 1.0, 1.0,\r\n      0.6823529412, 0.8666666666666667, 1.0, 1.0, 0.6941176471, 0.8705882352941177, 1.0, 1.0,\r\n      0.7058823529, 0.8745098039215686, 1.0, 1.0, 0.7176470588, 0.8784313725490196, 1.0, 1.0,\r\n      0.7333333333, 0.8823529411764706, 1.0, 1.0, 0.7450980392, 0.8862745098039215, 1.0, 1.0,\r\n      0.7568627451, 0.8901960784313725, 1.0, 1.0, 0.768627451, 0.8941176470588236, 1.0, 1.0,\r\n      0.7843137255, 0.8980392156862745, 1.0, 1.0, 0.7960784314, 0.9019607843137255, 1.0, 1.0,\r\n      0.8078431373, 0.9058823529411765, 1.0, 1.0, 0.8196078431, 0.9098039215686274, 1.0, 1.0,\r\n      0.8352941176, 0.9137254901960784, 1.0, 1.0, 0.8470588235, 0.9176470588235294, 1.0, 1.0,\r\n      0.8588235294, 0.9215686274509803, 1.0, 1.0, 0.8705882353, 0.9254901960784314, 1.0, 1.0,\r\n      0.8823529412, 0.9294117647058824, 1.0, 1.0, 0.8941176471, 0.9333333333333333, 1.0, 1.0,\r\n      0.9098039216, 0.9372549019607843, 1.0, 1.0, 0.9215686275, 0.9411764705882354, 1.0, 1.0,\r\n      0.937254902, 0.9450980392156864, 1.0, 1.0, 0.9490196078, 0.9490196078431372, 1.0, 1.0,\r\n      0.9607843137, 0.9529411764705882, 1.0, 1.0, 0.9725490196, 0.9568627450980394, 1.0, 1.0,\r\n      0.9882352941, 0.9607843137254903, 1.0, 1.0, 0.9882352941, 0.9647058823529413, 1.0, 1.0,\r\n      0.9921568627, 0.9686274509803922, 1.0, 1.0, 0.9960784314, 0.9725490196078431, 1.0, 1.0, 1.0,\r\n      0.9764705882352941, 1.0, 1.0, 1.0, 0.9803921568627451, 1.0, 1.0, 1.0, 0.984313725490196, 1.0,\r\n      1.0, 1.0, 0.9882352941176471, 1.0, 1.0, 1.0, 0.9921568627450981, 1.0, 1.0, 1.0,\r\n      0.996078431372549, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,\r\n    ],\r\n    description: 'Red Hot',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 's_pet',\r\n    name: 's_pet',\r\n    RGBPoints: [\r\n      0.0, 0.0156862745, 0.0039215686, 0.0156862745, 0.00392156862745098, 0.0156862745,\r\n      0.0039215686, 0.0156862745, 0.00784313725490196, 0.0274509804, 0.0039215686, 0.031372549,\r\n      0.011764705882352941, 0.0352941176, 0.0039215686, 0.0509803922, 0.01568627450980392,\r\n      0.0392156863, 0.0039215686, 0.0666666667, 0.0196078431372549, 0.0509803922, 0.0039215686,\r\n      0.0823529412, 0.023529411764705882, 0.062745098, 0.0039215686, 0.0980392157,\r\n      0.027450980392156862, 0.0705882353, 0.0039215686, 0.1176470588, 0.03137254901960784,\r\n      0.0745098039, 0.0039215686, 0.1333333333, 0.03529411764705882, 0.0862745098, 0.0039215686,\r\n      0.1490196078, 0.0392156862745098, 0.0980392157, 0.0039215686, 0.1647058824,\r\n      0.043137254901960784, 0.1058823529, 0.0039215686, 0.1843137255, 0.047058823529411764,\r\n      0.1098039216, 0.0039215686, 0.2, 0.050980392156862744, 0.1215686275, 0.0039215686,\r\n      0.2156862745, 0.054901960784313725, 0.1333333333, 0.0039215686, 0.231372549,\r\n      0.05882352941176471, 0.137254902, 0.0039215686, 0.2509803922, 0.06274509803921569,\r\n      0.1490196078, 0.0039215686, 0.262745098, 0.06666666666666667, 0.1607843137, 0.0039215686,\r\n      0.2784313725, 0.07058823529411765, 0.168627451, 0.0039215686, 0.2941176471,\r\n      0.07450980392156863, 0.1725490196, 0.0039215686, 0.3137254902, 0.0784313725490196,\r\n      0.1843137255, 0.0039215686, 0.3294117647, 0.08235294117647059, 0.1960784314, 0.0039215686,\r\n      0.3450980392, 0.08627450980392157, 0.2039215686, 0.0039215686, 0.3607843137,\r\n      0.09019607843137255, 0.2078431373, 0.0039215686, 0.3803921569, 0.09411764705882353,\r\n      0.2196078431, 0.0039215686, 0.3960784314, 0.09803921568627451, 0.231372549, 0.0039215686,\r\n      0.4117647059, 0.10196078431372549, 0.2392156863, 0.0039215686, 0.4274509804,\r\n      0.10588235294117647, 0.2431372549, 0.0039215686, 0.4470588235, 0.10980392156862745,\r\n      0.2509803922, 0.0039215686, 0.462745098, 0.11372549019607843, 0.262745098, 0.0039215686,\r\n      0.4784313725, 0.11764705882352942, 0.2666666667, 0.0039215686, 0.4980392157,\r\n      0.12156862745098039, 0.2666666667, 0.0039215686, 0.4980392157, 0.12549019607843137,\r\n      0.262745098, 0.0039215686, 0.5137254902, 0.12941176470588237, 0.2509803922, 0.0039215686,\r\n      0.5294117647, 0.13333333333333333, 0.2431372549, 0.0039215686, 0.5450980392,\r\n      0.13725490196078433, 0.2392156863, 0.0039215686, 0.5607843137, 0.1411764705882353,\r\n      0.231372549, 0.0039215686, 0.5764705882, 0.1450980392156863, 0.2196078431, 0.0039215686,\r\n      0.5921568627, 0.14901960784313725, 0.2078431373, 0.0039215686, 0.6078431373,\r\n      0.15294117647058825, 0.2039215686, 0.0039215686, 0.6235294118, 0.1568627450980392,\r\n      0.1960784314, 0.0039215686, 0.6392156863, 0.1607843137254902, 0.1843137255, 0.0039215686,\r\n      0.6549019608, 0.16470588235294117, 0.1725490196, 0.0039215686, 0.6705882353,\r\n      0.16862745098039217, 0.168627451, 0.0039215686, 0.6862745098, 0.17254901960784313,\r\n      0.1607843137, 0.0039215686, 0.7019607843, 0.17647058823529413, 0.1490196078, 0.0039215686,\r\n      0.7176470588, 0.1803921568627451, 0.137254902, 0.0039215686, 0.7333333333, 0.1843137254901961,\r\n      0.1333333333, 0.0039215686, 0.7490196078, 0.18823529411764706, 0.1215686275, 0.0039215686,\r\n      0.7607843137, 0.19215686274509805, 0.1098039216, 0.0039215686, 0.7764705882,\r\n      0.19607843137254902, 0.1058823529, 0.0039215686, 0.7921568627, 0.2, 0.0980392157,\r\n      0.0039215686, 0.8078431373, 0.20392156862745098, 0.0862745098, 0.0039215686, 0.8235294118,\r\n      0.20784313725490197, 0.0745098039, 0.0039215686, 0.8392156863, 0.21176470588235294,\r\n      0.0705882353, 0.0039215686, 0.8549019608, 0.21568627450980393, 0.062745098, 0.0039215686,\r\n      0.8705882353, 0.2196078431372549, 0.0509803922, 0.0039215686, 0.8862745098,\r\n      0.2235294117647059, 0.0392156863, 0.0039215686, 0.9019607843, 0.22745098039215686,\r\n      0.0352941176, 0.0039215686, 0.9176470588, 0.23137254901960785, 0.0274509804, 0.0039215686,\r\n      0.9333333333, 0.23529411764705885, 0.0156862745, 0.0039215686, 0.9490196078,\r\n      0.23921568627450984, 0.0078431373, 0.0039215686, 0.9647058824, 0.24313725490196078,\r\n      0.0039215686, 0.0039215686, 0.9960784314, 0.24705882352941178, 0.0039215686, 0.0039215686,\r\n      0.9960784314, 0.25098039215686274, 0.0039215686, 0.0196078431, 0.9647058824,\r\n      0.2549019607843137, 0.0039215686, 0.0392156863, 0.9490196078, 0.25882352941176473,\r\n      0.0039215686, 0.0549019608, 0.9333333333, 0.2627450980392157, 0.0039215686, 0.0745098039,\r\n      0.9176470588, 0.26666666666666666, 0.0039215686, 0.0901960784, 0.9019607843,\r\n      0.27058823529411763, 0.0039215686, 0.1098039216, 0.8862745098, 0.27450980392156865,\r\n      0.0039215686, 0.1254901961, 0.8705882353, 0.2784313725490196, 0.0039215686, 0.1450980392,\r\n      0.8549019608, 0.2823529411764706, 0.0039215686, 0.1607843137, 0.8392156863,\r\n      0.28627450980392155, 0.0039215686, 0.1803921569, 0.8235294118, 0.2901960784313726,\r\n      0.0039215686, 0.1960784314, 0.8078431373, 0.29411764705882354, 0.0039215686, 0.2156862745,\r\n      0.7921568627, 0.2980392156862745, 0.0039215686, 0.231372549, 0.7764705882,\r\n      0.30196078431372547, 0.0039215686, 0.2509803922, 0.7607843137, 0.3058823529411765,\r\n      0.0039215686, 0.262745098, 0.7490196078, 0.30980392156862746, 0.0039215686, 0.2823529412,\r\n      0.7333333333, 0.3137254901960784, 0.0039215686, 0.2980392157, 0.7176470588,\r\n      0.3176470588235294, 0.0039215686, 0.3176470588, 0.7019607843, 0.3215686274509804,\r\n      0.0039215686, 0.3333333333, 0.6862745098, 0.3254901960784314, 0.0039215686, 0.3529411765,\r\n      0.6705882353, 0.32941176470588235, 0.0039215686, 0.368627451, 0.6549019608,\r\n      0.3333333333333333, 0.0039215686, 0.3882352941, 0.6392156863, 0.33725490196078434,\r\n      0.0039215686, 0.4039215686, 0.6235294118, 0.3411764705882353, 0.0039215686, 0.4235294118,\r\n      0.6078431373, 0.34509803921568627, 0.0039215686, 0.4392156863, 0.5921568627,\r\n      0.34901960784313724, 0.0039215686, 0.4588235294, 0.5764705882, 0.35294117647058826,\r\n      0.0039215686, 0.4745098039, 0.5607843137, 0.3568627450980392, 0.0039215686, 0.4941176471,\r\n      0.5450980392, 0.3607843137254902, 0.0039215686, 0.5098039216, 0.5294117647,\r\n      0.36470588235294116, 0.0039215686, 0.5294117647, 0.5137254902, 0.3686274509803922,\r\n      0.0039215686, 0.5450980392, 0.4980392157, 0.37254901960784315, 0.0039215686, 0.5647058824,\r\n      0.4784313725, 0.3764705882352941, 0.0039215686, 0.5803921569, 0.462745098, 0.3803921568627451,\r\n      0.0039215686, 0.6, 0.4470588235, 0.3843137254901961, 0.0039215686, 0.6156862745, 0.4274509804,\r\n      0.38823529411764707, 0.0039215686, 0.6352941176, 0.4117647059, 0.39215686274509803,\r\n      0.0039215686, 0.6509803922, 0.3960784314, 0.396078431372549, 0.0039215686, 0.6705882353,\r\n      0.3803921569, 0.4, 0.0039215686, 0.6862745098, 0.3607843137, 0.403921568627451, 0.0039215686,\r\n      0.7058823529, 0.3450980392, 0.40784313725490196, 0.0039215686, 0.7215686275, 0.3294117647,\r\n      0.4117647058823529, 0.0039215686, 0.7411764706, 0.3137254902, 0.41568627450980394,\r\n      0.0039215686, 0.7529411765, 0.2941176471, 0.4196078431372549, 0.0039215686, 0.7960784314,\r\n      0.2784313725, 0.4235294117647059, 0.0039215686, 0.7960784314, 0.262745098,\r\n      0.42745098039215684, 0.0392156863, 0.8039215686, 0.2509803922, 0.43137254901960786,\r\n      0.0745098039, 0.8117647059, 0.231372549, 0.43529411764705883, 0.1098039216, 0.8196078431,\r\n      0.2156862745, 0.4392156862745098, 0.1450980392, 0.8274509804, 0.2, 0.44313725490196076,\r\n      0.1803921569, 0.8352941176, 0.1843137255, 0.4470588235294118, 0.2156862745, 0.8431372549,\r\n      0.1647058824, 0.45098039215686275, 0.2509803922, 0.8509803922, 0.1490196078,\r\n      0.4549019607843137, 0.2823529412, 0.8588235294, 0.1333333333, 0.4588235294117647,\r\n      0.3176470588, 0.8666666667, 0.1176470588, 0.4627450980392157, 0.3529411765, 0.8745098039,\r\n      0.0980392157, 0.4666666666666667, 0.3882352941, 0.8823529412, 0.0823529412,\r\n      0.4705882352941177, 0.4235294118, 0.8901960784, 0.0666666667, 0.4745098039215686,\r\n      0.4588235294, 0.8980392157, 0.0509803922, 0.4784313725490197, 0.4941176471, 0.9058823529,\r\n      0.0431372549, 0.48235294117647065, 0.5294117647, 0.9137254902, 0.031372549,\r\n      0.48627450980392156, 0.5647058824, 0.9215686275, 0.0196078431, 0.49019607843137253, 0.6,\r\n      0.9294117647, 0.0078431373, 0.49411764705882355, 0.6352941176, 0.937254902, 0.0039215686,\r\n      0.4980392156862745, 0.6705882353, 0.9450980392, 0.0039215686, 0.5019607843137255,\r\n      0.7058823529, 0.9490196078, 0.0039215686, 0.5058823529411764, 0.7411764706, 0.9568627451,\r\n      0.0039215686, 0.5098039215686274, 0.7725490196, 0.9607843137, 0.0039215686,\r\n      0.5137254901960784, 0.8078431373, 0.968627451, 0.0039215686, 0.5176470588235295, 0.8431372549,\r\n      0.9725490196, 0.0039215686, 0.5215686274509804, 0.8784313725, 0.9803921569, 0.0039215686,\r\n      0.5254901960784314, 0.9137254902, 0.9843137255, 0.0039215686, 0.5294117647058824,\r\n      0.9490196078, 0.9921568627, 0.0039215686, 0.5333333333333333, 0.9960784314, 0.9960784314,\r\n      0.0039215686, 0.5372549019607843, 0.9960784314, 0.9960784314, 0.0039215686,\r\n      0.5411764705882353, 0.9960784314, 0.9921568627, 0.0039215686, 0.5450980392156862,\r\n      0.9960784314, 0.9843137255, 0.0039215686, 0.5490196078431373, 0.9960784314, 0.9764705882,\r\n      0.0039215686, 0.5529411764705883, 0.9960784314, 0.968627451, 0.0039215686, 0.5568627450980392,\r\n      0.9960784314, 0.9607843137, 0.0039215686, 0.5607843137254902, 0.9960784314, 0.9529411765,\r\n      0.0039215686, 0.5647058823529412, 0.9960784314, 0.9450980392, 0.0039215686,\r\n      0.5686274509803921, 0.9960784314, 0.937254902, 0.0039215686, 0.5725490196078431, 0.9960784314,\r\n      0.9294117647, 0.0039215686, 0.5764705882352941, 0.9960784314, 0.9215686275, 0.0039215686,\r\n      0.5803921568627451, 0.9960784314, 0.9137254902, 0.0039215686, 0.5843137254901961,\r\n      0.9960784314, 0.9058823529, 0.0039215686, 0.5882352941176471, 0.9960784314, 0.8980392157,\r\n      0.0039215686, 0.592156862745098, 0.9960784314, 0.8901960784, 0.0039215686, 0.596078431372549,\r\n      0.9960784314, 0.8823529412, 0.0039215686, 0.6, 0.9960784314, 0.8745098039, 0.0039215686,\r\n      0.6039215686274509, 0.9960784314, 0.8666666667, 0.0039215686, 0.6078431372549019,\r\n      0.9960784314, 0.8588235294, 0.0039215686, 0.611764705882353, 0.9960784314, 0.8509803922,\r\n      0.0039215686, 0.615686274509804, 0.9960784314, 0.8431372549, 0.0039215686, 0.6196078431372549,\r\n      0.9960784314, 0.8352941176, 0.0039215686, 0.6235294117647059, 0.9960784314, 0.8274509804,\r\n      0.0039215686, 0.6274509803921569, 0.9960784314, 0.8196078431, 0.0039215686,\r\n      0.6313725490196078, 0.9960784314, 0.8117647059, 0.0039215686, 0.6352941176470588,\r\n      0.9960784314, 0.8039215686, 0.0039215686, 0.6392156862745098, 0.9960784314, 0.7960784314,\r\n      0.0039215686, 0.6431372549019608, 0.9960784314, 0.7882352941, 0.0039215686,\r\n      0.6470588235294118, 0.9960784314, 0.7803921569, 0.0039215686, 0.6509803921568628,\r\n      0.9960784314, 0.7725490196, 0.0039215686, 0.6549019607843137, 0.9960784314, 0.7647058824,\r\n      0.0039215686, 0.6588235294117647, 0.9960784314, 0.7568627451, 0.0039215686,\r\n      0.6627450980392157, 0.9960784314, 0.7490196078, 0.0039215686, 0.6666666666666666,\r\n      0.9960784314, 0.7450980392, 0.0039215686, 0.6705882352941176, 0.9960784314, 0.737254902,\r\n      0.0039215686, 0.6745098039215687, 0.9960784314, 0.7294117647, 0.0039215686,\r\n      0.6784313725490196, 0.9960784314, 0.7215686275, 0.0039215686, 0.6823529411764706,\r\n      0.9960784314, 0.7137254902, 0.0039215686, 0.6862745098039216, 0.9960784314, 0.7058823529,\r\n      0.0039215686, 0.6901960784313725, 0.9960784314, 0.6980392157, 0.0039215686,\r\n      0.6941176470588235, 0.9960784314, 0.6901960784, 0.0039215686, 0.6980392156862745,\r\n      0.9960784314, 0.6823529412, 0.0039215686, 0.7019607843137254, 0.9960784314, 0.6745098039,\r\n      0.0039215686, 0.7058823529411765, 0.9960784314, 0.6666666667, 0.0039215686,\r\n      0.7098039215686275, 0.9960784314, 0.6588235294, 0.0039215686, 0.7137254901960784,\r\n      0.9960784314, 0.6509803922, 0.0039215686, 0.7176470588235294, 0.9960784314, 0.6431372549,\r\n      0.0039215686, 0.7215686274509804, 0.9960784314, 0.6352941176, 0.0039215686,\r\n      0.7254901960784313, 0.9960784314, 0.6274509804, 0.0039215686, 0.7294117647058823,\r\n      0.9960784314, 0.6196078431, 0.0039215686, 0.7333333333333333, 0.9960784314, 0.6117647059,\r\n      0.0039215686, 0.7372549019607844, 0.9960784314, 0.6039215686, 0.0039215686,\r\n      0.7411764705882353, 0.9960784314, 0.5960784314, 0.0039215686, 0.7450980392156863,\r\n      0.9960784314, 0.5882352941, 0.0039215686, 0.7490196078431373, 0.9960784314, 0.5803921569,\r\n      0.0039215686, 0.7529411764705882, 0.9960784314, 0.5725490196, 0.0039215686,\r\n      0.7568627450980392, 0.9960784314, 0.5647058824, 0.0039215686, 0.7607843137254902,\r\n      0.9960784314, 0.5568627451, 0.0039215686, 0.7647058823529411, 0.9960784314, 0.5490196078,\r\n      0.0039215686, 0.7686274509803922, 0.9960784314, 0.5411764706, 0.0039215686,\r\n      0.7725490196078432, 0.9960784314, 0.5333333333, 0.0039215686, 0.7764705882352941,\r\n      0.9960784314, 0.5254901961, 0.0039215686, 0.7803921568627451, 0.9960784314, 0.5176470588,\r\n      0.0039215686, 0.7843137254901961, 0.9960784314, 0.5098039216, 0.0039215686, 0.788235294117647,\r\n      0.9960784314, 0.5019607843, 0.0039215686, 0.792156862745098, 0.9960784314, 0.4941176471,\r\n      0.0039215686, 0.796078431372549, 0.9960784314, 0.4862745098, 0.0039215686, 0.8, 0.9960784314,\r\n      0.4784313725, 0.0039215686, 0.803921568627451, 0.9960784314, 0.4705882353, 0.0039215686,\r\n      0.807843137254902, 0.9960784314, 0.462745098, 0.0039215686, 0.8117647058823529, 0.9960784314,\r\n      0.4549019608, 0.0039215686, 0.8156862745098039, 0.9960784314, 0.4470588235, 0.0039215686,\r\n      0.8196078431372549, 0.9960784314, 0.4392156863, 0.0039215686, 0.8235294117647058,\r\n      0.9960784314, 0.431372549, 0.0039215686, 0.8274509803921568, 0.9960784314, 0.4235294118,\r\n      0.0039215686, 0.8313725490196079, 0.9960784314, 0.4156862745, 0.0039215686,\r\n      0.8352941176470589, 0.9960784314, 0.4078431373, 0.0039215686, 0.8392156862745098,\r\n      0.9960784314, 0.4, 0.0039215686, 0.8431372549019608, 0.9960784314, 0.3921568627, 0.0039215686,\r\n      0.8470588235294118, 0.9960784314, 0.3843137255, 0.0039215686, 0.8509803921568627,\r\n      0.9960784314, 0.3764705882, 0.0039215686, 0.8549019607843137, 0.9960784314, 0.368627451,\r\n      0.0039215686, 0.8588235294117647, 0.9960784314, 0.3607843137, 0.0039215686,\r\n      0.8627450980392157, 0.9960784314, 0.3529411765, 0.0039215686, 0.8666666666666667,\r\n      0.9960784314, 0.3450980392, 0.0039215686, 0.8705882352941177, 0.9960784314, 0.337254902,\r\n      0.0039215686, 0.8745098039215686, 0.9960784314, 0.3294117647, 0.0039215686,\r\n      0.8784313725490196, 0.9960784314, 0.3215686275, 0.0039215686, 0.8823529411764706,\r\n      0.9960784314, 0.3137254902, 0.0039215686, 0.8862745098039215, 0.9960784314, 0.3058823529,\r\n      0.0039215686, 0.8901960784313725, 0.9960784314, 0.2980392157, 0.0039215686,\r\n      0.8941176470588236, 0.9960784314, 0.2901960784, 0.0039215686, 0.8980392156862745,\r\n      0.9960784314, 0.2823529412, 0.0039215686, 0.9019607843137255, 0.9960784314, 0.2705882353,\r\n      0.0039215686, 0.9058823529411765, 0.9960784314, 0.2588235294, 0.0039215686,\r\n      0.9098039215686274, 0.9960784314, 0.2509803922, 0.0039215686, 0.9137254901960784,\r\n      0.9960784314, 0.2431372549, 0.0039215686, 0.9176470588235294, 0.9960784314, 0.231372549,\r\n      0.0039215686, 0.9215686274509803, 0.9960784314, 0.2196078431, 0.0039215686,\r\n      0.9254901960784314, 0.9960784314, 0.2117647059, 0.0039215686, 0.9294117647058824,\r\n      0.9960784314, 0.2, 0.0039215686, 0.9333333333333333, 0.9960784314, 0.1882352941, 0.0039215686,\r\n      0.9372549019607843, 0.9960784314, 0.1764705882, 0.0039215686, 0.9411764705882354,\r\n      0.9960784314, 0.168627451, 0.0039215686, 0.9450980392156864, 0.9960784314, 0.1568627451,\r\n      0.0039215686, 0.9490196078431372, 0.9960784314, 0.1450980392, 0.0039215686,\r\n      0.9529411764705882, 0.9960784314, 0.1333333333, 0.0039215686, 0.9568627450980394,\r\n      0.9960784314, 0.1254901961, 0.0039215686, 0.9607843137254903, 0.9960784314, 0.1137254902,\r\n      0.0039215686, 0.9647058823529413, 0.9960784314, 0.1019607843, 0.0039215686,\r\n      0.9686274509803922, 0.9960784314, 0.0901960784, 0.0039215686, 0.9725490196078431,\r\n      0.9960784314, 0.0823529412, 0.0039215686, 0.9764705882352941, 0.9960784314, 0.0705882353,\r\n      0.0039215686, 0.9803921568627451, 0.9960784314, 0.0588235294, 0.0039215686, 0.984313725490196,\r\n      0.9960784314, 0.0470588235, 0.0039215686, 0.9882352941176471, 0.9960784314, 0.0392156863,\r\n      0.0039215686, 0.9921568627450981, 0.9960784314, 0.0274509804, 0.0039215686, 0.996078431372549,\r\n      0.9960784314, 0.0156862745, 0.0039215686, 1.0, 0.9960784314, 0.0156862745, 0.0039215686,\r\n    ],\r\n    description: 'S PET',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'perfusion',\r\n    name: 'perfusion',\r\n    RGBPoints: [\r\n      0.0, 0.0, 0.0, 0.0, 0.00392156862745098, 0.0078431373, 0.0235294118, 0.0235294118,\r\n      0.00784313725490196, 0.0078431373, 0.031372549, 0.0470588235, 0.011764705882352941,\r\n      0.0078431373, 0.0392156863, 0.062745098, 0.01568627450980392, 0.0078431373, 0.0470588235,\r\n      0.0862745098, 0.0196078431372549, 0.0078431373, 0.0549019608, 0.1019607843,\r\n      0.023529411764705882, 0.0078431373, 0.0549019608, 0.1254901961, 0.027450980392156862,\r\n      0.0078431373, 0.062745098, 0.1411764706, 0.03137254901960784, 0.0078431373, 0.0705882353,\r\n      0.1647058824, 0.03529411764705882, 0.0078431373, 0.0784313725, 0.1803921569,\r\n      0.0392156862745098, 0.0078431373, 0.0862745098, 0.2039215686, 0.043137254901960784,\r\n      0.0078431373, 0.0862745098, 0.2196078431, 0.047058823529411764, 0.0078431373, 0.0941176471,\r\n      0.2431372549, 0.050980392156862744, 0.0078431373, 0.1019607843, 0.2666666667,\r\n      0.054901960784313725, 0.0078431373, 0.1098039216, 0.2823529412, 0.05882352941176471,\r\n      0.0078431373, 0.1176470588, 0.3058823529, 0.06274509803921569, 0.0078431373, 0.1176470588,\r\n      0.3215686275, 0.06666666666666667, 0.0078431373, 0.1254901961, 0.3450980392,\r\n      0.07058823529411765, 0.0078431373, 0.1333333333, 0.3607843137, 0.07450980392156863,\r\n      0.0078431373, 0.1411764706, 0.3843137255, 0.0784313725490196, 0.0078431373, 0.1490196078, 0.4,\r\n      0.08235294117647059, 0.0078431373, 0.1490196078, 0.4235294118, 0.08627450980392157,\r\n      0.0078431373, 0.1568627451, 0.4392156863, 0.09019607843137255, 0.0078431373, 0.1647058824,\r\n      0.462745098, 0.09411764705882353, 0.0078431373, 0.1725490196, 0.4784313725,\r\n      0.09803921568627451, 0.0078431373, 0.1803921569, 0.5019607843, 0.10196078431372549,\r\n      0.0078431373, 0.1803921569, 0.5254901961, 0.10588235294117647, 0.0078431373, 0.1882352941,\r\n      0.5411764706, 0.10980392156862745, 0.0078431373, 0.1960784314, 0.5647058824,\r\n      0.11372549019607843, 0.0078431373, 0.2039215686, 0.5803921569, 0.11764705882352942,\r\n      0.0078431373, 0.2117647059, 0.6039215686, 0.12156862745098039, 0.0078431373, 0.2117647059,\r\n      0.6196078431, 0.12549019607843137, 0.0078431373, 0.2196078431, 0.6431372549,\r\n      0.12941176470588237, 0.0078431373, 0.2274509804, 0.6588235294, 0.13333333333333333,\r\n      0.0078431373, 0.2352941176, 0.6823529412, 0.13725490196078433, 0.0078431373, 0.2431372549,\r\n      0.6980392157, 0.1411764705882353, 0.0078431373, 0.2431372549, 0.7215686275,\r\n      0.1450980392156863, 0.0078431373, 0.2509803922, 0.737254902, 0.14901960784313725,\r\n      0.0078431373, 0.2588235294, 0.7607843137, 0.15294117647058825, 0.0078431373, 0.2666666667,\r\n      0.7843137255, 0.1568627450980392, 0.0078431373, 0.2745098039, 0.8, 0.1607843137254902,\r\n      0.0078431373, 0.2745098039, 0.8235294118, 0.16470588235294117, 0.0078431373, 0.2823529412,\r\n      0.8392156863, 0.16862745098039217, 0.0078431373, 0.2901960784, 0.862745098,\r\n      0.17254901960784313, 0.0078431373, 0.2980392157, 0.8784313725, 0.17647058823529413,\r\n      0.0078431373, 0.3058823529, 0.9019607843, 0.1803921568627451, 0.0078431373, 0.3058823529,\r\n      0.9176470588, 0.1843137254901961, 0.0078431373, 0.2980392157, 0.9411764706,\r\n      0.18823529411764706, 0.0078431373, 0.3058823529, 0.9568627451, 0.19215686274509805,\r\n      0.0078431373, 0.2980392157, 0.9803921569, 0.19607843137254902, 0.0078431373, 0.2980392157,\r\n      0.9882352941, 0.2, 0.0078431373, 0.2901960784, 0.9803921569, 0.20392156862745098,\r\n      0.0078431373, 0.2901960784, 0.9647058824, 0.20784313725490197, 0.0078431373, 0.2823529412,\r\n      0.9568627451, 0.21176470588235294, 0.0078431373, 0.2823529412, 0.9411764706,\r\n      0.21568627450980393, 0.0078431373, 0.2745098039, 0.9333333333, 0.2196078431372549,\r\n      0.0078431373, 0.2666666667, 0.9176470588, 0.2235294117647059, 0.0078431373, 0.2666666667,\r\n      0.9098039216, 0.22745098039215686, 0.0078431373, 0.2588235294, 0.9019607843,\r\n      0.23137254901960785, 0.0078431373, 0.2588235294, 0.8862745098, 0.23529411764705885,\r\n      0.0078431373, 0.2509803922, 0.8784313725, 0.23921568627450984, 0.0078431373, 0.2509803922,\r\n      0.862745098, 0.24313725490196078, 0.0078431373, 0.2431372549, 0.8549019608,\r\n      0.24705882352941178, 0.0078431373, 0.2352941176, 0.8392156863, 0.25098039215686274,\r\n      0.0078431373, 0.2352941176, 0.831372549, 0.2549019607843137, 0.0078431373, 0.2274509804,\r\n      0.8235294118, 0.25882352941176473, 0.0078431373, 0.2274509804, 0.8078431373,\r\n      0.2627450980392157, 0.0078431373, 0.2196078431, 0.8, 0.26666666666666666, 0.0078431373,\r\n      0.2196078431, 0.7843137255, 0.27058823529411763, 0.0078431373, 0.2117647059, 0.7764705882,\r\n      0.27450980392156865, 0.0078431373, 0.2039215686, 0.7607843137, 0.2784313725490196,\r\n      0.0078431373, 0.2039215686, 0.7529411765, 0.2823529411764706, 0.0078431373, 0.1960784314,\r\n      0.7450980392, 0.28627450980392155, 0.0078431373, 0.1960784314, 0.7294117647,\r\n      0.2901960784313726, 0.0078431373, 0.1882352941, 0.7215686275, 0.29411764705882354,\r\n      0.0078431373, 0.1882352941, 0.7058823529, 0.2980392156862745, 0.0078431373, 0.1803921569,\r\n      0.6980392157, 0.30196078431372547, 0.0078431373, 0.1803921569, 0.6823529412,\r\n      0.3058823529411765, 0.0078431373, 0.1725490196, 0.6745098039, 0.30980392156862746,\r\n      0.0078431373, 0.1647058824, 0.6666666667, 0.3137254901960784, 0.0078431373, 0.1647058824,\r\n      0.6509803922, 0.3176470588235294, 0.0078431373, 0.1568627451, 0.6431372549,\r\n      0.3215686274509804, 0.0078431373, 0.1568627451, 0.6274509804, 0.3254901960784314,\r\n      0.0078431373, 0.1490196078, 0.6196078431, 0.32941176470588235, 0.0078431373, 0.1490196078,\r\n      0.6039215686, 0.3333333333333333, 0.0078431373, 0.1411764706, 0.5960784314,\r\n      0.33725490196078434, 0.0078431373, 0.1333333333, 0.5882352941, 0.3411764705882353,\r\n      0.0078431373, 0.1333333333, 0.5725490196, 0.34509803921568627, 0.0078431373, 0.1254901961,\r\n      0.5647058824, 0.34901960784313724, 0.0078431373, 0.1254901961, 0.5490196078,\r\n      0.35294117647058826, 0.0078431373, 0.1176470588, 0.5411764706, 0.3568627450980392,\r\n      0.0078431373, 0.1176470588, 0.5254901961, 0.3607843137254902, 0.0078431373, 0.1098039216,\r\n      0.5176470588, 0.36470588235294116, 0.0078431373, 0.1019607843, 0.5098039216,\r\n      0.3686274509803922, 0.0078431373, 0.1019607843, 0.4941176471, 0.37254901960784315,\r\n      0.0078431373, 0.0941176471, 0.4862745098, 0.3764705882352941, 0.0078431373, 0.0941176471,\r\n      0.4705882353, 0.3803921568627451, 0.0078431373, 0.0862745098, 0.462745098, 0.3843137254901961,\r\n      0.0078431373, 0.0862745098, 0.4470588235, 0.38823529411764707, 0.0078431373, 0.0784313725,\r\n      0.4392156863, 0.39215686274509803, 0.0078431373, 0.0705882353, 0.431372549, 0.396078431372549,\r\n      0.0078431373, 0.0705882353, 0.4156862745, 0.4, 0.0078431373, 0.062745098, 0.4078431373,\r\n      0.403921568627451, 0.0078431373, 0.062745098, 0.3921568627, 0.40784313725490196, 0.0078431373,\r\n      0.0549019608, 0.3843137255, 0.4117647058823529, 0.0078431373, 0.0549019608, 0.368627451,\r\n      0.41568627450980394, 0.0078431373, 0.0470588235, 0.3607843137, 0.4196078431372549,\r\n      0.0078431373, 0.0470588235, 0.3529411765, 0.4235294117647059, 0.0078431373, 0.0392156863,\r\n      0.337254902, 0.42745098039215684, 0.0078431373, 0.031372549, 0.3294117647,\r\n      0.43137254901960786, 0.0078431373, 0.031372549, 0.3137254902, 0.43529411764705883,\r\n      0.0078431373, 0.0235294118, 0.3058823529, 0.4392156862745098, 0.0078431373, 0.0235294118,\r\n      0.2901960784, 0.44313725490196076, 0.0078431373, 0.0156862745, 0.2823529412,\r\n      0.4470588235294118, 0.0078431373, 0.0156862745, 0.2745098039, 0.45098039215686275,\r\n      0.0078431373, 0.0078431373, 0.2588235294, 0.4549019607843137, 0.0235294118, 0.0078431373,\r\n      0.2509803922, 0.4588235294117647, 0.0078431373, 0.0078431373, 0.2352941176,\r\n      0.4627450980392157, 0.0078431373, 0.0078431373, 0.2274509804, 0.4666666666666667,\r\n      0.0078431373, 0.0078431373, 0.2117647059, 0.4705882352941177, 0.0078431373, 0.0078431373,\r\n      0.2039215686, 0.4745098039215686, 0.0078431373, 0.0078431373, 0.1960784314,\r\n      0.4784313725490197, 0.0078431373, 0.0078431373, 0.1803921569, 0.48235294117647065,\r\n      0.0078431373, 0.0078431373, 0.1725490196, 0.48627450980392156, 0.0078431373, 0.0078431373,\r\n      0.1568627451, 0.49019607843137253, 0.0078431373, 0.0078431373, 0.1490196078,\r\n      0.49411764705882355, 0.0078431373, 0.0078431373, 0.1333333333, 0.4980392156862745,\r\n      0.0078431373, 0.0078431373, 0.1254901961, 0.5019607843137255, 0.0078431373, 0.0078431373,\r\n      0.1176470588, 0.5058823529411764, 0.0078431373, 0.0078431373, 0.1019607843,\r\n      0.5098039215686274, 0.0078431373, 0.0078431373, 0.0941176471, 0.5137254901960784,\r\n      0.0078431373, 0.0078431373, 0.0784313725, 0.5176470588235295, 0.0078431373, 0.0078431373,\r\n      0.0705882353, 0.5215686274509804, 0.0078431373, 0.0078431373, 0.0549019608,\r\n      0.5254901960784314, 0.0078431373, 0.0078431373, 0.0470588235, 0.5294117647058824,\r\n      0.0235294118, 0.0078431373, 0.0392156863, 0.5333333333333333, 0.031372549, 0.0078431373,\r\n      0.0235294118, 0.5372549019607843, 0.0392156863, 0.0078431373, 0.0156862745,\r\n      0.5411764705882353, 0.0549019608, 0.0078431373, 0.0, 0.5450980392156862, 0.062745098,\r\n      0.0078431373, 0.0, 0.5490196078431373, 0.0705882353, 0.0078431373, 0.0, 0.5529411764705883,\r\n      0.0862745098, 0.0078431373, 0.0, 0.5568627450980392, 0.0941176471, 0.0078431373, 0.0,\r\n      0.5607843137254902, 0.1019607843, 0.0078431373, 0.0, 0.5647058823529412, 0.1098039216,\r\n      0.0078431373, 0.0, 0.5686274509803921, 0.1254901961, 0.0078431373, 0.0, 0.5725490196078431,\r\n      0.1333333333, 0.0078431373, 0.0, 0.5764705882352941, 0.1411764706, 0.0078431373, 0.0,\r\n      0.5803921568627451, 0.1568627451, 0.0078431373, 0.0, 0.5843137254901961, 0.1647058824,\r\n      0.0078431373, 0.0, 0.5882352941176471, 0.1725490196, 0.0078431373, 0.0, 0.592156862745098,\r\n      0.1882352941, 0.0078431373, 0.0, 0.596078431372549, 0.1960784314, 0.0078431373, 0.0, 0.6,\r\n      0.2039215686, 0.0078431373, 0.0, 0.6039215686274509, 0.2117647059, 0.0078431373, 0.0,\r\n      0.6078431372549019, 0.2274509804, 0.0078431373, 0.0, 0.611764705882353, 0.2352941176,\r\n      0.0078431373, 0.0, 0.615686274509804, 0.2431372549, 0.0078431373, 0.0, 0.6196078431372549,\r\n      0.2588235294, 0.0078431373, 0.0, 0.6235294117647059, 0.2666666667, 0.0078431373, 0.0,\r\n      0.6274509803921569, 0.2745098039, 0.0, 0.0, 0.6313725490196078, 0.2901960784, 0.0156862745,\r\n      0.0, 0.6352941176470588, 0.2980392157, 0.0235294118, 0.0, 0.6392156862745098, 0.3058823529,\r\n      0.0392156863, 0.0, 0.6431372549019608, 0.3137254902, 0.0470588235, 0.0, 0.6470588235294118,\r\n      0.3294117647, 0.0549019608, 0.0, 0.6509803921568628, 0.337254902, 0.0705882353, 0.0,\r\n      0.6549019607843137, 0.3450980392, 0.0784313725, 0.0, 0.6588235294117647, 0.3607843137,\r\n      0.0862745098, 0.0, 0.6627450980392157, 0.368627451, 0.1019607843, 0.0, 0.6666666666666666,\r\n      0.3764705882, 0.1098039216, 0.0, 0.6705882352941176, 0.3843137255, 0.1176470588, 0.0,\r\n      0.6745098039215687, 0.4, 0.1333333333, 0.0, 0.6784313725490196, 0.4078431373, 0.1411764706,\r\n      0.0, 0.6823529411764706, 0.4156862745, 0.1490196078, 0.0, 0.6862745098039216, 0.431372549,\r\n      0.1647058824, 0.0, 0.6901960784313725, 0.4392156863, 0.1725490196, 0.0, 0.6941176470588235,\r\n      0.4470588235, 0.1803921569, 0.0, 0.6980392156862745, 0.462745098, 0.1960784314, 0.0,\r\n      0.7019607843137254, 0.4705882353, 0.2039215686, 0.0, 0.7058823529411765, 0.4784313725,\r\n      0.2117647059, 0.0, 0.7098039215686275, 0.4862745098, 0.2274509804, 0.0, 0.7137254901960784,\r\n      0.5019607843, 0.2352941176, 0.0, 0.7176470588235294, 0.5098039216, 0.2431372549, 0.0,\r\n      0.7215686274509804, 0.5176470588, 0.2588235294, 0.0, 0.7254901960784313, 0.5333333333,\r\n      0.2666666667, 0.0, 0.7294117647058823, 0.5411764706, 0.2745098039, 0.0, 0.7333333333333333,\r\n      0.5490196078, 0.2901960784, 0.0, 0.7372549019607844, 0.5647058824, 0.2980392157, 0.0,\r\n      0.7411764705882353, 0.5725490196, 0.3058823529, 0.0, 0.7450980392156863, 0.5803921569,\r\n      0.3215686275, 0.0, 0.7490196078431373, 0.5882352941, 0.3294117647, 0.0, 0.7529411764705882,\r\n      0.6039215686, 0.337254902, 0.0, 0.7568627450980392, 0.6117647059, 0.3529411765, 0.0,\r\n      0.7607843137254902, 0.6196078431, 0.3607843137, 0.0, 0.7647058823529411, 0.6352941176,\r\n      0.368627451, 0.0, 0.7686274509803922, 0.6431372549, 0.3843137255, 0.0, 0.7725490196078432,\r\n      0.6509803922, 0.3921568627, 0.0, 0.7764705882352941, 0.6588235294, 0.4, 0.0,\r\n      0.7803921568627451, 0.6745098039, 0.4156862745, 0.0, 0.7843137254901961, 0.6823529412,\r\n      0.4235294118, 0.0, 0.788235294117647, 0.6901960784, 0.431372549, 0.0, 0.792156862745098,\r\n      0.7058823529, 0.4470588235, 0.0, 0.796078431372549, 0.7137254902, 0.4549019608, 0.0, 0.8,\r\n      0.7215686275, 0.462745098, 0.0, 0.803921568627451, 0.737254902, 0.4784313725, 0.0,\r\n      0.807843137254902, 0.7450980392, 0.4862745098, 0.0, 0.8117647058823529, 0.7529411765,\r\n      0.4941176471, 0.0, 0.8156862745098039, 0.7607843137, 0.5098039216, 0.0, 0.8196078431372549,\r\n      0.7764705882, 0.5176470588, 0.0, 0.8235294117647058, 0.7843137255, 0.5254901961, 0.0,\r\n      0.8274509803921568, 0.7921568627, 0.5411764706, 0.0, 0.8313725490196079, 0.8078431373,\r\n      0.5490196078, 0.0, 0.8352941176470589, 0.8156862745, 0.5568627451, 0.0, 0.8392156862745098,\r\n      0.8235294118, 0.5725490196, 0.0, 0.8431372549019608, 0.8392156863, 0.5803921569, 0.0,\r\n      0.8470588235294118, 0.8470588235, 0.5882352941, 0.0, 0.8509803921568627, 0.8549019608,\r\n      0.6039215686, 0.0, 0.8549019607843137, 0.862745098, 0.6117647059, 0.0, 0.8588235294117647,\r\n      0.8784313725, 0.6196078431, 0.0, 0.8627450980392157, 0.8862745098, 0.6352941176, 0.0,\r\n      0.8666666666666667, 0.8941176471, 0.6431372549, 0.0, 0.8705882352941177, 0.9098039216,\r\n      0.6509803922, 0.0, 0.8745098039215686, 0.9176470588, 0.6666666667, 0.0, 0.8784313725490196,\r\n      0.9254901961, 0.6745098039, 0.0, 0.8823529411764706, 0.9411764706, 0.6823529412, 0.0,\r\n      0.8862745098039215, 0.9490196078, 0.6980392157, 0.0, 0.8901960784313725, 0.9568627451,\r\n      0.7058823529, 0.0, 0.8941176470588236, 0.9647058824, 0.7137254902, 0.0, 0.8980392156862745,\r\n      0.9803921569, 0.7294117647, 0.0, 0.9019607843137255, 0.9882352941, 0.737254902, 0.0,\r\n      0.9058823529411765, 0.9960784314, 0.7450980392, 0.0, 0.9098039215686274, 0.9960784314,\r\n      0.7607843137, 0.0, 0.9137254901960784, 0.9960784314, 0.768627451, 0.0, 0.9176470588235294,\r\n      0.9960784314, 0.7764705882, 0.0, 0.9215686274509803, 0.9960784314, 0.7921568627, 0.0,\r\n      0.9254901960784314, 0.9960784314, 0.8, 0.0, 0.9294117647058824, 0.9960784314, 0.8078431373,\r\n      0.0, 0.9333333333333333, 0.9960784314, 0.8235294118, 0.0, 0.9372549019607843, 0.9960784314,\r\n      0.831372549, 0.0, 0.9411764705882354, 0.9960784314, 0.8392156863, 0.0, 0.9450980392156864,\r\n      0.9960784314, 0.8549019608, 0.0, 0.9490196078431372, 0.9960784314, 0.862745098, 0.0549019608,\r\n      0.9529411764705882, 0.9960784314, 0.8705882353, 0.1098039216, 0.9568627450980394,\r\n      0.9960784314, 0.8862745098, 0.1647058824, 0.9607843137254903, 0.9960784314, 0.8941176471,\r\n      0.2196078431, 0.9647058823529413, 0.9960784314, 0.9019607843, 0.2666666667,\r\n      0.9686274509803922, 0.9960784314, 0.9176470588, 0.3215686275, 0.9725490196078431,\r\n      0.9960784314, 0.9254901961, 0.3764705882, 0.9764705882352941, 0.9960784314, 0.9333333333,\r\n      0.431372549, 0.9803921568627451, 0.9960784314, 0.9490196078, 0.4862745098, 0.984313725490196,\r\n      0.9960784314, 0.9568627451, 0.5333333333, 0.9882352941176471, 0.9960784314, 0.9647058824,\r\n      0.5882352941, 0.9921568627450981, 0.9960784314, 0.9803921569, 0.6431372549, 0.996078431372549,\r\n      0.9960784314, 0.9882352941, 0.6980392157, 1.0, 0.9960784314, 0.9960784314, 0.7450980392,\r\n    ],\r\n    description: 'Perfusion',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'rainbow_2',\r\n    name: 'rainbow_2',\r\n    RGBPoints: [\r\n      0.0, 0.0, 0.0, 0.0, 0.00392156862745098, 0.0156862745, 0.0, 0.0117647059, 0.00784313725490196,\r\n      0.0352941176, 0.0, 0.0274509804, 0.011764705882352941, 0.0509803922, 0.0, 0.0392156863,\r\n      0.01568627450980392, 0.0705882353, 0.0, 0.0549019608, 0.0196078431372549, 0.0862745098, 0.0,\r\n      0.0745098039, 0.023529411764705882, 0.1058823529, 0.0, 0.0901960784, 0.027450980392156862,\r\n      0.1215686275, 0.0, 0.1098039216, 0.03137254901960784, 0.1411764706, 0.0, 0.1254901961,\r\n      0.03529411764705882, 0.1568627451, 0.0, 0.1490196078, 0.0392156862745098, 0.1764705882, 0.0,\r\n      0.168627451, 0.043137254901960784, 0.1960784314, 0.0, 0.1882352941, 0.047058823529411764,\r\n      0.2117647059, 0.0, 0.2078431373, 0.050980392156862744, 0.2274509804, 0.0, 0.231372549,\r\n      0.054901960784313725, 0.2392156863, 0.0, 0.2470588235, 0.05882352941176471, 0.2509803922, 0.0,\r\n      0.2666666667, 0.06274509803921569, 0.2666666667, 0.0, 0.2823529412, 0.06666666666666667,\r\n      0.2705882353, 0.0, 0.3019607843, 0.07058823529411765, 0.2823529412, 0.0, 0.3176470588,\r\n      0.07450980392156863, 0.2901960784, 0.0, 0.337254902, 0.0784313725490196, 0.3019607843, 0.0,\r\n      0.3568627451, 0.08235294117647059, 0.3098039216, 0.0, 0.3725490196, 0.08627450980392157,\r\n      0.3137254902, 0.0, 0.3921568627, 0.09019607843137255, 0.3215686275, 0.0, 0.4078431373,\r\n      0.09411764705882353, 0.3254901961, 0.0, 0.4274509804, 0.09803921568627451, 0.3333333333, 0.0,\r\n      0.4431372549, 0.10196078431372549, 0.3294117647, 0.0, 0.462745098, 0.10588235294117647,\r\n      0.337254902, 0.0, 0.4784313725, 0.10980392156862745, 0.3411764706, 0.0, 0.4980392157,\r\n      0.11372549019607843, 0.3450980392, 0.0, 0.5176470588, 0.11764705882352942, 0.337254902, 0.0,\r\n      0.5333333333, 0.12156862745098039, 0.3411764706, 0.0, 0.5529411765, 0.12549019607843137,\r\n      0.3411764706, 0.0, 0.568627451, 0.12941176470588237, 0.3411764706, 0.0, 0.5882352941,\r\n      0.13333333333333333, 0.3333333333, 0.0, 0.6039215686, 0.13725490196078433, 0.3294117647, 0.0,\r\n      0.6235294118, 0.1411764705882353, 0.3294117647, 0.0, 0.6392156863, 0.1450980392156863,\r\n      0.3294117647, 0.0, 0.6588235294, 0.14901960784313725, 0.3254901961, 0.0, 0.6784313725,\r\n      0.15294117647058825, 0.3098039216, 0.0, 0.6941176471, 0.1568627450980392, 0.3058823529, 0.0,\r\n      0.7137254902, 0.1607843137254902, 0.3019607843, 0.0, 0.7294117647, 0.16470588235294117,\r\n      0.2980392157, 0.0, 0.7490196078, 0.16862745098039217, 0.2784313725, 0.0, 0.7647058824,\r\n      0.17254901960784313, 0.2745098039, 0.0, 0.7843137255, 0.17647058823529413, 0.2666666667, 0.0,\r\n      0.8, 0.1803921568627451, 0.2588235294, 0.0, 0.8196078431, 0.1843137254901961, 0.2352941176,\r\n      0.0, 0.8392156863, 0.18823529411764706, 0.2274509804, 0.0, 0.8549019608, 0.19215686274509805,\r\n      0.2156862745, 0.0, 0.8745098039, 0.19607843137254902, 0.2078431373, 0.0, 0.8901960784, 0.2,\r\n      0.1803921569, 0.0, 0.9098039216, 0.20392156862745098, 0.168627451, 0.0, 0.9254901961,\r\n      0.20784313725490197, 0.1568627451, 0.0, 0.9450980392, 0.21176470588235294, 0.1411764706, 0.0,\r\n      0.9607843137, 0.21568627450980393, 0.1294117647, 0.0, 0.9803921569, 0.2196078431372549,\r\n      0.0980392157, 0.0, 1.0, 0.2235294117647059, 0.0823529412, 0.0, 1.0, 0.22745098039215686,\r\n      0.062745098, 0.0, 1.0, 0.23137254901960785, 0.0470588235, 0.0, 1.0, 0.23529411764705885,\r\n      0.0156862745, 0.0, 1.0, 0.23921568627450984, 0.0, 0.0, 1.0, 0.24313725490196078, 0.0,\r\n      0.0156862745, 1.0, 0.24705882352941178, 0.0, 0.031372549, 1.0, 0.25098039215686274, 0.0,\r\n      0.062745098, 1.0, 0.2549019607843137, 0.0, 0.0823529412, 1.0, 0.25882352941176473, 0.0,\r\n      0.0980392157, 1.0, 0.2627450980392157, 0.0, 0.1137254902, 1.0, 0.26666666666666666, 0.0,\r\n      0.1490196078, 1.0, 0.27058823529411763, 0.0, 0.1647058824, 1.0, 0.27450980392156865, 0.0,\r\n      0.1803921569, 1.0, 0.2784313725490196, 0.0, 0.2, 1.0, 0.2823529411764706, 0.0, 0.2156862745,\r\n      1.0, 0.28627450980392155, 0.0, 0.2470588235, 1.0, 0.2901960784313726, 0.0, 0.262745098, 1.0,\r\n      0.29411764705882354, 0.0, 0.2823529412, 1.0, 0.2980392156862745, 0.0, 0.2980392157, 1.0,\r\n      0.30196078431372547, 0.0, 0.3294117647, 1.0, 0.3058823529411765, 0.0, 0.3490196078, 1.0,\r\n      0.30980392156862746, 0.0, 0.3647058824, 1.0, 0.3137254901960784, 0.0, 0.3803921569, 1.0,\r\n      0.3176470588235294, 0.0, 0.4156862745, 1.0, 0.3215686274509804, 0.0, 0.431372549, 1.0,\r\n      0.3254901960784314, 0.0, 0.4470588235, 1.0, 0.32941176470588235, 0.0, 0.4666666667, 1.0,\r\n      0.3333333333333333, 0.0, 0.4980392157, 1.0, 0.33725490196078434, 0.0, 0.5137254902, 1.0,\r\n      0.3411764705882353, 0.0, 0.5294117647, 1.0, 0.34509803921568627, 0.0, 0.5490196078, 1.0,\r\n      0.34901960784313724, 0.0, 0.5647058824, 1.0, 0.35294117647058826, 0.0, 0.5960784314, 1.0,\r\n      0.3568627450980392, 0.0, 0.6156862745, 1.0, 0.3607843137254902, 0.0, 0.631372549, 1.0,\r\n      0.36470588235294116, 0.0, 0.6470588235, 1.0, 0.3686274509803922, 0.0, 0.6823529412, 1.0,\r\n      0.37254901960784315, 0.0, 0.6980392157, 1.0, 0.3764705882352941, 0.0, 0.7137254902, 1.0,\r\n      0.3803921568627451, 0.0, 0.7333333333, 1.0, 0.3843137254901961, 0.0, 0.7647058824, 1.0,\r\n      0.38823529411764707, 0.0, 0.7803921569, 1.0, 0.39215686274509803, 0.0, 0.7960784314, 1.0,\r\n      0.396078431372549, 0.0, 0.8156862745, 1.0, 0.4, 0.0, 0.8470588235, 1.0, 0.403921568627451,\r\n      0.0, 0.862745098, 1.0, 0.40784313725490196, 0.0, 0.8823529412, 1.0, 0.4117647058823529, 0.0,\r\n      0.8980392157, 1.0, 0.41568627450980394, 0.0, 0.9137254902, 1.0, 0.4196078431372549, 0.0,\r\n      0.9490196078, 1.0, 0.4235294117647059, 0.0, 0.9647058824, 1.0, 0.42745098039215684, 0.0,\r\n      0.9803921569, 1.0, 0.43137254901960786, 0.0, 1.0, 1.0, 0.43529411764705883, 0.0, 1.0,\r\n      0.9647058824, 0.4392156862745098, 0.0, 1.0, 0.9490196078, 0.44313725490196076, 0.0, 1.0,\r\n      0.9333333333, 0.4470588235294118, 0.0, 1.0, 0.9137254902, 0.45098039215686275, 0.0, 1.0,\r\n      0.8823529412, 0.4549019607843137, 0.0, 1.0, 0.862745098, 0.4588235294117647, 0.0, 1.0,\r\n      0.8470588235, 0.4627450980392157, 0.0, 1.0, 0.831372549, 0.4666666666666667, 0.0, 1.0,\r\n      0.7960784314, 0.4705882352941177, 0.0, 1.0, 0.7803921569, 0.4745098039215686, 0.0, 1.0,\r\n      0.7647058824, 0.4784313725490197, 0.0, 1.0, 0.7490196078, 0.48235294117647065, 0.0, 1.0,\r\n      0.7333333333, 0.48627450980392156, 0.0, 1.0, 0.6980392157, 0.49019607843137253, 0.0, 1.0,\r\n      0.6823529412, 0.49411764705882355, 0.0, 1.0, 0.6666666667, 0.4980392156862745, 0.0, 1.0,\r\n      0.6470588235, 0.5019607843137255, 0.0, 1.0, 0.6156862745, 0.5058823529411764, 0.0, 1.0,\r\n      0.5960784314, 0.5098039215686274, 0.0, 1.0, 0.5803921569, 0.5137254901960784, 0.0, 1.0,\r\n      0.5647058824, 0.5176470588235295, 0.0, 1.0, 0.5294117647, 0.5215686274509804, 0.0, 1.0,\r\n      0.5137254902, 0.5254901960784314, 0.0, 1.0, 0.4980392157, 0.5294117647058824, 0.0, 1.0,\r\n      0.4823529412, 0.5333333333333333, 0.0, 1.0, 0.4470588235, 0.5372549019607843, 0.0, 1.0,\r\n      0.431372549, 0.5411764705882353, 0.0, 1.0, 0.4156862745, 0.5450980392156862, 0.0, 1.0, 0.4,\r\n      0.5490196078431373, 0.0, 1.0, 0.3803921569, 0.5529411764705883, 0.0, 1.0, 0.3490196078,\r\n      0.5568627450980392, 0.0, 1.0, 0.3294117647, 0.5607843137254902, 0.0, 1.0, 0.3137254902,\r\n      0.5647058823529412, 0.0, 1.0, 0.2980392157, 0.5686274509803921, 0.0, 1.0, 0.262745098,\r\n      0.5725490196078431, 0.0, 1.0, 0.2470588235, 0.5764705882352941, 0.0, 1.0, 0.231372549,\r\n      0.5803921568627451, 0.0, 1.0, 0.2156862745, 0.5843137254901961, 0.0, 1.0, 0.1803921569,\r\n      0.5882352941176471, 0.0, 1.0, 0.1647058824, 0.592156862745098, 0.0, 1.0, 0.1490196078,\r\n      0.596078431372549, 0.0, 1.0, 0.1333333333, 0.6, 0.0, 1.0, 0.0980392157, 0.6039215686274509,\r\n      0.0, 1.0, 0.0823529412, 0.6078431372549019, 0.0, 1.0, 0.062745098, 0.611764705882353, 0.0,\r\n      1.0, 0.0470588235, 0.615686274509804, 0.0, 1.0, 0.031372549, 0.6196078431372549, 0.0, 1.0,\r\n      0.0, 0.6235294117647059, 0.0156862745, 1.0, 0.0, 0.6274509803921569, 0.031372549, 1.0, 0.0,\r\n      0.6313725490196078, 0.0470588235, 1.0, 0.0, 0.6352941176470588, 0.0823529412, 1.0, 0.0,\r\n      0.6392156862745098, 0.0980392157, 1.0, 0.0, 0.6431372549019608, 0.1137254902, 1.0, 0.0,\r\n      0.6470588235294118, 0.1294117647, 1.0, 0.0, 0.6509803921568628, 0.1647058824, 1.0, 0.0,\r\n      0.6549019607843137, 0.1803921569, 1.0, 0.0, 0.6588235294117647, 0.2, 1.0, 0.0,\r\n      0.6627450980392157, 0.2156862745, 1.0, 0.0, 0.6666666666666666, 0.2470588235, 1.0, 0.0,\r\n      0.6705882352941176, 0.262745098, 1.0, 0.0, 0.6745098039215687, 0.2823529412, 1.0, 0.0,\r\n      0.6784313725490196, 0.2980392157, 1.0, 0.0, 0.6823529411764706, 0.3137254902, 1.0, 0.0,\r\n      0.6862745098039216, 0.3490196078, 1.0, 0.0, 0.6901960784313725, 0.3647058824, 1.0, 0.0,\r\n      0.6941176470588235, 0.3803921569, 1.0, 0.0, 0.6980392156862745, 0.3960784314, 1.0, 0.0,\r\n      0.7019607843137254, 0.431372549, 1.0, 0.0, 0.7058823529411765, 0.4470588235, 1.0, 0.0,\r\n      0.7098039215686275, 0.4666666667, 1.0, 0.0, 0.7137254901960784, 0.4823529412, 1.0, 0.0,\r\n      0.7176470588235294, 0.5137254902, 1.0, 0.0, 0.7215686274509804, 0.5294117647, 1.0, 0.0,\r\n      0.7254901960784313, 0.5490196078, 1.0, 0.0, 0.7294117647058823, 0.5647058824, 1.0, 0.0,\r\n      0.7333333333333333, 0.6, 1.0, 0.0, 0.7372549019607844, 0.6156862745, 1.0, 0.0,\r\n      0.7411764705882353, 0.631372549, 1.0, 0.0, 0.7450980392156863, 0.6470588235, 1.0, 0.0,\r\n      0.7490196078431373, 0.662745098, 1.0, 0.0, 0.7529411764705882, 0.6980392157, 1.0, 0.0,\r\n      0.7568627450980392, 0.7137254902, 1.0, 0.0, 0.7607843137254902, 0.7333333333, 1.0, 0.0,\r\n      0.7647058823529411, 0.7490196078, 1.0, 0.0, 0.7686274509803922, 0.7803921569, 1.0, 0.0,\r\n      0.7725490196078432, 0.7960784314, 1.0, 0.0, 0.7764705882352941, 0.8156862745, 1.0, 0.0,\r\n      0.7803921568627451, 0.831372549, 1.0, 0.0, 0.7843137254901961, 0.8666666667, 1.0, 0.0,\r\n      0.788235294117647, 0.8823529412, 1.0, 0.0, 0.792156862745098, 0.8980392157, 1.0, 0.0,\r\n      0.796078431372549, 0.9137254902, 1.0, 0.0, 0.8, 0.9490196078, 1.0, 0.0, 0.803921568627451,\r\n      0.9647058824, 1.0, 0.0, 0.807843137254902, 0.9803921569, 1.0, 0.0, 0.8117647058823529, 1.0,\r\n      1.0, 0.0, 0.8156862745098039, 1.0, 0.9803921569, 0.0, 0.8196078431372549, 1.0, 0.9490196078,\r\n      0.0, 0.8235294117647058, 1.0, 0.9333333333, 0.0, 0.8274509803921568, 1.0, 0.9137254902, 0.0,\r\n      0.8313725490196079, 1.0, 0.8980392157, 0.0, 0.8352941176470589, 1.0, 0.8666666667, 0.0,\r\n      0.8392156862745098, 1.0, 0.8470588235, 0.0, 0.8431372549019608, 1.0, 0.831372549, 0.0,\r\n      0.8470588235294118, 1.0, 0.8156862745, 0.0, 0.8509803921568627, 1.0, 0.7803921569, 0.0,\r\n      0.8549019607843137, 1.0, 0.7647058824, 0.0, 0.8588235294117647, 1.0, 0.7490196078, 0.0,\r\n      0.8627450980392157, 1.0, 0.7333333333, 0.0, 0.8666666666666667, 1.0, 0.6980392157, 0.0,\r\n      0.8705882352941177, 1.0, 0.6823529412, 0.0, 0.8745098039215686, 1.0, 0.6666666667, 0.0,\r\n      0.8784313725490196, 1.0, 0.6470588235, 0.0, 0.8823529411764706, 1.0, 0.631372549, 0.0,\r\n      0.8862745098039215, 1.0, 0.6, 0.0, 0.8901960784313725, 1.0, 0.5803921569, 0.0,\r\n      0.8941176470588236, 1.0, 0.5647058824, 0.0, 0.8980392156862745, 1.0, 0.5490196078, 0.0,\r\n      0.9019607843137255, 1.0, 0.5137254902, 0.0, 0.9058823529411765, 1.0, 0.4980392157, 0.0,\r\n      0.9098039215686274, 1.0, 0.4823529412, 0.0, 0.9137254901960784, 1.0, 0.4666666667, 0.0,\r\n      0.9176470588235294, 1.0, 0.431372549, 0.0, 0.9215686274509803, 1.0, 0.4156862745, 0.0,\r\n      0.9254901960784314, 1.0, 0.4, 0.0, 0.9294117647058824, 1.0, 0.3803921569, 0.0,\r\n      0.9333333333333333, 1.0, 0.3490196078, 0.0, 0.9372549019607843, 1.0, 0.3333333333, 0.0,\r\n      0.9411764705882354, 1.0, 0.3137254902, 0.0, 0.9450980392156864, 1.0, 0.2980392157, 0.0,\r\n      0.9490196078431372, 1.0, 0.2823529412, 0.0, 0.9529411764705882, 1.0, 0.2470588235, 0.0,\r\n      0.9568627450980394, 1.0, 0.231372549, 0.0, 0.9607843137254903, 1.0, 0.2156862745, 0.0,\r\n      0.9647058823529413, 1.0, 0.2, 0.0, 0.9686274509803922, 1.0, 0.1647058824, 0.0,\r\n      0.9725490196078431, 1.0, 0.1490196078, 0.0, 0.9764705882352941, 1.0, 0.1333333333, 0.0,\r\n      0.9803921568627451, 1.0, 0.1137254902, 0.0, 0.984313725490196, 1.0, 0.0823529412, 0.0,\r\n      0.9882352941176471, 1.0, 0.0666666667, 0.0, 0.9921568627450981, 1.0, 0.0470588235, 0.0,\r\n      0.996078431372549, 1.0, 0.031372549, 0.0, 1.0, 1.0, 0.0, 0.0,\r\n    ],\r\n    description: 'Rainbow',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'suv',\r\n    name: 'suv',\r\n    RGBPoints: [\r\n      0.0, 1.0, 1.0, 1.0, 0.00392156862745098, 1.0, 1.0, 1.0, 0.00784313725490196, 1.0, 1.0, 1.0,\r\n      0.011764705882352941, 1.0, 1.0, 1.0, 0.01568627450980392, 1.0, 1.0, 1.0, 0.0196078431372549,\r\n      1.0, 1.0, 1.0, 0.023529411764705882, 1.0, 1.0, 1.0, 0.027450980392156862, 1.0, 1.0, 1.0,\r\n      0.03137254901960784, 1.0, 1.0, 1.0, 0.03529411764705882, 1.0, 1.0, 1.0, 0.0392156862745098,\r\n      1.0, 1.0, 1.0, 0.043137254901960784, 1.0, 1.0, 1.0, 0.047058823529411764, 1.0, 1.0, 1.0,\r\n      0.050980392156862744, 1.0, 1.0, 1.0, 0.054901960784313725, 1.0, 1.0, 1.0, 0.05882352941176471,\r\n      1.0, 1.0, 1.0, 0.06274509803921569, 1.0, 1.0, 1.0, 0.06666666666666667, 1.0, 1.0, 1.0,\r\n      0.07058823529411765, 1.0, 1.0, 1.0, 0.07450980392156863, 1.0, 1.0, 1.0, 0.0784313725490196,\r\n      1.0, 1.0, 1.0, 0.08235294117647059, 1.0, 1.0, 1.0, 0.08627450980392157, 1.0, 1.0, 1.0,\r\n      0.09019607843137255, 1.0, 1.0, 1.0, 0.09411764705882353, 1.0, 1.0, 1.0, 0.09803921568627451,\r\n      1.0, 1.0, 1.0, 0.10196078431372549, 0.737254902, 0.737254902, 0.737254902,\r\n      0.10588235294117647, 0.737254902, 0.737254902, 0.737254902, 0.10980392156862745, 0.737254902,\r\n      0.737254902, 0.737254902, 0.11372549019607843, 0.737254902, 0.737254902, 0.737254902,\r\n      0.11764705882352942, 0.737254902, 0.737254902, 0.737254902, 0.12156862745098039, 0.737254902,\r\n      0.737254902, 0.737254902, 0.12549019607843137, 0.737254902, 0.737254902, 0.737254902,\r\n      0.12941176470588237, 0.737254902, 0.737254902, 0.737254902, 0.13333333333333333, 0.737254902,\r\n      0.737254902, 0.737254902, 0.13725490196078433, 0.737254902, 0.737254902, 0.737254902,\r\n      0.1411764705882353, 0.737254902, 0.737254902, 0.737254902, 0.1450980392156863, 0.737254902,\r\n      0.737254902, 0.737254902, 0.14901960784313725, 0.737254902, 0.737254902, 0.737254902,\r\n      0.15294117647058825, 0.737254902, 0.737254902, 0.737254902, 0.1568627450980392, 0.737254902,\r\n      0.737254902, 0.737254902, 0.1607843137254902, 0.737254902, 0.737254902, 0.737254902,\r\n      0.16470588235294117, 0.737254902, 0.737254902, 0.737254902, 0.16862745098039217, 0.737254902,\r\n      0.737254902, 0.737254902, 0.17254901960784313, 0.737254902, 0.737254902, 0.737254902,\r\n      0.17647058823529413, 0.737254902, 0.737254902, 0.737254902, 0.1803921568627451, 0.737254902,\r\n      0.737254902, 0.737254902, 0.1843137254901961, 0.737254902, 0.737254902, 0.737254902,\r\n      0.18823529411764706, 0.737254902, 0.737254902, 0.737254902, 0.19215686274509805, 0.737254902,\r\n      0.737254902, 0.737254902, 0.19607843137254902, 0.737254902, 0.737254902, 0.737254902, 0.2,\r\n      0.737254902, 0.737254902, 0.737254902, 0.20392156862745098, 0.431372549, 0.0, 0.568627451,\r\n      0.20784313725490197, 0.431372549, 0.0, 0.568627451, 0.21176470588235294, 0.431372549, 0.0,\r\n      0.568627451, 0.21568627450980393, 0.431372549, 0.0, 0.568627451, 0.2196078431372549,\r\n      0.431372549, 0.0, 0.568627451, 0.2235294117647059, 0.431372549, 0.0, 0.568627451,\r\n      0.22745098039215686, 0.431372549, 0.0, 0.568627451, 0.23137254901960785, 0.431372549, 0.0,\r\n      0.568627451, 0.23529411764705885, 0.431372549, 0.0, 0.568627451, 0.23921568627450984,\r\n      0.431372549, 0.0, 0.568627451, 0.24313725490196078, 0.431372549, 0.0, 0.568627451,\r\n      0.24705882352941178, 0.431372549, 0.0, 0.568627451, 0.25098039215686274, 0.431372549, 0.0,\r\n      0.568627451, 0.2549019607843137, 0.431372549, 0.0, 0.568627451, 0.25882352941176473,\r\n      0.431372549, 0.0, 0.568627451, 0.2627450980392157, 0.431372549, 0.0, 0.568627451,\r\n      0.26666666666666666, 0.431372549, 0.0, 0.568627451, 0.27058823529411763, 0.431372549, 0.0,\r\n      0.568627451, 0.27450980392156865, 0.431372549, 0.0, 0.568627451, 0.2784313725490196,\r\n      0.431372549, 0.0, 0.568627451, 0.2823529411764706, 0.431372549, 0.0, 0.568627451,\r\n      0.28627450980392155, 0.431372549, 0.0, 0.568627451, 0.2901960784313726, 0.431372549, 0.0,\r\n      0.568627451, 0.29411764705882354, 0.431372549, 0.0, 0.568627451, 0.2980392156862745,\r\n      0.431372549, 0.0, 0.568627451, 0.30196078431372547, 0.431372549, 0.0, 0.568627451,\r\n      0.3058823529411765, 0.2509803922, 0.3333333333, 0.6509803922, 0.30980392156862746,\r\n      0.2509803922, 0.3333333333, 0.6509803922, 0.3137254901960784, 0.2509803922, 0.3333333333,\r\n      0.6509803922, 0.3176470588235294, 0.2509803922, 0.3333333333, 0.6509803922,\r\n      0.3215686274509804, 0.2509803922, 0.3333333333, 0.6509803922, 0.3254901960784314,\r\n      0.2509803922, 0.3333333333, 0.6509803922, 0.32941176470588235, 0.2509803922, 0.3333333333,\r\n      0.6509803922, 0.3333333333333333, 0.2509803922, 0.3333333333, 0.6509803922,\r\n      0.33725490196078434, 0.2509803922, 0.3333333333, 0.6509803922, 0.3411764705882353,\r\n      0.2509803922, 0.3333333333, 0.6509803922, 0.34509803921568627, 0.2509803922, 0.3333333333,\r\n      0.6509803922, 0.34901960784313724, 0.2509803922, 0.3333333333, 0.6509803922,\r\n      0.35294117647058826, 0.2509803922, 0.3333333333, 0.6509803922, 0.3568627450980392,\r\n      0.2509803922, 0.3333333333, 0.6509803922, 0.3607843137254902, 0.2509803922, 0.3333333333,\r\n      0.6509803922, 0.36470588235294116, 0.2509803922, 0.3333333333, 0.6509803922,\r\n      0.3686274509803922, 0.2509803922, 0.3333333333, 0.6509803922, 0.37254901960784315,\r\n      0.2509803922, 0.3333333333, 0.6509803922, 0.3764705882352941, 0.2509803922, 0.3333333333,\r\n      0.6509803922, 0.3803921568627451, 0.2509803922, 0.3333333333, 0.6509803922,\r\n      0.3843137254901961, 0.2509803922, 0.3333333333, 0.6509803922, 0.38823529411764707,\r\n      0.2509803922, 0.3333333333, 0.6509803922, 0.39215686274509803, 0.2509803922, 0.3333333333,\r\n      0.6509803922, 0.396078431372549, 0.2509803922, 0.3333333333, 0.6509803922, 0.4, 0.2509803922,\r\n      0.3333333333, 0.6509803922, 0.403921568627451, 0.2509803922, 0.3333333333, 0.6509803922,\r\n      0.40784313725490196, 0.0, 0.8, 1.0, 0.4117647058823529, 0.0, 0.8, 1.0, 0.41568627450980394,\r\n      0.0, 0.8, 1.0, 0.4196078431372549, 0.0, 0.8, 1.0, 0.4235294117647059, 0.0, 0.8, 1.0,\r\n      0.42745098039215684, 0.0, 0.8, 1.0, 0.43137254901960786, 0.0, 0.8, 1.0, 0.43529411764705883,\r\n      0.0, 0.8, 1.0, 0.4392156862745098, 0.0, 0.8, 1.0, 0.44313725490196076, 0.0, 0.8, 1.0,\r\n      0.4470588235294118, 0.0, 0.8, 1.0, 0.45098039215686275, 0.0, 0.8, 1.0, 0.4549019607843137,\r\n      0.0, 0.8, 1.0, 0.4588235294117647, 0.0, 0.8, 1.0, 0.4627450980392157, 0.0, 0.8, 1.0,\r\n      0.4666666666666667, 0.0, 0.8, 1.0, 0.4705882352941177, 0.0, 0.8, 1.0, 0.4745098039215686, 0.0,\r\n      0.8, 1.0, 0.4784313725490197, 0.0, 0.8, 1.0, 0.48235294117647065, 0.0, 0.8, 1.0,\r\n      0.48627450980392156, 0.0, 0.8, 1.0, 0.49019607843137253, 0.0, 0.8, 1.0, 0.49411764705882355,\r\n      0.0, 0.8, 1.0, 0.4980392156862745, 0.0, 0.8, 1.0, 0.5019607843137255, 0.0, 0.8, 1.0,\r\n      0.5058823529411764, 0.0, 0.6666666667, 0.5333333333, 0.5098039215686274, 0.0, 0.6666666667,\r\n      0.5333333333, 0.5137254901960784, 0.0, 0.6666666667, 0.5333333333, 0.5176470588235295, 0.0,\r\n      0.6666666667, 0.5333333333, 0.5215686274509804, 0.0, 0.6666666667, 0.5333333333,\r\n      0.5254901960784314, 0.0, 0.6666666667, 0.5333333333, 0.5294117647058824, 0.0, 0.6666666667,\r\n      0.5333333333, 0.5333333333333333, 0.0, 0.6666666667, 0.5333333333, 0.5372549019607843, 0.0,\r\n      0.6666666667, 0.5333333333, 0.5411764705882353, 0.0, 0.6666666667, 0.5333333333,\r\n      0.5450980392156862, 0.0, 0.6666666667, 0.5333333333, 0.5490196078431373, 0.0, 0.6666666667,\r\n      0.5333333333, 0.5529411764705883, 0.0, 0.6666666667, 0.5333333333, 0.5568627450980392, 0.0,\r\n      0.6666666667, 0.5333333333, 0.5607843137254902, 0.0, 0.6666666667, 0.5333333333,\r\n      0.5647058823529412, 0.0, 0.6666666667, 0.5333333333, 0.5686274509803921, 0.0, 0.6666666667,\r\n      0.5333333333, 0.5725490196078431, 0.0, 0.6666666667, 0.5333333333, 0.5764705882352941, 0.0,\r\n      0.6666666667, 0.5333333333, 0.5803921568627451, 0.0, 0.6666666667, 0.5333333333,\r\n      0.5843137254901961, 0.0, 0.6666666667, 0.5333333333, 0.5882352941176471, 0.0, 0.6666666667,\r\n      0.5333333333, 0.592156862745098, 0.0, 0.6666666667, 0.5333333333, 0.596078431372549, 0.0,\r\n      0.6666666667, 0.5333333333, 0.6, 0.0, 0.6666666667, 0.5333333333, 0.6039215686274509, 0.0,\r\n      0.6666666667, 0.5333333333, 0.6078431372549019, 0.4, 1.0, 0.4, 0.611764705882353, 0.4, 1.0,\r\n      0.4, 0.615686274509804, 0.4, 1.0, 0.4, 0.6196078431372549, 0.4, 1.0, 0.4, 0.6235294117647059,\r\n      0.4, 1.0, 0.4, 0.6274509803921569, 0.4, 1.0, 0.4, 0.6313725490196078, 0.4, 1.0, 0.4,\r\n      0.6352941176470588, 0.4, 1.0, 0.4, 0.6392156862745098, 0.4, 1.0, 0.4, 0.6431372549019608, 0.4,\r\n      1.0, 0.4, 0.6470588235294118, 0.4, 1.0, 0.4, 0.6509803921568628, 0.4, 1.0, 0.4,\r\n      0.6549019607843137, 0.4, 1.0, 0.4, 0.6588235294117647, 0.4, 1.0, 0.4, 0.6627450980392157, 0.4,\r\n      1.0, 0.4, 0.6666666666666666, 0.4, 1.0, 0.4, 0.6705882352941176, 0.4, 1.0, 0.4,\r\n      0.6745098039215687, 0.4, 1.0, 0.4, 0.6784313725490196, 0.4, 1.0, 0.4, 0.6823529411764706, 0.4,\r\n      1.0, 0.4, 0.6862745098039216, 0.4, 1.0, 0.4, 0.6901960784313725, 0.4, 1.0, 0.4,\r\n      0.6941176470588235, 0.4, 1.0, 0.4, 0.6980392156862745, 0.4, 1.0, 0.4, 0.7019607843137254, 0.4,\r\n      1.0, 0.4, 0.7058823529411765, 1.0, 0.9490196078, 0.0, 0.7098039215686275, 1.0, 0.9490196078,\r\n      0.0, 0.7137254901960784, 1.0, 0.9490196078, 0.0, 0.7176470588235294, 1.0, 0.9490196078, 0.0,\r\n      0.7215686274509804, 1.0, 0.9490196078, 0.0, 0.7254901960784313, 1.0, 0.9490196078, 0.0,\r\n      0.7294117647058823, 1.0, 0.9490196078, 0.0, 0.7333333333333333, 1.0, 0.9490196078, 0.0,\r\n      0.7372549019607844, 1.0, 0.9490196078, 0.0, 0.7411764705882353, 1.0, 0.9490196078, 0.0,\r\n      0.7450980392156863, 1.0, 0.9490196078, 0.0, 0.7490196078431373, 1.0, 0.9490196078, 0.0,\r\n      0.7529411764705882, 1.0, 0.9490196078, 0.0, 0.7568627450980392, 1.0, 0.9490196078, 0.0,\r\n      0.7607843137254902, 1.0, 0.9490196078, 0.0, 0.7647058823529411, 1.0, 0.9490196078, 0.0,\r\n      0.7686274509803922, 1.0, 0.9490196078, 0.0, 0.7725490196078432, 1.0, 0.9490196078, 0.0,\r\n      0.7764705882352941, 1.0, 0.9490196078, 0.0, 0.7803921568627451, 1.0, 0.9490196078, 0.0,\r\n      0.7843137254901961, 1.0, 0.9490196078, 0.0, 0.788235294117647, 1.0, 0.9490196078, 0.0,\r\n      0.792156862745098, 1.0, 0.9490196078, 0.0, 0.796078431372549, 1.0, 0.9490196078, 0.0, 0.8,\r\n      1.0, 0.9490196078, 0.0, 0.803921568627451, 1.0, 0.9490196078, 0.0, 0.807843137254902,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.8117647058823529, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.8156862745098039, 0.9490196078, 0.6509803922, 0.2509803922,\r\n      0.8196078431372549, 0.9490196078, 0.6509803922, 0.2509803922, 0.8235294117647058,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.8274509803921568, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.8313725490196079, 0.9490196078, 0.6509803922, 0.2509803922,\r\n      0.8352941176470589, 0.9490196078, 0.6509803922, 0.2509803922, 0.8392156862745098,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.8431372549019608, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.8470588235294118, 0.9490196078, 0.6509803922, 0.2509803922,\r\n      0.8509803921568627, 0.9490196078, 0.6509803922, 0.2509803922, 0.8549019607843137,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.8588235294117647, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.8627450980392157, 0.9490196078, 0.6509803922, 0.2509803922,\r\n      0.8666666666666667, 0.9490196078, 0.6509803922, 0.2509803922, 0.8705882352941177,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.8745098039215686, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.8784313725490196, 0.9490196078, 0.6509803922, 0.2509803922,\r\n      0.8823529411764706, 0.9490196078, 0.6509803922, 0.2509803922, 0.8862745098039215,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.8901960784313725, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.8941176470588236, 0.9490196078, 0.6509803922, 0.2509803922,\r\n      0.8980392156862745, 0.9490196078, 0.6509803922, 0.2509803922, 0.9019607843137255,\r\n      0.9490196078, 0.6509803922, 0.2509803922, 0.9058823529411765, 0.9490196078, 0.6509803922,\r\n      0.2509803922, 0.9098039215686274, 1.0, 0.0, 0.0, 0.9137254901960784, 1.0, 0.0, 0.0,\r\n      0.9176470588235294, 1.0, 0.0, 0.0, 0.9215686274509803, 1.0, 0.0, 0.0, 0.9254901960784314, 1.0,\r\n      0.0, 0.0, 0.9294117647058824, 1.0, 0.0, 0.0, 0.9333333333333333, 1.0, 0.0, 0.0,\r\n      0.9372549019607843, 1.0, 0.0, 0.0, 0.9411764705882354, 1.0, 0.0, 0.0, 0.9450980392156864, 1.0,\r\n      0.0, 0.0, 0.9490196078431372, 1.0, 0.0, 0.0, 0.9529411764705882, 1.0, 0.0, 0.0,\r\n      0.9568627450980394, 1.0, 0.0, 0.0, 0.9607843137254903, 1.0, 0.0, 0.0, 0.9647058823529413, 1.0,\r\n      0.0, 0.0, 0.9686274509803922, 1.0, 0.0, 0.0, 0.9725490196078431, 1.0, 0.0, 0.0,\r\n      0.9764705882352941, 1.0, 0.0, 0.0, 0.9803921568627451, 1.0, 0.0, 0.0, 0.984313725490196, 1.0,\r\n      0.0, 0.0, 0.9882352941176471, 1.0, 0.0, 0.0, 0.9921568627450981, 1.0, 0.0, 0.0,\r\n      0.996078431372549, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0,\r\n    ],\r\n    description: 'SUV',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'ge_256',\r\n    name: 'ge_256',\r\n    RGBPoints: [\r\n      0.0, 0.0039215686, 0.0078431373, 0.0078431373, 0.00392156862745098, 0.0039215686,\r\n      0.0078431373, 0.0078431373, 0.00784313725490196, 0.0039215686, 0.0078431373, 0.0117647059,\r\n      0.011764705882352941, 0.0039215686, 0.0117647059, 0.0156862745, 0.01568627450980392,\r\n      0.0039215686, 0.0117647059, 0.0196078431, 0.0196078431372549, 0.0039215686, 0.0156862745,\r\n      0.0235294118, 0.023529411764705882, 0.0039215686, 0.0156862745, 0.0274509804,\r\n      0.027450980392156862, 0.0039215686, 0.0196078431, 0.031372549, 0.03137254901960784,\r\n      0.0039215686, 0.0196078431, 0.0352941176, 0.03529411764705882, 0.0039215686, 0.0235294118,\r\n      0.0392156863, 0.0392156862745098, 0.0039215686, 0.0235294118, 0.0431372549,\r\n      0.043137254901960784, 0.0039215686, 0.0274509804, 0.0470588235, 0.047058823529411764,\r\n      0.0039215686, 0.0274509804, 0.0509803922, 0.050980392156862744, 0.0039215686, 0.031372549,\r\n      0.0549019608, 0.054901960784313725, 0.0039215686, 0.031372549, 0.0588235294,\r\n      0.05882352941176471, 0.0039215686, 0.0352941176, 0.062745098, 0.06274509803921569,\r\n      0.0039215686, 0.0352941176, 0.0666666667, 0.06666666666666667, 0.0039215686, 0.0392156863,\r\n      0.0705882353, 0.07058823529411765, 0.0039215686, 0.0392156863, 0.0745098039,\r\n      0.07450980392156863, 0.0039215686, 0.0431372549, 0.0784313725, 0.0784313725490196,\r\n      0.0039215686, 0.0431372549, 0.0823529412, 0.08235294117647059, 0.0039215686, 0.0470588235,\r\n      0.0862745098, 0.08627450980392157, 0.0039215686, 0.0470588235, 0.0901960784,\r\n      0.09019607843137255, 0.0039215686, 0.0509803922, 0.0941176471, 0.09411764705882353,\r\n      0.0039215686, 0.0509803922, 0.0980392157, 0.09803921568627451, 0.0039215686, 0.0549019608,\r\n      0.1019607843, 0.10196078431372549, 0.0039215686, 0.0549019608, 0.1058823529,\r\n      0.10588235294117647, 0.0039215686, 0.0588235294, 0.1098039216, 0.10980392156862745,\r\n      0.0039215686, 0.0588235294, 0.1137254902, 0.11372549019607843, 0.0039215686, 0.062745098,\r\n      0.1176470588, 0.11764705882352942, 0.0039215686, 0.062745098, 0.1215686275,\r\n      0.12156862745098039, 0.0039215686, 0.0666666667, 0.1254901961, 0.12549019607843137,\r\n      0.0039215686, 0.0666666667, 0.1294117647, 0.12941176470588237, 0.0039215686, 0.0705882353,\r\n      0.1333333333, 0.13333333333333333, 0.0039215686, 0.0705882353, 0.137254902,\r\n      0.13725490196078433, 0.0039215686, 0.0745098039, 0.1411764706, 0.1411764705882353,\r\n      0.0039215686, 0.0745098039, 0.1450980392, 0.1450980392156863, 0.0039215686, 0.0784313725,\r\n      0.1490196078, 0.14901960784313725, 0.0039215686, 0.0784313725, 0.1529411765,\r\n      0.15294117647058825, 0.0039215686, 0.0823529412, 0.1568627451, 0.1568627450980392,\r\n      0.0039215686, 0.0823529412, 0.1607843137, 0.1607843137254902, 0.0039215686, 0.0862745098,\r\n      0.1647058824, 0.16470588235294117, 0.0039215686, 0.0862745098, 0.168627451,\r\n      0.16862745098039217, 0.0039215686, 0.0901960784, 0.1725490196, 0.17254901960784313,\r\n      0.0039215686, 0.0901960784, 0.1764705882, 0.17647058823529413, 0.0039215686, 0.0941176471,\r\n      0.1803921569, 0.1803921568627451, 0.0039215686, 0.0941176471, 0.1843137255,\r\n      0.1843137254901961, 0.0039215686, 0.0980392157, 0.1882352941, 0.18823529411764706,\r\n      0.0039215686, 0.0980392157, 0.1921568627, 0.19215686274509805, 0.0039215686, 0.1019607843,\r\n      0.1960784314, 0.19607843137254902, 0.0039215686, 0.1019607843, 0.2, 0.2, 0.0039215686,\r\n      0.1058823529, 0.2039215686, 0.20392156862745098, 0.0039215686, 0.1058823529, 0.2078431373,\r\n      0.20784313725490197, 0.0039215686, 0.1098039216, 0.2117647059, 0.21176470588235294,\r\n      0.0039215686, 0.1098039216, 0.2156862745, 0.21568627450980393, 0.0039215686, 0.1137254902,\r\n      0.2196078431, 0.2196078431372549, 0.0039215686, 0.1137254902, 0.2235294118,\r\n      0.2235294117647059, 0.0039215686, 0.1176470588, 0.2274509804, 0.22745098039215686,\r\n      0.0039215686, 0.1176470588, 0.231372549, 0.23137254901960785, 0.0039215686, 0.1215686275,\r\n      0.2352941176, 0.23529411764705885, 0.0039215686, 0.1215686275, 0.2392156863,\r\n      0.23921568627450984, 0.0039215686, 0.1254901961, 0.2431372549, 0.24313725490196078,\r\n      0.0039215686, 0.1254901961, 0.2470588235, 0.24705882352941178, 0.0039215686, 0.1294117647,\r\n      0.2509803922, 0.25098039215686274, 0.0039215686, 0.1294117647, 0.2509803922,\r\n      0.2549019607843137, 0.0078431373, 0.1254901961, 0.2549019608, 0.25882352941176473,\r\n      0.0156862745, 0.1254901961, 0.2588235294, 0.2627450980392157, 0.0235294118, 0.1215686275,\r\n      0.262745098, 0.26666666666666666, 0.031372549, 0.1215686275, 0.2666666667,\r\n      0.27058823529411763, 0.0392156863, 0.1176470588, 0.2705882353, 0.27450980392156865,\r\n      0.0470588235, 0.1176470588, 0.2745098039, 0.2784313725490196, 0.0549019608, 0.1137254902,\r\n      0.2784313725, 0.2823529411764706, 0.062745098, 0.1137254902, 0.2823529412,\r\n      0.28627450980392155, 0.0705882353, 0.1098039216, 0.2862745098, 0.2901960784313726,\r\n      0.0784313725, 0.1098039216, 0.2901960784, 0.29411764705882354, 0.0862745098, 0.1058823529,\r\n      0.2941176471, 0.2980392156862745, 0.0941176471, 0.1058823529, 0.2980392157,\r\n      0.30196078431372547, 0.1019607843, 0.1019607843, 0.3019607843, 0.3058823529411765,\r\n      0.1098039216, 0.1019607843, 0.3058823529, 0.30980392156862746, 0.1176470588, 0.0980392157,\r\n      0.3098039216, 0.3137254901960784, 0.1254901961, 0.0980392157, 0.3137254902,\r\n      0.3176470588235294, 0.1333333333, 0.0941176471, 0.3176470588, 0.3215686274509804,\r\n      0.1411764706, 0.0941176471, 0.3215686275, 0.3254901960784314, 0.1490196078, 0.0901960784,\r\n      0.3254901961, 0.32941176470588235, 0.1568627451, 0.0901960784, 0.3294117647,\r\n      0.3333333333333333, 0.1647058824, 0.0862745098, 0.3333333333, 0.33725490196078434,\r\n      0.1725490196, 0.0862745098, 0.337254902, 0.3411764705882353, 0.1803921569, 0.0823529412,\r\n      0.3411764706, 0.34509803921568627, 0.1882352941, 0.0823529412, 0.3450980392,\r\n      0.34901960784313724, 0.1960784314, 0.0784313725, 0.3490196078, 0.35294117647058826,\r\n      0.2039215686, 0.0784313725, 0.3529411765, 0.3568627450980392, 0.2117647059, 0.0745098039,\r\n      0.3568627451, 0.3607843137254902, 0.2196078431, 0.0745098039, 0.3607843137,\r\n      0.36470588235294116, 0.2274509804, 0.0705882353, 0.3647058824, 0.3686274509803922,\r\n      0.2352941176, 0.0705882353, 0.368627451, 0.37254901960784315, 0.2431372549, 0.0666666667,\r\n      0.3725490196, 0.3764705882352941, 0.2509803922, 0.0666666667, 0.3764705882,\r\n      0.3803921568627451, 0.2549019608, 0.062745098, 0.3803921569, 0.3843137254901961, 0.262745098,\r\n      0.062745098, 0.3843137255, 0.38823529411764707, 0.2705882353, 0.0588235294, 0.3882352941,\r\n      0.39215686274509803, 0.2784313725, 0.0588235294, 0.3921568627, 0.396078431372549,\r\n      0.2862745098, 0.0549019608, 0.3960784314, 0.4, 0.2941176471, 0.0549019608, 0.4,\r\n      0.403921568627451, 0.3019607843, 0.0509803922, 0.4039215686, 0.40784313725490196,\r\n      0.3098039216, 0.0509803922, 0.4078431373, 0.4117647058823529, 0.3176470588, 0.0470588235,\r\n      0.4117647059, 0.41568627450980394, 0.3254901961, 0.0470588235, 0.4156862745,\r\n      0.4196078431372549, 0.3333333333, 0.0431372549, 0.4196078431, 0.4235294117647059,\r\n      0.3411764706, 0.0431372549, 0.4235294118, 0.42745098039215684, 0.3490196078, 0.0392156863,\r\n      0.4274509804, 0.43137254901960786, 0.3568627451, 0.0392156863, 0.431372549,\r\n      0.43529411764705883, 0.3647058824, 0.0352941176, 0.4352941176, 0.4392156862745098,\r\n      0.3725490196, 0.0352941176, 0.4392156863, 0.44313725490196076, 0.3803921569, 0.031372549,\r\n      0.4431372549, 0.4470588235294118, 0.3882352941, 0.031372549, 0.4470588235,\r\n      0.45098039215686275, 0.3960784314, 0.0274509804, 0.4509803922, 0.4549019607843137,\r\n      0.4039215686, 0.0274509804, 0.4549019608, 0.4588235294117647, 0.4117647059, 0.0235294118,\r\n      0.4588235294, 0.4627450980392157, 0.4196078431, 0.0235294118, 0.462745098, 0.4666666666666667,\r\n      0.4274509804, 0.0196078431, 0.4666666667, 0.4705882352941177, 0.4352941176, 0.0196078431,\r\n      0.4705882353, 0.4745098039215686, 0.4431372549, 0.0156862745, 0.4745098039,\r\n      0.4784313725490197, 0.4509803922, 0.0156862745, 0.4784313725, 0.48235294117647065,\r\n      0.4588235294, 0.0117647059, 0.4823529412, 0.48627450980392156, 0.4666666667, 0.0117647059,\r\n      0.4862745098, 0.49019607843137253, 0.4745098039, 0.0078431373, 0.4901960784,\r\n      0.49411764705882355, 0.4823529412, 0.0078431373, 0.4941176471, 0.4980392156862745,\r\n      0.4901960784, 0.0039215686, 0.4980392157, 0.5019607843137255, 0.4980392157, 0.0117647059,\r\n      0.4980392157, 0.5058823529411764, 0.5058823529, 0.0156862745, 0.4901960784,\r\n      0.5098039215686274, 0.5137254902, 0.0235294118, 0.4823529412, 0.5137254901960784,\r\n      0.5215686275, 0.0274509804, 0.4745098039, 0.5176470588235295, 0.5294117647, 0.0352941176,\r\n      0.4666666667, 0.5215686274509804, 0.537254902, 0.0392156863, 0.4588235294, 0.5254901960784314,\r\n      0.5450980392, 0.0470588235, 0.4509803922, 0.5294117647058824, 0.5529411765, 0.0509803922,\r\n      0.4431372549, 0.5333333333333333, 0.5607843137, 0.0588235294, 0.4352941176,\r\n      0.5372549019607843, 0.568627451, 0.062745098, 0.4274509804, 0.5411764705882353, 0.5764705882,\r\n      0.0705882353, 0.4196078431, 0.5450980392156862, 0.5843137255, 0.0745098039, 0.4117647059,\r\n      0.5490196078431373, 0.5921568627, 0.0823529412, 0.4039215686, 0.5529411764705883, 0.6,\r\n      0.0862745098, 0.3960784314, 0.5568627450980392, 0.6078431373, 0.0941176471, 0.3882352941,\r\n      0.5607843137254902, 0.6156862745, 0.0980392157, 0.3803921569, 0.5647058823529412,\r\n      0.6235294118, 0.1058823529, 0.3725490196, 0.5686274509803921, 0.631372549, 0.1098039216,\r\n      0.3647058824, 0.5725490196078431, 0.6392156863, 0.1176470588, 0.3568627451,\r\n      0.5764705882352941, 0.6470588235, 0.1215686275, 0.3490196078, 0.5803921568627451,\r\n      0.6549019608, 0.1294117647, 0.3411764706, 0.5843137254901961, 0.662745098, 0.1333333333,\r\n      0.3333333333, 0.5882352941176471, 0.6705882353, 0.1411764706, 0.3254901961, 0.592156862745098,\r\n      0.6784313725, 0.1450980392, 0.3176470588, 0.596078431372549, 0.6862745098, 0.1529411765,\r\n      0.3098039216, 0.6, 0.6941176471, 0.1568627451, 0.3019607843, 0.6039215686274509, 0.7019607843,\r\n      0.1647058824, 0.2941176471, 0.6078431372549019, 0.7098039216, 0.168627451, 0.2862745098,\r\n      0.611764705882353, 0.7176470588, 0.1764705882, 0.2784313725, 0.615686274509804, 0.7254901961,\r\n      0.1803921569, 0.2705882353, 0.6196078431372549, 0.7333333333, 0.1882352941, 0.262745098,\r\n      0.6235294117647059, 0.7411764706, 0.1921568627, 0.2549019608, 0.6274509803921569,\r\n      0.7490196078, 0.2, 0.2509803922, 0.6313725490196078, 0.7529411765, 0.2039215686, 0.2431372549,\r\n      0.6352941176470588, 0.7607843137, 0.2117647059, 0.2352941176, 0.6392156862745098, 0.768627451,\r\n      0.2156862745, 0.2274509804, 0.6431372549019608, 0.7764705882, 0.2235294118, 0.2196078431,\r\n      0.6470588235294118, 0.7843137255, 0.2274509804, 0.2117647059, 0.6509803921568628,\r\n      0.7921568627, 0.2352941176, 0.2039215686, 0.6549019607843137, 0.8, 0.2392156863, 0.1960784314,\r\n      0.6588235294117647, 0.8078431373, 0.2470588235, 0.1882352941, 0.6627450980392157,\r\n      0.8156862745, 0.2509803922, 0.1803921569, 0.6666666666666666, 0.8235294118, 0.2549019608,\r\n      0.1725490196, 0.6705882352941176, 0.831372549, 0.2588235294, 0.1647058824, 0.6745098039215687,\r\n      0.8392156863, 0.2666666667, 0.1568627451, 0.6784313725490196, 0.8470588235, 0.2705882353,\r\n      0.1490196078, 0.6823529411764706, 0.8549019608, 0.2784313725, 0.1411764706,\r\n      0.6862745098039216, 0.862745098, 0.2823529412, 0.1333333333, 0.6901960784313725, 0.8705882353,\r\n      0.2901960784, 0.1254901961, 0.6941176470588235, 0.8784313725, 0.2941176471, 0.1176470588,\r\n      0.6980392156862745, 0.8862745098, 0.3019607843, 0.1098039216, 0.7019607843137254,\r\n      0.8941176471, 0.3058823529, 0.1019607843, 0.7058823529411765, 0.9019607843, 0.3137254902,\r\n      0.0941176471, 0.7098039215686275, 0.9098039216, 0.3176470588, 0.0862745098,\r\n      0.7137254901960784, 0.9176470588, 0.3254901961, 0.0784313725, 0.7176470588235294,\r\n      0.9254901961, 0.3294117647, 0.0705882353, 0.7215686274509804, 0.9333333333, 0.337254902,\r\n      0.062745098, 0.7254901960784313, 0.9411764706, 0.3411764706, 0.0549019608, 0.7294117647058823,\r\n      0.9490196078, 0.3490196078, 0.0470588235, 0.7333333333333333, 0.9568627451, 0.3529411765,\r\n      0.0392156863, 0.7372549019607844, 0.9647058824, 0.3607843137, 0.031372549, 0.7411764705882353,\r\n      0.9725490196, 0.3647058824, 0.0235294118, 0.7450980392156863, 0.9803921569, 0.3725490196,\r\n      0.0156862745, 0.7490196078431373, 0.9882352941, 0.3725490196, 0.0039215686,\r\n      0.7529411764705882, 0.9960784314, 0.3843137255, 0.0156862745, 0.7568627450980392,\r\n      0.9960784314, 0.3921568627, 0.031372549, 0.7607843137254902, 0.9960784314, 0.4039215686,\r\n      0.0470588235, 0.7647058823529411, 0.9960784314, 0.4117647059, 0.062745098, 0.7686274509803922,\r\n      0.9960784314, 0.4235294118, 0.0784313725, 0.7725490196078432, 0.9960784314, 0.431372549,\r\n      0.0941176471, 0.7764705882352941, 0.9960784314, 0.4431372549, 0.1098039216,\r\n      0.7803921568627451, 0.9960784314, 0.4509803922, 0.1254901961, 0.7843137254901961,\r\n      0.9960784314, 0.462745098, 0.1411764706, 0.788235294117647, 0.9960784314, 0.4705882353,\r\n      0.1568627451, 0.792156862745098, 0.9960784314, 0.4823529412, 0.1725490196, 0.796078431372549,\r\n      0.9960784314, 0.4901960784, 0.1882352941, 0.8, 0.9960784314, 0.5019607843, 0.2039215686,\r\n      0.803921568627451, 0.9960784314, 0.5098039216, 0.2196078431, 0.807843137254902, 0.9960784314,\r\n      0.5215686275, 0.2352941176, 0.8117647058823529, 0.9960784314, 0.5294117647, 0.2509803922,\r\n      0.8156862745098039, 0.9960784314, 0.5411764706, 0.262745098, 0.8196078431372549, 0.9960784314,\r\n      0.5490196078, 0.2784313725, 0.8235294117647058, 0.9960784314, 0.5607843137, 0.2941176471,\r\n      0.8274509803921568, 0.9960784314, 0.568627451, 0.3098039216, 0.8313725490196079, 0.9960784314,\r\n      0.5803921569, 0.3254901961, 0.8352941176470589, 0.9960784314, 0.5882352941, 0.3411764706,\r\n      0.8392156862745098, 0.9960784314, 0.6, 0.3568627451, 0.8431372549019608, 0.9960784314,\r\n      0.6078431373, 0.3725490196, 0.8470588235294118, 0.9960784314, 0.6196078431, 0.3882352941,\r\n      0.8509803921568627, 0.9960784314, 0.6274509804, 0.4039215686, 0.8549019607843137,\r\n      0.9960784314, 0.6392156863, 0.4196078431, 0.8588235294117647, 0.9960784314, 0.6470588235,\r\n      0.4352941176, 0.8627450980392157, 0.9960784314, 0.6588235294, 0.4509803922,\r\n      0.8666666666666667, 0.9960784314, 0.6666666667, 0.4666666667, 0.8705882352941177,\r\n      0.9960784314, 0.6784313725, 0.4823529412, 0.8745098039215686, 0.9960784314, 0.6862745098,\r\n      0.4980392157, 0.8784313725490196, 0.9960784314, 0.6980392157, 0.5137254902,\r\n      0.8823529411764706, 0.9960784314, 0.7058823529, 0.5294117647, 0.8862745098039215,\r\n      0.9960784314, 0.7176470588, 0.5450980392, 0.8901960784313725, 0.9960784314, 0.7254901961,\r\n      0.5607843137, 0.8941176470588236, 0.9960784314, 0.737254902, 0.5764705882, 0.8980392156862745,\r\n      0.9960784314, 0.7450980392, 0.5921568627, 0.9019607843137255, 0.9960784314, 0.7529411765,\r\n      0.6078431373, 0.9058823529411765, 0.9960784314, 0.7607843137, 0.6235294118,\r\n      0.9098039215686274, 0.9960784314, 0.7725490196, 0.6392156863, 0.9137254901960784,\r\n      0.9960784314, 0.7803921569, 0.6549019608, 0.9176470588235294, 0.9960784314, 0.7921568627,\r\n      0.6705882353, 0.9215686274509803, 0.9960784314, 0.8, 0.6862745098, 0.9254901960784314,\r\n      0.9960784314, 0.8117647059, 0.7019607843, 0.9294117647058824, 0.9960784314, 0.8196078431,\r\n      0.7176470588, 0.9333333333333333, 0.9960784314, 0.831372549, 0.7333333333, 0.9372549019607843,\r\n      0.9960784314, 0.8392156863, 0.7490196078, 0.9411764705882354, 0.9960784314, 0.8509803922,\r\n      0.7607843137, 0.9450980392156864, 0.9960784314, 0.8588235294, 0.7764705882,\r\n      0.9490196078431372, 0.9960784314, 0.8705882353, 0.7921568627, 0.9529411764705882,\r\n      0.9960784314, 0.8784313725, 0.8078431373, 0.9568627450980394, 0.9960784314, 0.8901960784,\r\n      0.8235294118, 0.9607843137254903, 0.9960784314, 0.8980392157, 0.8392156863,\r\n      0.9647058823529413, 0.9960784314, 0.9098039216, 0.8549019608, 0.9686274509803922,\r\n      0.9960784314, 0.9176470588, 0.8705882353, 0.9725490196078431, 0.9960784314, 0.9294117647,\r\n      0.8862745098, 0.9764705882352941, 0.9960784314, 0.937254902, 0.9019607843, 0.9803921568627451,\r\n      0.9960784314, 0.9490196078, 0.9176470588, 0.984313725490196, 0.9960784314, 0.9568627451,\r\n      0.9333333333, 0.9882352941176471, 0.9960784314, 0.968627451, 0.9490196078, 0.9921568627450981,\r\n      0.9960784314, 0.9764705882, 0.9647058824, 0.996078431372549, 0.9960784314, 0.9882352941,\r\n      0.9803921569, 1.0, 0.9960784314, 0.9882352941, 0.9803921569,\r\n    ],\r\n    description: 'GE 256',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'ge',\r\n    name: 'ge',\r\n    RGBPoints: [\r\n      0.0, 0.0078431373, 0.0078431373, 0.0078431373, 0.00392156862745098, 0.0078431373,\r\n      0.0078431373, 0.0078431373, 0.00784313725490196, 0.0078431373, 0.0078431373, 0.0078431373,\r\n      0.011764705882352941, 0.0078431373, 0.0078431373, 0.0078431373, 0.01568627450980392,\r\n      0.0078431373, 0.0078431373, 0.0078431373, 0.0196078431372549, 0.0078431373, 0.0078431373,\r\n      0.0078431373, 0.023529411764705882, 0.0078431373, 0.0078431373, 0.0078431373,\r\n      0.027450980392156862, 0.0078431373, 0.0078431373, 0.0078431373, 0.03137254901960784,\r\n      0.0078431373, 0.0078431373, 0.0078431373, 0.03529411764705882, 0.0078431373, 0.0078431373,\r\n      0.0078431373, 0.0392156862745098, 0.0078431373, 0.0078431373, 0.0078431373,\r\n      0.043137254901960784, 0.0078431373, 0.0078431373, 0.0078431373, 0.047058823529411764,\r\n      0.0078431373, 0.0078431373, 0.0078431373, 0.050980392156862744, 0.0078431373, 0.0078431373,\r\n      0.0078431373, 0.054901960784313725, 0.0078431373, 0.0078431373, 0.0078431373,\r\n      0.05882352941176471, 0.0117647059, 0.0078431373, 0.0078431373, 0.06274509803921569,\r\n      0.0078431373, 0.0156862745, 0.0156862745, 0.06666666666666667, 0.0078431373, 0.0235294118,\r\n      0.0235294118, 0.07058823529411765, 0.0078431373, 0.031372549, 0.031372549,\r\n      0.07450980392156863, 0.0078431373, 0.0392156863, 0.0392156863, 0.0784313725490196,\r\n      0.0078431373, 0.0470588235, 0.0470588235, 0.08235294117647059, 0.0078431373, 0.0549019608,\r\n      0.0549019608, 0.08627450980392157, 0.0078431373, 0.062745098, 0.062745098,\r\n      0.09019607843137255, 0.0078431373, 0.0705882353, 0.0705882353, 0.09411764705882353,\r\n      0.0078431373, 0.0784313725, 0.0784313725, 0.09803921568627451, 0.0078431373, 0.0901960784,\r\n      0.0862745098, 0.10196078431372549, 0.0078431373, 0.0980392157, 0.0941176471,\r\n      0.10588235294117647, 0.0078431373, 0.1058823529, 0.1019607843, 0.10980392156862745,\r\n      0.0078431373, 0.1137254902, 0.1098039216, 0.11372549019607843, 0.0078431373, 0.1215686275,\r\n      0.1176470588, 0.11764705882352942, 0.0078431373, 0.1294117647, 0.1254901961,\r\n      0.12156862745098039, 0.0078431373, 0.137254902, 0.1333333333, 0.12549019607843137,\r\n      0.0078431373, 0.1450980392, 0.1411764706, 0.12941176470588237, 0.0078431373, 0.1529411765,\r\n      0.1490196078, 0.13333333333333333, 0.0078431373, 0.1647058824, 0.1568627451,\r\n      0.13725490196078433, 0.0078431373, 0.1725490196, 0.1647058824, 0.1411764705882353,\r\n      0.0078431373, 0.1803921569, 0.1725490196, 0.1450980392156863, 0.0078431373, 0.1882352941,\r\n      0.1803921569, 0.14901960784313725, 0.0078431373, 0.1960784314, 0.1882352941,\r\n      0.15294117647058825, 0.0078431373, 0.2039215686, 0.1960784314, 0.1568627450980392,\r\n      0.0078431373, 0.2117647059, 0.2039215686, 0.1607843137254902, 0.0078431373, 0.2196078431,\r\n      0.2117647059, 0.16470588235294117, 0.0078431373, 0.2274509804, 0.2196078431,\r\n      0.16862745098039217, 0.0078431373, 0.2352941176, 0.2274509804, 0.17254901960784313,\r\n      0.0078431373, 0.2470588235, 0.2352941176, 0.17647058823529413, 0.0078431373, 0.2509803922,\r\n      0.2431372549, 0.1803921568627451, 0.0078431373, 0.2549019608, 0.2509803922,\r\n      0.1843137254901961, 0.0078431373, 0.262745098, 0.2509803922, 0.18823529411764706,\r\n      0.0078431373, 0.2705882353, 0.2588235294, 0.19215686274509805, 0.0078431373, 0.2784313725,\r\n      0.2666666667, 0.19607843137254902, 0.0078431373, 0.2862745098, 0.2745098039, 0.2,\r\n      0.0078431373, 0.2941176471, 0.2823529412, 0.20392156862745098, 0.0078431373, 0.3019607843,\r\n      0.2901960784, 0.20784313725490197, 0.0078431373, 0.3137254902, 0.2980392157,\r\n      0.21176470588235294, 0.0078431373, 0.3215686275, 0.3058823529, 0.21568627450980393,\r\n      0.0078431373, 0.3294117647, 0.3137254902, 0.2196078431372549, 0.0078431373, 0.337254902,\r\n      0.3215686275, 0.2235294117647059, 0.0078431373, 0.3450980392, 0.3294117647,\r\n      0.22745098039215686, 0.0078431373, 0.3529411765, 0.337254902, 0.23137254901960785,\r\n      0.0078431373, 0.3607843137, 0.3450980392, 0.23529411764705885, 0.0078431373, 0.368627451,\r\n      0.3529411765, 0.23921568627450984, 0.0078431373, 0.3764705882, 0.3607843137,\r\n      0.24313725490196078, 0.0078431373, 0.3843137255, 0.368627451, 0.24705882352941178,\r\n      0.0078431373, 0.3960784314, 0.3764705882, 0.25098039215686274, 0.0078431373, 0.4039215686,\r\n      0.3843137255, 0.2549019607843137, 0.0078431373, 0.4117647059, 0.3921568627,\r\n      0.25882352941176473, 0.0078431373, 0.4196078431, 0.4, 0.2627450980392157, 0.0078431373,\r\n      0.4274509804, 0.4078431373, 0.26666666666666666, 0.0078431373, 0.4352941176, 0.4156862745,\r\n      0.27058823529411763, 0.0078431373, 0.4431372549, 0.4235294118, 0.27450980392156865,\r\n      0.0078431373, 0.4509803922, 0.431372549, 0.2784313725490196, 0.0078431373, 0.4588235294,\r\n      0.4392156863, 0.2823529411764706, 0.0078431373, 0.4705882353, 0.4470588235,\r\n      0.28627450980392155, 0.0078431373, 0.4784313725, 0.4549019608, 0.2901960784313726,\r\n      0.0078431373, 0.4862745098, 0.462745098, 0.29411764705882354, 0.0078431373, 0.4941176471,\r\n      0.4705882353, 0.2980392156862745, 0.0078431373, 0.5019607843, 0.4784313725,\r\n      0.30196078431372547, 0.0117647059, 0.5098039216, 0.4862745098, 0.3058823529411765,\r\n      0.0196078431, 0.5019607843, 0.4941176471, 0.30980392156862746, 0.0274509804, 0.4941176471,\r\n      0.5058823529, 0.3137254901960784, 0.0352941176, 0.4862745098, 0.5137254902,\r\n      0.3176470588235294, 0.0431372549, 0.4784313725, 0.5215686275, 0.3215686274509804,\r\n      0.0509803922, 0.4705882353, 0.5294117647, 0.3254901960784314, 0.0588235294, 0.462745098,\r\n      0.537254902, 0.32941176470588235, 0.0666666667, 0.4549019608, 0.5450980392,\r\n      0.3333333333333333, 0.0745098039, 0.4470588235, 0.5529411765, 0.33725490196078434,\r\n      0.0823529412, 0.4392156863, 0.5607843137, 0.3411764705882353, 0.0901960784, 0.431372549,\r\n      0.568627451, 0.34509803921568627, 0.0980392157, 0.4235294118, 0.5764705882,\r\n      0.34901960784313724, 0.1058823529, 0.4156862745, 0.5843137255, 0.35294117647058826,\r\n      0.1137254902, 0.4078431373, 0.5921568627, 0.3568627450980392, 0.1215686275, 0.4, 0.6,\r\n      0.3607843137254902, 0.1294117647, 0.3921568627, 0.6078431373, 0.36470588235294116,\r\n      0.137254902, 0.3843137255, 0.6156862745, 0.3686274509803922, 0.1450980392, 0.3764705882,\r\n      0.6235294118, 0.37254901960784315, 0.1529411765, 0.368627451, 0.631372549, 0.3764705882352941,\r\n      0.1607843137, 0.3607843137, 0.6392156863, 0.3803921568627451, 0.168627451, 0.3529411765,\r\n      0.6470588235, 0.3843137254901961, 0.1764705882, 0.3450980392, 0.6549019608,\r\n      0.38823529411764707, 0.1843137255, 0.337254902, 0.662745098, 0.39215686274509803,\r\n      0.1921568627, 0.3294117647, 0.6705882353, 0.396078431372549, 0.2, 0.3215686275, 0.6784313725,\r\n      0.4, 0.2078431373, 0.3137254902, 0.6862745098, 0.403921568627451, 0.2156862745, 0.3058823529,\r\n      0.6941176471, 0.40784313725490196, 0.2235294118, 0.2980392157, 0.7019607843,\r\n      0.4117647058823529, 0.231372549, 0.2901960784, 0.7098039216, 0.41568627450980394,\r\n      0.2392156863, 0.2823529412, 0.7176470588, 0.4196078431372549, 0.2470588235, 0.2745098039,\r\n      0.7254901961, 0.4235294117647059, 0.2509803922, 0.2666666667, 0.7333333333,\r\n      0.42745098039215684, 0.2509803922, 0.2588235294, 0.7411764706, 0.43137254901960786,\r\n      0.2588235294, 0.2509803922, 0.7490196078, 0.43529411764705883, 0.2666666667, 0.2509803922,\r\n      0.7490196078, 0.4392156862745098, 0.2745098039, 0.2431372549, 0.7568627451,\r\n      0.44313725490196076, 0.2823529412, 0.2352941176, 0.7647058824, 0.4470588235294118,\r\n      0.2901960784, 0.2274509804, 0.7725490196, 0.45098039215686275, 0.2980392157, 0.2196078431,\r\n      0.7803921569, 0.4549019607843137, 0.3058823529, 0.2117647059, 0.7882352941,\r\n      0.4588235294117647, 0.3137254902, 0.2039215686, 0.7960784314, 0.4627450980392157,\r\n      0.3215686275, 0.1960784314, 0.8039215686, 0.4666666666666667, 0.3294117647, 0.1882352941,\r\n      0.8117647059, 0.4705882352941177, 0.337254902, 0.1803921569, 0.8196078431, 0.4745098039215686,\r\n      0.3450980392, 0.1725490196, 0.8274509804, 0.4784313725490197, 0.3529411765, 0.1647058824,\r\n      0.8352941176, 0.48235294117647065, 0.3607843137, 0.1568627451, 0.8431372549,\r\n      0.48627450980392156, 0.368627451, 0.1490196078, 0.8509803922, 0.49019607843137253,\r\n      0.3764705882, 0.1411764706, 0.8588235294, 0.49411764705882355, 0.3843137255, 0.1333333333,\r\n      0.8666666667, 0.4980392156862745, 0.3921568627, 0.1254901961, 0.8745098039,\r\n      0.5019607843137255, 0.4, 0.1176470588, 0.8823529412, 0.5058823529411764, 0.4078431373,\r\n      0.1098039216, 0.8901960784, 0.5098039215686274, 0.4156862745, 0.1019607843, 0.8980392157,\r\n      0.5137254901960784, 0.4235294118, 0.0941176471, 0.9058823529, 0.5176470588235295, 0.431372549,\r\n      0.0862745098, 0.9137254902, 0.5215686274509804, 0.4392156863, 0.0784313725, 0.9215686275,\r\n      0.5254901960784314, 0.4470588235, 0.0705882353, 0.9294117647, 0.5294117647058824,\r\n      0.4549019608, 0.062745098, 0.937254902, 0.5333333333333333, 0.462745098, 0.0549019608,\r\n      0.9450980392, 0.5372549019607843, 0.4705882353, 0.0470588235, 0.9529411765,\r\n      0.5411764705882353, 0.4784313725, 0.0392156863, 0.9607843137, 0.5450980392156862,\r\n      0.4862745098, 0.031372549, 0.968627451, 0.5490196078431373, 0.4941176471, 0.0235294118,\r\n      0.9764705882, 0.5529411764705883, 0.4980392157, 0.0156862745, 0.9843137255,\r\n      0.5568627450980392, 0.5058823529, 0.0078431373, 0.9921568627, 0.5607843137254902,\r\n      0.5137254902, 0.0156862745, 0.9803921569, 0.5647058823529412, 0.5215686275, 0.0235294118,\r\n      0.9647058824, 0.5686274509803921, 0.5294117647, 0.0352941176, 0.9490196078,\r\n      0.5725490196078431, 0.537254902, 0.0431372549, 0.9333333333, 0.5764705882352941, 0.5450980392,\r\n      0.0509803922, 0.9176470588, 0.5803921568627451, 0.5529411765, 0.062745098, 0.9019607843,\r\n      0.5843137254901961, 0.5607843137, 0.0705882353, 0.8862745098, 0.5882352941176471, 0.568627451,\r\n      0.0784313725, 0.8705882353, 0.592156862745098, 0.5764705882, 0.0901960784, 0.8549019608,\r\n      0.596078431372549, 0.5843137255, 0.0980392157, 0.8392156863, 0.6, 0.5921568627, 0.1098039216,\r\n      0.8235294118, 0.6039215686274509, 0.6, 0.1176470588, 0.8078431373, 0.6078431372549019,\r\n      0.6078431373, 0.1254901961, 0.7921568627, 0.611764705882353, 0.6156862745, 0.137254902,\r\n      0.7764705882, 0.615686274509804, 0.6235294118, 0.1450980392, 0.7607843137, 0.6196078431372549,\r\n      0.631372549, 0.1529411765, 0.7490196078, 0.6235294117647059, 0.6392156863, 0.1647058824,\r\n      0.737254902, 0.6274509803921569, 0.6470588235, 0.1725490196, 0.7215686275, 0.6313725490196078,\r\n      0.6549019608, 0.1843137255, 0.7058823529, 0.6352941176470588, 0.662745098, 0.1921568627,\r\n      0.6901960784, 0.6392156862745098, 0.6705882353, 0.2, 0.6745098039, 0.6431372549019608,\r\n      0.6784313725, 0.2117647059, 0.6588235294, 0.6470588235294118, 0.6862745098, 0.2196078431,\r\n      0.6431372549, 0.6509803921568628, 0.6941176471, 0.2274509804, 0.6274509804,\r\n      0.6549019607843137, 0.7019607843, 0.2392156863, 0.6117647059, 0.6588235294117647,\r\n      0.7098039216, 0.2470588235, 0.5960784314, 0.6627450980392157, 0.7176470588, 0.2509803922,\r\n      0.5803921569, 0.6666666666666666, 0.7254901961, 0.2588235294, 0.5647058824,\r\n      0.6705882352941176, 0.7333333333, 0.2666666667, 0.5490196078, 0.6745098039215687,\r\n      0.7411764706, 0.2784313725, 0.5333333333, 0.6784313725490196, 0.7490196078, 0.2862745098,\r\n      0.5176470588, 0.6823529411764706, 0.7490196078, 0.2941176471, 0.5019607843,\r\n      0.6862745098039216, 0.7529411765, 0.3058823529, 0.4862745098, 0.6901960784313725,\r\n      0.7607843137, 0.3137254902, 0.4705882353, 0.6941176470588235, 0.768627451, 0.3215686275,\r\n      0.4549019608, 0.6980392156862745, 0.7764705882, 0.3333333333, 0.4392156863,\r\n      0.7019607843137254, 0.7843137255, 0.3411764706, 0.4235294118, 0.7058823529411765,\r\n      0.7921568627, 0.3529411765, 0.4078431373, 0.7098039215686275, 0.8, 0.3607843137, 0.3921568627,\r\n      0.7137254901960784, 0.8078431373, 0.368627451, 0.3764705882, 0.7176470588235294, 0.8156862745,\r\n      0.3803921569, 0.3607843137, 0.7215686274509804, 0.8235294118, 0.3882352941, 0.3450980392,\r\n      0.7254901960784313, 0.831372549, 0.3960784314, 0.3294117647, 0.7294117647058823, 0.8392156863,\r\n      0.4078431373, 0.3137254902, 0.7333333333333333, 0.8470588235, 0.4156862745, 0.2980392157,\r\n      0.7372549019607844, 0.8549019608, 0.4274509804, 0.2823529412, 0.7411764705882353, 0.862745098,\r\n      0.4352941176, 0.2666666667, 0.7450980392156863, 0.8705882353, 0.4431372549, 0.2509803922,\r\n      0.7490196078431373, 0.8784313725, 0.4549019608, 0.2431372549, 0.7529411764705882,\r\n      0.8862745098, 0.462745098, 0.2274509804, 0.7568627450980392, 0.8941176471, 0.4705882353,\r\n      0.2117647059, 0.7607843137254902, 0.9019607843, 0.4823529412, 0.1960784314,\r\n      0.7647058823529411, 0.9098039216, 0.4901960784, 0.1803921569, 0.7686274509803922,\r\n      0.9176470588, 0.4980392157, 0.1647058824, 0.7725490196078432, 0.9254901961, 0.5098039216,\r\n      0.1490196078, 0.7764705882352941, 0.9333333333, 0.5176470588, 0.1333333333,\r\n      0.7803921568627451, 0.9411764706, 0.5294117647, 0.1176470588, 0.7843137254901961,\r\n      0.9490196078, 0.537254902, 0.1019607843, 0.788235294117647, 0.9568627451, 0.5450980392,\r\n      0.0862745098, 0.792156862745098, 0.9647058824, 0.5568627451, 0.0705882353, 0.796078431372549,\r\n      0.9725490196, 0.5647058824, 0.0549019608, 0.8, 0.9803921569, 0.5725490196, 0.0392156863,\r\n      0.803921568627451, 0.9882352941, 0.5843137255, 0.0235294118, 0.807843137254902, 0.9921568627,\r\n      0.5921568627, 0.0078431373, 0.8117647058823529, 0.9921568627, 0.6039215686, 0.0274509804,\r\n      0.8156862745098039, 0.9921568627, 0.6117647059, 0.0509803922, 0.8196078431372549,\r\n      0.9921568627, 0.6196078431, 0.0745098039, 0.8235294117647058, 0.9921568627, 0.631372549,\r\n      0.0980392157, 0.8274509803921568, 0.9921568627, 0.6392156863, 0.1215686275,\r\n      0.8313725490196079, 0.9921568627, 0.6470588235, 0.1411764706, 0.8352941176470589,\r\n      0.9921568627, 0.6588235294, 0.1647058824, 0.8392156862745098, 0.9921568627, 0.6666666667,\r\n      0.1882352941, 0.8431372549019608, 0.9921568627, 0.6784313725, 0.2117647059,\r\n      0.8470588235294118, 0.9921568627, 0.6862745098, 0.2352941176, 0.8509803921568627,\r\n      0.9921568627, 0.6941176471, 0.2509803922, 0.8549019607843137, 0.9921568627, 0.7058823529,\r\n      0.2705882353, 0.8588235294117647, 0.9921568627, 0.7137254902, 0.2941176471,\r\n      0.8627450980392157, 0.9921568627, 0.7215686275, 0.3176470588, 0.8666666666666667,\r\n      0.9921568627, 0.7333333333, 0.3411764706, 0.8705882352941177, 0.9921568627, 0.7411764706,\r\n      0.3647058824, 0.8745098039215686, 0.9921568627, 0.7490196078, 0.3843137255,\r\n      0.8784313725490196, 0.9921568627, 0.7529411765, 0.4078431373, 0.8823529411764706,\r\n      0.9921568627, 0.7607843137, 0.431372549, 0.8862745098039215, 0.9921568627, 0.7725490196,\r\n      0.4549019608, 0.8901960784313725, 0.9921568627, 0.7803921569, 0.4784313725,\r\n      0.8941176470588236, 0.9921568627, 0.7882352941, 0.4980392157, 0.8980392156862745,\r\n      0.9921568627, 0.8, 0.5215686275, 0.9019607843137255, 0.9921568627, 0.8078431373, 0.5450980392,\r\n      0.9058823529411765, 0.9921568627, 0.8156862745, 0.568627451, 0.9098039215686274, 0.9921568627,\r\n      0.8274509804, 0.5921568627, 0.9137254901960784, 0.9921568627, 0.8352941176, 0.6156862745,\r\n      0.9176470588235294, 0.9921568627, 0.8470588235, 0.6352941176, 0.9215686274509803,\r\n      0.9921568627, 0.8549019608, 0.6588235294, 0.9254901960784314, 0.9921568627, 0.862745098,\r\n      0.6823529412, 0.9294117647058824, 0.9921568627, 0.8745098039, 0.7058823529,\r\n      0.9333333333333333, 0.9921568627, 0.8823529412, 0.7294117647, 0.9372549019607843,\r\n      0.9921568627, 0.8901960784, 0.7490196078, 0.9411764705882354, 0.9921568627, 0.9019607843,\r\n      0.7647058824, 0.9450980392156864, 0.9921568627, 0.9098039216, 0.7882352941,\r\n      0.9490196078431372, 0.9921568627, 0.9215686275, 0.8117647059, 0.9529411764705882,\r\n      0.9921568627, 0.9294117647, 0.8352941176, 0.9568627450980394, 0.9921568627, 0.937254902,\r\n      0.8588235294, 0.9607843137254903, 0.9921568627, 0.9490196078, 0.8784313725,\r\n      0.9647058823529413, 0.9921568627, 0.9568627451, 0.9019607843, 0.9686274509803922,\r\n      0.9921568627, 0.9647058824, 0.9254901961, 0.9725490196078431, 0.9921568627, 0.9764705882,\r\n      0.9490196078, 0.9764705882352941, 0.9921568627, 0.9843137255, 0.9725490196,\r\n      0.9803921568627451, 0.9921568627, 0.9921568627, 0.9921568627, 0.984313725490196, 0.9921568627,\r\n      0.9921568627, 0.9921568627, 0.9882352941176471, 0.9921568627, 0.9921568627, 0.9921568627,\r\n      0.9921568627450981, 0.9921568627, 0.9921568627, 0.9921568627, 0.996078431372549, 0.9921568627,\r\n      0.9921568627, 0.9921568627, 1.0, 0.9921568627, 0.9921568627, 0.9921568627,\r\n    ],\r\n    description: 'GE',\r\n  },\r\n  {\r\n    ColorSpace: 'RGB',\r\n    Name: 'siemens',\r\n    name: 'siemens',\r\n    RGBPoints: [\r\n      0.0, 0.0078431373, 0.0039215686, 0.1254901961, 0.00392156862745098, 0.0078431373,\r\n      0.0039215686, 0.1254901961, 0.00784313725490196, 0.0078431373, 0.0039215686, 0.1882352941,\r\n      0.011764705882352941, 0.0117647059, 0.0039215686, 0.2509803922, 0.01568627450980392,\r\n      0.0117647059, 0.0039215686, 0.3098039216, 0.0196078431372549, 0.0156862745, 0.0039215686,\r\n      0.3725490196, 0.023529411764705882, 0.0156862745, 0.0039215686, 0.3725490196,\r\n      0.027450980392156862, 0.0156862745, 0.0039215686, 0.3725490196, 0.03137254901960784,\r\n      0.0156862745, 0.0039215686, 0.3725490196, 0.03529411764705882, 0.0156862745, 0.0039215686,\r\n      0.3725490196, 0.0392156862745098, 0.0156862745, 0.0039215686, 0.3725490196,\r\n      0.043137254901960784, 0.0156862745, 0.0039215686, 0.3725490196, 0.047058823529411764,\r\n      0.0156862745, 0.0039215686, 0.3725490196, 0.050980392156862744, 0.0156862745, 0.0039215686,\r\n      0.3725490196, 0.054901960784313725, 0.0156862745, 0.0039215686, 0.3725490196,\r\n      0.05882352941176471, 0.0156862745, 0.0039215686, 0.3725490196, 0.06274509803921569,\r\n      0.0156862745, 0.0039215686, 0.3882352941, 0.06666666666666667, 0.0156862745, 0.0039215686,\r\n      0.4078431373, 0.07058823529411765, 0.0156862745, 0.0039215686, 0.4235294118,\r\n      0.07450980392156863, 0.0156862745, 0.0039215686, 0.4431372549, 0.0784313725490196,\r\n      0.0156862745, 0.0039215686, 0.462745098, 0.08235294117647059, 0.0156862745, 0.0039215686,\r\n      0.4784313725, 0.08627450980392157, 0.0156862745, 0.0039215686, 0.4980392157,\r\n      0.09019607843137255, 0.0196078431, 0.0039215686, 0.5137254902, 0.09411764705882353,\r\n      0.0196078431, 0.0039215686, 0.5333333333, 0.09803921568627451, 0.0196078431, 0.0039215686,\r\n      0.5529411765, 0.10196078431372549, 0.0196078431, 0.0039215686, 0.568627451,\r\n      0.10588235294117647, 0.0196078431, 0.0039215686, 0.5882352941, 0.10980392156862745,\r\n      0.0196078431, 0.0039215686, 0.6039215686, 0.11372549019607843, 0.0196078431, 0.0039215686,\r\n      0.6235294118, 0.11764705882352942, 0.0196078431, 0.0039215686, 0.6431372549,\r\n      0.12156862745098039, 0.0235294118, 0.0039215686, 0.6588235294, 0.12549019607843137,\r\n      0.0235294118, 0.0039215686, 0.6784313725, 0.12941176470588237, 0.0235294118, 0.0039215686,\r\n      0.6980392157, 0.13333333333333333, 0.0235294118, 0.0039215686, 0.7137254902,\r\n      0.13725490196078433, 0.0235294118, 0.0039215686, 0.7333333333, 0.1411764705882353,\r\n      0.0235294118, 0.0039215686, 0.7490196078, 0.1450980392156863, 0.0235294118, 0.0039215686,\r\n      0.7647058824, 0.14901960784313725, 0.0235294118, 0.0039215686, 0.7843137255,\r\n      0.15294117647058825, 0.0274509804, 0.0039215686, 0.8, 0.1568627450980392, 0.0274509804,\r\n      0.0039215686, 0.8196078431, 0.1607843137254902, 0.0274509804, 0.0039215686, 0.8352941176,\r\n      0.16470588235294117, 0.0274509804, 0.0039215686, 0.8549019608, 0.16862745098039217,\r\n      0.0274509804, 0.0039215686, 0.8745098039, 0.17254901960784313, 0.0274509804, 0.0039215686,\r\n      0.8901960784, 0.17647058823529413, 0.0274509804, 0.0039215686, 0.9098039216,\r\n      0.1803921568627451, 0.031372549, 0.0039215686, 0.9294117647, 0.1843137254901961, 0.031372549,\r\n      0.0039215686, 0.9254901961, 0.18823529411764706, 0.0509803922, 0.0039215686, 0.9098039216,\r\n      0.19215686274509805, 0.0705882353, 0.0039215686, 0.8901960784, 0.19607843137254902,\r\n      0.0901960784, 0.0039215686, 0.8705882353, 0.2, 0.1137254902, 0.0039215686, 0.8509803922,\r\n      0.20392156862745098, 0.1333333333, 0.0039215686, 0.831372549, 0.20784313725490197,\r\n      0.1529411765, 0.0039215686, 0.8117647059, 0.21176470588235294, 0.1725490196, 0.0039215686,\r\n      0.7921568627, 0.21568627450980393, 0.1960784314, 0.0039215686, 0.7725490196,\r\n      0.2196078431372549, 0.2156862745, 0.0039215686, 0.7529411765, 0.2235294117647059,\r\n      0.2352941176, 0.0039215686, 0.737254902, 0.22745098039215686, 0.2509803922, 0.0039215686,\r\n      0.7176470588, 0.23137254901960785, 0.2745098039, 0.0039215686, 0.6980392157,\r\n      0.23529411764705885, 0.2941176471, 0.0039215686, 0.6784313725, 0.23921568627450984,\r\n      0.3137254902, 0.0039215686, 0.6588235294, 0.24313725490196078, 0.3333333333, 0.0039215686,\r\n      0.6392156863, 0.24705882352941178, 0.3568627451, 0.0039215686, 0.6196078431,\r\n      0.25098039215686274, 0.3764705882, 0.0039215686, 0.6, 0.2549019607843137, 0.3960784314,\r\n      0.0039215686, 0.5803921569, 0.25882352941176473, 0.4156862745, 0.0039215686, 0.5607843137,\r\n      0.2627450980392157, 0.4392156863, 0.0039215686, 0.5411764706, 0.26666666666666666,\r\n      0.4588235294, 0.0039215686, 0.5215686275, 0.27058823529411763, 0.4784313725, 0.0039215686,\r\n      0.5019607843, 0.27450980392156865, 0.4980392157, 0.0039215686, 0.4823529412,\r\n      0.2784313725490196, 0.5215686275, 0.0039215686, 0.4666666667, 0.2823529411764706,\r\n      0.5411764706, 0.0039215686, 0.4470588235, 0.28627450980392155, 0.5607843137, 0.0039215686,\r\n      0.4274509804, 0.2901960784313726, 0.5803921569, 0.0039215686, 0.4078431373,\r\n      0.29411764705882354, 0.6039215686, 0.0039215686, 0.3882352941, 0.2980392156862745,\r\n      0.6235294118, 0.0039215686, 0.368627451, 0.30196078431372547, 0.6431372549, 0.0039215686,\r\n      0.3490196078, 0.3058823529411765, 0.662745098, 0.0039215686, 0.3294117647,\r\n      0.30980392156862746, 0.6862745098, 0.0039215686, 0.3098039216, 0.3137254901960784,\r\n      0.7058823529, 0.0039215686, 0.2901960784, 0.3176470588235294, 0.7254901961, 0.0039215686,\r\n      0.2705882353, 0.3215686274509804, 0.7450980392, 0.0039215686, 0.2509803922,\r\n      0.3254901960784314, 0.7647058824, 0.0039215686, 0.2352941176, 0.32941176470588235,\r\n      0.7843137255, 0.0039215686, 0.2156862745, 0.3333333333333333, 0.8039215686, 0.0039215686,\r\n      0.1960784314, 0.33725490196078434, 0.8235294118, 0.0039215686, 0.1764705882,\r\n      0.3411764705882353, 0.8470588235, 0.0039215686, 0.1568627451, 0.34509803921568627,\r\n      0.8666666667, 0.0039215686, 0.137254902, 0.34901960784313724, 0.8862745098, 0.0039215686,\r\n      0.1176470588, 0.35294117647058826, 0.9058823529, 0.0039215686, 0.0980392157,\r\n      0.3568627450980392, 0.9294117647, 0.0039215686, 0.0784313725, 0.3607843137254902,\r\n      0.9490196078, 0.0039215686, 0.0588235294, 0.36470588235294116, 0.968627451, 0.0039215686,\r\n      0.0392156863, 0.3686274509803922, 0.9921568627, 0.0039215686, 0.0235294118,\r\n      0.37254901960784315, 0.9529411765, 0.0039215686, 0.0588235294, 0.3764705882352941,\r\n      0.9529411765, 0.0078431373, 0.0549019608, 0.3803921568627451, 0.9529411765, 0.0156862745,\r\n      0.0549019608, 0.3843137254901961, 0.9529411765, 0.0235294118, 0.0549019608,\r\n      0.38823529411764707, 0.9529411765, 0.031372549, 0.0549019608, 0.39215686274509803,\r\n      0.9529411765, 0.0352941176, 0.0549019608, 0.396078431372549, 0.9529411765, 0.0431372549,\r\n      0.0549019608, 0.4, 0.9529411765, 0.0509803922, 0.0549019608, 0.403921568627451, 0.9529411765,\r\n      0.0588235294, 0.0549019608, 0.40784313725490196, 0.9529411765, 0.062745098, 0.0549019608,\r\n      0.4117647058823529, 0.9529411765, 0.0705882353, 0.0549019608, 0.41568627450980394,\r\n      0.9529411765, 0.0784313725, 0.0509803922, 0.4196078431372549, 0.9529411765, 0.0862745098,\r\n      0.0509803922, 0.4235294117647059, 0.9568627451, 0.0941176471, 0.0509803922,\r\n      0.42745098039215684, 0.9568627451, 0.0980392157, 0.0509803922, 0.43137254901960786,\r\n      0.9568627451, 0.1058823529, 0.0509803922, 0.43529411764705883, 0.9568627451, 0.1137254902,\r\n      0.0509803922, 0.4392156862745098, 0.9568627451, 0.1215686275, 0.0509803922,\r\n      0.44313725490196076, 0.9568627451, 0.1254901961, 0.0509803922, 0.4470588235294118,\r\n      0.9568627451, 0.1333333333, 0.0509803922, 0.45098039215686275, 0.9568627451, 0.1411764706,\r\n      0.0509803922, 0.4549019607843137, 0.9568627451, 0.1490196078, 0.0470588235,\r\n      0.4588235294117647, 0.9568627451, 0.1568627451, 0.0470588235, 0.4627450980392157,\r\n      0.9568627451, 0.1607843137, 0.0470588235, 0.4666666666666667, 0.9568627451, 0.168627451,\r\n      0.0470588235, 0.4705882352941177, 0.9607843137, 0.1764705882, 0.0470588235,\r\n      0.4745098039215686, 0.9607843137, 0.1843137255, 0.0470588235, 0.4784313725490197,\r\n      0.9607843137, 0.1882352941, 0.0470588235, 0.48235294117647065, 0.9607843137, 0.1960784314,\r\n      0.0470588235, 0.48627450980392156, 0.9607843137, 0.2039215686, 0.0470588235,\r\n      0.49019607843137253, 0.9607843137, 0.2117647059, 0.0470588235, 0.49411764705882355,\r\n      0.9607843137, 0.2196078431, 0.0431372549, 0.4980392156862745, 0.9607843137, 0.2235294118,\r\n      0.0431372549, 0.5019607843137255, 0.9607843137, 0.231372549, 0.0431372549, 0.5058823529411764,\r\n      0.9607843137, 0.2392156863, 0.0431372549, 0.5098039215686274, 0.9607843137, 0.2470588235,\r\n      0.0431372549, 0.5137254901960784, 0.9607843137, 0.2509803922, 0.0431372549,\r\n      0.5176470588235295, 0.9647058824, 0.2549019608, 0.0431372549, 0.5215686274509804,\r\n      0.9647058824, 0.262745098, 0.0431372549, 0.5254901960784314, 0.9647058824, 0.2705882353,\r\n      0.0431372549, 0.5294117647058824, 0.9647058824, 0.2745098039, 0.0431372549,\r\n      0.5333333333333333, 0.9647058824, 0.2823529412, 0.0392156863, 0.5372549019607843,\r\n      0.9647058824, 0.2901960784, 0.0392156863, 0.5411764705882353, 0.9647058824, 0.2980392157,\r\n      0.0392156863, 0.5450980392156862, 0.9647058824, 0.3058823529, 0.0392156863,\r\n      0.5490196078431373, 0.9647058824, 0.3098039216, 0.0392156863, 0.5529411764705883,\r\n      0.9647058824, 0.3176470588, 0.0392156863, 0.5568627450980392, 0.9647058824, 0.3254901961,\r\n      0.0392156863, 0.5607843137254902, 0.9647058824, 0.3333333333, 0.0392156863,\r\n      0.5647058823529412, 0.9647058824, 0.337254902, 0.0392156863, 0.5686274509803921, 0.968627451,\r\n      0.3450980392, 0.0392156863, 0.5725490196078431, 0.968627451, 0.3529411765, 0.0352941176,\r\n      0.5764705882352941, 0.968627451, 0.3607843137, 0.0352941176, 0.5803921568627451, 0.968627451,\r\n      0.368627451, 0.0352941176, 0.5843137254901961, 0.968627451, 0.3725490196, 0.0352941176,\r\n      0.5882352941176471, 0.968627451, 0.3803921569, 0.0352941176, 0.592156862745098, 0.968627451,\r\n      0.3882352941, 0.0352941176, 0.596078431372549, 0.968627451, 0.3960784314, 0.0352941176, 0.6,\r\n      0.968627451, 0.4, 0.0352941176, 0.6039215686274509, 0.968627451, 0.4078431373, 0.0352941176,\r\n      0.6078431372549019, 0.968627451, 0.4156862745, 0.0352941176, 0.611764705882353, 0.968627451,\r\n      0.4235294118, 0.031372549, 0.615686274509804, 0.9725490196, 0.431372549, 0.031372549,\r\n      0.6196078431372549, 0.9725490196, 0.4352941176, 0.031372549, 0.6235294117647059, 0.9725490196,\r\n      0.4431372549, 0.031372549, 0.6274509803921569, 0.9725490196, 0.4509803922, 0.031372549,\r\n      0.6313725490196078, 0.9725490196, 0.4588235294, 0.031372549, 0.6352941176470588, 0.9725490196,\r\n      0.462745098, 0.031372549, 0.6392156862745098, 0.9725490196, 0.4705882353, 0.031372549,\r\n      0.6431372549019608, 0.9725490196, 0.4784313725, 0.031372549, 0.6470588235294118, 0.9725490196,\r\n      0.4862745098, 0.031372549, 0.6509803921568628, 0.9725490196, 0.4941176471, 0.0274509804,\r\n      0.6549019607843137, 0.9725490196, 0.4980392157, 0.0274509804, 0.6588235294117647,\r\n      0.9725490196, 0.5058823529, 0.0274509804, 0.6627450980392157, 0.9764705882, 0.5137254902,\r\n      0.0274509804, 0.6666666666666666, 0.9764705882, 0.5215686275, 0.0274509804,\r\n      0.6705882352941176, 0.9764705882, 0.5254901961, 0.0274509804, 0.6745098039215687,\r\n      0.9764705882, 0.5333333333, 0.0274509804, 0.6784313725490196, 0.9764705882, 0.5411764706,\r\n      0.0274509804, 0.6823529411764706, 0.9764705882, 0.5490196078, 0.0274509804,\r\n      0.6862745098039216, 0.9764705882, 0.5529411765, 0.0274509804, 0.6901960784313725,\r\n      0.9764705882, 0.5607843137, 0.0235294118, 0.6941176470588235, 0.9764705882, 0.568627451,\r\n      0.0235294118, 0.6980392156862745, 0.9764705882, 0.5764705882, 0.0235294118,\r\n      0.7019607843137254, 0.9764705882, 0.5843137255, 0.0235294118, 0.7058823529411765,\r\n      0.9764705882, 0.5882352941, 0.0235294118, 0.7098039215686275, 0.9764705882, 0.5960784314,\r\n      0.0235294118, 0.7137254901960784, 0.9803921569, 0.6039215686, 0.0235294118,\r\n      0.7176470588235294, 0.9803921569, 0.6117647059, 0.0235294118, 0.7215686274509804,\r\n      0.9803921569, 0.6156862745, 0.0235294118, 0.7254901960784313, 0.9803921569, 0.6235294118,\r\n      0.0235294118, 0.7294117647058823, 0.9803921569, 0.631372549, 0.0196078431, 0.7333333333333333,\r\n      0.9803921569, 0.6392156863, 0.0196078431, 0.7372549019607844, 0.9803921569, 0.6470588235,\r\n      0.0196078431, 0.7411764705882353, 0.9803921569, 0.6509803922, 0.0196078431,\r\n      0.7450980392156863, 0.9803921569, 0.6588235294, 0.0196078431, 0.7490196078431373,\r\n      0.9803921569, 0.6666666667, 0.0196078431, 0.7529411764705882, 0.9803921569, 0.6745098039,\r\n      0.0196078431, 0.7568627450980392, 0.9803921569, 0.6784313725, 0.0196078431,\r\n      0.7607843137254902, 0.9843137255, 0.6862745098, 0.0196078431, 0.7647058823529411,\r\n      0.9843137255, 0.6941176471, 0.0196078431, 0.7686274509803922, 0.9843137255, 0.7019607843,\r\n      0.0156862745, 0.7725490196078432, 0.9843137255, 0.7098039216, 0.0156862745,\r\n      0.7764705882352941, 0.9843137255, 0.7137254902, 0.0156862745, 0.7803921568627451,\r\n      0.9843137255, 0.7215686275, 0.0156862745, 0.7843137254901961, 0.9843137255, 0.7294117647,\r\n      0.0156862745, 0.788235294117647, 0.9843137255, 0.737254902, 0.0156862745, 0.792156862745098,\r\n      0.9843137255, 0.7411764706, 0.0156862745, 0.796078431372549, 0.9843137255, 0.7490196078,\r\n      0.0156862745, 0.8, 0.9843137255, 0.7529411765, 0.0156862745, 0.803921568627451, 0.9843137255,\r\n      0.7607843137, 0.0156862745, 0.807843137254902, 0.9882352941, 0.768627451, 0.0156862745,\r\n      0.8117647058823529, 0.9882352941, 0.768627451, 0.0156862745, 0.8156862745098039, 0.9843137255,\r\n      0.7843137255, 0.0117647059, 0.8196078431372549, 0.9843137255, 0.8, 0.0117647059,\r\n      0.8235294117647058, 0.9843137255, 0.8156862745, 0.0117647059, 0.8274509803921568,\r\n      0.9803921569, 0.831372549, 0.0117647059, 0.8313725490196079, 0.9803921569, 0.8431372549,\r\n      0.0117647059, 0.8352941176470589, 0.9803921569, 0.8588235294, 0.0078431373,\r\n      0.8392156862745098, 0.9803921569, 0.8745098039, 0.0078431373, 0.8431372549019608,\r\n      0.9764705882, 0.8901960784, 0.0078431373, 0.8470588235294118, 0.9764705882, 0.9058823529,\r\n      0.0078431373, 0.8509803921568627, 0.9764705882, 0.9176470588, 0.0078431373,\r\n      0.8549019607843137, 0.9764705882, 0.9333333333, 0.0039215686, 0.8588235294117647,\r\n      0.9725490196, 0.9490196078, 0.0039215686, 0.8627450980392157, 0.9725490196, 0.9647058824,\r\n      0.0039215686, 0.8666666666666667, 0.9725490196, 0.9803921569, 0.0039215686,\r\n      0.8705882352941177, 0.9725490196, 0.9960784314, 0.0039215686, 0.8745098039215686,\r\n      0.9725490196, 0.9960784314, 0.0039215686, 0.8784313725490196, 0.9725490196, 0.9960784314,\r\n      0.0352941176, 0.8823529411764706, 0.9725490196, 0.9960784314, 0.0666666667,\r\n      0.8862745098039215, 0.9725490196, 0.9960784314, 0.0980392157, 0.8901960784313725,\r\n      0.9725490196, 0.9960784314, 0.1294117647, 0.8941176470588236, 0.9725490196, 0.9960784314,\r\n      0.1647058824, 0.8980392156862745, 0.9764705882, 0.9960784314, 0.1960784314,\r\n      0.9019607843137255, 0.9764705882, 0.9960784314, 0.2274509804, 0.9058823529411765,\r\n      0.9764705882, 0.9960784314, 0.2549019608, 0.9098039215686274, 0.9764705882, 0.9960784314,\r\n      0.2901960784, 0.9137254901960784, 0.9764705882, 0.9960784314, 0.3215686275,\r\n      0.9176470588235294, 0.9803921569, 0.9960784314, 0.3529411765, 0.9215686274509803,\r\n      0.9803921569, 0.9960784314, 0.3843137255, 0.9254901960784314, 0.9803921569, 0.9960784314,\r\n      0.4156862745, 0.9294117647058824, 0.9803921569, 0.9960784314, 0.4509803922,\r\n      0.9333333333333333, 0.9803921569, 0.9960784314, 0.4823529412, 0.9372549019607843,\r\n      0.9843137255, 0.9960784314, 0.5137254902, 0.9411764705882354, 0.9843137255, 0.9960784314,\r\n      0.5450980392, 0.9450980392156864, 0.9843137255, 0.9960784314, 0.5803921569,\r\n      0.9490196078431372, 0.9843137255, 0.9960784314, 0.6117647059, 0.9529411764705882,\r\n      0.9843137255, 0.9960784314, 0.6431372549, 0.9568627450980394, 0.9882352941, 0.9960784314,\r\n      0.6745098039, 0.9607843137254903, 0.9882352941, 0.9960784314, 0.7058823529,\r\n      0.9647058823529413, 0.9882352941, 0.9960784314, 0.7411764706, 0.9686274509803922,\r\n      0.9882352941, 0.9960784314, 0.768627451, 0.9725490196078431, 0.9882352941, 0.9960784314, 0.8,\r\n      0.9764705882352941, 0.9921568627, 0.9960784314, 0.831372549, 0.9803921568627451, 0.9921568627,\r\n      0.9960784314, 0.8666666667, 0.984313725490196, 0.9921568627, 0.9960784314, 0.8980392157,\r\n      0.9882352941176471, 0.9921568627, 0.9960784314, 0.9294117647, 0.9921568627450981,\r\n      0.9921568627, 0.9960784314, 0.9607843137, 0.996078431372549, 0.9960784314, 0.9960784314,\r\n      0.9607843137, 1.0, 0.9960784314, 0.9960784314, 0.9607843137,\r\n    ],\r\n    description: 'Siemens',\r\n  },\r\n];\r\n\r\nexport { colormaps };\r\n","import OHIF, { Types, errorHandler } from '@ohif/core';\r\nimport React from 'react';\r\n\r\nimport * as cornerstone from '@cornerstonejs/core';\r\nimport * as cornerstoneTools from '@cornerstonejs/tools';\r\nimport {\r\n  init as cs3DInit,\r\n  eventTarget,\r\n  EVENTS,\r\n  metaData,\r\n  volumeLoader,\r\n  imageLoadPoolManager,\r\n  getEnabledElement,\r\n  Settings,\r\n  utilities as csUtilities,\r\n  Enums as csEnums,\r\n} from '@cornerstonejs/core';\r\nimport {\r\n  cornerstoneStreamingImageVolumeLoader,\r\n  cornerstoneStreamingDynamicImageVolumeLoader,\r\n} from '@cornerstonejs/streaming-image-volume-loader';\r\n\r\nimport initWADOImageLoader from './initWADOImageLoader';\r\nimport initCornerstoneTools from './initCornerstoneTools';\r\n\r\nimport { connectToolsToMeasurementService } from './initMeasurementService';\r\nimport initCineService from './initCineService';\r\nimport initStudyPrefetcherService from './initStudyPrefetcherService';\r\nimport interleaveCenterLoader from './utils/interleaveCenterLoader';\r\nimport nthLoader from './utils/nthLoader';\r\nimport interleaveTopToBottom from './utils/interleaveTopToBottom';\r\nimport initContextMenu from './initContextMenu';\r\nimport initDoubleClick from './initDoubleClick';\r\nimport initViewTiming from './utils/initViewTiming';\r\nimport { colormaps } from './utils/colormaps';\r\n\r\nconst { registerColormap } = csUtilities.colormap;\r\n\r\n// TODO: Cypress tests are currently grabbing this from the window?\r\nwindow.cornerstone = cornerstone;\r\nwindow.cornerstoneTools = cornerstoneTools;\r\n/**\r\n *\r\n */\r\nexport default async function init({\r\n  servicesManager,\r\n  commandsManager,\r\n  extensionManager,\r\n  appConfig,\r\n}: Types.Extensions.ExtensionParams): Promise<void> {\r\n  // Note: this should run first before initializing the cornerstone\r\n  // DO NOT CHANGE THE ORDER\r\n  const value = appConfig.useSharedArrayBuffer;\r\n  let sharedArrayBufferDisabled = false;\r\n\r\n  if (value === 'AUTO') {\r\n    cornerstone.setUseSharedArrayBuffer(csEnums.SharedArrayBufferModes.AUTO);\r\n  } else if (value === 'FALSE' || value === false) {\r\n    cornerstone.setUseSharedArrayBuffer(csEnums.SharedArrayBufferModes.FALSE);\r\n    sharedArrayBufferDisabled = true;\r\n  } else {\r\n    cornerstone.setUseSharedArrayBuffer(csEnums.SharedArrayBufferModes.TRUE);\r\n  }\r\n\r\n  await cs3DInit({\r\n    rendering: {\r\n      preferSizeOverAccuracy: Boolean(appConfig.preferSizeOverAccuracy),\r\n      useNorm16Texture: Boolean(appConfig.useNorm16Texture),\r\n    },\r\n  });\r\n\r\n  // For debugging e2e tests that are failing on CI\r\n  cornerstone.setUseCPURendering(Boolean(appConfig.useCPURendering));\r\n\r\n  cornerstone.setConfiguration({\r\n    ...cornerstone.getConfiguration(),\r\n    rendering: {\r\n      ...cornerstone.getConfiguration().rendering,\r\n      strictZSpacingForVolumeViewport: appConfig.strictZSpacingForVolumeViewport,\r\n    },\r\n  });\r\n\r\n  // For debugging large datasets, otherwise prefer the defaults\r\n  const { maxCacheSize } = appConfig;\r\n  if (maxCacheSize) {\r\n    cornerstone.cache.setMaxCacheSize(maxCacheSize);\r\n  }\r\n\r\n  initCornerstoneTools();\r\n\r\n  Settings.getRuntimeSettings().set('useCursors', Boolean(appConfig.useCursors));\r\n\r\n  const {\r\n    userAuthenticationService,\r\n    customizationService,\r\n    uiModalService,\r\n    uiNotificationService,\r\n    cornerstoneViewportService,\r\n    hangingProtocolService,\r\n    viewportGridService,\r\n    stateSyncService,\r\n    studyPrefetcherService\r\n  } = servicesManager.services;\r\n\r\n  window.services = servicesManager.services;\r\n  window.extensionManager = extensionManager;\r\n  window.commandsManager = commandsManager;\r\n\r\n  if (\r\n    appConfig.showWarningMessageForCrossOrigin &&\r\n    !window.crossOriginIsolated &&\r\n    !sharedArrayBufferDisabled\r\n  ) {\r\n    uiNotificationService.show({\r\n      title: 'Cross Origin Isolation',\r\n      message:\r\n        'Cross Origin Isolation is not enabled, read more about it here: https://docs.ohif.org/faq/',\r\n      type: 'warning',\r\n    });\r\n  }\r\n\r\n  if (appConfig.showCPUFallbackMessage && cornerstone.getShouldUseCPURendering()) {\r\n    _showCPURenderingModal(uiModalService, hangingProtocolService);\r\n  }\r\n\r\n  // Stores a map from `lutPresentationId` to a Presentation object so that\r\n  // an OHIFCornerstoneViewport can be redisplayed with the same LUT\r\n  stateSyncService.register('lutPresentationStore', { clearOnModeExit: true });\r\n\r\n  // Stores synchronizers state to be restored\r\n  stateSyncService.register('synchronizersStore', { clearOnModeExit: true });\r\n\r\n  // Stores a map from `positionPresentationId` to a Presentation object so that\r\n  // an OHIFCornerstoneViewport can be redisplayed with the same position\r\n  stateSyncService.register('positionPresentationStore', {\r\n    clearOnModeExit: true,\r\n  });\r\n\r\n  // Stores the entire ViewportGridService getState when toggling to one up\r\n  // (e.g. via a double click) so that it can be restored when toggling back.\r\n  stateSyncService.register('toggleOneUpViewportGridStore', {\r\n    clearOnModeExit: true,\r\n  });\r\n\r\n  const labelmapRepresentation = cornerstoneTools.Enums.SegmentationRepresentations.Labelmap;\r\n  const contourRepresentation = cornerstoneTools.Enums.SegmentationRepresentations.Contour;\r\n\r\n  cornerstoneTools.segmentation.config.setGlobalRepresentationConfig(labelmapRepresentation, {\r\n    fillAlpha: 0.5,\r\n    fillAlphaInactive: 0.2,\r\n    outlineOpacity: 1,\r\n    outlineOpacityInactive: 0.65,\r\n  });\r\n\r\n  cornerstoneTools.segmentation.config.setGlobalRepresentationConfig(contourRepresentation, {\r\n    renderFill: false,\r\n  });\r\n\r\n  const metadataProvider = OHIF.classes.MetadataProvider;\r\n\r\n  volumeLoader.registerVolumeLoader(\r\n    'cornerstoneStreamingImageVolume',\r\n    cornerstoneStreamingImageVolumeLoader\r\n  );\r\n\r\n  volumeLoader.registerVolumeLoader(\r\n    'cornerstoneStreamingDynamicImageVolume',\r\n    cornerstoneStreamingDynamicImageVolumeLoader\r\n  );\r\n\r\n  hangingProtocolService.registerImageLoadStrategy('interleaveCenter', interleaveCenterLoader);\r\n  hangingProtocolService.registerImageLoadStrategy('interleaveTopToBottom', interleaveTopToBottom);\r\n  hangingProtocolService.registerImageLoadStrategy('nth', nthLoader);\r\n\r\n  // add metadata providers\r\n  metaData.addProvider(\r\n    csUtilities.calibratedPixelSpacingMetadataProvider.get.bind(\r\n      csUtilities.calibratedPixelSpacingMetadataProvider\r\n    )\r\n  ); // this provider is required for Calibration tool\r\n  metaData.addProvider(metadataProvider.get.bind(metadataProvider), 9999);\r\n\r\n  imageLoadPoolManager.maxNumRequests = {\r\n    interaction: appConfig?.maxNumRequests?.interaction || 100,\r\n    thumbnail: appConfig?.maxNumRequests?.thumbnail || 75,\r\n    prefetch: appConfig?.maxNumRequests?.prefetch || 10,\r\n  };\r\n\r\n  initWADOImageLoader(userAuthenticationService, appConfig, extensionManager);\r\n\r\n  /* Measurement Service */\r\n  this.measurementServiceSource = connectToolsToMeasurementService(servicesManager);\r\n\r\n  initCineService(servicesManager);\r\n  initStudyPrefetcherService(servicesManager);\r\n\r\n  // When a custom image load is performed, update the relevant viewports\r\n  hangingProtocolService.subscribe(\r\n    hangingProtocolService.EVENTS.CUSTOM_IMAGE_LOAD_PERFORMED,\r\n    volumeInputArrayMap => {\r\n      for (const entry of volumeInputArrayMap.entries()) {\r\n        const [viewportId, volumeInputArray] = entry;\r\n        const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n        const ohifViewport = cornerstoneViewportService.getViewportInfo(viewportId);\r\n\r\n        const { lutPresentationStore, positionPresentationStore } = stateSyncService.getState();\r\n        const { presentationIds } = ohifViewport.getViewportOptions();\r\n        const presentations = {\r\n          positionPresentation: positionPresentationStore[presentationIds?.positionPresentationId],\r\n          lutPresentation: lutPresentationStore[presentationIds?.lutPresentationId],\r\n        };\r\n\r\n        cornerstoneViewportService.setVolumesForViewport(viewport, volumeInputArray, presentations);\r\n      }\r\n    }\r\n  );\r\n\r\n  // resize the cornerstone viewport service when the grid size changes\r\n  // IMPORTANT: this should happen outside of the OHIFCornerstoneViewport\r\n  // since it will trigger a rerender of each viewport and each resizing\r\n  // the offscreen canvas which would result in a performance hit, this should\r\n  // done only once per grid resize here. Doing it once here, allows us to reduce\r\n  // the refreshRage(in ms) to 10 from 50. I tried with even 1 or 5 ms it worked fine\r\n  viewportGridService.subscribe(viewportGridService.EVENTS.GRID_SIZE_CHANGED, () => {\r\n    cornerstoneViewportService.resize(true);\r\n  });\r\n\r\n  initContextMenu({\r\n    cornerstoneViewportService,\r\n    customizationService,\r\n    commandsManager,\r\n  });\r\n\r\n  initDoubleClick({\r\n    customizationService,\r\n    commandsManager,\r\n  });\r\n\r\n  /**\r\n   * Runs error handler for failed requests.\r\n   * @param event\r\n   */\r\n  const imageLoadFailedHandler = ({ detail }) => {\r\n    const handler = errorHandler.getHTTPErrorHandler();\r\n    handler(detail.error);\r\n  };\r\n\r\n  eventTarget.addEventListener(EVENTS.STACK_VIEWPORT_NEW_STACK, evt => {\r\n    const { element } = evt.detail;\r\n    cornerstoneTools.utilities.stackContextPrefetch.enable(element);\r\n  });\r\n  eventTarget.addEventListener(EVENTS.IMAGE_LOAD_FAILED, imageLoadFailedHandler);\r\n  eventTarget.addEventListener(EVENTS.IMAGE_LOAD_ERROR, imageLoadFailedHandler);\r\n\r\n  function elementEnabledHandler(evt) {\r\n    const { element } = evt.detail;\r\n\r\n    element.addEventListener(EVENTS.CAMERA_RESET, evt => {\r\n      const { element } = evt.detail;\r\n      const enabledElement = getEnabledElement(element);\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n      const { viewportId } = enabledElement;\r\n      commandsManager.runCommand('resetCrosshairs', { viewportId });\r\n    });\r\n\r\n    // eventTarget.addEventListener(EVENTS.STACK_VIEWPORT_NEW_STACK, toolbarEventListener);\r\n\r\n    initViewTiming({ element });\r\n  }\r\n\r\n  function elementDisabledHandler(evt) {\r\n    const { element } = evt.detail;\r\n\r\n    // element.removeEventListener(EVENTS.CAMERA_RESET, resetCrosshairs);\r\n\r\n    // TODO - consider removing the callback when all elements are gone\r\n    // eventTarget.removeEventListener(\r\n    //   EVENTS.STACK_VIEWPORT_NEW_STACK,\r\n    //   newStackCallback\r\n    // );\r\n  }\r\n\r\n  eventTarget.addEventListener(EVENTS.ELEMENT_ENABLED, elementEnabledHandler.bind(null));\r\n\r\n  eventTarget.addEventListener(EVENTS.ELEMENT_DISABLED, elementDisabledHandler.bind(null));\r\n  colormaps.forEach(registerColormap);\r\n\r\n  // Event listener\r\n  eventTarget.addEventListenerDebounced(\r\n    EVENTS.ERROR_EVENT,\r\n    ({ detail }) => {\r\n      uiNotificationService.show({\r\n        title: detail.type,\r\n        message: detail.message,\r\n        type: 'error',\r\n      });\r\n    },\r\n    1000\r\n  );\r\n}\r\n\r\nfunction CPUModal() {\r\n  return (\r\n    <div>\r\n      <p>\r\n        Your computer does not have enough GPU power to support the default GPU rendering mode. OHIF\r\n        has switched to CPU rendering mode. Please note that CPU rendering does not support all\r\n        features such as Volume Rendering, Multiplanar Reconstruction, and Segmentation Overlays.\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction _showCPURenderingModal(uiModalService, hangingProtocolService) {\r\n  const callback = progress => {\r\n    if (progress === 100) {\r\n      uiModalService.show({\r\n        content: CPUModal,\r\n        title: 'OHIF Fell Back to CPU Rendering',\r\n      });\r\n\r\n      return true;\r\n    }\r\n  };\r\n\r\n  const { unsubscribe } = hangingProtocolService.subscribe(\r\n    hangingProtocolService.EVENTS.PROTOCOL_CHANGED,\r\n    () => {\r\n      const done = callback(100);\r\n\r\n      if (done) {\r\n        unsubscribe();\r\n      }\r\n    }\r\n  );\r\n}\r\n","import dicomImageLoader from '@cornerstonejs/dicom-image-loader';\r\n\r\nimport { PubSubService } from '@ohif/core';\r\n\r\nexport const EVENTS = {\r\n  PROGRESS: 'event:DicomFileUploader:progress',\r\n};\r\n\r\nexport interface DicomFileUploaderEvent {\r\n  fileId: number;\r\n}\r\n\r\nexport interface DicomFileUploaderProgressEvent extends DicomFileUploaderEvent {\r\n  percentComplete: number;\r\n}\r\n\r\nexport enum UploadStatus {\r\n  NotStarted,\r\n  InProgress,\r\n  Success,\r\n  Failed,\r\n  Cancelled,\r\n}\r\n\r\ntype CancelOrFailed = UploadStatus.Cancelled | UploadStatus.Failed;\r\n\r\nexport class UploadRejection {\r\n  message: string;\r\n  status: CancelOrFailed;\r\n\r\n  constructor(status: CancelOrFailed, message: string) {\r\n    this.message = message;\r\n    this.status = status;\r\n  }\r\n}\r\n\r\nexport default class DicomFileUploader extends PubSubService {\r\n  private _file;\r\n  private _fileId;\r\n  private _dataSource;\r\n  private _loadPromise;\r\n  private _abortController = new AbortController();\r\n  private _status: UploadStatus = UploadStatus.NotStarted;\r\n  private _percentComplete = 0;\r\n\r\n  constructor(file, dataSource) {\r\n    super(EVENTS);\r\n    this._file = file;\r\n    this._fileId = dicomImageLoader.wadouri.fileManager.add(file);\r\n    this._dataSource = dataSource;\r\n  }\r\n\r\n  getFileId(): string {\r\n    return this._fileId;\r\n  }\r\n\r\n  getFileName(): string {\r\n    return this._file.name;\r\n  }\r\n\r\n  getFileSize(): number {\r\n    return this._file.size;\r\n  }\r\n\r\n  cancel(): void {\r\n    this._abortController.abort();\r\n  }\r\n\r\n  getStatus(): UploadStatus {\r\n    return this._status;\r\n  }\r\n\r\n  getPercentComplete(): number {\r\n    return this._percentComplete;\r\n  }\r\n\r\n  async load(): Promise<void> {\r\n    if (this._loadPromise) {\r\n      // Already started loading, return the load promise.\r\n      return this._loadPromise;\r\n    }\r\n\r\n    this._loadPromise = new Promise<void>((resolve, reject) => {\r\n      // The upload listeners: fire progress events and/or settle the promise.\r\n      const uploadCallbacks = {\r\n        progress: evt => {\r\n          if (!evt.lengthComputable) {\r\n            // Progress computation is not possible.\r\n            return;\r\n          }\r\n\r\n          this._status = UploadStatus.InProgress;\r\n\r\n          this._percentComplete = Math.round((100 * evt.loaded) / evt.total);\r\n          this._broadcastEvent(EVENTS.PROGRESS, {\r\n            fileId: this._fileId,\r\n            percentComplete: this._percentComplete,\r\n          });\r\n        },\r\n        timeout: () => {\r\n          this._reject(reject, new UploadRejection(UploadStatus.Failed, 'The request timed out.'));\r\n        },\r\n        abort: () => {\r\n          this._reject(reject, new UploadRejection(UploadStatus.Cancelled, 'Cancelled'));\r\n        },\r\n        error: () => {\r\n          this._reject(reject, new UploadRejection(UploadStatus.Failed, 'The request failed.'));\r\n        },\r\n      };\r\n\r\n      // First try to load the file.\r\n      dicomImageLoader.wadouri\r\n        .loadFileRequest(this._fileId)\r\n        .then(dicomFile => {\r\n          if (this._abortController.signal.aborted) {\r\n            this._reject(reject, new UploadRejection(UploadStatus.Cancelled, 'Cancelled'));\r\n            return;\r\n          }\r\n\r\n          if (!this._checkDicomFile(dicomFile)) {\r\n            // The file is not DICOM\r\n            this._reject(\r\n              reject,\r\n              new UploadRejection(UploadStatus.Failed, 'Not a valid DICOM file.')\r\n            );\r\n            return;\r\n          }\r\n\r\n          const request = new XMLHttpRequest();\r\n          this._addRequestCallbacks(request, uploadCallbacks);\r\n\r\n          // Do the actual upload by supplying the DICOM file and upload callbacks/listeners.\r\n          return this._dataSource.store\r\n            .dicom(dicomFile, request)\r\n            .then(() => {\r\n              this._status = UploadStatus.Success;\r\n              resolve();\r\n            })\r\n            .catch(reason => {\r\n              this._reject(reject, reason);\r\n            });\r\n        })\r\n        .catch(reason => {\r\n          this._reject(reject, reason);\r\n        });\r\n    });\r\n\r\n    return this._loadPromise;\r\n  }\r\n\r\n  private _isRejected(): boolean {\r\n    return this._status === UploadStatus.Failed || this._status === UploadStatus.Cancelled;\r\n  }\r\n\r\n  private _reject(reject: (reason?: any) => void, reason: any) {\r\n    if (this._isRejected()) {\r\n      return;\r\n    }\r\n\r\n    if (reason instanceof UploadRejection) {\r\n      this._status = reason.status;\r\n      reject(reason);\r\n      return;\r\n    }\r\n\r\n    this._status = UploadStatus.Failed;\r\n\r\n    if (reason.message) {\r\n      reject(new UploadRejection(UploadStatus.Failed, reason.message));\r\n      return;\r\n    }\r\n\r\n    reject(new UploadRejection(UploadStatus.Failed, reason));\r\n  }\r\n\r\n  private _addRequestCallbacks(request: XMLHttpRequest, uploadCallbacks) {\r\n    const abortCallback = () => request.abort();\r\n    this._abortController.signal.addEventListener('abort', abortCallback);\r\n\r\n    for (const [eventName, callback] of Object.entries(uploadCallbacks)) {\r\n      request.upload.addEventListener(eventName, callback);\r\n    }\r\n\r\n    const cleanUpCallback = () => {\r\n      this._abortController.signal.removeEventListener('abort', abortCallback);\r\n\r\n      for (const [eventName, callback] of Object.entries(uploadCallbacks)) {\r\n        request.upload.removeEventListener(eventName, callback);\r\n      }\r\n\r\n      request.removeEventListener('loadend', cleanUpCallback);\r\n    };\r\n    request.addEventListener('loadend', cleanUpCallback);\r\n  }\r\n\r\n  private _checkDicomFile(arrayBuffer: ArrayBuffer) {\r\n    if (arrayBuffer.length <= 132) {\r\n      return false;\r\n    }\r\n    const arr = new Uint8Array(arrayBuffer.slice(128, 132));\r\n    // bytes from 128 to 132 must be \"DICM\"\r\n    return Array.from('DICM').every((char, i) => char.charCodeAt(0) === arr[i]);\r\n  }\r\n}\r\n","import React, { ReactElement, memo, useCallback, useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DicomFileUploader, {\r\n  DicomFileUploaderProgressEvent,\r\n  EVENTS,\r\n  UploadRejection,\r\n  UploadStatus,\r\n} from '../../utils/DicomFileUploader';\r\nimport { Icon } from '@ohif/ui';\r\n\r\ntype DicomUploadProgressItemProps = {\r\n  dicomFileUploader: DicomFileUploader;\r\n};\r\n\r\n// eslint-disable-next-line react/display-name\r\nconst DicomUploadProgressItem = memo(\r\n  ({ dicomFileUploader }: DicomUploadProgressItemProps): ReactElement => {\r\n    const [percentComplete, setPercentComplete] = useState(dicomFileUploader.getPercentComplete());\r\n    const [failedReason, setFailedReason] = useState('');\r\n    const [status, setStatus] = useState(dicomFileUploader.getStatus());\r\n\r\n    const isComplete = useCallback(() => {\r\n      return (\r\n        status === UploadStatus.Failed ||\r\n        status === UploadStatus.Cancelled ||\r\n        status === UploadStatus.Success\r\n      );\r\n    }, [status]);\r\n\r\n    useEffect(() => {\r\n      const progressSubscription = dicomFileUploader.subscribe(\r\n        EVENTS.PROGRESS,\r\n        (dicomFileUploaderProgressEvent: DicomFileUploaderProgressEvent) => {\r\n          setPercentComplete(dicomFileUploaderProgressEvent.percentComplete);\r\n        }\r\n      );\r\n\r\n      dicomFileUploader\r\n        .load()\r\n        .catch((reason: UploadRejection) => {\r\n          setStatus(reason.status);\r\n          setFailedReason(reason.message ?? '');\r\n        })\r\n        .finally(() => setStatus(dicomFileUploader.getStatus()));\r\n\r\n      return () => progressSubscription.unsubscribe();\r\n    }, []);\r\n\r\n    const cancelUpload = useCallback(() => {\r\n      dicomFileUploader.cancel();\r\n    }, []);\r\n\r\n    const getStatusIcon = (): ReactElement => {\r\n      switch (dicomFileUploader.getStatus()) {\r\n        case UploadStatus.Success:\r\n          return (\r\n            <Icon\r\n              name=\"status-tracked\"\r\n              className=\"text-primary-light\"\r\n            ></Icon>\r\n          );\r\n        case UploadStatus.InProgress:\r\n          return <Icon name=\"icon-transferring\"></Icon>;\r\n        case UploadStatus.Failed:\r\n          return <Icon name=\"icon-alert-small\"></Icon>;\r\n        case UploadStatus.Cancelled:\r\n          return <Icon name=\"icon-alert-outline\"></Icon>;\r\n        default:\r\n          return <></>;\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div className=\"min-h-14 border-secondary-light flex w-full items-center overflow-hidden border-b p-2.5 text-lg\">\r\n        <div className=\"self-top flex w-0 shrink grow flex-col gap-1\">\r\n          <div className=\"flex gap-4\">\r\n            <div className=\"flex w-6 shrink-0 items-center justify-center\">{getStatusIcon()}</div>\r\n            <div className=\"overflow-hidden text-ellipsis whitespace-nowrap\">\r\n              {dicomFileUploader.getFileName()}\r\n            </div>\r\n          </div>\r\n          {failedReason && <div className=\"pl-10\">{failedReason}</div>}\r\n        </div>\r\n        <div className=\"flex w-24 items-center\">\r\n          {!isComplete() && (\r\n            <>\r\n              {dicomFileUploader.getStatus() === UploadStatus.InProgress && (\r\n                <div className=\"w-10 text-right\">{percentComplete}%</div>\r\n              )}\r\n              <div className=\"ml-auto flex cursor-pointer\">\r\n                <Icon\r\n                  className=\"text-primary-active self-center\"\r\n                  name=\"close\"\r\n                  onClick={cancelUpload}\r\n                />\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nDicomUploadProgressItem.propTypes = {\r\n  dicomFileUploader: PropTypes.instanceOf(DicomFileUploader).isRequired,\r\n};\r\n\r\nexport default DicomUploadProgressItem;\r\n","import React, { useCallback, useEffect, useRef, useState, ReactElement } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Button, Icon, ProgressLoadingBar } from '@ohif/ui';\r\nimport DicomFileUploader, {\r\n  EVENTS,\r\n  UploadStatus,\r\n  DicomFileUploaderProgressEvent,\r\n  UploadRejection,\r\n} from '../../utils/DicomFileUploader';\r\nimport DicomUploadProgressItem from './DicomUploadProgressItem';\r\nimport classNames from 'classnames';\r\n\r\ntype DicomUploadProgressProps = {\r\n  dicomFileUploaderArr: DicomFileUploader[];\r\n  onComplete: () => void;\r\n};\r\n\r\nconst ONE_SECOND = 1000;\r\nconst ONE_MINUTE = ONE_SECOND * 60;\r\nconst ONE_HOUR = ONE_MINUTE * 60;\r\n\r\n// The base/initial interval time length used to calculate the\r\n// rate of the upload and in turn estimate the\r\n// the amount of time remaining for the upload. This is the length\r\n// of the very first interval to get a reasonable estimate on screen in\r\n// a reasonable amount of time. The length of each interval after the first\r\n// is based on the upload rate calculated. Faster rates use this base interval\r\n// length. Slower rates below UPLOAD_RATE_THRESHOLD get longer interval times\r\n// to obtain more accurate upload rates.\r\nconst BASE_INTERVAL_TIME = 15000;\r\n\r\n// The upload rate threshold to determine the length of the interval to\r\n// calculate the upload rate.\r\nconst UPLOAD_RATE_THRESHOLD = 75;\r\n\r\nconst NO_WRAP_ELLIPSIS_CLASS_NAMES = 'text-ellipsis whitespace-nowrap overflow-hidden';\r\n\r\nfunction DicomUploadProgress({\r\n  dicomFileUploaderArr,\r\n  onComplete,\r\n}: DicomUploadProgressProps): ReactElement {\r\n  const [totalUploadSize] = useState(\r\n    dicomFileUploaderArr.reduce((acc, fileUploader) => acc + fileUploader.getFileSize(), 0)\r\n  );\r\n\r\n  const currentUploadSizeRef = useRef<number>(0);\r\n\r\n  const uploadRateRef = useRef(0);\r\n\r\n  const [timeRemaining, setTimeRemaining] = useState<number>(null);\r\n\r\n  const [percentComplete, setPercentComplete] = useState(0);\r\n\r\n  const [numFilesCompleted, setNumFilesCompleted] = useState(0);\r\n\r\n  const [numFails, setNumFails] = useState(0);\r\n\r\n  const [showFailedOnly, setShowFailedOnly] = useState(false);\r\n\r\n  const progressBarContainerRef = useRef<HTMLElement>();\r\n\r\n  /**\r\n   * The effect for measuring and setting the current upload rate. This is\r\n   * done by measuring the amount of data uploaded in a set interval time.\r\n   */\r\n  useEffect(() => {\r\n    let timeoutId: NodeJS.Timeout;\r\n\r\n    // The amount of data already uploaded at the start of the interval.\r\n    let intervalStartUploadSize = 0;\r\n\r\n    // The starting time of the interval.\r\n    let intervalStartTime = Date.now();\r\n\r\n    const setUploadRateRef = () => {\r\n      const uploadSizeFromStartOfInterval = currentUploadSizeRef.current - intervalStartUploadSize;\r\n\r\n      const now = Date.now();\r\n      const timeSinceStartOfInterval = now - intervalStartTime;\r\n\r\n      // Calculate and set the upload rate (ref)\r\n      uploadRateRef.current = uploadSizeFromStartOfInterval / timeSinceStartOfInterval;\r\n\r\n      // Reset the interval starting values.\r\n      intervalStartUploadSize = currentUploadSizeRef.current;\r\n      intervalStartTime = now;\r\n\r\n      // Only start a new interval if there is more to upload.\r\n      if (totalUploadSize - currentUploadSizeRef.current > 0) {\r\n        if (uploadRateRef.current >= UPLOAD_RATE_THRESHOLD) {\r\n          timeoutId = setTimeout(setUploadRateRef, BASE_INTERVAL_TIME);\r\n        } else {\r\n          // The current upload rate is relatively slow, so use a larger\r\n          // time interval to get a better upload rate estimate.\r\n          timeoutId = setTimeout(setUploadRateRef, BASE_INTERVAL_TIME * 2);\r\n        }\r\n      }\r\n    };\r\n\r\n    // The very first interval is just the base time interval length.\r\n    timeoutId = setTimeout(setUploadRateRef, BASE_INTERVAL_TIME);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * The effect for: updating the overall percentage complete; setting the\r\n   * estimated time remaining; updating the number of files uploaded; and\r\n   * detecting if any error has occurred.\r\n   */\r\n  useEffect(() => {\r\n    let currentTimeRemaining = null;\r\n\r\n    // For each uploader, listen for the progress percentage complete and\r\n    // add promise catch/finally callbacks to detect errors and count number\r\n    // of uploads complete.\r\n    const subscriptions = dicomFileUploaderArr.map(fileUploader => {\r\n      let currentFileUploadSize = 0;\r\n\r\n      const updateProgress = (percentComplete: number) => {\r\n        const previousFileUploadSize = currentFileUploadSize;\r\n\r\n        currentFileUploadSize = Math.round((percentComplete / 100) * fileUploader.getFileSize());\r\n\r\n        currentUploadSizeRef.current = Math.min(\r\n          totalUploadSize,\r\n          currentUploadSizeRef.current - previousFileUploadSize + currentFileUploadSize\r\n        );\r\n\r\n        setPercentComplete((currentUploadSizeRef.current / totalUploadSize) * 100);\r\n\r\n        if (uploadRateRef.current !== 0) {\r\n          const uploadSizeRemaining = totalUploadSize - currentUploadSizeRef.current;\r\n\r\n          const timeRemaining = Math.round(uploadSizeRemaining / uploadRateRef.current);\r\n\r\n          if (currentTimeRemaining === null) {\r\n            currentTimeRemaining = timeRemaining;\r\n            setTimeRemaining(currentTimeRemaining);\r\n            return;\r\n          }\r\n\r\n          // Do not show an increase in the time remaining by two seconds or minutes\r\n          // so as to prevent jumping the time remaining up and down constantly\r\n          // due to rounding, inaccuracies in the estimate and slight variations\r\n          // in upload rates over time.\r\n          if (timeRemaining < ONE_MINUTE) {\r\n            const currentSecondsRemaining = Math.ceil(currentTimeRemaining / ONE_SECOND);\r\n            const secondsRemaining = Math.ceil(timeRemaining / ONE_SECOND);\r\n            const delta = secondsRemaining - currentSecondsRemaining;\r\n            if (delta < 0 || delta > 2) {\r\n              currentTimeRemaining = timeRemaining;\r\n              setTimeRemaining(currentTimeRemaining);\r\n            }\r\n            return;\r\n          }\r\n\r\n          if (timeRemaining < ONE_HOUR) {\r\n            const currentMinutesRemaining = Math.ceil(currentTimeRemaining / ONE_MINUTE);\r\n            const minutesRemaining = Math.ceil(timeRemaining / ONE_MINUTE);\r\n            const delta = minutesRemaining - currentMinutesRemaining;\r\n            if (delta < 0 || delta > 2) {\r\n              currentTimeRemaining = timeRemaining;\r\n              setTimeRemaining(currentTimeRemaining);\r\n            }\r\n            return;\r\n          }\r\n\r\n          // Hours remaining...\r\n          currentTimeRemaining = timeRemaining;\r\n          setTimeRemaining(currentTimeRemaining);\r\n        }\r\n      };\r\n\r\n      const progressCallback = (progressEvent: DicomFileUploaderProgressEvent) => {\r\n        updateProgress(progressEvent.percentComplete);\r\n      };\r\n\r\n      // Use the uploader promise to flag any error and count the number of\r\n      // uploads completed.\r\n      fileUploader\r\n        .load()\r\n        .catch((rejection: UploadRejection) => {\r\n          if (rejection.status === UploadStatus.Failed) {\r\n            setNumFails(numFails => numFails + 1);\r\n          }\r\n        })\r\n        .finally(() => {\r\n          // If any error occurred, the percent complete progress stops firing\r\n          // but this call to updateProgress nicely puts all finished uploads at 100%.\r\n          updateProgress(100);\r\n          setNumFilesCompleted(numCompleted => numCompleted + 1);\r\n        });\r\n\r\n      return fileUploader.subscribe(EVENTS.PROGRESS, progressCallback);\r\n    });\r\n    return () => {\r\n      subscriptions.forEach(subscription => subscription.unsubscribe());\r\n    };\r\n  }, []);\r\n\r\n  const cancelAllUploads = useCallback(async () => {\r\n    for (const dicomFileUploader of dicomFileUploaderArr) {\r\n      // Important: we need a non-blocking way to cancel every upload,\r\n      // otherwise the UI will freeze and the user will not be able\r\n      // to interact with the app and progress will not be updated.\r\n      const promise = new Promise<void>((resolve, reject) => {\r\n        setTimeout(() => {\r\n          dicomFileUploader.cancel();\r\n          resolve();\r\n        }, 0);\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  const getFormattedTimeRemaining = useCallback((): string => {\r\n    if (timeRemaining == null) {\r\n      return '';\r\n    }\r\n\r\n    if (timeRemaining < ONE_MINUTE) {\r\n      const secondsRemaining = Math.ceil(timeRemaining / ONE_SECOND);\r\n      return `${secondsRemaining} ${secondsRemaining === 1 ? 'second' : 'seconds'}`;\r\n    }\r\n\r\n    if (timeRemaining < ONE_HOUR) {\r\n      const minutesRemaining = Math.ceil(timeRemaining / ONE_MINUTE);\r\n      return `${minutesRemaining} ${minutesRemaining === 1 ? 'minute' : 'minutes'}`;\r\n    }\r\n\r\n    const hoursRemaining = Math.ceil(timeRemaining / ONE_HOUR);\r\n    return `${hoursRemaining} ${hoursRemaining === 1 ? 'hour' : 'hours'}`;\r\n  }, [timeRemaining]);\r\n\r\n  const getPercentCompleteRounded = useCallback(\r\n    () => Math.min(100, Math.round(percentComplete)),\r\n    [percentComplete]\r\n  );\r\n\r\n  /**\r\n   * Determines if the progress bar should show the infinite animation or not.\r\n   * Show the infinite animation for progress less than 1% AND if less than\r\n   * one pixel of the progress bar would be displayed.\r\n   */\r\n  const showInfiniteProgressBar = useCallback((): boolean => {\r\n    return (\r\n      getPercentCompleteRounded() < 1 &&\r\n      (progressBarContainerRef?.current?.offsetWidth ?? 0) * (percentComplete / 100) < 1\r\n    );\r\n  }, [getPercentCompleteRounded, percentComplete]);\r\n\r\n  /**\r\n   * Gets the css style for the 'n of m' (files completed) text. The only css attribute\r\n   * of the style is width such that the 'n of m' is always a fixed width and thus\r\n   * as each file completes uploading the text on screen does not constantly shift\r\n   * left and right.\r\n   */\r\n  const getNofMFilesStyle = useCallback(() => {\r\n    // the number of digits accounts for the digits being on each side of the ' of '\r\n    const numDigits = 2 * dicomFileUploaderArr.length.toString().length;\r\n    // the number of digits + 2 spaces and 2 characters for ' of '\r\n    const numChars = numDigits + 4;\r\n    return { width: `${numChars}ch` };\r\n  }, []);\r\n\r\n  const getNumCompletedAndTimeRemainingComponent = (): ReactElement => {\r\n    return (\r\n      <div className=\"bg-primary-dark flex h-14 items-center px-1 pb-4 text-lg\">\r\n        {numFilesCompleted === dicomFileUploaderArr.length ? (\r\n          <>\r\n            <span className={NO_WRAP_ELLIPSIS_CLASS_NAMES}>{`${dicomFileUploaderArr.length} ${\r\n              dicomFileUploaderArr.length > 1 ? 'files' : 'file'\r\n            } completed.`}</span>\r\n            <Button\r\n              disabled={false}\r\n              className=\"ml-auto\"\r\n              onClick={onComplete}\r\n            >\r\n              {'Close'}\r\n            </Button>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <span\r\n              style={getNofMFilesStyle()}\r\n              className={classNames(NO_WRAP_ELLIPSIS_CLASS_NAMES, 'text-end')}\r\n            >\r\n              {`${numFilesCompleted} of ${dicomFileUploaderArr.length}`}&nbsp;\r\n            </span>\r\n            <span className={NO_WRAP_ELLIPSIS_CLASS_NAMES}>{' files completed.'}&nbsp;</span>\r\n            <span className={NO_WRAP_ELLIPSIS_CLASS_NAMES}>\r\n              {timeRemaining ? `Less than ${getFormattedTimeRemaining()} remaining. ` : ''}\r\n            </span>\r\n            <span\r\n              className={classNames(\r\n                NO_WRAP_ELLIPSIS_CLASS_NAMES,\r\n                'text-primary-active hover:text-primary-light active:text-aqua-pale ml-auto cursor-pointer'\r\n              )}\r\n              onClick={cancelAllUploads}\r\n            >\r\n              Cancel All Uploads\r\n            </span>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getShowFailedOnlyIconComponent = (): ReactElement => {\r\n    return (\r\n      <div className=\"ml-auto flex w-6 justify-center\">\r\n        {numFails > 0 && (\r\n          <div onClick={() => setShowFailedOnly(currentShowFailedOnly => !currentShowFailedOnly)}>\r\n            <Icon\r\n              className=\"cursor-pointer\"\r\n              name=\"icon-status-alert\"\r\n            ></Icon>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getPercentCompleteComponent = (): ReactElement => {\r\n    return (\r\n      <div className=\"ohif-scrollbar border-secondary-light overflow-y-scroll border-b px-2\">\r\n        <div className=\"min-h-14 flex w-full items-center p-2.5\">\r\n          {numFilesCompleted === dicomFileUploaderArr.length ? (\r\n            <>\r\n              <div className=\"text-primary-light text-xl\">\r\n                {numFails > 0\r\n                  ? `Completed with ${numFails} ${numFails > 1 ? 'errors' : 'error'}!`\r\n                  : 'Completed!'}\r\n              </div>\r\n              {getShowFailedOnlyIconComponent()}\r\n            </>\r\n          ) : (\r\n            <>\r\n              <div\r\n                ref={progressBarContainerRef}\r\n                className=\"flex-grow\"\r\n              >\r\n                <ProgressLoadingBar\r\n                  progress={showInfiniteProgressBar() ? undefined : Math.min(100, percentComplete)}\r\n                ></ProgressLoadingBar>\r\n              </div>\r\n              <div className=\"ml-1 flex w-24 items-center\">\r\n                <div className=\"w-10 text-right\">{`${getPercentCompleteRounded()}%`}</div>\r\n                {getShowFailedOnlyIconComponent()}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex grow flex-col\">\r\n      {getNumCompletedAndTimeRemainingComponent()}\r\n      <div className=\"flex grow flex-col overflow-hidden bg-black text-lg\">\r\n        {getPercentCompleteComponent()}\r\n        <div className=\"ohif-scrollbar h-1 grow overflow-y-scroll px-2\">\r\n          {dicomFileUploaderArr\r\n            .filter(\r\n              dicomFileUploader =>\r\n                !showFailedOnly || dicomFileUploader.getStatus() === UploadStatus.Failed\r\n            )\r\n            .map(dicomFileUploader => (\r\n              <DicomUploadProgressItem\r\n                key={dicomFileUploader.getFileId()}\r\n                dicomFileUploader={dicomFileUploader}\r\n              />\r\n            ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nDicomUploadProgress.propTypes = {\r\n  dicomFileUploaderArr: PropTypes.arrayOf(PropTypes.instanceOf(DicomFileUploader)).isRequired,\r\n  onComplete: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DicomUploadProgress;\r\n","import React, { useCallback, useState } from 'react';\r\nimport { ReactElement } from 'react';\r\nimport Dropzone from 'react-dropzone';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport DicomFileUploader from '../../utils/DicomFileUploader';\r\nimport DicomUploadProgress from './DicomUploadProgress';\r\nimport { Button, ButtonEnums } from '@ohif/ui';\r\nimport './DicomUpload.css';\r\n\r\ntype DicomUploadProps = {\r\n  dataSource;\r\n  onComplete: () => void;\r\n  onStarted: () => void;\r\n};\r\n\r\nfunction DicomUpload({ dataSource, onComplete, onStarted }: DicomUploadProps): ReactElement {\r\n  const baseClassNames = 'min-h-[480px] flex flex-col bg-black select-none';\r\n  const [dicomFileUploaderArr, setDicomFileUploaderArr] = useState([]);\r\n\r\n  const onDrop = useCallback(async acceptedFiles => {\r\n    onStarted();\r\n    setDicomFileUploaderArr(acceptedFiles.map(file => new DicomFileUploader(file, dataSource)));\r\n  }, []);\r\n\r\n  const getDropZoneComponent = (): ReactElement => {\r\n    return (\r\n      <Dropzone\r\n        onDrop={acceptedFiles => {\r\n          onDrop(acceptedFiles);\r\n        }}\r\n        noClick\r\n      >\r\n        {({ getRootProps }) => (\r\n          <div\r\n            {...getRootProps()}\r\n            className=\"dicom-upload-drop-area-border-dash m-5 flex h-full flex-col items-center justify-center\"\r\n          >\r\n            <div className=\"flex gap-3\">\r\n              <Dropzone\r\n                onDrop={onDrop}\r\n                noDrag\r\n              >\r\n                {({ getRootProps, getInputProps }) => (\r\n                  <div {...getRootProps()}>\r\n                    <Button\r\n                      disabled={false}\r\n                      onClick={() => {}}\r\n                    >\r\n                      {'Add files'}\r\n                      <input {...getInputProps()} />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </Dropzone>\r\n              <Dropzone\r\n                onDrop={onDrop}\r\n                noDrag\r\n              >\r\n                {({ getRootProps, getInputProps }) => (\r\n                  <div {...getRootProps()}>\r\n                    <Button\r\n                      type={ButtonEnums.type.secondary}\r\n                      disabled={false}\r\n                      onClick={() => {}}\r\n                    >\r\n                      {'Add folder'}\r\n                      <input\r\n                        {...getInputProps()}\r\n                        webkitdirectory=\"true\"\r\n                        mozdirectory=\"true\"\r\n                      />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </Dropzone>\r\n            </div>\r\n            <div className=\"pt-5\">or drag images or folders here</div>\r\n            <div className=\"text-aqua-pale pt-3 text-lg\">(DICOM files supported)</div>\r\n          </div>\r\n        )}\r\n      </Dropzone>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {dicomFileUploaderArr.length ? (\r\n        <div className={classNames('h-[calc(100vh-300px)]', baseClassNames)}>\r\n          <DicomUploadProgress\r\n            dicomFileUploaderArr={Array.from(dicomFileUploaderArr)}\r\n            onComplete={onComplete}\r\n          />\r\n        </div>\r\n      ) : (\r\n        <div className={classNames('h-[480px]', baseClassNames)}>{getDropZoneComponent()}</div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nDicomUpload.propTypes = {\r\n  dataSource: PropTypes.object.isRequired,\r\n  onComplete: PropTypes.func.isRequired,\r\n  onStarted: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DicomUpload;\r\n","// The following are the default window level presets and can be further\r\n// configured via the customization service.\r\nconst defaultWindowLevelPresets = {\r\n  CT: [\r\n    { description: 'Soft tissue', window: '400', level: '40' },\r\n    { description: 'Lung', window: '1500', level: '-600' },\r\n    { description: 'Liver', window: '150', level: '90' },\r\n    { description: 'Bone', window: '2500', level: '480' },\r\n    { description: 'Brain', window: '80', level: '40' },\r\n  ],\r\n\r\n  PT: [\r\n    { description: 'Default', window: '5', level: '2.5' },\r\n    { description: 'SUV', window: '0', level: '3' },\r\n    { description: 'SUV', window: '0', level: '5' },\r\n    { description: 'SUV', window: '0', level: '7' },\r\n    { description: 'SUV', window: '0', level: '8' },\r\n    { description: 'SUV', window: '0', level: '10' },\r\n    { description: 'SUV', window: '0', level: '15' },\r\n  ],\r\n};\r\n\r\nexport default defaultWindowLevelPresets;\r\n","import { Enums } from '@cornerstonejs/tools';\r\nimport { toolNames } from './initCornerstoneTools';\r\nimport DicomUpload from './components/DicomUpload/DicomUpload';\r\nimport defaultWindowLevelPresets from './components/WindowLevelActionMenu/defaultWindowLevelPresets';\r\nimport { colormaps } from './utils/colormaps';\r\nimport { CONSTANTS } from '@cornerstonejs/core';\r\nimport { CornerstoneOverlay } from './Viewport/Overlays/CustomizableViewportOverlay';\r\n\r\nconst DefaultColormap = 'Grayscale';\r\nconst { VIEWPORT_PRESETS } = CONSTANTS;\r\n\r\nconst tools = {\r\n  active: [\r\n    {\r\n      toolName: toolNames.WindowLevel,\r\n      bindings: [{ mouseButton: Enums.MouseBindings.Primary }],\r\n    },\r\n    {\r\n      toolName: toolNames.Pan,\r\n      bindings: [{ mouseButton: Enums.MouseBindings.Auxiliary }],\r\n    },\r\n    {\r\n      toolName: toolNames.Zoom,\r\n      bindings: [{ mouseButton: Enums.MouseBindings.Secondary }],\r\n    },\r\n    { toolName: toolNames.StackScrollMouseWheel, bindings: [] },\r\n  ],\r\n  enabled: [\r\n    { toolName: toolNames.SegmentationDisplay },\r\n    {\r\n      toolName: toolNames.PlanarFreehandContourSegmentation,\r\n      configuration: {\r\n        displayOnePointAsCrosshairs: true,\r\n      },\r\n    },\r\n  ],\r\n};\r\n\r\nfunction getCustomizationModule() {\r\n  return [\r\n    {\r\n      name: 'cornerstoneDicomUploadComponent',\r\n      value: {\r\n        id: 'dicomUploadComponent',\r\n        component: DicomUpload,\r\n      },\r\n    },\r\n    {\r\n      name: 'default',\r\n      value: [\r\n        CornerstoneOverlay,\r\n        {\r\n          id: 'cornerstone.overlayViewportTools',\r\n          tools,\r\n        },\r\n        {\r\n          id: 'cornerstone.windowLevelPresets',\r\n          presets: defaultWindowLevelPresets,\r\n        },\r\n        {\r\n          id: 'cornerstone.colorbar',\r\n          width: '16px',\r\n          colorbarTickPosition: 'left',\r\n          colormaps,\r\n          colorbarContainerPosition: 'right',\r\n          colorbarInitialColormap: DefaultColormap,\r\n        },\r\n        {\r\n          id: 'cornerstone.3dVolumeRendering',\r\n          volumeRenderingPresets: VIEWPORT_PRESETS,\r\n          volumeRenderingQualityRange: {\r\n            min: 1,\r\n            max: 4,\r\n            step: 1,\r\n          },\r\n        },\r\n        {\r\n          id: 'cornerstone.measurements',\r\n          Angle: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          CobbAngle: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          ArrowAnnotate: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          RectangleROi: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          CircleROI: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          EllipticalROI: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          Bidirectional: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          Length: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          LivewireContour: {\r\n            displayText: [],\r\n            report: [],\r\n          },\r\n          SplineROI: {\r\n            displayText: [\r\n              {\r\n                displayName: 'Area',\r\n                value: 'area',\r\n                type: 'value',\r\n              },\r\n              {\r\n                value: 'areaUnit',\r\n                for: ['area'],\r\n                type: 'unit',\r\n              },\r\n              /**\r\n              {\r\n                displayName: 'Modality',\r\n                value: 'Modality',\r\n                type: 'value',\r\n              },\r\n              */\r\n            ],\r\n            report: [\r\n              {\r\n                displayName: 'Area',\r\n                value: 'area',\r\n                type: 'value',\r\n              },\r\n              {\r\n                displayName: 'Unit',\r\n                value: 'areaUnit',\r\n                type: 'value',\r\n              },\r\n            ],\r\n          },\r\n          PlanarFreehandROI: {\r\n            displayText: [\r\n              {\r\n                displayName: 'Mean',\r\n                value: 'mean',\r\n                type: 'value',\r\n              },\r\n              {\r\n                displayName: 'Max',\r\n                value: 'max',\r\n                type: 'value',\r\n              },\r\n              {\r\n                displayName: 'Area',\r\n                value: 'area',\r\n                type: 'value',\r\n              },\r\n              {\r\n                value: 'modalityUnit',\r\n                for: ['mean', 'max' /** 'stdDev **/],\r\n                type: 'unit',\r\n              },\r\n              {\r\n                value: 'areaUnit',\r\n                for: ['area'],\r\n                type: 'unit',\r\n              },\r\n              /**\r\n              {\r\n                displayName: 'Std Dev',\r\n                value: 'stdDev',\r\n                type: 'value',\r\n              },\r\n              */\r\n            ],\r\n            report: [\r\n              {\r\n                displayName: 'Mean',\r\n                value: 'mean',\r\n                type: 'value',\r\n              },\r\n              {\r\n                displayName: 'Max',\r\n                value: 'max',\r\n                type: 'value',\r\n              },\r\n              {\r\n                displayName: 'Area',\r\n                value: 'area',\r\n                type: 'value',\r\n              },\r\n              {\r\n                displayName: 'Unit',\r\n                value: 'unit',\r\n                type: 'value',\r\n              },\r\n            ],\r\n          },\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getCustomizationModule;\r\n","import React, { useEffect } from 'react';\r\nimport html2canvas from 'html2canvas';\r\nimport {\r\n  Enums,\r\n  getEnabledElement,\r\n  getOrCreateCanvas,\r\n  StackViewport,\r\n  BaseVolumeViewport,\r\n} from '@cornerstonejs/core';\r\nimport { ToolGroupManager } from '@cornerstonejs/tools';\r\nimport PropTypes from 'prop-types';\r\nimport { ViewportDownloadForm } from '@ohif/ui';\r\n\r\nimport { getEnabledElement as OHIFgetEnabledElement } from '../state';\r\n\r\nconst MINIMUM_SIZE = 100;\r\nconst DEFAULT_SIZE = 512;\r\nconst MAX_TEXTURE_SIZE = 10000;\r\nconst VIEWPORT_ID = 'cornerstone-viewport-download-form';\r\n\r\nconst CornerstoneViewportDownloadForm = ({\r\n  onClose,\r\n  activeViewportId: activeViewportIdProp,\r\n  cornerstoneViewportService,\r\n}) => {\r\n  const enabledElement = OHIFgetEnabledElement(activeViewportIdProp);\r\n  const activeViewportElement = enabledElement?.element;\r\n  const activeViewportEnabledElement = getEnabledElement(activeViewportElement);\r\n\r\n  const {\r\n    viewportId: activeViewportId,\r\n    renderingEngineId,\r\n    viewport: activeViewport,\r\n  } = activeViewportEnabledElement;\r\n\r\n  const toolGroup = ToolGroupManager.getToolGroupForViewport(activeViewportId, renderingEngineId);\r\n\r\n  const toolModeAndBindings = Object.keys(toolGroup.toolOptions).reduce((acc, toolName) => {\r\n    const tool = toolGroup.toolOptions[toolName];\r\n    const { mode, bindings } = tool;\r\n\r\n    return {\r\n      ...acc,\r\n      [toolName]: {\r\n        mode,\r\n        bindings,\r\n      },\r\n    };\r\n  }, {});\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      Object.keys(toolModeAndBindings).forEach(toolName => {\r\n        const { mode, bindings } = toolModeAndBindings[toolName];\r\n        toolGroup.setToolMode(toolName, mode, { bindings });\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  const enableViewport = viewportElement => {\r\n    if (viewportElement) {\r\n      const { renderingEngine, viewport } = getEnabledElement(activeViewportElement);\r\n\r\n      const viewportInput = {\r\n        viewportId: VIEWPORT_ID,\r\n        element: viewportElement,\r\n        type: viewport.type,\r\n        defaultOptions: {\r\n          background: viewport.defaultOptions.background,\r\n          orientation: viewport.defaultOptions.orientation,\r\n        },\r\n      };\r\n\r\n      renderingEngine.enableElement(viewportInput);\r\n    }\r\n  };\r\n\r\n  const disableViewport = viewportElement => {\r\n    if (viewportElement) {\r\n      const { renderingEngine } = getEnabledElement(viewportElement);\r\n      return new Promise(resolve => {\r\n        renderingEngine.disableElement(VIEWPORT_ID);\r\n      });\r\n    }\r\n  };\r\n\r\n  const updateViewportPreview = (downloadViewportElement, internalCanvas, fileType) =>\r\n    new Promise(resolve => {\r\n      const enabledElement = getEnabledElement(downloadViewportElement);\r\n\r\n      const { viewport: downloadViewport, renderingEngine } = enabledElement;\r\n\r\n      // Note: Since any trigger of dimensions will update the viewport,\r\n      // we need to resize the offScreenCanvas to accommodate for the new\r\n      // dimensions, this is due to the reason that we are using the GPU offScreenCanvas\r\n      // to render the viewport for the downloadViewport.\r\n      renderingEngine.resize();\r\n\r\n      // Trigger the render on the viewport to update the on screen\r\n      // downloadViewport.resetCamera();\r\n      downloadViewport.render();\r\n\r\n      downloadViewportElement.addEventListener(\r\n        Enums.Events.IMAGE_RENDERED,\r\n        function updateViewport(event) {\r\n          const enabledElement = getEnabledElement(event.target);\r\n          const { viewport } = enabledElement;\r\n          const { element } = viewport;\r\n\r\n          const downloadCanvas = getOrCreateCanvas(element);\r\n\r\n          const type = 'image/' + fileType;\r\n          const dataUrl = downloadCanvas.toDataURL(type, 1);\r\n\r\n          let newWidth = element.offsetHeight;\r\n          let newHeight = element.offsetWidth;\r\n\r\n          if (newWidth > DEFAULT_SIZE || newHeight > DEFAULT_SIZE) {\r\n            const multiplier = DEFAULT_SIZE / Math.max(newWidth, newHeight);\r\n            newHeight *= multiplier;\r\n            newWidth *= multiplier;\r\n          }\r\n\r\n          resolve({ dataUrl, width: newWidth, height: newHeight });\r\n\r\n          downloadViewportElement.removeEventListener(Enums.Events.IMAGE_RENDERED, updateViewport);\r\n\r\n          // for some reason we need a reset camera here, and I don't know why\r\n          downloadViewport.resetCamera();\r\n          const presentation = activeViewport.getViewPresentation();\r\n          if (downloadViewport.setView) {\r\n            downloadViewport.setView(activeViewport.getViewReference(), presentation);\r\n          }\r\n          downloadViewport.render();\r\n        }\r\n      );\r\n    });\r\n\r\n  const loadImage = (activeViewportElement, viewportElement, width, height) =>\r\n    new Promise(resolve => {\r\n      if (activeViewportElement && viewportElement) {\r\n        const activeViewportEnabledElement = getEnabledElement(activeViewportElement);\r\n\r\n        if (!activeViewportEnabledElement) {\r\n          return;\r\n        }\r\n\r\n        const { viewport } = activeViewportEnabledElement;\r\n\r\n        const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n        const downloadViewport = renderingEngine.getViewport(VIEWPORT_ID);\r\n\r\n        if (downloadViewport instanceof StackViewport) {\r\n          const imageId = viewport.getCurrentImageId();\r\n          const properties = viewport.getProperties();\r\n\r\n          downloadViewport.setStack([imageId]).then(() => {\r\n            try {\r\n              downloadViewport.setProperties(properties);\r\n              const newWidth = Math.min(width || image.width, MAX_TEXTURE_SIZE);\r\n              const newHeight = Math.min(height || image.height, MAX_TEXTURE_SIZE);\r\n\r\n              resolve({ width: newWidth, height: newHeight });\r\n            } catch (e) {\r\n              // Happens on clicking the cancel button\r\n              console.warn('Unable to set properties', e);\r\n            }\r\n          });\r\n        } else if (downloadViewport instanceof BaseVolumeViewport) {\r\n          const actors = viewport.getActors();\r\n          // downloadViewport.setActors(actors);\r\n          actors.forEach(actor => {\r\n            downloadViewport.addActor(actor);\r\n          });\r\n\r\n          downloadViewport.render();\r\n\r\n          const newWidth = Math.min(width || image.width, MAX_TEXTURE_SIZE);\r\n          const newHeight = Math.min(height || image.height, MAX_TEXTURE_SIZE);\r\n\r\n          resolve({ width: newWidth, height: newHeight });\r\n        }\r\n      }\r\n    });\r\n\r\n  const toggleAnnotations = (toggle, viewportElement, activeViewportElement) => {\r\n    const activeViewportEnabledElement = getEnabledElement(activeViewportElement);\r\n\r\n    const downloadViewportElement = getEnabledElement(viewportElement);\r\n\r\n    const { viewportId: activeViewportId, renderingEngineId } = activeViewportEnabledElement;\r\n    const { viewportId: downloadViewportId } = downloadViewportElement;\r\n\r\n    if (!activeViewportEnabledElement || !downloadViewportElement) {\r\n      return;\r\n    }\r\n\r\n    const toolGroup = ToolGroupManager.getToolGroupForViewport(activeViewportId, renderingEngineId);\r\n\r\n    // add the viewport to the toolGroup\r\n    toolGroup.addViewport(downloadViewportId, renderingEngineId);\r\n\r\n    Object.keys(toolGroup.getToolInstances()).forEach(toolName => {\r\n      // make all tools Enabled so that they can not be interacted with\r\n      // in the download viewport\r\n      if (toggle && toolName !== 'Crosshairs') {\r\n        try {\r\n          toolGroup.setToolEnabled(toolName);\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n      } else {\r\n        toolGroup.setToolDisabled(toolName);\r\n      }\r\n    });\r\n  };\r\n\r\n  const downloadBlob = (filename, fileType) => {\r\n    const file = `${filename}.${fileType}`;\r\n    const divForDownloadViewport = document.querySelector(\r\n      `div[data-viewport-uid=\"${VIEWPORT_ID}\"]`\r\n    );\r\n\r\n    html2canvas(divForDownloadViewport).then(canvas => {\r\n      const link = document.createElement('a');\r\n      link.download = file;\r\n      link.href = canvas.toDataURL(fileType, 1.0);\r\n      link.click();\r\n    });\r\n  };\r\n\r\n  return (\r\n    <ViewportDownloadForm\r\n      onClose={onClose}\r\n      minimumSize={MINIMUM_SIZE}\r\n      maximumSize={MAX_TEXTURE_SIZE}\r\n      defaultSize={DEFAULT_SIZE}\r\n      activeViewportElement={activeViewportElement}\r\n      enableViewport={enableViewport}\r\n      disableViewport={disableViewport}\r\n      updateViewportPreview={updateViewportPreview}\r\n      loadImage={loadImage}\r\n      toggleAnnotations={toggleAnnotations}\r\n      downloadBlob={downloadBlob}\r\n    />\r\n  );\r\n};\r\n\r\nCornerstoneViewportDownloadForm.propTypes = {\r\n  onClose: PropTypes.func,\r\n  activeViewportId: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default CornerstoneViewportDownloadForm;\r\n","import { DisplaySetService, ViewportGridService } from '@ohif/core';\r\n\r\nconst IMAGE_SLICE_SYNC_NAME = 'IMAGE_SLICE_SYNC';\r\n\r\nexport default function toggleImageSliceSync({\r\n  servicesManager,\r\n  viewports: providedViewports,\r\n  syncId,\r\n}: withAppTypes) {\r\n  const { syncGroupService, viewportGridService, displaySetService, cornerstoneViewportService } =\r\n    servicesManager.services;\r\n\r\n  syncId ||= IMAGE_SLICE_SYNC_NAME;\r\n\r\n  const viewports =\r\n    providedViewports || getReconstructableStackViewports(viewportGridService, displaySetService);\r\n\r\n  // Todo: right now we don't have a proper way to define specific\r\n  // viewports to add to synchronizers, and right now it is global or not\r\n  // after we do that, we should do fine grained control of the synchronizers\r\n  const someViewportHasSync = viewports.some(viewport => {\r\n    const syncStates = syncGroupService.getSynchronizersForViewport(\r\n      viewport.viewportOptions.viewportId\r\n    );\r\n\r\n    const imageSync = syncStates.find(syncState => syncState.id === syncId);\r\n\r\n    return !!imageSync;\r\n  });\r\n\r\n  if (someViewportHasSync) {\r\n    return disableSync(syncId, servicesManager);\r\n  }\r\n\r\n  // create synchronization group and add the viewports to it.\r\n  viewports.forEach(gridViewport => {\r\n    const { viewportId } = gridViewport.viewportOptions;\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    if (!viewport) {\r\n      return;\r\n    }\r\n    syncGroupService.addViewportToSyncGroup(viewportId, viewport.getRenderingEngine().id, {\r\n      type: 'imageSlice',\r\n      id: syncId,\r\n      source: true,\r\n      target: true,\r\n    });\r\n  });\r\n}\r\n\r\nfunction disableSync(syncName, servicesManager: AppTypes.ServicesManager) {\r\n  const { syncGroupService, viewportGridService, displaySetService, cornerstoneViewportService } =\r\n    servicesManager.services;\r\n  const viewports = getReconstructableStackViewports(viewportGridService, displaySetService);\r\n  viewports.forEach(gridViewport => {\r\n    const { viewportId } = gridViewport.viewportOptions;\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    if (!viewport) {\r\n      return;\r\n    }\r\n    syncGroupService.removeViewportFromSyncGroup(\r\n      viewport.id,\r\n      viewport.getRenderingEngine().id,\r\n      syncName\r\n    );\r\n  });\r\n}\r\n\r\n/**\r\n * Gets the consistent spacing stack viewport types, which are the ones which\r\n * can be navigated using the stack image sync right now.\r\n */\r\nfunction getReconstructableStackViewports(\r\n  viewportGridService: ViewportGridService,\r\n  displaySetService: DisplaySetService\r\n) {\r\n  let { viewports } = viewportGridService.getState();\r\n\r\n  viewports = [...viewports.values()];\r\n  // filter empty viewports\r\n  viewports = viewports.filter(\r\n    viewport => viewport.displaySetInstanceUIDs && viewport.displaySetInstanceUIDs.length\r\n  );\r\n\r\n  // filter reconstructable viewports\r\n  viewports = viewports.filter(viewport => {\r\n    const { displaySetInstanceUIDs } = viewport;\r\n\r\n    for (const displaySetInstanceUID of displaySetInstanceUIDs) {\r\n      const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n      // TODO - add a better test than isReconstructable\r\n      if (displaySet && displaySet.isReconstructable) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    }\r\n  });\r\n  return viewports;\r\n}\r\n","import { DisplaySetService, ViewportGridService } from '@ohif/core';\r\n\r\nconst VOI_SYNC_NAME = 'VOI_SYNC';\r\n\r\nconst getSyncId = modality => `${VOI_SYNC_NAME}_${modality}`;\r\n\r\nexport default function toggleVOISliceSync({\r\n  servicesManager,\r\n  viewports: providedViewports,\r\n  syncId,\r\n}: withAppTypes) {\r\n  const { syncGroupService, viewportGridService, displaySetService, cornerstoneViewportService } =\r\n    servicesManager.services;\r\n\r\n  const viewports =\r\n    providedViewports || groupViewportsByModality(viewportGridService, displaySetService);\r\n\r\n  // Todo: right now we don't have a proper way to define specific\r\n  // viewports to add to synchronizers, and right now it is global or not\r\n  // after we do that, we should do fine grained control of the synchronizers\r\n\r\n  // we can apply voi sync within each modality group\r\n  for (const [modality, modalityViewports] of Object.entries(viewports)) {\r\n    const syncIdToUse = syncId || getSyncId(modality);\r\n\r\n    const someViewportHasSync = modalityViewports.some(viewport => {\r\n      const syncStates = syncGroupService.getSynchronizersForViewport(\r\n        viewport.viewportOptions.viewportId\r\n      );\r\n\r\n      const imageSync = syncStates.find(syncState => syncState.id === syncIdToUse);\r\n\r\n      return !!imageSync;\r\n    });\r\n\r\n    if (someViewportHasSync) {\r\n      return disableSync(modalityViewports, syncIdToUse, servicesManager);\r\n    }\r\n\r\n    // create synchronization group and add the modalityViewports to it.\r\n    modalityViewports.forEach(gridViewport => {\r\n      const { viewportId } = gridViewport.viewportOptions;\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n      if (!viewport) {\r\n        return;\r\n      }\r\n      syncGroupService.addViewportToSyncGroup(viewportId, viewport.getRenderingEngine().id, {\r\n        type: 'voi',\r\n        id: syncIdToUse,\r\n        source: true,\r\n        target: true,\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nfunction disableSync(modalityViewports, syncId, servicesManager: AppTypes.ServicesManager) {\r\n  const { syncGroupService, cornerstoneViewportService } = servicesManager.services;\r\n\r\n  const viewports = modalityViewports;\r\n  viewports.forEach(gridViewport => {\r\n    const { viewportId } = gridViewport.viewportOptions;\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    if (!viewport) {\r\n      return;\r\n    }\r\n    syncGroupService.removeViewportFromSyncGroup(\r\n      viewport.id,\r\n      viewport.getRenderingEngine().id,\r\n      syncId\r\n    );\r\n  });\r\n}\r\n\r\nfunction groupViewportsByModality(\r\n  viewportGridService: ViewportGridService,\r\n  displaySetService: DisplaySetService\r\n) {\r\n  let { viewports } = viewportGridService.getState();\r\n\r\n  viewports = [...viewports.values()];\r\n\r\n  // group the viewports by modality\r\n  return viewports.reduce((acc, viewport) => {\r\n    const { displaySetInstanceUIDs } = viewport;\r\n    // Todo: add proper fusion support\r\n    const displaySetInstanceUID = displaySetInstanceUIDs[0];\r\n    const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n    const modality = displaySet.Modality;\r\n    if (!acc[modality]) {\r\n      acc[modality] = [];\r\n    }\r\n\r\n    acc[modality].push(viewport);\r\n\r\n    return acc;\r\n  }, {});\r\n}\r\n","import {\r\n  getEnabledElement,\r\n  StackViewport,\r\n  VolumeViewport,\r\n  utilities as csUtils,\r\n  Types as CoreTypes,\r\n  BaseVolumeViewport,\r\n} from '@cornerstonejs/core';\r\nimport {\r\n  ToolGroupManager,\r\n  Enums,\r\n  utilities as cstUtils,\r\n  ReferenceLinesTool,\r\n} from '@cornerstonejs/tools';\r\nimport { Types as OhifTypes } from '@ohif/core';\r\nimport { vec3, mat4 } from 'gl-matrix';\r\n\r\nimport CornerstoneViewportDownloadForm from './utils/CornerstoneViewportDownloadForm';\r\nimport { callLabelAutocompleteDialog, showLabelAnnotationPopup } from './utils/callInputDialog';\r\nimport toggleImageSliceSync from './utils/imageSliceSync/toggleImageSliceSync';\r\nimport { getFirstAnnotationSelected } from './utils/measurementServiceMappings/utils/selection';\r\nimport getActiveViewportEnabledElement from './utils/getActiveViewportEnabledElement';\r\nimport toggleVOISliceSync from './utils/toggleVOISliceSync';\r\n\r\nconst toggleSyncFunctions = {\r\n  imageSlice: toggleImageSliceSync,\r\n  voi: toggleVOISliceSync,\r\n};\r\n\r\nfunction commandsModule({\r\n  servicesManager,\r\n  commandsManager,\r\n}: OhifTypes.Extensions.ExtensionParams): OhifTypes.Extensions.CommandsModule {\r\n  const {\r\n    viewportGridService,\r\n    toolGroupService,\r\n    cineService,\r\n    uiDialogService,\r\n    cornerstoneViewportService,\r\n    uiNotificationService,\r\n    measurementService,\r\n    customizationService,\r\n    colorbarService,\r\n    hangingProtocolService,\r\n    syncGroupService,\r\n    displaySetService,\r\n    panoramicService,\r\n  } = servicesManager.services;\r\n\r\n  const { measurementServiceSource } = this;\r\n\r\n  function _getActiveViewportEnabledElement() {\r\n    return getActiveViewportEnabledElement(viewportGridService);\r\n  }\r\n\r\n  function _getActiveViewportToolGroupId() {\r\n    const viewport = _getActiveViewportEnabledElement();\r\n    return toolGroupService.getToolGroupForViewport(viewport.id);\r\n  }\r\n\r\n  const actions = {\r\n    /**\r\n     * Generates the selector props for the context menu, specific to\r\n     * the cornerstone viewport, and then runs the context menu.\r\n     */\r\n    showCornerstoneContextMenu: options => {\r\n      const element = _getActiveViewportEnabledElement()?.viewport?.element;\r\n\r\n      const optionsToUse = { ...options, element };\r\n      const { useSelectedAnnotation, nearbyToolData, event } = optionsToUse;\r\n\r\n      // This code is used to invoke the context menu via keyboard shortcuts\r\n      if (useSelectedAnnotation && !nearbyToolData) {\r\n        const firstAnnotationSelected = getFirstAnnotationSelected(element);\r\n        // filter by allowed selected tools from config property (if there is any)\r\n        const isToolAllowed =\r\n          !optionsToUse.allowedSelectedTools ||\r\n          optionsToUse.allowedSelectedTools.includes(firstAnnotationSelected?.metadata?.toolName);\r\n        if (isToolAllowed) {\r\n          optionsToUse.nearbyToolData = firstAnnotationSelected;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      optionsToUse.defaultPointsPosition = [];\r\n      // if (optionsToUse.nearbyToolData) {\r\n      //   optionsToUse.defaultPointsPosition = commandsManager.runCommand(\r\n      //     'getToolDataActiveCanvasPoints',\r\n      //     { toolData: optionsToUse.nearbyToolData }\r\n      //   );\r\n      // }\r\n\r\n      // TODO - make the selectorProps richer by including the study metadata and display set.\r\n      optionsToUse.selectorProps = {\r\n        toolName: optionsToUse.nearbyToolData?.metadata?.toolName,\r\n        value: optionsToUse.nearbyToolData,\r\n        uid: optionsToUse.nearbyToolData?.annotationUID,\r\n        nearbyToolData: optionsToUse.nearbyToolData,\r\n        event,\r\n        ...optionsToUse.selectorProps,\r\n      };\r\n\r\n      commandsManager.run(options, optionsToUse);\r\n    },\r\n\r\n    getNearbyToolData({ nearbyToolData, element, canvasCoordinates }) {\r\n      return nearbyToolData ?? cstUtils.getAnnotationNearPoint(element, canvasCoordinates);\r\n    },\r\n    getNearbyAnnotation({ element, canvasCoordinates }) {\r\n      const nearbyToolData = actions.getNearbyToolData({\r\n        nearbyToolData: null,\r\n        element,\r\n        canvasCoordinates,\r\n      });\r\n\r\n      const isAnnotation = toolName => {\r\n        const enabledElement = getEnabledElement(element);\r\n\r\n        if (!enabledElement) {\r\n          return;\r\n        }\r\n\r\n        const { renderingEngineId, viewportId } = enabledElement;\r\n        const toolGroup = ToolGroupManager.getToolGroupForViewport(viewportId, renderingEngineId);\r\n\r\n        const toolInstance = toolGroup.getToolInstance(toolName);\r\n\r\n        return toolInstance?.constructor?.isAnnotation ?? true;\r\n      };\r\n\r\n      return nearbyToolData?.metadata?.toolName && isAnnotation(nearbyToolData.metadata.toolName)\r\n        ? nearbyToolData\r\n        : null;\r\n    },\r\n    /** Delete the given measurement */\r\n    deleteMeasurement: ({ uid }) => {\r\n      if (uid) {\r\n        measurementServiceSource.remove(uid);\r\n      }\r\n    },\r\n    /**\r\n     * Show the measurement labelling input dialog and update the label\r\n     * on the measurement with a response if not cancelled.\r\n     */\r\n    setMeasurementLabel: ({ uid }) => {\r\n      const labelConfig = customizationService.get('measurementLabels');\r\n      const measurement = measurementService.getMeasurement(uid);\r\n      showLabelAnnotationPopup(measurement, uiDialogService, labelConfig).then(\r\n        (val: Map<any, any>) => {\r\n          measurementService.update(\r\n            uid,\r\n            {\r\n              ...val,\r\n            },\r\n            true\r\n          );\r\n        }\r\n      );\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param props - containing the updates to apply\r\n     * @param props.measurementKey - chooses the measurement key to apply the\r\n     *        code to.  This will typically be finding or site to apply a\r\n     *        finding code or a findingSites code.\r\n     * @param props.code - A coding scheme value from DICOM, including:\r\n     *       * CodeValue - the language independent code, for example '1234'\r\n     *       * CodingSchemeDesignator - the issue of the code value\r\n     *       * CodeMeaning - the text value shown to the user\r\n     *       * ref - a string reference in the form `<designator>:<codeValue>`\r\n     *       * Other fields\r\n     *     Note it is a valid option to remove the finding or site values by\r\n     *     supplying null for the code.\r\n     * @param props.uid - the measurement UID to find it with\r\n     * @param props.label - the text value for the code.  Has NOTHING to do with\r\n     *        the measurement label, which can be set with textLabel\r\n     * @param props.textLabel is the measurement label to apply.  Set to null to\r\n     *            delete.\r\n     *\r\n     * If the measurementKey is `site`, then the code will also be added/replace\r\n     * the 0 element of findingSites.  This behaviour is expected to be enhanced\r\n     * in the future with ability to set other site information.\r\n     */\r\n    updateMeasurement: props => {\r\n      const { code, uid, textLabel, label } = props;\r\n      const measurement = measurementService.getMeasurement(uid);\r\n      const updatedMeasurement = {\r\n        ...measurement,\r\n      };\r\n      // Call it textLabel as the label value\r\n      // TODO - remove the label setting when direct rendering of findingSites is enabled\r\n      if (textLabel !== undefined) {\r\n        updatedMeasurement.label = textLabel;\r\n      }\r\n      if (code !== undefined) {\r\n        const measurementKey = code.type || 'finding';\r\n\r\n        if (code.ref && !code.CodeValue) {\r\n          const split = code.ref.indexOf(':');\r\n          code.CodeValue = code.ref.substring(split + 1);\r\n          code.CodeMeaning = code.text || label;\r\n          code.CodingSchemeDesignator = code.ref.substring(0, split);\r\n        }\r\n        updatedMeasurement[measurementKey] = code;\r\n        // TODO - remove this line once the measurements table customizations are in\r\n        if (measurementKey !== 'finding') {\r\n          if (updatedMeasurement.findingSites) {\r\n            updatedMeasurement.findingSites = updatedMeasurement.findingSites.filter(\r\n              it => it.type !== measurementKey\r\n            );\r\n            updatedMeasurement.findingSites.push(code);\r\n          } else {\r\n            updatedMeasurement.findingSites = [code];\r\n          }\r\n        }\r\n      }\r\n      measurementService.update(updatedMeasurement.uid, updatedMeasurement, true);\r\n    },\r\n\r\n    // Retrieve value commands\r\n    getActiveViewportEnabledElement: _getActiveViewportEnabledElement,\r\n\r\n    setViewportActive: ({ viewportId }) => {\r\n      const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n      if (!viewportInfo) {\r\n        console.warn('No viewport found for viewportId:', viewportId);\r\n        return;\r\n      }\r\n\r\n      viewportGridService.setActiveViewportId(viewportId);\r\n    },\r\n    arrowTextCallback: ({ callback, data, uid }) => {\r\n      const labelConfig = customizationService.get('measurementLabels');\r\n      callLabelAutocompleteDialog(uiDialogService, callback, {}, labelConfig);\r\n    },\r\n    toggleCine: () => {\r\n      const { viewports } = viewportGridService.getState();\r\n      const { isCineEnabled } = cineService.getState();\r\n      cineService.setIsCineEnabled(!isCineEnabled);\r\n      viewports.forEach((_, index) => cineService.setCine({ id: index, isPlaying: false }));\r\n    },\r\n\r\n    setViewportWindowLevel({ viewportId, window, level }) {\r\n      // convert to numbers\r\n      const windowWidthNum = Number(window);\r\n      const windowCenterNum = Number(level);\r\n\r\n      // get actor from the viewport\r\n      const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n      const viewport = renderingEngine.getViewport(viewportId);\r\n\r\n      const { lower, upper } = csUtils.windowLevel.toLowHighRange(windowWidthNum, windowCenterNum);\r\n\r\n      viewport.setProperties({\r\n        voiRange: {\r\n          upper,\r\n          lower,\r\n        },\r\n      });\r\n      viewport.render();\r\n    },\r\n\r\n    toggleViewportColorbar: ({ viewportId, displaySetInstanceUIDs, options = {} }) => {\r\n      const hasColorbar = colorbarService.hasColorbar(viewportId);\r\n      if (hasColorbar) {\r\n        colorbarService.removeColorbar(viewportId);\r\n        return;\r\n      }\r\n      colorbarService.addColorbar(viewportId, displaySetInstanceUIDs, options);\r\n    },\r\n\r\n    setWindowLevel(props) {\r\n      const { toolGroupId } = props;\r\n      const { viewportId } = _getActiveViewportEnabledElement();\r\n      const viewportToolGroupId = toolGroupService.getToolGroupForViewport(viewportId);\r\n\r\n      if (toolGroupId && toolGroupId !== viewportToolGroupId) {\r\n        return;\r\n      }\r\n\r\n      actions.setViewportWindowLevel({ ...props, viewportId });\r\n    },\r\n    setToolEnabled: ({ toolName, toggle, toolGroupId }) => {\r\n      const { viewports } = viewportGridService.getState();\r\n\r\n      if (!viewports.size) {\r\n        return;\r\n      }\r\n\r\n      const toolGroup = toolGroupService.getToolGroup(toolGroupId ?? null);\r\n\r\n      if (!toolGroup || !toolGroup.hasTool(toolName)) {\r\n        return;\r\n      }\r\n\r\n      const toolIsEnabled = toolGroup.getToolOptions(toolName).mode === Enums.ToolModes.Enabled;\r\n\r\n      // Toggle the tool's state only if the toggle is true\r\n      if (toggle) {\r\n        toolIsEnabled ? toolGroup.setToolDisabled(toolName) : toolGroup.setToolEnabled(toolName);\r\n      } else {\r\n        toolGroup.setToolEnabled(toolName);\r\n      }\r\n\r\n      const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n      renderingEngine.render();\r\n    },\r\n    toggleEnabledDisabledToolbar({ value, itemId, toolGroupId }) {\r\n      const toolName = itemId || value;\r\n      toolGroupId = toolGroupId ?? _getActiveViewportToolGroupId();\r\n\r\n      const toolGroup = toolGroupService.getToolGroup(toolGroupId);\r\n      if (!toolGroup || !toolGroup.hasTool(toolName)) {\r\n        return;\r\n      }\r\n\r\n      const toolIsEnabled = toolGroup.getToolOptions(toolName).mode === Enums.ToolModes.Enabled;\r\n\r\n      toolIsEnabled ? toolGroup.setToolDisabled(toolName) : toolGroup.setToolEnabled(toolName);\r\n    },\r\n    toggleActiveDisabledToolbar({ value, itemId, toolGroupId }) {\r\n      const toolName = itemId || value;\r\n      toolGroupId = toolGroupId ?? _getActiveViewportToolGroupId();\r\n      const toolGroup = toolGroupService.getToolGroup(toolGroupId);\r\n      if (!toolGroup || !toolGroup.hasTool(toolName)) {\r\n        return;\r\n      }\r\n\r\n      const toolIsActive = [\r\n        Enums.ToolModes.Active,\r\n        Enums.ToolModes.Enabled,\r\n        Enums.ToolModes.Passive,\r\n      ].includes(toolGroup.getToolOptions(toolName).mode);\r\n\r\n      toolIsActive\r\n        ? toolGroup.setToolDisabled(toolName)\r\n        : actions.setToolActive({ toolName, toolGroupId });\r\n\r\n      // we should set the previously active tool to active after we set the\r\n      // current tool disabled\r\n      if (toolIsActive) {\r\n        const prevToolName = toolGroup.getPrevActivePrimaryToolName();\r\n        if (prevToolName !== toolName) {\r\n          actions.setToolActive({ toolName: prevToolName, toolGroupId });\r\n        }\r\n      }\r\n    },\r\n    setToolActiveToolbar: ({ value, itemId, toolName, toolGroupIds = [] }) => {\r\n      // Sometimes it is passed as value (tools with options), sometimes as itemId (toolbar buttons)\r\n      toolName = toolName || itemId || value;\r\n\r\n      toolGroupIds = toolGroupIds.length ? toolGroupIds : toolGroupService.getToolGroupIds();\r\n\r\n      toolGroupIds.forEach(toolGroupId => {\r\n        actions.setToolActive({ toolName, toolGroupId });\r\n      });\r\n    },\r\n    setToolActive: ({ toolName, toolGroupId = null }) => {\r\n      const { viewports } = viewportGridService.getState();\r\n\r\n      if (!viewports.size) {\r\n        return;\r\n      }\r\n\r\n      const toolGroup = toolGroupService.getToolGroup(toolGroupId);\r\n\r\n      if (!toolGroup) {\r\n        return;\r\n      }\r\n\r\n      if (!toolGroup.hasTool(toolName)) {\r\n        return;\r\n      }\r\n\r\n      const activeToolName = toolGroup.getActivePrimaryMouseButtonTool();\r\n\r\n      if (activeToolName) {\r\n        const activeToolOptions = toolGroup.getToolConfiguration(activeToolName);\r\n        activeToolOptions?.disableOnPassive\r\n          ? toolGroup.setToolDisabled(activeToolName)\r\n          : toolGroup.setToolPassive(activeToolName);\r\n      }\r\n\r\n      // Set the new toolName to be active\r\n      toolGroup.setToolActive(toolName, {\r\n        bindings: [\r\n          {\r\n            mouseButton: Enums.MouseBindings.Primary,\r\n          },\r\n        ],\r\n      });\r\n    },\r\n    showDownloadViewportModal: () => {\r\n      const { activeViewportId } = viewportGridService.getState();\r\n\r\n      if (!cornerstoneViewportService.getCornerstoneViewport(activeViewportId)) {\r\n        // Cannot download a non-cornerstone viewport (image).\r\n        uiNotificationService.show({\r\n          title: 'Download Image',\r\n          message: 'Image cannot be downloaded',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n\r\n      const { uiModalService } = servicesManager.services;\r\n\r\n      if (uiModalService) {\r\n        uiModalService.show({\r\n          content: CornerstoneViewportDownloadForm,\r\n          title: 'Download High Quality Image',\r\n          contentProps: {\r\n            activeViewportId,\r\n            onClose: uiModalService.hide,\r\n            cornerstoneViewportService,\r\n          },\r\n          containerDimensions: 'w-[70%] max-w-[900px]',\r\n        });\r\n      }\r\n    },\r\n    rotateViewport: ({ rotation }) => {\r\n      const enabledElement = _getActiveViewportEnabledElement();\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { viewport } = enabledElement;\r\n\r\n      if (viewport instanceof BaseVolumeViewport) {\r\n        const camera = viewport.getCamera();\r\n        const rotAngle = (rotation * Math.PI) / 180;\r\n        const rotMat = mat4.identity(new Float32Array(16));\r\n        mat4.rotate(rotMat, rotMat, rotAngle, camera.viewPlaneNormal);\r\n        const rotatedViewUp = vec3.transformMat4(vec3.create(), camera.viewUp, rotMat);\r\n        viewport.setCamera({ viewUp: rotatedViewUp as CoreTypes.Point3 });\r\n        viewport.render();\r\n      } else if (viewport.getRotation !== undefined) {\r\n        const currentRotation = viewport.getRotation();\r\n        const newRotation = (currentRotation + rotation) % 360;\r\n        viewport.setProperties({ rotation: newRotation });\r\n        viewport.render();\r\n      }\r\n    },\r\n    flipViewportHorizontal: () => {\r\n      const enabledElement = _getActiveViewportEnabledElement();\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { viewport } = enabledElement;\r\n\r\n      const { flipHorizontal } = viewport.getCamera();\r\n      viewport.setCamera({ flipHorizontal: !flipHorizontal });\r\n      viewport.render();\r\n    },\r\n    flipViewportVertical: () => {\r\n      const enabledElement = _getActiveViewportEnabledElement();\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { viewport } = enabledElement;\r\n\r\n      const { flipVertical } = viewport.getCamera();\r\n      viewport.setCamera({ flipVertical: !flipVertical });\r\n      viewport.render();\r\n    },\r\n    invertViewport: ({ element }) => {\r\n      let enabledElement;\r\n\r\n      if (element === undefined) {\r\n        enabledElement = _getActiveViewportEnabledElement();\r\n      } else {\r\n        enabledElement = element;\r\n      }\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { viewport } = enabledElement;\r\n\r\n      const { invert } = viewport.getProperties();\r\n      viewport.setProperties({ invert: !invert });\r\n      viewport.render();\r\n    },\r\n    resetViewport: () => {\r\n      const enabledElement = _getActiveViewportEnabledElement();\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { viewport } = enabledElement;\r\n\r\n      viewport.resetProperties?.();\r\n      viewport.resetCamera();\r\n\r\n      viewport.render();\r\n    },\r\n    scaleViewport: ({ direction }) => {\r\n      const enabledElement = _getActiveViewportEnabledElement();\r\n      const scaleFactor = direction > 0 ? 0.9 : 1.1;\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n      const { viewport } = enabledElement;\r\n\r\n      if (viewport instanceof StackViewport) {\r\n        if (direction) {\r\n          const { parallelScale } = viewport.getCamera();\r\n          viewport.setCamera({ parallelScale: parallelScale * scaleFactor });\r\n          viewport.render();\r\n        } else {\r\n          viewport.resetCamera();\r\n          viewport.render();\r\n        }\r\n      }\r\n    },\r\n\r\n    /** Jumps the active viewport or the specified one to the given slice index */\r\n    jumpToImage: ({ imageIndex, viewport: gridViewport }): void => {\r\n      // Get current active viewport (return if none active)\r\n      let viewport;\r\n      if (!gridViewport) {\r\n        const enabledElement = _getActiveViewportEnabledElement();\r\n        if (!enabledElement) {\r\n          return;\r\n        }\r\n        viewport = enabledElement.viewport;\r\n      } else {\r\n        viewport = cornerstoneViewportService.getCornerstoneViewport(gridViewport.id);\r\n      }\r\n\r\n      // Get number of slices\r\n      // -> Copied from cornerstone3D jumpToSlice\\_getImageSliceData()\r\n      let numberOfSlices = 0;\r\n\r\n      if (viewport instanceof StackViewport) {\r\n        numberOfSlices = viewport.getImageIds().length;\r\n      } else if (viewport instanceof VolumeViewport) {\r\n        numberOfSlices = csUtils.getImageSliceDataForVolumeViewport(viewport).numberOfSlices;\r\n      } else {\r\n        throw new Error('Unsupported viewport type');\r\n      }\r\n\r\n      const jumpIndex = imageIndex < 0 ? numberOfSlices + imageIndex : imageIndex;\r\n      if (jumpIndex >= numberOfSlices || jumpIndex < 0) {\r\n        throw new Error(`Can't jump to ${imageIndex}`);\r\n      }\r\n\r\n      // Set slice to last slice\r\n      const options = { imageIndex: jumpIndex };\r\n      cstUtils.jumpToSlice(viewport.element, options);\r\n    },\r\n    scroll: ({ direction }) => {\r\n      const enabledElement = _getActiveViewportEnabledElement();\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { viewport } = enabledElement;\r\n      const options = { delta: direction };\r\n\r\n      cstUtils.scroll(viewport, options);\r\n    },\r\n    setAllViewportsColorMap: ({ window, level, toolGroupId }) => {\r\n      const { viewportId } = _getActiveViewportEnabledElement();\r\n      const viewportToolGroupId = toolGroupService.getToolGroupForViewport(\r\n          viewportId\r\n      );\r\n\r\n      if (toolGroupId && toolGroupId !== viewportToolGroupId) {\r\n        return;\r\n      }\r\n\r\n      // get actor from the viewport\r\n      const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n      const viewport = renderingEngine.getViewport(viewportId);\r\n\r\n      viewport.setProperties({\r\n        colormap: 'hot_iron'\r\n      });\r\n      viewport.render();\r\n    },\r\n    setViewportColormap: ({\r\n      viewportId,\r\n      displaySetInstanceUID,\r\n      colormap,\r\n      opacity = 1,\r\n      immediate = false,\r\n    }) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n      const actorEntries = viewport.getActors();\r\n      let hpOpacity;\r\n      // Retrieve active protocol's viewport match details\r\n      const { viewportMatchDetails } = hangingProtocolService.getActiveProtocol();\r\n      // Get display set options for the specified viewport ID\r\n      const displaySetsInfo = viewportMatchDetails.get(viewportId)?.displaySetsInfo;\r\n\r\n      if (displaySetsInfo) {\r\n        // Find the display set that matches the given UID\r\n        const matchingDisplaySet = displaySetsInfo.find(\r\n          displaySet => displaySet.displaySetInstanceUID === displaySetInstanceUID\r\n        );\r\n        // If a matching display set is found, update the opacity with its value\r\n        hpOpacity = matchingDisplaySet?.displaySetOptions?.options?.colormap?.opacity;\r\n      }\r\n\r\n      // HP takes priority over the default opacity\r\n      colormap = { ...colormap, opacity: hpOpacity || opacity };\r\n\r\n      const setViewportProperties = (viewport, uid) => {\r\n        const actorEntry = actorEntries.find(entry => entry.uid.includes(uid));\r\n        const { actor: volumeActor, uid: volumeId } = actorEntry;\r\n        viewport.setProperties({ colormap, volumeActor }, volumeId);\r\n      };\r\n\r\n      if (viewport instanceof StackViewport) {\r\n        setViewportProperties(viewport, viewportId);\r\n      }\r\n\r\n      if (viewport instanceof VolumeViewport) {\r\n        if (!displaySetInstanceUID) {\r\n          const { viewports } = viewportGridService.getState();\r\n          displaySetInstanceUID = viewports.get(viewportId)?.displaySetInstanceUIDs[0];\r\n        }\r\n        setViewportProperties(viewport, displaySetInstanceUID);\r\n      }\r\n\r\n      if (immediate) {\r\n        viewport.render();\r\n      }\r\n    },\r\n    changeActiveViewport: ({ direction = 1 }) => {\r\n      const { activeViewportId, viewports } = viewportGridService.getState();\r\n      const viewportIds = Array.from(viewports.keys());\r\n      const currentIndex = viewportIds.indexOf(activeViewportId);\r\n      const nextViewportIndex =\r\n        (currentIndex + direction + viewportIds.length) % viewportIds.length;\r\n      viewportGridService.setActiveViewportId(viewportIds[nextViewportIndex] as string);\r\n    },\r\n    /**\r\n     * If the syncId is given and a synchronizer with that ID already exists, it will\r\n     * toggle it on/off for the provided viewports. If not, it will attempt to create\r\n     * a new synchronizer using the given syncId and type for the specified viewports.\r\n     * If no viewports are provided, you may notice some default behavior.\r\n     * - 'voi' type, we will aim to synchronize all viewports with the same modality\r\n     * -'imageSlice' type, we will aim to synchronize all viewports with the same orientation.\r\n     *\r\n     * @param options\r\n     * @param options.viewports - The viewports to synchronize\r\n     * @param options.syncId - The synchronization group ID\r\n     * @param options.type - The type of synchronization to perform\r\n     */\r\n    toggleSynchronizer: ({ type, viewports, syncId }) => {\r\n      const synchronizer = syncGroupService.getSynchronizer(syncId);\r\n\r\n      if (synchronizer) {\r\n        synchronizer.isDisabled() ? synchronizer.setEnabled(true) : synchronizer.setEnabled(false);\r\n        return;\r\n      }\r\n\r\n      const fn = toggleSyncFunctions[type];\r\n\r\n      if (fn) {\r\n        fn({\r\n          servicesManager,\r\n          viewports,\r\n          syncId,\r\n        });\r\n      }\r\n    },\r\n    setSourceViewportForReferenceLinesTool: ({ viewportId }) => {\r\n      if (!viewportId) {\r\n        const { activeViewportId } = viewportGridService.getState();\r\n        viewportId = activeViewportId ?? 'default';\r\n      }\r\n\r\n      const toolGroup = toolGroupService.getToolGroupForViewport(viewportId);\r\n\r\n      toolGroup?.setToolConfiguration(\r\n        ReferenceLinesTool.toolName,\r\n        {\r\n          sourceViewportId: viewportId,\r\n        },\r\n        true // overwrite\r\n      );\r\n\r\n      const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n      renderingEngine.render();\r\n    },\r\n    storePresentation: ({ viewportId }) => {\r\n      cornerstoneViewportService.storePresentation({ viewportId });\r\n    },\r\n    updateVolumeData: ({ volume }) => {\r\n      // update vtkOpenGLTexture and imageData of computed volume\r\n      const { imageData, vtkOpenGLTexture } = volume;\r\n      const numSlices = imageData.getDimensions()[2];\r\n      const slicesToUpdate = [...Array(numSlices).keys()];\r\n      slicesToUpdate.forEach(i => {\r\n        vtkOpenGLTexture.setUpdatedFrame(i);\r\n      });\r\n      imageData.modified();\r\n    },\r\n\r\n    attachProtocolViewportDataListener: ({ protocol, stageIndex }) => {\r\n      const EVENT = cornerstoneViewportService.EVENTS.VIEWPORT_DATA_CHANGED;\r\n      const command = protocol.callbacks.onViewportDataInitialized;\r\n      const numPanes = protocol.stages?.[stageIndex]?.viewports.length ?? 1;\r\n      let numPanesWithData = 0;\r\n      const { unsubscribe } = cornerstoneViewportService.subscribe(EVENT, evt => {\r\n        numPanesWithData++;\r\n\r\n        if (numPanesWithData === numPanes) {\r\n          commandsManager.run(...command);\r\n\r\n          // Unsubscribe from the event\r\n          unsubscribe(EVENT);\r\n        }\r\n      });\r\n    },\r\n\r\n    setViewportPreset: ({ viewportId, preset }) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n      if (!viewport) {\r\n        return;\r\n      }\r\n      viewport.setProperties({\r\n        preset,\r\n      });\r\n      viewport.render();\r\n    },\r\n\r\n    /**\r\n     * Sets the volume quality for a given viewport.\r\n     * @param {string} viewportId - The ID of the viewport to set the volume quality.\r\n     * @param {number} volumeQuality - The desired quality level of the volume rendering.\r\n     */\r\n\r\n    setVolumeRenderingQulaity: ({ viewportId, volumeQuality }) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n      const { actor } = viewport.getActors()[0];\r\n      const mapper = actor.getMapper();\r\n      const image = mapper.getInputData();\r\n      const dims = image.getDimensions();\r\n      const spacing = image.getSpacing();\r\n      const spatialDiagonal = vec3.length(\r\n        vec3.fromValues(dims[0] * spacing[0], dims[1] * spacing[1], dims[2] * spacing[2])\r\n      );\r\n\r\n      let sampleDistance = spacing.reduce((a, b) => a + b) / 3.0;\r\n      sampleDistance /= volumeQuality > 1 ? 0.5 * volumeQuality ** 2 : 1.0;\r\n      const samplesPerRay = spatialDiagonal / sampleDistance + 1;\r\n      mapper.setMaximumSamplesPerRay(samplesPerRay);\r\n      mapper.setSampleDistance(sampleDistance);\r\n      viewport.render();\r\n    },\r\n\r\n    /**\r\n     * Shifts opacity points for a given viewport id.\r\n     * @param {string} viewportId - The ID of the viewport to set the mapping range.\r\n     * @param {number} shift - The shift value to shift the points by.\r\n     */\r\n    shiftVolumeOpacityPoints: ({ viewportId, shift }) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n      const { actor } = viewport.getActors()[0];\r\n      const ofun = actor.getProperty().getScalarOpacity(0);\r\n\r\n      const opacityPointValues = []; // Array to hold values\r\n      // Gather Existing Values\r\n      const size = ofun.getSize();\r\n      for (let pointIdx = 0; pointIdx < size; pointIdx++) {\r\n        const opacityPointValue = [0, 0, 0, 0];\r\n        ofun.getNodeValue(pointIdx, opacityPointValue);\r\n        // opacityPointValue now holds [xLocation, opacity, midpoint, sharpness]\r\n        opacityPointValues.push(opacityPointValue);\r\n      }\r\n      // Add offset\r\n      opacityPointValues.forEach(opacityPointValue => {\r\n        opacityPointValue[0] += shift; // Change the location value\r\n      });\r\n      // Set new values\r\n      ofun.removeAllPoints();\r\n      opacityPointValues.forEach(opacityPointValue => {\r\n        ofun.addPoint(...opacityPointValue);\r\n      });\r\n      viewport.render();\r\n    },\r\n\r\n    /**\r\n     * Sets the volume lighting settings for a given viewport.\r\n     * @param {string} viewportId - The ID of the viewport to set the lighting settings.\r\n     * @param {Object} options - The lighting settings to be set.\r\n     * @param {boolean} options.shade - The shade setting for the lighting.\r\n     * @param {number} options.ambient - The ambient setting for the lighting.\r\n     * @param {number} options.diffuse - The diffuse setting for the lighting.\r\n     * @param {number} options.specular - The specular setting for the lighting.\r\n     **/\r\n\r\n    setVolumeLighting: ({ viewportId, options }) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n      const { actor } = viewport.getActors()[0];\r\n      const property = actor.getProperty();\r\n\r\n      if (options.shade !== undefined) {\r\n        property.setShade(options.shade);\r\n      }\r\n\r\n      if (options.ambient !== undefined) {\r\n        property.setAmbient(options.ambient);\r\n      }\r\n\r\n      if (options.diffuse !== undefined) {\r\n        property.setDiffuse(options.diffuse);\r\n      }\r\n\r\n      if (options.specular !== undefined) {\r\n        property.setSpecular(options.specular);\r\n      }\r\n\r\n      viewport.render();\r\n    },\r\n    resetCrosshairs: ({ viewportId }) => {\r\n      const crosshairInstances = [];\r\n\r\n      const getCrosshairInstances = toolGroupId => {\r\n        const toolGroup = toolGroupService.getToolGroup(toolGroupId);\r\n        crosshairInstances.push(toolGroup.getToolInstance('Crosshairs'));\r\n      };\r\n\r\n      if (!viewportId) {\r\n        const toolGroupIds = toolGroupService.getToolGroupIds();\r\n        toolGroupIds.forEach(getCrosshairInstances);\r\n      } else {\r\n        const toolGroup = toolGroupService.getToolGroupForViewport(viewportId);\r\n        getCrosshairInstances(toolGroup.id);\r\n      }\r\n\r\n      crosshairInstances.forEach(ins => {\r\n        ins?.resetCrosshairs();\r\n      });\r\n    },\r\n    mprView: () => {\r\n      if (hangingProtocolService.getActiveProtocol().protocol.id !== 'mprAnd3DVolumeViewport') {\r\n        commandsManager.runCommand('toggleHangingProtocol', { protocolId: 'mprAnd3DVolumeViewport', stageIndex: 0 });\r\n      }\r\n    },\r\n    panoramicView: () => {\r\n      if (!panoramicService.isEnabled()) {\r\n        panoramicService.activatePanoramic();\r\n      }\r\n      if (hangingProtocolService.getActiveProtocol().protocol.id !== 'panoramicViewport') {\r\n        commandsManager.runCommand('toggleHangingProtocol', { protocolId: 'panoramicViewport', stageIndex: 0 });\r\n      }\r\n    }\r\n  };\r\n\r\n  const definitions = {\r\n    // The command here is to show the viewer context menu, as being the\r\n    // context menu\r\n    showCornerstoneContextMenu: {\r\n      commandFn: actions.showCornerstoneContextMenu,\r\n      options: {\r\n        menuCustomizationId: 'measurementsContextMenu',\r\n        useSelectedAnnotation: true,\r\n        commands: [\r\n          {\r\n            commandName: 'showContextMenu',\r\n          },\r\n        ],\r\n      },\r\n    },\r\n\r\n    getNearbyToolData: {\r\n      commandFn: actions.getNearbyToolData,\r\n    },\r\n    getNearbyAnnotation: {\r\n      commandFn: actions.getNearbyAnnotation,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    toggleViewportColorbar: {\r\n      commandFn: actions.toggleViewportColorbar,\r\n    },\r\n    deleteMeasurement: {\r\n      commandFn: actions.deleteMeasurement,\r\n    },\r\n    setMeasurementLabel: {\r\n      commandFn: actions.setMeasurementLabel,\r\n    },\r\n    updateMeasurement: {\r\n      commandFn: actions.updateMeasurement,\r\n    },\r\n    setViewportWindowLevel: {\r\n      commandFn: actions.setViewportWindowLevel,\r\n    },\r\n    setWindowLevel: {\r\n      commandFn: actions.setWindowLevel,\r\n    },\r\n    setToolActive: {\r\n      commandFn: actions.setToolActive,\r\n    },\r\n    setToolActiveToolbar: {\r\n      commandFn: actions.setToolActiveToolbar,\r\n    },\r\n    setToolEnabled: {\r\n      commandFn: actions.setToolEnabled,\r\n    },\r\n    rotateViewportCW: {\r\n      commandFn: actions.rotateViewport,\r\n      options: { rotation: 90 },\r\n    },\r\n    rotateViewportCCW: {\r\n      commandFn: actions.rotateViewport,\r\n      options: { rotation: -90 },\r\n    },\r\n    incrementActiveViewport: {\r\n      commandFn: actions.changeActiveViewport,\r\n    },\r\n    decrementActiveViewport: {\r\n      commandFn: actions.changeActiveViewport,\r\n      options: { direction: -1 },\r\n    },\r\n    flipViewportHorizontal: {\r\n      commandFn: actions.flipViewportHorizontal,\r\n    },\r\n    flipViewportVertical: {\r\n      commandFn: actions.flipViewportVertical,\r\n    },\r\n    invertViewport: {\r\n      commandFn: actions.invertViewport,\r\n    },\r\n    resetViewport: {\r\n      commandFn: actions.resetViewport,\r\n    },\r\n    scaleUpViewport: {\r\n      commandFn: actions.scaleViewport,\r\n      options: { direction: 1 },\r\n    },\r\n    scaleDownViewport: {\r\n      commandFn: actions.scaleViewport,\r\n      options: { direction: -1 },\r\n    },\r\n    fitViewportToWindow: {\r\n      commandFn: actions.scaleViewport,\r\n      options: { direction: 0 },\r\n    },\r\n    nextImage: {\r\n      commandFn: actions.scroll,\r\n      options: { direction: 1 },\r\n    },\r\n    previousImage: {\r\n      commandFn: actions.scroll,\r\n      options: { direction: -1 },\r\n    },\r\n    firstImage: {\r\n      commandFn: actions.jumpToImage,\r\n      options: { imageIndex: 0 },\r\n    },\r\n    lastImage: {\r\n      commandFn: actions.jumpToImage,\r\n      options: { imageIndex: -1 },\r\n    },\r\n    jumpToImage: {\r\n      commandFn: actions.jumpToImage,\r\n    },\r\n    showDownloadViewportModal: {\r\n      commandFn: actions.showDownloadViewportModal,\r\n    },\r\n    toggleCine: {\r\n      commandFn: actions.toggleCine,\r\n    },\r\n    arrowTextCallback: {\r\n      commandFn: actions.arrowTextCallback,\r\n    },\r\n    setViewportActive: {\r\n      commandFn: actions.setViewportActive,\r\n    },\r\n    setAllViewportsColorMap: {\r\n      commandFn: actions.setAllViewportsColorMap\r\n    },\r\n    setViewportColormap: {\r\n      commandFn: actions.setViewportColormap,\r\n    },\r\n    setSourceViewportForReferenceLinesTool: {\r\n      commandFn: actions.setSourceViewportForReferenceLinesTool,\r\n    },\r\n    storePresentation: {\r\n      commandFn: actions.storePresentation,\r\n    },\r\n    attachProtocolViewportDataListener: {\r\n      commandFn: actions.attachProtocolViewportDataListener,\r\n    },\r\n    setViewportPreset: {\r\n      commandFn: actions.setViewportPreset,\r\n    },\r\n    setVolumeRenderingQulaity: {\r\n      commandFn: actions.setVolumeRenderingQulaity,\r\n    },\r\n    shiftVolumeOpacityPoints: {\r\n      commandFn: actions.shiftVolumeOpacityPoints,\r\n    },\r\n    setVolumeLighting: {\r\n      commandFn: actions.setVolumeLighting,\r\n    },\r\n    resetCrosshairs: {\r\n      commandFn: actions.resetCrosshairs,\r\n    },\r\n    toggleSynchronizer: {\r\n      commandFn: actions.toggleSynchronizer,\r\n    },\r\n    updateVolumeData: {\r\n      commandFn: actions.updateVolumeData,\r\n    },\r\n    toggleEnabledDisabledToolbar: {\r\n      commandFn: actions.toggleEnabledDisabledToolbar,\r\n    },\r\n    toggleActiveDisabledToolbar: {\r\n      commandFn: actions.toggleActiveDisabledToolbar,\r\n    },\r\n    mprView: {\r\n      commandFn: actions.mprView,\r\n    },\r\n    panoramicView: {\r\n      commandFn: actions.panoramicView,\r\n    }\r\n  };\r\n\r\n  return {\r\n    actions,\r\n    definitions,\r\n    defaultContext: 'CORNERSTONE',\r\n  };\r\n}\r\n\r\nexport default commandsModule;\r\n","export const fourUp = {\r\n  id: 'fourUp',\r\n  locked: true,\r\n  name: '3D four up',\r\n  icon: 'layout-advanced-3d-four-up',\r\n  isPreset: true,\r\n  createdDate: '2023-03-15T10:29:44.894Z',\r\n  modifiedDate: '2023-03-15T10:29:44.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'fourUpStage',\r\n      name: 'fourUp',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 2,\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'volume3d',\r\n            viewportType: 'volume3d',\r\n            orientation: 'coronal',\r\n            customViewportProps: {\r\n              hideOverlays: true,\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n              options: {\r\n                displayPreset: {\r\n                  CT: 'CT-Cardiac3',\r\n                  MR: 'MR-Default',\r\n                  default: 'CT-Cardiac3',\r\n                },\r\n              },\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'coronal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'sagittal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","export const main3D = {\r\n  id: 'main3D',\r\n  locked: true,\r\n  name: '3D main',\r\n  icon: 'layout-advanced-3d-main',\r\n  isPreset: true,\r\n  createdDate: '2023-03-15T10:29:44.894Z',\r\n  modifiedDate: '2023-03-15T10:29:44.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'main3DStage',\r\n      name: 'main3D',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 3,\r\n          layoutOptions: [\r\n            {\r\n              x: 0,\r\n              y: 0,\r\n              width: 1,\r\n              height: 1 / 2,\r\n            },\r\n            {\r\n              x: 0,\r\n              y: 1 / 2,\r\n              width: 1 / 3,\r\n              height: 1 / 2,\r\n            },\r\n            {\r\n              x: 1 / 3,\r\n              y: 1 / 2,\r\n              width: 1 / 3,\r\n              height: 1 / 2,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 1 / 2,\r\n              width: 1 / 3,\r\n              height: 1 / 2,\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'volume3d',\r\n            viewportType: 'volume3d',\r\n            orientation: 'coronal',\r\n            customViewportProps: {\r\n              hideOverlays: true,\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n              options: {\r\n                displayPreset: {\r\n                  CT: 'CT-Cardiac3',\r\n                  MR: 'MR-Default',\r\n                  default: 'CT-Cardiac3',\r\n                },\r\n              },\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'coronal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'sagittal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","import { Types } from '@ohif/core';\r\n\r\nexport const mpr: Types.HangingProtocol.Protocol = {\r\n  id: 'mpr',\r\n  name: 'MPR',\r\n  locked: true,\r\n  icon: 'layout-advanced-mpr',\r\n  isPreset: true,\r\n  createdDate: '2021-02-23',\r\n  modifiedDate: '2023-08-15',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  // Unknown number of priors referenced - so just match any study\r\n  numberOfPriorsReferenced: 0,\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'nth',\r\n  callbacks: {},\r\n  displaySetSelectors: {\r\n    activeDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      name: 'MPR 1x3',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 1,\r\n          columns: 3,\r\n          layoutOptions: [\r\n            {\r\n              x: 0,\r\n              y: 0,\r\n              width: 1 / 3,\r\n              height: 1,\r\n            },\r\n            {\r\n              x: 1 / 3,\r\n              y: 0,\r\n              width: 1 / 3,\r\n              height: 1,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 0,\r\n              width: 1 / 3,\r\n              height: 1,\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            viewportId: 'mpr-axial',\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'activeDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            viewportId: 'mpr-sagittal',\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'sagittal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'activeDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            viewportId: 'mpr-coronal',\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'coronal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'activeDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","export const mprAnd3DVolumeViewport = {\r\n  id: 'mprAnd3DVolumeViewport',\r\n  locked: true,\r\n  name: 'mpr',\r\n  createdDate: '2023-03-15T10:29:44.894Z',\r\n  modifiedDate: '2023-03-15T10:29:44.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n        {\r\n          attribute: 'Modality',\r\n          constraint: {\r\n            equals: {\r\n              value: 'CT',\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n        {\r\n          attribute: 'isSeriesUIDFromURL',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'mpr3Stage',\r\n      name: 'mpr',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 2,\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            // syncGroups: [\r\n            //   {\r\n            //     type: 'voi',\r\n            //     id: 'mpr',\r\n            //     source: true,\r\n            //     target: true,\r\n            //     options: {\r\n            //       syncColormap: true,\r\n            //     },\r\n            //   },\r\n            // ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'volume3d',\r\n            viewportType: 'volume3d',\r\n            orientation: 'coronal',\r\n            customViewportProps: {\r\n              hideOverlays: true,\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n              // options: {\r\n              //   displayPreset: {\r\n              //     CT: 'CT-Cardiac3',\r\n              //     MR: 'MR-Default',\r\n              //     default: 'CT-Cardiac3',\r\n              //   },\r\n              // },\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'coronal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            // syncGroups: [\r\n            //   {\r\n            //     type: 'voi',\r\n            //     id: 'mpr',\r\n            //     source: true,\r\n            //     target: true,\r\n            //     options: {\r\n            //       syncColormap: true,\r\n            //     },\r\n            //   },\r\n            // ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'sagittal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            // syncGroups: [\r\n            //   {\r\n            //     type: 'voi',\r\n            //     id: 'mpr',\r\n            //     source: true,\r\n            //     target: true,\r\n            //     options: {\r\n            //       syncColormap: true,\r\n            //     },\r\n            //   },\r\n            // ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","export const only3D = {\r\n  id: 'only3D',\r\n  locked: true,\r\n  name: '3D only',\r\n  icon: 'layout-advanced-3d-only',\r\n  isPreset: true,\r\n  createdDate: '2023-03-15T10:29:44.894Z',\r\n  modifiedDate: '2023-03-15T10:29:44.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'only3DStage',\r\n      name: 'only3D',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 1,\r\n          columns: 1,\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'volume3d',\r\n            viewportType: 'volume3d',\r\n            orientation: 'coronal',\r\n            customViewportProps: {\r\n              hideOverlays: true,\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n              options: {\r\n                displayPreset: {\r\n                  CT: 'CT-Cardiac3',\r\n                  MR: 'MR-Default',\r\n                  default: 'CT-Cardiac3',\r\n                },\r\n              },\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","export const panoramicViewport = {\r\n  id: 'panoramicViewport',\r\n  locked: true,\r\n  hasUpdatedPriorsInformation: false,\r\n  name: 'Panoramic',\r\n  icon: 'layout-advanced-panoramic',\r\n  isPreset: false,\r\n  createdDate: '2023-07-10T16:35:08.894Z',\r\n  modifiedDate: '2023-07-10',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n        {\r\n          attribute: 'Modality',\r\n          constraint: {\r\n            equals: {\r\n              value: 'CT',\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n        {\r\n          attribute: 'isSeriesUIDFromURL',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n        },\r\n      ]\r\n    },\r\n    panoramicDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          attribute: 'numImageFrames',\r\n          constraint: {\r\n            greaterThan: { value: 1 },\r\n          },\r\n          required: true\r\n        },\r\n        {\r\n          attribute: 'Modality',\r\n          constraint: {\r\n            equals: {value: 'OT'},\r\n          },\r\n        },\r\n        {\r\n          attribute: 'isPanoramicDerivedFromSeriesURL',\r\n          constraint: {\r\n            equals: {value: true}\r\n          },\r\n          required: true\r\n        }\r\n      ],\r\n    },\r\n    dentascanDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          attribute: 'numImageFrames',\r\n          constraint: {\r\n            greaterThan: { value: 1 },\r\n          },\r\n        },\r\n        {\r\n          attribute: 'Modality',\r\n          constraint: {\r\n            equals: {value: 'OT'},\r\n          },\r\n        },\r\n        {\r\n          attribute: 'isDentascanDerivedFromSeriesURL',\r\n          constraint: {\r\n            equals: {value: true}\r\n          },\r\n          required: true\r\n        }\r\n      ],\r\n    },\r\n\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'panoramicStage',\r\n      name: 'mpr',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 7,\r\n          layoutOptions: [\r\n            {\r\n              x: 0,\r\n              y: 0,\r\n              width: 0.3,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 0.3,\r\n              y: 0,\r\n              width: 0.7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 0,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 1 / 7,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 2 / 7,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 3 / 7,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 4 / 7,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 5 / 7,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 6 / 7,\r\n              y: 0.5,\r\n              width: 1 / 7,\r\n              height: 0.5\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'default',\r\n            viewportType: 'stack',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'panoramicDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ]\r\n    },\r\n    {\r\n      id: 'panoramicStage',\r\n      name: 'mpr',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 7,\r\n          layoutOptions: [\r\n            {\r\n              x: 0,\r\n              y: 0,\r\n              width: 0.6,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 0,\r\n              y: 0.5,\r\n              width: 0.6,\r\n              height: 0.5\r\n            },\r\n            {\r\n              x: 0.6,\r\n              y: 0,\r\n              width: 0.4,\r\n              height: 1\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'default',\r\n            viewportType: 'stack',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'panoramicDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'dentascanDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ]\r\n    },\r\n  ]\r\n};\r\n","export const primary3D = {\r\n  id: 'primary3D',\r\n  locked: true,\r\n  name: '3D primary',\r\n  icon: 'layout-advanced-3d-primary',\r\n  isPreset: true,\r\n  createdDate: '2023-03-15T10:29:44.894Z',\r\n  modifiedDate: '2023-03-15T10:29:44.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'primary3DStage',\r\n      name: 'primary3D',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 3,\r\n          columns: 3,\r\n          layoutOptions: [\r\n            {\r\n              x: 0,\r\n              y: 0,\r\n              width: 2 / 3,\r\n              height: 1,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 0,\r\n              width: 1 / 3,\r\n              height: 1 / 3,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 1 / 3,\r\n              width: 1 / 3,\r\n              height: 1 / 3,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 2 / 3,\r\n              width: 1 / 3,\r\n              height: 1 / 3,\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'volume3d',\r\n            viewportType: 'volume3d',\r\n            orientation: 'coronal',\r\n            customViewportProps: {\r\n              hideOverlays: true,\r\n            },\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n              options: {\r\n                displayPreset: {\r\n                  CT: 'CT-Cardiac3',\r\n                  MR: 'MR-Default',\r\n                  default: 'CT-Cardiac3',\r\n                },\r\n              },\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'coronal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'sagittal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","export const primaryAxial = {\r\n  id: 'primaryAxial',\r\n  locked: true,\r\n  name: 'Axial Primary',\r\n  icon: 'layout-advanced-axial-primary',\r\n  isPreset: true,\r\n  createdDate: '2023-03-15T10:29:44.894Z',\r\n  modifiedDate: '2023-03-15T10:29:44.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  imageLoadStrategy: 'interleaveCenter',\r\n  displaySetSelectors: {\r\n    mprDisplaySet: {\r\n      seriesMatchingRules: [\r\n        {\r\n          weight: 1,\r\n          attribute: 'isReconstructable',\r\n          constraint: {\r\n            equals: {\r\n              value: true,\r\n            },\r\n          },\r\n          required: true,\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  stages: [\r\n    {\r\n      id: 'primaryAxialStage',\r\n      name: 'primaryAxial',\r\n      viewportStructure: {\r\n        layoutType: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 3,\r\n          layoutOptions: [\r\n            {\r\n              x: 0,\r\n              y: 0,\r\n              width: 2 / 3,\r\n              height: 1,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 0,\r\n              width: 1 / 3,\r\n              height: 1 / 2,\r\n            },\r\n            {\r\n              x: 2 / 3,\r\n              y: 1 / 2,\r\n              width: 1 / 3,\r\n              height: 1 / 2,\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'axial',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'sagittal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          viewportOptions: {\r\n            toolGroupId: 'mpr',\r\n            viewportType: 'volume',\r\n            orientation: 'coronal',\r\n            initialImageOptions: {\r\n              preset: 'middle',\r\n            },\r\n            syncGroups: [\r\n              {\r\n                type: 'voi',\r\n                id: 'mpr',\r\n                source: true,\r\n                target: true,\r\n                options: {\r\n                  syncColormap: true,\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          displaySets: [\r\n            {\r\n              id: 'mprDisplaySet',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n};\r\n","import { fourUp } from './hps/fourUp';\r\nimport { main3D } from './hps/main3D';\r\nimport { mpr } from './hps/mpr';\r\nimport { mprAnd3DVolumeViewport } from './hps/mprAnd3DVolumeViewport';\r\nimport { only3D } from './hps/only3D';\r\nimport { panoramicViewport } from './hps/panoramicViewport';\r\nimport { primary3D } from './hps/primary3D';\r\nimport { primaryAxial } from './hps/primaryAxial';\r\nimport { frameView } from './hps/frameView';\r\n\r\nfunction getHangingProtocolModule() {\r\n  return [\r\n    {\r\n      name: mpr.id,\r\n      protocol: mpr,\r\n    },\r\n    {\r\n      name: mprAnd3DVolumeViewport.id,\r\n      protocol: mprAnd3DVolumeViewport,\r\n    },\r\n    {\r\n      name: fourUp.id,\r\n      protocol: fourUp,\r\n    },\r\n    {\r\n      name: main3D.id,\r\n      protocol: main3D,\r\n    },\r\n    {\r\n      name: primaryAxial.id,\r\n      protocol: primaryAxial,\r\n    },\r\n    {\r\n      name: only3D.id,\r\n      protocol: only3D,\r\n    },\r\n    {\r\n      name: primary3D.id,\r\n      protocol: primary3D,\r\n    },\r\n    {\r\n      name: panoramicViewport.id,\r\n      protocol: panoramicViewport,\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getHangingProtocolModule;\r\n","import { Enums } from '@cornerstonejs/tools';\r\n\r\nconst getToggledClassName = (isToggled: boolean) => {\r\n  return isToggled\r\n    ? '!text-primary-active'\r\n    : '!text-common-bright hover:!bg-primary-dark hover:text-primary-light';\r\n};\r\n\r\nexport default function getToolbarModule({ commandsManager, servicesManager }: withAppTypes) {\r\n  const {\r\n    toolGroupService,\r\n    toolbarService,\r\n    syncGroupService,\r\n    cornerstoneViewportService,\r\n    hangingProtocolService,\r\n    displaySetService,\r\n    viewportGridService,\r\n    panoramicService,\r\n  } = servicesManager.services;\r\n\r\n  return [\r\n    // functions/helpers to be used by the toolbar buttons to decide if they should\r\n    // enabled or not\r\n    {\r\n      name: 'evaluate.cornerstoneTool',\r\n      evaluate: ({ viewportId, button, toolNames, disabledText }) => {\r\n        const toolGroup = toolGroupService.getToolGroupForViewport(viewportId);\r\n\r\n        if (!toolGroup) {\r\n          return;\r\n        }\r\n\r\n        const toolName = toolbarService.getToolNameForButton(button);\r\n\r\n        if (!toolGroup || (!toolGroup.hasTool(toolName) && !toolNames)) {\r\n          return {\r\n            disabled: true,\r\n            className: '!text-common-bright ohif-disabled',\r\n            disabledText: disabledText ?? 'Not available on the current viewport',\r\n          };\r\n        }\r\n\r\n        const isPrimaryActive = toolNames\r\n          ? toolNames.includes(toolGroup.getActivePrimaryMouseButtonTool())\r\n          : toolGroup.getActivePrimaryMouseButtonTool() === toolName;\r\n\r\n        return {\r\n          disabled: false,\r\n          className: isPrimaryActive\r\n            ? '!text-black bg-primary-light rounded'\r\n            : '!text-common-bright hover:!bg-primary-dark hover:!text-primary-light rounded',\r\n          // Todo: isActive right now is used for nested buttons where the primary\r\n          // button needs to be fully rounded (vs partial rounded) when active\r\n          // otherwise it does not have any other use\r\n          isActive: isPrimaryActive,\r\n        };\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.group.promoteToPrimaryIfCornerstoneToolNotActiveInTheList',\r\n      evaluate: ({ viewportId, button, itemId }) => {\r\n        const { items } = button.props;\r\n\r\n        const toolGroup = toolGroupService.getToolGroupForViewport(viewportId);\r\n\r\n        if (!toolGroup) {\r\n          return {\r\n            primary: button.props.primary,\r\n            items,\r\n          };\r\n        }\r\n\r\n        const activeToolName = toolGroup.getActivePrimaryMouseButtonTool();\r\n\r\n        // check if the active toolName is part of the items then we need\r\n        // to move it to the primary button\r\n        const activeToolIndex = items.findIndex(item => {\r\n          const toolName = toolbarService.getToolNameForButton(item);\r\n          return toolName === activeToolName;\r\n        });\r\n\r\n        // if there is an active tool in the items dropdown bound to the primary mouse/touch\r\n        // we should show that no matter what\r\n        if (activeToolIndex > -1) {\r\n          return {\r\n            primary: items[activeToolIndex],\r\n            items,\r\n          };\r\n        }\r\n\r\n        if (!itemId) {\r\n          return {\r\n            primary: button.props.primary,\r\n            items,\r\n          };\r\n        }\r\n\r\n        // other wise we can move the clicked tool to the primary button\r\n        const clickedItemProps = items.find(item => item.id === itemId || item.itemId === itemId);\r\n\r\n        return {\r\n          primary: clickedItemProps,\r\n          items,\r\n        };\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.action',\r\n      evaluate: ({ viewportId, button }) => {\r\n        return {\r\n          className: '!text-common-bright hover:!bg-primary-dark hover:text-primary-light',\r\n        };\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.cornerstoneTool.toggle.ifStrictlyDisabled',\r\n      evaluate: ({ viewportId, button, disabledText }) =>\r\n        _evaluateToggle({\r\n          viewportId,\r\n          button,\r\n          toolbarService,\r\n          disabledText,\r\n          offModes: [Enums.ToolModes.Disabled],\r\n          toolGroupService,\r\n        }),\r\n    },\r\n    {\r\n      name: 'evaluate.cornerstoneTool.toggle',\r\n      evaluate: ({ viewportId, button, disabledText }) =>\r\n        _evaluateToggle({\r\n          viewportId,\r\n          button,\r\n          toolbarService,\r\n          disabledText,\r\n          offModes: [Enums.ToolModes.Disabled, Enums.ToolModes.Passive],\r\n          toolGroupService,\r\n        }),\r\n    },\r\n    {\r\n      name: 'evaluate.cornerstone.synchronizer',\r\n      evaluate: ({ viewportId, button }) => {\r\n        let synchronizers = syncGroupService.getSynchronizersForViewport(viewportId);\r\n\r\n        if (!synchronizers?.length) {\r\n          return {\r\n            className: getToggledClassName(false),\r\n          };\r\n        }\r\n\r\n        const isArray = Array.isArray(button.commands);\r\n\r\n        const synchronizerType = isArray\r\n          ? button.commands?.[0].commandOptions.type\r\n          : button.commands?.commandOptions.type;\r\n\r\n        synchronizers = syncGroupService.getSynchronizersOfType(synchronizerType);\r\n\r\n        if (!synchronizers?.length) {\r\n          return {\r\n            className: getToggledClassName(false),\r\n          };\r\n        }\r\n\r\n        // Todo: we need a better way to find the synchronizers based on their\r\n        // type, but for now we just check the first one and see if it is\r\n        // enabled\r\n        const synchronizer = synchronizers[0];\r\n\r\n        const isEnabled = synchronizer?._enabled;\r\n\r\n        return {\r\n          className: getToggledClassName(isEnabled),\r\n        };\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.not3D',\r\n      evaluate: ({ viewportId, disabledText }) => {\r\n        const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n        if (viewport?.type === 'volume3d') {\r\n          return {\r\n            disabled: true,\r\n            className: '!text-common-bright ohif-disabled',\r\n            disabledText: disabledText ?? 'Not available on the current viewport',\r\n          };\r\n        }\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.notProcessing',\r\n      evaluate: ({ viewportId, disabledText }) => {\r\n        if (panoramicService.isProcessing()) {\r\n          return {\r\n            disabled: true,\r\n            className: '!text-common-bright ohif-disabled',\r\n            disabledText: disabledText ?? 'Not available while processing panoramic',\r\n          };\r\n        }\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.isUS',\r\n      evaluate: ({ viewportId, disabledText }) => {\r\n        const displaySetUIDs = viewportGridService.getDisplaySetsUIDsForViewport(viewportId);\r\n\r\n        if (!displaySetUIDs?.length) {\r\n          return;\r\n        }\r\n\r\n        const displaySets = displaySetUIDs.map(displaySetService.getDisplaySetByUID);\r\n        const isUS = displaySets.some(displaySet => displaySet?.Modality === 'US');\r\n        if (!isUS) {\r\n          return {\r\n            disabled: true,\r\n            className: '!text-common-bright ohif-disabled',\r\n            disabledText: disabledText ?? 'Not available on the current viewport',\r\n          };\r\n        }\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.viewportProperties.toggle',\r\n      evaluate: ({ viewportId, button }) => {\r\n        const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n        if (!viewport || viewport.isDisabled) {\r\n          return;\r\n        }\r\n\r\n        const propId = button.id;\r\n\r\n        const properties = viewport.getProperties();\r\n        const camera = viewport.getCamera();\r\n\r\n        const prop = camera?.[propId] || properties?.[propId];\r\n\r\n        if (!prop) {\r\n          return {\r\n            disabled: false,\r\n            className: '!text-common-bright hover:!bg-primary-dark hover:text-primary-light',\r\n          };\r\n        }\r\n\r\n        const isToggled = prop;\r\n\r\n        return {\r\n          className: getToggledClassName(isToggled),\r\n        };\r\n      },\r\n    },\r\n    {\r\n      name: 'evaluate.mpr',\r\n      evaluate: ({ viewportId, disabledText = 'Selected viewport is not reconstructable' }) => {\r\n        const { protocol } = hangingProtocolService.getActiveProtocol();\r\n\r\n        const displaySetUIDs = viewportGridService.getDisplaySetsUIDsForViewport(viewportId);\r\n\r\n        if (!displaySetUIDs?.length) {\r\n          return;\r\n        }\r\n\r\n        const displaySets = displaySetUIDs.map(displaySetService.getDisplaySetByUID);\r\n\r\n        const areReconstructable = displaySets.every(displaySet => {\r\n          return displaySet?.isReconstructable;\r\n        });\r\n\r\n        if (!areReconstructable) {\r\n          return {\r\n            disabled: true,\r\n            className: '!text-common-bright ohif-disabled',\r\n            disabledText: disabledText ?? 'Not available on the current viewport',\r\n          };\r\n        }\r\n\r\n        const isMpr = protocol?.id === 'mpr';\r\n\r\n        return {\r\n          disabled: false,\r\n          className: getToggledClassName(isMpr),\r\n        };\r\n      },\r\n    },\r\n  ];\r\n}\r\n\r\nfunction _evaluateToggle({\r\n  viewportId,\r\n  toolbarService,\r\n  button,\r\n  disabledText,\r\n  offModes,\r\n  toolGroupService,\r\n}) {\r\n  const toolGroup = toolGroupService.getToolGroupForViewport(viewportId);\r\n\r\n  if (!toolGroup) {\r\n    return;\r\n  }\r\n  const toolName = toolbarService.getToolNameForButton(button);\r\n\r\n  if (!toolGroup.hasTool(toolName)) {\r\n    return {\r\n      disabled: true,\r\n      className: '!text-common-bright ohif-disabled',\r\n      disabledText: disabledText ?? 'Not available on the current viewport',\r\n    };\r\n  }\r\n\r\n  const isOff = offModes.includes(toolGroup.getToolOptions(toolName).mode);\r\n\r\n  return {\r\n    className: getToggledClassName(!isOff),\r\n  };\r\n}\r\n","import { ToolGroupManager, Enums, Types } from '@cornerstonejs/tools';\r\nimport { eventTarget } from '@cornerstonejs/core';\r\n\r\nimport { Types as OhifTypes, pubSubServiceInterface } from '@ohif/core';\r\nimport getActiveViewportEnabledElement from '../../utils/getActiveViewportEnabledElement';\r\n\r\nconst EVENTS = {\r\n  VIEWPORT_ADDED: 'event::cornerstone::toolgroupservice:viewportadded',\r\n  TOOLGROUP_CREATED: 'event::cornerstone::toolgroupservice:toolgroupcreated',\r\n  TOOL_ACTIVATED: 'event::cornerstone::toolgroupservice:toolactivated',\r\n  PRIMARY_TOOL_ACTIVATED: 'event::cornerstone::toolgroupservice:primarytoolactivated',\r\n};\r\n\r\ntype Tool = {\r\n  toolName: string;\r\n  bindings?: typeof Enums.MouseBindings | Enums.KeyboardBindings;\r\n};\r\n\r\ntype Tools = {\r\n  active: Tool[];\r\n  passive?: Tool[];\r\n  enabled?: Tool[];\r\n  disabled?: Tool[];\r\n};\r\n\r\nexport default class ToolGroupService {\r\n  public static REGISTRATION = {\r\n    name: 'toolGroupService',\r\n    altName: 'ToolGroupService',\r\n    create: ({ servicesManager }: OhifTypes.Extensions.ExtensionParams): ToolGroupService => {\r\n      return new ToolGroupService(servicesManager);\r\n    },\r\n  };\r\n\r\n  servicesManager: AppTypes.ServicesManager;\r\n  cornerstoneViewportService: any;\r\n  viewportGridService: any;\r\n  uiNotificationService: any;\r\n  private toolGroupIds: Set<string> = new Set();\r\n  /**\r\n   * Service-specific\r\n   */\r\n  listeners: { [key: string]: Function[] };\r\n  EVENTS: { [key: string]: string };\r\n\r\n  constructor(servicesManager: AppTypes.ServicesManager) {\r\n    const { cornerstoneViewportService, viewportGridService, uiNotificationService } =\r\n      servicesManager.services;\r\n    this.cornerstoneViewportService = cornerstoneViewportService;\r\n    this.viewportGridService = viewportGridService;\r\n    this.uiNotificationService = uiNotificationService;\r\n    this.listeners = {};\r\n    this.EVENTS = EVENTS;\r\n    Object.assign(this, pubSubServiceInterface);\r\n\r\n    this._init();\r\n  }\r\n\r\n  onModeExit() {\r\n    this.destroy();\r\n  }\r\n\r\n  private _init() {\r\n    eventTarget.addEventListener(Enums.Events.TOOL_ACTIVATED, this._onToolActivated);\r\n  }\r\n\r\n  /**\r\n   * Retrieves a tool group from the ToolGroupManager by tool group ID.\r\n   * If no tool group ID is provided, it retrieves the tool group of the active viewport.\r\n   * @param toolGroupId - Optional ID of the tool group to retrieve.\r\n   * @returns The tool group or undefined if it is not found.\r\n   */\r\n  public getToolGroup(toolGroupId?: string): Types.IToolGroup | void {\r\n    let toolGroupIdToUse = toolGroupId;\r\n\r\n    if (!toolGroupIdToUse) {\r\n      // Use the active viewport's tool group if no tool group id is provided\r\n      const enabledElement = getActiveViewportEnabledElement(this.viewportGridService);\r\n\r\n      if (!enabledElement) {\r\n        return;\r\n      }\r\n\r\n      const { renderingEngineId, viewportId } = enabledElement;\r\n      const toolGroup = ToolGroupManager.getToolGroupForViewport(viewportId, renderingEngineId);\r\n\r\n      if (!toolGroup) {\r\n        console.warn(\r\n          'No tool group found for viewportId:',\r\n          viewportId,\r\n          'and renderingEngineId:',\r\n          renderingEngineId\r\n        );\r\n        return;\r\n      }\r\n\r\n      toolGroupIdToUse = toolGroup.id;\r\n    }\r\n\r\n    const toolGroup = ToolGroupManager.getToolGroup(toolGroupIdToUse);\r\n    return toolGroup;\r\n  }\r\n\r\n  public getToolGroupIds(): string[] {\r\n    return Array.from(this.toolGroupIds);\r\n  }\r\n\r\n  public getToolGroupForViewport(viewportId: string): Types.IToolGroup | void {\r\n    const renderingEngine = this.cornerstoneViewportService.getRenderingEngine();\r\n    return ToolGroupManager.getToolGroupForViewport(viewportId, renderingEngine.id);\r\n  }\r\n\r\n  public getActiveToolForViewport(viewportId: string): string {\r\n    const toolGroup = this.getToolGroupForViewport(viewportId);\r\n    if (!toolGroup) {\r\n      return;\r\n    }\r\n\r\n    return toolGroup.getActivePrimaryMouseButtonTool();\r\n  }\r\n\r\n  public destroy(): void {\r\n    ToolGroupManager.destroy();\r\n    this.toolGroupIds = new Set();\r\n\r\n    eventTarget.removeEventListener(Enums.Events.TOOL_ACTIVATED, this._onToolActivated);\r\n  }\r\n\r\n  public destroyToolGroup(toolGroupId: string): void {\r\n    ToolGroupManager.destroyToolGroup(toolGroupId);\r\n    this.toolGroupIds.delete(toolGroupId);\r\n  }\r\n\r\n  public removeViewportFromToolGroup(\r\n    viewportId: string,\r\n    renderingEngineId: string,\r\n    deleteToolGroupIfEmpty?: boolean\r\n  ): void {\r\n    const toolGroup = ToolGroupManager.getToolGroupForViewport(viewportId, renderingEngineId);\r\n\r\n    if (!toolGroup) {\r\n      return;\r\n    }\r\n\r\n    toolGroup.removeViewports(renderingEngineId, viewportId);\r\n\r\n    const viewportIds = toolGroup.getViewportIds();\r\n\r\n    if (viewportIds.length === 0 && deleteToolGroupIfEmpty) {\r\n      ToolGroupManager.destroyToolGroup(toolGroup.id);\r\n    }\r\n  }\r\n\r\n  public addViewportToToolGroup(\r\n    viewportId: string,\r\n    renderingEngineId: string,\r\n    toolGroupId?: string\r\n  ): void {\r\n    if (!toolGroupId) {\r\n      // If toolGroupId is not provided, add the viewport to all toolGroups\r\n      const toolGroups = ToolGroupManager.getAllToolGroups();\r\n      toolGroups.forEach(toolGroup => {\r\n        toolGroup.addViewport(viewportId, renderingEngineId);\r\n      });\r\n    } else {\r\n      let toolGroup = ToolGroupManager.getToolGroup(toolGroupId);\r\n      if (!toolGroup) {\r\n        toolGroup = this.createToolGroup(toolGroupId);\r\n      }\r\n\r\n      toolGroup.addViewport(viewportId, renderingEngineId);\r\n    }\r\n\r\n    this._broadcastEvent(EVENTS.VIEWPORT_ADDED, {\r\n      viewportId,\r\n      toolGroupId,\r\n    });\r\n  }\r\n\r\n  public createToolGroup(toolGroupId: string): Types.IToolGroup {\r\n    if (this.getToolGroup(toolGroupId)) {\r\n      throw new Error(`ToolGroup ${toolGroupId} already exists`);\r\n    }\r\n\r\n    // if the toolGroup doesn't exist, create it\r\n    const toolGroup = ToolGroupManager.createToolGroup(toolGroupId);\r\n    this.toolGroupIds.add(toolGroupId);\r\n\r\n    this._broadcastEvent(EVENTS.TOOLGROUP_CREATED, {\r\n      toolGroupId,\r\n    });\r\n\r\n    return toolGroup;\r\n  }\r\n\r\n  public addToolsToToolGroup(toolGroupId: string, tools: Array<Tool>, configs: any = {}): void {\r\n    const toolGroup = ToolGroupManager.getToolGroup(toolGroupId);\r\n    // this.changeConfigurationIfNecessary(toolGroup, volumeId);\r\n    this._addTools(toolGroup, tools, configs);\r\n    this._setToolsMode(toolGroup, tools);\r\n  }\r\n\r\n  public createToolGroupAndAddTools(toolGroupId: string, tools: Array<Tool>): Types.IToolGroup {\r\n    const toolGroup = this.createToolGroup(toolGroupId);\r\n    this.addToolsToToolGroup(toolGroupId, tools);\r\n    return toolGroup;\r\n  }\r\n  /**\r\n   * Get the tool's configuration based on the tool name and tool group id\r\n   * @param toolGroupId - The id of the tool group that the tool instance belongs to.\r\n   * @param toolName - The name of the tool\r\n   * @returns The configuration of the tool.\r\n   */\r\n  public getToolConfiguration(toolGroupId: string, toolName: string) {\r\n    const toolGroup = ToolGroupManager.getToolGroup(toolGroupId);\r\n    if (!toolGroup) {\r\n      return null;\r\n    }\r\n\r\n    const tool = toolGroup.getToolInstance(toolName);\r\n    if (!tool) {\r\n      return null;\r\n    }\r\n\r\n    return tool.configuration;\r\n  }\r\n\r\n  /**\r\n   * Set the tool instance configuration. This will update the tool instance configuration\r\n   * on the toolGroup\r\n   * @param toolGroupId - The id of the tool group that the tool instance belongs to.\r\n   * @param toolName - The name of the tool\r\n   * @param config - The configuration object that you want to set.\r\n   */\r\n  public setToolConfiguration(toolGroupId, toolName, config) {\r\n    const toolGroup = ToolGroupManager.getToolGroup(toolGroupId);\r\n    const toolInstance = toolGroup.getToolInstance(toolName);\r\n    toolInstance.configuration = config;\r\n  }\r\n\r\n  public getActivePrimaryMouseButtonTool(toolGroupId?: string): string {\r\n    return this.getToolGroup(toolGroupId)?.getActivePrimaryMouseButtonTool();\r\n  }\r\n\r\n  private _setToolsMode(toolGroup, tools) {\r\n    const { active, passive, enabled, disabled } = tools;\r\n\r\n    if (active) {\r\n      active.forEach(({ toolName, bindings }) => {\r\n        toolGroup.setToolActive(toolName, { bindings });\r\n      });\r\n    }\r\n\r\n    if (passive) {\r\n      passive.forEach(({ toolName }) => {\r\n        toolGroup.setToolPassive(toolName);\r\n      });\r\n    }\r\n\r\n    if (enabled) {\r\n      enabled.forEach(({ toolName }) => {\r\n        toolGroup.setToolEnabled(toolName);\r\n      });\r\n    }\r\n\r\n    if (disabled) {\r\n      disabled.forEach(({ toolName }) => {\r\n        toolGroup.setToolDisabled(toolName);\r\n      });\r\n    }\r\n  }\r\n\r\n  private _addTools(toolGroup, tools) {\r\n    const addTools = tools => {\r\n      tools.forEach(({ toolName, parentTool, configuration }) => {\r\n        if (parentTool) {\r\n          toolGroup.addToolInstance(toolName, parentTool, {\r\n            ...configuration,\r\n          });\r\n        } else {\r\n          toolGroup.addTool(toolName, { ...configuration });\r\n        }\r\n      });\r\n    };\r\n\r\n    if (tools.active) {\r\n      addTools(tools.active);\r\n    }\r\n\r\n    if (tools.passive) {\r\n      addTools(tools.passive);\r\n    }\r\n\r\n    if (tools.enabled) {\r\n      addTools(tools.enabled);\r\n    }\r\n\r\n    if (tools.disabled) {\r\n      addTools(tools.disabled);\r\n    }\r\n  }\r\n\r\n  private _onToolActivated = (evt: Types.EventTypes.ToolActivatedEventType) => {\r\n    const { toolGroupId, toolName, toolBindingsOptions } = evt.detail;\r\n    const isPrimaryTool = toolBindingsOptions.bindings?.some(\r\n      binding => binding.mouseButton === Enums.MouseBindings.Primary\r\n    );\r\n\r\n    const callbackProps = {\r\n      toolGroupId,\r\n      toolName,\r\n      toolBindingsOptions,\r\n    };\r\n\r\n    this._broadcastEvent(EVENTS.TOOL_ACTIVATED, callbackProps);\r\n\r\n    if (isPrimaryTool) {\r\n      this._broadcastEvent(EVENTS.PRIMARY_TOOL_ACTIVATED, callbackProps);\r\n    }\r\n  };\r\n}\r\n","import ToolGroupService from './ToolGroupService';\r\n\r\nexport default ToolGroupService;\r\n","import { synchronizers, SynchronizerManager, Synchronizer } from '@cornerstonejs/tools';\r\nimport { getRenderingEngines, utilities } from '@cornerstonejs/core';\r\n\r\nimport { pubSubServiceInterface, Types } from '@ohif/core';\r\n\r\nconst EVENTS = {\r\n  TOOL_GROUP_CREATED: 'event::cornerstone::syncgroupservice:toolgroupcreated',\r\n};\r\n\r\n/**\r\n * @params options - are an optional set of options associated with the first\r\n * sync group declared.\r\n */\r\nexport type SyncCreator = (id: string, options?: Record<string, unknown>) => Synchronizer;\r\n\r\nexport type SyncGroup = {\r\n  type: string;\r\n  id?: string;\r\n  // Source and target default to true if not specified\r\n  source?: boolean;\r\n  target?: boolean;\r\n  options?: Record<string, unknown>;\r\n};\r\n\r\nconst POSITION = 'cameraposition';\r\nconst VOI = 'voi';\r\nconst ZOOMPAN = 'zoompan';\r\nconst STACKIMAGE = 'stackimage';\r\nconst IMAGE_SLICE = 'imageslice';\r\n\r\nconst asSyncGroup = (syncGroup: string | SyncGroup): SyncGroup =>\r\n  typeof syncGroup === 'string' ? { type: syncGroup } : syncGroup;\r\n\r\nexport default class SyncGroupService {\r\n  static REGISTRATION = {\r\n    name: 'syncGroupService',\r\n    altName: 'SyncGroupService',\r\n    create: ({ servicesManager }: Types.Extensions.ExtensionParams): SyncGroupService => {\r\n      return new SyncGroupService(servicesManager);\r\n    },\r\n  };\r\n\r\n  servicesManager: AppTypes.ServicesManager;\r\n  listeners: { [key: string]: (...args: any[]) => void } = {};\r\n  EVENTS: { [key: string]: string };\r\n  synchronizerCreators: Record<string, SyncCreator> = {\r\n    [POSITION]: synchronizers.createCameraPositionSynchronizer,\r\n    [VOI]: synchronizers.createVOISynchronizer,\r\n    [ZOOMPAN]: synchronizers.createZoomPanSynchronizer,\r\n    // todo: remove stack image since it is legacy now and the image_slice\r\n    // handles both stack and volume viewports\r\n    [STACKIMAGE]: synchronizers.createImageSliceSynchronizer,\r\n    [IMAGE_SLICE]: synchronizers.createImageSliceSynchronizer,\r\n  };\r\n\r\n  synchronizersByType: { [key: string]: Synchronizer[] } = {};\r\n\r\n  constructor(servicesManager: AppTypes.ServicesManager) {\r\n    this.servicesManager = servicesManager;\r\n    this.listeners = {};\r\n    this.EVENTS = EVENTS;\r\n    //\r\n    Object.assign(this, pubSubServiceInterface);\r\n  }\r\n\r\n  private _createSynchronizer(type: string, id: string, options): Synchronizer | undefined {\r\n    // Initialize if not already done\r\n    this.synchronizersByType[type] = this.synchronizersByType[type] || [];\r\n\r\n    const syncCreator = this.synchronizerCreators[type.toLowerCase()];\r\n\r\n    if (syncCreator) {\r\n      const synchronizer = syncCreator(id, options);\r\n\r\n      if (synchronizer) {\r\n        this.synchronizersByType[type].push(synchronizer);\r\n        return synchronizer;\r\n      }\r\n    } else {\r\n      console.warn(`Unknown synchronizer type: ${type}, id: ${id}`);\r\n    }\r\n  }\r\n\r\n  public getSyncCreatorForType(type: string): SyncCreator {\r\n    return this.synchronizerCreators[type.toLowerCase()];\r\n  }\r\n\r\n  /**\r\n   * Creates a synchronizer type.\r\n   * @param type is the type of the synchronizer to create\r\n   * @param creator\r\n   */\r\n  public addSynchronizerType(type: string, creator: SyncCreator): void {\r\n    this.synchronizerCreators[type.toLowerCase()] = creator;\r\n  }\r\n\r\n  public getSynchronizer(id: string): Synchronizer | void {\r\n    return SynchronizerManager.getSynchronizer(id);\r\n  }\r\n\r\n  /**\r\n   * Registers a custom synchronizer.\r\n   * @param id - The id of the synchronizer.\r\n   * @param createFunction - The function that creates the synchronizer.\r\n   */\r\n  public registerCustomSynchronizer(id: string, createFunction: SyncCreator): void {\r\n    this.synchronizerCreators[id] = createFunction;\r\n  }\r\n\r\n  /**\r\n   * Retrieves an array of synchronizers of a specific type.\r\n   * @param type - The type of synchronizers to retrieve.\r\n   * @returns An array of synchronizers of the specified type.\r\n   */\r\n  public getSynchronizersOfType(type: string): Synchronizer[] {\r\n    return this.synchronizersByType[type];\r\n  }\r\n\r\n  protected _getOrCreateSynchronizer(\r\n    type: string,\r\n    id: string,\r\n    options: Record<string, unknown>\r\n  ): Synchronizer | undefined {\r\n    let synchronizer = SynchronizerManager.getSynchronizer(id);\r\n\r\n    if (!synchronizer) {\r\n      synchronizer = this._createSynchronizer(type, id, options);\r\n    }\r\n    return synchronizer;\r\n  }\r\n\r\n  public addViewportToSyncGroup(\r\n    viewportId: string,\r\n    renderingEngineId: string,\r\n    syncGroups?: SyncGroup | string | SyncGroup[] | string[]\r\n  ): void {\r\n    if (!syncGroups) {\r\n      return;\r\n    }\r\n\r\n    const syncGroupsArray = Array.isArray(syncGroups) ? syncGroups : [syncGroups];\r\n\r\n    syncGroupsArray.forEach(syncGroup => {\r\n      const syncGroupObj = asSyncGroup(syncGroup);\r\n      const { type, target = true, source = true, options = {}, id = type } = syncGroupObj;\r\n\r\n      const synchronizer = this._getOrCreateSynchronizer(type, id, options);\r\n      synchronizer.setOptions(viewportId, options);\r\n\r\n      const viewportInfo = { viewportId, renderingEngineId };\r\n      if (target && source) {\r\n        synchronizer.add(viewportInfo);\r\n        return;\r\n      } else if (source) {\r\n        synchronizer.addSource(viewportInfo);\r\n      } else if (target) {\r\n        synchronizer.addTarget(viewportInfo);\r\n      }\r\n    });\r\n  }\r\n\r\n  public destroy(): void {\r\n    SynchronizerManager.destroy();\r\n  }\r\n\r\n  public getSynchronizersForViewport(viewportId: string): Synchronizer[] {\r\n    const renderingEngine =\r\n      getRenderingEngines().find(re => {\r\n        return re.getViewports().find(vp => vp.id === viewportId);\r\n      }) || getRenderingEngines()[0];\r\n\r\n    const synchronizers = SynchronizerManager.getAllSynchronizers();\r\n    return synchronizers.filter(\r\n      s =>\r\n        s.hasSourceViewport(renderingEngine.id, viewportId) ||\r\n        s.hasTargetViewport(renderingEngine.id, viewportId)\r\n    );\r\n  }\r\n\r\n  public removeViewportFromSyncGroup(\r\n    viewportId: string,\r\n    renderingEngineId: string,\r\n    syncGroupId?: string\r\n  ): void {\r\n    const synchronizers = SynchronizerManager.getAllSynchronizers();\r\n\r\n    const filteredSynchronizers = syncGroupId\r\n      ? synchronizers.filter(s => s.id === syncGroupId)\r\n      : synchronizers;\r\n\r\n    filteredSynchronizers.forEach(synchronizer => {\r\n      if (!synchronizer) {\r\n        return;\r\n      }\r\n\r\n      // Only image slice synchronizer register spatial registration\r\n      if (this.isImageSliceSyncronizer(synchronizer)) {\r\n        this.unRegisterSpatialRegistration(synchronizer);\r\n      }\r\n\r\n      synchronizer.remove({\r\n        viewportId,\r\n        renderingEngineId,\r\n      });\r\n\r\n      // check if any viewport is left in any of the sync groups, if not, delete that sync group\r\n      const sourceViewports = synchronizer.getSourceViewports();\r\n      const targetViewports = synchronizer.getTargetViewports();\r\n\r\n      if (!sourceViewports.length && !targetViewports.length) {\r\n        SynchronizerManager.destroySynchronizer(synchronizer.id);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * Clean up the spatial registration metadata created by synchronizer\r\n   * This is needed to be able to re-sync images slices if needed\r\n   * @param synchronizer\r\n   */\r\n  unRegisterSpatialRegistration(synchronizer: Synchronizer) {\r\n    const sourceViewports = synchronizer.getSourceViewports().map(vp => vp.viewportId);\r\n    const targetViewports = synchronizer.getTargetViewports().map(vp => vp.viewportId);\r\n\r\n    // Create an array of pair of viewports to remove from spatialRegistrationMetadataProvider\r\n    // All sourceViewports combined with all targetViewports\r\n    const toUnregister = sourceViewports\r\n      .map((sourceViewportId: string) => {\r\n        return targetViewports.map(targetViewportId => [targetViewportId, sourceViewportId]);\r\n      })\r\n      .reduce((acc, c) => acc.concat(c), []);\r\n\r\n    toUnregister.forEach(viewportIdPair => {\r\n      utilities.spatialRegistrationMetadataProvider.add(viewportIdPair, undefined);\r\n    });\r\n  }\r\n  /**\r\n   * Check if the synchronizer type is IMAGE_SLICE\r\n   * Need to convert to lowercase here because the types are lowercase\r\n   * e.g: synchronizerCreators\r\n   * @param synchronizer\r\n   */\r\n  isImageSliceSyncronizer(synchronizer: Synchronizer) {\r\n    return this.getSynchronizerType(synchronizer).toLowerCase() === IMAGE_SLICE;\r\n  }\r\n  /**\r\n   * Returns the syncronizer type\r\n   * @param synchronizer\r\n   */\r\n  getSynchronizerType(synchronizer: Synchronizer): string {\r\n    const synchronizerTypes = Object.keys(this.synchronizersByType);\r\n    const syncType = synchronizerTypes.find(syncType =>\r\n      this.getSynchronizersOfType(syncType).includes(synchronizer)\r\n    );\r\n    return syncType;\r\n  }\r\n}\r\n","import SyncGroupService from './SyncGroupService';\r\n\r\nexport default SyncGroupService;\r\n","/**\r\n * It is a bell curved function that uses ease in out quadratic for css\r\n * transition timing function for each side of the curve.\r\n *\r\n * @param {number} x - The current time, in the range [0, 1].\r\n * @param {number} baseline - The baseline value to start from and return to.\r\n * @returns the value of the transition at time x.\r\n */\r\nexport function easeInOutBell(x: number, baseline: number): number {\r\n  const alpha = 1 - baseline;\r\n\r\n  // prettier-ignore\r\n  if (x < 1 / 4) {\r\n    return  4 * Math.pow(2 * x, 3) * alpha + baseline;\r\n  } else if (x < 1 / 2) {\r\n    return (1 - Math.pow(-4 * x + 2, 3) / 2) * alpha + baseline;\r\n  } else if (x < 3 / 4) {\r\n    return (1 - Math.pow(4 * x - 2, 3) / 2) * alpha + baseline;\r\n  } else {\r\n    return (- 4 * Math.pow(2 * x - 2, 3)) * alpha + baseline;\r\n  }\r\n}\r\n\r\n/**\r\n * A reversed bell curved function that starts from 1 and goes to baseline and\r\n * come back to 1 again. It uses ease in out quadratic for css transition\r\n * timing function for each side of the curve.\r\n *\r\n * @param {number} x - The current time, in the range [0, 1].\r\n * @param {number} baseline - The baseline value to start from and return to.\r\n * @returns the value of the transition at time x.\r\n */\r\nexport function reverseEaseInOutBell(x: number, baseline: number): number {\r\n  const y = easeInOutBell(x, baseline);\r\n  return -y + 1 + baseline;\r\n}\r\n","import { Types as OhifTypes, PubSubService } from '@ohif/core';\r\nimport {\r\n  cache,\r\n  Enums as csEnums,\r\n  geometryLoader,\r\n  eventTarget,\r\n  getEnabledElementByIds,\r\n  utilities as csUtils,\r\n  volumeLoader,\r\n  StackViewport,\r\n} from '@cornerstonejs/core';\r\nimport {\r\n  Enums as csToolsEnums,\r\n  segmentation as cstSegmentation,\r\n  Types as cstTypes,\r\n  utilities as cstUtils,\r\n} from '@cornerstonejs/tools';\r\nimport isEqual from 'lodash.isequal';\r\nimport { Types as ohifTypes } from '@ohif/core';\r\nimport { easeInOutBell, reverseEaseInOutBell } from '../../utils/transitions';\r\nimport { Segment, Segmentation, SegmentationConfig } from './SegmentationServiceTypes';\r\nimport { mapROIContoursToRTStructData } from './RTSTRUCT/mapROIContoursToRTStructData';\r\n\r\nconst LABELMAP = csToolsEnums.SegmentationRepresentations.Labelmap;\r\nconst CONTOUR = csToolsEnums.SegmentationRepresentations.Contour;\r\n\r\nconst EVENTS = {\r\n  // fired when the segmentation is updated (e.g. when a segment is added, removed, or modified, locked, visibility changed etc.)\r\n  SEGMENTATION_UPDATED: 'event::segmentation_updated',\r\n  // fired when the segmentation data (e.g., labelmap pixels) is modified\r\n  SEGMENTATION_DATA_MODIFIED: 'event::segmentation_data_modified',\r\n  // fired when the segmentation is added to the cornerstone\r\n  SEGMENTATION_ADDED: 'event::segmentation_added',\r\n  // fired when the segmentation is removed\r\n  SEGMENTATION_REMOVED: 'event::segmentation_removed',\r\n  // fired when the configuration for the segmentation is changed (e.g., brush size, render fill, outline thickness, etc.)\r\n  SEGMENTATION_CONFIGURATION_CHANGED: 'event::segmentation_configuration_changed',\r\n  // fired when the active segment is loaded in SEG or RTSTRUCT\r\n  SEGMENT_LOADING_COMPLETE: 'event::segment_loading_complete',\r\n  // loading completed for all segments\r\n  SEGMENTATION_LOADING_COMPLETE: 'event::segmentation_loading_complete',\r\n};\r\n\r\nconst VALUE_TYPES = {};\r\n\r\nconst SEGMENT_CONSTANT = {\r\n  opacity: 255,\r\n  isVisible: true,\r\n  isLocked: false,\r\n};\r\n\r\nconst VOLUME_LOADER_SCHEME = 'cornerstoneStreamingImageVolume';\r\n\r\nclass SegmentationService extends PubSubService {\r\n  static REGISTRATION = {\r\n    name: 'segmentationService',\r\n    altName: 'SegmentationService',\r\n    create: ({ servicesManager }: OhifTypes.Extensions.ExtensionParams): SegmentationService => {\r\n      return new SegmentationService({ servicesManager });\r\n    },\r\n  };\r\n\r\n  segmentations: Record<string, Segmentation>;\r\n  readonly servicesManager: AppTypes.ServicesManager;\r\n  highlightIntervalId = null;\r\n  readonly EVENTS = EVENTS;\r\n\r\n  constructor({ servicesManager }) {\r\n    super(EVENTS);\r\n    this.segmentations = {};\r\n\r\n    this.servicesManager = servicesManager;\r\n\r\n    this._initSegmentationService();\r\n  }\r\n\r\n  public destroy = () => {\r\n    eventTarget.removeEventListener(\r\n      csToolsEnums.Events.SEGMENTATION_MODIFIED,\r\n      this._onSegmentationModifiedFromSource\r\n    );\r\n\r\n    eventTarget.removeEventListener(\r\n      csToolsEnums.Events.SEGMENTATION_DATA_MODIFIED,\r\n      this._onSegmentationDataModified\r\n    );\r\n\r\n    // remove the segmentations from the cornerstone\r\n    Object.keys(this.segmentations).forEach(segmentationId => {\r\n      this._removeSegmentationFromCornerstone(segmentationId);\r\n    });\r\n\r\n    this.segmentations = {};\r\n    this.listeners = {};\r\n  };\r\n\r\n  /**\r\n   * Adds a new segment to the specified segmentation.\r\n   * @param segmentationId - The ID of the segmentation to add the segment to.\r\n   * @param config - An object containing the configuration options for the new segment.\r\n   *   - segmentIndex: (optional) The index of the segment to add. If not provided, the next available index will be used.\r\n   *   - toolGroupId: (optional) The ID of the tool group to associate the new segment with. If not provided, the first available tool group will be used.\r\n   *   - properties: (optional) An object containing the properties of the new segment.\r\n   *     - label: (optional) The label of the new segment. If not provided, a default label will be used.\r\n   *     - color: (optional) The color of the new segment in RGB format. If not provided, a default color will be used.\r\n   *     - opacity: (optional) The opacity of the new segment. If not provided, a default opacity will be used.\r\n   *     - visibility: (optional) Whether the new segment should be visible. If not provided, the segment will be visible by default.\r\n   *     - isLocked: (optional) Whether the new segment should be locked for editing. If not provided, the segment will not be locked by default.\r\n   *     - active: (optional) Whether the new segment should be the active segment to be edited. If not provided, the segment will not be active by default.\r\n   * @param override : true if we want for an already existing segmentIndex to be overriden\r\n   *                    by the new one\r\n   */\r\n  public addSegment(\r\n    segmentationId: string,\r\n    config: {\r\n      segmentIndex?: number;\r\n      toolGroupId?: string;\r\n      properties?: {\r\n        label?: string;\r\n        color?: ohifTypes.RGB;\r\n        opacity?: number;\r\n        visibility?: boolean;\r\n        isLocked?: boolean;\r\n        active?: boolean;\r\n      };\r\n    } = {},\r\n    override = false\r\n  ): void {\r\n    if (config?.segmentIndex === 0) {\r\n      throw new Error('Segment index 0 is reserved for \"no label\"');\r\n    }\r\n\r\n    const toolGroupId = config.toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const { segmentationRepresentationUID, segmentation } = this._getSegmentationInfo(\r\n      segmentationId,\r\n      toolGroupId\r\n    );\r\n\r\n    let segmentIndex = config.segmentIndex;\r\n    if (!segmentIndex) {\r\n      // grab the next available segment index\r\n      segmentIndex = segmentation.segments.length === 0 ? 1 : segmentation.segments.length;\r\n    }\r\n\r\n    while (!override && this._getSegmentInfo(segmentation, segmentIndex)) {\r\n      console.warn(`Segment ${segmentIndex} already exists`);\r\n      segmentIndex++;\r\n    }\r\n\r\n    const rgbaColor = cstSegmentation.config.color.getColorForSegmentIndex(\r\n      toolGroupId,\r\n      segmentationRepresentationUID,\r\n      segmentIndex\r\n    );\r\n\r\n    segmentation.segments[segmentIndex] = {\r\n      label: config.properties?.label ?? `Segment ${segmentIndex}`,\r\n      segmentIndex: segmentIndex,\r\n      color: [rgbaColor[0], rgbaColor[1], rgbaColor[2]],\r\n      opacity: rgbaColor[3],\r\n      isVisible: true,\r\n      isLocked: false,\r\n    };\r\n\r\n    segmentation.segmentCount = segmentation.segments.length - 1;\r\n\r\n    // make the newly added segment the active segment\r\n    this._setActiveSegment(segmentationId, segmentIndex);\r\n\r\n    const suppressEvents = true;\r\n    if (config.properties !== undefined) {\r\n      const { color: newColor, opacity, isLocked, visibility, active } = config.properties;\r\n\r\n      if (newColor !== undefined) {\r\n        this._setSegmentColor(segmentationId, segmentIndex, newColor, toolGroupId, suppressEvents);\r\n      }\r\n\r\n      if (opacity !== undefined) {\r\n        this._setSegmentOpacity(segmentationId, segmentIndex, opacity, toolGroupId, suppressEvents);\r\n      }\r\n\r\n      if (visibility !== undefined) {\r\n        this._setSegmentVisibility(\r\n          segmentationId,\r\n          segmentIndex,\r\n          visibility,\r\n          toolGroupId,\r\n          suppressEvents\r\n        );\r\n      }\r\n\r\n      if (active === true) {\r\n        this._setActiveSegment(segmentationId, segmentIndex, suppressEvents);\r\n      }\r\n\r\n      if (isLocked !== undefined) {\r\n        this._setSegmentLocked(segmentationId, segmentIndex, isLocked, suppressEvents);\r\n      }\r\n    }\r\n\r\n    if (segmentation.activeSegmentIndex === null) {\r\n      this._setActiveSegment(segmentationId, segmentIndex, suppressEvents);\r\n    }\r\n\r\n    // Todo: this includes non-hydrated segmentations which might not be\r\n    // persisted in the store\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n      segmentation,\r\n    });\r\n  }\r\n\r\n  public removeSegment(segmentationId: string, segmentIndex: number): void {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      console.warn(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    if (segmentIndex === 0) {\r\n      throw new Error('Segment index 0 is reserved for \"no label\"');\r\n    }\r\n\r\n    if (!this._getSegmentInfo(segmentation, segmentIndex)) {\r\n      return;\r\n    }\r\n\r\n    segmentation.segmentCount--;\r\n\r\n    segmentation.segments[segmentIndex] = null;\r\n\r\n    // Get volume and delete the labels\r\n    // Todo: handle other segmentations other than labelmap\r\n    const labelmapVolume = this.getLabelmapVolume(segmentationId);\r\n\r\n    const { dimensions } = labelmapVolume;\r\n    const scalarData = labelmapVolume.getScalarData();\r\n\r\n    // Set all values of this segment to zero and get which frames have been edited.\r\n    const frameLength = dimensions[0] * dimensions[1];\r\n    const numFrames = dimensions[2];\r\n\r\n    let voxelIndex = 0;\r\n\r\n    const modifiedFrames = new Set() as Set<number>;\r\n\r\n    for (let frame = 0; frame < numFrames; frame++) {\r\n      for (let p = 0; p < frameLength; p++) {\r\n        if (scalarData[voxelIndex] === segmentIndex) {\r\n          scalarData[voxelIndex] = 0;\r\n          modifiedFrames.add(frame);\r\n        }\r\n\r\n        voxelIndex++;\r\n      }\r\n    }\r\n\r\n    const modifiedFramesArray: number[] = Array.from(modifiedFrames);\r\n\r\n    // Trigger texture update of modified segmentation frames.\r\n    cstSegmentation.triggerSegmentationEvents.triggerSegmentationDataModified(\r\n      segmentationId,\r\n      modifiedFramesArray\r\n    );\r\n\r\n    if (segmentation.activeSegmentIndex === segmentIndex) {\r\n      const segmentIndices = Object.keys(segmentation.segments);\r\n\r\n      const newActiveSegmentIndex = segmentIndices.length ? Number(segmentIndices[0]) : 1;\r\n\r\n      this._setActiveSegment(segmentationId, newActiveSegmentIndex, true);\r\n    }\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n      segmentation,\r\n    });\r\n  }\r\n\r\n  public setSegmentVisibility(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    isVisible: boolean,\r\n    toolGroupId?: string,\r\n    suppressEvents = false\r\n  ): void {\r\n    this._setSegmentVisibility(\r\n      segmentationId,\r\n      segmentIndex,\r\n      isVisible,\r\n      toolGroupId,\r\n      suppressEvents\r\n    );\r\n  }\r\n\r\n  public setSegmentLocked(segmentationId: string, segmentIndex: number, isLocked: boolean): void {\r\n    const suppressEvents = false;\r\n    this._setSegmentLocked(segmentationId, segmentIndex, isLocked, suppressEvents);\r\n  }\r\n\r\n  /**\r\n   * Toggles the locked state of a segment in a segmentation.\r\n   * @param segmentationId - The ID of the segmentation.\r\n   * @param segmentIndex - The index of the segment to toggle.\r\n   */\r\n  public toggleSegmentLocked(segmentationId: string, segmentIndex: number): void {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n    const segment = this._getSegmentInfo(segmentation, segmentIndex);\r\n    const isLocked = !segment.isLocked;\r\n    this._setSegmentLocked(segmentationId, segmentIndex, isLocked);\r\n  }\r\n\r\n  public setSegmentColor(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    color: ohifTypes.RGB,\r\n    toolGroupId?: string\r\n  ): void {\r\n    this._setSegmentColor(segmentationId, segmentIndex, color, toolGroupId);\r\n  }\r\n\r\n  public setSegmentRGBA = (\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    rgbaColor: cstTypes.Color,\r\n    toolGroupId?: string\r\n  ): void => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const suppressEvents = true;\r\n    this._setSegmentOpacity(\r\n      segmentationId,\r\n      segmentIndex,\r\n      rgbaColor[3],\r\n      toolGroupId,\r\n      suppressEvents\r\n    );\r\n\r\n    this._setSegmentColor(\r\n      segmentationId,\r\n      segmentIndex,\r\n      [rgbaColor[0], rgbaColor[1], rgbaColor[2]],\r\n      toolGroupId,\r\n      suppressEvents\r\n    );\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n      segmentation,\r\n    });\r\n  };\r\n\r\n  public setSegmentOpacity(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    opacity: number,\r\n    toolGroupId?: string\r\n  ): void {\r\n    this._setSegmentOpacity(segmentationId, segmentIndex, opacity, toolGroupId);\r\n  }\r\n\r\n  public setActiveSegmentationForToolGroup(segmentationId: string, toolGroupId?: string): void {\r\n    toolGroupId = toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const suppressEvents = false;\r\n    this._setActiveSegmentationForToolGroup(segmentationId, toolGroupId, suppressEvents);\r\n  }\r\n\r\n  public setActiveSegment(segmentationId: string, segmentIndex: number): void {\r\n    this._setActiveSegment(segmentationId, segmentIndex, false);\r\n  }\r\n\r\n  /**\r\n   * Get all segmentations.\r\n   *\r\n   * * @param filterNonHydratedSegmentations - If true, only return hydrated segmentations\r\n   * hydrated segmentations are those that have been loaded and persisted\r\n   * in the state, but non hydrated segmentations are those that are\r\n   * only created for the SEG displayset (SEG viewport) and the user might not\r\n   * have loaded them yet fully.\r\n   *\r\n\r\n   * @return Array of segmentations\r\n   */\r\n  public getSegmentations(filterNonHydratedSegmentations = true): Segmentation[] {\r\n    const segmentations = this._getSegmentations();\r\n\r\n    return (\r\n      segmentations &&\r\n      segmentations.filter(segmentation => {\r\n        return !filterNonHydratedSegmentations || segmentation.hydrated;\r\n      })\r\n    );\r\n  }\r\n\r\n  private _getSegmentations(): Segmentation[] {\r\n    const segmentations = this.arrayOfObjects(this.segmentations);\r\n    return segmentations && segmentations.map(m => this.segmentations[Object.keys(m)[0]]);\r\n  }\r\n\r\n  public getActiveSegmentation(): Segmentation {\r\n    const segmentations = this.getSegmentations();\r\n\r\n    return segmentations.find(segmentation => segmentation.isActive);\r\n  }\r\n\r\n  public getActiveSegment() {\r\n    const activeSegmentation = this.getActiveSegmentation();\r\n    const { activeSegmentIndex, segments } = activeSegmentation;\r\n\r\n    if (activeSegmentIndex === null) {\r\n      return;\r\n    }\r\n\r\n    return segments[activeSegmentIndex];\r\n  }\r\n\r\n  /**\r\n   * Get specific segmentation by its id.\r\n   *\r\n   * @param segmentationId If of the segmentation\r\n   * @return segmentation instance\r\n   */\r\n  public getSegmentation(segmentationId: string): Segmentation {\r\n    return this.segmentations[segmentationId];\r\n  }\r\n\r\n  public getAxialSegmentations(): Segmentation[] {\r\n    const { viewportGridService } = this.servicesManager.services;\r\n\r\n    const displaySetUID = viewportGridService.getDisplaySetsUIDsForViewport('default')[0];\r\n    const segmentations = this.getSegmentations().filter(\r\n      segmentation => segmentation.displaySetInstanceUID === displaySetUID\r\n    );\r\n\r\n    return segmentations;\r\n  }\r\n\r\n  public getDentascanSegmentations(): Segmentation[] {\r\n    const { displaySetService } = this.servicesManager.services;\r\n\r\n    const dentascanDisplaySet = displaySetService.getActiveDisplaySets().find(\r\n      displaySet => displaySet.SeriesInstanceUID.includes('dentascan')\r\n    );\r\n    if (!dentascanDisplaySet) {\r\n      return;\r\n    }\r\n\r\n    const dentascanSegmentations = this.getSegmentations().filter(\r\n      segmentation => segmentation.displaySetInstanceUID === dentascanDisplaySet.displaySetInstanceUID\r\n    );\r\n\r\n    return dentascanSegmentations;\r\n  }\r\n\r\n  public getHiddenSegmentation(segmentationId: string): Segmentation {\r\n    const axialSegmentations = this.getAxialSegmentations();\r\n    const dentascanSegmentations = this.getDentascanSegmentations();\r\n    if (!dentascanSegmentations?.length) {\r\n      return;\r\n    }\r\n\r\n    const axialSegIndex = axialSegmentations.findIndex(segmentation => segmentation.id === segmentationId);\r\n    if (axialSegIndex !== -1) {\r\n      return dentascanSegmentations[axialSegIndex];\r\n    }\r\n\r\n    const dentascanSegIndex = dentascanSegmentations.findIndex(segmentation => segmentation.id === segmentationId);\r\n    if (dentascanSegIndex !== -1) {\r\n      return axialSegmentations[dentascanSegIndex];\r\n    }\r\n  }\r\n\r\n  public addOrUpdateSegmentation(\r\n    segmentation: Segmentation,\r\n    suppressEvents = false,\r\n    notYetUpdatedAtSource = false\r\n  ): string {\r\n    const { id: segmentationId } = segmentation;\r\n    let cachedSegmentation = this.segmentations[segmentationId];\r\n    if (cachedSegmentation) {\r\n      // Update the segmentation (mostly for assigning metadata/labels)\r\n      Object.assign(cachedSegmentation, segmentation);\r\n\r\n      this._updateCornerstoneSegmentations({\r\n        segmentationId,\r\n        notYetUpdatedAtSource,\r\n      });\r\n\r\n      if (!suppressEvents) {\r\n        this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n          segmentation: cachedSegmentation,\r\n        });\r\n      }\r\n\r\n      return segmentationId;\r\n    }\r\n\r\n    const representationType = segmentation.type;\r\n    const representationData = segmentation.representationData[representationType];\r\n    cstSegmentation.addSegmentations([\r\n      {\r\n        segmentationId,\r\n        representation: {\r\n          type: representationType,\r\n          data: {\r\n            ...representationData,\r\n          },\r\n        },\r\n      },\r\n    ]);\r\n\r\n    this.segmentations[segmentationId] = {\r\n      ...segmentation,\r\n      label: segmentation.label || '',\r\n      segments: segmentation.segments || [null],\r\n      activeSegmentIndex: segmentation.activeSegmentIndex ?? null,\r\n      segmentCount: segmentation.segmentCount ?? 0,\r\n      isActive: false,\r\n      isVisible: true,\r\n    };\r\n\r\n    cachedSegmentation = this.segmentations[segmentationId];\r\n\r\n    this._updateCornerstoneSegmentations({\r\n      segmentationId,\r\n      notYetUpdatedAtSource: true,\r\n    });\r\n\r\n    if (!suppressEvents) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_ADDED, {\r\n        segmentation: cachedSegmentation,\r\n      });\r\n    }\r\n\r\n    return cachedSegmentation.id;\r\n  }\r\n\r\n  public async createSegmentationForSEGDisplaySet(\r\n    segDisplaySet,\r\n    segmentationId?: string,\r\n    suppressEvents = false\r\n  ): Promise<string> {\r\n    // Todo: we only support creating labelmap for SEG displaySets for now\r\n    const representationType = LABELMAP;\r\n\r\n    segmentationId = segmentationId ?? segDisplaySet.displaySetInstanceUID;\r\n\r\n    const defaultScheme = this._getDefaultSegmentationScheme();\r\n\r\n    const segmentation: Segmentation = {\r\n      ...defaultScheme,\r\n      id: segmentationId,\r\n      displaySetInstanceUID: segDisplaySet.displaySetInstanceUID,\r\n      type: representationType,\r\n      label: segDisplaySet.SeriesDescription,\r\n      representationData: {\r\n        [LABELMAP]: {\r\n          volumeId: segmentationId,\r\n          referencedVolumeId: segDisplaySet.referencedVolumeId,\r\n        },\r\n      },\r\n    };\r\n\r\n    const labelmap = this.getLabelmapVolume(segmentationId);\r\n    const cachedSegmentation = this.getSegmentation(segmentationId);\r\n    if (labelmap && cachedSegmentation) {\r\n      // if the labelmap with the same segmentationId already exists, we can\r\n      // just assume that the segmentation is already created and move on with\r\n      // updating the state\r\n      return this.addOrUpdateSegmentation(\r\n        Object.assign(segmentation, cachedSegmentation),\r\n        suppressEvents\r\n      );\r\n    }\r\n\r\n    const { labelmapBufferArray, referencedVolumeId } = segDisplaySet;\r\n\r\n    if (!labelmapBufferArray || !referencedVolumeId) {\r\n      throw new Error('No labelmapBufferArray or referencedVolumeId found for the SEG displaySet');\r\n    }\r\n\r\n    // if the labelmap doesn't exist, we need to create it first from the\r\n    // DICOM SEG displaySet data\r\n    const referencedVolume = cache.getVolume(referencedVolumeId);\r\n\r\n    if (!referencedVolume) {\r\n      throw new Error(`No volume found for referencedVolumeId: ${referencedVolumeId}`);\r\n    }\r\n\r\n    // Force use of a Uint8Array SharedArrayBuffer for the segmentation to save space and so\r\n    // it is easily compressible in worker thread.\r\n    const derivedVolume = await volumeLoader.createAndCacheDerivedVolume(referencedVolumeId, {\r\n      volumeId: segmentationId,\r\n      targetBuffer: {\r\n        type: 'Uint8Array',\r\n        sharedArrayBuffer: window.SharedArrayBuffer,\r\n      },\r\n    });\r\n    const derivedVolumeScalarData = derivedVolume.getScalarData();\r\n\r\n    const segmentsInfo = segDisplaySet.segMetadata.data;\r\n    derivedVolumeScalarData.set(new Uint8Array(labelmapBufferArray[0]));\r\n\r\n    segmentation.segments = segmentsInfo.map((segmentInfo, segmentIndex) => {\r\n      if (segmentIndex === 0) {\r\n        return;\r\n      }\r\n\r\n      const {\r\n        SegmentedPropertyCategoryCodeSequence,\r\n        SegmentNumber,\r\n        SegmentLabel,\r\n        SegmentAlgorithmType,\r\n        SegmentAlgorithmName,\r\n        SegmentedPropertyTypeCodeSequence,\r\n        rgba,\r\n      } = segmentInfo;\r\n\r\n      const { x, y, z } = segDisplaySet.centroids.get(segmentIndex) || { x: 0, y: 0, z: 0 };\r\n      const centerWorld = derivedVolume.imageData.indexToWorld([x, y, z]);\r\n\r\n      segmentation.cachedStats = {\r\n        ...segmentation.cachedStats,\r\n        segmentCenter: {\r\n          ...segmentation.cachedStats.segmentCenter,\r\n          [segmentIndex]: {\r\n            center: {\r\n              image: [x, y, z],\r\n              world: centerWorld,\r\n            },\r\n            modifiedTime: segDisplaySet.SeriesDate,\r\n          },\r\n        },\r\n      };\r\n\r\n      return {\r\n        label: SegmentLabel || `Segment ${SegmentNumber}`,\r\n        segmentIndex: Number(SegmentNumber),\r\n        category: SegmentedPropertyCategoryCodeSequence\r\n          ? SegmentedPropertyCategoryCodeSequence.CodeMeaning\r\n          : '',\r\n        type: SegmentedPropertyTypeCodeSequence\r\n          ? SegmentedPropertyTypeCodeSequence.CodeMeaning\r\n          : '',\r\n        algorithmType: SegmentAlgorithmType,\r\n        algorithmName: SegmentAlgorithmName,\r\n        color: rgba,\r\n        opacity: 255,\r\n        isVisible: true,\r\n        isLocked: false,\r\n      };\r\n    });\r\n\r\n    segmentation.segmentCount = segmentsInfo.length - 1;\r\n\r\n    segDisplaySet.isLoaded = true;\r\n\r\n    this._broadcastEvent(EVENTS.SEGMENTATION_LOADING_COMPLETE, {\r\n      segmentationId,\r\n      segDisplaySet,\r\n    });\r\n\r\n    return this.addOrUpdateSegmentation(segmentation, suppressEvents);\r\n  }\r\n\r\n  public async createSegmentationForRTDisplaySet(\r\n    rtDisplaySet,\r\n    segmentationId?: string,\r\n    suppressEvents = false\r\n  ): Promise<string> {\r\n    // Todo: we currently only have support for contour representation for initial\r\n    // RT display\r\n    const representationType = CONTOUR;\r\n    segmentationId = segmentationId ?? rtDisplaySet.displaySetInstanceUID;\r\n    const { structureSet } = rtDisplaySet;\r\n\r\n    if (!structureSet) {\r\n      throw new Error(\r\n        'To create the contours from RT displaySet, the displaySet should be loaded first, you can perform rtDisplaySet.load() before calling this method.'\r\n      );\r\n    }\r\n\r\n    const defaultScheme = this._getDefaultSegmentationScheme();\r\n    const rtDisplaySetUID = rtDisplaySet.displaySetInstanceUID;\r\n\r\n    const allRTStructData = mapROIContoursToRTStructData(structureSet, rtDisplaySetUID);\r\n\r\n    // sort by segmentIndex\r\n    allRTStructData.sort((a, b) => a.segmentIndex - b.segmentIndex);\r\n\r\n    const geometryIds = allRTStructData.map(({ geometryId }) => geometryId);\r\n\r\n    const segmentation: Segmentation = {\r\n      ...defaultScheme,\r\n      id: segmentationId,\r\n      displaySetInstanceUID: rtDisplaySetUID,\r\n      type: representationType,\r\n      label: rtDisplaySet.SeriesDescription,\r\n      representationData: {\r\n        [CONTOUR]: {\r\n          geometryIds,\r\n        },\r\n      },\r\n    };\r\n\r\n    const cachedSegmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (cachedSegmentation) {\r\n      // if the labelmap with the same segmentationId already exists, we can\r\n      // just assume that the segmentation is already created and move on with\r\n      // updating the state\r\n      return this.addOrUpdateSegmentation(\r\n        Object.assign(segmentation, cachedSegmentation),\r\n        suppressEvents\r\n      );\r\n    }\r\n\r\n    if (!structureSet.ROIContours?.length) {\r\n      throw new Error(\r\n        'The structureSet does not contain any ROIContours. Please ensure the structureSet is loaded first.'\r\n      );\r\n    }\r\n    const segmentsCachedStats = {};\r\n    const initializeContour = async rtStructData => {\r\n      const { data, id, color, segmentIndex, geometryId } = rtStructData;\r\n\r\n      // catch error instead of failing to allow loading to continue\r\n      try {\r\n        const geometry = await geometryLoader.createAndCacheGeometry(geometryId, {\r\n          geometryData: {\r\n            data,\r\n            id,\r\n            color,\r\n            frameOfReferenceUID: structureSet.frameOfReferenceUID,\r\n            segmentIndex,\r\n          },\r\n          type: csEnums.GeometryType.CONTOUR,\r\n        });\r\n\r\n        const contourSet = geometry.data;\r\n        const centroid = contourSet.getCentroid();\r\n\r\n        segmentsCachedStats[segmentIndex] = {\r\n          center: { world: centroid },\r\n          modifiedTime: rtDisplaySet.SeriesDate, // we use the SeriesDate as the modifiedTime since this is the first time we are creating the segmentation\r\n        };\r\n\r\n        segmentation.segments[segmentIndex] = {\r\n          label: id,\r\n          segmentIndex,\r\n          color,\r\n          ...SEGMENT_CONSTANT,\r\n        };\r\n\r\n        const numInitialized = Object.keys(segmentsCachedStats).length;\r\n\r\n        // Calculate percentage completed\r\n        const percentComplete = Math.round((numInitialized / allRTStructData.length) * 100);\r\n\r\n        this._broadcastEvent(EVENTS.SEGMENT_LOADING_COMPLETE, {\r\n          percentComplete,\r\n          // Note: this is not the geometryIds length since there might be\r\n          // some missing ROINumbers\r\n          numSegments: allRTStructData.length,\r\n        });\r\n      } catch (e) {\r\n        console.warn(e);\r\n      }\r\n    };\r\n\r\n    const promiseArray = [];\r\n\r\n    for (let i = 0; i < allRTStructData.length; i++) {\r\n      const promise = new Promise<void>((resolve, reject) => {\r\n        setTimeout(() => {\r\n          initializeContour(allRTStructData[i]).then(() => {\r\n            resolve();\r\n          });\r\n        }, 0);\r\n      });\r\n\r\n      promiseArray.push(promise);\r\n    }\r\n\r\n    await Promise.all(promiseArray);\r\n\r\n    segmentation.segmentCount = allRTStructData.length;\r\n    rtDisplaySet.isLoaded = true;\r\n\r\n    segmentation.cachedStats = {\r\n      ...segmentation.cachedStats,\r\n      segmentCenter: {\r\n        ...segmentation.cachedStats.segmentCenter,\r\n        ...segmentsCachedStats,\r\n      },\r\n    };\r\n\r\n    this._broadcastEvent(EVENTS.SEGMENTATION_LOADING_COMPLETE, {\r\n      segmentationId,\r\n      rtDisplaySet,\r\n    });\r\n\r\n    return this.addOrUpdateSegmentation(segmentation, suppressEvents);\r\n  }\r\n\r\n  // Todo: this should not run on the main thread\r\n  public calculateCentroids = (\r\n    segmentationId: string,\r\n    segmentIndex?: number\r\n  ): Map<number, { x: number; y: number; z: number; world: number[] }> => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n    const volume = this.getLabelmapVolume(segmentationId);\r\n    const { dimensions, imageData } = volume;\r\n    const scalarData = volume.getScalarData();\r\n    const [dimX, dimY, numFrames] = dimensions;\r\n    const frameLength = dimX * dimY;\r\n\r\n    const segmentIndices = segmentIndex\r\n      ? [segmentIndex]\r\n      : segmentation.segments\r\n        .filter(segment => segment?.segmentIndex)\r\n        .map(segment => segment.segmentIndex);\r\n\r\n    const segmentIndicesSet = new Set(segmentIndices);\r\n\r\n    const centroids = new Map();\r\n    for (const index of segmentIndicesSet) {\r\n      centroids.set(index, { x: 0, y: 0, z: 0, count: 0 });\r\n    }\r\n\r\n    let voxelIndex = 0;\r\n    for (let frame = 0; frame < numFrames; frame++) {\r\n      for (let p = 0; p < frameLength; p++) {\r\n        const segmentIndex = scalarData[voxelIndex++];\r\n        if (segmentIndicesSet.has(segmentIndex)) {\r\n          const centroid = centroids.get(segmentIndex);\r\n          centroid.x += p % dimX;\r\n          centroid.y += (p / dimX) | 0;\r\n          centroid.z += frame;\r\n          centroid.count++;\r\n        }\r\n      }\r\n    }\r\n\r\n    const result = new Map();\r\n    for (const [index, centroid] of centroids) {\r\n      const count = centroid.count;\r\n      const normalizedCentroid = {\r\n        x: centroid.x / count,\r\n        y: centroid.y / count,\r\n        z: centroid.z / count,\r\n      };\r\n      normalizedCentroid.world = imageData.indexToWorld([\r\n        normalizedCentroid.x,\r\n        normalizedCentroid.y,\r\n        normalizedCentroid.z,\r\n      ]);\r\n      result.set(index, normalizedCentroid);\r\n    }\r\n\r\n    this.setCentroids(segmentationId, result);\r\n    return result;\r\n  };\r\n\r\n  private setCentroids = (\r\n    segmentationId: string,\r\n    centroids: Map<number, { image: number[]; world?: number[] }>\r\n  ): void => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n    const imageData = this.getLabelmapVolume(segmentationId).imageData; // Assuming this method returns imageData\r\n\r\n    if (!segmentation.cachedStats) {\r\n      segmentation.cachedStats = { segmentCenter: {} };\r\n    } else if (!segmentation.cachedStats.segmentCenter) {\r\n      segmentation.cachedStats.segmentCenter = {};\r\n    }\r\n\r\n    for (const [segmentIndex, centroid] of centroids) {\r\n      let world = centroid.world;\r\n\r\n      // If world coordinates are not provided, calculate them\r\n      if (!world || world.length === 0) {\r\n        world = imageData.indexToWorld(centroid.image);\r\n      }\r\n\r\n      segmentation.cachedStats.segmentCenter[segmentIndex] = {\r\n        center: {\r\n          image: centroid.image,\r\n          world: world,\r\n        },\r\n      };\r\n    }\r\n\r\n    this.addOrUpdateSegmentation(segmentation, true, true);\r\n  };\r\n\r\n  public jumpToSegmentCenter(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    toolGroupId?: string,\r\n    highlightAlpha = 0.9,\r\n    highlightSegment = true,\r\n    animationLength = 750,\r\n    highlightHideOthers = false,\r\n    highlightFunctionType = 'ease-in-out' // todo: make animation functions configurable from outside\r\n  ): void {\r\n    const { toolGroupService } = this.servicesManager.services;\r\n    const center = this._getSegmentCenter(segmentationId, segmentIndex);\r\n\r\n    if (!center?.world) {\r\n      return;\r\n    }\r\n\r\n    const { world } = center;\r\n\r\n    // todo: generalize\r\n    toolGroupId = toolGroupId || this._getToolGroupIdsWithSegmentation(segmentationId);\r\n\r\n    const toolGroups = [];\r\n\r\n    if (Array.isArray(toolGroupId)) {\r\n      toolGroupId.forEach(toolGroup => {\r\n        toolGroups.push(toolGroupService.getToolGroup(toolGroup));\r\n      });\r\n    } else {\r\n      toolGroups.push(toolGroupService.getToolGroup(toolGroupId));\r\n    }\r\n\r\n    toolGroups.forEach(toolGroup => {\r\n      const viewportsInfo = toolGroup.getViewportsInfo();\r\n\r\n      // @ts-ignore\r\n      for (const { viewportId, renderingEngineId } of viewportsInfo) {\r\n        const { viewport } = getEnabledElementByIds(viewportId, renderingEngineId);\r\n        if (viewport instanceof StackViewport) {\r\n          const { element } = viewport;\r\n          const index = csUtils.getClosestStackImageIndexForPoint(world, viewport)\r\n          cstUtils.viewport.jumpToSlice(element, { imageIndex: index })\r\n        } else {\r\n          cstUtils.viewport.jumpToWorld(viewport, world);\r\n        }\r\n      }\r\n\r\n      if (highlightSegment) {\r\n        this.highlightSegment(\r\n          segmentationId,\r\n          segmentIndex,\r\n          toolGroup.id,\r\n          highlightAlpha,\r\n          animationLength,\r\n          highlightHideOthers,\r\n          highlightFunctionType\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  public highlightSegment(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    toolGroupId?: string,\r\n    alpha = 0.9,\r\n    animationLength = 750,\r\n    hideOthers = true,\r\n    highlightFunctionType = 'ease-in-out'\r\n  ): void {\r\n    if (this.highlightIntervalId) {\r\n      clearInterval(this.highlightIntervalId);\r\n    }\r\n\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n    toolGroupId = toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const segmentationRepresentation = this._getSegmentationRepresentation(\r\n      segmentationId,\r\n      toolGroupId\r\n    );\r\n\r\n    const { type } = segmentationRepresentation;\r\n    const { segments } = segmentation;\r\n\r\n    const highlightFn =\r\n      type === LABELMAP ? this._highlightLabelmap.bind(this) : this._highlightContour.bind(this);\r\n\r\n    const adjustedAlpha = type === LABELMAP ? alpha : 1 - alpha;\r\n\r\n    highlightFn(\r\n      segmentIndex,\r\n      adjustedAlpha,\r\n      hideOthers,\r\n      segments,\r\n      toolGroupId,\r\n      animationLength,\r\n      segmentationRepresentation\r\n    );\r\n  }\r\n\r\n  public createSegmentationForDisplaySet = async (\r\n    displaySetInstanceUID: string,\r\n    options?: {\r\n      segmentationId: string;\r\n      FrameOfReferenceUID: string;\r\n      label: string;\r\n    }\r\n  ): Promise<string> => {\r\n    const { displaySetService } = this.servicesManager.services;\r\n\r\n    const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n    // Todo: we currently only support labelmap for segmentation for a displaySet\r\n    const representationType = LABELMAP;\r\n\r\n    const volumeId = this._getVolumeIdForDisplaySet(displaySet);\r\n\r\n    const segmentationId = options?.segmentationId ?? `${csUtils.uuidv4()}`;\r\n\r\n    // Force use of a Uint8Array SharedArrayBuffer for the segmentation to save space and so\r\n    // it is easily compressible in worker thread.\r\n    await volumeLoader.createAndCacheDerivedSegmentationVolume(volumeId, {\r\n      volumeId: segmentationId,\r\n      targetBuffer: {\r\n        type: 'Uint8Array',\r\n        sharedArrayBuffer: window.SharedArrayBuffer,\r\n      },\r\n    });\r\n\r\n    const defaultScheme = this._getDefaultSegmentationScheme();\r\n\r\n    const segmentation: Segmentation = {\r\n      ...defaultScheme,\r\n      id: segmentationId,\r\n      displaySetInstanceUID,\r\n      label: options?.label,\r\n      // We should set it as active by default, as it created for display\r\n      isActive: true,\r\n      type: representationType,\r\n      FrameOfReferenceUID:\r\n        options?.FrameOfReferenceUID || displaySet.instances?.[0]?.FrameOfReferenceUID,\r\n      representationData: {\r\n        LABELMAP: {\r\n          volumeId: segmentationId,\r\n          referencedVolumeId: volumeId, // Todo: this is so ugly\r\n        },\r\n      },\r\n      description: `S${displaySet.SeriesNumber}: ${displaySet.SeriesDescription}`,\r\n    };\r\n\r\n    this.addOrUpdateSegmentation(segmentation);\r\n\r\n    return segmentationId;\r\n  };\r\n\r\n  /**\r\n   * Toggles the visibility of a segmentation in the state, and broadcasts the event.\r\n   * Note: this method does not update the segmentation state in the source. It only\r\n   * updates the state, and there should be separate listeners for that.\r\n   * @param ids segmentation ids\r\n   */\r\n  public toggleSegmentationVisibility = (segmentationId: string): void => {\r\n    this._toggleSegmentationVisibility(segmentationId, false);\r\n  };\r\n\r\n  public addSegmentationRepresentationToToolGroup = async (\r\n    toolGroupId: string,\r\n    segmentationId: string,\r\n    hydrateSegmentation = true,\r\n    representationType = csToolsEnums.SegmentationRepresentations.Labelmap,\r\n    suppressEvents = false\r\n  ): Promise<void> => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    toolGroupId = toolGroupId || this._getApplicableToolGroupId();\r\n\r\n    if (!segmentation) {\r\n      throw new Error(`Segmentation with segmentationId ${segmentationId} not found.`);\r\n    }\r\n\r\n    if (hydrateSegmentation) {\r\n      // hydrate the segmentation if it's not hydrated yet\r\n      segmentation.hydrated = true;\r\n    }\r\n\r\n    // Based on the segmentationId, set the colorLUTIndex.\r\n    const segmentationRepresentationUIDs = await cstSegmentation.addSegmentationRepresentations(\r\n      toolGroupId,\r\n      [\r\n        {\r\n          segmentationId,\r\n          type: representationType,\r\n        },\r\n      ]\r\n    );\r\n\r\n    // set the latest segmentation representation as active one\r\n    this._setActiveSegmentationForToolGroup(\r\n      segmentationId,\r\n      toolGroupId,\r\n      segmentationRepresentationUIDs[0]\r\n    );\r\n\r\n    // add the segmentation segments properly\r\n    for (const segment of segmentation.segments) {\r\n      if (segment === null || segment === undefined) {\r\n        continue;\r\n      }\r\n\r\n      const { segmentIndex, color, isLocked, isVisible: visibility, opacity } = segment;\r\n\r\n      const suppressEvents = true;\r\n\r\n      if (color !== undefined) {\r\n        this._setSegmentColor(segmentationId, segmentIndex, color, toolGroupId, suppressEvents);\r\n      }\r\n\r\n      if (opacity !== undefined) {\r\n        this._setSegmentOpacity(segmentationId, segmentIndex, opacity, toolGroupId, suppressEvents);\r\n      }\r\n\r\n      if (visibility !== undefined) {\r\n        this._setSegmentVisibility(\r\n          segmentationId,\r\n          segmentIndex,\r\n          visibility,\r\n          toolGroupId,\r\n          suppressEvents\r\n        );\r\n      }\r\n\r\n      if (isLocked) {\r\n        this._setSegmentLocked(segmentationId, segmentIndex, isLocked, suppressEvents);\r\n      }\r\n    }\r\n\r\n    if (!suppressEvents) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  };\r\n\r\n  public setSegmentRGBAColor = (\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    rgbaColor,\r\n    toolGroupId?: string\r\n  ) => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    this._setSegmentOpacity(\r\n      segmentationId,\r\n      segmentIndex,\r\n      rgbaColor[3],\r\n      toolGroupId, // toolGroupId\r\n      true\r\n    );\r\n    this._setSegmentColor(\r\n      segmentationId,\r\n      segmentIndex,\r\n      [rgbaColor[0], rgbaColor[1], rgbaColor[2]],\r\n      toolGroupId, // toolGroupId\r\n      true\r\n    );\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n      segmentation,\r\n    });\r\n  };\r\n\r\n  public getToolGroupIdsWithSegmentation = (segmentationId: string): string[] => {\r\n    const toolGroupIds = cstSegmentation.state.getToolGroupIdsWithSegmentation(segmentationId);\r\n    return toolGroupIds;\r\n  };\r\n\r\n  public hydrateSegmentation = (segmentationId: string, suppressEvents = false): void => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (!segmentation) {\r\n      throw new Error(`Segmentation with segmentationId ${segmentationId} not found.`);\r\n    }\r\n    segmentation.hydrated = true;\r\n\r\n    // Not all segmentations have dipslaysets, some of them are derived in the client\r\n    this._setDisplaySetIsHydrated(segmentationId, true);\r\n\r\n    if (!suppressEvents) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  };\r\n\r\n  private _setDisplaySetIsHydrated(displaySetUID: string, isHydrated: boolean): void {\r\n    const { displaySetService } = this.servicesManager.services;\r\n    const displaySet = displaySetService.getDisplaySetByUID(displaySetUID);\r\n\r\n    if (!displaySet) {\r\n      return;\r\n    }\r\n\r\n    displaySet.isHydrated = isHydrated;\r\n    displaySetService.setDisplaySetMetadataInvalidated(displaySetUID, false);\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n      segmentation: this.getSegmentation(displaySetUID),\r\n    });\r\n  }\r\n\r\n  private _highlightLabelmap(\r\n    segmentIndex: number,\r\n    alpha: number,\r\n    hideOthers: boolean,\r\n    segments: Segment[],\r\n    toolGroupId: string,\r\n    animationLength: number,\r\n    segmentationRepresentation: cstTypes.ToolGroupSpecificRepresentation\r\n  ) {\r\n    const newSegmentSpecificConfig = {\r\n      [segmentIndex]: {\r\n        LABELMAP: {\r\n          fillAlpha: alpha,\r\n        },\r\n      },\r\n    };\r\n\r\n    if (hideOthers) {\r\n      for (let i = 0; i < segments.length; i++) {\r\n        if (i !== segmentIndex) {\r\n          newSegmentSpecificConfig[i] = {\r\n            LABELMAP: {\r\n              fillAlpha: 0,\r\n            },\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    const { fillAlpha } = this.getConfiguration(toolGroupId);\r\n\r\n    let startTime: number = null;\r\n    const animation = (timestamp: number) => {\r\n      if (startTime === null) {\r\n        startTime = timestamp;\r\n      }\r\n\r\n      const elapsed = timestamp - startTime;\r\n      const progress = Math.min(elapsed / animationLength, 1);\r\n\r\n      cstSegmentation.config.setSegmentSpecificConfig(\r\n        toolGroupId,\r\n        segmentationRepresentation.segmentationRepresentationUID,\r\n        {\r\n          [segmentIndex]: {\r\n            LABELMAP: {\r\n              fillAlpha: easeInOutBell(progress, fillAlpha),\r\n            },\r\n          },\r\n        }\r\n      );\r\n\r\n      if (progress < 1) {\r\n        requestAnimationFrame(animation);\r\n      } else {\r\n        cstSegmentation.config.setSegmentSpecificConfig(\r\n          toolGroupId,\r\n          segmentationRepresentation.segmentationRepresentationUID,\r\n          {}\r\n        );\r\n      }\r\n    };\r\n\r\n    requestAnimationFrame(animation);\r\n  }\r\n\r\n  private _highlightContour(\r\n    segmentIndex: number,\r\n    alpha: number,\r\n    hideOthers: boolean,\r\n    segments: Segment[],\r\n    toolGroupId: string,\r\n    animationLength: number,\r\n    segmentationRepresentation: cstTypes.ToolGroupSpecificRepresentation\r\n  ) {\r\n    const startTime = performance.now();\r\n\r\n    const animate = (currentTime: number) => {\r\n      const progress = (currentTime - startTime) / animationLength;\r\n      if (progress >= 1) {\r\n        cstSegmentation.config.setSegmentSpecificConfig(\r\n          toolGroupId,\r\n          segmentationRepresentation.segmentationRepresentationUID,\r\n          {}\r\n        );\r\n        return;\r\n      }\r\n\r\n      const reversedProgress = reverseEaseInOutBell(progress, 0.1);\r\n      cstSegmentation.config.setSegmentSpecificConfig(\r\n        toolGroupId,\r\n        segmentationRepresentation.segmentationRepresentationUID,\r\n        {\r\n          [segmentIndex]: {\r\n            CONTOUR: {\r\n              outlineOpacity: reversedProgress,\r\n              fillAlpha: reversedProgress,\r\n            },\r\n          },\r\n        }\r\n      );\r\n\r\n      requestAnimationFrame(animate);\r\n    };\r\n\r\n    requestAnimationFrame(animate);\r\n  }\r\n\r\n  public removeSegmentationRepresentationFromToolGroup(\r\n    toolGroupId: string,\r\n    segmentationRepresentationUIDsIds?: string[]\r\n  ): void {\r\n    const uids = segmentationRepresentationUIDsIds || [];\r\n    if (!uids.length) {\r\n      const representations = cstSegmentation.state.getSegmentationRepresentations(toolGroupId);\r\n\r\n      if (!representations || !representations.length) {\r\n        return;\r\n      }\r\n\r\n      uids.push(...representations.map(rep => rep.segmentationRepresentationUID));\r\n    }\r\n\r\n    cstSegmentation.removeSegmentationsFromToolGroup(toolGroupId, uids);\r\n  }\r\n\r\n  /**\r\n   * Removes a segmentation and broadcasts the removed event.\r\n   *\r\n   * @param {string} segmentationId The segmentation id\r\n   */\r\n  public remove(segmentationId: string): void {\r\n    const segmentation = this.segmentations[segmentationId];\r\n    const wasActive = segmentation.isActive;\r\n\r\n    if (!segmentationId || !segmentation) {\r\n      console.warn(`No segmentationId provided, or unable to find segmentation by id.`);\r\n      return;\r\n    }\r\n\r\n    const { colorLUTIndex } = segmentation;\r\n    const { updatedToolGroupIds } = this._removeSegmentationFromCornerstone(segmentationId);\r\n\r\n    // Delete associated colormap\r\n    // Todo: bring this back\r\n    cstSegmentation.state.removeColorLUT(colorLUTIndex);\r\n\r\n    delete this.segmentations[segmentationId];\r\n\r\n    // If this segmentation was active, and there is another segmentation, set another one active.\r\n\r\n    if (wasActive) {\r\n      // Only consider visible segmentations\r\n      const remainingSegmentations = this.getSegmentations().filter(\r\n        remainingSegmentation => remainingSegmentation.displaySetInstanceUID === segmentation.displaySetInstanceUID\r\n      );\r\n\r\n      const remainingHydratedSegmentations = remainingSegmentations.filter(\r\n        segmentation => segmentation.hydrated\r\n      );\r\n\r\n      if (remainingHydratedSegmentations.length) {\r\n        const { id } = remainingHydratedSegmentations[0];\r\n\r\n        updatedToolGroupIds.forEach(toolGroupId => {\r\n          this._setActiveSegmentationForToolGroup(id, toolGroupId, false);\r\n        });\r\n      }\r\n    }\r\n\r\n    this._setDisplaySetIsHydrated(segmentationId, false);\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_REMOVED, {\r\n      segmentationId,\r\n    });\r\n  }\r\n\r\n  public getConfiguration = (toolGroupId?: string): SegmentationConfig => {\r\n    toolGroupId = toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const brushSize = 1;\r\n    // const brushSize = cstUtils.segmentation.getBrushSizeForToolGroup(\r\n    //   toolGroupId\r\n    // );\r\n\r\n    const brushThresholdGate = 1;\r\n    // const brushThresholdGate = cstUtils.segmentation.getBrushThresholdForToolGroup(\r\n    //   toolGroupId\r\n    // );\r\n\r\n    const segmentationRepresentations =\r\n      this.getSegmentationRepresentationsForToolGroup(toolGroupId);\r\n\r\n    const typeToUse = segmentationRepresentations?.[0]?.type || LABELMAP;\r\n\r\n    const config = cstSegmentation.config.getGlobalConfig();\r\n    const { renderInactiveSegmentations } = config;\r\n\r\n    const representation = config.representations[typeToUse];\r\n\r\n    const {\r\n      renderOutline,\r\n      outlineWidthActive,\r\n      renderFill,\r\n      fillAlpha,\r\n      fillAlphaInactive,\r\n      outlineOpacity,\r\n      outlineOpacityInactive,\r\n    } = representation;\r\n\r\n    return {\r\n      brushSize,\r\n      brushThresholdGate,\r\n      fillAlpha,\r\n      fillAlphaInactive,\r\n      outlineWidthActive,\r\n      renderFill,\r\n      renderInactiveSegmentations,\r\n      renderOutline,\r\n      outlineOpacity,\r\n      outlineOpacityInactive,\r\n    };\r\n  };\r\n\r\n  public setConfiguration = (configuration: SegmentationConfig): void => {\r\n    const {\r\n      fillAlpha,\r\n      fillAlphaInactive,\r\n      outlineWidthActive,\r\n      outlineOpacity,\r\n      renderFill,\r\n      renderInactiveSegmentations,\r\n      renderOutline,\r\n    } = configuration;\r\n\r\n    const setConfigValueIfDefined = (key, value, transformFn = null) => {\r\n      if (value !== undefined) {\r\n        const transformedValue = transformFn ? transformFn(value) : value;\r\n        this._setSegmentationConfig(key, transformedValue);\r\n      }\r\n    };\r\n\r\n    setConfigValueIfDefined('renderOutline', renderOutline);\r\n    setConfigValueIfDefined('outlineWidthActive', outlineWidthActive);\r\n    setConfigValueIfDefined('outlineOpacity', outlineOpacity, v => v / 100);\r\n    setConfigValueIfDefined('fillAlpha', fillAlpha, v => v / 100);\r\n    setConfigValueIfDefined('renderFill', renderFill);\r\n    setConfigValueIfDefined('fillAlphaInactive', fillAlphaInactive, v => v / 100);\r\n    setConfigValueIfDefined('outlineOpacityInactive', fillAlphaInactive, v =>\r\n      Math.max(0.75, v / 100)\r\n    );\r\n\r\n    if (renderInactiveSegmentations !== undefined) {\r\n      const config = cstSegmentation.config.getGlobalConfig();\r\n      config.renderInactiveSegmentations = renderInactiveSegmentations;\r\n      cstSegmentation.config.setGlobalConfig(config);\r\n    }\r\n\r\n    // if (brushSize !== undefined) {\r\n    //   const { toolGroupService } = this.servicesManager.services;\r\n\r\n    //   const toolGroupIds = toolGroupService.getToolGroupIds();\r\n\r\n    //   toolGroupIds.forEach(toolGroupId => {\r\n    //     cstUtils.segmentation.setBrushSizeForToolGroup(toolGroupId, brushSize);\r\n    //   });\r\n    // }\r\n\r\n    // if (brushThresholdGate !== undefined) {\r\n    //   const { toolGroupService } = this.servicesManager.services;\r\n\r\n    //   const toolGroupIds = toolGroupService.getFirstToolGroupIds();\r\n\r\n    //   toolGroupIds.forEach(toolGroupId => {\r\n    //     cstUtils.segmentation.setBrushThresholdForToolGroup(\r\n    //       toolGroupId,\r\n    //       brushThresholdGate\r\n    //     );\r\n    //   });\r\n    // }\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_CONFIGURATION_CHANGED, this.getConfiguration());\r\n  };\r\n\r\n  public getLabelmapVolume = (segmentationId: string) => {\r\n    return cache.getVolume(segmentationId);\r\n  };\r\n\r\n  public getSegmentationRepresentationsForToolGroup = toolGroupId => {\r\n    return cstSegmentation.state.getSegmentationRepresentations(toolGroupId);\r\n  };\r\n\r\n  public setSegmentLabel(segmentationId: string, segmentIndex: number, label: string) {\r\n    this._setSegmentLabel(segmentationId, segmentIndex, label);\r\n  }\r\n\r\n  private _setSegmentLabel(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    label: string,\r\n    suppressEvents = false\r\n  ) {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const segmentInfo = segmentation.segments[segmentIndex];\r\n\r\n    if (segmentInfo === undefined) {\r\n      throw new Error(`Segment ${segmentIndex} not yet added to segmentation: ${segmentationId}`);\r\n    }\r\n\r\n    segmentInfo.label = label;\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  }\r\n\r\n  public shouldRenderSegmentation(viewportDisplaySetInstanceUIDs, segmentationFrameOfReferenceUID) {\r\n    if (!viewportDisplaySetInstanceUIDs?.length) {\r\n      return false;\r\n    }\r\n\r\n    const { displaySetService } = this.servicesManager.services;\r\n\r\n    let shouldDisplaySeg = false;\r\n\r\n    // check if the displaySet is sharing the same frameOfReferenceUID\r\n    // with the new segmentation\r\n    for (const displaySetInstanceUID of viewportDisplaySetInstanceUIDs) {\r\n      const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n      // Todo: this might not be ideal for use cases such as 4D, since we\r\n      // don't want to show the segmentation for all the frames\r\n      if (\r\n        displaySet.isReconstructable &&\r\n        displaySet?.images?.[0]?.FrameOfReferenceUID === segmentationFrameOfReferenceUID\r\n      ) {\r\n        shouldDisplaySeg = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return shouldDisplaySeg;\r\n  }\r\n\r\n  private _getDefaultSegmentationScheme() {\r\n    return {\r\n      activeSegmentIndex: 1,\r\n      cachedStats: {},\r\n      label: '',\r\n      segmentsLocked: [],\r\n      displayText: [],\r\n      hydrated: false, // by default we don't hydrate the segmentation for SEG displaySets\r\n      segmentCount: 0,\r\n      segments: [],\r\n      isVisible: true,\r\n      isActive: false,\r\n    };\r\n  }\r\n\r\n  private _setActiveSegmentationForToolGroup(\r\n    segmentationId: string,\r\n    toolGroupId: string,\r\n    suppressEvents = false\r\n  ) {\r\n    const segmentations = this._getSegmentations();\r\n    const targetSegmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (targetSegmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    segmentations.forEach(segmentation => {\r\n      segmentation.isActive = segmentation.id === segmentationId;\r\n    });\r\n\r\n    const representation = this._getSegmentationRepresentation(segmentationId, toolGroupId);\r\n\r\n    cstSegmentation.activeSegmentation.setActiveSegmentationRepresentation(\r\n      toolGroupId,\r\n      representation.segmentationRepresentationUID\r\n    );\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation: targetSegmentation,\r\n      });\r\n    }\r\n  }\r\n\r\n  private _toggleSegmentationVisibility = (segmentationId: string, suppressEvents = false) => {\r\n    const segmentation = this.segmentations[segmentationId];\r\n\r\n    if (!segmentation) {\r\n      throw new Error(`Segmentation with segmentationId ${segmentationId} not found.`);\r\n    }\r\n\r\n    segmentation.isVisible = !segmentation.isVisible;\r\n\r\n    this._updateCornerstoneSegmentationVisibility(segmentationId);\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  };\r\n\r\n  private _setActiveSegment(segmentationId: string, segmentIndex: number, suppressEvents = false) {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    cstSegmentation.segmentIndex.setActiveSegmentIndex(segmentationId, segmentIndex);\r\n\r\n    segmentation.activeSegmentIndex = segmentIndex;\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  }\r\n\r\n  private _getSegmentInfo(segmentation: Segmentation, segmentIndex: number) {\r\n    const segments = segmentation.segments;\r\n\r\n    if (!segments) {\r\n      return;\r\n    }\r\n\r\n    if (segments && segments.length > 0) {\r\n      return segments[segmentIndex];\r\n    }\r\n  }\r\n\r\n  private _getVolumeIdForDisplaySet(displaySet) {\r\n    const volumeLoaderSchema = displaySet.volumeLoaderSchema ?? VOLUME_LOADER_SCHEME;\r\n\r\n    return `${volumeLoaderSchema}:${displaySet.displaySetInstanceUID}`;\r\n  }\r\n\r\n  private _setSegmentColor = (\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    color: ohifTypes.RGB,\r\n    toolGroupId?: string,\r\n    suppressEvents = false\r\n  ) => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const segmentInfo = this._getSegmentInfo(segmentation, segmentIndex);\r\n\r\n    if (segmentInfo === undefined) {\r\n      throw new Error(`Segment ${segmentIndex} not yet added to segmentation: ${segmentationId}`);\r\n    }\r\n\r\n    toolGroupId = toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const segmentationRepresentation = this._getSegmentationRepresentation(\r\n      segmentationId,\r\n      toolGroupId\r\n    );\r\n\r\n    if (!segmentationRepresentation) {\r\n      throw new Error('Must add representation to toolgroup before setting segments');\r\n    }\r\n    const { segmentationRepresentationUID } = segmentationRepresentation;\r\n\r\n    const rgbaColor = cstSegmentation.config.color.getColorForSegmentIndex(\r\n      toolGroupId,\r\n      segmentationRepresentationUID,\r\n      segmentIndex\r\n    );\r\n\r\n    cstSegmentation.config.color.setColorForSegmentIndex(\r\n      toolGroupId,\r\n      segmentationRepresentationUID,\r\n      segmentIndex,\r\n      [...color, rgbaColor[3]]\r\n    );\r\n\r\n    segmentInfo.color = color;\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  };\r\n\r\n  private _getSegmentCenter(segmentationId, segmentIndex) {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (!segmentation) {\r\n      return;\r\n    }\r\n\r\n    const { cachedStats } = segmentation;\r\n\r\n    if (!cachedStats) {\r\n      return;\r\n    }\r\n\r\n    const { segmentCenter } = cachedStats;\r\n\r\n    if (!segmentCenter) {\r\n      return;\r\n    }\r\n\r\n    const { center } = segmentCenter[segmentIndex];\r\n\r\n    return center;\r\n  }\r\n\r\n  private _setSegmentLocked(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    isLocked: boolean,\r\n    suppressEvents = false\r\n  ) {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const segmentInfo = this._getSegmentInfo(segmentation, segmentIndex);\r\n\r\n    if (segmentInfo === undefined) {\r\n      throw new Error(`Segment ${segmentIndex} not yet added to segmentation: ${segmentationId}`);\r\n    }\r\n\r\n    segmentInfo.isLocked = isLocked;\r\n\r\n    cstSegmentation.segmentLocking.setSegmentIndexLocked(segmentationId, segmentIndex, isLocked);\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  }\r\n\r\n  private _setSegmentVisibility(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    isVisible: boolean,\r\n    toolGroupId?: string,\r\n    suppressEvents = false\r\n  ) {\r\n    toolGroupId = toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const { segmentationRepresentationUID, segmentation } = this._getSegmentationInfo(\r\n      segmentationId,\r\n      toolGroupId\r\n    );\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const segmentInfo = this._getSegmentInfo(segmentation, segmentIndex);\r\n\r\n    if (segmentInfo === undefined) {\r\n      throw new Error(`Segment ${segmentIndex} not yet added to segmentation: ${segmentationId}`);\r\n    }\r\n\r\n    segmentInfo.isVisible = isVisible;\r\n\r\n    cstSegmentation.config.visibility.setSegmentVisibility(\r\n      toolGroupId,\r\n      segmentationRepresentationUID,\r\n      segmentIndex,\r\n      isVisible\r\n    );\r\n\r\n    // make sure to update the isVisible flag on the segmentation\r\n    // if a segment becomes invisible then the segmentation should be invisible\r\n    // in the status as well, and show correct icon\r\n    segmentation.isVisible = segmentation.segments\r\n      .filter(Boolean)\r\n      .every(segment => segment.isVisible);\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  }\r\n\r\n  private _setSegmentOpacity = (\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    opacity: number,\r\n    toolGroupId?: string,\r\n    suppressEvents = false\r\n  ) => {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const segmentInfo = this._getSegmentInfo(segmentation, segmentIndex);\r\n\r\n    if (segmentInfo === undefined) {\r\n      throw new Error(`Segment ${segmentIndex} not yet added to segmentation: ${segmentationId}`);\r\n    }\r\n\r\n    toolGroupId = toolGroupId ?? this._getApplicableToolGroupId();\r\n\r\n    const segmentationRepresentation = this._getSegmentationRepresentation(\r\n      segmentationId,\r\n      toolGroupId\r\n    );\r\n\r\n    if (!segmentationRepresentation) {\r\n      throw new Error('Must add representation to toolgroup before setting segments');\r\n    }\r\n    const { segmentationRepresentationUID } = segmentationRepresentation;\r\n\r\n    const rgbaColor = cstSegmentation.config.color.getColorForSegmentIndex(\r\n      toolGroupId,\r\n      segmentationRepresentationUID,\r\n      segmentIndex\r\n    );\r\n\r\n    cstSegmentation.config.color.setColorForSegmentIndex(\r\n      toolGroupId,\r\n      segmentationRepresentationUID,\r\n      segmentIndex,\r\n      [rgbaColor[0], rgbaColor[1], rgbaColor[2], opacity]\r\n    );\r\n\r\n    segmentInfo.opacity = opacity;\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  };\r\n\r\n  private _setSegmentLabel(\r\n    segmentationId: string,\r\n    segmentIndex: number,\r\n    segmentLabel: string,\r\n    suppressEvents = false\r\n  ) {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n\r\n    const segmentInfo = this._getSegmentInfo(segmentation, segmentIndex);\r\n\r\n    if (segmentInfo === undefined) {\r\n      throw new Error(`Segment ${segmentIndex} not yet added to segmentation: ${segmentationId}`);\r\n    }\r\n\r\n    segmentInfo.label = segmentLabel;\r\n\r\n    if (suppressEvents === false) {\r\n      this._broadcastEvent(this.EVENTS.SEGMENTATION_UPDATED, {\r\n        segmentation,\r\n      });\r\n    }\r\n  }\r\n\r\n  private _getSegmentationRepresentation(segmentationId, toolGroupId) {\r\n    const segmentationRepresentations =\r\n      this.getSegmentationRepresentationsForToolGroup(toolGroupId);\r\n\r\n    if (!segmentationRepresentations?.length) {\r\n      return;\r\n    }\r\n\r\n    // Todo: this finds the first segmentation representation that matches the segmentationId\r\n    // If there are two labelmap representations from the same segmentation, this will not work\r\n    const representation = segmentationRepresentations.find(\r\n      representation => representation.segmentationId === segmentationId\r\n    );\r\n\r\n    return representation;\r\n  }\r\n\r\n  private _setSegmentationConfig = (property, value) => {\r\n    // Todo: currently we only support global config, and we get the type\r\n    // from the first segmentation\r\n    const typeToUse = this.getSegmentations()[0].type;\r\n\r\n    const { cornerstoneViewportService } = this.servicesManager.services;\r\n\r\n    const config = cstSegmentation.config.getGlobalConfig();\r\n\r\n    config.representations[typeToUse][property] = value;\r\n\r\n    // Todo: add non global (representation specific config as well)\r\n    cstSegmentation.config.setGlobalConfig(config);\r\n\r\n    const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n    const viewportIds = cornerstoneViewportService.getViewportIds();\r\n\r\n    renderingEngine.renderViewports(viewportIds);\r\n  };\r\n\r\n  private _initSegmentationService() {\r\n    // Connect Segmentation Service to Cornerstone3D.\r\n    eventTarget.addEventListener(\r\n      csToolsEnums.Events.SEGMENTATION_MODIFIED,\r\n      this._onSegmentationModifiedFromSource\r\n    );\r\n\r\n    eventTarget.addEventListener(\r\n      csToolsEnums.Events.SEGMENTATION_DATA_MODIFIED,\r\n      this._onSegmentationDataModified\r\n    );\r\n  }\r\n\r\n  private _onSegmentationDataModified = evt => {\r\n    const { segmentationId } = evt.detail;\r\n\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      // Part of add operation, not update operation, exit early.\r\n      return;\r\n    }\r\n\r\n    this._broadcastEvent(this.EVENTS.SEGMENTATION_DATA_MODIFIED, {\r\n      segmentation,\r\n    });\r\n  };\r\n\r\n  private _onSegmentationModifiedFromSource = evt => {\r\n    const { segmentationId } = evt.detail;\r\n\r\n    const segmentation = this.segmentations[segmentationId];\r\n\r\n    if (segmentation === undefined) {\r\n      // Part of add operation, not update operation, exit early.\r\n      return;\r\n    }\r\n\r\n    const segmentationState = cstSegmentation.state.getSegmentation(segmentationId);\r\n\r\n    if (!segmentationState) {\r\n      return;\r\n    }\r\n\r\n    const { activeSegmentIndex, cachedStats, segmentsLocked, label, type } = segmentationState;\r\n\r\n    if (![LABELMAP, CONTOUR].includes(type)) {\r\n      throw new Error(\r\n        `Unsupported segmentation type: ${type}. Only ${LABELMAP} and ${CONTOUR} are supported.`\r\n      );\r\n    }\r\n\r\n    const representationData = segmentationState.representationData[type];\r\n\r\n    // TODO: handle other representations when available in cornerstone3D\r\n    const segmentationSchema = {\r\n      ...segmentation,\r\n      activeSegmentIndex,\r\n      cachedStats,\r\n      displayText: [],\r\n      id: segmentationId,\r\n      label,\r\n      segmentsLocked,\r\n      type,\r\n      representationData: {\r\n        [type]: {\r\n          ...representationData,\r\n        },\r\n      },\r\n    };\r\n\r\n    try {\r\n      this.addOrUpdateSegmentation(segmentationSchema);\r\n    } catch (error) {\r\n      console.warn(`Failed to add/update segmentation ${segmentationId}`, error);\r\n    }\r\n  };\r\n\r\n  private _getSegmentationInfo(segmentationId: string, toolGroupId: string) {\r\n    const segmentation = this.getSegmentation(segmentationId);\r\n\r\n    if (segmentation === undefined) {\r\n      throw new Error(`no segmentation for segmentationId: ${segmentationId}`);\r\n    }\r\n    const segmentationRepresentation = this._getSegmentationRepresentation(\r\n      segmentationId,\r\n      toolGroupId\r\n    );\r\n\r\n    if (!segmentationRepresentation) {\r\n      throw new Error('Must add representation to toolgroup before setting segments');\r\n    }\r\n\r\n    const { segmentationRepresentationUID } = segmentationRepresentation;\r\n\r\n    return { segmentationRepresentationUID, segmentation };\r\n  }\r\n\r\n  private _removeSegmentationFromCornerstone(segmentationId: string) {\r\n    // TODO: This should be from the configuration\r\n    const removeFromCache = true;\r\n    const segmentationState = cstSegmentation.state;\r\n    const sourceSegState = segmentationState.getSegmentation(segmentationId);\r\n    const updatedToolGroupIds: Set<string> = new Set();\r\n\r\n    if (!sourceSegState) {\r\n      return;\r\n    }\r\n\r\n    const toolGroupIds = segmentationState.getToolGroupIdsWithSegmentation(segmentationId);\r\n\r\n    toolGroupIds.forEach(toolGroupId => {\r\n      const segmentationRepresentations =\r\n        segmentationState.getSegmentationRepresentations(toolGroupId);\r\n\r\n      const UIDsToRemove = [];\r\n      segmentationRepresentations.forEach(representation => {\r\n        if (representation.segmentationId === segmentationId) {\r\n          UIDsToRemove.push(representation.segmentationRepresentationUID);\r\n          updatedToolGroupIds.add(toolGroupId);\r\n        }\r\n      });\r\n\r\n      // remove segmentation representations\r\n      cstSegmentation.removeSegmentationsFromToolGroup(\r\n        toolGroupId,\r\n        UIDsToRemove,\r\n        true // immediate\r\n      );\r\n    });\r\n\r\n    // cleanup the segmentation state too\r\n    segmentationState.removeSegmentation(segmentationId);\r\n\r\n    if (removeFromCache && cache.getVolumeLoadObject(segmentationId)) {\r\n      cache.removeVolumeLoadObject(segmentationId);\r\n    }\r\n\r\n    return { updatedToolGroupIds: Array.from(updatedToolGroupIds) };\r\n  }\r\n\r\n  private _updateCornerstoneSegmentations({ segmentationId, notYetUpdatedAtSource }) {\r\n    if (notYetUpdatedAtSource === false) {\r\n      return;\r\n    }\r\n    const segmentationState = cstSegmentation.state;\r\n    const sourceSegmentation = segmentationState.getSegmentation(segmentationId);\r\n    const segmentation = this.segmentations[segmentationId];\r\n    const { label, cachedStats } = segmentation;\r\n\r\n    // Update the label in the source if necessary\r\n    if (sourceSegmentation.label !== label) {\r\n      sourceSegmentation.label = label;\r\n    }\r\n\r\n    if (!isEqual(sourceSegmentation.cachedStats, cachedStats)) {\r\n      sourceSegmentation.cachedStats = cachedStats;\r\n    }\r\n  }\r\n\r\n  private _updateCornerstoneSegmentationVisibility = segmentationId => {\r\n    const segmentationState = cstSegmentation.state;\r\n    const toolGroupIds = segmentationState.getToolGroupIdsWithSegmentation(segmentationId);\r\n\r\n    toolGroupIds.forEach(toolGroupId => {\r\n      const segmentationRepresentations =\r\n        cstSegmentation.state.getSegmentationRepresentations(toolGroupId);\r\n\r\n      if (segmentationRepresentations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      // Todo: this finds the first segmentation representation that matches the segmentationId\r\n      // If there are two labelmap representations from the same segmentation, this will not work\r\n      const representation = segmentationRepresentations.find(\r\n        representation => representation.segmentationId === segmentationId\r\n      );\r\n\r\n      const { segmentsHidden } = representation;\r\n\r\n      const currentVisibility = segmentsHidden.size === 0 ? true : false;\r\n      const newVisibility = !currentVisibility;\r\n\r\n      cstSegmentation.config.visibility.setSegmentationVisibility(\r\n        toolGroupId,\r\n        representation.segmentationRepresentationUID,\r\n        newVisibility\r\n      );\r\n\r\n      // update segments visibility\r\n      const { segmentation } = this._getSegmentationInfo(segmentationId, toolGroupId);\r\n\r\n      const segments = segmentation.segments.filter(Boolean);\r\n\r\n      segments.forEach(segment => {\r\n        segment.isVisible = newVisibility;\r\n      });\r\n    });\r\n  };\r\n\r\n  private _getToolGroupIdsWithSegmentation(segmentationId: string) {\r\n    const segmentationState = cstSegmentation.state;\r\n    const toolGroupIds = segmentationState.getToolGroupIdsWithSegmentation(segmentationId);\r\n\r\n    return toolGroupIds;\r\n  }\r\n\r\n  private _getFrameOfReferenceUIDForSeg(displaySet) {\r\n    const frameOfReferenceUID = displaySet.instance?.FrameOfReferenceUID;\r\n\r\n    if (frameOfReferenceUID) {\r\n      return frameOfReferenceUID;\r\n    }\r\n\r\n    // if not found we should try the ReferencedFrameOfReferenceSequence\r\n    const referencedFrameOfReferenceSequence =\r\n      displaySet.instance?.ReferencedFrameOfReferenceSequence;\r\n\r\n    if (referencedFrameOfReferenceSequence) {\r\n      return referencedFrameOfReferenceSequence.FrameOfReferenceUID;\r\n    }\r\n  }\r\n\r\n  private _getApplicableToolGroupId = () => {\r\n    const { toolGroupService, viewportGridService, cornerstoneViewportService } =\r\n      this.servicesManager.services;\r\n\r\n    const viewportInfo = cornerstoneViewportService.getViewportInfo(\r\n      viewportGridService.getActiveViewportId()\r\n    );\r\n\r\n    if (!viewportInfo) {\r\n      const toolGroupIds = toolGroupService.getToolGroupIds();\r\n\r\n      return toolGroupIds[0];\r\n    }\r\n\r\n    return viewportInfo.getToolGroupId();\r\n  };\r\n\r\n  /**\r\n   * Converts object of objects to array.\r\n   *\r\n   * @return {Array} Array of objects\r\n   */\r\n  private arrayOfObjects = obj => {\r\n    return Object.entries(obj).map(e => ({ [e[0]]: e[1] }));\r\n  };\r\n}\r\n\r\nexport default SegmentationService;\r\nexport { EVENTS, VALUE_TYPES };\r\n","/**\r\n * Maps a DICOM RT Struct ROI Contour to a RTStruct data that can be used\r\n * in Segmentation Service\r\n *\r\n * @param structureSet - A DICOM RT Struct ROI Contour\r\n * @param rtDisplaySetUID - A CornerstoneTools DisplaySet UID\r\n * @returns An array of object that includes data, id, segmentIndex, color\r\n * and geometry Id\r\n */\r\nexport function mapROIContoursToRTStructData(structureSet: unknown, rtDisplaySetUID: unknown) {\r\n  return structureSet.ROIContours.map(({ contourPoints, ROINumber, ROIName, colorArray }) => {\r\n    const data = contourPoints.map(({ points, ...rest }) => {\r\n      const newPoints = points.map(({ x, y, z }) => {\r\n        return [x, y, z];\r\n      });\r\n\r\n      return {\r\n        ...rest,\r\n        points: newPoints,\r\n      };\r\n    });\r\n\r\n    const id = ROIName || ROINumber;\r\n\r\n    return {\r\n      data,\r\n      id,\r\n      segmentIndex: ROINumber,\r\n      color: colorArray,\r\n      geometryId: `${rtDisplaySetUID}:${id}:segmentIndex-${ROINumber}`,\r\n    };\r\n  });\r\n}\r\n","import SegmentationService from './SegmentationService';\r\n\r\nexport default SegmentationService;\r\n","import { Enums } from '@cornerstonejs/core';\r\n\r\nconst STACK = 'stack';\r\nconst VOLUME = 'volume';\r\nconst ORTHOGRAPHIC = 'orthographic';\r\nconst VOLUME_3D = 'volume3d';\r\n\r\nexport default function getCornerstoneViewportType(viewportType: string): Enums.ViewportType {\r\n  const lowerViewportType = viewportType.toLowerCase();\r\n  if (lowerViewportType === STACK) {\r\n    return Enums.ViewportType.STACK;\r\n  }\r\n\r\n  if (lowerViewportType === VOLUME || lowerViewportType === ORTHOGRAPHIC) {\r\n    return Enums.ViewportType.ORTHOGRAPHIC;\r\n  }\r\n\r\n  if (lowerViewportType === VOLUME_3D) {\r\n    return Enums.ViewportType.VOLUME_3D;\r\n  }\r\n\r\n  throw new Error(`Invalid viewport type: ${viewportType}. Valid types are: stack, volume`);\r\n}\r\n","import { Types } from '@ohif/core';\r\nimport { cache as cs3DCache, Enums, volumeLoader, utilities as utils } from '@cornerstonejs/core';\r\n\r\nimport getCornerstoneViewportType from '../../utils/getCornerstoneViewportType';\r\nimport { StackViewportData, VolumeViewportData } from '../../types/CornerstoneCacheService';\r\n\r\nconst VOLUME_LOADER_SCHEME = 'cornerstoneStreamingImageVolume';\r\n\r\nclass CornerstoneCacheService {\r\n  static REGISTRATION = {\r\n    name: 'cornerstoneCacheService',\r\n    altName: 'CornerstoneCacheService',\r\n    create: ({ servicesManager }: Types.Extensions.ExtensionParams): CornerstoneCacheService => {\r\n      return new CornerstoneCacheService(servicesManager);\r\n    },\r\n  };\r\n\r\n  stackImageIds: Map<string, string[]> = new Map();\r\n  volumeImageIds: Map<string, string[]> = new Map();\r\n  readonly servicesManager: AppTypes.ServicesManager;\r\n\r\n  constructor(servicesManager: AppTypes.ServicesManager) {\r\n    this.servicesManager = servicesManager;\r\n  }\r\n\r\n  public getCacheSize() {\r\n    return cs3DCache.getCacheSize();\r\n  }\r\n\r\n  public getCacheFreeSpace() {\r\n    return cs3DCache.getBytesAvailable();\r\n  }\r\n\r\n  public async createViewportData(\r\n    displaySets: unknown[],\r\n    viewportOptions: Record<string, unknown>,\r\n    dataSource: unknown,\r\n    initialImageIndex?: number\r\n  ): Promise<StackViewportData | VolumeViewportData> {\r\n    let viewportType = viewportOptions.viewportType as string;\r\n\r\n    // Todo: Since Cornerstone 3D currently doesn't support segmentation\r\n    // on stack viewport, we should check if whether the the displaySets\r\n    // that are about to be displayed are referenced in a segmentation\r\n    // as a reference volume, if so, we should hang a volume viewport\r\n    // instead of a stack viewport\r\n    if (this._shouldRenderSegmentation(displaySets)) {\r\n      // if the viewport type is volume 3D, we should let it be as it is\r\n      // Todo: in future here we should kick start the conversion of the\r\n      // segmentation to closed surface\r\n      viewportType =\r\n        viewportType === Enums.ViewportType.VOLUME_3D ? Enums.ViewportType.VOLUME_3D : 'volume';\r\n\r\n      // update viewportOptions to reflect the new viewport type\r\n      viewportOptions.viewportType = viewportType;\r\n    }\r\n\r\n    const cs3DViewportType = getCornerstoneViewportType(viewportType);\r\n    let viewportData: StackViewportData | VolumeViewportData;\r\n\r\n    if (cs3DViewportType === Enums.ViewportType.STACK) {\r\n      viewportData = await this._getStackViewportData(\r\n        dataSource,\r\n        displaySets,\r\n        initialImageIndex,\r\n        cs3DViewportType\r\n      );\r\n      // console.log('STACK VIEWPORT DATA', viewportData)\r\n    }\r\n\r\n    if (\r\n      cs3DViewportType === Enums.ViewportType.ORTHOGRAPHIC ||\r\n      cs3DViewportType === Enums.ViewportType.VOLUME_3D\r\n    ) {\r\n      viewportData = await this._getVolumeViewportData(\r\n        dataSource,\r\n        displaySets,\r\n        initialImageIndex,\r\n        cs3DViewportType\r\n      );\r\n    }\r\n\r\n    viewportData.viewportType = cs3DViewportType;\r\n\r\n    return viewportData;\r\n  }\r\n\r\n  public async invalidateViewportData(\r\n    viewportData: VolumeViewportData,\r\n    invalidatedDisplaySetInstanceUID: string,\r\n    dataSource,\r\n    displaySetService\r\n  ): Promise<VolumeViewportData | StackViewportData> {\r\n    if (viewportData.viewportType === Enums.ViewportType.STACK) {\r\n      const displaySet = displaySetService.getDisplaySetByUID(invalidatedDisplaySetInstanceUID);\r\n      const imageIds = this._getCornerstoneStackImageIds(displaySet, dataSource);\r\n\r\n      // remove images from the cache to be able to re-load them\r\n      imageIds.forEach(imageId => {\r\n        if (cs3DCache.getImageLoadObject(imageId)) {\r\n          cs3DCache.removeImageLoadObject(imageId);\r\n        }\r\n      });\r\n\r\n      return {\r\n        viewportType: Enums.ViewportType.STACK,\r\n        data: {\r\n          StudyInstanceUID: displaySet.StudyInstanceUID,\r\n          displaySetInstanceUID: invalidatedDisplaySetInstanceUID,\r\n          imageIds,\r\n        },\r\n      };\r\n    }\r\n\r\n    // Todo: grab the volume and get the id from the viewport itself\r\n    const volumeId = `${VOLUME_LOADER_SCHEME}:${invalidatedDisplaySetInstanceUID}`;\r\n\r\n    const volume = cs3DCache.getVolume(volumeId);\r\n\r\n    if (volume) {\r\n      if (volume.imageIds) {\r\n        // also for each imageId in the volume, remove the imageId from the cache\r\n        // since that will hold the old metadata as well\r\n\r\n        volume.imageIds.forEach(imageId => {\r\n          if (cs3DCache.getImageLoadObject(imageId)) {\r\n            cs3DCache.removeImageLoadObject(imageId);\r\n          }\r\n        });\r\n      }\r\n\r\n      // this shouldn't be via removeVolumeLoadObject, since that will\r\n      // remove the texture as well, but here we really just need a remove\r\n      // from registry so that we load it again\r\n      cs3DCache._volumeCache.delete(volumeId);\r\n      this.volumeImageIds.delete(volumeId);\r\n    }\r\n\r\n    const displaySets = viewportData.data.map(({ displaySetInstanceUID }) =>\r\n      displaySetService.getDisplaySetByUID(displaySetInstanceUID)\r\n    );\r\n\r\n    const newViewportData = await this._getVolumeViewportData(\r\n      dataSource,\r\n      displaySets,\r\n      viewportData.viewportType\r\n    );\r\n\r\n    return newViewportData;\r\n  }\r\n\r\n  private async _getStackViewportData(\r\n    dataSource,\r\n    displaySets,\r\n    initialImageIndex,\r\n    viewportType: Enums.ViewportType\r\n  ): Promise<StackViewportData> {\r\n    const overlayDisplaySets = displaySets.filter(ds => ds.isOverlayDisplaySet);\r\n    const nonOverlayDisplaySets = displaySets.filter(ds => !ds.isOverlayDisplaySet);\r\n\r\n    // load overlays if they are not loaded\r\n    for (const overlayDisplaySet of overlayDisplaySets) {\r\n      if (overlayDisplaySet.load && overlayDisplaySet.load instanceof Function) {\r\n        const { userAuthenticationService } = this.servicesManager.services;\r\n        const headers = userAuthenticationService.getAuthorizationHeader();\r\n        await overlayDisplaySet.load({ headers });\r\n      }\r\n    }\r\n\r\n    const displaySet = nonOverlayDisplaySets[0];\r\n\r\n    let stackImageIds = this.stackImageIds.get(displaySet.displaySetInstanceUID);\r\n\r\n    if (!stackImageIds) {\r\n      stackImageIds = this._getCornerstoneStackImageIds(displaySet, dataSource);\r\n      this.stackImageIds.set(displaySet.displaySetInstanceUID, stackImageIds);\r\n    }\r\n\r\n    // Ensuring the first non-overlay `displaySet` is always the primary one\r\n    const StackViewportData = [displaySet, ...overlayDisplaySets].map(ds => {\r\n      const { displaySetInstanceUID, StudyInstanceUID, isCompositeStack } = ds;\r\n\r\n      return {\r\n        StudyInstanceUID,\r\n        displaySetInstanceUID,\r\n        isCompositeStack,\r\n        imageIds: stackImageIds,\r\n        initialImageIndex,\r\n      };\r\n    });\r\n\r\n    return {\r\n      viewportType,\r\n      data: StackViewportData,\r\n    };\r\n  }\r\n\r\n  private async _getVolumeViewportData(\r\n    dataSource,\r\n    displaySets,\r\n    initialImageIndex,\r\n    viewportType: Enums.ViewportType\r\n  ): Promise<VolumeViewportData> {\r\n    // Todo: Check the cache for multiple scenarios to see if we need to\r\n    // decache the volume data from other viewports or not\r\n\r\n    const volumeData = [];\r\n\r\n    for (const displaySet of displaySets) {\r\n      // Don't create volumes for the displaySets that have custom load\r\n      // function (e.g., SEG, RT, since they rely on the reference volumes\r\n      // and they take care of their own loading after they are created in their\r\n      // getSOPClassHandler method\r\n\r\n      if (displaySet.load && displaySet.load instanceof Function) {\r\n        const { userAuthenticationService } = this.servicesManager.services;\r\n        const headers = userAuthenticationService.getAuthorizationHeader();\r\n        await displaySet.load({ headers });\r\n\r\n        volumeData.push({\r\n          studyInstanceUID: displaySet.StudyInstanceUID,\r\n          displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n        });\r\n\r\n        // Todo: do some cache check and empty the cache if needed\r\n        continue;\r\n      }\r\n\r\n      const volumeLoaderSchema = displaySet.volumeLoaderSchema ?? VOLUME_LOADER_SCHEME;\r\n\r\n      let volumeId = `${volumeLoaderSchema}:${displaySet.displaySetInstanceUID}`;\r\n\r\n      let volumeImageIds = this.volumeImageIds.get(displaySet.displaySetInstanceUID);\r\n\r\n      let volume = cs3DCache.getVolume(volumeId);\r\n\r\n      if (!volumeImageIds || !volume) {\r\n        volumeImageIds = this._getCornerstoneVolumeImageIds(displaySet, dataSource);\r\n        volume = await volumeLoader.createAndCacheVolume(volumeId, {\r\n          imageIds: volumeImageIds,\r\n        });\r\n        const { windowWidth, windowCenter } = volume.metadata.voiLut[0];\r\n        if (volumeImageIds[0].split(':')[0] !== 'dicomfile') {\r\n          const layerSize = displaySets[0].instance.Rows * displaySets[0].instance.Columns;\r\n          // TODO\r\n          let scalarData = new Int16Array(layerSize * displaySets[0].numImageFrames);\r\n          displaySets[0].instances.forEach((instance, index) => {\r\n            const pixelData = new Uint8Array(instance.PixelData[0]);\r\n            // As pixelData is a RGBA PNG, only 1 channel is useful\r\n            for (let i = 0; i < layerSize; i++) {\r\n              // As transformedValue = ~~(((val - (windowCenter - 0.5)) / (windowWidth - 1) + 0.5) * 255)\r\n              // TODO Conversion is hardcoded here\r\n              scalarData[index * layerSize + i] = (pixelData[i * 4] / 255 - 0.5) * (windowWidth - 1) + windowCenter - 0.5;\r\n            }\r\n          });\r\n          // Remove volume just created\r\n          // All of this is done because I found no other way to create a volume with a valid scalarData\r\n          volume = cs3DCache.getVolume(volumeId);\r\n          const isZeroArray = arr => arr.every(byte => byte === 0);\r\n          if (isZeroArray(volume.getScalarData())) {\r\n            cs3DCache.removeVolumeLoadObject(volumeId);\r\n          }\r\n\r\n          const options = {\r\n            metadata: volume.metadata,\r\n            dimensions: volume.dimensions,\r\n            spacing: volume.spacing,\r\n            origin: volume.origin,\r\n            direction: volume.direction,\r\n            scalarData: scalarData,\r\n            imageIds: volumeImageIds,\r\n          };\r\n          volume = await volumeLoader.createLocalVolume(options, volumeId);\r\n        }\r\n        this.volumeImageIds.set(displaySet.displaySetInstanceUID, volumeImageIds);\r\n      }\r\n\r\n      volumeData.push({\r\n        StudyInstanceUID: displaySet.StudyInstanceUID,\r\n        displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n        volume,\r\n        volumeId,\r\n        imageIds: volumeImageIds,\r\n        isDynamicVolume: displaySet.isDynamicVolume,\r\n        initialImageIndex,\r\n      });\r\n    }\r\n\r\n    return {\r\n      viewportType,\r\n      data: volumeData,\r\n    };\r\n  }\r\n\r\n  private _shouldRenderSegmentation(displaySets) {\r\n    const { segmentationService, displaySetService } = this.servicesManager.services;\r\n\r\n    const viewportDisplaySetInstanceUIDs = displaySets.map(\r\n      ({ displaySetInstanceUID }) => displaySetInstanceUID\r\n    );\r\n\r\n    // check inside segmentations if any of them are referencing the displaySets\r\n    // that are about to be displayed\r\n    const segmentations = segmentationService.getSegmentations();\r\n\r\n    for (const segmentation of segmentations) {\r\n      const segDisplaySetInstanceUID = segmentation.displaySetInstanceUID;\r\n      const segDisplaySet = displaySetService.getDisplaySetByUID(segDisplaySetInstanceUID);\r\n\r\n      const instance = segDisplaySet.instances?.[0] || segDisplaySet.instance;\r\n\r\n      const shouldDisplaySeg = segmentationService.shouldRenderSegmentation(\r\n        viewportDisplaySetInstanceUIDs,\r\n        instance?.FrameOfReferenceUID || segDisplaySet.FrameOfReferenceUID\r\n      );\r\n\r\n      if (shouldDisplaySeg) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _getCornerstoneStackImageIds(displaySet, dataSource): string[] {\r\n    return dataSource.getImageIdsForDisplaySet(displaySet);\r\n  }\r\n\r\n  private _getCornerstoneVolumeImageIds(displaySet, dataSource): string[] {\r\n    const stackImageIds = this._getCornerstoneStackImageIds(displaySet, dataSource);\r\n\r\n    return stackImageIds;\r\n  }\r\n}\r\n\r\nexport default CornerstoneCacheService;\r\n","import CornerstoneCacheService from './CornerstoneCacheService';\r\n\r\nexport default CornerstoneCacheService;\r\n","const RENDERING_ENGINE_ID = 'OHIFCornerstoneRenderingEngine';\r\n\r\nexport { RENDERING_ENGINE_ID };\r\n","import {\r\n  Types,\r\n  Enums,\r\n  getEnabledElementByViewportId,\r\n  VolumeViewport,\r\n  utilities,\r\n} from '@cornerstonejs/core';\r\nimport { Types as CoreTypes } from '@ohif/core';\r\nimport { StackViewportData, VolumeViewportData } from '../../types/CornerstoneCacheService';\r\nimport getCornerstoneBlendMode from '../../utils/getCornerstoneBlendMode';\r\nimport getCornerstoneOrientation from '../../utils/getCornerstoneOrientation';\r\nimport getCornerstoneViewportType from '../../utils/getCornerstoneViewportType';\r\nimport JumpPresets from '../../utils/JumpPresets';\r\nimport { SyncGroup } from '../SyncGroupService/SyncGroupService';\r\n\r\nexport type InitialImageOptions = {\r\n  index?: number;\r\n  preset?: JumpPresets;\r\n  useOnce?: boolean;\r\n};\r\n\r\nexport type ViewportOptions = {\r\n  id?: string;\r\n  viewportType: Enums.ViewportType;\r\n  toolGroupId: string;\r\n  viewportId: string;\r\n  // Presentation ID to store/load presentation state from\r\n  presentationIds?: CoreTypes.PresentationIds;\r\n  orientation?: Enums.OrientationAxis;\r\n  background?: Types.Point3;\r\n  displayArea?: Types.DisplayArea;\r\n  syncGroups?: SyncGroup[];\r\n  initialImageOptions?: InitialImageOptions;\r\n  customViewportProps?: Record<string, unknown>;\r\n  /*\r\n   * Allows drag and drop of display sets not matching viewport options, but\r\n   * doesn't show them initially.  Displays initially blank if no required match\r\n   */\r\n  allowUnmatchedView?: boolean;\r\n};\r\n\r\nexport type PublicViewportOptions = {\r\n  id?: string;\r\n  viewportType?: string;\r\n  toolGroupId?: string;\r\n  presentationIds?: CoreTypes.PresentationIds;\r\n  viewportId?: string;\r\n  orientation?: Enums.OrientationAxis;\r\n  background?: Types.Point3;\r\n  displayArea?: Types.DisplayArea;\r\n  syncGroups?: SyncGroup[];\r\n  initialImageOptions?: InitialImageOptions;\r\n  customViewportProps?: Record<string, unknown>;\r\n  allowUnmatchedView?: boolean;\r\n};\r\n\r\nexport type DisplaySetSelector = {\r\n  id?: string;\r\n  options?: PublicDisplaySetOptions;\r\n};\r\n\r\nexport type PublicDisplaySetOptions = {\r\n  /** The display set options can have an id in order to distinguish\r\n   * it from other similar items.\r\n   */\r\n  id?: string;\r\n  voi?: VOI;\r\n  voiInverted?: boolean;\r\n  blendMode?: string;\r\n  slabThickness?: number;\r\n  colormap?: string;\r\n  displayPreset?: string;\r\n};\r\n\r\nexport type DisplaySetOptions = {\r\n  id?: string;\r\n  voi?: VOI;\r\n  voiInverted: boolean;\r\n  blendMode?: Enums.BlendModes;\r\n  slabThickness?: number;\r\n  colormap?: { name: string; opacity?: number };\r\n  displayPreset?: string;\r\n};\r\n\r\ntype VOI = {\r\n  windowWidth: number;\r\n  windowCenter: number;\r\n};\r\n\r\nexport type DisplaySet = {\r\n  displaySetInstanceUID: string;\r\n};\r\n\r\nconst STACK = 'stack';\r\nconst DEFAULT_TOOLGROUP_ID = 'default';\r\n\r\n// Return true if the data contains the given display set UID OR the imageId\r\n// if it is a composite object.\r\nconst dataContains = ({ data, displaySetUID, imageId, viewport }): boolean => {\r\n  if (imageId && data.isCompositeStack && data.imageIds) {\r\n    return !!data.imageIds.find(dataId => dataId === imageId);\r\n  }\r\n\r\n  if (imageId && (data.volumeId || viewport instanceof VolumeViewport)) {\r\n    const isAcquisition = !!viewport.getCurrentImageId();\r\n\r\n    if (!isAcquisition) {\r\n      return false;\r\n    }\r\n\r\n    const imageURI = utilities.imageIdToURI(imageId);\r\n    const hasImageId = viewport.hasImageURI(imageURI);\r\n\r\n    if (hasImageId) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  if (data.displaySetInstanceUID === displaySetUID) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nclass ViewportInfo {\r\n  private viewportId = '';\r\n  private element: HTMLDivElement;\r\n  private viewportOptions: ViewportOptions;\r\n  private displaySetOptions: Array<DisplaySetOptions>;\r\n  private viewportData: StackViewportData | VolumeViewportData;\r\n  private renderingEngineId: string;\r\n\r\n  constructor(viewportId: string) {\r\n    this.viewportId = viewportId;\r\n    this.setPublicViewportOptions({});\r\n    this.setPublicDisplaySetOptions([{}]);\r\n  }\r\n\r\n  /**\r\n   * Return true if the viewport contains the given display set UID,\r\n   * OR if it is a composite stack and contains the given imageId\r\n   */\r\n  public contains(displaySetUID: string, imageId: string): boolean {\r\n    if (!this.viewportData?.data) {\r\n      return false;\r\n    }\r\n\r\n    const { viewport } = getEnabledElementByViewportId(this.viewportId) || {};\r\n\r\n    if (this.viewportData.data.length) {\r\n      return !!this.viewportData.data.find(data =>\r\n        dataContains({ data, displaySetUID, imageId, viewport })\r\n      );\r\n    }\r\n\r\n    return dataContains({\r\n      data: this.viewportData.data,\r\n      displaySetUID,\r\n      imageId,\r\n      viewport,\r\n    });\r\n  }\r\n\r\n  public destroy = (): void => {\r\n    this.element = null;\r\n    this.viewportData = null;\r\n    this.viewportOptions = null;\r\n    this.displaySetOptions = null;\r\n  };\r\n\r\n  public setRenderingEngineId(renderingEngineId: string): void {\r\n    this.renderingEngineId = renderingEngineId;\r\n  }\r\n\r\n  public getRenderingEngineId(): string {\r\n    return this.renderingEngineId;\r\n  }\r\n\r\n  public setViewportId(viewportId: string): void {\r\n    this.viewportId = viewportId;\r\n  }\r\n\r\n  public setElement(element: HTMLDivElement): void {\r\n    this.element = element;\r\n  }\r\n\r\n  public setViewportData(viewportData: StackViewportData | VolumeViewportData): void {\r\n    this.viewportData = viewportData;\r\n  }\r\n\r\n  public getViewportData(): StackViewportData | VolumeViewportData {\r\n    return this.viewportData;\r\n  }\r\n\r\n  public getElement(): HTMLDivElement {\r\n    return this.element;\r\n  }\r\n\r\n  public getViewportId(): string {\r\n    return this.viewportId;\r\n  }\r\n\r\n  public setPublicDisplaySetOptions(\r\n    publicDisplaySetOptions: PublicDisplaySetOptions[] | DisplaySetSelector[]\r\n  ): Array<DisplaySetOptions> {\r\n    // map the displaySetOptions and check if they are undefined then set them to default values\r\n    const displaySetOptions = this.mapDisplaySetOptions(publicDisplaySetOptions);\r\n\r\n    this.setDisplaySetOptions(displaySetOptions);\r\n\r\n    return this.displaySetOptions;\r\n  }\r\n\r\n  public hasDisplaySet(displaySetInstanceUID: string): boolean {\r\n    // Todo: currently this does not work for non image & referenceImage displaySets.\r\n    // Since SEG and other derived displaySets are loaded in a different way, and not\r\n    // via cornerstoneViewportService\r\n    let viewportData = this.getViewportData();\r\n\r\n    if (\r\n      viewportData.viewportType === Enums.ViewportType.ORTHOGRAPHIC ||\r\n      viewportData.viewportType === Enums.ViewportType.VOLUME_3D\r\n    ) {\r\n      viewportData = viewportData as VolumeViewportData;\r\n      return viewportData.data.some(\r\n        ({ displaySetInstanceUID: dsUID }) => dsUID === displaySetInstanceUID\r\n      );\r\n    }\r\n\r\n    viewportData = viewportData as StackViewportData;\r\n    return viewportData.data.displaySetInstanceUID === displaySetInstanceUID;\r\n  }\r\n\r\n  public setPublicViewportOptions(viewportOptionsEntry: PublicViewportOptions): ViewportOptions {\r\n    let viewportType = viewportOptionsEntry.viewportType;\r\n    const { toolGroupId = DEFAULT_TOOLGROUP_ID, presentationIds } = viewportOptionsEntry;\r\n    let orientation;\r\n\r\n    if (!viewportType) {\r\n      viewportType = getCornerstoneViewportType(STACK);\r\n    } else {\r\n      viewportType = getCornerstoneViewportType(viewportOptionsEntry.viewportType);\r\n    }\r\n\r\n    // map SAGITTAL, AXIAL, CORONAL orientation to be used by cornerstone\r\n    if (viewportOptionsEntry.viewportType?.toLowerCase() !== STACK) {\r\n      orientation = getCornerstoneOrientation(viewportOptionsEntry.orientation);\r\n    }\r\n\r\n    if (!toolGroupId) {\r\n      toolGroupId = DEFAULT_TOOLGROUP_ID;\r\n    }\r\n\r\n    this.setViewportOptions({\r\n      ...viewportOptionsEntry,\r\n      viewportId: this.viewportId,\r\n      viewportType: viewportType as Enums.ViewportType,\r\n      orientation,\r\n      toolGroupId,\r\n      presentationIds,\r\n    });\r\n\r\n    return this.viewportOptions;\r\n  }\r\n\r\n  public setViewportOptions(viewportOptions: ViewportOptions): void {\r\n    this.viewportOptions = viewportOptions;\r\n  }\r\n\r\n  public getViewportOptions(): ViewportOptions {\r\n    return this.viewportOptions;\r\n  }\r\n\r\n  public getPresentationIds(): CoreTypes.PresentationIds {\r\n    const { presentationIds } = this.viewportOptions;\r\n    return presentationIds;\r\n  }\r\n\r\n  public setDisplaySetOptions(displaySetOptions: Array<DisplaySetOptions>): void {\r\n    this.displaySetOptions = displaySetOptions;\r\n  }\r\n\r\n  public getSyncGroups(): SyncGroup[] {\r\n    this.viewportOptions.syncGroups ||= [];\r\n    return this.viewportOptions.syncGroups;\r\n  }\r\n\r\n  public getDisplaySetOptions(): Array<DisplaySetOptions> {\r\n    return this.displaySetOptions;\r\n  }\r\n\r\n  public getViewportType(): Enums.ViewportType {\r\n    return this.viewportOptions.viewportType || Enums.ViewportType.STACK;\r\n  }\r\n\r\n  public getToolGroupId(): string {\r\n    return this.viewportOptions.toolGroupId;\r\n  }\r\n\r\n  public getBackground(): Types.Point3 {\r\n    return this.viewportOptions.background || [0, 0, 0];\r\n  }\r\n\r\n  public getOrientation(): Enums.OrientationAxis {\r\n    return this.viewportOptions.orientation;\r\n  }\r\n\r\n  public getDisplayArea(): Types.DisplayArea {\r\n    return this.viewportOptions.displayArea;\r\n  }\r\n\r\n  public getInitialImageOptions(): InitialImageOptions {\r\n    return this.viewportOptions.initialImageOptions;\r\n  }\r\n\r\n  // Handle incoming public display set options or a display set select\r\n  // with a contained options.\r\n  private mapDisplaySetOptions(\r\n    options: PublicDisplaySetOptions[] | DisplaySetSelector[] = [{}]\r\n  ): Array<DisplaySetOptions> {\r\n    const displaySetOptions: Array<DisplaySetOptions> = [];\r\n\r\n    options.forEach(item => {\r\n      let option = item?.options || item;\r\n      if (!option) {\r\n        option = {\r\n          blendMode: undefined,\r\n          slabThickness: undefined,\r\n          colormap: undefined,\r\n          voi: {},\r\n          voiInverted: false,\r\n        };\r\n      }\r\n      const blendMode = getCornerstoneBlendMode(option.blendMode);\r\n\r\n      displaySetOptions.push({\r\n        voi: option.voi,\r\n        voiInverted: option.voiInverted,\r\n        colormap: option.colormap,\r\n        slabThickness: option.slabThickness,\r\n        blendMode,\r\n        displayPreset: option.displayPreset,\r\n      });\r\n    });\r\n\r\n    return displaySetOptions;\r\n  }\r\n}\r\n\r\nexport default ViewportInfo;\r\n","import { Enums } from '@cornerstonejs/core';\r\n\r\nconst AXIAL = 'axial';\r\nconst SAGITTAL = 'sagittal';\r\nconst CORONAL = 'coronal';\r\n\r\nexport default function getCornerstoneOrientation(orientation: string): Enums.OrientationAxis {\r\n  if (orientation) {\r\n    switch (orientation.toLowerCase()) {\r\n      case AXIAL:\r\n        return Enums.OrientationAxis.AXIAL;\r\n      case SAGITTAL:\r\n        return Enums.OrientationAxis.SAGITTAL;\r\n      case CORONAL:\r\n        return Enums.OrientationAxis.CORONAL;\r\n      default:\r\n        return Enums.OrientationAxis.ACQUISITION;\r\n    }\r\n  }\r\n\r\n  return Enums.OrientationAxis.ACQUISITION;\r\n}\r\n","import { Enums } from '@cornerstonejs/core';\r\n\r\nconst MIP = 'mip';\r\nconst MINIP = 'minip';\r\nconst AVG = 'avg';\r\n\r\nexport default function getCornerstoneBlendMode(blendMode: string): Enums.BlendModes {\r\n  if (!blendMode) {\r\n    return Enums.BlendModes.COMPOSITE;\r\n  }\r\n\r\n  if (blendMode.toLowerCase() === MIP) {\r\n    return Enums.BlendModes.MAXIMUM_INTENSITY_BLEND;\r\n  }\r\n\r\n  if (blendMode.toLowerCase() === MINIP) {\r\n    return Enums.BlendModes.MINIMUM_INTENSITY_BLEND;\r\n  }\r\n\r\n  if (blendMode.toLowerCase() === AVG) {\r\n    return Enums.BlendModes.AVERAGE_INTENSITY_BLEND;\r\n  }\r\n\r\n  throw new Error(`Unsupported blend mode: ${blendMode}`);\r\n}\r\n","/**\r\n * Jump Presets - This enum defines the 3 jump states which are available\r\n * to be used with the jumpToSlice utility function.\r\n */\r\nenum JumpPresets {\r\n  /** Jumps to first slice */\r\n  First = 'first',\r\n  /** Jumps to last slice */\r\n  Last = 'last',\r\n  /** Jumps to the middle slice */\r\n  Middle = 'middle',\r\n}\r\n\r\nexport default JumpPresets;\r\n","import { PubSubService } from '@ohif/core';\r\nimport { Types as OhifTypes } from '@ohif/core';\r\nimport {\r\n  RenderingEngine,\r\n  StackViewport,\r\n  Types,\r\n  getRenderingEngine,\r\n  utilities as csUtils,\r\n  VolumeViewport,\r\n  VolumeViewport3D,\r\n  cache,\r\n  utilities,\r\n  CONSTANTS,\r\n  Enums as csEnums,\r\n  getEnabledElement,\r\n  metaData,\r\n  BaseVolumeViewport,\r\n} from '@cornerstonejs/core';\r\n\r\nimport { utilities as csToolsUtils, Enums as csToolsEnums } from '@cornerstonejs/tools';\r\nimport { IViewportService } from './IViewportService';\r\nimport { RENDERING_ENGINE_ID } from './constants';\r\nimport ViewportInfo, { DisplaySetOptions, PublicViewportOptions } from './Viewport';\r\nimport { StackViewportData, VolumeViewportData } from '../../types/CornerstoneCacheService';\r\nimport { LutPresentation, PositionPresentation, Presentations } from '../../types/Presentation';\r\n\r\nimport JumpPresets from '../../utils/JumpPresets';\r\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\r\n\r\nimport {applyPreset} from \"@cornerstonejs/core/dist/cjs/utilities\";\r\nimport vtkActor from \"@kitware/vtk.js/Rendering/Core/Actor\";\r\nimport vtkVolume from \"@kitware/vtk.js/Rendering/Core/Volume\";\r\nimport vtkVolumeMapper from \"@kitware/vtk.js/Rendering/Core/VolumeMapper\";\r\nimport vtkColorTransferFunction from \"@kitware/vtk.js/Rendering/Core/ColorTransferFunction\";\r\nimport vtkPiecewiseFunction from \"@kitware/vtk.js/Common/DataModel/PiecewiseFunction\";\r\nimport vtkImageMarchingCubes from \"@kitware/vtk.js/Filters/General/ImageMarchingCubes\"\r\nimport vtkMapper from \"@kitware/vtk.js/Rendering/Core/Mapper\";\r\nimport vtkSphereSource from \"@kitware/vtk.js/Filters/Sources/SphereSource\";\r\nimport vtkImageCropFilter from \"@kitware/vtk.js/Filters/General/ImageCropFilter\";\r\n\r\nconst EVENTS = {\r\n  VIEWPORT_DATA_CHANGED: 'event::cornerstoneViewportService:viewportDataChanged',\r\n  VIEWPORT_VOLUMES_CHANGED: 'event::cornerstoneViewportService:viewportVolumesChanged',\r\n};\r\n\r\n/**\r\n * Handles cornerstone viewport logic including enabling, disabling, and\r\n * updating the viewport.\r\n */\r\nclass CornerstoneViewportService extends PubSubService implements IViewportService {\r\n  static REGISTRATION = {\r\n    name: 'cornerstoneViewportService',\r\n    altName: 'CornerstoneViewportService',\r\n    create: ({\r\n      servicesManager,\r\n    }: OhifTypes.Extensions.ExtensionParams): CornerstoneViewportService => {\r\n      return new CornerstoneViewportService(servicesManager);\r\n    },\r\n  };\r\n\r\n  renderingEngine: Types.IRenderingEngine | null;\r\n  viewportsById: Map<string, ViewportInfo> = new Map();\r\n  viewportGridResizeObserver: ResizeObserver | null;\r\n  viewportsDisplaySets: Map<string, string[]> = new Map();\r\n  beforeResizePositionPresentations: Map<string, PositionPresentation> = new Map();\r\n\r\n  // Some configs\r\n  enableResizeDetector: true;\r\n  resizeRefreshRateMs: 200;\r\n  resizeRefreshMode: 'debounce';\r\n  servicesManager: AppTypes.ServicesManager = null;\r\n\r\n  resizeQueue = [];\r\n  viewportResizeTimer = null;\r\n  gridResizeDelay = 50;\r\n  gridResizeTimeOut = null;\r\n\r\n  constructor(servicesManager: AppTypes.ServicesManager) {\r\n    super(EVENTS);\r\n    this.renderingEngine = null;\r\n    this.viewportGridResizeObserver = null;\r\n    this.servicesManager = servicesManager;\r\n  }\r\n\r\n  /**\r\n   * Adds the HTML element to the viewportService\r\n   * @param {*} viewportId\r\n   * @param {*} elementRef\r\n   */\r\n  public enableViewport(viewportId: string, elementRef: HTMLDivElement): void {\r\n    const viewportInfo = new ViewportInfo(viewportId);\r\n    viewportInfo.setElement(elementRef);\r\n    this.viewportsById.set(viewportId, viewportInfo);\r\n  }\r\n\r\n  public getViewportIds(): string[] {\r\n    return Array.from(this.viewportsById.keys());\r\n  }\r\n\r\n  /**\r\n   * It retrieves the renderingEngine if it does exist, or creates one otherwise\r\n   * @returns {RenderingEngine} rendering engine\r\n   */\r\n  public getRenderingEngine() {\r\n    // get renderingEngine from cache if it exists\r\n    const renderingEngine = getRenderingEngine(RENDERING_ENGINE_ID);\r\n\r\n    if (renderingEngine) {\r\n      this.renderingEngine = renderingEngine;\r\n      return this.renderingEngine;\r\n    }\r\n\r\n    if (!renderingEngine || renderingEngine.hasBeenDestroyed) {\r\n      this.renderingEngine = new RenderingEngine(RENDERING_ENGINE_ID);\r\n    }\r\n\r\n    return this.renderingEngine;\r\n  }\r\n\r\n  /**\r\n   * It triggers the resize on the rendering engine, and renders the viewports\r\n   *\r\n   * @param isGridResize - if the resize is triggered by a grid resize\r\n   * this is used to avoid double resize of the viewports since if the\r\n   * grid is resized, all viewports will be resized so there is no need\r\n   * to resize them individually which will get triggered by their\r\n   * individual resize observers\r\n   */\r\n  public resize(isGridResize = false) {\r\n    // if there is a grid resize happening, it means the viewport grid\r\n    // has been manipulated (e.g., panels closed, added, etc.) and we need\r\n    // to resize all viewports, so we will add a timeout here to make sure\r\n    // we don't double resize the viewports when viewports in the grid are\r\n    // resized individually\r\n    if (isGridResize) {\r\n      this.performResize();\r\n      this.resetGridResizeTimeout();\r\n      this.resizeQueue = [];\r\n      clearTimeout(this.viewportResizeTimer);\r\n    } else {\r\n      this.enqueueViewportResizeRequest();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the viewport from cornerstone, and destroys the rendering engine\r\n   */\r\n  public destroy() {\r\n    this._removeResizeObserver();\r\n    this.viewportGridResizeObserver = null;\r\n    try {\r\n      this.renderingEngine?.destroy?.();\r\n    } catch (e) {\r\n      console.warn('Rendering engine not destroyed', e);\r\n    }\r\n    this.viewportsDisplaySets.clear();\r\n    this.renderingEngine = null;\r\n    cache.purgeCache();\r\n  }\r\n\r\n  /**\r\n   * Disables the viewport inside the renderingEngine, if no viewport is left\r\n   * it destroys the renderingEngine.\r\n   *\r\n   * This is called when the element goes away entirely - with new viewportId's\r\n   * created for every new viewport, this will be called whenever the set of\r\n   * viewports is changed, but NOT when the viewport position changes only.\r\n   *\r\n   * @param viewportId - The viewportId to disable\r\n   */\r\n  public disableElement(viewportId: string): void {\r\n    this.renderingEngine?.disableElement(viewportId);\r\n\r\n    // clean up\r\n    this.viewportsById.delete(viewportId);\r\n    this.viewportsDisplaySets.delete(viewportId);\r\n  }\r\n\r\n  /**\r\n   * Sets the presentations for a given viewport. Presentations is an object\r\n   * that can define the lut or position for a viewport.\r\n   *\r\n   * @param viewportId - The ID of the viewport.\r\n   * @param presentations - The presentations to apply to the viewport.\r\n   */\r\n  public setPresentations(viewportId: string, presentations?: Presentations): void {\r\n    const viewport = this.getCornerstoneViewport(viewportId) as\r\n      | Types.IStackViewport\r\n      | Types.IVolumeViewport;\r\n\r\n    if (!viewport) {\r\n      return;\r\n    }\r\n\r\n    if (!presentations) {\r\n      return;\r\n    }\r\n\r\n    const { lutPresentation, positionPresentation } = presentations;\r\n    if (lutPresentation) {\r\n      const { presentation } = lutPresentation;\r\n      if (viewport instanceof BaseVolumeViewport) {\r\n        if (presentation instanceof Map) {\r\n          presentation.forEach((properties, volumeId) => {\r\n            viewport.setProperties(properties, volumeId);\r\n          });\r\n        } else {\r\n          viewport.setProperties(presentation);\r\n        }\r\n      } else {\r\n        viewport.setProperties(presentation);\r\n      }\r\n    }\r\n\r\n    if (positionPresentation) {\r\n      const { viewPlaneNormal, viewUp, zoom, pan } = positionPresentation.presentation;\r\n      viewport.setCamera({ viewPlaneNormal, viewUp });\r\n\r\n      if (zoom !== undefined) {\r\n        viewport.setZoom(zoom);\r\n      }\r\n\r\n      if (pan !== undefined) {\r\n        viewport.setPan(pan);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieves the position presentation information for a given viewport.\r\n   * @param viewportId The ID of the viewport.\r\n   * @returns The position presentation object containing various properties\r\n   * such as ID, viewport type, initial image index, view plane normal, view up, zoom, and pan.\r\n   */\r\n  public getPositionPresentation(viewportId: string): PositionPresentation {\r\n    const viewportInfo = this.viewportsById.get(viewportId);\r\n    if (!viewportInfo) {\r\n      return;\r\n    }\r\n\r\n    const presentationIds = viewportInfo.getPresentationIds();\r\n\r\n    if (!presentationIds) {\r\n      return;\r\n    }\r\n\r\n    const { positionPresentationId } = presentationIds;\r\n\r\n    const csViewport = this.getCornerstoneViewport(viewportId);\r\n    if (!csViewport) {\r\n      return;\r\n    }\r\n\r\n    const { viewPlaneNormal, viewUp } = csViewport.getCamera();\r\n    const initialImageIndex = csViewport.getCurrentImageIdIndex() || 0;\r\n    const zoom = csViewport.getZoom();\r\n    const pan = csViewport.getPan();\r\n\r\n    return {\r\n      id: positionPresentationId,\r\n      viewportType: viewportInfo.getViewportType(),\r\n      presentation: {\r\n        initialImageIndex,\r\n        viewUp,\r\n        viewPlaneNormal,\r\n        zoom,\r\n        pan,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Retrieves the LUT (Lookup Table) presentation for a given viewport.\r\n   * @param viewportId The ID of the viewport.\r\n   * @returns The LUT presentation object, or undefined if the viewport does not exist.\r\n   */\r\n  public getLutPresentation(viewportId: string): LutPresentation {\r\n    const viewportInfo = this.viewportsById.get(viewportId);\r\n    if (!viewportInfo) {\r\n      return;\r\n    }\r\n\r\n    const presentationIds = viewportInfo.getPresentationIds();\r\n\r\n    if (!presentationIds) {\r\n      return;\r\n    }\r\n\r\n    const { lutPresentationId } = presentationIds;\r\n\r\n    const csViewport = this.getCornerstoneViewport(viewportId) as\r\n      | Types.IStackViewport\r\n      | Types.IVolumeViewport;\r\n\r\n    if (!csViewport) {\r\n      return;\r\n    }\r\n\r\n    const cleanProperties = properties => {\r\n      if (properties.isComputedVOI) {\r\n        delete properties.voiRange;\r\n        delete properties.VOILUTFunction;\r\n      }\r\n      return properties;\r\n    };\r\n\r\n    const presentation =\r\n      csViewport instanceof BaseVolumeViewport\r\n        ? new Map()\r\n        : cleanProperties(csViewport.getProperties());\r\n\r\n    if (presentation instanceof Map) {\r\n      csViewport.getActors().forEach(({ uid: volumeId }) => {\r\n        const properties = cleanProperties(csViewport.getProperties(volumeId));\r\n        presentation.set(volumeId, properties);\r\n      });\r\n    }\r\n\r\n    return {\r\n      id: lutPresentationId,\r\n      viewportType: viewportInfo.getViewportType(),\r\n      presentation,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Retrieves the presentations for a given viewport.\r\n   * @param viewportId - The ID of the viewport.\r\n   * @returns The presentations for the viewport.\r\n   */\r\n  public getPresentations(viewportId: string): Presentations {\r\n    const viewportInfo = this.viewportsById.get(viewportId);\r\n    if (!viewportInfo) {\r\n      return;\r\n    }\r\n\r\n    const positionPresentation = this.getPositionPresentation(viewportId);\r\n    const lutPresentation = this.getLutPresentation(viewportId);\r\n\r\n    return {\r\n      positionPresentation,\r\n      lutPresentation,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stores the presentation state for a given viewport inside the\r\n   * stateSyncService. This is used to persist the presentation state\r\n   * across different scenarios e.g., when the viewport is changing the\r\n   * display set, or when the viewport is moving to a different layout.\r\n   *\r\n   * @param viewportId The ID of the viewport.\r\n   */\r\n  public storePresentation({ viewportId }) {\r\n    let presentations = null as Presentations;\r\n    try {\r\n      presentations = this.getPresentations(viewportId);\r\n      if (!presentations?.positionPresentation && !presentations?.lutPresentation) {\r\n        return;\r\n      }\r\n    } catch (error) {\r\n      console.warn(error);\r\n      return;\r\n    }\r\n\r\n    const { stateSyncService, syncGroupService } = this.servicesManager.services;\r\n\r\n    const synchronizers = syncGroupService.getSynchronizersForViewport(viewportId);\r\n\r\n    const { positionPresentationStore, synchronizersStore, lutPresentationStore } =\r\n      stateSyncService.getState();\r\n\r\n    const { lutPresentation, positionPresentation } = presentations;\r\n    const { id: positionPresentationId } = positionPresentation;\r\n    const { id: lutPresentationId } = lutPresentation;\r\n\r\n    const updateStore = (store, id, value) => ({ ...store, [id]: value });\r\n\r\n    const newState = {} as { [key: string]: any };\r\n\r\n    if (lutPresentationId) {\r\n      newState.lutPresentationStore = updateStore(\r\n        lutPresentationStore,\r\n        lutPresentationId,\r\n        lutPresentation\r\n      );\r\n    }\r\n\r\n    if (positionPresentationId) {\r\n      newState.positionPresentationStore = updateStore(\r\n        positionPresentationStore,\r\n        positionPresentationId,\r\n        positionPresentation\r\n      );\r\n    }\r\n\r\n    if (synchronizers?.length) {\r\n      newState.synchronizersStore = updateStore(\r\n        synchronizersStore,\r\n        viewportId,\r\n        synchronizers.map(synchronizer => ({\r\n          id: synchronizer.id,\r\n          sourceViewports: [...synchronizer.getSourceViewports()],\r\n          targetViewports: [...synchronizer.getTargetViewports()],\r\n        }))\r\n      );\r\n    }\r\n\r\n    stateSyncService.store(newState);\r\n  }\r\n\r\n  /**\r\n   * Sets the viewport data for a viewport.\r\n   * @param viewportId - The ID of the viewport to set the data for.\r\n   * @param viewportData - The viewport data to set.\r\n   * @param publicViewportOptions - The public viewport options.\r\n   * @param publicDisplaySetOptions - The public display set options.\r\n   * @param presentations - The presentations to set.\r\n   */\r\n  public setViewportData(\r\n    viewportId: string,\r\n    viewportData: StackViewportData | VolumeViewportData,\r\n    publicViewportOptions: PublicViewportOptions,\r\n    publicDisplaySetOptions: DisplaySetOptions[],\r\n    presentations?: Presentations\r\n  ): void {\r\n    console.log('setViewportData', viewportId, viewportData, publicViewportOptions, publicDisplaySetOptions, presentations);\r\n    const renderingEngine = this.getRenderingEngine();\r\n\r\n    // This is the old viewportInfo, which may have old options but we might be\r\n    // using its viewport (same viewportId as the new viewportInfo)\r\n    const viewportInfo = this.viewportsById.get(viewportId);\r\n    console.log('ID', viewportId, publicViewportOptions.viewportId)\r\n\r\n    // We should store the presentation for the current viewport since we can't only\r\n    // rely to store it WHEN the viewport is disabled since we might keep around the\r\n    // same viewport/element and just change the viewportData for it (drag and drop etc.)\r\n    // the disableElement storePresentation handle would not be called in this case\r\n    // and we would lose the presentation.\r\n    this.storePresentation({ viewportId: viewportInfo.getViewportId() });\r\n\r\n    if (!viewportInfo) {\r\n      throw new Error('element is not enabled for the given viewportId');\r\n    }\r\n\r\n    // override the viewportOptions and displaySetOptions with the public ones\r\n    // since those are the newly set ones, we set them here so that it handles defaults\r\n    const displaySetOptions = viewportInfo.setPublicDisplaySetOptions(publicDisplaySetOptions);\r\n    const viewportOptions = viewportInfo.setPublicViewportOptions(publicViewportOptions);\r\n\r\n    const element = viewportInfo.getElement();\r\n    const type = viewportInfo.getViewportType();\r\n    const background = viewportInfo.getBackground();\r\n    const orientation = viewportInfo.getOrientation();\r\n    const displayArea = viewportInfo.getDisplayArea();\r\n\r\n    const viewportInput: Types.PublicViewportInput = {\r\n      viewportId,\r\n      element,\r\n      type,\r\n      defaultOptions: {\r\n        background,\r\n        orientation,\r\n        displayArea,\r\n      },\r\n    };\r\n\r\n    // Rendering Engine Id set should happen before enabling the element\r\n    // since there are callbacks that depend on the renderingEngine id\r\n    // Todo: however, this is a limitation which means that we can't change\r\n    // the rendering engine id for a given viewport which might be a super edge\r\n    // case\r\n    viewportInfo.setRenderingEngineId(renderingEngine.id);\r\n\r\n    // Todo: this is not optimal at all, we are re-enabling the already enabled\r\n    // element which is not what we want. But enabledElement as part of the\r\n    // renderingEngine is designed to be used like this. This will trigger\r\n    // ENABLED_ELEMENT again and again, which will run onEnableElement callbacks\r\n    renderingEngine.enableElement(viewportInput);\r\n\r\n    viewportInfo.setViewportOptions(viewportOptions);\r\n    viewportInfo.setDisplaySetOptions(displaySetOptions);\r\n    viewportInfo.setViewportData(viewportData);\r\n    viewportInfo.setViewportId(viewportId);\r\n\r\n    this.viewportsById.set(viewportId, viewportInfo);\r\n\r\n    const viewport = renderingEngine.getViewport(viewportId);\r\n\r\n    const newPresentations = this.getPresentations(viewportId);\r\n    const { viewPlaneNormal, viewUp, zoom, pan } = newPresentations.positionPresentation.presentation;\r\n    viewport.setCamera({ viewPlaneNormal, viewUp });\r\n\r\n    const displaySetPromise = this._setDisplaySets(\r\n      viewport,\r\n      viewportData,\r\n      viewportInfo,\r\n      presentations\r\n    );\r\n\r\n    // The broadcast event here ensures that listeners have a valid, up to date\r\n    // viewport to access.  Doing it too early can result in exceptions or\r\n    // invalid data.\r\n    displaySetPromise.then(() => {\r\n      this._broadcastEvent(this.EVENTS.VIEWPORT_DATA_CHANGED, {\r\n        viewportData: viewportData,\r\n        viewportId,\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Retrieves the Cornerstone viewport with the specified ID.\r\n   *\r\n   * @param viewportId - The ID of the viewport.\r\n   * @returns The Cornerstone viewport object if found, otherwise null.\r\n   */\r\n  public getCornerstoneViewport(viewportId: string): Types.IViewport | null {\r\n    const viewportInfo = this.getViewportInfo(viewportId);\r\n\r\n    if (!viewportInfo || !this.renderingEngine || this.renderingEngine.hasBeenDestroyed) {\r\n      return null;\r\n    }\r\n\r\n    const viewport = this.renderingEngine.getViewport(viewportId);\r\n\r\n    return viewport;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the viewport information for a given viewport ID. The viewport information\r\n   * is the OHIF construct that holds different options and data for a given viewport and\r\n   * is different from the cornerstone viewport.\r\n   *\r\n   * @param viewportId The ID of the viewport.\r\n   * @returns The viewport information.\r\n   */\r\n  public getViewportInfo(viewportId: string): ViewportInfo {\r\n    return this.viewportsById.get(viewportId);\r\n  }\r\n\r\n  /**\r\n   * Looks through the viewports to see if the specified measurement can be\r\n   * displayed in one of the viewports.\r\n   *\r\n   * @param measurement\r\n   *          The measurement that is desired to view.\r\n   * @param activeViewportId - the index that was active at the time the jump\r\n   *          was initiated.\r\n   * @return the viewportId that the measurement should be displayed in.\r\n   */\r\n  public getViewportIdToJump(\r\n    activeViewportId: string,\r\n    displaySetInstanceUID: string,\r\n    cameraProps: unknown\r\n  ): string {\r\n    const viewportInfo = this.getViewportInfo(activeViewportId);\r\n\r\n    if (viewportInfo.getViewportType() === csEnums.ViewportType.VOLUME_3D) {\r\n      return null;\r\n    }\r\n\r\n    const { referencedImageId } = cameraProps;\r\n    if (viewportInfo?.contains(displaySetInstanceUID, referencedImageId)) {\r\n      return activeViewportId;\r\n    }\r\n\r\n    return (\r\n      [...this.viewportsById.values()].find(viewportInfo =>\r\n        viewportInfo.contains(displaySetInstanceUID, referencedImageId)\r\n      )?.viewportId ?? null\r\n    );\r\n  }\r\n\r\n  private async _setStackViewport(\r\n    viewport: Types.IStackViewport,\r\n    viewportData: StackViewportData,\r\n    viewportInfo: ViewportInfo,\r\n    presentations: Presentations = {}\r\n  ): Promise<void> {\r\n    const displaySetOptions = viewportInfo.getDisplaySetOptions();\r\n\r\n    const displaySetInstanceUIDs = viewportData.data.map(data => data.displaySetInstanceUID);\r\n\r\n    // based on the cache service construct always the first one is the non-overlay\r\n    // and the rest are overlays\r\n\r\n    this.viewportsDisplaySets.set(viewport.id, [...displaySetInstanceUIDs]);\r\n\r\n    const { initialImageIndex, imageIds } = viewportData.data[0];\r\n\r\n    let initialImageIndexToUse =\r\n      presentations?.positionPresentation?.initialImageIndex ?? initialImageIndex;\r\n\r\n    if (initialImageIndexToUse === undefined || initialImageIndexToUse === null) {\r\n      initialImageIndexToUse = this._getInitialImageIndexForViewport(viewportInfo, imageIds) || 0;\r\n    }\r\n    // console.log('INITIAL IMAGE INDEX TO USE', initialImageIndexToUse)\r\n\r\n    const { rotation, flipHorizontal, displayArea } = viewportInfo.getViewportOptions();\r\n\r\n    const properties = { ...presentations.lutPresentation?.properties };\r\n    if (!presentations.lutPresentation?.properties) {\r\n      const { voi, voiInverted, colormap } = displaySetOptions[0];\r\n      if (voi && (voi.windowWidth || voi.windowCenter)) {\r\n        const { lower, upper } = csUtils.windowLevel.toLowHighRange(\r\n          voi.windowWidth,\r\n          voi.windowCenter\r\n        );\r\n        properties.voiRange = { lower, upper };\r\n      }\r\n\r\n      if (voiInverted !== undefined) {\r\n        properties.invert = voiInverted;\r\n      }\r\n\r\n      if (colormap !== undefined) {\r\n        properties.colormap = colormap;\r\n      }\r\n    }\r\n\r\n    this._handleOverlays(viewport);\r\n\r\n    return viewport.setStack(imageIds, initialImageIndexToUse).then(() => {\r\n      viewport.setProperties({ ...properties });\r\n      this.setPresentations(viewport.id, presentations);\r\n      if (displayArea) {\r\n        viewport.setDisplayArea(displayArea);\r\n      }\r\n      if (rotation) {\r\n        viewport.setProperties({ rotation });\r\n      }\r\n      if (flipHorizontal) {\r\n        viewport.setCamera({ flipHorizontal: true });\r\n      }\r\n    });\r\n  }\r\n\r\n  private _getInitialImageIndexForViewport(\r\n    viewportInfo: ViewportInfo,\r\n    imageIds?: string[]\r\n  ): number {\r\n    const initialImageOptions = viewportInfo.getInitialImageOptions();\r\n    if (!initialImageOptions) {\r\n      return;\r\n    }\r\n    const { index, preset } = initialImageOptions;\r\n    const viewportType = viewportInfo.getViewportType();\r\n\r\n    let numberOfSlices;\r\n    if (viewportType === csEnums.ViewportType.STACK) {\r\n      numberOfSlices = imageIds.length;\r\n    } else if (viewportType === csEnums.ViewportType.ORTHOGRAPHIC) {\r\n      const viewport = this.getCornerstoneViewport(viewportInfo.getViewportId());\r\n      const imageSliceData = csUtils.getImageSliceDataForVolumeViewport(viewport);\r\n\r\n      if (!imageSliceData) {\r\n        return;\r\n      }\r\n\r\n      ({ numberOfSlices } = imageSliceData);\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    return this._getInitialImageIndex(numberOfSlices, index, preset);\r\n  }\r\n\r\n  _getInitialImageIndex(numberOfSlices: number, imageIndex?: number, preset?: JumpPresets): number {\r\n    const lastSliceIndex = numberOfSlices - 1;\r\n\r\n    if (imageIndex !== undefined) {\r\n      return csToolsUtils.clip(imageIndex, 0, lastSliceIndex);\r\n    }\r\n\r\n    if (preset === JumpPresets.First) {\r\n      return 0;\r\n    }\r\n\r\n    if (preset === JumpPresets.Last) {\r\n      return lastSliceIndex;\r\n    }\r\n\r\n    if (preset === JumpPresets.Middle) {\r\n      // Note: this is a simple but yet very important formula.\r\n      // since viewport reset works with the middle slice\r\n      // if the below formula is not correct, on a viewport reset\r\n      // it will jump to a different slice than the middle one which\r\n      // was the initial slice, and we have some tools such as Crosshairs\r\n      // which rely on a relative camera modifications and those will break.\r\n      return lastSliceIndex % 2 === 0 ? lastSliceIndex / 2 : (lastSliceIndex + 1) / 2;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  async _setVolumeViewport(\r\n    viewport: Types.IVolumeViewport,\r\n    viewportData: VolumeViewportData,\r\n    viewportInfo: ViewportInfo,\r\n    presentations: Presentations = {}\r\n  ): Promise<void> {\r\n    // TODO: We need to overhaul the way data sources work so requests can be made\r\n    // async. I think we should follow the image loader pattern which is async and\r\n    // has a cache behind it.\r\n    // The problem is that to set this volume, we need the metadata, but the request is\r\n    // already in-flight, and the promise is not cached, so we have no way to wait for\r\n    // it and know when it has fully arrived.\r\n    // loadStudyMetadata(StudyInstanceUID) => Promise([instances for study])\r\n    // loadSeriesMetadata(StudyInstanceUID, SeriesInstanceUID) => Promise([instances for series])\r\n    // If you call loadStudyMetadata and it's not in the DicomMetadataStore cache, it should fire\r\n    // a request through the data source?\r\n    // (This call may or may not create sub-requests for series metadata)\r\n    const volumeInputArray = [];\r\n    const displaySetOptionsArray = viewportInfo.getDisplaySetOptions();\r\n    const { hangingProtocolService } = this.servicesManager.services;\r\n\r\n    const volumeToLoad = [];\r\n    const displaySetInstanceUIDs = [];\r\n\r\n    for (const [index, data] of viewportData.data.entries()) {\r\n      const { volume, imageIds, displaySetInstanceUID } = data;\r\n\r\n      displaySetInstanceUIDs.push(displaySetInstanceUID);\r\n\r\n      if (!volume) {\r\n        console.log('Volume display set not found');\r\n        continue;\r\n      }\r\n\r\n      volumeToLoad.push(volume);\r\n\r\n      const displaySetOptions = displaySetOptionsArray[index];\r\n      const { volumeId } = volume;\r\n\r\n      volumeInputArray.push({\r\n        imageIds,\r\n        volumeId,\r\n        blendMode: displaySetOptions.blendMode,\r\n        slabThickness: this._getSlabThickness(displaySetOptions, volumeId),\r\n      });\r\n    }\r\n\r\n    this.viewportsDisplaySets.set(viewport.id, displaySetInstanceUIDs);\r\n\r\n    const volumesNotLoaded = volumeToLoad.filter(volume => volume.loadStatus?.loaded === false);\r\n\r\n    if (volumesNotLoaded.length) {\r\n      if (hangingProtocolService.getShouldPerformCustomImageLoad()) {\r\n        // delegate the volume loading to the hanging protocol service if it has a custom image load strategy\r\n        return hangingProtocolService.runImageLoadStrategy({\r\n          viewportId: viewport.id,\r\n          volumeInputArray,\r\n        });\r\n      }\r\n\r\n      volumesNotLoaded.forEach(volume => {\r\n        if (!volume.loadStatus.loading) {\r\n          volume.load();\r\n        }\r\n      });\r\n    }\r\n\r\n    // This returns the async continuation only\r\n    return this.setVolumesForViewport(viewport, volumeInputArray, presentations);\r\n  }\r\n\r\n  // Needs to be refactored\r\n  private _setActorProperties = (actorEntry, bitsAllocated) => {\r\n    const inputData = actorEntry.actor.getMapper().getInputData();\r\n    const actor = vtkVolume.newInstance();\r\n    const mapper = vtkVolumeMapper.newInstance();\r\n    mapper.setInputData(inputData);\r\n    mapper.setSampleDistance(1);\r\n    actor.setMapper(mapper);\r\n    // Identify main volume\r\n    if (bitsAllocated === 8) {\r\n      // Set values for getCenter()\r\n      actor.getBounds();\r\n      actor.setOrigin(actor.getCenter());\r\n      // Rotate to coronal view\r\n      actor.setOrientation(270, 0, 0);\r\n    }\r\n\r\n    const ctfun = vtkColorTransferFunction.newInstance();\r\n    const ofun = vtkPiecewiseFunction.newInstance();\r\n    if (bitsAllocated === 8) {\r\n      ctfun.addRGBPoint(13, 0, 0, 0);\r\n      ctfun.addRGBPoint(13, 0.92, 0.74, 0.7);\r\n      ctfun.addRGBPoint(91, 0.92, 0.74, 0.7);\r\n      ctfun.addRGBPoint(91, 0.5, 0.5, 0.1);\r\n      ctfun.addRGBPoint(139, 1, 1, 1);\r\n\r\n      ofun.addPoint(13, 0);\r\n      ofun.addPoint(13, 0.05);\r\n      ofun.addPoint(168, 0.05);\r\n      ofun.addPoint(168, 1);\r\n      ofun.addPoint(255, 1);\r\n    } else {\r\n      // Expect range from -1000 to 3095\r\n      ctfun.addRGBPoint(-801, 0, 0, 0);\r\n      ctfun.addRGBPoint(-800, 0.92, 0.74, 0.7);\r\n      ctfun.addRGBPoint(448, 0.92, 0.74, 0.7);\r\n      ctfun.addRGBPoint(449, 0.5, 0.5, 0.1);\r\n      ctfun.addRGBPoint(1224, 1, 1, 1);\r\n\r\n      ofun.addPoint(-801, 0);\r\n      ofun.addPoint(-800, 0.05);\r\n      ofun.addPoint(449, 0.05);\r\n      ofun.addPoint(450, 1);\r\n      ofun.addPoint(1299, 1);\r\n    }\r\n    const actorProp = actor.getProperty();\r\n    actorProp.setRGBTransferFunction(0, ctfun);\r\n    actorProp.setScalarOpacity(0, ofun);\r\n    actorProp.setScalarOpacityUnitDistance(0, 4.5);\r\n    actorProp.setInterpolationTypeToLinear();\r\n    actorProp.setUseGradientOpacity(0, true);\r\n    actorProp.setGradientOpacityMinimumValue(0, 15);\r\n    actorProp.setGradientOpacityMinimumOpacity(0, 0.0);\r\n    actorProp.setGradientOpacityMaximumValue(0, 100);\r\n    actorProp.setGradientOpacityMaximumOpacity(0, 0.5);\r\n    actorProp.setShade(true);\r\n    actorProp.setAmbient(0.2);\r\n    actorProp.setDiffuse(0.7);\r\n    actorProp.setSpecular(0.7);\r\n    actorProp.setSpecularPower(8.0);\r\n\r\n    actorEntry.actor = actor;\r\n  }\r\n\r\n  private _setVolumeActors = (viewport, bitsAllocated) => {\r\n    const volumeEntries = [];\r\n    const actorEntries = viewport.getActors();\r\n    for (const actorEntry of actorEntries) {\r\n      this._setActorProperties(actorEntry, bitsAllocated);\r\n      volumeEntries.push(actorEntry);\r\n    }\r\n    viewport.setActors(volumeEntries);\r\n  }\r\n\r\n  public async setVolumesForViewport(viewport, volumeInputArray, presentations) {\r\n    const { displaySetService, toolGroupService, viewportGridService } =\r\n      this.servicesManager.services;\r\n\r\n    console.log('SET VOLUMES FOR VIEWPORT', volumeInputArray, viewport, viewport.viewportId)\r\n\r\n    const viewportInfo = this.getViewportInfo(viewport.id);\r\n    const displaySetOptions = viewportInfo.getDisplaySetOptions();\r\n    const displaySetUIDs = viewportGridService.getDisplaySetsUIDsForViewport(viewport.id);\r\n    const displaySet = displaySetService.getDisplaySetByUID(displaySetUIDs[0]);\r\n    const displaySetModality = displaySet?.Modality;\r\n\r\n    // Todo: use presentations states\r\n    const volumesProperties = volumeInputArray.map((volumeInput, index) => {\r\n      const { volumeId } = volumeInput;\r\n      const displaySetOption = displaySetOptions[index];\r\n      const { voi, voiInverted, colormap, displayPreset } = displaySetOption;\r\n      const properties = {};\r\n\r\n      if (voi && (voi.windowWidth || voi.windowCenter)) {\r\n        const { lower, upper } = csUtils.windowLevel.toLowHighRange(\r\n          voi.windowWidth,\r\n          voi.windowCenter\r\n        );\r\n        properties.voiRange = { lower, upper };\r\n      }\r\n\r\n      if (voiInverted !== undefined) {\r\n        properties.invert = voiInverted;\r\n      }\r\n\r\n      if (colormap !== undefined) {\r\n        properties.colormap = colormap;\r\n      }\r\n\r\n      if (displayPreset !== undefined) {\r\n        properties.preset = displayPreset[displaySetModality] || displayPreset.default;\r\n      }\r\n\r\n      return { properties, volumeId };\r\n    });\r\n\r\n    //28 -3024 0 0 0 -901 0 0 0 -900 0.92 0.74 0.70 450 1\r\n    const customPreset =   {\r\n          name: 'CT-Custom',\r\n          gradientOpacity: '4 -3024 0.5 1000 0.5',\r\n          scalarOpacity:\r\n              '12 -3024 0 -801 0 -800 0.05 449 0.05 450 1',\r\n          colorTransfer:\r\n              '28 -3024 0 0 0 -801 0 0 0 -800 0.92 0.74 0.70 448 0.92 0.74 0.70 449 0.5 0.5 0.1 1224 1 1 1',\r\n          interpolation: '1',\r\n    }\r\n\r\n    if (viewport.type === 'volume3d') {\r\n      const actorEntries = viewport.getActors();\r\n      if (actorEntries.length) {\r\n        viewport.setActors(actorEntries);\r\n      } else {\r\n        // TODO Ensure there are non 'volume3d' viewports\r\n        const waitLoading =\r\n          () => new Promise((resolve) => {\r\n            const imageVolume = cache.getVolume(volumeInputArray[0].volumeId);\r\n            // Resolves if volume is loaded or if it doesn't have loadStatus parameter\r\n            if (imageVolume && !(imageVolume.loadStatus?.loaded === false)) {\r\n              return resolve(imageVolume);\r\n            } else {\r\n              return setTimeout(() => waitLoading().then(() => resolve(imageVolume)), 100);\r\n            }\r\n          });\r\n        const { metadata } = await waitLoading() as Types.IImageVolume;\r\n        viewport.setVolumes(volumeInputArray).then(() => {\r\n          this._setVolumeActors(viewport, metadata.BitsAllocated);\r\n        });\r\n      }\r\n    } else {\r\n      await viewport.setVolumes(volumeInputArray);\r\n    }\r\n\r\n    volumesProperties.forEach(({ properties, volumeId }) => {\r\n        viewport.setProperties(properties, volumeId);\r\n    });\r\n\r\n    this.setPresentations(viewport.id, presentations);\r\n\r\n    this._handleOverlays(viewport);\r\n\r\n    const toolGroup = toolGroupService.getToolGroupForViewport(viewport.id);\r\n    csToolsUtils.segmentation.triggerSegmentationRender(toolGroup.id);\r\n\r\n    const imageIndex = this._getInitialImageIndexForViewport(viewportInfo);\r\n\r\n    if (imageIndex !== undefined) {\r\n      csToolsUtils.jumpToSlice(viewport.element, {\r\n        imageIndex,\r\n      });\r\n    }\r\n    viewport.render();\r\n\r\n    this._broadcastEvent(this.EVENTS.VIEWPORT_VOLUMES_CHANGED, {\r\n      viewportInfo,\r\n    });\r\n  }\r\n\r\n  private _handleOverlays(viewport: Types.IStackViewport | Types.IVolumeViewport) {\r\n    const { displaySetService } = this.servicesManager.services;\r\n\r\n    // load any secondary displaySets\r\n    const displaySetInstanceUIDs = this.viewportsDisplaySets.get(viewport.id);\r\n\r\n    // can be SEG or RTSTRUCT for now\r\n    const overlayDisplaySet = displaySetInstanceUIDs\r\n      .map(displaySetService.getDisplaySetByUID)\r\n      .find(displaySet => displaySet?.isOverlayDisplaySet);\r\n    if (overlayDisplaySet) {\r\n      this.addOverlayRepresentationForDisplaySet(overlayDisplaySet, viewport);\r\n    } else {\r\n      // If the displaySet is not a SEG displaySet we assume it is a primary displaySet\r\n      // and we can look into hydrated segmentations to check if any of them are\r\n      // associated with the primary displaySet\r\n\r\n      // get segmentations only returns the hydrated segmentations\r\n      this._addSegmentationRepresentationToToolGroupIfNecessary(displaySetInstanceUIDs, viewport);\r\n    }\r\n  }\r\n\r\n  private _addSegmentationRepresentationToToolGroupIfNecessary(\r\n    displaySetInstanceUIDs: string[],\r\n    viewport: any\r\n  ) {\r\n    const { segmentationService, toolGroupService } = this.servicesManager.services;\r\n\r\n    const toolGroup = toolGroupService.getToolGroupForViewport(viewport.id);\r\n\r\n    // this only returns hydrated segmentations\r\n    const segmentations = segmentationService.getSegmentations();\r\n\r\n    for (const segmentation of segmentations) {\r\n      const toolGroupSegmentationRepresentations =\r\n        segmentationService.getSegmentationRepresentationsForToolGroup(toolGroup.id) || [];\r\n\r\n      // if there is already a segmentation representation for this segmentation\r\n      // for this toolGroup, don't bother at all\r\n      const isSegmentationInToolGroup = toolGroupSegmentationRepresentations.find(\r\n        representation => representation.segmentationId === segmentation.id\r\n      );\r\n\r\n      if (isSegmentationInToolGroup) {\r\n        continue;\r\n      }\r\n\r\n      // otherwise, check if the hydrated segmentations are in the same FrameOfReferenceUID\r\n      // as the primary displaySet, if so add the representation (since it was not there)\r\n      const { id: segDisplaySetInstanceUID } = segmentation;\r\n      let segFrameOfReferenceUID = this._getFrameOfReferenceUID(segDisplaySetInstanceUID);\r\n\r\n      if (!segFrameOfReferenceUID) {\r\n        // if the segmentation displaySet does not have a FrameOfReferenceUID, we might check the\r\n        // segmentation itself maybe it has a FrameOfReferenceUID\r\n        const { FrameOfReferenceUID } = segmentation;\r\n        if (FrameOfReferenceUID) {\r\n          segFrameOfReferenceUID = FrameOfReferenceUID;\r\n        }\r\n      }\r\n\r\n      if (!segFrameOfReferenceUID) {\r\n        return;\r\n      }\r\n\r\n      let shouldDisplaySeg = false;\r\n\r\n      for (const displaySetInstanceUID of displaySetInstanceUIDs) {\r\n        const primaryFrameOfReferenceUID = this._getFrameOfReferenceUID(displaySetInstanceUID);\r\n\r\n        if (segFrameOfReferenceUID === primaryFrameOfReferenceUID) {\r\n          shouldDisplaySeg = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (!shouldDisplaySeg) {\r\n        return;\r\n      }\r\n\r\n      segmentationService.addSegmentationRepresentationToToolGroup(\r\n        toolGroup.id,\r\n        segmentation.id,\r\n        false, // already hydrated,\r\n        segmentation.type\r\n      );\r\n    }\r\n  }\r\n\r\n  private addOverlayRepresentationForDisplaySet(displaySet: any, viewport: any) {\r\n    const { segmentationService, toolGroupService } = this.servicesManager.services;\r\n\r\n    const { referencedVolumeId } = displaySet;\r\n    const segmentationId = displaySet.displaySetInstanceUID;\r\n\r\n    const toolGroup = toolGroupService.getToolGroupForViewport(viewport.id);\r\n\r\n    const representationType =\r\n      referencedVolumeId && cache.getVolume(referencedVolumeId) !== undefined\r\n        ? csToolsEnums.SegmentationRepresentations.Labelmap\r\n        : csToolsEnums.SegmentationRepresentations.Contour;\r\n\r\n    segmentationService.addSegmentationRepresentationToToolGroup(\r\n      toolGroup.id,\r\n      segmentationId,\r\n      false,\r\n      representationType\r\n    );\r\n  }\r\n\r\n  // Todo: keepCamera is an interim solution until we have a better solution for\r\n  // keeping the camera position when the viewport data is changed\r\n  public updateViewport(viewportId: string, viewportData, presentations: Presentations, keepCamera = false) {\r\n    const viewportInfo = this.getViewportInfo(viewportId);\r\n    const viewport = this.getCornerstoneViewport(viewportId);\r\n    const viewportCamera = viewport.getCamera();\r\n\r\n    let displaySetPromise;\r\n\r\n    if (viewport instanceof VolumeViewport || viewport instanceof VolumeViewport3D) {\r\n      displaySetPromise = this._setVolumeViewport(viewport, viewportData, viewportInfo, presentations).then(() => {\r\n        if (keepCamera) {\r\n          viewport.setCamera(viewportCamera);\r\n          viewport.render();\r\n        }\r\n      });\r\n    }\r\n\r\n    if (viewport instanceof StackViewport) {\r\n      this._setStackViewport(viewport, viewportData, viewportInfo, presentations);\r\n      return;\r\n    }\r\n  }\r\n\r\n  _setDisplaySetInURL(\r\n      displaySetUID: string\r\n  ): void {\r\n    //Update display set instance uid currently shown in viewports in URL (if update is necessary)\r\n    //So that the info can be catched in hanging protocol testsuite\r\n    //to show right serie in viewport loading\r\n\r\n    if(!displaySetUID) return;\r\n\r\n    const params = new URLSearchParams(window.location.search);\r\n    if(params.get('displaySetInstanceUID') !== displaySetUID){\r\n      params.set('displaySetInstanceUID', displaySetUID)\r\n      const newurl =  window.location.protocol + \"//\" + window.location.host +\r\n                      window.location.pathname + '?' + params.toString()\r\n      window.history.pushState({path: newurl}, '', newurl)\r\n    }\r\n  }\r\n\r\n  _setSeriesUIDInURL(\r\n      imageId: string\r\n  ): void {\r\n    //Update display set instance uid currently shown in viewports in URL (if update is necessary)\r\n    //So that the info can be catched in hanging protocol testsuite\r\n    //to show right serie in viewport loading\r\n    if(!imageId) return;\r\n    const seriesUID = metaData.get('generalSeriesModule', imageId).seriesInstanceUID\r\n    const params = new URLSearchParams(window.location.search);\r\n    if(!seriesUID.includes(params.get('seriesUID'))){\r\n      params.set('seriesUID', seriesUID)\r\n      const newurl =  window.location.protocol + \"//\" + window.location.host +\r\n          window.location.pathname + '?' + params.toString()\r\n      window.history.pushState({path: newurl}, '', newurl)\r\n    }\r\n  }\r\n\r\n  _setDisplaySets(\r\n    viewport: Types.IViewport,\r\n    viewportData: StackViewportData | VolumeViewportData,\r\n    viewportInfo: ViewportInfo,\r\n    presentations: Presentations = {}\r\n  ): Promise<void> {\r\n    this._setSeriesUIDInURL(viewportData?.data[0]?.imageIds[0])\r\n\r\n    if (viewport instanceof StackViewport) {\r\n      return this._setStackViewport(\r\n        viewport,\r\n        viewportData as StackViewportData,\r\n        viewportInfo,\r\n        presentations\r\n      );\r\n    }\r\n\r\n    if ([VolumeViewport, VolumeViewport3D].some(type => viewport instanceof type)) {\r\n      return this._setVolumeViewport(\r\n        viewport as Types.IVolumeViewport,\r\n        viewportData as VolumeViewportData,\r\n        viewportInfo,\r\n        presentations\r\n      );\r\n    }\r\n\r\n    throw new Error('Unknown viewport type');\r\n  }\r\n\r\n  /**\r\n   * Removes the resize observer from the viewport element\r\n   */\r\n  _removeResizeObserver() {\r\n    if (this.viewportGridResizeObserver) {\r\n      this.viewportGridResizeObserver.disconnect();\r\n    }\r\n  }\r\n\r\n  _getSlabThickness(displaySetOptions, volumeId) {\r\n    const { blendMode } = displaySetOptions;\r\n    if (blendMode === undefined || displaySetOptions.slabThickness === undefined) {\r\n      return;\r\n    }\r\n\r\n    // if there is a slabThickness set as a number then use it\r\n    if (typeof displaySetOptions.slabThickness === 'number') {\r\n      return displaySetOptions.slabThickness;\r\n    }\r\n\r\n    if (displaySetOptions.slabThickness.toLowerCase() === 'fullvolume') {\r\n      // calculate the slab thickness based on the volume dimensions\r\n      const imageVolume = cache.getVolume(volumeId);\r\n\r\n      const { dimensions } = imageVolume;\r\n      const slabThickness = Math.sqrt(\r\n        dimensions[0] * dimensions[0] +\r\n          dimensions[1] * dimensions[1] +\r\n          dimensions[2] * dimensions[2]\r\n      );\r\n\r\n      return slabThickness;\r\n    }\r\n  }\r\n\r\n  _getFrameOfReferenceUID(displaySetInstanceUID) {\r\n    const { displaySetService } = this.servicesManager.services;\r\n    const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n    if (!displaySet) {\r\n      return;\r\n    }\r\n\r\n    if (displaySet.frameOfReferenceUID) {\r\n      return displaySet.frameOfReferenceUID;\r\n    }\r\n\r\n    if (displaySet.Modality === 'SEG') {\r\n      const { instance } = displaySet;\r\n      return instance.FrameOfReferenceUID;\r\n    }\r\n\r\n    if (displaySet.Modality === 'RTSTRUCT') {\r\n      const { instance } = displaySet;\r\n      return instance.ReferencedFrameOfReferenceSequence.FrameOfReferenceUID;\r\n    }\r\n\r\n    const { images } = displaySet;\r\n    if (images && images.length) {\r\n      return images[0].FrameOfReferenceUID;\r\n    }\r\n  }\r\n\r\n  private enqueueViewportResizeRequest() {\r\n    this.resizeQueue.push(false); // false indicates viewport resize\r\n\r\n    clearTimeout(this.viewportResizeTimer);\r\n    this.viewportResizeTimer = setTimeout(() => {\r\n      this.processViewportResizeQueue();\r\n    }, this.gridResizeDelay);\r\n  }\r\n\r\n  private processViewportResizeQueue() {\r\n    const isGridResizeInQueue = this.resizeQueue.some(isGridResize => isGridResize);\r\n    if (this.resizeQueue.length > 0 && !isGridResizeInQueue && !this.gridResizeTimeOut) {\r\n      this.performResize();\r\n    }\r\n\r\n    // Clear the queue after processing viewport resizes\r\n    this.resizeQueue = [];\r\n  }\r\n\r\n  private performResize() {\r\n    const isImmediate = false;\r\n\r\n    try {\r\n      const viewports = this.getRenderingEngine().getViewports();\r\n\r\n      // Store the current position presentations for each viewport.\r\n      viewports.forEach(({ id }) => {\r\n        const presentation = this.getPositionPresentation(id);\r\n        this.beforeResizePositionPresentations.set(id, presentation);\r\n      });\r\n\r\n      // Resize the rendering engine and render.\r\n      const renderingEngine = this.renderingEngine;\r\n      renderingEngine.resize(isImmediate);\r\n      renderingEngine.render();\r\n\r\n      // Reset the camera for viewports that should reset their camera on resize,\r\n      // which means only those viewports that have a zoom level of 1.\r\n      this.beforeResizePositionPresentations.forEach((positionPresentation, viewportId) => {\r\n        this.setPresentations(viewportId, { positionPresentation });\r\n      });\r\n\r\n      // Resize and render the rendering engine again.\r\n      renderingEngine.resize(isImmediate);\r\n      renderingEngine.render();\r\n    } catch (e) {\r\n      // This can happen if the resize is too close to navigation or shutdown\r\n      console.warn('Caught resize exception', e);\r\n    }\r\n  }\r\n\r\n  private resetGridResizeTimeout() {\r\n    clearTimeout(this.gridResizeTimeOut);\r\n    this.gridResizeTimeOut = setTimeout(() => {\r\n      this.gridResizeTimeOut = null;\r\n    }, this.gridResizeDelay);\r\n  }\r\n}\r\n\r\nexport default CornerstoneViewportService;\r\n","import { ColorMapPreset } from './Colormap';\r\n\r\nexport type ColorbarOptions = {\r\n  position: string;\r\n  colormaps: Array<ColorMapPreset>;\r\n  activeColormapName: string;\r\n  ticks: object;\r\n  width: string;\r\n};\r\n\r\nexport type ColorbarProps = {\r\n  viewportId: string;\r\n  displaySets: Array<any>;\r\n  colorbarProperties: ColorbarProperties;\r\n};\r\n\r\nexport type ColorbarProperties = {\r\n  width: string;\r\n  colorbarTickPosition: string;\r\n  colorbarContainerPosition: string;\r\n  colormaps: Array<ColorMapPreset>;\r\n  colorbarInitialColormap: string;\r\n};\r\n\r\nexport enum ChangeTypes {\r\n  Removed = 'removed',\r\n  Added = 'added',\r\n  Modified = 'modified',\r\n}\r\n","import { PubSubService } from '@ohif/core';\r\nimport { RENDERING_ENGINE_ID } from '../ViewportService/constants';\r\nimport { StackViewport, VolumeViewport, getRenderingEngine } from '@cornerstonejs/core';\r\nimport { utilities } from '@cornerstonejs/tools';\r\nimport { ColorbarOptions, ChangeTypes } from '../../types/Colorbar';\r\nconst { ViewportColorbar } = utilities.voi.colorbar;\r\n\r\nexport default class ColorbarService extends PubSubService {\r\n  static EVENTS = {\r\n    STATE_CHANGED: 'event::ColorbarService:stateChanged',\r\n  };\r\n\r\n  static defaultStyles = {\r\n    position: 'absolute',\r\n    boxSizing: 'border-box',\r\n    border: 'solid 1px #555',\r\n    cursor: 'initial',\r\n  };\r\n\r\n  static positionStyles = {\r\n    left: { left: '5%' },\r\n    right: { right: '5%' },\r\n    top: { top: '5%' },\r\n    bottom: { bottom: '5%' },\r\n  };\r\n\r\n  static defaultTickStyles = {\r\n    position: 'left',\r\n    style: {\r\n      font: '12px Arial',\r\n      color: '#fff',\r\n      maxNumTicks: 8,\r\n      tickSize: 5,\r\n      tickWidth: 1,\r\n      labelMargin: 3,\r\n    },\r\n  };\r\n\r\n  public static REGISTRATION = {\r\n    name: 'colorbarService',\r\n    create: () => {\r\n      return new ColorbarService();\r\n    },\r\n  };\r\n  colorbars = {};\r\n\r\n  constructor() {\r\n    super(ColorbarService.EVENTS);\r\n  }\r\n\r\n  /**\r\n   * Adds a colorbar to a specific viewport identified by `viewportId`, using the provided `displaySetInstanceUIDs` and `options`.\r\n   * This method sets up the colorbar, associates it with the viewport, and applies initial configurations based on the provided options.\r\n   *\r\n   * @param viewportId The identifier for the viewport where the colorbar will be added.\r\n   * @param displaySetInstanceUIDs An array of display set instance UIDs to associate with the colorbar.\r\n   * @param options Configuration options for the colorbar, including position, colormaps, active colormap name, ticks, and width.\r\n   */\r\n  public addColorbar(viewportId, displaySetInstanceUIDs, options = {} as ColorbarOptions) {\r\n    const renderingEngine = getRenderingEngine(RENDERING_ENGINE_ID);\r\n    const viewport = renderingEngine.getViewport(viewportId);\r\n    const { element } = viewport;\r\n    const actorEntries = viewport.getActors();\r\n    const { position, width: thickness, activeColormapName, colormaps } = options;\r\n\r\n    const numContainers = displaySetInstanceUIDs.length;\r\n\r\n    const containers = this.createContainers(\r\n      numContainers,\r\n      element,\r\n      position,\r\n      thickness,\r\n      viewportId\r\n    );\r\n\r\n    displaySetInstanceUIDs.forEach((displaySetInstanceUID, index) => {\r\n      const actorEntry = actorEntries.find(entry => entry.uid.includes(displaySetInstanceUID));\r\n      const volumeId = actorEntry?.uid;\r\n      const properties = viewport?.getProperties(volumeId);\r\n      const colormap = properties?.colormap;\r\n      // if there's an initial colormap set, and no colormap on the viewport, set it\r\n      if (activeColormapName && !colormap) {\r\n        this.setViewportColormap(\r\n          viewportId,\r\n          displaySetInstanceUID,\r\n          colormaps[activeColormapName],\r\n          true\r\n        );\r\n      }\r\n\r\n      const colorbarContainer = containers[index];\r\n\r\n      const colorbar = new ViewportColorbar({\r\n        id: `ctColorbar-${viewportId}-${index}`,\r\n        element,\r\n        colormaps: options.colormaps || {},\r\n        // if there's an existing colormap set, we use it, otherwise we use the activeColormapName, otherwise, grayscale\r\n        activeColormapName: colormap?.name || options?.activeColormapName || 'Grayscale',\r\n        container: colorbarContainer,\r\n        ticks: {\r\n          ...ColorbarService.defaultTickStyles,\r\n          ...options.ticks,\r\n        },\r\n        volumeId: viewport instanceof VolumeViewport ? volumeId : undefined,\r\n      });\r\n      if (this.colorbars[viewportId]) {\r\n        this.colorbars[viewportId].push({ colorbar, container: colorbarContainer });\r\n      } else {\r\n        this.colorbars[viewportId] = [{ colorbar, container: colorbarContainer }];\r\n      }\r\n    });\r\n\r\n    this._broadcastEvent(ColorbarService.EVENTS.STATE_CHANGED, {\r\n      viewportId,\r\n      changeType: ChangeTypes.Added,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Removes the colorbar associated with a given viewport ID. This involves cleaning up any created DOM elements and internal references.\r\n   *\r\n   * @param viewportId The identifier for the viewport from which the colorbar will be removed.\r\n   */\r\n  public removeColorbar(viewportId) {\r\n    const colorbarInfo = this.colorbars[viewportId];\r\n    if (!colorbarInfo) {\r\n      return;\r\n    }\r\n\r\n    colorbarInfo.forEach(({ colorbar, container }) => {\r\n      container.parentNode.removeChild(container);\r\n    });\r\n\r\n    delete this.colorbars[viewportId];\r\n\r\n    this._broadcastEvent(ColorbarService.EVENTS.STATE_CHANGED, {\r\n      viewportId,\r\n      changeType: ChangeTypes.Removed,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Checks whether a colorbar is associated with a given viewport ID.\r\n   *\r\n   * @param viewportId The identifier for the viewport to check.\r\n   * @returns `true` if a colorbar exists for the specified viewport, otherwise `false`.\r\n   */\r\n  public hasColorbar(viewportId) {\r\n    return this.colorbars[viewportId] ? true : false;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the current state of colorbars, including all active colorbars and their configurations.\r\n   *\r\n   * @returns An object representing the current state of all colorbars managed by this service.\r\n   */\r\n  public getState() {\r\n    return this.colorbars;\r\n  }\r\n\r\n  /**\r\n   * Retrieves colorbar information for a specific viewport ID.\r\n   *\r\n   * @param viewportId The identifier for the viewport to retrieve colorbar information for.\r\n   * @returns The colorbar information associated with the specified viewport, if available.\r\n   */\r\n  public getViewportColorbar(viewportId) {\r\n    return this.colorbars[viewportId];\r\n  }\r\n\r\n  /**\r\n   * Handles the cleanup and removal of all colorbars from the viewports. This is typically called\r\n   * when exiting the mode or context in which the colorbars are used, ensuring that no DOM\r\n   * elements or references are left behind.\r\n   */\r\n  public onModeExit() {\r\n    const viewportIds = Object.keys(this.colorbars);\r\n    viewportIds.forEach(viewportId => {\r\n      this.removeColorbar(viewportId);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets the colormap for a viewport. This function is used internally to update the colormap the viewport\r\n   *\r\n   * @param viewportId The identifier of the viewport to update.\r\n   * @param displaySetInstanceUID The display set instance UID associated with the viewport.\r\n   * @param colormap The colormap object to set on the viewport.\r\n   * @param immediate A boolean indicating whether the viewport should be re-rendered immediately after setting the colormap.\r\n   */\r\n  private setViewportColormap(viewportId, displaySetInstanceUID, colormap, immediate = false) {\r\n    const renderingEngine = getRenderingEngine(RENDERING_ENGINE_ID);\r\n    const viewport = renderingEngine.getViewport(viewportId);\r\n    const actorEntries = viewport?.getActors();\r\n    if (!viewport || !actorEntries || actorEntries.length === 0) {\r\n      return;\r\n    }\r\n    const setViewportProperties = (viewport, uid) => {\r\n      const actorEntry = actorEntries.find(entry => entry.uid.includes(uid));\r\n      const { actor: volumeActor, uid: volumeId } = actorEntry;\r\n      viewport.setProperties({ colormap, volumeActor }, volumeId);\r\n    };\r\n\r\n    if (viewport instanceof StackViewport) {\r\n      setViewportProperties(viewport, viewportId);\r\n    }\r\n\r\n    if (viewport instanceof VolumeViewport) {\r\n      setViewportProperties(viewport, displaySetInstanceUID);\r\n    }\r\n\r\n    if (immediate) {\r\n      viewport.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates the container elements for colorbars based on the specified parameters. This function dynamically\r\n   * generates and styles DOM elements to host the colorbars, positioning them according to the specified options.\r\n   *\r\n   * @param numContainers The number of containers to create, typically corresponding to the number of colorbars.\r\n   * @param element The DOM element within which the colorbar containers will be placed.\r\n   * @param position The position of the colorbar containers (e.g., 'top', 'bottom', 'left', 'right').\r\n   * @param thickness The thickness of the colorbar containers, affecting their width or height depending on their position.\r\n   * @param viewportId The identifier of the viewport for which the containers are being created.\r\n   * @returns An array of the created container DOM elements.\r\n   */\r\n  private createContainers(numContainers, element, position, thickness, viewportId) {\r\n    const containers = [];\r\n    const dimensions = {\r\n      1: 50,\r\n      2: 33,\r\n    };\r\n    const dimension = dimensions[numContainers] || 50 / numContainers;\r\n\r\n    Array.from({ length: numContainers }).forEach((_, i) => {\r\n      const colorbarContainer = document.createElement('div');\r\n      colorbarContainer.id = `ctColorbarContainer-${viewportId}-${i + 1}`;\r\n\r\n      Object.assign(colorbarContainer.style, ColorbarService.defaultStyles);\r\n\r\n      if (['top', 'bottom'].includes(position)) {\r\n        Object.assign(colorbarContainer.style, {\r\n          width: `${dimension}%`,\r\n          height: thickness || '2.5%',\r\n          left: `${(i + 1) * dimension}%`,\r\n          transform: 'translateX(-50%)',\r\n          ...ColorbarService.positionStyles[position],\r\n        });\r\n      } else if (['left', 'right'].includes(position)) {\r\n        Object.assign(colorbarContainer.style, {\r\n          height: `${dimension}%`,\r\n          width: thickness || '2.5%',\r\n          top: `${(i + 1) * dimension}%`,\r\n          transform: 'translateY(-50%)',\r\n          ...ColorbarService.positionStyles[position],\r\n        });\r\n      }\r\n\r\n      element.appendChild(colorbarContainer);\r\n      containers.push(colorbarContainer);\r\n    });\r\n\r\n    return containers;\r\n  }\r\n}\r\n","import ColorbarService from './ColorbarService';\r\nexport default ColorbarService;\r\n","const zeros = require('zeros')\r\n\r\nconst dcmbufferToPng = (metadata, invertRows=false, useWindowing=true) => {\r\n    const {\r\n        BitsAllocated,\r\n        BitsStored,\r\n        Rows: rows,\r\n        Columns: columns,\r\n        WindowCenter: windowCenter,\r\n        WindowWidth: windowWidth,\r\n        PixelData: pixelData\r\n    } = metadata;\r\n\r\n    // Create the appropriate pixel array based on BitsAllocated\r\n    const pixelArray = BitsAllocated === 16 ? new Int16Array(pixelData) : new Int8Array(pixelData);\r\n\r\n    // Initialize the result array\r\n    const res = zeros([rows, columns]);\r\n\r\n    // Precompute windowing values if they exist\r\n    const hasWindowing = useWindowing && windowCenter && windowWidth;\r\n    const windowMin = windowCenter - 0.5 - (windowWidth - 1) / 2;\r\n    const windowMax = windowCenter - 0.5 + (windowWidth - 1) / 2;\r\n\r\n    const transformPixelValue = (val) => {\r\n        let transformedValue = val;\r\n\r\n        if (hasWindowing) {\r\n            if (val <= windowMin) {\r\n                transformedValue = 0;\r\n            } else if (val > windowMax) {\r\n                transformedValue = 255;\r\n            } else {\r\n                transformedValue = ~~(((val - (windowCenter - 0.5)) / (windowWidth - 1) + 0.5) * 255);\r\n            }\r\n        } else if (BitsAllocated === 16) {\r\n            transformedValue = ((val + 1000) * 2 ** 8) / 2 ** BitsStored;\r\n        }\r\n\r\n        return transformedValue;\r\n    };\r\n\r\n    // Loop through pixels and populate `res`\r\n    for (let i = 0; i < rows; i++) {\r\n        const rowIndex = invertRows ? rows - i - 1 : i;\r\n        for (let j = 0; j < columns; j++) {\r\n            const val = transformPixelValue(pixelArray[i * columns + j]);\r\n            res.set(rowIndex, j, val);\r\n        }\r\n    }\r\n\r\n    return {\r\n        buffer: res,\r\n        height: rows,\r\n        width: columns,\r\n        ext: 'png',\r\n    };\r\n};\r\n\r\nconst pngToCanvas = (pngBuf) => {\r\n    const coloredBuffer = new Uint8ClampedArray(pngBuf.width * pngBuf.height * 4);\r\n    const buffer = pngBuf.buffer.data;\r\n    buffer.forEach((p, i) => {\r\n        coloredBuffer[4 * i] = p;\r\n        coloredBuffer[4 * i + 1] = p;\r\n        coloredBuffer[4 * i + 2] = p;\r\n        coloredBuffer[4 * i + 3] = 255;\r\n    });\r\n\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = pngBuf.width;\r\n    canvas.height = pngBuf.height;\r\n    const imgData = new ImageData(new Uint8ClampedArray(coloredBuffer), pngBuf.width, pngBuf.height);\r\n    canvas.getContext('2d').putImageData(imgData, 0, 0);\r\n\r\n    return canvas;\r\n}\r\n\r\nexport { dcmbufferToPng, pngToCanvas };\r\n","const DEFAULT_OPTIONS = { order: 2, period: null };\r\n\r\n/**\r\n * Determine the coefficient of determination (r^2) of a fit from the observations\r\n * and predictions.\r\n *\r\n * @param {Array<Array<number>>} data - Pairs of observed x-y values\r\n * @param {Array<Array<number>>} results - Pairs of observed predicted x-y values\r\n *\r\n * @return {number} - The r^2 value, or NaN if one cannot be calculated.\r\n */\r\nfunction determinationCoefficient(data, results) {\r\n    const predictions = [];\r\n    const observations = [];\r\n\r\n    data.forEach((d, i) => {\r\n        if (d[1] !== null) {\r\n            observations.push(d);\r\n            predictions.push(results[i]);\r\n        }\r\n    });\r\n\r\n    const sum = observations.reduce((a, observation) => a + observation[1], 0);\r\n    const mean = sum / observations.length;\r\n\r\n    const ssyy = observations.reduce((a, observation) => {\r\n        const difference = observation[1] - mean;\r\n        return a + (difference * difference);\r\n    }, 0);\r\n\r\n    const sse = observations.reduce((accum, observation, index) => {\r\n        const prediction = predictions[index];\r\n        const residual = observation[1] - prediction[1];\r\n        return accum + (residual * residual);\r\n    }, 0);\r\n\r\n    return 1 - (sse / ssyy);\r\n}\r\n\r\n/**\r\n * Determine the solution of a system of linear equations A * x = b using\r\n * Gaussian elimination.\r\n *\r\n * @param {Array<Array<number>>} matrix - A 2-d matrix of data in row-major form [ A | b ]\r\n * @param {number} order - How many degrees to solve for\r\n *\r\n * @return {Array<number>} - Vector of normalized solution coefficients matrix (x)\r\n */\r\nfunction gaussianElimination(matrix, order) {\r\n    const n = matrix.length - 1;\r\n    const coefficients = Array(order);\r\n\r\n    for (let i = 0; i < n; i++) {\r\n        let maxRow = i;\r\n        // Find the pivot row\r\n        for (let j = i + 1; j < n; j++) {\r\n            if (Math.abs(matrix[i][j]) > Math.abs(matrix[i][maxRow])) {\r\n                maxRow = j;\r\n            }\r\n        }\r\n\r\n        // Swap rows\r\n        for (let k = i; k <= n; k++) {\r\n            [matrix[k][i], matrix[k][maxRow]] = [matrix[k][maxRow], matrix[k][i]];\r\n        }\r\n\r\n        // Make upper triangular\r\n        for (let j = i + 1; j < n; j++) {\r\n            for (let k = n; k >= i; k--) {\r\n                // TODO divide by zero\r\n                matrix[k][j] -= (matrix[k][i] * matrix[i][j]) / matrix[i][i];\r\n            }\r\n        }\r\n    }\r\n\r\n    // Backward substitution\r\n    for (let j = n - 1; j >= 0; j--) {\r\n        let total = 0;\r\n        for (let k = j + 1; k < n; k++) {\r\n            total += matrix[k][j] * coefficients[k];\r\n        }\r\n\r\n        coefficients[j] = (matrix[n][j] - total) / matrix[j][j];\r\n    }\r\n\r\n    return coefficients;\r\n}\r\n\r\n/**\r\n * Round a number to a precision, specificed in number of decimal places\r\n *\r\n * @param {number} number - The number to round\r\n * @param {number} precision - The number of decimal places to round to:\r\n *                             > 0 means decimals, < 0 means powers of 10\r\n *\r\n *\r\n * @return {number} - The number, rounded\r\n */\r\nfunction round(number, precision) {\r\n    const factor = 10 ** precision;\r\n    return Math.round(number * factor) / factor;\r\n}\r\n\r\n/**\r\n * The set of all fitting methods\r\n *\r\n * @namespace\r\n */\r\nexport const polynomialLSF = (data, order) => {\r\n    const k = order + 1;\r\n\r\n    // Initialize matrices for lhs and rhs\r\n    const lhs = Array(k).fill(0);\r\n    const rhs = Array.from({ length: k }, () => Array(k).fill(0));\r\n\r\n    // Build the lhs and rhs matrices\r\n    for (let i = 0; i < k; i++) {\r\n        for (let j = 0; j < k; j++) {\r\n            rhs[i][j] = data.reduce((sum, point) => point.y !== null ? sum + point.x ** (i + j) : sum, 0);\r\n        }\r\n        lhs[i] = data.reduce((sum, point) => point.y !== null ? sum + (point.x ** i) * point.y : sum, 0);\r\n    }\r\n\r\n    rhs.push(lhs);\r\n\r\n    // Calculate coefficients using Gaussian elimination\r\n    const coefficients = gaussianElimination(rhs, k).map(v => v);\r\n\r\n    // Define prediction function\r\n    const predict = (x) => coefficients.reduce((sum, coeff, power) => sum + (coeff * x ** power), 0);\r\n\r\n    return {\r\n        predict,\r\n        equation: [...coefficients].reverse(),\r\n    };\r\n};\r\n","import { Dentascan } from 'extensions/cornerstone/src/types/Panoramic';\r\n\r\nconst derivative = (f, x, dx = 1e-5) => {\r\n    return (f(x + dx) - f(x)) / dx;\r\n}\r\n\r\nconst getSlopeVector = (slope) => {\r\n    const [vx, vy] = [1, slope];\r\n    const vLength = Math.sqrt(1 + slope * slope);\r\n    return [vx / vLength, vy / vLength];\r\n}\r\n\r\nexport const getTangentVector = (f, x) => {\r\n    const tangentSlope = derivative(f, x);\r\n    return getSlopeVector(tangentSlope);\r\n}\r\n\r\nexport const getNormalVector = (f, x) => {\r\n    const tangentSlope = derivative(f, x);\r\n    const normalSlope = -1 / tangentSlope;\r\n    return getSlopeVector(normalSlope);\r\n}\r\n\r\nconst interpolatePoints = (v1, v2, t) => {\r\n    return Math.round(t * v1 + (1 - t) * v2);\r\n}\r\n\r\nconst interpolateThreePoints = (v1, v2, vMid, tMin, tMax) => {\r\n    return Math.round(tMin * v1 + (tMax - tMin) * vMid + (1 - tMax) * v2);\r\n}\r\n\r\n// Get dentascan section at abscissa i for a polynomial fitting curve lsf.\r\n// Length of normal is dentascanThickness\r\n// Dicom of the dentascan desired is defined by its dicomDimensions and its scalarData\r\nexport const getDentascanSection = (x, lsfDentalCurve, dicomData, p, dentascanThickness) => {\r\n    // Get normalized vector of normal at x\r\n    let [vxNormal, vyNormal] = getNormalVector(lsfDentalCurve, x);\r\n\r\n    // In order to prevent having a flipped normal vector,\r\n    // we need to determine if minPoint lies inside or outside the curve\r\n    // We want minPoint to be the outer point and maxPoint to be the inner point\r\n    const y = lsfDentalCurve(x);\r\n    let minPoint: [number, number] = [x - dentascanThickness / 2 * vxNormal,\r\n                                      y - dentascanThickness / 2 * vyNormal];\r\n    let maxPoint: [number, number] = [x + dentascanThickness / 2 * vxNormal,\r\n                                      y + dentascanThickness / 2 * vyNormal];\r\n    // Swap minPoint and maxPoint and invert normal vectors if minPoint is inner\r\n    if (vyNormal < 0) {\r\n        [minPoint, maxPoint] = [maxPoint, minPoint];\r\n        [vxNormal, vyNormal] = [-vxNormal, -vyNormal];\r\n    }\r\n\r\n    // Get values of point along normal between min and max\r\n    const dentascanWidth = 2 * dentascanThickness; // Anti-Aliasing\r\n    const dentascan = new Float32Array(dentascanWidth * p.nbLayers).fill(-1000);\r\n    for (let layer = 0; layer < p.nbLayers; layer++) {\r\n        for (let i = 0; i < dentascanWidth; i += 1) {\r\n            const xi = minPoint[0] + (i / 2) * vxNormal;\r\n            const yi = minPoint[1] + (i / 2) * vyNormal;\r\n            const xj = minPoint[0] + ((i + 1) / 2) * vxNormal;\r\n            const yj = minPoint[1] + ((i + 1) / 2) * vyNormal;\r\n            const [pxi, pxj, pyi, pyj] = [Math.floor(xi), Math.floor(xj), Math.floor(yi), Math.floor(yj)]\r\n            if (xi >= 0 && yi >= 0 && xj < p.layerWidth && yj < p.layerHeight) {\r\n                const dicomIdxI = (p.minLayer + layer) * p.layerSize + pyi * p.layerWidth + pxi;\r\n                if (pxi === pxj && pyi === pyj) {\r\n                    // Same pixel\r\n                    dentascan[layer * dentascanWidth + i] = dicomData[dicomIdxI];\r\n                } else if (pyi === pyj) {\r\n                    // Horizontal interpolation\r\n                    const tx = (pxi < pxj) ? (1 - xi % 1) / vxNormal : -(xi % 1) / vxNormal; // Ratio of segment within pxi\r\n                    const dicomIdxJ = (p.minLayer + layer) * p.layerSize + pyi * p.layerWidth + pxj;\r\n                    dentascan[layer * dentascanWidth + i] = interpolatePoints(dicomData[dicomIdxI], dicomData[dicomIdxJ], tx);\r\n                } else if (pxi === pxj) {\r\n                    // Vertical interpolation\r\n                    const ty = (pyi < pyj) ? (1 - yi % 1) / vyNormal : -(yi % 1) / vyNormal; // Ratio of segment within pyi\r\n                    const dicomIdxJ = (p.minLayer + layer) * p.layerSize + pyj * p.layerWidth + pxi;\r\n                    dentascan[layer * dentascanWidth + i] = interpolatePoints(dicomData[dicomIdxI], dicomData[dicomIdxJ], ty);\r\n                } else {\r\n                    // Diagonal interpolation\r\n                    const tx = (pxi < pxj) ? (1 - xi % 1) / vxNormal : -(xi % 1) / vxNormal;\r\n                    const ty = (pyi < pyj) ? (1 - yi % 1) / vyNormal : -(yi % 1) / vyNormal;\r\n                    const dicomIdxJ = (p.minLayer + layer) * p.layerSize + pyj * p.layerWidth + pxj;\r\n                    const dicomIdxK = tx < ty\r\n                        ? (p.minLayer + layer) * p.layerSize + pyi * p.layerWidth + pxj\r\n                        : (p.minLayer + layer) * p.layerSize + pyj * p.layerWidth + pxi;\r\n                    const tMin = Math.min(tx, ty);\r\n                    const tMax = Math.max(tx, ty);\r\n                    dentascan[layer * dentascanWidth + i] = interpolateThreePoints(dicomData[dicomIdxI], dicomData[dicomIdxJ],\r\n                                                                                   dicomData[dicomIdxK], tMin, tMax);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const dentascanObject: Dentascan = {\r\n        dentascan: dentascan,\r\n        width: dentascanWidth,\r\n        height: p.nbLayers,\r\n        interval: [minPoint, maxPoint],\r\n        direction: [vxNormal, vyNormal],\r\n        middlePoint: [x, y],\r\n        minLayer: p.minLayer,\r\n    };\r\n\r\n    return dentascanObject;\r\n}","import {DicomMetadataStore, OHIF, ViewportGridService} from '@ohif/core';\r\nimport {ToolGroupManager} from '@cornerstonejs/tools';\r\nimport {applySmoothing, blurPanoramic, cubicSplineInterpolation, sharpen} from './computePanoramicUtils.js'\r\nimport FileLoaderService from '../../../../../platform/app/src/routes/Local/fileLoaderService.js'\r\nimport {dcmbufferToPng, pngToCanvas} from './pngUtils.js'\r\nimport {polynomialLSF} from './computeDentalCurveUtils.js'\r\nimport {PanoramicState} from '../../../../cornerstone/src/types/Panoramic'\r\nimport {CONSTANTS, metaData, VolumeViewport} from '@cornerstonejs/core'\r\nimport {getTangentVector, getDentascanSection, getNormalVector} from './computeDentascansUtils'\r\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData.js';\r\n\r\nconst skmeans = require('skmeans');\r\nconst metadataProvider = OHIF.classes.MetadataProvider;\r\n\r\ninterface POINTS {\r\n    controlPoints: number[][];\r\n    curvePoints: number[][];\r\n    outerPoints: number[][];\r\n    innerPoints: number[][];\r\n}\r\n\r\ninterface CONSTANTS {\r\n    NUMBER_BASE_POINTS: number;\r\n    DENTASCAN_THICKNESS: number;\r\n    DENTAL_CURVE_THICKNESS: number;\r\n    DENTASCAN_THRESHOLD_VALUE: number;\r\n    AIP_THRESHOLD_VALUE: number;\r\n    TOLERANCE: number;\r\n    DENTAL_CURVES_STEP: number;\r\n    AXIAL_CURVES_STEP: number;\r\n    DENTAL_CURVE_AIP_STEP: number;\r\n    DENTAL_CURVE_AIP_THICKNESS: number;\r\n}\r\nlet constants: CONSTANTS | null = null;\r\n\r\nfunction initializeConstants(volumeSpacing) {\r\n    constants = {\r\n        NUMBER_BASE_POINTS: 11,\r\n        DENTASCAN_THICKNESS: Math.round(28 / volumeSpacing),\r\n        DENTAL_CURVE_THICKNESS: Math.round(16 / volumeSpacing),\r\n        DENTASCAN_THRESHOLD_VALUE: 1100,\r\n        AIP_THRESHOLD_VALUE: 70,\r\n        TOLERANCE: 0.0001,\r\n        DENTAL_CURVES_STEP: 1,\r\n        AXIAL_CURVES_STEP: 1,\r\n        DENTAL_CURVE_AIP_STEP: 2,\r\n        DENTAL_CURVE_AIP_THICKNESS: Math.round(16 / volumeSpacing),\r\n    }\r\n}\r\n\r\nfunction waitCondition(condition) {\r\n    return new Promise((resolve, reject) => {\r\n        const wait = () => {\r\n            const result = condition();\r\n            if (result) {\r\n                return resolve(result);\r\n            } else {\r\n                setTimeout(() => wait(), 50);\r\n            }\r\n        }\r\n        wait();\r\n    });\r\n}\r\n\r\nconst createDataset = (canvas, datasetOptions) => {\r\n    return new Promise((resolve, reject) => {\r\n        canvas.toBlob(async (blob) => {\r\n            const fileLoaderService = new FileLoaderService(blob);\r\n            const imageId = fileLoaderService.addFile(blob);\r\n            const img = await fileLoaderService.loadFile(blob, imageId);\r\n            const dataset = await fileLoaderService.getDataset(img, imageId, datasetOptions);\r\n            await waitCondition(() => dataset.imageId);\r\n\r\n            const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = dataset;\r\n            metadataProvider.addImageIdToUIDs(imageId, {\r\n                StudyInstanceUID,\r\n                SeriesInstanceUID,\r\n                SOPInstanceUID,\r\n                frameIndex: dataset.NumberOfFrames > 1 ? dataset.InstanceNumber : 1,\r\n            });\r\n            resolve(dataset);\r\n        });\r\n    });\r\n}\r\n\r\nconst createViewportData = async (datasets, viewportType, { extensionManager, servicesManager }, initialImageIndex?) => {\r\n    const { displaySetService, cornerstoneCacheService } = servicesManager.services;\r\n\r\n    DicomMetadataStore.addInstances(datasets);\r\n    const activeDisplaySets = displaySetService.getActiveDisplaySets();\r\n    const displaySetAdded = [activeDisplaySets[activeDisplaySets.length - 1]];\r\n    const viewportOptions = {\r\n        toolGroupId: 'mpr',\r\n        viewportType: viewportType,\r\n        orientation: 'axial',\r\n        initialImageOptions: {\r\n            preset: 'middle',\r\n        },\r\n    };\r\n    const dataSource = extensionManager.getDataSources()[0];\r\n    const viewportData = await cornerstoneCacheService.createViewportData(\r\n        displaySetAdded,\r\n        viewportOptions,\r\n        dataSource,\r\n        initialImageIndex\r\n    );\r\n\r\n    return viewportData;\r\n}\r\n\r\nconst loadMultipleBlobsInViewport = async (metadata, { extensionManager, servicesManager }) => {\r\n    const options = {\r\n        prefilledValues:{\r\n            SeriesInstanceUID: metadata.SeriesInstanceUID,\r\n            StudyInstanceUID: metadata.StudyInstanceUID,\r\n            SOPInstanceUID: Math.random().toString(36).substring(2, 10),\r\n            FrameOfReferenceUID: Math.random().toString(36).substring(2, 10)\r\n        }\r\n    };\r\n    const nbBlobs = metadata.PixelData.length;\r\n    const initialImageIndex = Math.round(nbBlobs / 2);\r\n\r\n    const datasets = await Promise.all(\r\n        metadata.PixelData.map(async (layerData, layerI) => {\r\n            const layerSopInstanceUID = `${options.prefilledValues.SOPInstanceUID}.${layerI + 1}`;\r\n            const datasetOptions = {\r\n                prefilledValues: {\r\n                    ...options.prefilledValues,\r\n                    SOPInstanceUID: layerSopInstanceUID,\r\n                    InstanceNumber: layerI + 1,\r\n                    ImagePositionPatient: [ 0, 0, 0.4 * layerI]\r\n                }\r\n            };\r\n\r\n            const pngBuf = await dcmbufferToPng({ ...metadata, PixelData: layerData }, true);\r\n            const canvas = pngToCanvas(pngBuf);\r\n            const dataset = await createDataset(canvas, datasetOptions);\r\n\r\n            return dataset;\r\n        })\r\n    );\r\n    const viewportData = await createViewportData(datasets, 'volume', { extensionManager, servicesManager }, initialImageIndex);\r\n    return viewportData;\r\n}\r\n\r\nconst loadBlobInViewport = async (metadata, { extensionManager, servicesManager }) => {\r\n    const datasetOptions = {\r\n        prefilledValues: {\r\n            SeriesInstanceUID: metadata.SeriesInstanceUID,\r\n            StudyInstanceUID: metadata.StudyInstanceUID\r\n        }\r\n    }\r\n    const pngBuf = await dcmbufferToPng(metadata);\r\n    const canvas = pngToCanvas(pngBuf);\r\n    const dataset = await createDataset(canvas, datasetOptions);\r\n    const datasets = new Array(metadata.Columns).fill(dataset);\r\n    const initialImageIndex = Math.round(metadata.Columns / 2);\r\n    const viewportData = await createViewportData(datasets, 'stack', { extensionManager, servicesManager }, initialImageIndex);\r\n    return viewportData;\r\n}\r\n\r\n//____________________________ FOR PANORAMIC COMPUTATION _________________________//\r\n\r\nconst getMax = (arr) => {\r\n    let len = arr.length;\r\n    let max = -Infinity;\r\n\r\n    while (len--) {\r\n        max = arr[len] > max ? arr[len] : max;\r\n    }\r\n    return max;\r\n}\r\n\r\n// Width becomes height, and height becomes width\r\nconst transposeImage = (arr, width, height) => {\r\n    const transposedArr = [];\r\n    for (let i = 0; i < width; i++) {\r\n        for (let j = 0; j < height; j++) {\r\n            transposedArr.push(arr[j * width + i]);\r\n        }\r\n    }\r\n    return transposedArr;\r\n}\r\n\r\n// Returns the scalar data projected on the sagittal axis, using the max of values along X axis\r\nconst getSagittalDataMax = (scalarData, p) => {\r\n    const sagittalData = new Float32Array(p.layerHeight * p.nbLayers);\r\n    // Iterate over Y and Z axes\r\n    for (let k = 0; k < p.nbLayers; k++) {\r\n        for (let j = 0; j < p.layerHeight; j++) {\r\n            // Store max value along axis in sagittalData\r\n            let maxVal = -Infinity;\r\n            for (let i = 0; i < p.layerWidth; i++) {\r\n                const value = scalarData[(k + p.minLayer) * p.layerSize + j * p.layerWidth + i];\r\n                if (value > maxVal) {\r\n                    maxVal = value;\r\n                }\r\n            }\r\n            sagittalData[k * p.layerHeight + j] = maxVal;\r\n        }\r\n    }\r\n\r\n    return sagittalData;\r\n}\r\n\r\n// Returns the scalar data projected on the coronal axis, using the max of values along X axis\r\nconst getCoronalDataMax = (scalarData, p) => {\r\n    const coronalData = new Float32Array(p.layerWidth * p.nbLayers);\r\n    // Iterate over Y and Z axes\r\n    for (let k = 0; k < p.nbLayers; k++) {\r\n        for (let j = 0; j < p.layerWidth; j++) {\r\n            // Store max value along axis in coronalData\r\n            let maxVal = -Infinity;\r\n            for (let i = 0; i < p.layerHeight; i++) {\r\n                const value = scalarData[(k + p.minLayer) * p.layerSize + j * p.layerHeight + i];\r\n                if (value > maxVal) {\r\n                    maxVal = value;\r\n                }\r\n            }\r\n            coronalData[k * p.layerHeight + j] = maxVal;\r\n        }\r\n    }\r\n\r\n    return coronalData;\r\n}\r\n\r\n// Returns the scalar data projected on the axial axis,\r\n// using the mean values along Z axis between minLayer and maxLayer\r\nconst getAxialDataMean = (scalarData, minLayer, maxLayer, p) => {\r\n    const nbToothLayers = maxLayer - minLayer;\r\n\r\n    const axialData = new Float32Array(p.layerWidth * p.layerHeight);\r\n    // Iterate over X and Y axes\r\n    for (let i = 0; i < p.layerWidth; i++) {\r\n        for (let j = 0; j < p.layerHeight; j++) {\r\n            // Store average value along axis in axialData\r\n            let sumVal = 0;\r\n            for (let k = 0; k < nbToothLayers; k++) {\r\n                sumVal += scalarData[(minLayer + k) * p.layerSize + j * p.layerWidth + i];\r\n            }\r\n            axialData[j * p.layerWidth + i] = sumVal / nbToothLayers;\r\n        }\r\n    }\r\n\r\n    return axialData;\r\n}\r\n\r\n// I want to ensure that the polynomial does not diverge beyond the teeth zone.\r\n// The goal is to smooth out and converge the polynomial on the center outside the given interval while\r\n// preserving its original behavior within the interval [minX, maxX].\r\n// To achieve this, I use a modified function incorporating two sigmoid functions.\r\nconst getDentalLiss = (f, minX, maxX) => {\r\n    const dentascanWidth = constants.DENTASCAN_THICKNESS;\r\n    // a1 and a2 are smoothing parameters.\r\n    const a1 = 0.1;\r\n    const a2 = 0.1;\r\n    // c0 is the convergence on -inf, and c1 and +inf\r\n    const c0 = dentascanWidth / 2;\r\n    const c1 = dentascanWidth / 2;\r\n\r\n    return (layer) => {\r\n        const sigmoidLeft = 1 / (1 + Math.exp(-a1 * (layer - minX)));\r\n        const sigmoidRight = 1 / (1 + Math.exp(a2 * (layer - maxX)));\r\n        const originalDentalValue = f(layer);\r\n\r\n        return originalDentalValue * sigmoidLeft * sigmoidRight\r\n            + c0 * (1 - sigmoidLeft) + c1 * (1 - sigmoidRight);\r\n    }\r\n}\r\n\r\nconst getDentalCurve = (dentascan, p) => {\r\n    const dentascanWidth = constants.DENTASCAN_THICKNESS;\r\n\r\n    // Compute dental curve\r\n    // Dentascan is thresholded to get only bone area\r\n    const binarizedDentascan = dentascan.map(value => value > constants.DENTASCAN_THRESHOLD_VALUE ? value : -1000);\r\n    // Transposed so that w => h and h => w. This allows us to LSF with a curve represented by an order 3 equation\r\n    const transposedBin = transposeImage(binarizedDentascan, dentascanWidth, p.nbLayers);\r\n    // Get the indexes of teeth zone and keep only indexes that are teeth (!= -1000)\r\n    let transposedOnlyTeethIndex = Array.from(transposedBin).map((value, idx) => value === -1000 ? null\r\n        : ({ x: idx % p.nbLayers, y: Math.floor(idx / p.nbLayers) })).filter(value => value);\r\n\r\n    // Add points along the center of the dentascan to reduce the deformation of the curve\r\n    for (let l = 0; l < p.nbLayers; l += 10) {\r\n        transposedOnlyTeethIndex.push({ x: l, y: Math.floor(constants.DENTASCAN_THICKNESS / 2) });\r\n    }\r\n\r\n    // Curve fitting on a degree 3 polynomial\r\n    let lsfDentalCurve = polynomialLSF(transposedOnlyTeethIndex, 3);\r\n    // TODO order should depend on error for the curve fitting\r\n\r\n    let lsfDentalLiss = (x) => constants.DENTASCAN_THICKNESS / 2;\r\n    if (getMax(transposedBin) > -1000 && !lsfDentalCurve.equation.some((value) => isNaN(value))) {\r\n        // minX and maxX where value is not -1000\r\n        const minX = transposedBin.reduce((min, val, idx) =>\r\n            ((idx % p.nbLayers < min && val != -1000) ? idx % p.nbLayers : min), Infinity);\r\n        const maxX = transposedBin.reduce((max, val, idx) =>\r\n            ((idx % p.nbLayers > max && val != -1000) ? idx % p.nbLayers : max), -Infinity);\r\n        lsfDentalLiss = getDentalLiss(lsfDentalCurve.predict, minX, maxX);\r\n    }\r\n\r\n    return lsfDentalLiss;\r\n}\r\n\r\nconst getDentalCurvesPointsXY = (dentascans, mode, p) => {\r\n    const nbDentalCurves = Math.floor(p.panoramicWidth / constants.DENTAL_CURVES_STEP);\r\n    const nbAxialCurves = Math.floor(p.nbLayers / constants.AXIAL_CURVES_STEP);\r\n\r\n    let dentalCurvesPoints;\r\n    if (mode === 'curveAIP') {\r\n        // Precompute the values\r\n        dentalCurvesPoints = new Float32Array(p.panoramicWidth * p.nbLayers);\r\n        dentascans.forEach((dentascan, idx) => {\r\n            const dentascanCurve = getDentalCurve(dentascan.dentascan, p);\r\n            for (let layer = 0; layer < p.nbLayers; layer++) {\r\n                dentalCurvesPoints[idx * p.nbLayers + layer] = dentascanCurve(layer);\r\n            }\r\n        });\r\n    }\r\n\r\n    const dentalCurvesPointsXY = new Array(nbDentalCurves * nbAxialCurves).fill(null);\r\n    for (let i = 0; i < nbDentalCurves; i++) {\r\n        const idx = constants.DENTAL_CURVES_STEP * i;\r\n        const dentascan = dentascans[idx];\r\n        const [dentascanMinPoint, dentascanMaxPoint] = dentascan.interval;\r\n        const [dentascanVxNormal, dentascanVyNormal] = dentascan.direction;\r\n        const idxInf = Math.max(idx - Math.floor(constants.DENTAL_CURVE_AIP_THICKNESS / 2), 0);\r\n        const idxSup = Math.min(idx + Math.floor(constants.DENTAL_CURVE_AIP_THICKNESS / 2), p.panoramicWidth - 1);\r\n\r\n        let dentalCurve;\r\n        if (mode === 'default') {\r\n            dentalCurve = getDentalCurve(dentascan.dentascan, p);\r\n\r\n        } else if (mode === 'valueMIP') {\r\n            let dentascansForMIP = [];\r\n            for (let j = idxInf; j <= idxSup; j += constants.DENTAL_CURVE_AIP_STEP) {\r\n                dentascansForMIP.push(dentascans[i].dentascan);\r\n            }\r\n            const dentascanMIP = new Float32Array(dentascan.length);\r\n            for (let j = 0; j < dentascan.length; j++) {\r\n                dentascanMIP[j] = getMax(dentascansForMIP.map(dentascanScalar => dentascanScalar[j]));\r\n            }\r\n            dentalCurve = getDentalCurve(dentascanMIP, p);\r\n        }\r\n\r\n        for (let l = 0; l < nbAxialCurves; l++) {\r\n            const layer = constants.AXIAL_CURVES_STEP * l;\r\n\r\n            let xPosInDentascan;\r\n            if (mode === 'curveAIP') {\r\n                let xPosInDentascans = [];\r\n                for (let j = idxInf; j <= idxSup; j += constants.DENTAL_CURVE_AIP_STEP) {\r\n                    xPosInDentascans.push(dentalCurvesPoints[j * p.nbLayers + layer]);\r\n                }\r\n                xPosInDentascan = xPosInDentascans.reduce((a, b) => a + b, 0) / xPosInDentascans.length;\r\n            } else { // default or valueMIP\r\n                xPosInDentascan = dentalCurve(layer);\r\n            }\r\n            if (xPosInDentascan < 0) {\r\n                xPosInDentascan = 0;\r\n            } else if (xPosInDentascan > constants.DENTASCAN_THICKNESS) {\r\n                xPosInDentascan = constants.DENTASCAN_THICKNESS;\r\n            }\r\n            const x = dentascanMinPoint[0] + xPosInDentascan * dentascanVxNormal;\r\n            const y = dentascanMinPoint[1] + xPosInDentascan * dentascanVyNormal;\r\n\r\n            dentalCurvesPointsXY[l * nbDentalCurves + i] = {x: x, y: y, xpos: xPosInDentascan};\r\n        }\r\n    }\r\n\r\n    return dentalCurvesPointsXY;\r\n}\r\n\r\n// Dilate bone zone to eventually fill disconnections in dental zone\r\nconst dilate = (image, width, height, iterations) => {\r\n    const result = new Array(width * height).fill(-1000);\r\n\r\n    const getPixel = (x, y) => image[y * width + x] || 0;\r\n\r\n    for (let iteration = 0; iteration < iterations; iteration++) {\r\n        for (let y = 1; y < height - 1; y++) {\r\n            for (let x = 1; x < width - 1; x++) {\r\n                const neighbors = [\r\n                    getPixel(x - 1, y - 1), getPixel(x, y - 1), getPixel(x + 1, y - 1),\r\n                    getPixel(x - 1, y), getPixel(x, y), getPixel(x + 1, y),\r\n                    getPixel(x - 1, y + 1), getPixel(x, y + 1), getPixel(x + 1, y + 1)\r\n                ];\r\n\r\n                result[y * width + x] = Math.max(...neighbors);\r\n            }\r\n        }\r\n\r\n        // Mettre à jour l'image pour la prochaine itération\r\n        for (let i = 0; i < width * height; i++) {\r\n            image[i] = result[i];\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n// TODO O(2n) algorithm\r\n// Get spatial clusters in binarized image (groups of pixels connected between them)\r\nconst spatialClustering = (image, width, height) => {\r\n    const clusters = [];\r\n    const visited = new Array(width * height).fill(false);\r\n\r\n    const getNeighbors = (index) => {\r\n        const neighbors = [];\r\n        const x = index % width;\r\n        const y = Math.floor(index / width);\r\n\r\n        for (let i = Math.max(0, x - 1); i <= Math.min(width - 1, x + 1); i++) {\r\n            for (let j = Math.max(0, y - 1); j <= Math.min(height - 1, y + 1); j++) {\r\n                const neighborIndex = j * width + i;\r\n                neighbors.push(neighborIndex);\r\n            }\r\n        }\r\n\r\n        return neighbors;\r\n    };\r\n\r\n    const exploreCluster = (startIndex, cluster) => {\r\n        const queue = [startIndex];\r\n\r\n        while (queue.length > 0) {\r\n            const currentIndex = queue.shift();\r\n\r\n            if (!visited[currentIndex] && image[currentIndex] !== -1000) {\r\n                visited[currentIndex] = true;\r\n                cluster.push(currentIndex);\r\n\r\n                const neighbors = getNeighbors(currentIndex);\r\n\r\n                for (const neighborIndex of neighbors) {\r\n                    if (!visited[neighborIndex] && image[neighborIndex] !== -1000) {\r\n                        queue.push(neighborIndex);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (!visited[i] && image[i] !== -1000) {\r\n            const newCluster = [];\r\n            exploreCluster(i, newCluster);\r\n            clusters.push(newCluster);\r\n        }\r\n    }\r\n\r\n    return clusters;\r\n}\r\n\r\nconst addControlPointAnnotations = (viewport: VolumeViewport, imageData: vtkImageData, points: POINTS, middleLayer: number) => {\r\n    // Transpose control points from volume basis to viewport canvas basis\r\n    const { controlPoints, curvePoints, outerPoints, innerPoints } = points;\r\n\r\n    // Draw these control points in front on Viewport so that user can move them\r\n    // Get ArrowAnnotate instance in order to create new interpolated annotation\r\n    const annotationUIDs: string[] = [];\r\n    const toolGroup = ToolGroupManager.getToolGroupForViewport(viewport.id, viewport.renderingEngineId);\r\n    const arrowAnnotateInstance = toolGroup.getToolInstance('ArrowAnnotate');\r\n\r\n    const addAnnotation = (pointsSet: number[][], mode: string) => {\r\n        const pointsInWorld = pointsSet.map(cp => imageData.indexToWorld([cp[0], cp[1], middleLayer]));\r\n        const pointAnnotation = arrowAnnotateInstance.addNewAnnotationWithMode(\r\n            viewport.element, pointsInWorld, mode, 'rgb(0, 255, 0)'\r\n        );\r\n        annotationUIDs.push(pointAnnotation.annotationUID);\r\n    }\r\n\r\n    addAnnotation(controlPoints, 'movable');\r\n    for (const pointsSet of [curvePoints, outerPoints, innerPoints]) {\r\n        addAnnotation(pointsSet, 'points');\r\n    }\r\n\r\n    return annotationUIDs;\r\n}\r\n\r\nconst deleteControlPointAnnotations = (viewport: VolumeViewport, annotationUIDs: string[]) => {\r\n    const toolGroup = ToolGroupManager.getToolGroupForViewport(viewport.id, viewport.renderingEngineId);\r\n    const arrowAnnotateInstance = toolGroup.getToolInstance('ArrowAnnotate');\r\n\r\n    for (const annotationUID of annotationUIDs) {\r\n        arrowAnnotateInstance.removeArrowAnnotation(annotationUID);\r\n    }\r\n}\r\n\r\nconst computeControlPoints = (f: Function, bounds: number[][]) => {\r\n    // Compute control points : points that determine piecewise linear curve function through f\r\n    // They are also the points drawn in Viewport so that user can modify if the curve is not correct\r\n    // Curve control points are only used to display a pretty curve\r\n    const curvePoints: number[][] = [];\r\n    const innerPoints: number[][] = [];\r\n    const outerPoints: number[][] = [];\r\n\r\n    const [[minX, maxX], [minY, maxY]] = bounds;\r\n    let x = maxX;\r\n    do {\r\n        let y = f(x);\r\n        y = Math.min(Math.max(y, minY), maxY);\r\n        curvePoints.push([x, y]);\r\n\r\n        // Determine inner curve and outer curve\r\n        const [vxNormal, vyNormal] = getNormalVector(f, x);\r\n        let minPoint = [x - constants.DENTASCAN_THICKNESS / 2 * vxNormal, y - constants.DENTASCAN_THICKNESS / 2 * vyNormal];\r\n        let maxPoint = [x + constants.DENTASCAN_THICKNESS / 2 * vxNormal, y + constants.DENTASCAN_THICKNESS / 2 * vyNormal];\r\n        // Swap minPoint and maxPoint if minPoint is inner\r\n        if (vyNormal < 0) {\r\n            [minPoint, maxPoint] = [maxPoint, minPoint];\r\n        }\r\n        outerPoints.push(minPoint);\r\n        innerPoints.push(maxPoint);\r\n\r\n        x -= getTangentVector(f, x)[0];\r\n    } while (x > minX);\r\n    const controlPoints: number[][] = [];\r\n    const step = (curvePoints.length - 1) / (constants.NUMBER_BASE_POINTS - 1);\r\n    for (let i = 0; i < curvePoints.length + constants.TOLERANCE; i += step) {\r\n        controlPoints.push(curvePoints[Math.floor(i)]);\r\n    }\r\n\r\n    const points: POINTS =\r\n        { controlPoints: controlPoints, curvePoints: curvePoints, outerPoints: outerPoints, innerPoints: innerPoints };\r\n\r\n    return points;\r\n}\r\n\r\n// Computation of panoramic control points, which are points in the dental curve\r\n// from where panoramic will be computed\r\nconst createControlPoints = async ({ servicesManager }) => {\r\n    const { cornerstoneViewportService, panoramicService } = servicesManager.services;\r\n\r\n    const { displaySetInstanceUID, volume } =\r\n        cornerstoneViewportService.getViewportInfo('default').getViewportData().data[0];\r\n    const { scalarData, dimensions, imageData, spacing } = volume;\r\n    const [layerWidth, layerHeight, _] = dimensions;\r\n\r\n    initializeConstants(Math.min(...spacing));\r\n\r\n    const minLayer = Math.floor(scalarData.findIndex((value) => value > -1000) / layerWidth / layerHeight);\r\n    const maxLayer = Math.floor(scalarData.findLastIndex((value) => value > -1000) / layerWidth / layerHeight) + 1;\r\n    // Ignore rows with empty data\r\n     const parameters = {layerWidth: layerWidth, layerHeight: layerHeight, layerSize: layerWidth * layerHeight,\r\n                        minLayer: minLayer, nbLayers: maxLayer - minLayer, };\r\n\r\n    const coronalData = getCoronalDataMax(scalarData, parameters);\r\n\r\n    // We select the highest value cluster on coronal view with a K-means++\r\n    const skMeansCoronal = skmeans(coronalData, 6);\r\n    const {centroids:centroidsCoronal, idxs:idxsCoronal} = skMeansCoronal\r\n    const idxsMaxCoronal = centroidsCoronal.indexOf(Math.max(...centroidsCoronal))\r\n    // Find minimal and maximal layer where one pixel is not -1000\r\n    const minTissueLayer = minLayer + Math.floor(idxsCoronal.findIndex((value) => value === idxsMaxCoronal) / layerHeight);\r\n    const maxTissueLayer = minLayer + Math.floor(idxsCoronal.findLastIndex((value) => value === idxsMaxCoronal) / layerHeight) + 1;\r\n    console.log('MINLAYER, MAXLAYER', minTissueLayer, maxTissueLayer);\r\n    console.log('CENTROIDS', centroidsCoronal);\r\n    // TODO assert minLayer !== maxLayer\r\n\r\n    const axialData = getAxialDataMean(scalarData, minTissueLayer, maxTissueLayer, parameters);\r\n\r\n    // K-means++ in AIP axial image data to isolate bone / jaw zone\r\n    const skMeansResult = skmeans(axialData, 5);\r\n    const {centroids, idxs} = skMeansResult\r\n    const maxClusterIdx = centroids.indexOf(getMax(centroids))\r\n\r\n    // Binarize array between max cluster (highest values meaning bone pixels) and other\r\n    let binarizedArray = Array.from(axialData.map((value, idx) => idxs[idx] === maxClusterIdx ? value : -1000));\r\n\r\n    const binarizedArrayDilated = dilate(binarizedArray, layerWidth, layerHeight, 5);\r\n\r\n    // Find equation of polynomial going through dental zone with the use of the biggest spatial cluster\r\n    // corresponding to our dental zone\r\n    /* const binarizedIdx = binarizedArray.map((value, idx) => value != -1000? idx: -1000);\r\n    const filteredIdx = binarizedIdx.filter((value) => value != -1000);\r\n    const binarizedXy = Array.from(filteredIdx).map(i => ({ x: i % layerWidth, y: Math.floor(i / layerWidth) }));*/\r\n\r\n    const spatialClusters = spatialClustering(binarizedArrayDilated, layerWidth, layerHeight);\r\n    spatialClusters.sort((sc1, sc2) => sc2.length - sc1.length);\r\n    // Indexes of biggest spatial cluster as X and Y values\r\n    const biggestSpatialClusterXy = spatialClusters[0].map(i => ({ x: i % layerWidth, y: Math.floor(i / layerWidth) }));\r\n\r\n    // LSF method to get best fitting parabola along pixels in square\r\n    let lsf = polynomialLSF(biggestSpatialClusterXy, 2);\r\n    let f = lsf.predict;\r\n\r\n    // Find minimum and maximum of our binarized to determine where panoramic should start and where should end\r\n    // We want control points to start at right and left jaw, so we don't use biggestCluster in this case\r\n    // since it corresponds to the dental zone, not jaws\r\n    let minX = binarizedArrayDilated.reduce((min, val, idx) =>\r\n        (idx % layerWidth < min && val != -1000 ? idx % layerWidth : min), Infinity);\r\n    let maxX = binarizedArrayDilated.reduce((max, val, idx) =>\r\n        (idx % layerWidth > max && val != -1000 ? idx % layerWidth : max), -Infinity);\r\n    const bounds = [[minX, maxX], [0, layerHeight]];\r\n    const middleLayer = Math.ceil((maxLayer - minLayer) / 2) - 1;\r\n    const points = computeControlPoints(f, bounds);\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport('default');\r\n    const annotationUIDs = addControlPointAnnotations(viewport, imageData, points, middleLayer);\r\n\r\n    const panoramicState = panoramicService.getPanoramicState(displaySetInstanceUID);\r\n    const newPanoramicState: PanoramicState = {\r\n        ...panoramicState,\r\n        id: displaySetInstanceUID,\r\n        annotationVisibility: false,\r\n        annotationUIDs: annotationUIDs\r\n    };\r\n    panoramicService.addDisplaySetUID(displaySetInstanceUID);\r\n    panoramicService.setPanoramicState(displaySetInstanceUID, newPanoramicState);\r\n}\r\n\r\n// Control points that can be changed in front will be re-used to compute\r\n// A new dental curve thus a new panoramic\r\nconst createPanoramic = async ({ extensionManager, servicesManager }) => {\r\n    const {\r\n        cornerstoneViewportService,\r\n        displaySetService,\r\n        uiNotificationService,\r\n        panoramicService,\r\n        segmentationService,\r\n    } = servicesManager.services;\r\n\r\n    // Get control points\r\n    const { displaySetInstanceUID, volume } =\r\n        cornerstoneViewportService.getViewportInfo('default').getViewportData().data[0];\r\n    const { scalarData, dimensions, imageData } = volume;\r\n\r\n    const controlPointsInVolume = panoramicService._getControlPoints(displaySetInstanceUID, imageData, dimensions);\r\n    if (!controlPointsInVolume.length) {\r\n        return;\r\n    }\r\n\r\n    const [layerWidth, layerHeight, _] = dimensions;\r\n    const minLayer = Math.floor(scalarData.findIndex((value) => value > -1000) / layerWidth / layerHeight);\r\n    const maxLayer = Math.floor(scalarData.findLastIndex((value) => value > -1000) / layerWidth / layerHeight) + 1;\r\n    const middleLayer = Math.ceil((maxLayer - minLayer) / 2) - 1;\r\n    const nbLayers = maxLayer - minLayer;\r\n\r\n    let parameters = {layerWidth: layerWidth, layerHeight: layerHeight, layerSize: layerWidth * layerHeight,\r\n                      minLayer: minLayer, nbLayers: nbLayers};\r\n    // LSF method to get best fitting parabola along basePoints\r\n    const lsfDentalCurve = polynomialLSF(controlPointsInVolume, 6);\r\n    const f = lsfDentalCurve.predict;\r\n\r\n    // For now we just have control points\r\n    // We need to regenerate base points, which are equitably distributed along the curve\r\n    // The curve is bounded within the volume width\r\n    const minX = Math.max(controlPointsInVolume[0].x, 0);\r\n    const maxX = Math.min(controlPointsInVolume[constants.NUMBER_BASE_POINTS - 1].x, layerWidth);\r\n    const bounds = [[minX, maxX], [0, layerHeight]];\r\n\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport('default');\r\n    const panoramicState = panoramicService.getPanoramicState(displaySetInstanceUID);\r\n    deleteControlPointAnnotations(viewport, panoramicState.annotationUIDs);\r\n    const points = computeControlPoints(f, bounds);\r\n    const annotationUIDs = addControlPointAnnotations(viewport, imageData, points, middleLayer);\r\n\r\n    // If user is asking to regenerate panoramic and there already is one for this series, delete the previous one\r\n    if (panoramicState.panoramic?.width) {\r\n        // Delete segmentations of previous dentascan\r\n        for (const segmentation of segmentationService.getDentascanSegmentations()) {\r\n            segmentationService.remove(segmentation.id);\r\n        }\r\n        displaySetService.deleteDisplaySet(panoramicState.panoramicViewportData.data[0].displaySetInstanceUID);\r\n        displaySetService.deleteDisplaySet(panoramicState.dentascanViewportData.data[0].displaySetInstanceUID);\r\n    }\r\n\r\n    // Iteration on normals to determine width of panoramic and array of offsets\r\n    // On each index representing a basePoints, the value represents the width value on the panoramic\r\n    // from where the corresponding basePoint begins.\r\n    // TODO\r\n\r\n    let dentascans = [];\r\n\r\n    // Compute panoramicWidth and build dentascans\r\n    // Dentascans need to be stored from right to left to be in the correct order\r\n    let x = maxX;\r\n    do {\r\n        const dentascan = getDentascanSection(x, f, scalarData, parameters, constants.DENTASCAN_THICKNESS);\r\n        dentascans.push(dentascan);\r\n        x -= getTangentVector(f, x)[0] / 2; // Anti-Aliasing\r\n    } while (x > minX);\r\n    let newDentascans = [];\r\n    for (let i = 0; i < Math.floor(dentascans.length / 2); i++) {\r\n        let dentascan = dentascans[2 * i];\r\n        const newDentascanWidth = Math.floor(dentascan.width / 2);\r\n        let newDentascan = new Float32Array(newDentascanWidth * nbLayers).fill(0);\r\n        for (let j = 0; j < newDentascanWidth * nbLayers; j++) {\r\n            newDentascan[j] += dentascans[2 * i].dentascan[2 * j];\r\n            newDentascan[j] += dentascans[2 * i + 1].dentascan[2 * j];\r\n            newDentascan[j] += dentascans[2 * i].dentascan[2 * j + 1];\r\n            newDentascan[j] += dentascans[2 * i + 1].dentascan[2 * j + 1];\r\n            newDentascan[j] = Math.floor(newDentascan[j] / 4);\r\n        }\r\n        dentascan.dentascan = newDentascan;\r\n        dentascan.width = newDentascanWidth;\r\n        newDentascans.push(dentascan);\r\n    }\r\n    dentascans = newDentascans;\r\n    const panoramicWidth = dentascans.length;\r\n    parameters['panoramicWidth'] = panoramicWidth;\r\n\r\n    /*const [a, b, c] = lsfDentalCurve.equation;\r\n    const dfdx = a * x + b;\r\n    const fl = Math.sqrt(1 + dfdx * dfdx);\r\n    const flPrim = (x) => 1/(2*a)*(fl*dfdx + Math.log(fl+dfdx));\r\n    const panoramicWidth = flPrim(maxX) - flPrim(minX);*/ // TODO\r\n\r\n    // This promise take a base point and an offset\r\n    // It computes the dentascan corresponding to the offset and finishes\r\n    // This needs to be separated from buildPanoramicPromise as we will do a transformation on\r\n    // the dentascan curves consisting in recalculating the curves.\r\n    // TODO\r\n\r\n    // Compute the value of each dentascan at each layer in order to compute axial curves of each layer\r\n    const dentalCurvesPointsXY = getDentalCurvesPointsXY(dentascans, 'curveAIP', parameters);\r\n    const nbDentalCurves = Math.floor(panoramicWidth / constants.DENTAL_CURVES_STEP);\r\n    const nbAxialCurves = Math.floor(nbLayers / constants.AXIAL_CURVES_STEP);\r\n\r\n    //let axialCurvesPoints = new Array(nbAxialCurves * panoramicWidth).fill(null);\r\n    // Convert an array of long curves points to an array of axial curves points.\r\n    // The value inside newScalarData contains the x coordinate of the curve\r\n    for (let l = 0; l < nbAxialCurves; l++) {\r\n        break;\r\n        const layer = 1 * l;\r\n        const [inf, sup] = [Math.max(0, l), l + 1];\r\n        const coordinatesSlice = dentascanCurvesPoints.slice(inf * nbDentalCurves, sup * nbDentalCurves).filter(value => value);\r\n        const axialCurve = polynomialLSF(coordinatesSlice, 6);\r\n        // TODO\r\n        for (let i = 0; i < panoramicWidth; i++) {\r\n            const dentascan = dentascans[panoramicWidth - i - 1];\r\n            const middlePoint = dentascan.middlePoint;\r\n            // We want to find the point where an axial curve crosses a dental segment\r\n            // Having ax²+bx+c the curve of the axial curve and dx + e the curve of the segment,\r\n            // This is solved by solving the equation ax² + (b-d)x + (c-e) = 0\r\n            // Which admits two roots: -(b-d)-sqrt(delta)/2a and -(b-d)+sqrt(delta)/2a where delta is (b-d)²-4a(c-e)\r\n            /*let [a_, b_, c_] = axialCurve.equation; // TODO\r\n            const [d_, e_] = dentascan.equation;\r\n            let xyAxial = null;\r\n            if (a_ != 0) {\r\n                const [a, b, c] = [a_, b_ - d_, c_ - e_];\r\n                const delta = b*b - 4*a*c;\r\n                if (delta > 0) {\r\n                    // Two roots\r\n                    const root1 = (-b - Math.sqrt(delta)) / (2*a);\r\n                    const root2 = (-b + Math.sqrt(delta)) / (2*a);\r\n                    if (Math.abs(root1 - middlePoint[0]) < Math.abs(root2 - middlePoint[0])) {\r\n                        xyAxial = [root1, axialCurve.predict(root1)];\r\n                    } else {\r\n                        xyAxial = [root2, axialCurve.predict(root2)];\r\n                    }\r\n                } else if (delta === 0) {\r\n                    const root = -b / (2*a)\r\n                    xyAxial = [root, axialCurve.predict(root)];\r\n                }\r\n\r\n            }*//* else {\r\n                const root = (e_ - c_) - (b_ - d_);\r\n                xyAxial = [root, axialCurve.predict(root)];\r\n            }*/ // TODO\r\n            const [minX, minY] = dentascan.interval[0];\r\n            let xyAxial = null;\r\n            let costAxial = layerHeight; // Big value;\r\n            for (let i = 0; i < dentascan.width; i++) {\r\n                const x = minX + i * dentascan.direction[0];\r\n                const yAxial = axialCurve.predict(x);\r\n                const yDental = minY + i * dentascan.direction[1];\r\n\r\n                const cost = Math.abs(yAxial - yDental);\r\n                if (cost < costAxial) {\r\n                    costAxial = cost;\r\n                    xyAxial = [x, yAxial];\r\n                }\r\n            }\r\n            if (xyAxial) {\r\n                let xPosInDentascan = Math.floor(constants.DENTASCAN_THICKNESS / 2\r\n                                                    + (xyAxial[0] - middlePoint[0]) / dentascan.direction[0]);\r\n                const yPosInDentascan = layer;\r\n\r\n                if (xPosInDentascan < 0) {\r\n                    xPosInDentascan = 0;\r\n                }\r\n                if (xPosInDentascan > constants.DENTASCAN_THICKNESS) {\r\n                    xPosInDentascan = constants.DENTASCAN_THICKNESS;\r\n                }\r\n                // Image is transposed\r\n                // TODO : handle sigmoid curve on new dental curve\r\n                axialCurvesPoints[i * nbAxialCurves + l] = {x: yPosInDentascan, y: xPosInDentascan};\r\n            }\r\n        }\r\n    } // TODO\r\n\r\n    // This promise take a base point and an offset\r\n    // It fills panoramicArray from basePoint to next basePoint\r\n    // Offset as explained earlier is the starting width of the base point\r\n    // TODO\r\n\r\n    // Init panoramic array\r\n    let panoramicNormalsIterative = new Float32Array(panoramicWidth * nbLayers).fill(-1000)\r\n\r\n    const panoramicDepth = constants.DENTAL_CURVE_THICKNESS + 1;\r\n    // From start of base point to start of other base point, incremented by vector direction between those two points\r\n    for (let i = 0; i < panoramicWidth; i++) {\r\n        let dentascan = dentascans[panoramicWidth - i - 1];\r\n        const [dentascanMinPoint, dentascanMaxPoint] = dentascan.interval;\r\n        const [dentascanVxNormal, dentascanVyNormal] = dentascan.direction;\r\n\r\n        //const coordinatesSlice = axialCurvesPoints.slice(i * nbAxialCurves, (i + 1) * nbAxialCurves).filter(value => value);\r\n        //const dentalCurve = polynomialLSF(coordinatesSlice, 3);\r\n        for (let layer = 0; layer < nbLayers; layer++) {\r\n            // TODO\r\n            const { x, y, xpos } = dentalCurvesPointsXY[Math.floor(layer / constants.AXIAL_CURVES_STEP) * nbDentalCurves +\r\n                                                        Math.floor(i / constants.DENTAL_CURVES_STEP)];\r\n\r\n            // Get min and max point along normal of dentalCurve which length between the two is DENTAL_CURVE_THICKNESS\r\n            let minPoint = [x - constants.DENTAL_CURVE_THICKNESS / 2 * dentascanVxNormal,\r\n                            y - constants.DENTAL_CURVE_THICKNESS / 2 * dentascanVyNormal];\r\n            let maxPoint = [x + constants.DENTAL_CURVE_THICKNESS / 2 * dentascanVxNormal,\r\n                            y + constants.DENTAL_CURVE_THICKNESS / 2 * dentascanVyNormal];\r\n\r\n            const valuesAlongNormal = [];\r\n\r\n            // Get values of point along normal between min and max\r\n            for (let k = 0; k < panoramicDepth; k++) {\r\n                const xk = Math.floor(minPoint[0] + k * dentascanVxNormal);\r\n                const yk = Math.floor(minPoint[1] + k * dentascanVyNormal);\r\n                // TODO Values are now picked from the dentascans instead of being picked from the volume, so that anti-aliasing is applied.\r\n                const xposk = k + Math.floor(xpos - panoramicDepth / 2);\r\n                const scalarValue = dentascan.dentascan[layer * constants.DENTASCAN_THICKNESS + xposk];\r\n                const scalarValueNormalized = Math.floor((scalarValue + 1000) / 16) / 255;\r\n                //let scalarValue = Math.floor((scalarData[layer * layerSize + yk * layerWidth + xk] + 1000) / 16) / 255;\r\n                //let scalarValue = (scalarData[layer * layerSize + yk * layerWidth + xk] + 1000) / 16;\r\n                //if (scalarValue >= 50) {\r\n                    //valuesAlongNormal.push(Math.exp(scalarValue / S));\r\n\r\n                // Take data along normal vector where x and y are valid coordinates\r\n                if (!isNaN(scalarValueNormalized)) {\r\n                    // The following formula computes the factor depending on dental curve thickness, when scalarValue\r\n                    // equals 1, as empiric tests showed factor 0.15 was the best for dental curve thickness of 40\r\n                    const factor = 1 - Math.pow(0.85, 40 / constants.DENTAL_CURVE_THICKNESS);\r\n                    valuesAlongNormal.push(1 - factor * Math.pow(scalarValueNormalized, 3));\r\n                }\r\n            }\r\n\r\n            // Add mean of all values as value in panoramic result\r\n            // TODO\r\n            let absorption = valuesAlongNormal.reduce((a, b) => a * b, 1);\r\n            //let mean = valuesAlongNormal.reduce((a, b) => a + b, 0) / valuesAlongNormal.length;\r\n            //const max = getMax(valuesAlongNormal);\r\n            //panoramicNormalsIterative[panoramicWidth * (nbLayers - layer - 1) + i] = S * Math.log(mean) * 16 - 1000;\r\n            panoramicNormalsIterative[panoramicWidth * (nbLayers - layer - 1) + i] = (1 - absorption) * 255 * 16 - 1000;\r\n        }\r\n    }\r\n    // Post processing\r\n    let panoramicProcessed = new Array(panoramicWidth * nbLayers).fill(-1000);\r\n    const gImage = blurPanoramic(panoramicNormalsIterative, panoramicWidth, nbLayers);\r\n\r\n    for (let i = 0; i < panoramicWidth * nbLayers; i++) {\r\n        const image0 = panoramicNormalsIterative[i];\r\n        const gImage0 = gImage[i];\r\n        const alpha = 0.9;\r\n        panoramicProcessed[i] = alpha * image0 + (1 - alpha) * (image0 - gImage0);\r\n    }\r\n    /*const oldMin = Math.min(...panoramicNormalsIterative);\r\n    const oldMax = Math.max(...panoramicNormalsIterative);\r\n    const newMin = Math.min(...panoramicProcessed);\r\n    const newMax = Math.max(...panoramicProcessed);\r\n    const scalingFactor = (oldMax - oldMin) / (newMax - newMin);\r\n\r\n\r\n    // Rescale values\r\n    for (let i = 0; i < panoramicWidth * nbLayers; i++) {\r\n        panoramicProcessed[i] = Math.round((panoramicProcessed[i] - newMin) * scalingFactor + oldMin);\r\n    }\r\n\r\n    // Array at start is filled with false\r\n    // When a promise at a specific basePoint is done, its index goes to true\r\n    // This array allows us to track state of the promises to display progress bar in front\r\n\r\n    // Recursive function to execute promises in array\r\n    // When promise at index x is done, update doneArray by putting true value and wait a bit\r\n    // to call recursively function of x + 1 index.\r\n\r\n    // Update progress value in front-end by getting each 250ms the number of true values in doneArray\r\n    // THIS WORKS ONLY WHEN PARENT FUNCTION IS CALLED WITH debug = false\r\n    const waitUntilArrayDone = (start) => {\r\n        return new Promise<void>((resolve, reject) => {\r\n            const waitForArray = (start) => {\r\n                const completed = doneArray.filter(el => el).length\r\n                const progress = (start + Math.round((completed * 100) / 2 / basePoints.length))\r\n                setProcessingPourcent(progress)\r\n                if (completed === basePoints.length) {\r\n                    return resolve();\r\n                } else {\r\n                    setTimeout(() => waitForArray(start), 50)\r\n                }\r\n            }\r\n            waitForArray(start)\r\n        })\r\n    }\r\n    // Wait until panoramic is completed\r\n    await waitUntilArrayDone(0)*/\r\n\r\n    let sharpenedPanoramic = panoramicNormalsIterative;//sharpen(panoramicNormalsIterative, panoramicWidth, nbLayers)\r\n    //sharpenedPanoramic = applySmoothing(sharpenedPanoramic, panoramicWidth, nbLayers)\r\n\r\n    // Display panoramic in OHIF Viewport\r\n    const imageId = panoramicService._getImageId(displaySetInstanceUID);\r\n    const voiLutModule = metaData.get('voiLutModule', imageId);\r\n    const imagePixelModule = metaData.get('imagePixelModule', imageId);\r\n    const generalSeriesModule = metaData.get('generalSeriesModule', imageId);\r\n\r\n    if (!cornerstoneViewportService.getCornerstoneViewport('default')) {\r\n        uiNotificationService.show({\r\n            title: `Panoramic Generation Error`,\r\n            message: `No viewport detected.`,\r\n            type: 'error',\r\n            duration: 3000,\r\n        });\r\n        return;\r\n    }\r\n    const panoramicMetadata = {\r\n        SeriesInstanceUID: generalSeriesModule.seriesInstanceUID + '.panoramic',\r\n        StudyInstanceUID: generalSeriesModule.studyInstanceUID,\r\n        BitsAllocated: imagePixelModule.bitsAllocated,\r\n        BitsStored: imagePixelModule.bitsStored,\r\n        Rows: nbLayers,\r\n        Columns: panoramicWidth,\r\n        WindowCenter: voiLutModule.windowCenter[0],\r\n        WindowWidth: voiLutModule.windowWidth[0],\r\n        PixelData: sharpenedPanoramic\r\n    };\r\n    const panoramicViewportData = await loadBlobInViewport(panoramicMetadata, { extensionManager, servicesManager });\r\n\r\n    const dentascanObject = {\r\n        SeriesInstanceUID: generalSeriesModule.seriesInstanceUID + '.dentascan',\r\n        StudyInstanceUID: generalSeriesModule.studyInstanceUID,\r\n        BitsAllocated: imagePixelModule.bitsAllocated,\r\n        BitsStored: imagePixelModule.bitsStored,\r\n        Rows: nbLayers,\r\n        Columns: constants.DENTASCAN_THICKNESS,\r\n        WindowCenter: voiLutModule.windowCenter[0],\r\n        WindowWidth: voiLutModule.windowWidth[0],\r\n        PixelData: dentascans.map(dentascan => dentascan.dentascan) // TODO\r\n    };\r\n\r\n    const dentascansViewportData = await loadMultipleBlobsInViewport(dentascanObject, { extensionManager, servicesManager });\r\n\r\n    const newPanoramicState: PanoramicState = {\r\n        id: displaySetInstanceUID,\r\n        annotationUIDs: annotationUIDs,\r\n        annotationVisibility: panoramicState.annotationVisibility,\r\n        dentascanViewportData: dentascansViewportData,\r\n        panoramicViewportData: panoramicViewportData,\r\n        panoramic: {\r\n            width: panoramicWidth,\r\n            height: nbLayers\r\n        },\r\n        dentascans: dentascans,\r\n    }\r\n    panoramicService.setPanoramicState(displaySetInstanceUID, newPanoramicState);\r\n}\r\n\r\nexport { createControlPoints, createPanoramic };\r\n","export function antiAlias(imageData, width, height, intensity) {\r\n    const resultImageData = imageData.slice();\r\n\r\n    for (let y = 1; y < height - 1; y++) {\r\n        for (let x = 1; x < width - 1; x++) {\r\n            const index = y * width + x;\r\n            const gray =\r\n                (imageData[(y - 1) * width + x - 1] * intensity +\r\n                    imageData[(y - 1) * width + x] * intensity +\r\n                    imageData[(y - 1) * width + x + 1] * intensity +\r\n                    imageData[y * width + x - 1] * intensity +\r\n                    imageData[y * width + x] +\r\n                    imageData[y * width + x + 1] * intensity +\r\n                    imageData[(y + 1) * width + x - 1] * intensity +\r\n                    imageData[(y + 1) * width + x] * intensity +\r\n                    imageData[(y + 1) * width + x + 1] * intensity) /\r\n                1 + intensity * 8;\r\n\r\n            // Mettre à jour la valeur de pixel dans l'image résultante\r\n            resultImageData[index] = gray;\r\n        }\r\n    }\r\n\r\n    return resultImageData;\r\n}\r\n\r\nexport function sharpen(imageData, width, height) {\r\n    // Créer une copie de l'image pour ne pas modifier l'original\r\n    const resultImageData = imageData.slice();\r\n\r\n    // Matrice de renforcement\r\n    const sharpenMatrix = [\r\n        [0, -1, 0],\r\n        [-1, 5, -1],\r\n        [0, -1, 0],\r\n    ];\r\n\r\n    const matrixSize = 3; // Taille de la matrice (3x3)\r\n\r\n    for (let y = 1; y < height - 1; y++) {\r\n        for (let x = 1; x < width - 1; x++) {\r\n            let sum = 0;\r\n\r\n            // Appliquer la matrice de renforcement aux pixels voisins\r\n            for (let i = 0; i < matrixSize; i++) {\r\n                for (let j = 0; j < matrixSize; j++) {\r\n                    const pixelX = x + j - 1;\r\n                    const pixelY = y + i - 1;\r\n                    const index = pixelY * width + pixelX;\r\n                    sum += imageData[index] * sharpenMatrix[i][j];\r\n                }\r\n            }\r\n\r\n            // S'assurer que la valeur est dans la plage [0, 255]\r\n            sum = Math.min(32767, Math.max(-32768, sum));\r\n\r\n            // Mettre à jour la valeur de pixel dans l'image résultante\r\n            const index = y * width + x;\r\n            resultImageData[index] = sum;\r\n        }\r\n    }\r\n\r\n    return resultImageData;\r\n}\r\n\r\nexport function blurPanoramic(imageData, width, height) {\r\n    const resultImageData = imageData.slice();\r\n\r\n    const sigma = 0.8;\r\n    const gaussianBlur = (dist) => Math.exp(-dist / (2 * sigma * sigma)) / (2 * Math.PI * sigma * sigma);\r\n    const [g0, g1, g2] = [gaussianBlur(0), gaussianBlur(1), gaussianBlur(2)];\r\n\r\n    const kernel = [\r\n        [g2, g1, g2],\r\n        [g1, g0, g1],\r\n        [g2, g1, g2],\r\n    ];\r\n    const normalizeFactor = 1 / (g0 + 4 * g1 + 4 * g2);\r\n\r\n    const kernelSize = kernel.length;\r\n    const halfKernelSize = Math.floor(kernelSize / 2);\r\n\r\n    for (let y = halfKernelSize; y < height - halfKernelSize; y++) {\r\n        for (let x = halfKernelSize; x < width - halfKernelSize; x++) {\r\n            let sum = 0;\r\n            for (let ky = 0; ky < kernelSize; ky++) {\r\n                for (let kx = 0; kx < kernelSize; kx++) {\r\n                    const pixelX = x + kx - halfKernelSize;\r\n                    const pixelY = y + ky - halfKernelSize;\r\n                    const index = pixelY * width + pixelX;\r\n\r\n                    // Appliquer le noyau de convolution au pixel.\r\n                    sum += imageData[index] * kernel[ky][kx];\r\n                }\r\n            }\r\n\r\n            // Normaliser la somme en fonction de l'intensité.\r\n            sum *= normalizeFactor;\r\n\r\n            // Mettre à jour la valeur du pixel dans l'image résultante.\r\n            resultImageData[y * width + x] = sum;\r\n        }\r\n    }\r\n\r\n    return resultImageData;\r\n}\r\n\r\nexport function applySmoothing(imageData, width, height) {\r\n    const resultImageData = imageData.slice();\r\n\r\n    const kernel = [\r\n        [0, 1, 0],\r\n        [0, 1, 0],\r\n        [0, 1, 0],\r\n    ]; // Noyau de convolution simple pour l'adoucissement.\r\n\r\n    const kernelSize = kernel.length;\r\n    const halfKernelSize = Math.floor(kernelSize / 2);\r\n\r\n    for (let y = halfKernelSize; y < height - halfKernelSize; y++) {\r\n        for (let x = halfKernelSize; x < width - halfKernelSize; x++) {\r\n            let sum = 0;\r\n\r\n            for (let ky = 0; ky < kernelSize; ky++) {\r\n                for (let kx = 0; kx < kernelSize; kx++) {\r\n                    const pixelX = x + kx - halfKernelSize;\r\n                    const pixelY = y + ky - halfKernelSize;\r\n                    const index = pixelY * width + pixelX;\r\n\r\n                    // Appliquer le noyau de convolution au pixel.\r\n                    sum += imageData[index] * kernel[ky][kx];\r\n                }\r\n            }\r\n\r\n            // Normaliser la somme en fonction de l'intensité.\r\n            sum /= 3;\r\n\r\n            // Mettre à jour la valeur du pixel dans l'image résultante.\r\n            resultImageData[y * width + x] = sum;\r\n        }\r\n    }\r\n\r\n    return resultImageData;\r\n}\r\n\r\nexport function calculateNormalCurve(curve, ind, nbNormals) {\r\n    const norm = [];\r\n\r\n    if (curve.length <= 1 || ind < 0 || ind >= curve.length) {\r\n        // Gestion des cas spéciaux où la normale ne peut pas être calculée\r\n        return norm;\r\n    }\r\n\r\n    // Coordonnées du point \"p\"\r\n    const [px, py] = curve[ind];\r\n\r\n    // Calcul des tangentes aux points voisins\r\n    let [tx, ty] = [0, 0]; // Tangente au point \"p\"\r\n\r\n    if (ind > 10) {\r\n        const [prevX, prevY] = curve[ind - 10];\r\n        tx += px - prevX;\r\n        ty += py - prevY;\r\n    }\r\n\r\n    if (ind < curve.length - 10) {\r\n        const [nextX, nextY] = curve[ind + 10];\r\n        tx += nextX - px;\r\n        ty += nextY - py;\r\n    }\r\n\r\n    // Calcul de la normale (perpendiculaire à la tangente)\r\n    const magnitude = Math.sqrt(tx * tx + ty * ty);\r\n    if (magnitude === 0) {\r\n        // Gestion du cas où la tangente est nulle (point isolé)\r\n        return norm;\r\n    }\r\n\r\n    const nx = -ty / magnitude; // Composante x de la normale\r\n    const ny = tx / magnitude; // Composante y de la normale\r\n\r\n    // Ajout du point \"p\" dans \"norm\"\r\n    norm.push([px, py]);\r\n\r\n    const stepSize = magnitude / (nbNormals / 2); // nbNormals points au total, y compris \"p\"\r\n    let currentX = px - nx * magnitude;\r\n    let currentY = py - ny * magnitude;\r\n\r\n    // Calcul des points équidistants sur la normale\r\n    for (let i = 0; i < nbNormals; i++) {\r\n        currentX += nx * stepSize;\r\n        currentY += ny * stepSize;\r\n        norm.push([currentX, currentY]);\r\n    }\r\n\r\n    return norm;\r\n}\r\n\r\nexport function cubicSplineInterpolation(arr, x) {\r\n    const n = arr.length;\r\n    let i = 0;\r\n\r\n    if (x >= arr[n - 1][0]) {\r\n        i = n - 2;\r\n    } else {\r\n        while (x > arr[i + 1][0]) {\r\n            i++;\r\n        }\r\n    }\r\n\r\n    const x1 = arr[i][0];\r\n    const x2 = arr[Math.min(i + 1, n - 1)][0];\r\n\r\n    const y0 = arr[Math.max(i - 1, 0)][1];\r\n    const y1 = arr[i][1];\r\n    const y2 = arr[Math.min(i + 1, n - 1)][1];\r\n    const y3 = arr[Math.min(i + 2, n - 1)][1];\r\n\r\n    const t = (x - x1) / (x2 - x1);\r\n    const t2 = t * t;\r\n    const t3 = t * t2;\r\n\r\n    const a = -0.5 * y0 + 1.5 * y1 - 1.5 * y2 + 0.5 * y3;\r\n    const b = y0 - 2.5 * y1 + 2 * y2 - 0.5 * y3;\r\n    const c = -0.5 * y0 + 0.5 * y2;\r\n    const d = y1;\r\n\r\n    const y = a * t3 + b * t2 + c * t + d;\r\n\r\n    return [x, y];\r\n}\r\n\r\nfunction linearInterpolationCoefficients(point1, point2) {\r\n    const [x1, y1] = point1;\r\n    const [x2, y2] = point2;\r\n\r\n    if (x1 === x2) {\r\n        throw new Error('Les deux points doivent avoir des coordonnées x différentes pour l\\'interpolation linéaire.');\r\n    }\r\n\r\n    const a = (y2 - y1) / (x2 - x1);\r\n    const b = y1 - a * x1;\r\n\r\n    return [Math.round(a), Math.round(b)];\r\n}\r\n\r\n//Complete cubic spline interpolation in order to have linear interpolation in the beginning and in the end of the curve\r\nfunction completeInterpolation(interpolatedPoints, xMax){\r\n    const [a0, b0] = linearInterpolationCoefficients(interpolatedPoints[0], interpolatedPoints[10])\r\n    const [a1, b1] = linearInterpolationCoefficients(interpolatedPoints[interpolatedPoints.length - 10], interpolatedPoints[interpolatedPoints.length - 1])\r\n    const stepBegin = interpolatedPoints[0][0] / (xMax / 3)\r\n    const stepEnd = (xMax - interpolatedPoints[interpolatedPoints.length - 1][0]) / (xMax / 3)\r\n    for(let x = 0; x < interpolatedPoints[0][0]; x += stepBegin){\r\n        interpolatedPoints.push([x, a0 * x + b0])\r\n    }\r\n    interpolatedPoints.sort((a, b) => a[0] - b[0]);\r\n\r\n    for(let x = interpolatedPoints[interpolatedPoints.length - 1][0] + stepEnd; x < xMax; x += stepEnd){\r\n        interpolatedPoints.push([x, a1 * x + b1])\r\n    }\r\n\r\n    return  interpolatedPoints.map(p => {\r\n        return [p[0], p[1], 0]\r\n    })\r\n}\r\n","import { DicomMetadataStore, PubSubService, Types as OhifTypes, ExtensionManager } from '@ohif/core';\r\nimport { CommandsManager } from '../../../../../platform/core/src/classes';\r\nimport { Dentascan, PanoramicState } from '../../types/Panoramic';\r\nimport { createControlPoints, createPanoramic } from './../../../../default/src/Panels/PanoramicUtils/generatePanoramic'\r\nimport { getEnabledElement } from '@cornerstonejs/core';\r\nimport {\r\n  annotation as cstAnnotation,\r\n  utilities as cstUtilities,\r\n  Enums as cstEnums,\r\n  segmentation as cstSegmentation,\r\n  BrushTool,\r\n  Types as cstTypes,\r\n} from '@cornerstonejs/tools';\r\nimport { Point3 } from '@cornerstonejs/core/src/types';\r\nimport { EventTypes } from '@cornerstonejs/tools/src/types';\r\nimport { LabelmapSegmentationDataVolume } from '@cornerstonejs/tools/src/types/LabelmapTypes';\r\nimport { VolumeData } from '../../types/CornerstoneCacheService';\r\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\r\n\r\nfunction waitCondition<T>(condition: () => T) {\r\n  return new Promise<T>((resolve, reject) => {\r\n      const wait = () => {\r\n          const result = condition();\r\n          if (result) {\r\n              return resolve(result);\r\n          } else {\r\n              setTimeout(() => wait(), 50);\r\n          }\r\n      }\r\n      wait();\r\n  });\r\n}\r\n\r\nexport default class PanoramicService extends PubSubService {\r\n  private enabled: boolean = false;\r\n  private displayed: boolean = false;\r\n  private editing: boolean = false;\r\n  private processing: boolean = false;\r\n  private subscriptions: any[] = [];\r\n  private panoramicStates: { [displaySetUID: string]: PanoramicState } = {};\r\n  private dentascanIndex: number = 0;\r\n\r\n  private readonly commandsManager: CommandsManager;\r\n  private readonly servicesManager: AppTypes.ServicesManager;\r\n  private readonly extensionManager: ExtensionManager;\r\n\r\n  public readonly EVENTS = {\r\n    STATUS_DISPLAYED_CHANGED: 'event::PanoramicService:statusDisplayedChanged',\r\n    STATUS_EDITING_CHANGED: 'event::PanoramicService:statusEditingChanged',\r\n    PANORAMIC_STATE_UPDATED: 'event::PanoramicService:panoramicStateUpdated',\r\n    PANORAMIC_CREATED: 'event::PanoramicService:panoramicCreated',\r\n    PANORAMIC_PROCESSING: 'event::PanoramicService:panoramicProcessing',\r\n    DENTASCAN_INDEX_UPDATED: 'event::PanoramicService:dentascanIndexUpdated'\r\n  };\r\n\r\n  public static REGISTRATION = {\r\n    name: 'panoramicService',\r\n    create: ({ commandsManager, servicesManager, extensionManager }: OhifTypes.Extensions.ExtensionParams): PanoramicService => {\r\n      return new PanoramicService(commandsManager, servicesManager, extensionManager);\r\n    },\r\n  };\r\n\r\n  constructor(commandsManager: CommandsManager, servicesManager: AppTypes.ServicesManager, extensionManager: ExtensionManager) {\r\n    super(PanoramicService.EVENTS);\r\n    this.commandsManager = commandsManager;\r\n    this.servicesManager = servicesManager;\r\n    this.extensionManager = extensionManager;\r\n  }\r\n\r\n  public activatePanoramic = () => {\r\n    const { panelService, hangingProtocolService } = this.servicesManager.services;\r\n\r\n    // Enable panoramic service and panel\r\n    this.enabled = true;\r\n    const panoramicPanel = '@ohif/extension-default.panelModule.panoramicGenerationPanel';\r\n    panelService.addPanel('right', panoramicPanel, { activate: true });\r\n    panelService.activatePanel(panoramicPanel);\r\n\r\n    const event = hangingProtocolService.EVENTS.PROTOCOL_CHANGED;\r\n    hangingProtocolService.subscribe(event, ({ protocol, viewportMatchDetails }) => {\r\n      if (protocol.id === 'panoramicViewport') {\r\n        if (!this.isDisplayed()) {\r\n          const { displaySetInstanceUID } = viewportMatchDetails.get('default')?.displaySetsInfo[0];\r\n          this.handleProtocolEnter(displaySetInstanceUID);\r\n        }\r\n      } else {\r\n        if (this.isDisplayed()) {\r\n          this.handleProtocolExit();\r\n        }\r\n      }\r\n    });\r\n\r\n    const eventPanoramic = this.EVENTS.PANORAMIC_CREATED;\r\n    this.subscribe(eventPanoramic, async ({ displaySetUID }) => {\r\n      this.handlePanoramicCreation(displaySetUID);\r\n    });\r\n  }\r\n\r\n  public isEnabled = () => {\r\n    return this.enabled;\r\n  }\r\n\r\n  public isDisplayed = () => {\r\n    return this.displayed;\r\n  }\r\n\r\n  public setDisplayed = (displayed) => {\r\n    this.displayed = displayed;\r\n    this._broadcastEvent(this.EVENTS.STATUS_DISPLAYED_CHANGED, { displayed: displayed });\r\n  }\r\n\r\n  public isEditing = () => {\r\n    return this.editing;\r\n  }\r\n\r\n  public setEditing = (editing: boolean) => {\r\n    this.editing = editing;\r\n    this._broadcastEvent(this.EVENTS.STATUS_EDITING_CHANGED, { editing: editing });\r\n\r\n  }\r\n\r\n  public isProcessing = () => {\r\n    return this.processing;\r\n  }\r\n\r\n  public getPanoramicState = (displaySetUID: string) => {\r\n    return this.panoramicStates[displaySetUID];\r\n  }\r\n\r\n  public addDisplaySetUID = (displaySetUID: string) => {\r\n    if (!this.getPanoramicState(displaySetUID)) {\r\n      this.panoramicStates[displaySetUID] = undefined;\r\n    }\r\n  }\r\n\r\n  public setPanoramicState = (displaySetUID: string, panoramicState: PanoramicState) => {\r\n    this.panoramicStates[displaySetUID] = panoramicState;\r\n    this._broadcastEvent(this.EVENTS.PANORAMIC_STATE_UPDATED, { displaySetUID: displaySetUID });\r\n  }\r\n\r\n  public setAnnotationVisibility = (displaySetUID: string, annotationUIDs: string[], visible: boolean) => {\r\n    this.panoramicStates[displaySetUID].annotationVisibility = visible;\r\n    for (const annotationUID of annotationUIDs) {\r\n      cstAnnotation.visibility.setAnnotationVisibility(annotationUID, visible);\r\n    }\r\n    this._broadcastEvent(this.EVENTS.PANORAMIC_STATE_UPDATED, { displaySetUID: displaySetUID });\r\n  }\r\n\r\n  public setDentascanIndex = (displaySetUID: string, dentascanIndex: number) => {\r\n    this.dentascanIndex = dentascanIndex;\r\n    this._broadcastEvent(this.EVENTS.DENTASCAN_INDEX_UPDATED, { displaySetUID: displaySetUID });\r\n  }\r\n\r\n  // -------------------- PANORAMIC CALCULATION -------------------- //\r\n\r\n  public _getImageId = (displaySetUID: string) => {\r\n    const { displaySetService } = this.servicesManager.services;\r\n\r\n    const displaySet = displaySetService.getDisplaySetByUID(displaySetUID);\r\n\r\n    // Get volume from where we want to compute panoramic on\r\n    const baseVolumeSeries = DicomMetadataStore.getSeries(displaySet.StudyInstanceUID, displaySet.SeriesInstanceUID);\r\n    const frameNumber = baseVolumeSeries.instances[0].frameNumber;\r\n    const baseId = baseVolumeSeries.instances[0].imageId + (frameNumber ? '&frame=' + frameNumber : '');\r\n\r\n    return baseId;\r\n  }\r\n\r\n  public _getControlPoints = (displaySetUID: string, imageData: vtkImageData, dimensions: number[]) => {\r\n    const { measurementService } = this.servicesManager.services;\r\n\r\n    const controlPointsInViewport = measurementService.getMeasurements().filter(\r\n      m => m.toolName === 'ArrowAnnotate' && m.metadata.handmade && m.displaySetInstanceUID === displaySetUID\r\n    );\r\n    if (!controlPointsInViewport.length) {\r\n      return [];\r\n    }\r\n\r\n    // Regenerate points from annoted points in viewport\r\n    let controlPointsInVolume = controlPointsInViewport[0].points.map(point => {\r\n      let [x, y] = imageData.worldToIndex(point).map(Math.round) as Point3;\r\n      x = Math.min(Math.max(x, 0), dimensions[0]);\r\n      y = Math.min(Math.max(y, 0), dimensions[1]);\r\n      return { x, y }\r\n    });\r\n    controlPointsInVolume.sort((p1, p2) => p1.x - p2.x);\r\n\r\n    return controlPointsInVolume;\r\n  }\r\n\r\n  // -------------------- PANORAMIC PANEL -------------------- //\r\n\r\n  public handleProtocolEnter = (displaySetUID: string) => {\r\n    const { viewportGridService } = this.servicesManager.services;\r\n\r\n    this.setDisplayed(true);\r\n\r\n    const eventDentascanIndex = this.EVENTS.DENTASCAN_INDEX_UPDATED;\r\n    const { unsubscribe } = this.subscribe(eventDentascanIndex, ({ displaySetUID }) => {\r\n      this.renderPanoramic(displaySetUID);\r\n    });\r\n    this.subscriptions.push(unsubscribe);\r\n\r\n    const eventChangedGrid = viewportGridService.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED;\r\n    const eventReady = viewportGridService.EVENTS.VIEWPORTS_READY;\r\n    [eventChangedGrid, eventReady].forEach(evt => {\r\n      // Small delay so active viewport ID effectively changed\r\n      const { unsubscribe } = viewportGridService.subscribe(evt, ({ viewportId }) => {\r\n        this.handleActiveViewportChange(viewportId);\r\n      });\r\n      this.subscriptions.push(unsubscribe);\r\n    });\r\n\r\n    const panoramicState = this.getPanoramicState(displaySetUID);\r\n    if (!panoramicState) {\r\n      // First initialization\r\n      this.computePanoramic();\r\n    } else {\r\n      // Enable annotations on panoramic protocol\r\n      const annotationUIDs = this.isEditing() ? panoramicState.annotationUIDs : panoramicState.annotationUIDs.slice(1);\r\n      this.setAnnotationVisibility(displaySetUID, annotationUIDs, true);\r\n    }\r\n\r\n    this.addViewportListeners();\r\n  }\r\n\r\n  public handleProtocolExit = () => {\r\n    this.setDisplayed(false);\r\n\r\n    this.handleActiveViewportChange('default');\r\n\r\n    for (const unsub of this.subscriptions) {\r\n      unsub();\r\n    }\r\n\r\n    // Disable annotations on other protocols\r\n    for (const displaySetUID in this.panoramicStates) {\r\n      const { annotationUIDs } = this.getPanoramicState(displaySetUID);\r\n      this.setAnnotationVisibility(displaySetUID, annotationUIDs, false);\r\n    }\r\n  }\r\n\r\n  public handleActiveViewportChange = async (viewportId) => {\r\n    const { viewportGridService, segmentationService } = this.servicesManager.services;\r\n\r\n    await waitCondition(() => viewportGridService.getActiveViewportId() === viewportId);\r\n\r\n    const activeDisplaySetsUIDs = viewportGridService.getDisplaySetsUIDsForViewport(viewportId);\r\n    const activeSegmentation = segmentationService.getActiveSegmentation();\r\n    const hiddenSegmentation = segmentationService.getHiddenSegmentation(activeSegmentation?.id);\r\n    // Ensure the segmentation we are moving to is hidden\r\n    if (hiddenSegmentation && activeDisplaySetsUIDs.includes(hiddenSegmentation.displaySetInstanceUID)) {\r\n      for (const toolGroupId of segmentationService.getToolGroupIdsWithSegmentation(hiddenSegmentation.id)) {\r\n        segmentationService.setActiveSegmentationForToolGroup(hiddenSegmentation.id, toolGroupId);\r\n      };\r\n    }\r\n  }\r\n\r\n  // Create dentascan segmentation when panoramic is created\r\n  public handlePanoramicCreation = async (displaySetUID) => {\r\n    const { segmentationService } = this.servicesManager.services;\r\n\r\n    const activeSegmentation = segmentationService.getActiveSegmentation();\r\n    if (!activeSegmentation) {\r\n      return;\r\n    }\r\n    const dentascanSegmentations = segmentationService.getDentascanSegmentations();\r\n    if (dentascanSegmentations.length) {\r\n      return;\r\n    }\r\n\r\n    const panoramicState = this.getPanoramicState(displaySetUID);\r\n    const dentascanDisplaySetUID = panoramicState.dentascanViewportData.data[0].displaySetInstanceUID;\r\n    const toolGroupId = 'mpr';\r\n    const LABELMAP = cstEnums.SegmentationRepresentations.Labelmap;\r\n    for (const segmentation of segmentationService.getAxialSegmentations()) {\r\n      const dentascanSegId = await segmentationService.createSegmentationForDisplaySet(\r\n        dentascanDisplaySetUID, { label: segmentation.label }\r\n      );\r\n\r\n      await segmentationService.addSegmentationRepresentationToToolGroup(toolGroupId, dentascanSegId, true, LABELMAP);\r\n      // Empty segment at index 0\r\n      const segments = segmentation.segments.slice(1);\r\n      for (const segment of segments) {\r\n        const segmentConfig = {\r\n          segmentIndex: segment.segmentIndex,\r\n          toolGroupId: toolGroupId,\r\n          properties: {\r\n            label: segment.label,\r\n            color: segment.color,\r\n            opacity: segment.opacity,\r\n            visibility: segment.isVisible,\r\n            isLocked: segment.isLocked,\r\n            active: segmentation.activeSegmentIndex === segment.segmentIndex\r\n          }\r\n        }\r\n        segmentationService.addSegment(dentascanSegId, segmentConfig);\r\n      }\r\n    }\r\n    // Reset active segmentation as it got modified\r\n    segmentationService.setActiveSegmentationForToolGroup(activeSegmentation.id, toolGroupId);\r\n  }\r\n\r\n  protected getDentascanPointIndex = (evt: EventTypes.InteractionEventType) => {\r\n    const { element: dentascanElement, currentPoints } = evt.detail;\r\n    const { viewport: dentascanViewport } = getEnabledElement(dentascanElement);\r\n\r\n    // Convert points from dentascan coordinates to axial coordinates\r\n    const { imageData: dentascanImageData } = dentascanViewport.getImageData();\r\n    const [dentascanK, layer, i] = dentascanImageData.worldToIndex(currentPoints.world) as Point3;\r\n\r\n    return [dentascanK, layer, Math.round(i)];\r\n  }\r\n\r\n  protected getAxialPointIndex = (dentascan: Dentascan, dentascanK: number, layer: number) => {\r\n    const [minPoint, _] = dentascan.interval;\r\n    const [vx, vy] = dentascan.direction;\r\n    // Dentascan pixels are obtained with the average value of two voxels from the dentascan segment\r\n    // As the opposite operation cannot be done, we place the cursor at the corresponding coordinates\r\n    // along the dentascan segment (float), instead of rounding to closer voxel\r\n    const x = minPoint[0] + dentascanK * vx;\r\n    const y = minPoint[1] + dentascanK * vy;\r\n    const z = dentascan.height + dentascan.minLayer - layer;\r\n\r\n    return [x, y, z];\r\n  }\r\n\r\n  protected getAxialOperationData = (\r\n    evt: EventTypes.InteractionEventType,\r\n    brushInstance: BrushTool,\r\n    segmentIndex: number\r\n  ) => {\r\n    const { cornerstoneViewportService } = this.servicesManager.services;\r\n\r\n    // Code modified from BrushTool.ts\r\n    const axialViewport = cornerstoneViewportService.getCornerstoneViewport('default');\r\n    const axialElement = axialViewport.element;\r\n\r\n    const axialViewportInfo = cornerstoneViewportService.getViewportInfo('default');\r\n    const axialVolumeData = axialViewportInfo.getViewportData().data[0] as VolumeData;\r\n    const axialImageData = axialVolumeData.volume.imageData;\r\n\r\n    const displaySetUID = axialVolumeData.displaySetInstanceUID;\r\n    const panoramicState = this.getPanoramicState(displaySetUID);\r\n    // dentascanK and layer are float, i is integer\r\n    const [dentascanK, layer, i] = this.getDentascanPointIndex(evt);\r\n    // Get dentascan as we need vector direction for _calculateCursor\r\n    const dentascan = panoramicState.dentascans[i];\r\n\r\n    const [x, y, z] = this.getAxialPointIndex(dentascan, dentascanK, layer) as Point3;\r\n    const axialCenterCursorInWorld = axialImageData.indexToWorld([x, y, z]);\r\n\r\n    // Reset _hoverData for calculating cursor\r\n    brushInstance._hoverData = brushInstance.createHoverData(axialElement);\r\n    brushInstance._calculateCursor(axialElement, axialCenterCursorInWorld);\r\n    const { points } = brushInstance._hoverData.brushCursor.data.handles;\r\n\r\n    const editData = brushInstance.createEditData(axialElement);\r\n    const { preview, strategySpecificConfiguration, eraseFocusIndex } = brushInstance.configuration;\r\n    // TODO viewPlaneNormal and viewUp can be retrieved because default viewport and dentascans are axial\r\n    const { viewPlaneNormal, viewUp } = axialViewport.getCamera();\r\n    const segRepresentation = cstSegmentation.activeSegmentation.getActiveSegmentationRepresentation('mpr');\r\n    const { segmentationId, segmentationRepresentationUID } = segRepresentation;\r\n\r\n    const operationData = {\r\n      ...editData,\r\n      points: points,\r\n      segmentIndex,\r\n      previewColors: preview.enabled ? preview.previewColors : null,\r\n      viewPlaneNormal,\r\n      toolGroupId: 'mpr',\r\n      segmentationId,\r\n      segmentationRepresentationUID,\r\n      viewUp,\r\n      strategySpecificConfiguration,\r\n      eraseFocusIndex,\r\n      // Provide the preview information so that data can be used directly\r\n      preview: brushInstance._previewData?.preview,\r\n    };\r\n\r\n    return operationData;\r\n  }\r\n\r\n  private _downCallBack = (evt: EventTypes.InteractionEventType) => {\r\n    const { viewportId, element, mouseButton } = evt.detail;\r\n    // Add listener on MouseUp for segmentation on axial viewport\r\n    // Add listener on MouseDrag and MouseUp for segmentation on each dentascan viewport\r\n    if (mouseButton === 1) {\r\n      // Left button down\r\n      if (viewportId !== 'default') {\r\n        element.addEventListener(cstEnums.Events.MOUSE_DRAG, this._dragCallBack as EventListener);\r\n      }\r\n      element.addEventListener(cstEnums.Events.MOUSE_UP, this._endCallBack as EventListener);\r\n      element.addEventListener(cstEnums.Events.MOUSE_CLICK, this._endCallBack as EventListener);\r\n    }\r\n  }\r\n\r\n  private _endCallBack = (evt: EventTypes.InteractionEventType) => {\r\n    const { segmentationService, cornerstoneViewportService, displaySetService } = this.servicesManager.services;\r\n\r\n    const { viewportId, element } = evt.detail;\r\n    if (viewportId !== 'default') {\r\n      element.removeEventListener(cstEnums.Events.MOUSE_DRAG, this._dragCallBack as EventListener);\r\n    }\r\n    element.removeEventListener(cstEnums.Events.MOUSE_UP, this._endCallBack as EventListener);\r\n    element.removeEventListener(cstEnums.Events.MOUSE_CLICK, this._endCallBack as EventListener);\r\n\r\n    const { displaySetInstanceUID, volume } =\r\n      cornerstoneViewportService.getViewportInfo('default').getViewportData().data[0] as VolumeData;\r\n    const [volumeWidth, volumeHeight, nbLayers] = volume.dimensions;\r\n\r\n    const segmentations = segmentationService.getSegmentations().filter(\r\n      segmentation => segmentation.displaySetInstanceUID === displaySetInstanceUID\r\n    );\r\n\r\n    const dentascanDisplaySet = displaySetService.getActiveDisplaySets().find(\r\n      displaySet => displaySet.SeriesInstanceUID.includes('dentascan')\r\n    );\r\n    const dentascanSegmentations = segmentationService.getSegmentations().filter(\r\n      segmentation => segmentation.displaySetInstanceUID === dentascanDisplaySet.displaySetInstanceUID\r\n    );\r\n\r\n    segmentations.forEach((segmentation, segmentationIdx) => {\r\n      // Access to scalarData;\r\n      const segmentationScalarData = segmentationService.getLabelmapVolume(segmentation.id).getScalarData();\r\n      const dentascanSegId = dentascanSegmentations[segmentationIdx].id;\r\n      const dentascanSegScalarData = segmentationService.getLabelmapVolume(dentascanSegId).getScalarData();\r\n\r\n      const getPixel = (minX, minY, vxNormal, vyNormal, dentascanK) => {\r\n        const xi = minX + dentascanK * vxNormal;\r\n        const yi = minY + dentascanK * vyNormal;\r\n        const xj = minX + (dentascanK + 1) * vxNormal;\r\n        const yj = minY + (dentascanK + 1) * vyNormal;\r\n        const [pxi, pxj, pyi, pyj] = [Math.floor(xi), Math.floor(xj), Math.floor(yi), Math.floor(yj)];\r\n        if (xi < 0 || yi < 0 || xj >= volumeWidth || yj >= volumeHeight) {\r\n          return {}\r\n        };\r\n\r\n        // Same pixel\r\n        let px = pxi;\r\n        let py = pyi;\r\n        if (pxi !== pxj && pyi === pyj) {\r\n          // Compare with pixel at x + 1\r\n          const tx = (pxi < pxj) ? (1 - xi % 1) / vxNormal : -(xi % 1) / vxNormal; // Ratio of segment within pxi\r\n          if (tx >= 0.5) {\r\n            px = pxj;\r\n          }\r\n        } else if (pxi === pxj && pyi !== pyj) {\r\n          // Compare with pixel at y + 1\r\n          const ty = (pyi < pyj) ? (1 - yi % 1) / vyNormal : -(yi % 1) / vyNormal; // Ratio of segment within pyi\r\n          if (ty >= 0.5) {\r\n            py = pyj;\r\n          }\r\n        } else if (pxi !== pxj && pyi !== pyj) {\r\n          // Compare with both pixels\r\n          const tx = (pxi < pxj) ? (1 - xi % 1) / vxNormal : -(xi % 1) / vxNormal;\r\n          const ty = (pyi < pyj) ? (1 - yi % 1) / vyNormal : -(yi % 1) / vyNormal;\r\n          if (tx < ty) {\r\n            if (ty <= 0.5) {\r\n              // Take the edge voxel if it is in 50% of the segment or more\r\n              px = pxj;\r\n              py = pyj;\r\n            } else if (tx < 0.5) {\r\n              // Take the middle voxel otherwise\r\n              px = pxj;\r\n            }\r\n          } else {\r\n            if (tx <= 0.5) {\r\n              px = pxj;\r\n              py = pyj;\r\n            } else if (ty < 0.5) {\r\n              py = pyj;\r\n            }\r\n          }\r\n        }\r\n        return { px: px, py: py };\r\n      }\r\n\r\n      // Replace values of current scalar data\r\n      const { dentascans } = this.getPanoramicState(displaySetInstanceUID);\r\n      dentascans.forEach((dentascan, i) => {\r\n        const [minPoint, maxPoint] = dentascan.interval;\r\n        const [minX, minY] = minPoint.map(Math.floor);\r\n        const [vxNormal, vyNormal] = dentascan.direction;\r\n\r\n        const pixelCoordinates = [];\r\n        for (let dentascanK = 0; dentascanK < dentascan.width; dentascanK++) {\r\n          pixelCoordinates.push(getPixel(minX, minY, vxNormal, vyNormal, dentascanK));\r\n        }\r\n\r\n        for (let layer = 0; layer < nbLayers; layer++) {\r\n          for (let dentascanK = 0; dentascanK < dentascan.width; dentascanK++) {\r\n            const { px, py } = pixelCoordinates[dentascanK];\r\n            if (px === undefined) {\r\n              continue;\r\n            }\r\n            const volumeLayer = dentascan.height + dentascan.minLayer - layer;\r\n            const volumeIndex = volumeLayer * volumeWidth * volumeHeight + py * volumeWidth + px;\r\n            const dentascansIndex = i * dentascan.width * dentascan.height + layer * dentascan.width + dentascanK;\r\n\r\n            dentascanSegScalarData[dentascansIndex] = segmentationScalarData[volumeIndex];\r\n          }\r\n        };\r\n      });\r\n      // Trigger rendering\r\n      for (let i = 0; i < dentascanSegScalarData.length; i++) {\r\n        dentascanSegScalarData[i] = dentascanSegScalarData[i];\r\n      }\r\n      cstSegmentation.triggerSegmentationEvents.triggerSegmentationDataModified(dentascanSegId);\r\n    });\r\n  }\r\n\r\n  protected getPassiveSegmentationId = () => {\r\n    const { segmentationService } = this.servicesManager.services;\r\n\r\n    const activeSegmentation = cstSegmentation.activeSegmentation.getActiveSegmentation('mpr');\r\n    const { segmentationId: activeSegId, representationData } = activeSegmentation;\r\n    const activeSegVolumeId = (representationData.LABELMAP as LabelmapSegmentationDataVolume).referencedVolumeId;\r\n\r\n    const activeSegmentations = segmentationService.getSegmentations().filter(\r\n      segmentation => segmentation.representationData.LABELMAP.referencedVolumeId === activeSegVolumeId\r\n    );\r\n    const passiveSegmentations = segmentationService.getSegmentations().filter(\r\n      segmentation => segmentation.representationData.LABELMAP.referencedVolumeId !== activeSegVolumeId\r\n    );\r\n\r\n    const activeSegIndex = activeSegmentations.findIndex(segmentation => segmentation.id === activeSegId);\r\n\r\n    return passiveSegmentations[activeSegIndex].id;\r\n  }\r\n\r\n  protected activatePassiveSegmentation = (passiveSegId: string) => {\r\n    const { segmentationService } = this.servicesManager.services;\r\n\r\n    const segRepresentations = segmentationService.getSegmentationRepresentationsForToolGroup('mpr') as\r\n      cstTypes.ToolGroupSpecificRepresentation[];\r\n    const passiveSegRepresentationUID = segRepresentations.find(\r\n      representation => representation.segmentationId === passiveSegId\r\n    ).segmentationRepresentationUID;\r\n    cstSegmentation.activeSegmentation.setActiveSegmentationRepresentation('mpr', passiveSegRepresentationUID);\r\n  }\r\n\r\n  private _dragCallBack = (evt: EventTypes.InteractionEventType) => {\r\n    const { cornerstoneViewportService, toolGroupService } = this.servicesManager.services;\r\n\r\n    const toolGroup = toolGroupService.getToolGroup('mpr') as cstTypes.IToolGroup;\r\n    if (toolGroup.currentActivePrimaryToolName !== 'Brush') {\r\n      return;\r\n    }\r\n    const brushInstance = toolGroup.getToolInstance('Brush');\r\n\r\n    const { segmentationId: activeSegId } = cstSegmentation.activeSegmentation.getActiveSegmentation('mpr');\r\n    const passiveSegId = this.getPassiveSegmentationId();\r\n    this.activatePassiveSegmentation(passiveSegId);\r\n\r\n    const segmentIndex = cstSegmentation.segmentIndex.getActiveSegmentIndex(passiveSegId);\r\n    const axialOperationData = this.getAxialOperationData(evt, brushInstance, segmentIndex);\r\n\r\n    const axialElement = cornerstoneViewportService.getCornerstoneViewport('default').element;\r\n    const axialEnabledElement = getEnabledElement(axialElement);\r\n    brushInstance.applyActiveStrategy(axialEnabledElement, axialOperationData);\r\n    // Due to the current implementation, activatePassiveSegmentation switches back and forth\r\n    // between axialSegmentation and dentascanSegmentation\r\n    this.activatePassiveSegmentation(activeSegId);\r\n  }\r\n\r\n  public computePanoramic = async () => {\r\n    const { cornerstoneViewportService, viewportGridService, uiNotificationService } = this.servicesManager.services;\r\n\r\n    // Display progress bar in front-end\r\n    this.processing = true;\r\n    this._broadcastEvent(this.EVENTS.PANORAMIC_PROCESSING, { percent: 1 });\r\n    uiNotificationService.show({\r\n      title: 'Panoramic computation',\r\n      message: 'The computation of the panoramic and dentascans may take a few seconds',\r\n      type: 'info',\r\n      duration: 3000,\r\n    });\r\n\r\n    // Ensure display is correct before computation\r\n    if (!cornerstoneViewportService.getCornerstoneViewport('default')) {\r\n      // Fix issue when protocol is on the focused volume3D\r\n      this.commandsManager.runCommand('toggleOneUp');\r\n      await waitCondition(() => cornerstoneViewportService.getCornerstoneViewport('default'));\r\n    }\r\n\r\n    const displaySetUID = viewportGridService.getDisplaySetsUIDsForViewport('default')[0];\r\n    let panoramicState = this.getPanoramicState(displaySetUID);\r\n    // No control points\r\n    if (!panoramicState?.annotationUIDs.length) {\r\n      await createControlPoints({ servicesManager: this.servicesManager });\r\n    }\r\n\r\n    this._broadcastEvent(this.EVENTS.PANORAMIC_PROCESSING, { percent: 50 });\r\n\r\n    await createPanoramic({ extensionManager: this.extensionManager, servicesManager: this.servicesManager });\r\n    panoramicState = this.getPanoramicState(displaySetUID);\r\n\r\n    this._broadcastEvent(this.EVENTS.PANORAMIC_PROCESSING, { percent: 100 });\r\n    await this.refreshPanoramicDisplay();\r\n\r\n    // Triggers dentascanIndexUpdated event\r\n    this.setDentascanIndex(displaySetUID, Math.round(panoramicState.panoramic.width / 2));\r\n\r\n    this._broadcastEvent(this.EVENTS.PANORAMIC_CREATED, { displaySetUID: displaySetUID });\r\n    this.processing = false;\r\n  }\r\n\r\n  public renderPanoramic = async (displaySetUID: string) => {\r\n    const { hangingProtocolService, cornerstoneViewportService } = this.servicesManager.services;\r\n\r\n    if (hangingProtocolService.getActiveProtocol().protocol.id !== 'panoramicViewport') {\r\n      return;\r\n    }\r\n\r\n    // Ensure viewports are correctly displayed\r\n    await waitCondition(() => cornerstoneViewportService.getRenderingEngine()._needsRender.size === 0);\r\n    // TODO\r\n    const nbExpectedViewports = hangingProtocolService.getActiveProtocol().viewportMatchDetails.size;\r\n    await waitCondition(() => cornerstoneViewportService.getViewportIds().length === nbExpectedViewports);\r\n\r\n    const viewportIds = cornerstoneViewportService.getViewportIds();\r\n    this.deletePanoramicAnnotation();\r\n    // TODO render only if panoramic\r\n    this.generateNewPanoramicAnnotation(displaySetUID, viewportIds[1]);\r\n    this.displayDentascans();\r\n  }\r\n\r\n  public deletePanoramicAnnotation = () => {\r\n    const { measurementService } = this.servicesManager.services;\r\n\r\n    //============================= DELETE ALL PREVIOUS DENTASCAN ANNOTATIONS =================//\r\n    const dentascanMeasurements = measurementService.getMeasurements()\r\n      .filter(m => {return m.toolName === 'ArrowAnnotate'});\r\n\r\n    // Delete measurements that are not handmade (thus the interpolated line)\r\n    for (const pm of dentascanMeasurements) {\r\n      if (pm.metadata.dentascan) {\r\n        this.commandsManager.runCommand('deleteMeasurement', { uid: pm.uid });\r\n      }\r\n    }\r\n  }\r\n\r\n  public generateNewPanoramicAnnotation = (displaySetUID: string, panoramicViewportId: string) => {\r\n    const { cornerstoneViewportService, toolGroupService } = this.servicesManager.services;\r\n\r\n    //================== DISPLAY DENTASCAN SECTION IN PANORAMIC AS ANNOTATION ===========================//\r\n    const panoramicViewport = cornerstoneViewportService.getCornerstoneViewport(panoramicViewportId);\r\n    if (!panoramicViewport) {\r\n      // Panoramic Viewport not found\r\n      return\r\n    }\r\n\r\n    // Rescale dentascanIndex with PixelSpacing\r\n    // TODO displaySet may not be needed for spacing\r\n    const panoramicState = this.getPanoramicState(displaySetUID);\r\n    const pointX = this.dentascanIndex * panoramicState.dentascanViewportData.data[0].volume.spacing[0];\r\n    const pointY =\r\n      (panoramicState.panoramic.height - 1) * panoramicState.dentascanViewportData.data[0].volume.spacing[2];\r\n\r\n    const pointUp = [pointX, 0, 0];\r\n    const pointDown = [pointX, pointY, 0];\r\n\r\n    // Get ArrowAnnotate instance in order to create new annotation indicating dentascan section on panoramic\r\n    const toolGroup = toolGroupService.getToolGroupForViewport(panoramicViewport.id);\r\n\r\n    const arrowAnnotateInstance = toolGroup.getToolInstance('ArrowAnnotate');\r\n    arrowAnnotateInstance.addNewAnnotationWithMode(\r\n      panoramicViewport.element, [pointUp, pointDown], 'dentascan', 'rgb(255, 255, 255)'\r\n    );\r\n  }\r\n\r\n  public displayDentascans = () => {\r\n    const { cornerstoneViewportService } = this.servicesManager.services;\r\n\r\n    //================== DISPLAY WANTED DENTASCANS IN BOTTOM VIEWPORT ===========================//\r\n    const viewportIds = cornerstoneViewportService.getViewportIds();\r\n    const nbDentascanViewports = viewportIds.length - 2;\r\n    if (nbDentascanViewports > 0) {\r\n      const middleDentascanViewportIndex = Math.floor(nbDentascanViewports / 2);\r\n      for (let i = 0; i < nbDentascanViewports; i++) {\r\n        const { element } = cornerstoneViewportService.getCornerstoneViewport(viewportIds[i + 2]);\r\n        // We also display the dentascans before and after the main one\r\n        cstUtilities.jumpToSlice(element, {\r\n          imageIndex: this.dentascanIndex + (i - middleDentascanViewportIndex) * 2,\r\n          debounceLoading: true,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  public addViewportListeners = async () => {\r\n    const { cornerstoneViewportService, hangingProtocolService } = this.servicesManager.services;\r\n\r\n    // Ensure listeners are not added before dentascan viewports are accessible\r\n    const nbExpectedViewports = hangingProtocolService.getActiveProtocol().viewportMatchDetails.size;\r\n    await waitCondition(() => cornerstoneViewportService.getViewportIds().length === nbExpectedViewports);\r\n\r\n    const { element } = cornerstoneViewportService.getCornerstoneViewport('default');\r\n    element.addEventListener(cstEnums.Events.MOUSE_DOWN, this._downCallBack as EventListener);\r\n    const viewportIds = cornerstoneViewportService.getViewportIds();\r\n    for (let i = 2; i < viewportIds.length; i++) {\r\n      const { element } = cornerstoneViewportService.getCornerstoneViewport(viewportIds[i]);\r\n      element.addEventListener(cstEnums.Events.MOUSE_DOWN, this._downCallBack as EventListener);\r\n    }\r\n  }\r\n\r\n  public refreshPanoramicDisplay = async () => {\r\n    const { cornerstoneViewportService, viewportGridService } = this.servicesManager.services;\r\n\r\n    const panoramicVpId = cornerstoneViewportService.getViewportIds()[1];\r\n    const panoramicDisplaySetUID = viewportGridService.getDisplaySetsUIDsForViewport(panoramicVpId)?.[0];\r\n\r\n    this.commandsManager.runCommand(\r\n      'setHangingProtocol', { protocolId: 'panoramicViewport', stageIndex: 0, reset: true }\r\n    );\r\n\r\n    // Wait until displaySet is updated\r\n    await waitCondition(() => {\r\n      const newPanoramicVpId = cornerstoneViewportService.getViewportIds()[1];\r\n      return panoramicDisplaySetUID !== viewportGridService.getDisplaySetsUIDsForViewport(newPanoramicVpId)?.[0];\r\n    });\r\n  }\r\n}\r\n","import PanoramicService from './PanoramicService';\r\nexport default PanoramicService;\r\n","import { imageLoader } from '@cornerstonejs/core';\r\nimport dicomImageLoader from '@cornerstonejs/dicom-image-loader';\r\nimport { api } from 'dicomweb-client';\r\nimport { DICOMWeb, errorHandler } from '@ohif/core';\r\n\r\nconst getImageId = imageObj => {\r\n  if (!imageObj) {\r\n    return;\r\n  }\r\n\r\n  return typeof imageObj.getImageId === 'function' ? imageObj.getImageId() : imageObj.url;\r\n};\r\n\r\nconst findImageIdOnStudies = (studies, displaySetInstanceUID) => {\r\n  const study = studies.find(study => {\r\n    const displaySet = study.displaySets.some(\r\n      displaySet => displaySet.displaySetInstanceUID === displaySetInstanceUID\r\n    );\r\n    return displaySet;\r\n  });\r\n  const { series = [] } = study;\r\n  const { instances = [] } = series[0] || {};\r\n  const instance = instances[0];\r\n\r\n  return getImageId(instance);\r\n};\r\n\r\nconst someInvalidStrings = strings => {\r\n  const stringsArray = Array.isArray(strings) ? strings : [strings];\r\n  const emptyString = string => !string;\r\n  let invalid = stringsArray.some(emptyString);\r\n  return invalid;\r\n};\r\n\r\nconst getImageInstance = dataset => {\r\n  return dataset && dataset.images && dataset.images[0];\r\n};\r\n\r\nconst getNonImageInstance = dataset => {\r\n  return dataset && dataset.instance;\r\n};\r\n\r\nconst getImageInstanceId = imageInstance => {\r\n  return getImageId(imageInstance);\r\n};\r\n\r\nconst fetchIt = (url, headers = DICOMWeb.getAuthorizationHeader()) => {\r\n  return fetch(url, headers).then(response => response.arrayBuffer());\r\n};\r\n\r\nconst cornerstoneRetriever = imageId => {\r\n  return imageLoader.loadAndCacheImage(imageId).then(image => {\r\n    return image && image.data && image.data.byteArray.buffer;\r\n  });\r\n};\r\n\r\nconst wadorsRetriever = (\r\n  url,\r\n  studyInstanceUID,\r\n  seriesInstanceUID,\r\n  sopInstanceUID,\r\n  headers = DICOMWeb.getAuthorizationHeader(),\r\n  errorInterceptor = errorHandler.getHTTPErrorHandler()\r\n) => {\r\n  const config = {\r\n    url,\r\n    headers,\r\n    errorInterceptor,\r\n  };\r\n  const dicomWeb = new api.DICOMwebClient(config);\r\n\r\n  return dicomWeb.retrieveInstance({\r\n    studyInstanceUID,\r\n    seriesInstanceUID,\r\n    sopInstanceUID,\r\n  });\r\n};\r\n\r\nconst getImageLoaderType = imageId => {\r\n  const loaderRegExp = /^\\w+\\:/;\r\n  const loaderType = loaderRegExp.exec(imageId);\r\n\r\n  return (\r\n    (loaderRegExp.lastIndex === 0 &&\r\n      loaderType &&\r\n      loaderType[0] &&\r\n      loaderType[0].replace(':', '')) ||\r\n    ''\r\n  );\r\n};\r\n\r\nclass DicomLoaderService {\r\n  getLocalData(dataset, studies) {\r\n    // Use referenced imageInstance\r\n    const imageInstance = getImageInstance(dataset);\r\n    const nonImageInstance = getNonImageInstance(dataset);\r\n\r\n    if (\r\n      (!imageInstance && !nonImageInstance) ||\r\n      !nonImageInstance.imageId?.startsWith('dicomfile')\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const instance = imageInstance || nonImageInstance;\r\n\r\n    let imageId = getImageInstanceId(instance);\r\n\r\n    // or Try to get it from studies\r\n    if (someInvalidStrings(imageId)) {\r\n      imageId = findImageIdOnStudies(studies, dataset.displaySetInstanceUID);\r\n    }\r\n\r\n    if (!someInvalidStrings(imageId)) {\r\n      return dicomImageLoader.wadouri.loadFileRequest(imageId);\r\n    }\r\n  }\r\n\r\n  getDataByImageType(dataset) {\r\n    const imageInstance = getImageInstance(dataset);\r\n\r\n    if (imageInstance) {\r\n      const imageId = getImageInstanceId(imageInstance);\r\n      let getDicomDataMethod = fetchIt;\r\n      const loaderType = getImageLoaderType(imageId);\r\n\r\n      switch (loaderType) {\r\n        case 'dicomfile':\r\n          getDicomDataMethod = cornerstoneRetriever.bind(this, imageId);\r\n          break;\r\n        case 'wadors':\r\n          const url = imageInstance.getData().wadoRoot;\r\n          const studyInstanceUID = imageInstance.getStudyInstanceUID();\r\n          const seriesInstanceUID = imageInstance.getSeriesInstanceUID();\r\n          const sopInstanceUID = imageInstance.getSOPInstanceUID();\r\n          const invalidParams = someInvalidStrings([\r\n            url,\r\n            studyInstanceUID,\r\n            seriesInstanceUID,\r\n            sopInstanceUID,\r\n          ]);\r\n          if (invalidParams) {\r\n            return;\r\n          }\r\n\r\n          getDicomDataMethod = wadorsRetriever.bind(\r\n            this,\r\n            url,\r\n            studyInstanceUID,\r\n            seriesInstanceUID,\r\n            sopInstanceUID\r\n          );\r\n          break;\r\n        case 'wadouri':\r\n          // Strip out the image loader specifier\r\n          imageId = imageId.substring(imageId.indexOf(':') + 1);\r\n\r\n          if (someInvalidStrings(imageId)) {\r\n            return;\r\n          }\r\n          getDicomDataMethod = fetchIt.bind(this, imageId);\r\n          break;\r\n        default:\r\n          throw new Error(`Unsupported image type: ${loaderType} for imageId: ${imageId}`);\r\n      }\r\n\r\n      return getDicomDataMethod();\r\n    }\r\n  }\r\n\r\n  getDataByDatasetType(dataset) {\r\n    const {\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      authorizationHeaders,\r\n      wadoRoot,\r\n      wadoUri,\r\n      instance,\r\n    } = dataset;\r\n    // Retrieve wadors or just try to fetch wadouri\r\n    if (!someInvalidStrings(wadoRoot)) {\r\n      return wadorsRetriever(\r\n        wadoRoot,\r\n        StudyInstanceUID,\r\n        SeriesInstanceUID,\r\n        SOPInstanceUID,\r\n        authorizationHeaders\r\n      );\r\n    } else if (!someInvalidStrings(wadoUri)) {\r\n      return fetchIt(wadoUri, { headers: authorizationHeaders });\r\n    } else if (!someInvalidStrings(instance?.url)) {\r\n      // make sure the url is absolute, remove the scope\r\n      // from it if it is not absolute. For instance it might be dicomweb:http://....\r\n      // and we need to remove the dicomweb: part\r\n      const url = instance.url;\r\n      const absoluteUrl = url.startsWith('http') ? url : url.substring(url.indexOf(':') + 1);\r\n      return fetchIt(absoluteUrl, { headers: authorizationHeaders });\r\n    }\r\n  }\r\n\r\n  *getLoaderIterator(dataset, studies, headers) {\r\n    yield this.getLocalData(dataset, studies);\r\n    yield this.getDataByImageType(dataset);\r\n    yield this.getDataByDatasetType(dataset);\r\n  }\r\n\r\n  findDicomDataPromise(dataset, studies, headers) {\r\n    dataset.authorizationHeaders = headers;\r\n    const loaderIterator = this.getLoaderIterator(dataset, studies);\r\n    // it returns first valid retriever method.\r\n    for (const loader of loaderIterator) {\r\n      if (loader) {\r\n        return loader;\r\n      }\r\n    }\r\n\r\n    // in case of no valid loader\r\n    throw new Error('Invalid dicom data loader');\r\n  }\r\n}\r\n\r\nconst dicomLoaderService = new DicomLoaderService();\r\n\r\nexport default dicomLoaderService;\r\n","import packageJson from '../package.json';\r\n\r\nconst id = packageJson.name;\r\n\r\nexport { id };\r\n","import { getWebWorkerManager } from '@cornerstonejs/core';\r\n\r\nconst workerManager = getWebWorkerManager();\r\n\r\nconst WorkerOptions = {\r\n  maxWorkerInstances: 1,\r\n  autoTerminateOnIdle: {\r\n    enabled: true,\r\n    idleTimeThreshold: 1000,\r\n  },\r\n};\r\n\r\n// Register the task\r\nconst workerFn = () => {\r\n  return new Worker(new URL('./histogramWorker.js', import.meta.url), {\r\n    name: 'histogram-worker', // name used by the browser to name the worker\r\n  });\r\n};\r\n\r\nconst getViewportVolumeHistogram = async (viewport, volume, options?) => {\r\n  workerManager.registerWorker('histogram-worker', workerFn, WorkerOptions);\r\n\r\n  if (!volume?.loadStatus.loaded) {\r\n    return undefined;\r\n  }\r\n\r\n  const volumeImageData = viewport.getImageData(volume.volumeId);\r\n\r\n  if (!volumeImageData) {\r\n    return undefined;\r\n  }\r\n\r\n  let scalarData = volume.scalarData;\r\n\r\n  let prevTimePoint;\r\n  if (volume.numTimePoints > 1) {\r\n    prevTimePoint = volume.timePointIndex;\r\n    const middleTimePoint = Math.round(volume.numTimePoints / 2);\r\n    volume.timePointIndex = middleTimePoint;\r\n    scalarData = volume.getScalarData(middleTimePoint);\r\n  }\r\n\r\n  const { dimensions, origin, direction, spacing } = volume;\r\n\r\n  const range = await workerManager.executeTask('histogram-worker', 'getRange', {\r\n    dimensions,\r\n    origin,\r\n    direction,\r\n    spacing,\r\n    scalarData,\r\n  });\r\n\r\n  // after we calculate the range let's reset the timePointIndex\r\n  if (volume.numTimePoints > 1) {\r\n    volume.timePointIndex = prevTimePoint;\r\n  }\r\n  const { minimum: min, maximum: max } = range;\r\n  const calcHistOptions = {\r\n    numBins: 256,\r\n    min: Math.max(min, options?.min ?? min),\r\n    max: Math.min(max, options?.max ?? max),\r\n  };\r\n\r\n  const histogram = await workerManager.executeTask('histogram-worker', 'calcHistogram', {\r\n    data: scalarData,\r\n    options: calcHistOptions,\r\n  });\r\n\r\n  return histogram;\r\n};\r\n\r\nexport { getViewportVolumeHistogram };\r\n","import React, { useEffect, useCallback, useState, ReactElement } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport debounce from 'lodash.debounce';\r\nimport { PanelSection, WindowLevel } from '@ohif/ui';\r\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\r\nimport { Enums, eventTarget, cache as cs3DCache, utilities as csUtils } from '@cornerstonejs/core';\r\nimport { getViewportVolumeHistogram } from './getViewportVolumeHistogram';\r\n\r\nconst { Events } = Enums;\r\n\r\nconst ViewportWindowLevel = ({\r\n  servicesManager,\r\n  viewportId,\r\n}: withAppTypes<{\r\n  viewportId: string;\r\n}>): ReactElement => {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const [windowLevels, setWindowLevels] = useState([]);\r\n  const [cachedHistograms, setCachedHistograms] = useState({});\r\n\r\n  /**\r\n   * Looks for all viewports that has exactly all volumeIds passed as parameter.\r\n   */\r\n  const getViewportsWithVolumeIds = useCallback(\r\n    (volumeIds: string[]) => {\r\n      const renderingEngine = cornerstoneViewportService.getRenderingEngine();\r\n      const viewports = renderingEngine.getVolumeViewports();\r\n\r\n      return viewports.filter(vp => {\r\n        const viewportVolumeIds = vp.getActors().map(actor => actor.uid);\r\n\r\n        return (\r\n          volumeIds.length === viewportVolumeIds.length &&\r\n          volumeIds.every(volumeId => viewportVolumeIds.includes(volumeId))\r\n        );\r\n      });\r\n    },\r\n    [cornerstoneViewportService]\r\n  );\r\n\r\n  const getNodeOpacity = (volumeActor, nodeIndex) => {\r\n    const volumeOpacity = volumeActor.getProperty().getScalarOpacity(0);\r\n    const nodeValue = [];\r\n\r\n    volumeOpacity.getNodeValue(nodeIndex, nodeValue);\r\n\r\n    return nodeValue[1];\r\n  };\r\n\r\n  /**\r\n   * Checks if the opacity applied to the PET volume is something like\r\n   * [{x: 0, y: 0}, {x: 0.1, y: [C]}, {x: [ANY], y: [C]}] where C is a\r\n   * constant opacity value for all x's greater than 0.1\r\n   */\r\n  const isPetVolumeWithDefaultOpacity = (volumeId, volumeActor) => {\r\n    const volume = cs3DCache.getVolume(volumeId);\r\n\r\n    if (!volume) {\r\n      return false;\r\n    }\r\n\r\n    const modality = volume.metadata.Modality;\r\n\r\n    if (modality !== 'PT') {\r\n      return false;\r\n    }\r\n\r\n    const volumeOpacity = volumeActor.getProperty().getScalarOpacity(0);\r\n\r\n    // It must have at least two points (0 and 0.1)\r\n    if (volumeOpacity.getSize() < 2) {\r\n      return false;\r\n    }\r\n\r\n    const node1Value = [];\r\n    const node2Value = [];\r\n\r\n    volumeOpacity.getNodeValue(0, node1Value);\r\n    volumeOpacity.getNodeValue(1, node2Value);\r\n\r\n    // First node must be (x:0, y:0} and the second one {x:0.1, y:any}\r\n    if (node1Value[0] !== 0 || node1Value[1] !== 0 || node2Value[0] !== 0.1) {\r\n      return false;\r\n    }\r\n\r\n    const expectedOpacity = node2Value[1];\r\n    const opacitySize = volumeOpacity.getSize();\r\n    const currentNodeValue = [];\r\n\r\n    // Any point after 0.1 must have the same opacity\r\n    for (let i = 2; i < opacitySize; i++) {\r\n      volumeOpacity.getNodeValue(i, currentNodeValue);\r\n\r\n      if (currentNodeValue[1] !== expectedOpacity) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * Checks if the opacity function has a constance opacity value for all x's\r\n   */\r\n  const isVolumeWithConstantOpacity = volumeActor => {\r\n    const volumeOpacity = volumeActor.getProperty().getScalarOpacity(0);\r\n    const opacitySize = volumeOpacity.getSize();\r\n    const firstNodeValue = [];\r\n\r\n    volumeOpacity.getNodeValue(0, firstNodeValue);\r\n\r\n    const firstNodeOpacity = firstNodeValue[1];\r\n\r\n    for (let i = 0; i < opacitySize; i++) {\r\n      const currentNodeValue = [];\r\n\r\n      volumeOpacity.getNodeValue(0, currentNodeValue);\r\n\r\n      if (currentNodeValue[1] !== firstNodeOpacity) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  const getVolumeOpacity = useCallback((viewport, volumeId) => {\r\n    const volumeActor = viewport.getActor(volumeId).actor;\r\n\r\n    if (isPetVolumeWithDefaultOpacity(volumeId, volumeActor)) {\r\n      // Get the opacity from the second node at 0.1\r\n      return getNodeOpacity(volumeActor, 1);\r\n    } else if (isVolumeWithConstantOpacity(volumeActor)) {\r\n      return getNodeOpacity(volumeActor, 0);\r\n    }\r\n\r\n    return undefined;\r\n  }, []);\r\n\r\n  const getWindowLevelsData = useCallback(\r\n    async (viewportId: number) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n      if (!viewport) {\r\n        return [];\r\n      }\r\n\r\n      const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n\r\n      const volumeIds = viewport.getActors().map(actor => actor.uid);\r\n      const viewportProperties = viewport.getProperties();\r\n      const { voiRange } = viewportProperties;\r\n      const viewportVoi = voiRange\r\n        ? {\r\n            windowWidth: voiRange.upper - voiRange.lower,\r\n            windowCenter: voiRange.lower + (voiRange.upper - voiRange.lower) / 2,\r\n          }\r\n        : undefined;\r\n\r\n      const windowLevels = await Promise.all(\r\n        volumeIds.map(async (volumeId, volumeIndex) => {\r\n          const volume = cs3DCache.getVolume(volumeId);\r\n\r\n          if (!volume) {\r\n            return null;\r\n          }\r\n\r\n          const opacity = getVolumeOpacity(viewport, volumeId);\r\n          const { metadata, scaling } = volume;\r\n          const modality = metadata.Modality;\r\n\r\n          // TODO: find a proper way to fix the histogram\r\n          const options = {\r\n            min: modality === 'PT' ? 0.1 : -999,\r\n            max: modality === 'PT' ? 5 : 10000,\r\n          };\r\n\r\n          const histogram =\r\n            cachedHistograms[volumeId] ??\r\n            (await getViewportVolumeHistogram(viewport, volume, options));\r\n          const { voi: displaySetVOI, colormap: displaySetColormap } =\r\n            viewportInfo.displaySetOptions[volumeIndex];\r\n          let colormap;\r\n          if (displaySetColormap) {\r\n            colormap =\r\n              csUtils.colormap.getColormap(displaySetColormap.name) ??\r\n              vtkColorMaps.getPresetByName(displaySetColormap.name);\r\n          }\r\n\r\n          const voi = !volumeIndex ? viewportVoi ?? displaySetVOI : displaySetVOI;\r\n\r\n          return {\r\n            viewportId,\r\n            modality,\r\n            volumeId,\r\n            volumeIndex,\r\n            voi,\r\n            histogram,\r\n            colormap,\r\n            step: scaling?.PT ? 0.05 : 1,\r\n            opacity,\r\n            showOpacitySlider: volumeIndex === 1 && opacity !== undefined,\r\n          };\r\n        })\r\n      );\r\n\r\n      const data = windowLevels.filter(Boolean);\r\n      return data;\r\n    },\r\n\r\n    [cachedHistograms, cornerstoneViewportService, getVolumeOpacity]\r\n  );\r\n\r\n  const updateViewportHistograms = useCallback(() => {\r\n    getWindowLevelsData(viewportId).then(windowLevels => {\r\n      setWindowLevels(windowLevels);\r\n    });\r\n  }, [viewportId, getWindowLevelsData]);\r\n\r\n  const handleCornerstoneVOIModified = useCallback(\r\n    e => {\r\n      const { detail } = e;\r\n      const { volumeId, range } = detail;\r\n      const oldWindowLevel = windowLevels.find(wl => wl.volumeId === volumeId);\r\n\r\n      if (!oldWindowLevel) {\r\n        return;\r\n      }\r\n\r\n      const oldVOI = oldWindowLevel.voi;\r\n      const windowWidth = range.upper - range.lower;\r\n      const windowCenter = range.lower + windowWidth / 2;\r\n\r\n      if (windowWidth === oldVOI.windowWidth && windowCenter === oldVOI.windowCenter) {\r\n        return;\r\n      }\r\n\r\n      const newWindowLevel = {\r\n        ...oldWindowLevel,\r\n        voi: {\r\n          windowWidth,\r\n          windowCenter,\r\n        },\r\n      };\r\n\r\n      setWindowLevels(\r\n        windowLevels.map(windowLevel =>\r\n          windowLevel === oldWindowLevel ? newWindowLevel : windowLevel\r\n        )\r\n      );\r\n    },\r\n    [windowLevels]\r\n  );\r\n\r\n  const debouncedHandleCornerstoneVOIModified = useCallback(\r\n    debounce(handleCornerstoneVOIModified, 100),\r\n    [handleCornerstoneVOIModified]\r\n  );\r\n\r\n  const handleVOIChange = useCallback(\r\n    (volumeId, voi) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n      const newRange = {\r\n        lower: voi.windowCenter - voi.windowWidth / 2,\r\n        upper: voi.windowCenter + voi.windowWidth / 2,\r\n      };\r\n\r\n      viewport.setProperties({ voiRange: newRange }, volumeId);\r\n      viewport.render();\r\n    },\r\n    [cornerstoneViewportService, viewportId]\r\n  );\r\n\r\n  const handleOpacityChange = useCallback(\r\n    (viewportId, _volumeIndex, volumeId, opacity) => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n      if (!viewport) {\r\n        return;\r\n      }\r\n\r\n      const viewportVolumeIds = viewport.getActors().map(actor => actor.uid);\r\n      const viewports = getViewportsWithVolumeIds(viewportVolumeIds);\r\n\r\n      viewports.forEach(vp => {\r\n        vp.setProperties({ colormap: { opacity } }, volumeId);\r\n        vp.render();\r\n      });\r\n    },\r\n    [getViewportsWithVolumeIds, cornerstoneViewportService]\r\n  );\r\n\r\n  // Listen to windowLevels changes and caches all the new ones\r\n  useEffect(() => {\r\n    const newVolumeHistograms = windowLevels\r\n      .filter(windowLevel => !cachedHistograms[windowLevel.volumeId] && windowLevel.histogram)\r\n      .reduce((volumeHistograms, windowLevel) => {\r\n        // If the histogram exists, add it to the volumeHistograms object\r\n        if (windowLevel?.histogram) {\r\n          volumeHistograms[windowLevel.volumeId] = windowLevel.histogram;\r\n        }\r\n        return volumeHistograms;\r\n      }, {});\r\n\r\n    if (Object.keys(newVolumeHistograms).length) {\r\n      setCachedHistograms(prev => ({ ...prev, ...newVolumeHistograms }));\r\n    }\r\n  }, [windowLevels, cachedHistograms]);\r\n\r\n  // Updates the histogram when the viewport index prop has changed\r\n  useEffect(() => updateViewportHistograms(), [viewportId, updateViewportHistograms]);\r\n\r\n  // Listen to cornerstone events on \"eventTarget\" and at the document level\r\n  useEffect(() => {\r\n    eventTarget.addEventListener(Events.IMAGE_VOLUME_LOADING_COMPLETED, updateViewportHistograms);\r\n\r\n    document.addEventListener(Events.VOI_MODIFIED, debouncedHandleCornerstoneVOIModified, true);\r\n\r\n    return () => {\r\n      eventTarget.removeEventListener(\r\n        Events.IMAGE_VOLUME_LOADING_COMPLETED,\r\n        updateViewportHistograms\r\n      );\r\n\r\n      document.removeEventListener(\r\n        Events.VOI_MODIFIED,\r\n        debouncedHandleCornerstoneVOIModified,\r\n        true\r\n      );\r\n    };\r\n  }, [updateViewportHistograms, debouncedHandleCornerstoneVOIModified]);\r\n\r\n  // Updates the viewport when the context of the viewport has changed. This is\r\n  // necessary when moving across different stages because the viewport index\r\n  // may not change but the volumes loaded on it may change.\r\n  useEffect(() => {\r\n    const { unsubscribe } = cornerstoneViewportService.subscribe(\r\n      cornerstoneViewportService.EVENTS.VIEWPORT_VOLUMES_CHANGED,\r\n      ({ viewportInfo }) => {\r\n        if (viewportInfo.viewportId === viewportId) {\r\n          updateViewportHistograms();\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewportId, cornerstoneViewportService, updateViewportHistograms]);\r\n\r\n  return (\r\n    <PanelSection title=\"Window Level\">\r\n      {windowLevels.map((windowLevel, i) => {\r\n        if (!windowLevel.histogram) {\r\n          return null;\r\n        }\r\n\r\n        return (\r\n          <WindowLevel\r\n            key={windowLevel.volumeId}\r\n            title={`${windowLevel.modality}`}\r\n            histogram={windowLevel.histogram}\r\n            voi={windowLevel.voi}\r\n            step={windowLevel.step}\r\n            showOpacitySlider={windowLevel.showOpacitySlider}\r\n            colormap={windowLevel.colormap}\r\n            onVOIChange={voi => handleVOIChange(windowLevel.volumeId, voi)}\r\n            opacity={windowLevel.opacity}\r\n            onOpacityChange={opacity =>\r\n              handleOpacityChange(windowLevel.viewportId, i, windowLevel.volumeId, opacity)\r\n            }\r\n          />\r\n        );\r\n      })}\r\n    </PanelSection>\r\n  );\r\n};\r\n\r\nViewportWindowLevel.propTypes = {\r\n  servicesManager: PropTypes.object.isRequired,\r\n  viewportId: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default ViewportWindowLevel;\r\n","import React, { ReactElement } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useViewportGrid } from '@ohif/ui';\r\nimport ViewportWindowLevel from '../ViewportWindowLevel/ViewportWindowLevel';\r\n\r\nconst ActiveViewportWindowLevel = ({ servicesManager }: withAppTypes): ReactElement => {\r\n  const [viewportGrid] = useViewportGrid();\r\n  const { activeViewportId } = viewportGrid;\r\n\r\n  return (\r\n    <>\r\n      {activeViewportId && (\r\n        <ViewportWindowLevel\r\n          servicesManager={servicesManager}\r\n          viewportId={activeViewportId}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nActiveViewportWindowLevel.propTypes = {\r\n  servicesManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default ActiveViewportWindowLevel;\r\n","import { SynchronizerManager, Synchronizer, utilities } from '@cornerstonejs/tools';\r\nimport { EVENTS, getRenderingEngine, Types } from '@cornerstonejs/core';\r\n\r\nconst frameViewSyncCallback = (\r\n  synchronizerInstance: Synchronizer,\r\n  sourceViewport: Types.IViewportId,\r\n  targetViewport: Types.IViewportId\r\n) => {\r\n  const renderingEngine = getRenderingEngine(targetViewport.renderingEngineId);\r\n  if (!renderingEngine) {\r\n    throw new Error(`No RenderingEngine for Id: ${targetViewport.renderingEngineId}`);\r\n  }\r\n  const sViewport = renderingEngine.getViewport(sourceViewport.viewportId) as Types.IStackViewport;\r\n\r\n  const { viewportIndex: targetViewportIndex } = synchronizerInstance.getOptions(\r\n    targetViewport.viewportId\r\n  );\r\n\r\n  const { viewportIndex: sourceViewportIndex } = synchronizerInstance.getOptions(\r\n    sourceViewport.viewportId\r\n  );\r\n\r\n  if (targetViewportIndex === undefined || sourceViewportIndex === undefined) {\r\n    throw new Error('No viewportIndex provided');\r\n  }\r\n\r\n  const tViewport = renderingEngine.getViewport(targetViewport.viewportId) as Types.IStackViewport;\r\n\r\n  const sourceSliceIndex = sViewport.getSliceIndex();\r\n  const sliceDifference = Number(targetViewportIndex) - Number(sourceViewportIndex);\r\n  const targetSliceIndex = sourceSliceIndex + sliceDifference;\r\n\r\n  if (targetSliceIndex === tViewport.getSliceIndex()) {\r\n    return;\r\n  }\r\n\r\n  utilities.jumpToSlice(tViewport.element, {\r\n    imageIndex: targetSliceIndex,\r\n  });\r\n};\r\n\r\nconst createFrameViewSynchronizer = (synchronizerName: string): Synchronizer => {\r\n  const synchronizer = SynchronizerManager.createSynchronizer(\r\n    synchronizerName,\r\n    EVENTS.CAMERA_MODIFIED,\r\n    frameViewSyncCallback\r\n  );\r\n  return synchronizer;\r\n};\r\n\r\nexport { createFrameViewSynchronizer };\r\n","import React from 'react';\r\nimport * as cornerstone from '@cornerstonejs/core';\r\nimport * as cornerstoneTools from '@cornerstonejs/tools';\r\nimport {\r\n  Enums as cs3DEnums,\r\n  imageLoadPoolManager,\r\n  imageRetrievalPoolManager,\r\n} from '@cornerstonejs/core';\r\nimport * as csStreamingImageVolumeLoader from '@cornerstonejs/streaming-image-volume-loader';\r\nimport { Enums as cs3DToolsEnums } from '@cornerstonejs/tools';\r\nimport { Types } from '@ohif/core';\r\n\r\nimport init from './init';\r\nimport getCustomizationModule from './getCustomizationModule';\r\nimport getCommandsModule from './commandsModule';\r\nimport getHangingProtocolModule from './getHangingProtocolModule';\r\nimport getToolbarModule from './getToolbarModule';\r\nimport ToolGroupService from './services/ToolGroupService';\r\nimport SyncGroupService from './services/SyncGroupService';\r\nimport SegmentationService from './services/SegmentationService';\r\nimport CornerstoneCacheService from './services/CornerstoneCacheService';\r\nimport CornerstoneViewportService from './services/ViewportService/CornerstoneViewportService';\r\nimport ColorbarService from './services/ColorbarService';\r\nimport PanoramicService from './services/PanoramicService';\r\nimport * as CornerstoneExtensionTypes from './types';\r\n\r\nimport { toolNames } from './initCornerstoneTools';\r\nimport { getEnabledElement, reset as enabledElementReset, setEnabledElement } from './state';\r\nimport dicomLoaderService from './utils/dicomLoaderService';\r\nimport getActiveViewportEnabledElement from './utils/getActiveViewportEnabledElement';\r\n\r\nimport { id } from './id';\r\nimport { measurementMappingUtils } from './utils/measurementServiceMappings';\r\nimport type { PublicViewportOptions } from './services/ViewportService/Viewport';\r\nimport ImageOverlayViewerTool from './tools/ImageOverlayViewerTool';\r\nimport { showLabelAnnotationPopup } from './utils/callInputDialog';\r\nimport ViewportActionCornersService from './services/ViewportActionCornersService/ViewportActionCornersService';\r\nimport { ViewportActionCornersProvider } from './contextProviders/ViewportActionCornersProvider';\r\nimport ActiveViewportWindowLevel from './components/ActiveViewportWindowLevel';\r\nimport getSOPInstanceAttributes from './utils/measurementServiceMappings/utils/getSOPInstanceAttributes';\r\nimport { findNearbyToolData } from './utils/findNearbyToolData';\r\nimport { createFrameViewSynchronizer } from './synchronizers/frameViewSynchronizer';\r\n\r\nconst { helpers: volumeLoaderHelpers } = csStreamingImageVolumeLoader;\r\nconst { getDynamicVolumeInfo } = volumeLoaderHelpers ?? {};\r\n\r\nconst Component = React.lazy(() => {\r\n  return import(/* webpackPrefetch: true */ './Viewport/OHIFCornerstoneViewport');\r\n});\r\n\r\nconst OHIFCornerstoneViewport = props => {\r\n  return (\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      <Component {...props} />\r\n    </React.Suspense>\r\n  );\r\n};\r\n\r\n/**\r\n *\r\n */\r\nconst cornerstoneExtension: Types.Extensions.Extension = {\r\n  /**\r\n   * Only required property. Should be a unique value across all extensions.\r\n   */\r\n  id,\r\n\r\n  onModeEnter: ({ servicesManager }: withAppTypes): void => {\r\n    const { cornerstoneViewportService, toolbarService, segmentationService } =\r\n      servicesManager.services;\r\n    toolbarService.registerEventForToolbarUpdate(cornerstoneViewportService, [\r\n      cornerstoneViewportService.EVENTS.VIEWPORT_DATA_CHANGED,\r\n    ]);\r\n\r\n    toolbarService.registerEventForToolbarUpdate(segmentationService, [\r\n      segmentationService.EVENTS.SEGMENTATION_ADDED,\r\n      segmentationService.EVENTS.SEGMENTATION_REMOVED,\r\n      segmentationService.EVENTS.SEGMENTATION_UPDATED,\r\n    ]);\r\n\r\n    toolbarService.registerEventForToolbarUpdate(cornerstone.eventTarget, [\r\n      cornerstoneTools.Enums.Events.TOOL_ACTIVATED,\r\n    ]);\r\n  },\r\n\r\n  onModeExit: ({ servicesManager }: withAppTypes): void => {\r\n    const { cineService } = servicesManager.services;\r\n    // Empty out the image load and retrieval pools to prevent memory leaks\r\n    // on the mode exits\r\n    Object.values(cs3DEnums.RequestType).forEach(type => {\r\n      imageLoadPoolManager.clearRequestStack(type);\r\n      imageRetrievalPoolManager.clearRequestStack(type);\r\n    });\r\n\r\n    cineService.setIsCineEnabled(false);\r\n\r\n    enabledElementReset();\r\n  },\r\n\r\n  /**\r\n   * Register the Cornerstone 3D services and set them up for use.\r\n   *\r\n   * @param configuration.csToolsConfig - Passed directly to `initCornerstoneTools`\r\n   */\r\n  preRegistration: function (props: Types.Extensions.ExtensionParams): Promise<void> {\r\n    const { servicesManager, serviceProvidersManager } = props;\r\n    servicesManager.registerService(CornerstoneViewportService.REGISTRATION);\r\n    servicesManager.registerService(ToolGroupService.REGISTRATION);\r\n    servicesManager.registerService(SyncGroupService.REGISTRATION);\r\n    servicesManager.registerService(SegmentationService.REGISTRATION);\r\n    servicesManager.registerService(CornerstoneCacheService.REGISTRATION);\r\n    servicesManager.registerService(ViewportActionCornersService.REGISTRATION);\r\n    servicesManager.registerService(ColorbarService.REGISTRATION);\r\n    servicesManager.registerService(PanoramicService.REGISTRATION);\r\n\r\n    serviceProvidersManager.registerProvider(\r\n      ViewportActionCornersService.REGISTRATION.name,\r\n      ViewportActionCornersProvider\r\n    );\r\n\r\n    const { syncGroupService } = servicesManager.services;\r\n    syncGroupService.registerCustomSynchronizer('frameview', createFrameViewSynchronizer);\r\n    return init.call(this, props);\r\n  },\r\n\r\n  getToolbarModule,\r\n  getPanelModule({ servicesManager }) {\r\n    return [\r\n      {\r\n        name: 'activeViewportWindowLevel',\r\n        component: () => {\r\n          return <ActiveViewportWindowLevel servicesManager={servicesManager} />;\r\n        },\r\n      },\r\n    ];\r\n  },\r\n  getHangingProtocolModule,\r\n  getViewportModule({ servicesManager, commandsManager }) {\r\n    const ExtendedOHIFCornerstoneViewport = props => {\r\n      // const onNewImageHandler = jumpData => {\r\n      //   commandsManager.runCommand('jumpToImage', jumpData);\r\n      // };\r\n      const { toolbarService } = servicesManager.services;\r\n\r\n      return (\r\n        <OHIFCornerstoneViewport\r\n          {...props}\r\n          toolbarService={toolbarService}\r\n          servicesManager={servicesManager}\r\n          commandsManager={commandsManager}\r\n        />\r\n      );\r\n    };\r\n\r\n    return [\r\n      {\r\n        name: 'cornerstone',\r\n        component: ExtendedOHIFCornerstoneViewport,\r\n      },\r\n    ];\r\n  },\r\n  getCommandsModule,\r\n  getCustomizationModule,\r\n  getUtilityModule({ servicesManager }) {\r\n    return [\r\n      {\r\n        name: 'common',\r\n        exports: {\r\n          getCornerstoneLibraries: () => {\r\n            return { cornerstone, cornerstoneTools };\r\n          },\r\n          getEnabledElement,\r\n          dicomLoaderService,\r\n          showLabelAnnotationPopup,\r\n        },\r\n      },\r\n      {\r\n        name: 'core',\r\n        exports: {\r\n          Enums: cs3DEnums,\r\n        },\r\n      },\r\n      {\r\n        name: 'tools',\r\n        exports: {\r\n          toolNames,\r\n          Enums: cs3DToolsEnums,\r\n        },\r\n      },\r\n      {\r\n        name: 'volumeLoader',\r\n        exports: {\r\n          getDynamicVolumeInfo,\r\n        },\r\n      },\r\n    ];\r\n  },\r\n};\r\n\r\nexport type { PublicViewportOptions };\r\nexport {\r\n  measurementMappingUtils,\r\n  CornerstoneExtensionTypes as Types,\r\n  toolNames,\r\n  getActiveViewportEnabledElement,\r\n  setEnabledElement,\r\n  findNearbyToolData,\r\n  getEnabledElement,\r\n  ImageOverlayViewerTool,\r\n  getSOPInstanceAttributes,\r\n};\r\nexport default cornerstoneExtension;\r\n","import { PubSubService } from '@ohif/core';\r\nimport { ViewportActionCornersLocations } from '@ohif/ui';\r\nimport { ReactNode } from 'react';\r\n\r\nexport type ActionComponentInfo = {\r\n  viewportId: string;\r\n  id: string;\r\n  component: ReactNode;\r\n  location: ViewportActionCornersLocations;\r\n  indexPriority: number;\r\n};\r\n\r\nclass ViewportActionCornersService extends PubSubService {\r\n  public static readonly EVENTS = {};\r\n  public static readonly LOCATIONS = ViewportActionCornersLocations;\r\n\r\n  public static REGISTRATION = {\r\n    name: 'viewportActionCornersService',\r\n    altName: 'ViewportActionCornersService',\r\n    create: ({ configuration = {} }) => {\r\n      return new ViewportActionCornersService();\r\n    },\r\n  };\r\n\r\n  serviceImplementation = {};\r\n\r\n  public LOCATIONS = ViewportActionCornersService.LOCATIONS;\r\n\r\n  constructor() {\r\n    super(ViewportActionCornersService.EVENTS);\r\n    this.serviceImplementation = {};\r\n  }\r\n\r\n  public setServiceImplementation({\r\n    getState: getStateImplementation,\r\n    setComponent: setComponentImplementation,\r\n    setComponents: setComponentsImplementation,\r\n    clear: clearImplementation,\r\n  }): void {\r\n    if (getStateImplementation) {\r\n      this.serviceImplementation._getState = getStateImplementation;\r\n    }\r\n    if (setComponentImplementation) {\r\n      this.serviceImplementation._setComponent = setComponentImplementation;\r\n    }\r\n    if (setComponentsImplementation) {\r\n      this.serviceImplementation._setComponents = setComponentsImplementation;\r\n    }\r\n    if (clearImplementation) {\r\n      this.serviceImplementation._clear = clearImplementation;\r\n    }\r\n  }\r\n\r\n  public getState() {\r\n    return this.serviceImplementation._getState();\r\n  }\r\n\r\n  public setComponent(component: ActionComponentInfo) {\r\n    this.serviceImplementation._setComponent(component);\r\n  }\r\n\r\n  public setComponents(components: Array<ActionComponentInfo>) {\r\n    this.serviceImplementation._setComponents(components);\r\n  }\r\n\r\n  public clear(viewportId: string) {\r\n    this.serviceImplementation._clear(viewportId);\r\n  }\r\n}\r\n\r\nexport default ViewportActionCornersService;\r\n","const state = {\r\n  // The `defaultContext` of an extension's commandsModule\r\n  DEFAULT_CONTEXT: 'CORNERSTONE',\r\n  enabledElements: {},\r\n};\r\n\r\n/**\r\n * Sets the enabled element `dom` reference for an active viewport.\r\n * @param {HTMLElement} dom Active viewport element.\r\n * @return void\r\n */\r\nconst setEnabledElement = (viewportId: string, element: HTMLElement, context?: string): void => {\r\n  const targetContext = context || state.DEFAULT_CONTEXT;\r\n\r\n  state.enabledElements[viewportId] = {\r\n    element,\r\n    context: targetContext,\r\n  };\r\n};\r\n\r\n/**\r\n * Grabs the enabled element `dom` reference of an active viewport.\r\n *\r\n * @return {HTMLElement} Active viewport element.\r\n */\r\nconst getEnabledElement = viewportId => {\r\n  return state.enabledElements[viewportId];\r\n};\r\n\r\nconst reset = () => {\r\n  state.enabledElements = {};\r\n};\r\n\r\nexport { setEnabledElement, getEnabledElement, reset };\r\n","import * as cornerstone from '@cornerstonejs/core';\r\n\r\n/**\r\n * It checks if the imageId is provided then it uses it to query\r\n * the metadata and get the SOPInstanceUID, SeriesInstanceUID and StudyInstanceUID.\r\n * If the imageId is not provided then undefined is returned.\r\n * @param {string} imageId The image id of the referenced image\r\n * @returns\r\n */\r\nexport default function getSOPInstanceAttributes(imageId, displaySetService, annotation) {\r\n  if (imageId) {\r\n    return _getUIDFromImageID(imageId);\r\n  }\r\n\r\n  const { metadata } = annotation;\r\n  const { volumeId } = metadata;\r\n\r\n  const displaySet = displaySetService.getDisplaySetsBy(displaySet =>\r\n    volumeId.includes(displaySet.uid)\r\n  )[0];\r\n  const { StudyInstanceUID, SeriesInstanceUID } = displaySet;\r\n\r\n  return {\r\n    SOPInstanceUID: undefined,\r\n    SeriesInstanceUID,\r\n    StudyInstanceUID,\r\n  };\r\n}\r\n\r\nfunction _getUIDFromImageID(imageId) {\r\n  const instance = cornerstone.metaData.get('instance', imageId);\r\n  console.log('get uid from image id', instance)\r\n\r\n  return {\r\n    SOPInstanceUID: instance.SOPInstanceUID,\r\n    SeriesInstanceUID: instance.SeriesInstanceUID,\r\n    StudyInstanceUID: instance.StudyInstanceUID,\r\n    frameNumber: instance.frameNumber || 1,\r\n  };\r\n}\r\n"],"names":["EPSILON","OverlayItemComponents","props","instance","customization","color","attribute","title","label","background","value","contentF","React","className","style","voi","windowWidth","windowCenter","toFixed","scale","undefined","instanceNumber","imageSliceData","imageIndex","numberOfSlices","CornerstoneOverlay","id","topLeftItems","items","customizationType","condition","referenceInstance","StudyDate","formatters","formatDate","SeriesDescription","topRightItems","PatientName","formatPN","PatientSex","bottomLeftItems","toolGroupService","getActiveToolForViewport","viewportId","bottomRightItems","CustomizableViewportOverlay","element","viewportData","servicesManager","cornerstoneViewportService","customizationService","displaySetService","services","setVOI","useState","setScale","cornerstoneOverlay","getCustomization","topLeftCustomization","topRightCustomization","bottomLeftCustomization","bottomRightCustomization","useMemo","getInstanceNumber","displaySetProps","displaySets","data","length","map","datum","getDisplaySetByUID","displaySetInstanceUID","filter","it","getDisplaySets","displaySet","instances","useEffect","updateVOI","eventDetail","range","detail","lower","upper","utilities","addEventListener","Enums","VOI_MODIFIED","removeEventListener","updateScale","previousCamera","camera","parallelScale","viewport","getCornerstoneViewport","getZoom","CAMERA_MODIFIED","_renderOverlayItem","useCallback","item","overlayItemProps","formatDICOMDate","formatTime","formatDICOMTime","formatNumberPrecision","OverlayItemComponent","renderItem","transform","getContent","keyPrefix","index","key","ViewportOverlay","topLeft","topRight","bottomLeft","bottomRight","viewportType","STACK","imageIds","imageId","generalImageModule","metaData","parseInt","_getInstanceNumberFromStack","ORTHOGRAPHIC","volumes","volume","direction","cornerstoneViewport","getCamera","viewPlaneNormal","scanAxisNormal","slice","cross","vec3","_getInstanceNumberFromVolume","Number","isNaN","propTypes","PropTypes","number","precision","parseFloat","date","strFormat","moment","format","time","name","Alphabetic","cleaned","split","s","join","trim","DEFAULT_STATE","default","ViewportActionCornersLocations","ViewportActionCornersContext","createContext","ViewportActionCornersProvider","children","service","viewportActionCornersState","dispatch","useReducer","viewportActionCornersReducer","state","action","type","component","location","indexPriority","payload","locationComponents","deletionIndex","findIndex","insertionIndex","nextState","getState","setComponent","actionComponentInfo","setComponents","actionComponentInfos","forEach","clear","setServiceImplementation","api","contextValue","Provider","ViewportActionCornersService","isRequired","useViewportActionCornersContext","useContext","registerVolumeLoader","volumeLoader","initialized","initWADOImageLoader","userAuthenticationService","appConfig","extensionManager","dicomImageLoader","cornerstone","dicomParser","cornerstoneStreamingImageVolumeLoader","cornerstoneStreamingDynamicImageVolumeLoader","decodeConfig","convertFloatPixelDataToInt","use16BitDataType","Boolean","useNorm16Texture","preferSizeOverAccuracy","beforeSend","xhr","sourceConfig","getActiveDataSource","getConfig","headers","getAuthorizationHeader","xhrRequestHeaders","Accept","utils","generateAcceptHeader","acceptHeader","requestTransferSyntaxUID","omitQuotationForMultipartRequest","Object","assign","errorInterceptor","error","errorHandler","getHTTPErrorHandler","config","maxWebWorkers","Math","min","max","navigator","hardwareConcurrency","maxNumberOfWebWorkers","startWebWorkersOnDemand","taskConfiguration","decodeTask","initializeCodecsOnStartup","usePDFJS","strict","initialize","initWebWorkers","showLabelAnnotationPopup","measurement","uiDialogService","labelConfig","exclusive","dropDownItems","Promise","resolve","reject","create","isDraggable","showOverlay","content","LabellingFlow","defaultPosition","x","window","innerWidth","y","innerHeight","contentProps","labellingDoneCallback","dismiss","measurementData","componentClassName","labelData","callback","isArrowAnnotateInputDialog","dialogConfig","dialogId","text","dialogTitle","inputLabel","validateFunc","onSubmitHandler","centralize","Dialog","noCloseButton","onClose","actions","ButtonEnums","secondary","primary","onSubmit","body","setValue","Input","autoFocus","labelClassName","onChange","event","persist","target","onKeyPress","getActiveViewportEnabledElement","viewportGridService","activeViewportId","OHIFgetEnabledElement","getEnabledElement","calibrateImageSpacing","CalibrationLineTool","LengthTool","constructor","args","_renderingViewport","_lengthToolRenderAnnotation","this","renderAnnotation","enabledElement","svgDrawingHelper","_getTextLines","targetId","canvasPoint1","canvasPoint2","handles","points","p","worldToCanvas","round","point1","point2","dx","dy","sqrt","calculateLength2","toolName","onCompletedCalibrationLine","csToolsEvent","annotationAddedEventDetail","annotation","metadata","annotationData","referencedImageId","pos1","pos2","dz","calculateLength3","callInputDialog","newLength","spacingScale","getRenderingEngine","adjustCalibration","val","v","_cachedOverlayMetadata","Map","OverlayPlaneModuleProvider","add","get","set","query","Array","isArray","ImageOverlayViewerTool","AnnotationDisplayTool","toolProps","defaultToolProps","supportedInteractionTypes","configuration","fillColor","super","onSetToolDisabled","getReferencedImageId","overlayMetadata","overlays","overlay","addOverlayPlaneModule","_getCachedStat","then","cachedStat","_renderOverlay","VolumeViewport","getTargetId","overlayData","_id","columns","width","rows","height","overlayTopLeftWorldPos","overlayTopLeftOnCanvas","overlayBottomRightWorldPos","overlayBottomRightOnCanvas","svgNodeHash","existingImageElement","getSvgNode","attributes","href","dataUrl","console","warn","drawing","setNodeTouched","newImageElement","document","createElementNS","appendNode","pixelData","all","async","idx","Value","retrieveBulkData","InlineBinary","blob","b64toBlob","arrayBuffer","_renderOverlayToDataUrl","guid","_isSameColor","color1","color2","pixelDataRaw","pixelDataView","DataView","totalBits","canvas","createElement","ctx","getContext","clearRect","globalCompositeOperation","imageData","getImageData","i","bitIdx","byteIdx","getUint8","putImageData","toDataURL","toolNames","Pan","PanTool","ArrowAnnotate","ArrowAnnotateTool","WindowLevel","WindowLevelTool","StackScroll","StackScrollTool","StackScrollMouseWheel","StackScrollMouseWheelTool","Zoom","ZoomTool","VolumeRotateMouseWheel","VolumeRotateMouseWheelTool","MipJumpToClick","MIPJumpToClickTool","Length","DragProbe","DragProbeTool","Probe","ProbeTool","RectangleROI","RectangleROITool","RectangleROIThreshold","RectangleROIThresholdTool","RectangleROIStartEndThreshold","RectangleROIStartEndThresholdTool","EllipticalROI","EllipticalROITool","CircleROI","CircleROITool","Bidirectional","BidirectionalTool","Angle","AngleTool","CobbAngle","CobbAngleTool","Magnify","MagnifyTool","Crosshairs","CrosshairsTool","SegmentationDisplay","SegmentationDisplayTool","Brush","BrushTool","PaintFill","PaintFillTool","ReferenceLines","ReferenceLinesTool","CalibrationLine","TrackballRotateTool","CircleScissors","CircleScissorsTool","RectangleScissors","RectangleScissorsTool","SphereScissors","SphereScissorsTool","ImageOverlayViewer","AdvancedMagnify","AdvancedMagnifyTool","UltrasoundDirectional","UltrasoundDirectionalTool","SplineROI","SplineROITool","LivewireContour","LivewireContourTool","PlanarFreehandROI","PlanarFreehandROITool","OrientationMarker","OrientationMarkerTool","WindowLevelRegion","WindowLevelRegionTool","PlanarFreehandContourSegmentation","PlanarFreehandContourSegmentationTool","Undo","UndoTool","toAnnotation","toMeasurement","csToolsEventDetail","getValueTypeFromToolType","annotationUID","FrameOfReferenceUID","SUPPORTED_TOOLS","includes","Error","SOPInstanceUID","SeriesInstanceUID","StudyInstanceUID","getSOPInstanceAttributes","getDisplaySetForSOPInstanceUID","getDisplaySetsForSeries","textBox","mappedAnnotations","cachedStats","keys","annotations","targetStats","frameNumber","SeriesNumber","unit","push","getMappedAnnotations","displayText","images","find","image","InstanceNumber","instanceText","frameText","isMultiFrame","roundedLength","roundNumber","getDisplayText","uid","referenceSeriesUID","referenceStudyUID","getReport","values","_getReport","getHandlesFromPoints","longAxis","shortAxis","start","end","perpendicularStart","perpendicularEnd","reduce","obj","isAnnotationSelected","cs3dToolAnnotationUtils","setAnnotationSelected","selected","getFirstAnnotationSelected","selectedAnnotationUID","referencedSeriesInstanceUID","roundedWidth","getDisplayUnit","getStatisticDisplayString","numbers","results","charAt","toUpperCase","result","mean","stdDev","area","Modality","areaUnit","modalityUnit","roundedArea","mappedAnnotation","str","CornerstoneViewportService","angle","roundedAngle","displayTextArray","stats","from","roundValues","displayName","findUnitForValue","displayTextItems","for","formatDisplayText","contour","polyline","report","getColumnValueReport","DisplaySetService","roundedValue","xValues","yValues","units","isUnitless","isHorizontal","seriesText","dist1","abs","dist2","measurementServiceMappingsFactory","measurementService","_getValueTypeFromToolType","toolType","POLYLINE","ELLIPSE","CIRCLE","RECTANGLE","BIDIRECTIONAL","POINT","ANGLE","MeasurementService","VALUE_TYPES","csToolsAnnotation","matchingCriteria","valueType","removeAnnotation","csToolsEvents","CORNERSTONE_3D_TOOLS_SOURCE_NAME","connectToolsToMeasurementService","csTools3DVer1MeasurementSource","initMeasurementService","createSource","addMapping","connectMeasurementServiceToTools","annotationToMeasurement","remove","addMeasurement","completedEvt","log","finally","removeMeasurement","resize","annotationRemovedEventDetail","getMeasurement","addedEvt","ANNOTATION_ADDED","ANNOTATION_COMPLETED","updatedEvt","ANNOTATION_MODIFIED","removedEvt","ANNOTATION_REMOVED","selectionEvt","ANNOTATION_SELECTION_CHANGE","eventTarget","annotationModifiedEventDetail","annotationSelectionEventDetail","added","addedSelectedAnnotationUIDs","removed","removedSelectedAnnotationUIDs","setMeasurementSelected","measurementSource","MEASUREMENT_REMOVED","MEASUREMENTS_CLEARED","MEASUREMENT_UPDATED","RAW_MEASUREMENT_ADDED","EVENTS","getSource","subscribe","measurements","source","notYetUpdatedAtSource","sourceAnnotation","dataSource","DicomMetadataStore","getInstance","getImageIdsForInstance","addAnnotation","highlighted","isLocked","invalidated","removedMeasurementId","render","_getVolumeFromViewport","getActors","actor","cache","getVolume","_getVolumesFromViewport","isDynamicVolume","cineService","getSyncedViewports","srcViewportId","viewports","viewportsStates","srcViewportState","viewportOptions","srcViewport","srcVolume","volumeId","srcVolumeId","hasVolumeId","_getSyncedViewports","playClip","playClipOptions","stopClip","stopClipOptions","studyPrefetcherService","requestType","Prefetch","imageLoadPoolManager","imageLoader","isImageCached","getImageLoadObject","imageLoadEventsManager","addEventListeners","onImageLoaded","onImageLoadFailed","csEvents","IMAGE_LOADED","IMAGE_LOAD_FAILED","unsubscribe","volumeIdMapsToLoad","viewportIdVolumeInputArrayMap","interleaveCenterLoader","volumeInputArray","displaySetsMatchDetails","viewportMatchDetails","matchDetails","volumeInput","has","uniqueViewportVolumeDisplaySetUIDs","Set","uniqueMatchedDisplaySetUIDs","matchDetail","displaySetsInfo","size","AllRequests","requests","getImageLoadRequests","reOrderedRequests","maxImageIdIndex","middleImageIdIndex","floor","lowerImageIdIndex","upperImageIdIndex","imageIdsToPrefetch","imageIdIndex","prefetchQueuedFilled","currentPositionDownToMinimum","currentPositionUpToMaximum","getInterleavedFrames","request","req","interleavedRequests","compact","flatten","zip","finalRequests","volumeRequests","volumeImageIdRequest","callLoadImage","additionalDetails","options","callLoadImageBound","bind","addRequest","viewportIdVolumeInputArrayMapCopy","interleaveNthLoader","lists","useLists","ret","list","splice","indexOf","timeEnd","interleave","frames","centerStart","centerEnd","getNthFrames","interleaveTopToBottom","filteredMatchDetails","displaySetsToLoad","curMatchDetails","numDisplaySetsToLoad","displaySetOptions","skipLoading","reverse","findNearbyToolData","commandsManager","evt","currentPoints","runCommand","canvasCoordinates","cs3DToolsEvents","DEFAULT_CONTEXT_MENU_CLICKS","button1","commands","commandName","button3","commandOptions","requireNearbyToolData","menuId","cornerstoneViewportHandleClick","button","which","nameArr","altKey","ctrlKey","shiftKey","getEventName","cornerstoneViewportHandleEvent","toRun","nearbyToolData","some","command","run","ELEMENT_ENABLED","getViewportInfo","setEnabledElement","MOUSE_CLICK","ELEMENT_DISABLED","DEFAULT_DOUBLE_CLICK","doubleClick","cornerstoneViewportHandleDoubleClick","eventName","getDoubleClickEventName","customizations","MOUSE_DOUBLE_CLICK","IMAGE_TIMING_KEYS","imageTiming","viewportsWaiting","imageRenderedListener","viewportStatus","TimingEnum","DISPLAY_SETS_TO_FIRST_IMAGE","STUDY_TO_FIRST_IMAGE","SCRIPT_TO_VIEW","IMAGE_RENDERED","DISPLAY_SETS_TO_ALL_IMAGES","colormaps","ColorSpace","Name","NanColor","RGBPoints","description","registerColormap","csUtilities","init","useSharedArrayBuffer","sharedArrayBufferDisabled","csEnums","AUTO","FALSE","TRUE","cs3DInit","rendering","useCPURendering","strictZSpacingForVolumeViewport","maxCacheSize","setMaxCacheSize","isAnnotation","addTool","defaultStyles","getDefaultToolStyles","setDefaultToolStyles","global","textBoxFontSize","lineWidth","initCornerstoneTools","Settings","getRuntimeSettings","useCursors","uiModalService","uiNotificationService","hangingProtocolService","stateSyncService","showWarningMessageForCrossOrigin","crossOriginIsolated","show","message","showCPUFallbackMessage","progress","CPUModal","PROTOCOL_CHANGED","_showCPURenderingModal","register","clearOnModeExit","labelmapRepresentation","cornerstoneTools","Labelmap","contourRepresentation","Contour","fillAlpha","fillAlphaInactive","outlineOpacity","outlineOpacityInactive","renderFill","metadataProvider","OHIF","MetadataProvider","registerImageLoadStrategy","nthLoader","maxNumRequests","interaction","thumbnail","prefetch","measurementServiceSource","initCineService","initStudyPrefetcherService","CUSTOM_IMAGE_LOAD_PERFORMED","volumeInputArrayMap","entry","entries","ohifViewport","lutPresentationStore","positionPresentationStore","presentationIds","getViewportOptions","presentations","positionPresentation","positionPresentationId","lutPresentation","lutPresentationId","setVolumesForViewport","GRID_SIZE_CHANGED","initContextMenu","initDoubleClick","imageLoadFailedHandler","handler","STACK_VIEWPORT_NEW_STACK","enable","IMAGE_LOAD_ERROR","CAMERA_RESET","timingKeys","initViewTiming","addEventListenerDebounced","ERROR_EVENT","PROGRESS","UploadStatus","UploadRejection","status","DicomFileUploader","PubSubService","file","_file","_fileId","_dataSource","_loadPromise","_abortController","AbortController","_status","NotStarted","_percentComplete","fileManager","getFileId","getFileName","getFileSize","cancel","abort","getStatus","getPercentComplete","load","uploadCallbacks","lengthComputable","InProgress","loaded","total","_broadcastEvent","fileId","percentComplete","timeout","_reject","Failed","Cancelled","loadFileRequest","dicomFile","signal","aborted","_checkDicomFile","XMLHttpRequest","_addRequestCallbacks","store","dicom","Success","catch","reason","_isRejected","abortCallback","upload","cleanUpCallback","arr","Uint8Array","every","char","charCodeAt","DicomUploadProgressItem","memo","dicomFileUploader","setPercentComplete","failedReason","setFailedReason","setStatus","isComplete","progressSubscription","dicomFileUploaderProgressEvent","cancelUpload","getStatusIcon","Icon","onClick","ONE_SECOND","ONE_MINUTE","ONE_HOUR","BASE_INTERVAL_TIME","NO_WRAP_ELLIPSIS_CLASS_NAMES","DicomUploadProgress","dicomFileUploaderArr","onComplete","totalUploadSize","acc","fileUploader","currentUploadSizeRef","useRef","uploadRateRef","timeRemaining","setTimeRemaining","numFilesCompleted","setNumFilesCompleted","numFails","setNumFails","showFailedOnly","setShowFailedOnly","progressBarContainerRef","timeoutId","intervalStartUploadSize","intervalStartTime","Date","now","setUploadRateRef","uploadSizeFromStartOfInterval","current","timeSinceStartOfInterval","setTimeout","clearTimeout","currentTimeRemaining","subscriptions","currentFileUploadSize","updateProgress","previousFileUploadSize","uploadSizeRemaining","currentSecondsRemaining","ceil","delta","currentMinutesRemaining","rejection","numCompleted","progressEvent","subscription","cancelAllUploads","getFormattedTimeRemaining","secondsRemaining","minutesRemaining","hoursRemaining","getPercentCompleteRounded","showInfiniteProgressBar","offsetWidth","getNofMFilesStyle","toString","getShowFailedOnlyIconComponent","currentShowFailedOnly","Button","disabled","classNames","ref","ProgressLoadingBar","DicomUpload","onStarted","baseClassNames","setDicomFileUploaderArr","onDrop","acceptedFiles","Dropzone","noClick","getRootProps","_extends","noDrag","getInputProps","webkitdirectory","mozdirectory","CT","level","PT","VIEWPORT_PRESETS","CONSTANTS","tools","active","bindings","mouseButton","Primary","Auxiliary","Secondary","enabled","displayOnePointAsCrosshairs","presets","defaultWindowLevelPresets","colorbarTickPosition","colorbarContainerPosition","colorbarInitialColormap","volumeRenderingPresets","volumeRenderingQualityRange","step","RectangleROi","DEFAULT_SIZE","MAX_TEXTURE_SIZE","VIEWPORT_ID","CornerstoneViewportDownloadForm","activeViewportIdProp","activeViewportElement","activeViewportEnabledElement","renderingEngineId","activeViewport","toolGroup","ToolGroupManager","toolModeAndBindings","toolOptions","tool","mode","setToolMode","ViewportDownloadForm","minimumSize","maximumSize","defaultSize","enableViewport","viewportElement","renderingEngine","viewportInput","defaultOptions","orientation","enableElement","disableViewport","disableElement","updateViewportPreview","downloadViewportElement","internalCanvas","fileType","downloadViewport","updateViewport","downloadCanvas","getOrCreateCanvas","newWidth","offsetHeight","newHeight","multiplier","resetCamera","presentation","getViewPresentation","setView","getViewReference","loadImage","getViewport","StackViewport","getCurrentImageId","properties","getProperties","setStack","setProperties","e","BaseVolumeViewport","addActor","toggleAnnotations","toggle","downloadViewportId","addViewport","getToolInstances","setToolEnabled","setToolDisabled","downloadBlob","filename","divForDownloadViewport","querySelector","html2canvas","link","download","click","getReconstructableStackViewports","displaySetInstanceUIDs","isReconstructable","getSyncId","modality","disableSync","modalityViewports","syncId","syncGroupService","gridViewport","removeViewportFromSyncGroup","toggleSyncFunctions","imageSlice","providedViewports","getSynchronizersForViewport","syncState","syncName","addViewportToSyncGroup","groupViewportsByModality","syncIdToUse","colorbarService","panoramicService","_getActiveViewportEnabledElement","_getActiveViewportToolGroupId","getToolGroupForViewport","showCornerstoneContextMenu","optionsToUse","useSelectedAnnotation","firstAnnotationSelected","allowedSelectedTools","defaultPointsPosition","selectorProps","getNearbyToolData","cstUtils","getNearbyAnnotation","toolInstance","getToolInstance","deleteMeasurement","setMeasurementLabel","update","updateMeasurement","code","textLabel","updatedMeasurement","measurementKey","CodeValue","substring","CodeMeaning","CodingSchemeDesignator","findingSites","setViewportActive","setActiveViewportId","arrowTextCallback","callLabelAutocompleteDialog","toggleCine","isCineEnabled","setIsCineEnabled","_","setCine","isPlaying","setViewportWindowLevel","windowWidthNum","windowCenterNum","csUtils","voiRange","toggleViewportColorbar","hasColorbar","removeColorbar","addColorbar","setWindowLevel","toolGroupId","viewportToolGroupId","getToolGroup","hasTool","toolIsEnabled","getToolOptions","Enabled","toggleEnabledDisabledToolbar","itemId","toggleActiveDisabledToolbar","toolIsActive","Active","Passive","setToolActive","prevToolName","getPrevActivePrimaryToolName","setToolActiveToolbar","toolGroupIds","getToolGroupIds","activeToolName","getActivePrimaryMouseButtonTool","activeToolOptions","getToolConfiguration","disableOnPassive","setToolPassive","showDownloadViewportModal","hide","containerDimensions","rotateViewport","rotation","rotAngle","PI","rotMat","mat4","Float32Array","rotatedViewUp","viewUp","setCamera","getRotation","newRotation","flipViewportHorizontal","flipHorizontal","flipViewportVertical","flipVertical","invertViewport","invert","resetViewport","resetProperties","scaleViewport","scaleFactor","jumpToImage","getImageIds","jumpIndex","scroll","setAllViewportsColorMap","colormap","setViewportColormap","opacity","immediate","actorEntries","hpOpacity","getActiveProtocol","matchingDisplaySet","setViewportProperties","actorEntry","volumeActor","changeActiveViewport","viewportIds","nextViewportIndex","toggleSynchronizer","synchronizer","getSynchronizer","isDisabled","setEnabled","fn","setSourceViewportForReferenceLinesTool","setToolConfiguration","sourceViewportId","storePresentation","updateVolumeData","vtkOpenGLTexture","numSlices","getDimensions","setUpdatedFrame","modified","attachProtocolViewportDataListener","protocol","stageIndex","EVENT","VIEWPORT_DATA_CHANGED","callbacks","onViewportDataInitialized","numPanes","stages","numPanesWithData","setViewportPreset","preset","setVolumeRenderingQulaity","volumeQuality","mapper","getMapper","getInputData","dims","spacing","getSpacing","spatialDiagonal","sampleDistance","a","b","samplesPerRay","setMaximumSamplesPerRay","setSampleDistance","shiftVolumeOpacityPoints","shift","ofun","getProperty","getScalarOpacity","opacityPointValues","getSize","pointIdx","opacityPointValue","getNodeValue","removeAllPoints","addPoint","setVolumeLighting","property","shade","setShade","ambient","setAmbient","diffuse","setDiffuse","specular","setSpecular","resetCrosshairs","crosshairInstances","getCrosshairInstances","ins","mprView","protocolId","panoramicView","isEnabled","activatePanoramic","definitions","commandFn","menuCustomizationId","storeContexts","rotateViewportCW","rotateViewportCCW","incrementActiveViewport","decrementActiveViewport","scaleUpViewport","scaleDownViewport","fitViewportToWindow","nextImage","previousImage","firstImage","lastImage","defaultContext","fourUp","locked","icon","isPreset","createdDate","modifiedDate","availableTo","editableBy","protocolMatchingRules","imageLoadStrategy","displaySetSelectors","mprDisplaySet","seriesMatchingRules","weight","constraint","equals","required","viewportStructure","layoutType","initialImageOptions","syncGroups","syncColormap","customViewportProps","hideOverlays","displayPreset","MR","main3D","layoutOptions","mpr","numberOfPriorsReferenced","activeDisplaySet","mprAnd3DVolumeViewport","only3D","panoramicViewport","hasUpdatedPriorsInformation","panoramicDisplaySet","greaterThan","dentascanDisplaySet","primary3D","primaryAxial","getToggledClassName","isToggled","_evaluateToggle","toolbarService","disabledText","offModes","getToolNameForButton","isOff","VIEWPORT_ADDED","TOOLGROUP_CREATED","TOOL_ACTIVATED","PRIMARY_TOOL_ACTIVATED","ToolGroupService","listeners","_onToolActivated","toolBindingsOptions","isPrimaryTool","binding","callbackProps","pubSubServiceInterface","_init","onModeExit","destroy","toolGroupIdToUse","destroyToolGroup","delete","removeViewportFromToolGroup","deleteToolGroupIfEmpty","removeViewports","getViewportIds","addViewportToToolGroup","createToolGroup","addToolsToToolGroup","configs","_addTools","_setToolsMode","createToolGroupAndAddTools","passive","addTools","parentTool","addToolInstance","_ToolGroupService","REGISTRATION","altName","TOOL_GROUP_CREATED","POSITION","VOI","ZOOMPAN","STACKIMAGE","IMAGE_SLICE","SyncGroupService","synchronizerCreators","synchronizers","synchronizersByType","_createSynchronizer","syncCreator","toLowerCase","getSyncCreatorForType","addSynchronizerType","creator","SynchronizerManager","registerCustomSynchronizer","createFunction","getSynchronizersOfType","_getOrCreateSynchronizer","syncGroup","syncGroupObj","asSyncGroup","setOptions","viewportInfo","addSource","addTarget","getRenderingEngines","re","getViewports","vp","hasSourceViewport","hasTargetViewport","syncGroupId","isImageSliceSyncronizer","unRegisterSpatialRegistration","sourceViewports","getSourceViewports","targetViewports","getTargetViewports","targetViewportId","c","concat","viewportIdPair","getSynchronizerType","syncType","_SyncGroupService","easeInOutBell","baseline","alpha","pow","LABELMAP","csToolsEnums","CONTOUR","SEGMENTATION_UPDATED","SEGMENTATION_DATA_MODIFIED","SEGMENTATION_ADDED","SEGMENTATION_REMOVED","SEGMENTATION_CONFIGURATION_CHANGED","SEGMENT_LOADING_COMPLETE","SEGMENTATION_LOADING_COMPLETE","SEGMENT_CONSTANT","isVisible","SegmentationService","segmentations","highlightIntervalId","SEGMENTATION_MODIFIED","_onSegmentationModifiedFromSource","_onSegmentationDataModified","segmentationId","_removeSegmentationFromCornerstone","setSegmentRGBA","segmentIndex","rgbaColor","segmentation","getSegmentation","suppressEvents","_setSegmentOpacity","_setSegmentColor","calculateCentroids","getLabelmapVolume","dimensions","scalarData","getScalarData","dimX","dimY","numFrames","frameLength","segmentIndices","segments","segment","segmentIndicesSet","centroids","z","count","voxelIndex","frame","centroid","normalizedCentroid","world","indexToWorld","setCentroids","segmentCenter","center","addOrUpdateSegmentation","createSegmentationForDisplaySet","representationType","_getVolumeIdForDisplaySet","targetBuffer","sharedArrayBuffer","SharedArrayBuffer","_getDefaultSegmentationScheme","isActive","representationData","referencedVolumeId","toggleSegmentationVisibility","_toggleSegmentationVisibility","addSegmentationRepresentationToToolGroup","hydrateSegmentation","_getApplicableToolGroupId","hydrated","segmentationRepresentationUIDs","cstSegmentation","_setActiveSegmentationForToolGroup","visibility","_setSegmentVisibility","_setSegmentLocked","setSegmentRGBAColor","getToolGroupIdsWithSegmentation","_setDisplaySetIsHydrated","getConfiguration","segmentationRepresentations","getSegmentationRepresentationsForToolGroup","typeToUse","renderInactiveSegmentations","representation","representations","renderOutline","outlineWidthActive","brushSize","brushThresholdGate","setConfiguration","setConfigValueIfDefined","transformFn","transformedValue","_setSegmentationConfig","_updateCornerstoneSegmentationVisibility","segmentInfo","_getSegmentInfo","segmentationRepresentation","_getSegmentationRepresentation","segmentationRepresentationUID","getSegmentations","renderViewports","segmentationState","activeSegmentIndex","segmentsLocked","segmentationSchema","segmentsHidden","newVisibility","_getSegmentationInfo","getActiveViewportId","getToolGroupId","arrayOfObjects","_initSegmentationService","addSegment","override","segmentCount","_setActiveSegment","newColor","removeSegment","labelmapVolume","modifiedFrames","modifiedFramesArray","newActiveSegmentIndex","setSegmentVisibility","setSegmentLocked","toggleSegmentLocked","setSegmentColor","setSegmentOpacity","setActiveSegmentationForToolGroup","setActiveSegment","filterNonHydratedSegmentations","_getSegmentations","m","getActiveSegmentation","getActiveSegment","activeSegmentation","getAxialSegmentations","displaySetUID","getDisplaySetsUIDsForViewport","getDentascanSegmentations","getActiveDisplaySets","getHiddenSegmentation","axialSegmentations","dentascanSegmentations","axialSegIndex","dentascanSegIndex","cachedSegmentation","_updateCornerstoneSegmentations","createSegmentationForSEGDisplaySet","segDisplaySet","labelmap","labelmapBufferArray","derivedVolume","derivedVolumeScalarData","segmentsInfo","segMetadata","SegmentedPropertyCategoryCodeSequence","SegmentNumber","SegmentLabel","SegmentAlgorithmType","SegmentAlgorithmName","SegmentedPropertyTypeCodeSequence","rgba","centerWorld","modifiedTime","SeriesDate","category","algorithmType","algorithmName","isLoaded","createSegmentationForRTDisplaySet","rtDisplaySet","structureSet","defaultScheme","rtDisplaySetUID","allRTStructData","ROIContours","contourPoints","ROINumber","ROIName","colorArray","rest","geometryId","mapROIContoursToRTStructData","sort","geometryIds","segmentsCachedStats","initializeContour","rtStructData","geometry","geometryLoader","geometryData","frameOfReferenceUID","getCentroid","numInitialized","numSegments","promiseArray","promise","jumpToSegmentCenter","highlightAlpha","highlightSegment","animationLength","highlightHideOthers","highlightFunctionType","_getSegmentCenter","_getToolGroupIdsWithSegmentation","toolGroups","viewportsInfo","getViewportsInfo","getEnabledElementByIds","hideOthers","clearInterval","_highlightLabelmap","_highlightContour","isHydrated","setDisplaySetMetadataInvalidated","newSegmentSpecificConfig","startTime","animation","timestamp","elapsed","requestAnimationFrame","performance","animate","currentTime","reversedProgress","removeSegmentationRepresentationFromToolGroup","segmentationRepresentationUIDsIds","uids","rep","wasActive","colorLUTIndex","updatedToolGroupIds","remainingHydratedSegmentations","remainingSegmentation","setSegmentLabel","_setSegmentLabel","shouldRenderSegmentation","viewportDisplaySetInstanceUIDs","segmentationFrameOfReferenceUID","shouldDisplaySeg","targetSegmentation","volumeLoaderSchema","segmentLabel","sourceSegState","getSegmentationRepresentations","UIDsToRemove","removeSegmentation","getVolumeLoadObject","removeVolumeLoadObject","sourceSegmentation","isEqual","_getFrameOfReferenceUIDForSeg","referencedFrameOfReferenceSequence","ReferencedFrameOfReferenceSequence","_SegmentationService","getCornerstoneViewportType","lowerViewportType","VOLUME_3D","VOLUME_LOADER_SCHEME","CornerstoneCacheService","stackImageIds","volumeImageIds","getCacheSize","cs3DCache","getCacheFreeSpace","getBytesAvailable","createViewportData","initialImageIndex","_shouldRenderSegmentation","cs3DViewportType","_getStackViewportData","_getVolumeViewportData","invalidateViewportData","invalidatedDisplaySetInstanceUID","_getCornerstoneStackImageIds","removeImageLoadObject","_volumeCache","overlayDisplaySets","ds","isOverlayDisplaySet","nonOverlayDisplaySets","overlayDisplaySet","Function","isCompositeStack","volumeData","studyInstanceUID","_getCornerstoneVolumeImageIds","voiLut","layerSize","Rows","Columns","Int16Array","numImageFrames","PixelData","byte","isZeroArray","origin","segmentationService","segDisplaySetInstanceUID","getImageIdsForDisplaySet","_CornerstoneCacheService","RENDERING_ENGINE_ID","DEFAULT_TOOLGROUP_ID","dataContains","dataId","imageURI","hasImageURI","setPublicViewportOptions","setPublicDisplaySetOptions","contains","getEnabledElementByViewportId","setRenderingEngineId","getRenderingEngineId","setViewportId","setElement","setViewportData","getViewportData","getElement","getViewportId","publicDisplaySetOptions","mapDisplaySetOptions","setDisplaySetOptions","hasDisplaySet","dsUID","viewportOptionsEntry","AXIAL","SAGITTAL","CORONAL","ACQUISITION","getCornerstoneOrientation","setViewportOptions","getPresentationIds","getSyncGroups","getDisplaySetOptions","getViewportType","getBackground","getOrientation","getDisplayArea","displayArea","getInitialImageOptions","option","blendMode","slabThickness","voiInverted","COMPOSITE","MAXIMUM_INTENSITY_BLEND","MINIMUM_INTENSITY_BLEND","AVERAGE_INTENSITY_BLEND","getCornerstoneBlendMode","JumpPresets","VIEWPORT_VOLUMES_CHANGED","viewportsById","viewportGridResizeObserver","viewportsDisplaySets","beforeResizePositionPresentations","enableResizeDetector","resizeRefreshRateMs","resizeRefreshMode","resizeQueue","viewportResizeTimer","gridResizeDelay","gridResizeTimeOut","_setActorProperties","bitsAllocated","inputData","vtkVolume","vtkVolumeMapper","setInputData","setMapper","getBounds","setOrigin","getCenter","setOrientation","ctfun","vtkColorTransferFunction","vtkPiecewiseFunction","addRGBPoint","actorProp","setRGBTransferFunction","setScalarOpacity","setScalarOpacityUnitDistance","setInterpolationTypeToLinear","setUseGradientOpacity","setGradientOpacityMinimumValue","setGradientOpacityMinimumOpacity","setGradientOpacityMaximumValue","setGradientOpacityMaximumOpacity","setSpecularPower","_setVolumeActors","volumeEntries","setActors","elementRef","ViewportInfo","hasBeenDestroyed","RenderingEngine","isGridResize","performResize","resetGridResizeTimeout","enqueueViewportResizeRequest","_removeResizeObserver","purgeCache","setPresentations","zoom","pan","setZoom","setPan","getPositionPresentation","csViewport","getCurrentImageIdIndex","getPan","getLutPresentation","cleanProperties","isComputedVOI","VOILUTFunction","getPresentations","synchronizersStore","updateStore","newState","publicViewportOptions","newPresentations","_setDisplaySets","getViewportIdToJump","cameraProps","_setStackViewport","initialImageIndexToUse","_getInitialImageIndexForViewport","_handleOverlays","setDisplayArea","_getInitialImageIndex","lastSliceIndex","csToolsUtils","First","Last","Middle","_setVolumeViewport","displaySetOptionsArray","volumeToLoad","_getSlabThickness","volumesNotLoaded","loadStatus","getShouldPerformCustomImageLoad","runImageLoadStrategy","loading","displaySetUIDs","displaySetModality","volumesProperties","displaySetOption","waitLoading","imageVolume","setVolumes","BitsAllocated","addOverlayRepresentationForDisplaySet","_addSegmentationRepresentationToToolGroupIfNecessary","segFrameOfReferenceUID","_getFrameOfReferenceUID","keepCamera","viewportCamera","displaySetPromise","VolumeViewport3D","_setDisplaySetInURL","params","URLSearchParams","search","newurl","host","pathname","history","pushState","path","_setSeriesUIDInURL","seriesUID","seriesInstanceUID","disconnect","processViewportResizeQueue","isGridResizeInQueue","isImmediate","_CornerstoneViewportService","ChangeTypes","ViewportColorbar","ColorbarService","colorbars","position","thickness","activeColormapName","numContainers","containers","createContainers","colorbarContainer","colorbar","container","ticks","defaultTickStyles","STATE_CHANGED","changeType","Added","colorbarInfo","parentNode","removeChild","Removed","getViewportColorbar","dimension","left","positionStyles","top","appendChild","_ColorbarService","boxSizing","border","cursor","right","bottom","font","maxNumTicks","tickSize","tickWidth","labelMargin","zeros","require","dcmbufferToPng","invertRows","useWindowing","BitsStored","WindowCenter","WindowWidth","pixelArray","Int8Array","res","hasWindowing","windowMin","windowMax","transformPixelValue","rowIndex","j","buffer","ext","pngToCanvas","pngBuf","coloredBuffer","Uint8ClampedArray","imgData","ImageData","polynomialLSF","order","k","lhs","fill","rhs","sum","point","coefficients","matrix","n","maxRow","gaussianElimination","predict","coeff","power","equation","derivative","f","getSlopeVector","slope","vx","vy","vLength","getTangentVector","tangentSlope","getNormalVector","interpolatePoints","v1","v2","t","interpolateThreePoints","vMid","tMin","tMax","getDentascanSection","lsfDentalCurve","dicomData","dentascanThickness","vxNormal","vyNormal","minPoint","maxPoint","dentascanWidth","dentascan","nbLayers","layer","xi","yi","xj","yj","pxi","pxj","pyi","pyj","layerWidth","layerHeight","dicomIdxI","minLayer","tx","dicomIdxJ","ty","dicomIdxK","interval","middlePoint","skmeans","classes","constants","createDataset","datasetOptions","toBlob","fileLoaderService","FileLoaderService","addFile","img","loadFile","dataset","getDataset","wait","addImageIdToUIDs","frameIndex","NumberOfFrames","datasets","cornerstoneCacheService","addInstances","activeDisplaySets","displaySetAdded","getDataSources","getMax","len","Infinity","getDentalCurve","DENTASCAN_THICKNESS","transposedBin","transposeImage","transposedArr","DENTASCAN_THRESHOLD_VALUE","transposedOnlyTeethIndex","l","lsfDentalLiss","minX","maxX","getDentalLiss","c0","c1","sigmoidLeft","exp","sigmoidRight","addControlPointAnnotations","middleLayer","controlPoints","curvePoints","outerPoints","innerPoints","annotationUIDs","arrowAnnotateInstance","pointsSet","pointsInWorld","cp","pointAnnotation","addNewAnnotationWithMode","computeControlPoints","bounds","minY","maxY","NUMBER_BASE_POINTS","TOLERANCE","createControlPoints","volumeSpacing","DENTAL_CURVE_THICKNESS","AIP_THRESHOLD_VALUE","DENTAL_CURVES_STEP","AXIAL_CURVES_STEP","DENTAL_CURVE_AIP_STEP","DENTAL_CURVE_AIP_THICKNESS","maxLayer","findLastIndex","parameters","coronalData","getCoronalDataMax","maxVal","skMeansCoronal","centroidsCoronal","idxs","idxsCoronal","idxsMaxCoronal","minTissueLayer","maxTissueLayer","axialData","getAxialDataMean","nbToothLayers","sumVal","skMeansResult","maxClusterIdx","binarizedArrayDilated","dilate","iterations","getPixel","iteration","neighbors","spatialClusters","spatialClustering","clusters","visited","getNeighbors","neighborIndex","exploreCluster","startIndex","cluster","queue","currentIndex","newCluster","sc1","sc2","biggestSpatialClusterXy","newPanoramicState","getPanoramicState","annotationVisibility","addDisplaySetUID","setPanoramicState","createPanoramic","controlPointsInVolume","_getControlPoints","panoramicState","deleteControlPointAnnotations","removeArrowAnnotation","panoramic","deleteDisplaySet","panoramicViewportData","dentascanViewportData","dentascans","newDentascans","newDentascanWidth","newDentascan","panoramicWidth","dentalCurvesPointsXY","getDentalCurvesPointsXY","nbDentalCurves","nbAxialCurves","dentalCurvesPoints","dentascanCurve","dentascanMinPoint","dentascanMaxPoint","dentascanVxNormal","dentascanVyNormal","idxInf","idxSup","dentalCurve","dentascansForMIP","dentascanMIP","dentascanScalar","xPosInDentascan","xPosInDentascans","xpos","panoramicNormalsIterative","panoramicDepth","valuesAlongNormal","xposk","scalarValue","scalarValueNormalized","factor","absorption","panoramicProcessed","gImage","resultImageData","sigma","gaussianBlur","dist","g0","g1","g2","kernel","normalizeFactor","kernelSize","halfKernelSize","ky","kx","blurPanoramic","image0","gImage0","sharpenedPanoramic","_getImageId","voiLutModule","imagePixelModule","generalSeriesModule","duration","panoramicMetadata","bitsStored","prefilledValues","loadBlobInViewport","dentascanObject","dentascansViewportData","random","nbBlobs","layerData","layerI","layerSopInstanceUID","ImagePositionPatient","loadMultipleBlobsInViewport","waitCondition","PanoramicService","displayed","editing","processing","panoramicStates","dentascanIndex","STATUS_DISPLAYED_CHANGED","STATUS_EDITING_CHANGED","PANORAMIC_STATE_UPDATED","PANORAMIC_CREATED","PANORAMIC_PROCESSING","DENTASCAN_INDEX_UPDATED","panelService","panoramicPanel","addPanel","activate","activatePanel","isDisplayed","handleProtocolEnter","handleProtocolExit","eventPanoramic","handlePanoramicCreation","setDisplayed","isEditing","setEditing","isProcessing","setAnnotationVisibility","visible","cstAnnotation","setDentascanIndex","baseVolumeSeries","getSeries","controlPointsInViewport","getMeasurements","handmade","worldToIndex","p1","p2","eventDentascanIndex","renderPanoramic","ACTIVE_VIEWPORT_ID_CHANGED","VIEWPORTS_READY","handleActiveViewportChange","computePanoramic","addViewportListeners","unsub","activeDisplaySetsUIDs","hiddenSegmentation","dentascanDisplaySetUID","cstEnums","dentascanSegId","segmentConfig","getDentascanPointIndex","dentascanElement","dentascanViewport","dentascanImageData","dentascanK","getAxialPointIndex","getAxialOperationData","brushInstance","axialViewport","axialElement","axialVolumeData","axialImageData","axialCenterCursorInWorld","_hoverData","createHoverData","_calculateCursor","brushCursor","editData","createEditData","preview","strategySpecificConfiguration","eraseFocusIndex","segRepresentation","previewColors","_previewData","_downCallBack","MOUSE_DRAG","_dragCallBack","MOUSE_UP","_endCallBack","volumeWidth","volumeHeight","segmentationIdx","segmentationScalarData","dentascanSegScalarData","px","py","pixelCoordinates","volumeIndex","dentascansIndex","getPassiveSegmentationId","activeSegId","activeSegVolumeId","activeSegmentations","activatePassiveSegmentation","passiveSegId","passiveSegRepresentationUID","currentActivePrimaryToolName","axialOperationData","axialEnabledElement","applyActiveStrategy","percent","refreshPanoramicDisplay","_needsRender","nbExpectedViewports","deletePanoramicAnnotation","generateNewPanoramicAnnotation","displayDentascans","dentascanMeasurements","pm","panoramicViewportId","pointX","pointUp","pointDown","nbDentascanViewports","middleDentascanViewportIndex","cstUtilities","debounceLoading","MOUSE_DOWN","panoramicVpId","panoramicDisplaySetUID","reset","newPanoramicVpId","_PanoramicService","getImageId","imageObj","url","someInvalidStrings","strings","string","getImageInstance","getImageInstanceId","imageInstance","fetchIt","DICOMWeb","fetch","response","cornerstoneRetriever","byteArray","wadorsRetriever","sopInstanceUID","DICOMwebClient","retrieveInstance","getLocalData","studies","nonImageInstance","getNonImageInstance","startsWith","findImageIdOnStudies","study","series","getDataByImageType","getDicomDataMethod","loaderType","loaderRegExp","exec","lastIndex","replace","getImageLoaderType","getData","wadoRoot","getStudyInstanceUID","getSeriesInstanceUID","getSOPInstanceUID","getDataByDatasetType","authorizationHeaders","wadoUri","absoluteUrl","getLoaderIterator","findDicomDataPromise","loaderIterator","loader","packageJson","workerManager","getWebWorkerManager","WorkerOptions","maxWorkerInstances","autoTerminateOnIdle","idleTimeThreshold","workerFn","Worker","URL","Events","ViewportWindowLevel","windowLevels","setWindowLevels","cachedHistograms","setCachedHistograms","getViewportsWithVolumeIds","volumeIds","getVolumeViewports","viewportVolumeIds","getNodeOpacity","nodeIndex","nodeValue","getVolumeOpacity","getActor","isPetVolumeWithDefaultOpacity","volumeOpacity","node1Value","node2Value","expectedOpacity","opacitySize","currentNodeValue","firstNodeValue","firstNodeOpacity","isVolumeWithConstantOpacity","getWindowLevelsData","viewportProperties","viewportVoi","scaling","histogram","registerWorker","prevTimePoint","numTimePoints","timePointIndex","middleTimePoint","executeTask","minimum","maximum","calcHistOptions","numBins","getViewportVolumeHistogram","displaySetVOI","displaySetColormap","vtkColorMaps","getPresetByName","showOpacitySlider","updateViewportHistograms","handleCornerstoneVOIModified","oldWindowLevel","wl","oldVOI","newWindowLevel","windowLevel","debouncedHandleCornerstoneVOIModified","debounce","handleVOIChange","newRange","handleOpacityChange","_volumeIndex","newVolumeHistograms","volumeHistograms","prev","IMAGE_VOLUME_LOADING_COMPLETED","PanelSection","onVOIChange","onOpacityChange","ActiveViewportWindowLevel","viewportGrid","useViewportGrid","frameViewSyncCallback","synchronizerInstance","sourceViewport","targetViewport","sViewport","viewportIndex","targetViewportIndex","getOptions","sourceViewportIndex","tViewport","targetSliceIndex","getSliceIndex","createFrameViewSynchronizer","synchronizerName","helpers","volumeLoaderHelpers","csStreamingImageVolumeLoader","getDynamicVolumeInfo","Component","OHIFCornerstoneViewport","fallback","cornerstoneExtension","onModeEnter","registerEventForToolbarUpdate","cs3DEnums","clearRequestStack","imageRetrievalPoolManager","enabledElementReset","preRegistration","serviceProvidersManager","registerService","registerProvider","call","getToolbarModule","evaluate","isPrimaryActive","activeToolIndex","Disabled","synchronizerType","_enabled","propId","prop","getPanelModule","getHangingProtocolModule","getViewportModule","getCommandsModule","getCustomizationModule","getUtilityModule","exports","getCornerstoneLibraries","dicomLoaderService","cs3DToolsEnums","serviceImplementation","LOCATIONS","getStateImplementation","setComponentImplementation","setComponentsImplementation","clearImplementation","_getState","_setComponent","_setComponents","_clear","components","_ViewportActionCornersService","DEFAULT_CONTEXT","enabledElements","context","targetContext","_getUIDFromImageID","getDisplaySetsBy"],"sourceRoot":""}