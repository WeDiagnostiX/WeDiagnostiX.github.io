{"version":3,"file":"3970.bundle.91ff6e14cf2af75aeeab.js","mappings":"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","sources":["webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/_virtual/_rollupPluginBabelHelpers.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/toArray.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/codeMeaningEquals.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/downloadDICOMData.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/MeasurementReport.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/cornerstone4Tag.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/Length.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/FreehandRoi.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/Bidirectional.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/EllipticalRoi.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/CircleRoi.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/ArrowAnnotate.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/CobbAngle.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/Angle.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/RectangleRoi.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/getDatasetsFromImages.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/Segmentation_3X.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/compareArrays.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/enums/Events.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/checkOrientation.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/helpers/checkIfPerpendicular.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/Segmentation_4X.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/Segmentation.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/ParametricMap.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/MeasurementReport.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone/index.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/cornerstone3DTag.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/CodingScheme.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/ArrowAnnotate.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Bidirectional.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Angle.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/CobbAngle.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/CircleROI.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/isValidCornerstoneTrackingIdentifier.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/EllipticalROI.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RectangleROI.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Length.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/PlanarFreehandROI.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Probe.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/UltrasoundDirectional.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Segmentation/generateSegmentation.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Segmentation/generateLabelMaps2DFrom3D.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/Segmentation/generateToolState.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/ParametricMap/generateToolState.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/utilities/getReferencedFrameOfReferenceSequence.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/utilities/getReferencedSeriesSequence.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/utilities/getStructureSetModule.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/RTSS.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/utilities/getRTROIObservationsSequence.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/utilities/getPatientModule.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/utilities/getRTSeriesModule.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/RTStruct/index.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/Cornerstone3D/index.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/VTKjs/Segmentation.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/index.js","webpack:///../../../node_modules/@cornerstonejs/adapters/dist/esm/adapters/VTKjs/index.js"],"sourcesContent":["function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nfunction _createForOfIteratorHelper(r, e) {\n  var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (!t) {\n    if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n      t && (r = t);\n      var n = 0,\n        F = function () {};\n      return {\n        s: F,\n        n: function () {\n          return n >= r.length ? {\n            done: !0\n          } : {\n            done: !1,\n            value: r[n++]\n          };\n        },\n        e: function (r) {\n          throw r;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var o,\n    a = !0,\n    u = !1;\n  return {\n    s: function () {\n      t = t.call(r);\n    },\n    n: function () {\n      var r = t.next();\n      return a = r.done, r;\n    },\n    e: function (r) {\n      u = !0, o = r;\n    },\n    f: function () {\n      try {\n        a || null == t.return || t.return();\n      } finally {\n        if (u) throw o;\n      }\n    }\n  };\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = !0,\n      o = !1;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) {\n        if (Object(t) !== t) return;\n        f = !1;\n      } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = !0, n = r;\n    } finally {\n      try {\n        if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return _regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function (t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i.return) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (_regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine(u), _regeneratorDefine(u, o, \"Generator\"), _regeneratorDefine(u, n, function () {\n    return this;\n  }), _regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (_regenerator = function () {\n    return {\n      w: i,\n      m: f\n    };\n  })();\n}\nfunction _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  _regeneratorDefine = function (e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, _regeneratorDefine(e, r, n, t);\n}\nfunction _slicedToArray(r, e) {\n  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\n\nexport { _arrayLikeToArray as arrayLikeToArray, _arrayWithHoles as arrayWithHoles, _arrayWithoutHoles as arrayWithoutHoles, _asyncToGenerator as asyncToGenerator, _classCallCheck as classCallCheck, _createClass as createClass, _createForOfIteratorHelper as createForOfIteratorHelper, _defineProperty as defineProperty, _iterableToArray as iterableToArray, _iterableToArrayLimit as iterableToArrayLimit, _nonIterableRest as nonIterableRest, _nonIterableSpread as nonIterableSpread, _objectSpread2 as objectSpread2, _regenerator as regenerator, _regeneratorDefine as regeneratorDefine, _slicedToArray as slicedToArray, _toConsumableArray as toConsumableArray, _toPrimitive as toPrimitive, _toPropertyKey as toPropertyKey, _unsupportedIterableToArray as unsupportedIterableToArray };\n","var toArray = function toArray(x) {\n  return Array.isArray(x) ? x : [x];\n};\n\nexport { toArray };\n","var codeMeaningEquals = function codeMeaningEquals(codeMeaningName) {\n  return function (contentItem) {\n    return contentItem.ConceptNameCodeSequence.CodeMeaning === codeMeaningName;\n  };\n};\n\nexport { codeMeaningEquals };\n","import { data } from 'dcmjs';\nimport { Buffer } from 'buffer';\n\nvar datasetToDict = data.datasetToDict;\nfunction downloadDICOMData(bufferOrDataset, filename) {\n  var blob;\n  if (bufferOrDataset instanceof ArrayBuffer) {\n    blob = new Blob([bufferOrDataset], {\n      type: \"application/dicom\"\n    });\n  } else {\n    if (!bufferOrDataset._meta) {\n      throw new Error(\"Dataset must have a _meta property\");\n    }\n    var buffer = Buffer.from(datasetToDict(bufferOrDataset).write());\n    blob = new Blob([buffer], {\n      type: \"application/dicom\"\n    });\n  }\n  var link = document.createElement(\"a\");\n  link.href = window.URL.createObjectURL(blob);\n  link.download = filename;\n  link.click();\n}\n\nexport { downloadDICOMData };\n","import { createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities, derivations, normalizers, data } from 'dcmjs';\nimport { toArray } from '../helpers/toArray.js';\nimport { codeMeaningEquals } from '../helpers/codeMeaningEquals.js';\nimport '../helpers/downloadDICOMData.js';\n\nvar TID1500 = utilities.TID1500,\n  addAccessors = utilities.addAccessors;\nvar StructuredReport = derivations.StructuredReport;\nvar Normalizer = normalizers.Normalizer;\nvar TID1500MeasurementReport = TID1500.TID1500MeasurementReport,\n  TID1501MeasurementGroup = TID1500.TID1501MeasurementGroup;\nvar DicomMetaDictionary = data.DicomMetaDictionary;\nvar FINDING = {\n  CodingSchemeDesignator: \"DCM\",\n  CodeValue: \"121071\"\n};\nvar FINDING_SITE = {\n  CodingSchemeDesignator: \"SCT\",\n  CodeValue: \"363698007\"\n};\nvar FINDING_SITE_OLD = {\n  CodingSchemeDesignator: \"SRT\",\n  CodeValue: \"G-C0E3\"\n};\nvar codeValueMatch = function codeValueMatch(group, code, oldCode) {\n  var ConceptNameCodeSequence = group.ConceptNameCodeSequence;\n  if (!ConceptNameCodeSequence) {\n    return;\n  }\n  var CodingSchemeDesignator = ConceptNameCodeSequence.CodingSchemeDesignator,\n    CodeValue = ConceptNameCodeSequence.CodeValue;\n  return CodingSchemeDesignator == code.CodingSchemeDesignator && CodeValue == code.CodeValue || oldCode && CodingSchemeDesignator == oldCode.CodingSchemeDesignator && CodeValue == oldCode.CodeValue;\n};\nfunction getTID300ContentItem(tool, toolType, ReferencedSOPSequence, toolClass) {\n  var args = toolClass.getTID300RepresentationArguments(tool);\n  args.ReferencedSOPSequence = ReferencedSOPSequence;\n  var TID300Measurement = new toolClass.TID300Representation(args);\n  return TID300Measurement;\n}\nfunction getMeasurementGroup(toolType, toolData, ReferencedSOPSequence) {\n  var toolTypeData = toolData[toolType];\n  var toolClass = MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[toolType];\n  if (!toolTypeData || !toolTypeData.data || !toolTypeData.data.length || !toolClass) {\n    return;\n  }\n\n  // Loop through the array of tool instances\n  // for this tool\n  var Measurements = toolTypeData.data.map(function (tool) {\n    return getTID300ContentItem(tool, toolType, ReferencedSOPSequence, toolClass);\n  });\n  return new TID1501MeasurementGroup(Measurements);\n}\nvar MeasurementReport = /*#__PURE__*/function () {\n  function MeasurementReport() {\n    _classCallCheck(this, MeasurementReport);\n  }\n  return _createClass(MeasurementReport, null, [{\n    key: \"getSetupMeasurementData\",\n    value: function getSetupMeasurementData(MeasurementGroup) {\n      var ContentSequence = MeasurementGroup.ContentSequence;\n      var contentSequenceArr = toArray(ContentSequence);\n      var findingGroup = contentSequenceArr.find(function (group) {\n        return codeValueMatch(group, FINDING);\n      });\n      var findingSiteGroups = contentSequenceArr.filter(function (group) {\n        return codeValueMatch(group, FINDING_SITE, FINDING_SITE_OLD);\n      }) || [];\n      var NUMGroup = contentSequenceArr.find(function (group) {\n        return group.ValueType === \"NUM\";\n      });\n      var SCOORDGroup = toArray(NUMGroup.ContentSequence).find(function (group) {\n        return group.ValueType === \"SCOORD\";\n      });\n      var ReferencedSOPSequence = SCOORDGroup.ContentSequence.ReferencedSOPSequence;\n      var ReferencedSOPInstanceUID = ReferencedSOPSequence.ReferencedSOPInstanceUID,\n        ReferencedFrameNumber = ReferencedSOPSequence.ReferencedFrameNumber;\n      var defaultState = {\n        sopInstanceUid: ReferencedSOPInstanceUID,\n        frameIndex: ReferencedFrameNumber || 1,\n        complete: true,\n        finding: findingGroup ? addAccessors(findingGroup.ConceptCodeSequence) : undefined,\n        findingSites: findingSiteGroups.map(function (fsg) {\n          return addAccessors(fsg.ConceptCodeSequence);\n        })\n      };\n      if (defaultState.finding) {\n        defaultState.description = defaultState.finding.CodeMeaning;\n      }\n      var findingSite = defaultState.findingSites && defaultState.findingSites[0];\n      if (findingSite) {\n        defaultState.location = findingSite[0] && findingSite[0].CodeMeaning || findingSite.CodeMeaning;\n      }\n      return {\n        defaultState: defaultState,\n        findingGroup: findingGroup,\n        findingSiteGroups: findingSiteGroups,\n        NUMGroup: NUMGroup,\n        SCOORDGroup: SCOORDGroup,\n        ReferencedSOPSequence: ReferencedSOPSequence,\n        ReferencedSOPInstanceUID: ReferencedSOPInstanceUID,\n        ReferencedFrameNumber: ReferencedFrameNumber\n      };\n    }\n  }, {\n    key: \"generateReport\",\n    value: function generateReport(toolState, metadataProvider, options) {\n      // ToolState for array of imageIDs to a Report\n      // Assume Cornerstone metadata provider has access to Study / Series / Sop Instance UID\n\n      var allMeasurementGroups = [];\n      var firstImageId = Object.keys(toolState)[0];\n      if (!firstImageId) {\n        throw new Error(\"No measurements provided.\");\n      }\n\n      /* Patient ID\r\n      Warning - Missing attribute or value that would be needed to build DICOMDIR - Patient ID\r\n      Warning - Missing attribute or value that would be needed to build DICOMDIR - Study Date\r\n      Warning - Missing attribute or value that would be needed to build DICOMDIR - Study Time\r\n      Warning - Missing attribute or value that would be needed to build DICOMDIR - Study ID\r\n       */\n      var generalSeriesModule = metadataProvider.get(\"generalSeriesModule\", firstImageId);\n\n      //const sopCommonModule = metadataProvider.get('sopCommonModule', firstImageId);\n\n      // NOTE: We are getting the Series and Study UIDs from the first imageId of the toolState\n      // which means that if the toolState is for multiple series, the report will have the incorrect\n      // SeriesInstanceUIDs\n      var studyInstanceUID = generalSeriesModule.studyInstanceUID,\n        seriesInstanceUID = generalSeriesModule.seriesInstanceUID;\n\n      // Loop through each image in the toolData\n      Object.keys(toolState).forEach(function (imageId) {\n        var sopCommonModule = metadataProvider.get(\"sopCommonModule\", imageId);\n        var frameNumber = metadataProvider.get(\"frameNumber\", imageId);\n        var toolData = toolState[imageId];\n        var toolTypes = Object.keys(toolData);\n        var ReferencedSOPSequence = {\n          ReferencedSOPClassUID: sopCommonModule.sopClassUID,\n          ReferencedSOPInstanceUID: sopCommonModule.sopInstanceUID\n        };\n        if (Normalizer.isMultiframeSOPClassUID(sopCommonModule.sopClassUID)) {\n          ReferencedSOPSequence.ReferencedFrameNumber = frameNumber;\n        }\n\n        // Loop through each tool type for the image\n        var measurementGroups = [];\n        toolTypes.forEach(function (toolType) {\n          var group = getMeasurementGroup(toolType, toolData, ReferencedSOPSequence);\n          if (group) {\n            measurementGroups.push(group);\n          }\n        });\n        allMeasurementGroups = allMeasurementGroups.concat(measurementGroups);\n      });\n      var _MeasurementReport = new TID1500MeasurementReport({\n        TID1501MeasurementGroups: allMeasurementGroups\n      }, options);\n\n      // TODO: what is the correct metaheader\n      // http://dicom.nema.org/medical/Dicom/current/output/chtml/part10/chapter_7.html\n      // TODO: move meta creation to happen in derivations.js\n      var fileMetaInformationVersionArray = new Uint8Array(2);\n      fileMetaInformationVersionArray[1] = 1;\n      var derivationSourceDataset = {\n        StudyInstanceUID: studyInstanceUID,\n        SeriesInstanceUID: seriesInstanceUID\n        //SOPInstanceUID: sopInstanceUID, // TODO: Necessary?\n        //SOPClassUID: sopClassUID,\n      };\n      var _meta = {\n        FileMetaInformationVersion: {\n          Value: [fileMetaInformationVersionArray.buffer],\n          vr: \"OB\"\n        },\n        //MediaStorageSOPClassUID\n        //MediaStorageSOPInstanceUID: sopCommonModule.sopInstanceUID,\n        TransferSyntaxUID: {\n          Value: [\"1.2.840.10008.1.2.1\"],\n          vr: \"UI\"\n        },\n        ImplementationClassUID: {\n          Value: [DicomMetaDictionary.uid()],\n          // TODO: could be git hash or other valid id\n          vr: \"UI\"\n        },\n        ImplementationVersionName: {\n          Value: [\"dcmjs\"],\n          vr: \"SH\"\n        }\n      };\n      var _vrMap = {\n        PixelData: \"OW\"\n      };\n      derivationSourceDataset._meta = _meta;\n      derivationSourceDataset._vrMap = _vrMap;\n      var report = new StructuredReport([derivationSourceDataset]);\n      var contentItem = _MeasurementReport.contentItem(derivationSourceDataset);\n\n      // Merge the derived dataset with the content from the Measurement Report\n      report.dataset = Object.assign(report.dataset, contentItem);\n      report.dataset._meta = _meta;\n      report.dataset.SpecificCharacterSet = \"ISO_IR 192\";\n      return report;\n    }\n\n    /**\r\n     * Generate Cornerstone tool state from dataset\r\n     * @param {object} dataset dataset\r\n     * @param {object} hooks\r\n     * @param {function} hooks.getToolClass Function to map dataset to a tool class\r\n     * @returns\r\n     */\n  }, {\n    key: \"generateToolState\",\n    value: function generateToolState(dataset) {\n      var hooks = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      // For now, bail out if the dataset is not a TID1500 SR with length measurements\n      if (dataset.ContentTemplateSequence.TemplateIdentifier !== \"1500\") {\n        throw new Error(\"This package can currently only interpret DICOM SR TID 1500\");\n      }\n      var REPORT = \"Imaging Measurements\";\n      var GROUP = \"Measurement Group\";\n      var TRACKING_IDENTIFIER = \"Tracking Identifier\";\n\n      // Identify the Imaging Measurements\n      var imagingMeasurementContent = toArray(dataset.ContentSequence).find(codeMeaningEquals(REPORT));\n\n      // Retrieve the Measurements themselves\n      var measurementGroups = toArray(imagingMeasurementContent.ContentSequence).filter(codeMeaningEquals(GROUP));\n\n      // For each of the supported measurement types, compute the measurement data\n      var measurementData = {};\n      var cornerstoneToolClasses = MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE;\n      var registeredToolClasses = [];\n      Object.keys(cornerstoneToolClasses).forEach(function (key) {\n        registeredToolClasses.push(cornerstoneToolClasses[key]);\n        measurementData[key] = [];\n      });\n      measurementGroups.forEach(function (measurementGroup) {\n        var measurementGroupContentSequence = toArray(measurementGroup.ContentSequence);\n        var TrackingIdentifierGroup = measurementGroupContentSequence.find(function (contentItem) {\n          return contentItem.ConceptNameCodeSequence.CodeMeaning === TRACKING_IDENTIFIER;\n        });\n        var TrackingIdentifierValue = TrackingIdentifierGroup.TextValue;\n        var toolClass = hooks.getToolClass ? hooks.getToolClass(measurementGroup, dataset, registeredToolClasses) : registeredToolClasses.find(function (tc) {\n          return tc.isValidCornerstoneTrackingIdentifier(TrackingIdentifierValue);\n        });\n        if (toolClass) {\n          var measurement = toolClass.getMeasurementData(measurementGroup);\n          console.log(\"=== \".concat(toolClass.toolType, \" ===\"));\n          console.log(measurement);\n          measurementData[toolClass.toolType].push(measurement);\n        }\n      });\n\n      // NOTE: There is no way of knowing the cornerstone imageIds as that could be anything.\n      // That is up to the consumer to derive from the SOPInstanceUIDs.\n      return measurementData;\n    }\n  }, {\n    key: \"registerTool\",\n    value: function registerTool(toolClass) {\n      MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[toolClass.utilityToolType] = toolClass;\n      MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[toolClass.toolType] = toolClass;\n      MeasurementReport.MEASUREMENT_BY_TOOLTYPE[toolClass.toolType] = toolClass.utilityToolType;\n    }\n  }]);\n}();\nMeasurementReport.MEASUREMENT_BY_TOOLTYPE = {};\nMeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE = {};\nMeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE = {};\n\nexport { MeasurementReport as default };\n","var CORNERSTONE_4_TAG = \"cornerstoneTools@^4.0.0\";\n\nexport { CORNERSTONE_4_TAG as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Length = utilities.TID300.Length;\nvar LENGTH = \"Length\";\nvar Length = /*#__PURE__*/function () {\n  function Length() {\n    _classCallCheck(this, Length);\n  }\n  return _createClass(Length, null, [{\n    key: \"getMeasurementData\",\n    value:\n    // TODO: this function is required for all Cornerstone Tool Adapters, since it is called by MeasurementReport.\n    function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup;\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        length: NUMGroup.MeasuredValueSequence.NumericValue,\n        toolType: Length.toolType,\n        handles: {\n          start: {},\n          end: {},\n          textBox: {\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        }\n      });\n      var _SCOORDGroup$GraphicD = _slicedToArray(SCOORDGroup.GraphicData, 4);\n      state.handles.start.x = _SCOORDGroup$GraphicD[0];\n      state.handles.start.y = _SCOORDGroup$GraphicD[1];\n      state.handles.end.x = _SCOORDGroup$GraphicD[2];\n      state.handles.end.y = _SCOORDGroup$GraphicD[3];\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var handles = tool.handles,\n        finding = tool.finding,\n        findingSites = tool.findingSites;\n      var point1 = handles.start;\n      var point2 = handles.end;\n      var distance = tool.length;\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:Length\";\n      return {\n        point1: point1,\n        point2: point2,\n        distance: distance,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nLength.toolType = LENGTH;\nLength.utilityToolType = LENGTH;\nLength.TID300Representation = TID300Length;\nLength.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === LENGTH;\n};\nMeasurementReport.registerTool(Length);\n\nexport { Length as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Polyline = utilities.TID300.Polyline;\nvar FreehandRoi = /*#__PURE__*/function () {\n  function FreehandRoi() {\n    _classCallCheck(this, FreehandRoi);\n  }\n  return _createClass(FreehandRoi, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        NUMGroup = _MeasurementReport$ge.NUMGroup;\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        toolType: FreehandRoi.toolType,\n        handles: {\n          points: [],\n          textBox: {\n            active: false,\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        },\n        cachedStats: {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0\n        },\n        color: undefined,\n        invalidated: true\n      });\n      var GraphicData = SCOORDGroup.GraphicData;\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        state.handles.points.push({\n          x: GraphicData[i],\n          y: GraphicData[i + 1]\n        });\n      }\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var handles = tool.handles,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        _tool$cachedStats = tool.cachedStats,\n        cachedStats = _tool$cachedStats === void 0 ? {} : _tool$cachedStats;\n      var points = handles.points;\n      var _cachedStats$area = cachedStats.area,\n        area = _cachedStats$area === void 0 ? 0 : _cachedStats$area,\n        _cachedStats$perimete = cachedStats.perimeter,\n        perimeter = _cachedStats$perimete === void 0 ? 0 : _cachedStats$perimete;\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:FreehandRoi\";\n      return {\n        points: points,\n        area: area,\n        perimeter: perimeter,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nFreehandRoi.toolType = \"FreehandRoi\";\nFreehandRoi.utilityToolType = \"FreehandRoi\";\nFreehandRoi.TID300Representation = TID300Polyline;\nFreehandRoi.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === FreehandRoi.toolType;\n};\nMeasurementReport.registerTool(FreehandRoi);\n\nexport { FreehandRoi as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\nimport { toArray } from '../helpers/toArray.js';\nimport '../helpers/downloadDICOMData.js';\n\nvar TID300Bidirectional = utilities.TID300.Bidirectional;\nvar BIDIRECTIONAL = \"Bidirectional\";\nvar LONG_AXIS = \"Long Axis\";\nvar SHORT_AXIS = \"Short Axis\";\nvar FINDING = \"121071\";\nvar FINDING_SITE = \"G-C0E3\";\nvar Bidirectional = /*#__PURE__*/function () {\n  function Bidirectional() {\n    _classCallCheck(this, Bidirectional);\n  }\n  return _createClass(Bidirectional, null, [{\n    key: \"getMeasurementData\",\n    value:\n    // TODO: this function is required for all Cornerstone Tool Adapters, since it is called by MeasurementReport.\n    function getMeasurementData(MeasurementGroup) {\n      var ContentSequence = MeasurementGroup.ContentSequence;\n      var findingGroup = toArray(ContentSequence).find(function (group) {\n        return group.ConceptNameCodeSequence.CodeValue === FINDING;\n      });\n      var findingSiteGroups = toArray(ContentSequence).filter(function (group) {\n        return group.ConceptNameCodeSequence.CodeValue === FINDING_SITE;\n      });\n      var longAxisNUMGroup = toArray(ContentSequence).find(function (group) {\n        return group.ConceptNameCodeSequence.CodeMeaning === LONG_AXIS;\n      });\n      var longAxisSCOORDGroup = toArray(longAxisNUMGroup.ContentSequence).find(function (group) {\n        return group.ValueType === \"SCOORD\";\n      });\n      var shortAxisNUMGroup = toArray(ContentSequence).find(function (group) {\n        return group.ConceptNameCodeSequence.CodeMeaning === SHORT_AXIS;\n      });\n      var shortAxisSCOORDGroup = toArray(shortAxisNUMGroup.ContentSequence).find(function (group) {\n        return group.ValueType === \"SCOORD\";\n      });\n      var ReferencedSOPSequence = longAxisSCOORDGroup.ContentSequence.ReferencedSOPSequence;\n      var ReferencedSOPInstanceUID = ReferencedSOPSequence.ReferencedSOPInstanceUID,\n        ReferencedFrameNumber = ReferencedSOPSequence.ReferencedFrameNumber;\n\n      // Long axis\n\n      var longestDiameter = String(longAxisNUMGroup.MeasuredValueSequence.NumericValue);\n      var shortestDiameter = String(shortAxisNUMGroup.MeasuredValueSequence.NumericValue);\n      var bottomRight = {\n        x: Math.max(longAxisSCOORDGroup.GraphicData[0], longAxisSCOORDGroup.GraphicData[2], shortAxisSCOORDGroup.GraphicData[0], shortAxisSCOORDGroup.GraphicData[2]),\n        y: Math.max(longAxisSCOORDGroup.GraphicData[1], longAxisSCOORDGroup.GraphicData[3], shortAxisSCOORDGroup.GraphicData[1], shortAxisSCOORDGroup.GraphicData[3])\n      };\n      var state = {\n        sopInstanceUid: ReferencedSOPInstanceUID,\n        frameIndex: ReferencedFrameNumber || 1,\n        toolType: Bidirectional.toolType,\n        active: false,\n        handles: {\n          start: {\n            x: longAxisSCOORDGroup.GraphicData[0],\n            y: longAxisSCOORDGroup.GraphicData[1],\n            drawnIndependently: false,\n            allowedOutsideImage: false,\n            active: false,\n            highlight: false,\n            index: 0\n          },\n          end: {\n            x: longAxisSCOORDGroup.GraphicData[2],\n            y: longAxisSCOORDGroup.GraphicData[3],\n            drawnIndependently: false,\n            allowedOutsideImage: false,\n            active: false,\n            highlight: false,\n            index: 1\n          },\n          perpendicularStart: {\n            x: shortAxisSCOORDGroup.GraphicData[0],\n            y: shortAxisSCOORDGroup.GraphicData[1],\n            drawnIndependently: false,\n            allowedOutsideImage: false,\n            active: false,\n            highlight: false,\n            index: 2\n          },\n          perpendicularEnd: {\n            x: shortAxisSCOORDGroup.GraphicData[2],\n            y: shortAxisSCOORDGroup.GraphicData[3],\n            drawnIndependently: false,\n            allowedOutsideImage: false,\n            active: false,\n            highlight: false,\n            index: 3\n          },\n          textBox: {\n            highlight: false,\n            hasMoved: true,\n            active: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true,\n            x: bottomRight.x + 10,\n            y: bottomRight.y + 10\n          }\n        },\n        invalidated: false,\n        isCreating: false,\n        longestDiameter: longestDiameter,\n        shortestDiameter: shortestDiameter,\n        toolName: \"Bidirectional\",\n        visible: true,\n        finding: findingGroup ? findingGroup.ConceptCodeSequence : undefined,\n        findingSites: findingSiteGroups.map(function (fsg) {\n          return fsg.ConceptCodeSequence;\n        })\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var _tool$handles = tool.handles,\n        start = _tool$handles.start,\n        end = _tool$handles.end,\n        perpendicularStart = _tool$handles.perpendicularStart,\n        perpendicularEnd = _tool$handles.perpendicularEnd;\n      var shortestDiameter = tool.shortestDiameter,\n        longestDiameter = tool.longestDiameter,\n        finding = tool.finding,\n        findingSites = tool.findingSites;\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:Bidirectional\";\n      return {\n        longAxis: {\n          point1: start,\n          point2: end\n        },\n        shortAxis: {\n          point1: perpendicularStart,\n          point2: perpendicularEnd\n        },\n        longAxisLength: longestDiameter,\n        shortAxisLength: shortestDiameter,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nBidirectional.toolType = BIDIRECTIONAL;\nBidirectional.utilityToolType = BIDIRECTIONAL;\nBidirectional.TID300Representation = TID300Bidirectional;\nBidirectional.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === BIDIRECTIONAL;\n};\nMeasurementReport.registerTool(Bidirectional);\n\nexport { Bidirectional as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Ellipse = utilities.TID300.Ellipse;\nvar ELLIPTICALROI = \"EllipticalRoi\";\nvar EllipticalRoi = /*#__PURE__*/function () {\n  function EllipticalRoi() {\n    _classCallCheck(this, EllipticalRoi);\n  }\n  return _createClass(EllipticalRoi, null, [{\n    key: \"getMeasurementData\",\n    value:\n    // TODO: this function is required for all Cornerstone Tool Adapters, since it is called by MeasurementReport.\n    function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var majorAxis = [{\n        x: GraphicData[0],\n        y: GraphicData[1]\n      }, {\n        x: GraphicData[2],\n        y: GraphicData[3]\n      }];\n      var minorAxis = [{\n        x: GraphicData[4],\n        y: GraphicData[5]\n      }, {\n        x: GraphicData[6],\n        y: GraphicData[7]\n      }];\n\n      // Calculate two opposite corners of box defined by two axes.\n\n      var minorAxisLength = Math.sqrt(Math.pow(minorAxis[0].x - minorAxis[1].x, 2) + Math.pow(minorAxis[0].y - minorAxis[1].y, 2));\n      var minorAxisDirection = {\n        x: (minorAxis[1].x - minorAxis[0].x) / minorAxisLength,\n        y: (minorAxis[1].y - minorAxis[0].y) / minorAxisLength\n      };\n      var halfMinorAxisLength = minorAxisLength / 2;\n\n      // First end point of major axis + half minor axis vector\n      var corner1 = {\n        x: majorAxis[0].x + minorAxisDirection.x * halfMinorAxisLength,\n        y: majorAxis[0].y + minorAxisDirection.y * halfMinorAxisLength\n      };\n\n      // Second end point of major axis - half of minor axis vector\n      var corner2 = {\n        x: majorAxis[1].x - minorAxisDirection.x * halfMinorAxisLength,\n        y: majorAxis[1].y - minorAxisDirection.y * halfMinorAxisLength\n      };\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        toolType: EllipticalRoi.toolType,\n        active: false,\n        cachedStats: {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0\n        },\n        handles: {\n          end: {\n            x: corner1.x,\n            y: corner1.y,\n            highlight: false,\n            active: false\n          },\n          initialRotation: 0,\n          start: {\n            x: corner2.x,\n            y: corner2.y,\n            highlight: false,\n            active: false\n          },\n          textBox: {\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        },\n        invalidated: true,\n        visible: true\n      });\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var _tool$cachedStats = tool.cachedStats,\n        cachedStats = _tool$cachedStats === void 0 ? {} : _tool$cachedStats,\n        handles = tool.handles,\n        finding = tool.finding,\n        findingSites = tool.findingSites;\n      var start = handles.start,\n        end = handles.end;\n      var area = cachedStats.area;\n      var halfXLength = Math.abs(start.x - end.x) / 2;\n      var halfYLength = Math.abs(start.y - end.y) / 2;\n      var points = [];\n      var center = {\n        x: (start.x + end.x) / 2,\n        y: (start.y + end.y) / 2\n      };\n      if (halfXLength > halfYLength) {\n        // X-axis major\n        // Major axis\n        points.push({\n          x: center.x - halfXLength,\n          y: center.y\n        });\n        points.push({\n          x: center.x + halfXLength,\n          y: center.y\n        });\n        // Minor axis\n        points.push({\n          x: center.x,\n          y: center.y - halfYLength\n        });\n        points.push({\n          x: center.x,\n          y: center.y + halfYLength\n        });\n      } else {\n        // Y-axis major\n        // Major axis\n        points.push({\n          x: center.x,\n          y: center.y - halfYLength\n        });\n        points.push({\n          x: center.x,\n          y: center.y + halfYLength\n        });\n        // Minor axis\n        points.push({\n          x: center.x - halfXLength,\n          y: center.y\n        });\n        points.push({\n          x: center.x + halfXLength,\n          y: center.y\n        });\n      }\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:EllipticalRoi\";\n      return {\n        area: area,\n        points: points,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nEllipticalRoi.toolType = ELLIPTICALROI;\nEllipticalRoi.utilityToolType = ELLIPTICALROI;\nEllipticalRoi.TID300Representation = TID300Ellipse;\nEllipticalRoi.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === ELLIPTICALROI;\n};\nMeasurementReport.registerTool(EllipticalRoi);\n\nexport { EllipticalRoi as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Circle = utilities.TID300.Circle;\nvar CIRCLEROI = \"CircleRoi\";\nvar CircleRoi = /*#__PURE__*/function () {\n  function CircleRoi() {\n    _classCallCheck(this, CircleRoi);\n  }\n  return _createClass(CircleRoi, null, [{\n    key: \"getMeasurementData\",\n    value: /** Gets the measurement data for cornerstone, given DICOM SR measurement data. */\n    function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var center = {\n        x: GraphicData[0],\n        y: GraphicData[1]\n      };\n      var end = {\n        x: GraphicData[2],\n        y: GraphicData[3]\n      };\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        toolType: CircleRoi.toolType,\n        active: false,\n        cachedStats: {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0,\n          // Dummy values to be updated by cornerstone\n          radius: 0,\n          perimeter: 0\n        },\n        handles: {\n          end: _objectSpread2(_objectSpread2({}, end), {}, {\n            highlight: false,\n            active: false\n          }),\n          initialRotation: 0,\n          start: _objectSpread2(_objectSpread2({}, center), {}, {\n            highlight: false,\n            active: false\n          }),\n          textBox: {\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        },\n        invalidated: true,\n        visible: true\n      });\n      return state;\n    }\n\n    /**\r\n     * Gets the TID 300 representation of a circle, given the cornerstone representation.\r\n     *\r\n     * @param {Object} tool\r\n     * @returns\r\n     */\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var _tool$cachedStats = tool.cachedStats,\n        cachedStats = _tool$cachedStats === void 0 ? {} : _tool$cachedStats,\n        handles = tool.handles,\n        finding = tool.finding,\n        findingSites = tool.findingSites;\n      var center = handles.start,\n        end = handles.end;\n      var area = cachedStats.area,\n        radius = cachedStats.radius;\n      var perimeter = 2 * Math.PI * radius;\n      var points = [];\n      points.push(center);\n      points.push(end);\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:CircleRoi\";\n      return {\n        area: area,\n        perimeter: perimeter,\n        radius: radius,\n        points: points,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nCircleRoi.toolType = CIRCLEROI;\nCircleRoi.utilityToolType = CIRCLEROI;\nCircleRoi.TID300Representation = TID300Circle;\nCircleRoi.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === CIRCLEROI;\n};\nMeasurementReport.registerTool(CircleRoi);\n\nexport { CircleRoi as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Point = utilities.TID300.Point;\nvar ARROW_ANNOTATE = \"ArrowAnnotate\";\nvar CORNERSTONEFREETEXT = \"CORNERSTONEFREETEXT\";\nvar ArrowAnnotate = /*#__PURE__*/function () {\n  function ArrowAnnotate() {\n    _classCallCheck(this, ArrowAnnotate);\n  }\n  return _createClass(ArrowAnnotate, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        findingGroup = _MeasurementReport$ge.findingGroup;\n      var text = findingGroup.ConceptCodeSequence.CodeMeaning;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        toolType: ArrowAnnotate.toolType,\n        active: false,\n        handles: {\n          start: {\n            x: GraphicData[0],\n            y: GraphicData[1],\n            highlight: true,\n            active: false\n          },\n          // Use a generic offset if the stored data doesn't have the endpoint, otherwise\n          // use the actual endpoint.\n          end: {\n            x: GraphicData.length == 4 ? GraphicData[2] : GraphicData[0] + 20,\n            y: GraphicData.length == 4 ? GraphicData[3] : GraphicData[1] + 20,\n            highlight: true,\n            active: false\n          },\n          textBox: {\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        },\n        invalidated: true,\n        text: text,\n        visible: true\n      });\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var points = [tool.handles.start, tool.handles.end];\n      var finding = tool.finding,\n        findingSites = tool.findingSites;\n      var TID300RepresentationArguments = {\n        points: points,\n        trackingIdentifierTextValue: \"cornerstoneTools@^4.0.0:ArrowAnnotate\",\n        findingSites: findingSites || []\n      };\n\n      // If freetext finding isn't present, add it from the tool text.\n      if (!finding || finding.CodeValue !== CORNERSTONEFREETEXT) {\n        finding = {\n          CodeValue: CORNERSTONEFREETEXT,\n          CodingSchemeDesignator: \"CST4\",\n          CodeMeaning: tool.text\n        };\n      }\n      TID300RepresentationArguments.finding = finding;\n      return TID300RepresentationArguments;\n    }\n  }]);\n}();\nArrowAnnotate.toolType = ARROW_ANNOTATE;\nArrowAnnotate.utilityToolType = ARROW_ANNOTATE;\nArrowAnnotate.TID300Representation = TID300Point;\nArrowAnnotate.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === ARROW_ANNOTATE;\n};\nMeasurementReport.registerTool(ArrowAnnotate);\n\nexport { ArrowAnnotate as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300CobbAngle = utilities.TID300.CobbAngle;\nvar COBB_ANGLE = \"CobbAngle\";\nvar CobbAngle = /*#__PURE__*/function () {\n  function CobbAngle() {\n    _classCallCheck(this, CobbAngle);\n  }\n  return _createClass(CobbAngle, null, [{\n    key: \"getMeasurementData\",\n    value:\n    // TODO: this function is required for all Cornerstone Tool Adapters, since it is called by MeasurementReport.\n    function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup;\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        rAngle: NUMGroup.MeasuredValueSequence.NumericValue,\n        toolType: CobbAngle.toolType,\n        handles: {\n          start: {},\n          end: {},\n          start2: {\n            highlight: true,\n            drawnIndependently: true\n          },\n          end2: {\n            highlight: true,\n            drawnIndependently: true\n          },\n          textBox: {\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        }\n      });\n      var _SCOORDGroup$GraphicD = _slicedToArray(SCOORDGroup.GraphicData, 8);\n      state.handles.start.x = _SCOORDGroup$GraphicD[0];\n      state.handles.start.y = _SCOORDGroup$GraphicD[1];\n      state.handles.end.x = _SCOORDGroup$GraphicD[2];\n      state.handles.end.y = _SCOORDGroup$GraphicD[3];\n      state.handles.start2.x = _SCOORDGroup$GraphicD[4];\n      state.handles.start2.y = _SCOORDGroup$GraphicD[5];\n      state.handles.end2.x = _SCOORDGroup$GraphicD[6];\n      state.handles.end2.y = _SCOORDGroup$GraphicD[7];\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var handles = tool.handles,\n        finding = tool.finding,\n        findingSites = tool.findingSites;\n      var point1 = handles.start;\n      var point2 = handles.end;\n      var point3 = handles.start2;\n      var point4 = handles.end2;\n      var rAngle = tool.rAngle;\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:CobbAngle\";\n      return {\n        point1: point1,\n        point2: point2,\n        point3: point3,\n        point4: point4,\n        rAngle: rAngle,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nCobbAngle.toolType = COBB_ANGLE;\nCobbAngle.utilityToolType = COBB_ANGLE;\nCobbAngle.TID300Representation = TID300CobbAngle;\nCobbAngle.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === COBB_ANGLE;\n};\nMeasurementReport.registerTool(CobbAngle);\n\nexport { CobbAngle as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Angle = utilities.TID300.Angle;\nvar ANGLE = \"Angle\";\nvar Angle = /*#__PURE__*/function () {\n  function Angle() {\n    _classCallCheck(this, Angle);\n  }\n  return _createClass(Angle, null, [{\n    key: \"getMeasurementData\",\n    value:\n    /**\r\n     * Generate TID300 measurement data for a plane angle measurement - use a Angle, but label it as Angle\r\n     */\n    function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup;\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        rAngle: NUMGroup.MeasuredValueSequence.NumericValue,\n        toolType: Angle.toolType,\n        handles: {\n          start: {},\n          middle: {},\n          end: {},\n          textBox: {\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          }\n        }\n      });\n      var _SCOORDGroup$GraphicD = _slicedToArray(SCOORDGroup.GraphicData, 8);\n      state.handles.start.x = _SCOORDGroup$GraphicD[0];\n      state.handles.start.y = _SCOORDGroup$GraphicD[1];\n      state.handles.middle.x = _SCOORDGroup$GraphicD[2];\n      state.handles.middle.y = _SCOORDGroup$GraphicD[3];\n      state.handles.middle.x = _SCOORDGroup$GraphicD[4];\n      state.handles.middle.y = _SCOORDGroup$GraphicD[5];\n      state.handles.end.x = _SCOORDGroup$GraphicD[6];\n      state.handles.end.y = _SCOORDGroup$GraphicD[7];\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var handles = tool.handles,\n        finding = tool.finding,\n        findingSites = tool.findingSites;\n      var point1 = handles.start;\n      var point2 = handles.middle;\n      var point3 = handles.middle;\n      var point4 = handles.end;\n      var rAngle = tool.rAngle;\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:Angle\";\n      return {\n        point1: point1,\n        point2: point2,\n        point3: point3,\n        point4: point4,\n        rAngle: rAngle,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nAngle.toolType = ANGLE;\nAngle.utilityToolType = ANGLE;\nAngle.TID300Representation = TID300Angle;\nAngle.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === ANGLE;\n};\nMeasurementReport.registerTool(Angle);\n\nexport { Angle as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, objectSpread2 as _objectSpread2, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_4_TAG from './cornerstone4Tag.js';\n\nvar TID300Polyline = utilities.TID300.Polyline;\nvar RectangleRoi = /*#__PURE__*/function () {\n  function RectangleRoi() {\n    _classCallCheck(this, RectangleRoi);\n  }\n  return _createClass(RectangleRoi, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup),\n        defaultState = _MeasurementReport$ge.defaultState,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        NUMGroup = _MeasurementReport$ge.NUMGroup;\n      var state = _objectSpread2(_objectSpread2({}, defaultState), {}, {\n        toolType: RectangleRoi.toolType,\n        handles: {\n          start: {},\n          end: {},\n          textBox: {\n            active: false,\n            hasMoved: false,\n            movesIndependently: false,\n            drawnIndependently: true,\n            allowedOutsideImage: true,\n            hasBoundingBox: true\n          },\n          initialRotation: 0\n        },\n        cachedStats: {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0\n        },\n        color: undefined,\n        invalidated: true\n      });\n      var _SCOORDGroup$GraphicD = _slicedToArray(SCOORDGroup.GraphicData, 6);\n      state.handles.start.x = _SCOORDGroup$GraphicD[0];\n      state.handles.start.y = _SCOORDGroup$GraphicD[1];\n      _SCOORDGroup$GraphicD[2];\n      _SCOORDGroup$GraphicD[3];\n      state.handles.end.x = _SCOORDGroup$GraphicD[4];\n      state.handles.end.y = _SCOORDGroup$GraphicD[5];\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool) {\n      var finding = tool.finding,\n        findingSites = tool.findingSites,\n        _tool$cachedStats = tool.cachedStats,\n        cachedStats = _tool$cachedStats === void 0 ? {} : _tool$cachedStats,\n        handles = tool.handles;\n      var start = handles.start,\n        end = handles.end;\n      var points = [start, {\n        x: start.x,\n        y: end.y\n      }, end, {\n        x: end.x,\n        y: start.y\n      }];\n      var area = cachedStats.area,\n        perimeter = cachedStats.perimeter;\n      var trackingIdentifierTextValue = \"cornerstoneTools@^4.0.0:RectangleRoi\";\n      return {\n        points: points,\n        area: area,\n        perimeter: perimeter,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nRectangleRoi.toolType = \"RectangleRoi\";\nRectangleRoi.utilityToolType = \"RectangleRoi\";\nRectangleRoi.TID300Representation = TID300Polyline;\nRectangleRoi.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone4Tag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone4Tag !== CORNERSTONE_4_TAG) {\n    return false;\n  }\n  return toolType === RectangleRoi.toolType;\n};\nMeasurementReport.registerTool(RectangleRoi);\n\nexport { RectangleRoi as default };\n","import { data, normalizers } from 'dcmjs';\n\nvar DicomMessage = data.DicomMessage,\n  DicomMetaDictionary = data.DicomMetaDictionary;\nvar Normalizer = normalizers.Normalizer;\nfunction getDatasetsFromImages(images, isMultiframe, options) {\n  var datasets = [];\n  if (isMultiframe) {\n    var image = images[0];\n    var arrayBuffer = image.data.byteArray.buffer;\n    var dicomData = DicomMessage.readFile(arrayBuffer);\n    var dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n    dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n    datasets.push(dataset);\n  } else {\n    for (var i = 0; i < images.length; i++) {\n      var _image = images[i];\n      var _arrayBuffer = _image.data.byteArray.buffer;\n      var _dicomData = DicomMessage.readFile(_arrayBuffer);\n      var _dataset = DicomMetaDictionary.naturalizeDataset(_dicomData.dict);\n      _dataset._meta = DicomMetaDictionary.namifyDataset(_dicomData.meta);\n      datasets.push(_dataset);\n    }\n  }\n  if (options !== null && options !== void 0 && options.SpecificCharacterSet) {\n    datasets.forEach(function (dataset) {\n      return dataset.SpecificCharacterSet = options.SpecificCharacterSet;\n    });\n  }\n  return Normalizer.normalizeToDataset(datasets);\n}\n\nexport { getDatasetsFromImages as default };\n","import { toConsumableArray as _toConsumableArray } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities, normalizers, derivations, log } from 'dcmjs';\nimport ndarray from 'ndarray';\nimport getDatasetsFromImages from '../helpers/getDatasetsFromImages.js';\n\nvar _utilities$orientatio = utilities.orientation,\n  rotateDirectionCosinesInPlane = _utilities$orientatio.rotateDirectionCosinesInPlane,\n  flipIOP = _utilities$orientatio.flipImageOrientationPatient,\n  flipMatrix2D = _utilities$orientatio.flipMatrix2D,\n  rotateMatrix902D = _utilities$orientatio.rotateMatrix902D;\nvar datasetToBlob = utilities.datasetToBlob,\n  BitArray = utilities.BitArray,\n  DicomMessage = utilities.DicomMessage,\n  DicomMetaDictionary = utilities.DicomMetaDictionary;\nvar Normalizer = normalizers.Normalizer;\nvar SegmentationDerivation = derivations.Segmentation;\nvar Segmentation = {\n  generateSegmentation: generateSegmentation,\n  generateToolState: generateToolState\n};\n\n/**\r\n *\r\n * @typedef {Object} BrushData\r\n * @property {Object} toolState - The cornerstoneTools global toolState.\r\n * @property {Object[]} segments - The cornerstoneTools segment metadata that corresponds to the\r\n *                                 seriesInstanceUid.\r\n */\n\n/**\r\n * generateSegmentation - Generates cornerstoneTools brush data, given a stack of\r\n * imageIds, images and the cornerstoneTools brushData.\r\n *\r\n * @param  {object[]} images    An array of the cornerstone image objects.\r\n * @param  {BrushData} brushData and object containing the brushData.\r\n * @returns {type}           description\r\n */\nfunction generateSegmentation(images, brushData) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n    includeSliceSpacing: true\n  };\n  var toolState = brushData.toolState,\n    segments = brushData.segments;\n\n  // Calculate the dimensions of the data cube.\n  var image0 = images[0];\n  var dims = {\n    x: image0.columns,\n    y: image0.rows,\n    z: images.length\n  };\n  dims.xy = dims.x * dims.y;\n  var numSegments = _getSegCount(seg, segments);\n  if (!numSegments) {\n    throw new Error(\"No segments to export!\");\n  }\n  var isMultiframe = image0.imageId.includes(\"?frame\");\n  var seg = _createSegFromImages(images, isMultiframe, options);\n  var _getNumberOfFramesPer = _getNumberOfFramesPerSegment(toolState, images, segments),\n    referencedFramesPerSegment = _getNumberOfFramesPer.referencedFramesPerSegment,\n    segmentIndicies = _getNumberOfFramesPer.segmentIndicies;\n  var NumberOfFrames = 0;\n  for (var i = 0; i < referencedFramesPerSegment.length; i++) {\n    NumberOfFrames += referencedFramesPerSegment[i].length;\n  }\n  seg.setNumberOfFrames(NumberOfFrames);\n  for (var _i = 0; _i < segmentIndicies.length; _i++) {\n    var segmentIndex = segmentIndicies[_i];\n    var referencedFrameIndicies = referencedFramesPerSegment[_i];\n\n    // Frame numbers start from 1.\n    var referencedFrameNumbers = referencedFrameIndicies.map(function (element) {\n      return element + 1;\n    });\n    var segment = segments[segmentIndex];\n    seg.addSegment(segment, _extractCornerstoneToolsPixelData(segmentIndex, referencedFrameIndicies, toolState, images, dims), referencedFrameNumbers);\n  }\n  seg.bitPackPixelData();\n  var segBlob = datasetToBlob(seg.dataset);\n  return segBlob;\n}\nfunction _extractCornerstoneToolsPixelData(segmentIndex, referencedFrames, toolState, images, dims) {\n  var pixelData = new Uint8Array(dims.xy * referencedFrames.length);\n  var pixelDataIndex = 0;\n  for (var i = 0; i < referencedFrames.length; i++) {\n    var frame = referencedFrames[i];\n    var imageId = images[frame].imageId;\n    var imageIdSpecificToolState = toolState[imageId];\n    var brushPixelData = imageIdSpecificToolState.brush.data[segmentIndex].pixelData;\n    for (var p = 0; p < brushPixelData.length; p++) {\n      pixelData[pixelDataIndex] = brushPixelData[p];\n      pixelDataIndex++;\n    }\n  }\n  return pixelData;\n}\nfunction _getNumberOfFramesPerSegment(toolState, images, segments) {\n  var segmentIndicies = [];\n  var referencedFramesPerSegment = [];\n  for (var i = 0; i < segments.length; i++) {\n    if (segments[i]) {\n      segmentIndicies.push(i);\n      referencedFramesPerSegment.push([]);\n    }\n  }\n  for (var z = 0; z < images.length; z++) {\n    var imageId = images[z].imageId;\n    var imageIdSpecificToolState = toolState[imageId];\n    for (var _i2 = 0; _i2 < segmentIndicies.length; _i2++) {\n      var segIdx = segmentIndicies[_i2];\n      if (imageIdSpecificToolState && imageIdSpecificToolState.brush && imageIdSpecificToolState.brush.data && imageIdSpecificToolState.brush.data[segIdx] && imageIdSpecificToolState.brush.data[segIdx].pixelData) {\n        referencedFramesPerSegment[_i2].push(z);\n      }\n    }\n  }\n  return {\n    referencedFramesPerSegment: referencedFramesPerSegment,\n    segmentIndicies: segmentIndicies\n  };\n}\nfunction _getSegCount(seg, segments) {\n  var numSegments = 0;\n  for (var i = 0; i < segments.length; i++) {\n    if (segments[i]) {\n      numSegments++;\n    }\n  }\n  return numSegments;\n}\n\n/**\r\n * _createSegFromImages - description\r\n *\r\n * @param  {Object[]} images    An array of the cornerstone image objects.\r\n * @param  {Boolean} isMultiframe Whether the images are multiframe.\r\n * @returns {Object}              The Seg derived dataSet.\r\n */\nfunction _createSegFromImages(images, isMultiframe, options) {\n  var multiframe = getDatasetsFromImages(images, isMultiframe);\n  return new SegmentationDerivation([multiframe], options);\n}\n\n/**\r\n * generateToolState - Given a set of cornrstoneTools imageIds and a Segmentation buffer,\r\n * derive cornerstoneTools toolState and brush metadata.\r\n *\r\n * @param  {string[]} imageIds    An array of the imageIds.\r\n * @param  {ArrayBuffer} arrayBuffer The SEG arrayBuffer.\r\n * @param {*} metadataProvider\r\n * @returns {Object}  The toolState and an object from which the\r\n *                    segment metadata can be derived.\r\n */\nfunction generateToolState(imageIds, arrayBuffer, metadataProvider) {\n  var dicomData = DicomMessage.readFile(arrayBuffer);\n  var dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n  dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n  var multiframe = Normalizer.normalizeToDataset([dataset]);\n  var imagePlaneModule = metadataProvider.get(\"imagePlaneModule\", imageIds[0]);\n  if (!imagePlaneModule) {\n    console.warn(\"Insufficient metadata, imagePlaneModule missing.\");\n  }\n  var ImageOrientationPatient = Array.isArray(imagePlaneModule.rowCosines) ? [].concat(_toConsumableArray(imagePlaneModule.rowCosines), _toConsumableArray(imagePlaneModule.columnCosines)) : [imagePlaneModule.rowCosines.x, imagePlaneModule.rowCosines.y, imagePlaneModule.rowCosines.z, imagePlaneModule.columnCosines.x, imagePlaneModule.columnCosines.y, imagePlaneModule.columnCosines.z];\n\n  // Get IOP from ref series, compute supported orientations:\n  var validOrientations = getValidOrientations(ImageOrientationPatient);\n  var SharedFunctionalGroupsSequence = multiframe.SharedFunctionalGroupsSequence;\n  var sharedImageOrientationPatient = SharedFunctionalGroupsSequence.PlaneOrientationSequence ? SharedFunctionalGroupsSequence.PlaneOrientationSequence.ImageOrientationPatient : undefined;\n  var sliceLength = multiframe.Columns * multiframe.Rows;\n  var segMetadata = getSegmentMetadata(multiframe);\n  var pixelData = unpackPixelData(multiframe);\n  var PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence;\n  var toolState = {};\n  var inPlane = true;\n  for (var i = 0; i < PerFrameFunctionalGroupsSequence.length; i++) {\n    var PerFrameFunctionalGroups = PerFrameFunctionalGroupsSequence[i];\n    var ImageOrientationPatientI = sharedImageOrientationPatient || PerFrameFunctionalGroups.PlaneOrientationSequence.ImageOrientationPatient;\n    var pixelDataI2D = ndarray(new Uint8Array(pixelData.buffer, i * sliceLength, sliceLength), [multiframe.Rows, multiframe.Columns]);\n    var alignedPixelDataI = alignPixelDataWithSourceData(pixelDataI2D, ImageOrientationPatientI, validOrientations);\n    if (!alignedPixelDataI) {\n      console.warn(\"This segmentation object is not in-plane with the source data. Bailing out of IO. It'd be better to render this with vtkjs. \");\n      inPlane = false;\n      break;\n    }\n    var segmentIndex = PerFrameFunctionalGroups.SegmentIdentificationSequence.ReferencedSegmentNumber - 1;\n    var SourceImageSequence = void 0;\n    if (SharedFunctionalGroupsSequence.DerivationImageSequence && SharedFunctionalGroupsSequence.DerivationImageSequence.SourceImageSequence) {\n      SourceImageSequence = SharedFunctionalGroupsSequence.DerivationImageSequence.SourceImageSequence[i];\n    } else {\n      SourceImageSequence = PerFrameFunctionalGroups.DerivationImageSequence.SourceImageSequence;\n    }\n    var imageId = getImageIdOfSourceImage(SourceImageSequence, imageIds, metadataProvider);\n    addImageIdSpecificBrushToolState(toolState, imageId, segmentIndex, alignedPixelDataI);\n  }\n  if (!inPlane) {\n    return;\n  }\n  return {\n    toolState: toolState,\n    segMetadata: segMetadata\n  };\n}\n\n/**\r\n * unpackPixelData - Unpacks bitpacked pixelData if the Segmentation is BINARY.\r\n *\r\n * @param  {Object} multiframe The multiframe dataset.\r\n * @return {Uint8Array}      The unpacked pixelData.\r\n */\nfunction unpackPixelData(multiframe) {\n  var segType = multiframe.SegmentationType;\n  if (segType === \"BINARY\") {\n    return BitArray.unpack(multiframe.PixelData);\n  }\n  var pixelData = new Uint8Array(multiframe.PixelData);\n  var max = multiframe.MaximumFractionalValue;\n  var onlyMaxAndZero = pixelData.find(function (element) {\n    return element !== 0 && element !== max;\n  }) === undefined;\n  if (!onlyMaxAndZero) {\n    log.warn(\"This is a fractional segmentation, which is not currently supported.\");\n    return;\n  }\n  log.warn(\"This segmentation object is actually binary... processing as such.\");\n  return pixelData;\n}\n\n/**\r\n * addImageIdSpecificBrushToolState - Adds brush pixel data to cornerstoneTools\r\n * formatted toolState object.\r\n *\r\n * @param  {Object} toolState    The toolState object to modify\r\n * @param  {String} imageId      The imageId of the toolState to add the data.\r\n * @param  {Number} segmentIndex The index of the segment data being added.\r\n * @param  {Ndarray} pixelData2D  The pixelData in Ndarry 2D format.\r\n */\nfunction addImageIdSpecificBrushToolState(toolState, imageId, segmentIndex, pixelData2D) {\n  if (!toolState[imageId]) {\n    toolState[imageId] = {};\n    toolState[imageId].brush = {};\n    toolState[imageId].brush.data = [];\n  } else if (!toolState[imageId].brush) {\n    toolState[imageId].brush = {};\n    toolState[imageId].brush.data = [];\n  } else if (!toolState[imageId].brush.data) {\n    toolState[imageId].brush.data = [];\n  }\n  toolState[imageId].brush.data[segmentIndex] = {};\n  var brushDataI = toolState[imageId].brush.data[segmentIndex];\n  brushDataI.pixelData = new Uint8Array(pixelData2D.data.length);\n  var cToolsPixelData = brushDataI.pixelData;\n  for (var p = 0; p < cToolsPixelData.length; p++) {\n    if (pixelData2D.data[p]) {\n      cToolsPixelData[p] = 1;\n    } else {\n      cToolsPixelData[p] = 0;\n    }\n  }\n}\n\n/**\r\n * getImageIdOfSourceImage - Returns the Cornerstone imageId of the source image.\r\n *\r\n * @param  {Object} SourceImageSequence Sequence describing the source image.\r\n * @param  {String[]} imageIds          A list of imageIds.\r\n * @param  {Object} metadataProvider    A Cornerstone metadataProvider to query\r\n *                                      metadata from imageIds.\r\n * @return {String}                     The corresponding imageId.\r\n */\nfunction getImageIdOfSourceImage(SourceImageSequence, imageIds, metadataProvider) {\n  var ReferencedSOPInstanceUID = SourceImageSequence.ReferencedSOPInstanceUID,\n    ReferencedFrameNumber = SourceImageSequence.ReferencedFrameNumber;\n  return ReferencedFrameNumber ? getImageIdOfReferencedFrame(ReferencedSOPInstanceUID, ReferencedFrameNumber, imageIds, metadataProvider) : getImageIdOfReferencedSingleFramedSOPInstance(ReferencedSOPInstanceUID, imageIds, metadataProvider);\n}\n\n/**\r\n * getImageIdOfReferencedSingleFramedSOPInstance - Returns the imageId\r\n * corresponding to the specified sopInstanceUid for single-frame images.\r\n *\r\n * @param  {String} sopInstanceUid   The sopInstanceUid of the desired image.\r\n * @param  {String[]} imageIds         The list of imageIds.\r\n * @param  {Object} metadataProvider The metadataProvider to obtain sopInstanceUids\r\n *                                 from the cornerstone imageIds.\r\n * @return {String}                  The imageId that corresponds to the sopInstanceUid.\r\n */\nfunction getImageIdOfReferencedSingleFramedSOPInstance(sopInstanceUid, imageIds, metadataProvider) {\n  return imageIds.find(function (imageId) {\n    var sopCommonModule = metadataProvider.get(\"sopCommonModule\", imageId);\n    if (!sopCommonModule) {\n      return;\n    }\n    return sopCommonModule.sopInstanceUID === sopInstanceUid;\n  });\n}\n\n/**\r\n * getImageIdOfReferencedFrame - Returns the imageId corresponding to the\r\n * specified sopInstanceUid and frameNumber for multi-frame images.\r\n *\r\n * @param  {String} sopInstanceUid   The sopInstanceUid of the desired image.\r\n * @param  {Number} frameNumber      The frame number.\r\n * @param  {String} imageIds         The list of imageIds.\r\n * @param  {Object} metadataProvider The metadataProvider to obtain sopInstanceUids\r\n *                                   from the cornerstone imageIds.\r\n * @return {String}                  The imageId that corresponds to the sopInstanceUid.\r\n */\nfunction getImageIdOfReferencedFrame(sopInstanceUid, frameNumber, imageIds, metadataProvider) {\n  var imageId = imageIds.find(function (imageId) {\n    var sopCommonModule = metadataProvider.get(\"sopCommonModule\", imageId);\n    if (!sopCommonModule) {\n      return;\n    }\n    var imageIdFrameNumber = Number(imageId.split(\"frame=\")[1]);\n    return (\n      //frameNumber is zero indexed for cornerstoneDICOMImageLoader image Ids.\n      sopCommonModule.sopInstanceUID === sopInstanceUid && imageIdFrameNumber === frameNumber - 1\n    );\n  });\n  return imageId;\n}\n\n/**\r\n * getValidOrientations - returns an array of valid orientations.\r\n *\r\n * @param  iop - The row (0..2) an column (3..5) direction cosines.\r\n * @return  An array of valid orientations.\r\n */\nfunction getValidOrientations(iop) {\n  var orientations = [];\n\n  // [0,  1,  2]: 0,   0hf,   0vf\n  // [3,  4,  5]: 90,  90hf,  90vf\n  // [6, 7]:      180, 270\n\n  orientations[0] = iop;\n  orientations[1] = flipIOP.h(iop);\n  orientations[2] = flipIOP.v(iop);\n  var iop90 = rotateDirectionCosinesInPlane(iop, Math.PI / 2);\n  orientations[3] = iop90;\n  orientations[4] = flipIOP.h(iop90);\n  orientations[5] = flipIOP.v(iop90);\n  orientations[6] = rotateDirectionCosinesInPlane(iop, Math.PI);\n  orientations[7] = rotateDirectionCosinesInPlane(iop, 1.5 * Math.PI);\n  return orientations;\n}\n\n/**\r\n * alignPixelDataWithSourceData -\r\n *\r\n * @param pixelData2D - The data to align.\r\n * @param iop - The orientation of the image slice.\r\n * @param orientations - An array of valid imageOrientationPatient values.\r\n * @return The aligned pixelData.\r\n */\nfunction alignPixelDataWithSourceData(pixelData2D, iop, orientations) {\n  if (compareIOP(iop, orientations[0])) {\n    //Same orientation.\n    return pixelData2D;\n  } else if (compareIOP(iop, orientations[1])) {\n    //Flipped vertically.\n    return flipMatrix2D.v(pixelData2D);\n  } else if (compareIOP(iop, orientations[2])) {\n    //Flipped horizontally.\n    return flipMatrix2D.h(pixelData2D);\n  } else if (compareIOP(iop, orientations[3])) {\n    //Rotated 90 degrees.\n    return rotateMatrix902D(pixelData2D);\n  } else if (compareIOP(iop, orientations[4])) {\n    //Rotated 90 degrees and fliped horizontally.\n    return flipMatrix2D.h(rotateMatrix902D(pixelData2D));\n  } else if (compareIOP(iop, orientations[5])) {\n    //Rotated 90 degrees and fliped vertically.\n    return flipMatrix2D.v(rotateMatrix902D(pixelData2D));\n  } else if (compareIOP(iop, orientations[6])) {\n    //Rotated 180 degrees. // TODO -> Do this more effeciently, there is a 1:1 mapping like 90 degree rotation.\n    return rotateMatrix902D(rotateMatrix902D(pixelData2D));\n  } else if (compareIOP(iop, orientations[7])) {\n    //Rotated 270 degrees.  // TODO -> Do this more effeciently, there is a 1:1 mapping like 90 degree rotation.\n    return rotateMatrix902D(rotateMatrix902D(rotateMatrix902D(pixelData2D)));\n  }\n}\nvar dx = 1e-5;\n\n/**\r\n * compareIOP - Returns true if iop1 and iop2 are equal\r\n * within a tollerance, dx.\r\n *\r\n * @param  iop1 - An ImageOrientationPatient array.\r\n * @param  iop2 - An ImageOrientationPatient array.\r\n * @return True if iop1 and iop2 are equal.\r\n */\nfunction compareIOP(iop1, iop2) {\n  return Math.abs(iop1[0] - iop2[0]) < dx && Math.abs(iop1[1] - iop2[1]) < dx && Math.abs(iop1[2] - iop2[2]) < dx && Math.abs(iop1[3] - iop2[3]) < dx && Math.abs(iop1[4] - iop2[4]) < dx && Math.abs(iop1[5] - iop2[5]) < dx;\n}\nfunction getSegmentMetadata(multiframe) {\n  var data = [];\n  var segmentSequence = multiframe.SegmentSequence;\n  if (Array.isArray(segmentSequence)) {\n    for (var segIdx = 0; segIdx < segmentSequence.length; segIdx++) {\n      data.push(segmentSequence[segIdx]);\n    }\n  } else {\n    // Only one segment, will be stored as an object.\n    data.push(segmentSequence);\n  }\n  return {\n    seriesInstanceUid: multiframe.ReferencedSeriesSequence.SeriesInstanceUID,\n    data: data\n  };\n}\n\nexport { Segmentation as default };\n","import { utilities } from 'dcmjs';\n\nvar nearlyEqual = utilities.orientation.nearlyEqual;\nfunction compareArrays(array1, array2, tolerance) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n  for (var i = 0; i < array1.length; ++i) {\n    if (!nearlyEqual(array1[i], array2[i], tolerance)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport { compareArrays as default };\n","var Events;\n(function (Events) {\n  Events[\"SEGMENTATION_LOAD_PROGRESS\"] = \"CORNERSTONE_ADAPTER_SEGMENTATION_LOAD_PROGRESS\";\n})(Events || (Events = {}));\nvar Events$1 = Events;\n\nexport { Events$1 as default };\n","import checkIfPerpendicular from './checkIfPerpendicular.js';\nimport compareArrays from './compareArrays.js';\n\nfunction checkOrientation(multiframe, validOrientations, sourceDataDimensions, tolerance) {\n  var SharedFunctionalGroupsSequence = multiframe.SharedFunctionalGroupsSequence,\n    PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence;\n  var sharedImageOrientationPatient = SharedFunctionalGroupsSequence.PlaneOrientationSequence ? SharedFunctionalGroupsSequence.PlaneOrientationSequence.ImageOrientationPatient : undefined;\n  var PerFrameFunctionalGroups = PerFrameFunctionalGroupsSequence[0];\n  var iop = sharedImageOrientationPatient || PerFrameFunctionalGroups.PlaneOrientationSequence.ImageOrientationPatient;\n  var inPlane = validOrientations.some(function (operation) {\n    return compareArrays(iop, operation, tolerance);\n  });\n  if (inPlane) {\n    return \"Planar\";\n  }\n  if (checkIfPerpendicular(iop, validOrientations[0], tolerance) && sourceDataDimensions.includes(multiframe.Rows) && sourceDataDimensions.includes(multiframe.Columns)) {\n    return \"Perpendicular\";\n  }\n  return \"Oblique\";\n}\n\nexport { checkOrientation as default };\n","function checkIfPerpendicular(iop1, iop2, tolerance) {\n  var absDotColumnCosines = Math.abs(iop1[0] * iop2[0] + iop1[1] * iop2[1] + iop1[2] * iop2[2]);\n  var absDotRowCosines = Math.abs(iop1[3] * iop2[3] + iop1[4] * iop2[4] + iop1[5] * iop2[5]);\n  return (absDotColumnCosines < tolerance || Math.abs(absDotColumnCosines - 1) < tolerance) && (absDotRowCosines < tolerance || Math.abs(absDotRowCosines - 1) < tolerance);\n}\n\nexport { checkIfPerpendicular as default };\n","import { asyncToGenerator as _asyncToGenerator, regenerator as _regenerator, toConsumableArray as _toConsumableArray, createForOfIteratorHelper as _createForOfIteratorHelper, slicedToArray as _slicedToArray } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities, data, normalizers, derivations, log } from 'dcmjs';\nimport ndarray from 'ndarray';\nimport getDatasetsFromImages from '../helpers/getDatasetsFromImages.js';\nimport checkOrientation from '../helpers/checkOrientation.js';\nimport compareArrays from '../helpers/compareArrays.js';\nimport Events from '../enums/Events.js';\n\nvar _utilities$orientatio = utilities.orientation,\n  rotateDirectionCosinesInPlane = _utilities$orientatio.rotateDirectionCosinesInPlane,\n  flipIOP = _utilities$orientatio.flipImageOrientationPatient,\n  flipMatrix2D = _utilities$orientatio.flipMatrix2D,\n  rotateMatrix902D = _utilities$orientatio.rotateMatrix902D;\nvar BitArray = data.BitArray,\n  DicomMessage = data.DicomMessage,\n  DicomMetaDictionary = data.DicomMetaDictionary;\nvar Normalizer = normalizers.Normalizer;\nvar SegmentationDerivation = derivations.Segmentation;\nvar _utilities$compressio = utilities.compression,\n  encode = _utilities$compressio.encode,\n  decode = _utilities$compressio.decode;\n\n/**\r\n *\r\n * @typedef {Object} BrushData\r\n * @property {Object} toolState - The cornerstoneTools global toolState.\r\n * @property {Object[]} segments - The cornerstoneTools segment metadata that corresponds to the\r\n *                                 seriesInstanceUid.\r\n */\nvar generateSegmentationDefaultOptions = {\n  includeSliceSpacing: true,\n  rleEncode: false\n};\n\n/**\r\n * generateSegmentation - Generates cornerstoneTools brush data, given a stack of\r\n * imageIds, images and the cornerstoneTools brushData.\r\n *\r\n * @param  {object[]} images An array of cornerstone images that contain the source\r\n *                           data under `image.data.byteArray.buffer`.\r\n * @param  {Object|Object[]} inputLabelmaps3D The cornerstone `Labelmap3D` object, or an array of objects.\r\n * @param  {Object} userOptions Options to pass to the segmentation derivation and `fillSegmentation`.\r\n * @returns {Blob}\r\n */\nfunction generateSegmentation(images, inputLabelmaps3D) {\n  var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var isMultiframe = images[0].imageId.includes(\"?frame\");\n  var segmentation = _createSegFromImages(images, isMultiframe, userOptions);\n  return fillSegmentation(segmentation, inputLabelmaps3D, userOptions);\n}\n\n/**\r\n * Fills a given segmentation object with data from the input labelmaps3D\r\n *\r\n * @param segmentation - The segmentation object to be filled.\r\n * @param inputLabelmaps3D - An array of 3D labelmaps, or a single 3D labelmap.\r\n * @param userOptions - Optional configuration settings. Will override the default options.\r\n *\r\n * @returns {object} The filled segmentation object.\r\n */\nfunction fillSegmentation(segmentation, inputLabelmaps3D) {\n  var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var options = Object.assign({}, generateSegmentationDefaultOptions, userOptions);\n\n  // Use another variable so we don't redefine labelmaps3D.\n  var labelmaps3D = Array.isArray(inputLabelmaps3D) ? inputLabelmaps3D : [inputLabelmaps3D];\n  var numberOfFrames = 0;\n  var referencedFramesPerLabelmap = [];\n  var _loop = function _loop() {\n    var labelmap3D = labelmaps3D[labelmapIndex];\n    var labelmaps2D = labelmap3D.labelmaps2D,\n      metadata = labelmap3D.metadata;\n    var referencedFramesPerSegment = [];\n    for (var i = 1; i < metadata.length; i++) {\n      if (metadata[i]) {\n        referencedFramesPerSegment[i] = [];\n      }\n    }\n    var _loop2 = function _loop2(_i) {\n      var labelmap2D = labelmaps2D[_i];\n      if (labelmaps2D[_i]) {\n        var segmentsOnLabelmap = labelmap2D.segmentsOnLabelmap;\n        segmentsOnLabelmap.forEach(function (segmentIndex) {\n          if (segmentIndex !== 0) {\n            referencedFramesPerSegment[segmentIndex].push(_i);\n            numberOfFrames++;\n          }\n        });\n      }\n    };\n    for (var _i = 0; _i < labelmaps2D.length; _i++) {\n      _loop2(_i);\n    }\n    referencedFramesPerLabelmap[labelmapIndex] = referencedFramesPerSegment;\n  };\n  for (var labelmapIndex = 0; labelmapIndex < labelmaps3D.length; labelmapIndex++) {\n    _loop();\n  }\n  segmentation.setNumberOfFrames(numberOfFrames);\n  for (var _labelmapIndex = 0; _labelmapIndex < labelmaps3D.length; _labelmapIndex++) {\n    var referencedFramesPerSegment = referencedFramesPerLabelmap[_labelmapIndex];\n    var labelmap3D = labelmaps3D[_labelmapIndex];\n    var metadata = labelmap3D.metadata;\n    for (var segmentIndex = 1; segmentIndex < referencedFramesPerSegment.length; segmentIndex++) {\n      var referencedFrameIndicies = referencedFramesPerSegment[segmentIndex];\n      if (referencedFrameIndicies) {\n        // Frame numbers start from 1.\n        var referencedFrameNumbers = referencedFrameIndicies.map(function (element) {\n          return element + 1;\n        });\n        var segmentMetadata = metadata[segmentIndex];\n        var labelmaps = _getLabelmapsFromReferencedFrameIndicies(labelmap3D, referencedFrameIndicies);\n        segmentation.addSegmentFromLabelmap(segmentMetadata, labelmaps, segmentIndex, referencedFrameNumbers);\n      }\n    }\n  }\n  if (options.rleEncode) {\n    var rleEncodedFrames = encode(segmentation.dataset.PixelData, numberOfFrames, segmentation.dataset.Rows, segmentation.dataset.Columns);\n\n    // Must use fractional now to RLE encode, as the DICOM standard only allows BitStored && BitsAllocated\n    // to be 1 for BINARY. This is not ideal and there should be a better format for compression in this manner\n    // added to the standard.\n    segmentation.assignToDataset({\n      BitsAllocated: \"8\",\n      BitsStored: \"8\",\n      HighBit: \"7\",\n      SegmentationType: \"FRACTIONAL\",\n      SegmentationFractionalType: \"PROBABILITY\",\n      MaximumFractionalValue: \"255\"\n    });\n    segmentation.dataset._meta.TransferSyntaxUID = {\n      Value: [\"1.2.840.10008.1.2.5\"],\n      vr: \"UI\"\n    };\n    segmentation.dataset.SpecificCharacterSet = \"ISO_IR 192\";\n    segmentation.dataset._vrMap.PixelData = \"OB\";\n    segmentation.dataset.PixelData = rleEncodedFrames;\n  } else {\n    // If no rleEncoding, at least bitpack the data.\n    segmentation.bitPackPixelData();\n  }\n  return segmentation;\n}\nfunction _getLabelmapsFromReferencedFrameIndicies(labelmap3D, referencedFrameIndicies) {\n  var labelmaps2D = labelmap3D.labelmaps2D;\n  var labelmaps = [];\n  for (var i = 0; i < referencedFrameIndicies.length; i++) {\n    var frame = referencedFrameIndicies[i];\n    labelmaps.push(labelmaps2D[frame].pixelData);\n  }\n  return labelmaps;\n}\n\n/**\r\n * _createSegFromImages - description\r\n *\r\n * @param  {Object[]} images    An array of the cornerstone image objects.\r\n * @param  {Boolean} isMultiframe Whether the images are multiframe.\r\n * @returns {Object}              The Seg derived dataSet.\r\n */\nfunction _createSegFromImages(images, isMultiframe, options) {\n  var multiframe = getDatasetsFromImages(images, isMultiframe);\n  return new SegmentationDerivation([multiframe], options);\n}\n\n/**\r\n * generateToolState - Given a set of cornerstoneTools imageIds and a Segmentation buffer,\r\n * derive cornerstoneTools toolState and brush metadata.\r\n *\r\n * @param  {string[]} imageIds - An array of the imageIds.\r\n * @param  {ArrayBuffer} arrayBuffer - The SEG arrayBuffer.\r\n * @param  {*} metadataProvider.\r\n * @param  {obj} options - Options object.\r\n *\r\n * @return {[]ArrayBuffer}a list of array buffer for each labelMap\r\n * @return {Object} an object from which the segment metadata can be derived\r\n * @return {[][][]} 2D list containing the track of segments per frame\r\n * @return {[][][]} 3D list containing the track of segments per frame for each labelMap\r\n *                  (available only for the overlapping case).\r\n */\nfunction generateToolState(_x, _x2, _x3, _x4) {\n  return _generateToolState.apply(this, arguments);\n} // function insertPixelDataPerpendicular(\n//     segmentsOnFrame,\n//     labelmapBuffer,\n//     pixelData,\n//     multiframe,\n//     imageIds,\n//     validOrientations,\n//     metadataProvider\n// ) {\n//     const {\n//         SharedFunctionalGroupsSequence,\n//         PerFrameFunctionalGroupsSequence,\n//         Rows,\n//         Columns\n//     } = multiframe;\n//     const firstImagePlaneModule = metadataProvider.get(\n//         \"imagePlaneModule\",\n//         imageIds[0]\n//     );\n//     const lastImagePlaneModule = metadataProvider.get(\n//         \"imagePlaneModule\",\n//         imageIds[imageIds.length - 1]\n//     );\n//     console.log(firstImagePlaneModule);\n//     console.log(lastImagePlaneModule);\n//     const corners = [\n//         ...getCorners(firstImagePlaneModule),\n//         ...getCorners(lastImagePlaneModule)\n//     ];\n//     console.log(`corners:`);\n//     console.log(corners);\n//     const indexToWorld = mat4.create();\n//     const ippFirstFrame = firstImagePlaneModule.imagePositionPatient;\n//     const rowCosines = Array.isArray(firstImagePlaneModule.rowCosines)\n//         ? [...firstImagePlaneModule.rowCosines]\n//         : [\n//               firstImagePlaneModule.rowCosines.x,\n//               firstImagePlaneModule.rowCosines.y,\n//               firstImagePlaneModule.rowCosines.z\n//           ];\n//     const columnCosines = Array.isArray(firstImagePlaneModule.columnCosines)\n//         ? [...firstImagePlaneModule.columnCosines]\n//         : [\n//               firstImagePlaneModule.columnCosines.x,\n//               firstImagePlaneModule.columnCosines.y,\n//               firstImagePlaneModule.columnCosines.z\n//           ];\n//     const { pixelSpacing } = firstImagePlaneModule;\n//     mat4.set(\n//         indexToWorld,\n//         // Column 1\n//         0,\n//         0,\n//         0,\n//         ippFirstFrame[0],\n//         // Column 2\n//         0,\n//         0,\n//         0,\n//         ippFirstFrame[1],\n//         // Column 3\n//         0,\n//         0,\n//         0,\n//         ippFirstFrame[2],\n//         // Column 4\n//         0,\n//         0,\n//         0,\n//         1\n//     );\n//     // TODO -> Get origin and (x,y,z) increments to build a translation matrix:\n//     // TODO -> Equation C.7.6.2.1-1\n//     // | cx*di rx* Xx 0 |  |x|\n//     // | cy*di ry Xy 0 |  |y|\n//     // | cz*di rz Xz 0 |  |z|\n//     // | tx ty tz 1 |  |1|\n//     // const [\n//     //     0, 0 , 0 , 0,\n//     //     0, 0 , 0 , 0,\n//     //     0, 0 , 0 , 0,\n//     //     ipp[0], ipp[1] , ipp[2] , 1,\n//     // ]\n//     // Each frame:\n//     // Find which corner the first voxel lines up with (one of 8 corners.)\n//     // Find how i,j,k orient with respect to source volume.\n//     // Go through each frame, find location in source to start, and whether to increment +/ix,+/-y,+/-z\n//     //   through each voxel.\n//     // [1,0,0,0,1,0]\n//     // const [\n//     // ]\n//     // Invert transformation matrix to get worldToIndex\n//     // Apply world to index on each point to fill up the matrix.\n//     // const sharedImageOrientationPatient = SharedFunctionalGroupsSequence.PlaneOrientationSequence\n//     //     ? SharedFunctionalGroupsSequence.PlaneOrientationSequence\n//     //           .ImageOrientationPatient\n//     //     : undefined;\n//     // const sliceLength = Columns * Rows;\n// }\n// function getCorners(imagePlaneModule) {\n//     // console.log(imagePlaneModule);\n//     const {\n//         rows,\n//         columns,\n//         rowCosines,\n//         columnCosines,\n//         imagePositionPatient: ipp,\n//         rowPixelSpacing,\n//         columnPixelSpacing\n//     } = imagePlaneModule;\n//     const rowLength = columns * columnPixelSpacing;\n//     const columnLength = rows * rowPixelSpacing;\n//     const entireRowVector = [\n//         rowLength * columnCosines[0],\n//         rowLength * columnCosines[1],\n//         rowLength * columnCosines[2]\n//     ];\n//     const entireColumnVector = [\n//         columnLength * rowCosines[0],\n//         columnLength * rowCosines[1],\n//         columnLength * rowCosines[2]\n//     ];\n//     const topLeft = [ipp[0], ipp[1], ipp[2]];\n//     const topRight = [\n//         topLeft[0] + entireRowVector[0],\n//         topLeft[1] + entireRowVector[1],\n//         topLeft[2] + entireRowVector[2]\n//     ];\n//     const bottomLeft = [\n//         topLeft[0] + entireColumnVector[0],\n//         topLeft[1] + entireColumnVector[1],\n//         topLeft[2] + entireColumnVector[2]\n//     ];\n//     const bottomRight = [\n//         bottomLeft[0] + entireRowVector[0],\n//         bottomLeft[1] + entireRowVector[1],\n//         bottomLeft[2] + entireRowVector[2]\n//     ];\n//     return [topLeft, topRight, bottomLeft, bottomRight];\n// }\n/**\r\n * Find the reference frame of the segmentation frame in the source data.\r\n *\r\n * @param  {Object}      multiframe        dicom metadata\r\n * @param  {Int}         frameSegment      frame dicom index\r\n * @param  {String[]}    imageIds          A list of imageIds.\r\n * @param  {Object}      sopUIDImageIdIndexMap  A map of SOPInstanceUID to imageId\r\n * @param  {Float}       tolerance         The tolerance parameter\r\n *\r\n * @returns {String}     Returns the imageId\r\n */\nfunction _generateToolState() {\n  _generateToolState = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(imageIds, arrayBuffer, metadataProvider, options) {\n    var _options$skipOverlapp, skipOverlapping, _options$tolerance, tolerance, _options$TypedArrayCo, TypedArrayConstructor, _options$maxBytesPerC, maxBytesPerChunk, eventTarget, triggerEvent, dicomData, dataset, multiframe, imagePlaneModule, generalSeriesModule, SeriesInstanceUID, ImageOrientationPatient, validOrientations, sliceLength, segMetadata, TransferSyntaxUID, pixelData, pixelDataChunks, rleEncodedFrames, orientation, sopUIDImageIdIndexMap, overlapping, insertFunction, segmentsOnFrameArray, segmentsOnFrame, arrayBufferLength, labelmapBufferArray, imageIdMaps, segmentsPixelIndices, overlappingSegments, centroidXYZ, _t;\n    return _regenerator().w(function (_context) {\n      while (1) switch (_context.n) {\n        case 0:\n          _options$skipOverlapp = options.skipOverlapping, skipOverlapping = _options$skipOverlapp === void 0 ? false : _options$skipOverlapp, _options$tolerance = options.tolerance, tolerance = _options$tolerance === void 0 ? 1e-3 : _options$tolerance, _options$TypedArrayCo = options.TypedArrayConstructor, TypedArrayConstructor = _options$TypedArrayCo === void 0 ? Uint8Array : _options$TypedArrayCo, _options$maxBytesPerC = options.maxBytesPerChunk, maxBytesPerChunk = _options$maxBytesPerC === void 0 ? 199000000 : _options$maxBytesPerC, eventTarget = options.eventTarget, triggerEvent = options.triggerEvent;\n          dicomData = DicomMessage.readFile(arrayBuffer);\n          dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n          dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n          multiframe = Normalizer.normalizeToDataset([dataset]);\n          imagePlaneModule = metadataProvider.get(\"imagePlaneModule\", imageIds[0]);\n          generalSeriesModule = metadataProvider.get(\"generalSeriesModule\", imageIds[0]);\n          SeriesInstanceUID = generalSeriesModule.seriesInstanceUID;\n          if (!imagePlaneModule) {\n            console.warn(\"Insufficient metadata, imagePlaneModule missing.\");\n          }\n          ImageOrientationPatient = Array.isArray(imagePlaneModule.rowCosines) ? [].concat(_toConsumableArray(imagePlaneModule.rowCosines), _toConsumableArray(imagePlaneModule.columnCosines)) : [imagePlaneModule.rowCosines.x, imagePlaneModule.rowCosines.y, imagePlaneModule.rowCosines.z, imagePlaneModule.columnCosines.x, imagePlaneModule.columnCosines.y, imagePlaneModule.columnCosines.z]; // Get IOP from ref series, compute supported orientations:\n          validOrientations = getValidOrientations(ImageOrientationPatient);\n          sliceLength = multiframe.Columns * multiframe.Rows;\n          segMetadata = getSegmentMetadata(multiframe, SeriesInstanceUID);\n          TransferSyntaxUID = multiframe._meta.TransferSyntaxUID.Value[0];\n          if (!(TransferSyntaxUID === \"1.2.840.10008.1.2.5\")) {\n            _context.n = 2;\n            break;\n          }\n          rleEncodedFrames = Array.isArray(multiframe.PixelData) ? multiframe.PixelData : [multiframe.PixelData];\n          pixelData = decode(rleEncodedFrames, multiframe.Rows, multiframe.Columns);\n          if (!(multiframe.BitsStored === 1)) {\n            _context.n = 1;\n            break;\n          }\n          console.warn(\"No implementation for rle + bitbacking.\");\n          return _context.a(2);\n        case 1:\n          // Todo: need to test this with rle data\n          pixelDataChunks = [pixelData];\n          _context.n = 3;\n          break;\n        case 2:\n          pixelDataChunks = unpackPixelData(multiframe, {\n            maxBytesPerChunk: maxBytesPerChunk\n          });\n          if (pixelDataChunks) {\n            _context.n = 3;\n            break;\n          }\n          throw new Error(\"Fractional segmentations are not yet supported\");\n        case 3:\n          orientation = checkOrientation(multiframe, validOrientations, [imagePlaneModule.rows, imagePlaneModule.columns, imageIds.length], tolerance); // Pre-compute the sop UID to imageId index map so that in the for loop\n          // we don't have to call metadataProvider.get() for each imageId over\n          // and over again.\n          sopUIDImageIdIndexMap = imageIds.reduce(function (acc, imageId) {\n            var _metadataProvider$get = metadataProvider.get(\"generalImageModule\", imageId),\n              sopInstanceUID = _metadataProvider$get.sopInstanceUID;\n            acc[sopInstanceUID] = imageId;\n            return acc;\n          }, {});\n          overlapping = false;\n          if (!skipOverlapping) {\n            overlapping = checkSEGsOverlapping(pixelDataChunks, multiframe, imageIds, validOrientations, metadataProvider, tolerance, TypedArrayConstructor, sopUIDImageIdIndexMap);\n          }\n          _t = orientation;\n          _context.n = _t === \"Planar\" ? 4 : _t === \"Perpendicular\" ? 5 : _t === \"Oblique\" ? 6 : 7;\n          break;\n        case 4:\n          if (overlapping) {\n            insertFunction = insertOverlappingPixelDataPlanar;\n          } else {\n            insertFunction = insertPixelDataPlanar;\n          }\n          return _context.a(3, 7);\n        case 5:\n          throw new Error(\"Segmentations orthogonal to the acquisition plane of the source data are not yet supported.\");\n        case 6:\n          throw new Error(\"Segmentations oblique to the acquisition plane of the source data are not yet supported.\");\n        case 7:\n          /* if SEGs are overlapping:\r\n          1) the labelmapBuffer will contain M volumes which have non-overlapping segments;\r\n          2) segmentsOnFrame will have M * numberOfFrames values to track in which labelMap are the segments;\r\n          3) insertFunction will return the number of LabelMaps\r\n          4) generateToolState return is an array*/\n          segmentsOnFrameArray = [];\n          segmentsOnFrameArray[0] = [];\n          segmentsOnFrame = [];\n          arrayBufferLength = sliceLength * imageIds.length * TypedArrayConstructor.BYTES_PER_ELEMENT;\n          labelmapBufferArray = [];\n          labelmapBufferArray[0] = new ArrayBuffer(arrayBufferLength);\n\n          // Pre-compute the indices and metadata so that we don't have to call\n          // a function for each imageId in the for loop.\n          imageIdMaps = imageIds.reduce(function (acc, curr, index) {\n            acc.indices[curr] = index;\n            acc.metadata[curr] = metadataProvider.get(\"instance\", curr);\n            return acc;\n          }, {\n            indices: {},\n            metadata: {}\n          }); // This is the centroid calculation for each segment Index, the data structure\n          // is a Map with key = segmentIndex and value = {imageIdIndex: centroid, ...}\n          // later on we will use this data structure to calculate the centroid of the\n          // segment in the labelmapBuffer\n          segmentsPixelIndices = new Map();\n          _context.n = 8;\n          return insertFunction(segmentsOnFrame, segmentsOnFrameArray, labelmapBufferArray, pixelDataChunks, multiframe, imageIds, validOrientations, metadataProvider, tolerance, TypedArrayConstructor, segmentsPixelIndices, sopUIDImageIdIndexMap, imageIdMaps, eventTarget, triggerEvent);\n        case 8:\n          overlappingSegments = _context.v;\n          // calculate the centroid of each segment\n          centroidXYZ = new Map();\n          segmentsPixelIndices.forEach(function (imageIdIndexBufferIndex, segmentIndex) {\n            var centroids = calculateCentroid(imageIdIndexBufferIndex, multiframe, metadataProvider, imageIds);\n            centroidXYZ.set(segmentIndex, centroids);\n          });\n          return _context.a(2, {\n            labelmapBufferArray: labelmapBufferArray,\n            segMetadata: segMetadata,\n            segmentsOnFrame: segmentsOnFrame,\n            segmentsOnFrameArray: segmentsOnFrameArray,\n            centroids: centroidXYZ,\n            overlappingSegments: overlappingSegments\n          });\n      }\n    }, _callee);\n  }));\n  return _generateToolState.apply(this, arguments);\n}\nfunction findReferenceSourceImageId(multiframe, frameSegment, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap) {\n  var imageId = undefined;\n  if (!multiframe) {\n    return imageId;\n  }\n  var FrameOfReferenceUID = multiframe.FrameOfReferenceUID,\n    PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    SourceImageSequence = multiframe.SourceImageSequence,\n    ReferencedSeriesSequence = multiframe.ReferencedSeriesSequence;\n  if (!PerFrameFunctionalGroupsSequence || PerFrameFunctionalGroupsSequence.length === 0) {\n    return imageId;\n  }\n  var PerFrameFunctionalGroup = PerFrameFunctionalGroupsSequence[frameSegment];\n  if (!PerFrameFunctionalGroup) {\n    return imageId;\n  }\n  var frameSourceImageSequence = undefined;\n  if (PerFrameFunctionalGroup.DerivationImageSequence) {\n    var DerivationImageSequence = PerFrameFunctionalGroup.DerivationImageSequence;\n    if (Array.isArray(DerivationImageSequence)) {\n      if (DerivationImageSequence.length !== 0) {\n        DerivationImageSequence = DerivationImageSequence[0];\n      } else {\n        DerivationImageSequence = undefined;\n      }\n    }\n    if (DerivationImageSequence) {\n      frameSourceImageSequence = DerivationImageSequence.SourceImageSequence;\n      if (Array.isArray(frameSourceImageSequence)) {\n        if (frameSourceImageSequence.length !== 0) {\n          frameSourceImageSequence = frameSourceImageSequence[0];\n        } else {\n          frameSourceImageSequence = undefined;\n        }\n      }\n    }\n  } else if (SourceImageSequence && SourceImageSequence.length !== 0) {\n    console.warn(\"DerivationImageSequence not present, using SourceImageSequence assuming SEG has the same geometry as the source image.\");\n    frameSourceImageSequence = SourceImageSequence[frameSegment];\n  }\n  if (frameSourceImageSequence) {\n    imageId = getImageIdOfSourceImageBySourceImageSequence(frameSourceImageSequence, sopUIDImageIdIndexMap);\n  }\n  if (imageId === undefined && ReferencedSeriesSequence) {\n    var referencedSeriesSequence = Array.isArray(ReferencedSeriesSequence) ? ReferencedSeriesSequence[0] : ReferencedSeriesSequence;\n    var ReferencedSeriesInstanceUID = referencedSeriesSequence.SeriesInstanceUID;\n    imageId = getImageIdOfSourceImagebyGeometry(ReferencedSeriesInstanceUID, FrameOfReferenceUID, PerFrameFunctionalGroup, imageIds, metadataProvider, tolerance);\n  }\n  return imageId;\n}\n\n/**\r\n * Checks if there is any overlapping segmentations.\r\n *  @returns {boolean} Returns a flag if segmentations overlapping\r\n */\n\nfunction checkSEGsOverlapping(pixelData, multiframe, imageIds, validOrientations, metadataProvider, tolerance, TypedArrayConstructor, sopUIDImageIdIndexMap) {\n  var SharedFunctionalGroupsSequence = multiframe.SharedFunctionalGroupsSequence,\n    PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    SegmentSequence = multiframe.SegmentSequence,\n    Rows = multiframe.Rows,\n    Columns = multiframe.Columns;\n  var numberOfSegs = SegmentSequence.length;\n  if (numberOfSegs < 2) {\n    return false;\n  }\n  var sharedImageOrientationPatient = SharedFunctionalGroupsSequence.PlaneOrientationSequence ? SharedFunctionalGroupsSequence.PlaneOrientationSequence.ImageOrientationPatient : undefined;\n  var sliceLength = Columns * Rows;\n  var groupsLen = PerFrameFunctionalGroupsSequence.length;\n\n  /** sort groupsLen to have all the segments for each frame in an array\r\n   * frame 2 : 1, 2\r\n   * frame 4 : 1, 3\r\n   * frame 5 : 4\r\n   */\n\n  var frameSegmentsMapping = new Map();\n  var _loop3 = function _loop3() {\n      var segmentIndex = getSegmentIndex(multiframe, frameSegment);\n      if (segmentIndex === undefined) {\n        console.warn(\"Could not retrieve the segment index for frame segment \" + frameSegment + \", skipping this frame.\");\n        return 0; // continue\n      }\n      var imageId = findReferenceSourceImageId(multiframe, frameSegment, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap);\n      if (!imageId) {\n        console.warn(\"Image not present in stack, can't import frame : \" + frameSegment + \".\");\n        return 0; // continue\n      }\n      var imageIdIndex = imageIds.findIndex(function (element) {\n        return element === imageId;\n      });\n      if (frameSegmentsMapping.has(imageIdIndex)) {\n        var segmentArray = frameSegmentsMapping.get(imageIdIndex);\n        if (!segmentArray.includes(frameSegment)) {\n          segmentArray.push(frameSegment);\n          frameSegmentsMapping.set(imageIdIndex, segmentArray);\n        }\n      } else {\n        frameSegmentsMapping.set(imageIdIndex, [frameSegment]);\n      }\n    },\n    _ret;\n  for (var frameSegment = 0; frameSegment < groupsLen; ++frameSegment) {\n    _ret = _loop3();\n    if (_ret === 0) continue;\n  }\n  var _iterator = _createForOfIteratorHelper(frameSegmentsMapping.entries()),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var _step$value = _slicedToArray(_step.value, 2),\n        role = _step$value[1];\n      var temp2DArray = new TypedArrayConstructor(sliceLength).fill(0);\n      for (var i = 0; i < role.length; ++i) {\n        var _frameSegment = role[i];\n        var PerFrameFunctionalGroups = PerFrameFunctionalGroupsSequence[_frameSegment];\n        var ImageOrientationPatientI = sharedImageOrientationPatient || PerFrameFunctionalGroups.PlaneOrientationSequence.ImageOrientationPatient;\n        var view = readFromUnpackedChunks(pixelData, _frameSegment * sliceLength, sliceLength);\n        var pixelDataI2D = ndarray(view, [Rows, Columns]);\n        var alignedPixelDataI = alignPixelDataWithSourceData(pixelDataI2D, ImageOrientationPatientI, validOrientations, tolerance);\n        if (!alignedPixelDataI) {\n          console.warn(\"Individual SEG frames are out of plane with respect to the first SEG frame, this is not yet supported, skipping this frame.\");\n          continue;\n        }\n        var data = alignedPixelDataI.data;\n        for (var j = 0, len = data.length; j < len; ++j) {\n          if (data[j] !== 0) {\n            temp2DArray[j]++;\n            if (temp2DArray[j] > 1) {\n              return true;\n            }\n          }\n        }\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return false;\n}\nfunction insertOverlappingPixelDataPlanar(segmentsOnFrame, segmentsOnFrameArray, labelmapBufferArray, pixelData, multiframe, imageIds, validOrientations, metadataProvider, tolerance, TypedArrayConstructor, segmentsPixelIndices, sopUIDImageIdIndexMap) {\n  var SharedFunctionalGroupsSequence = multiframe.SharedFunctionalGroupsSequence,\n    PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    Rows = multiframe.Rows,\n    Columns = multiframe.Columns;\n  var sharedImageOrientationPatient = SharedFunctionalGroupsSequence.PlaneOrientationSequence ? SharedFunctionalGroupsSequence.PlaneOrientationSequence.ImageOrientationPatient : undefined;\n  var sliceLength = Columns * Rows;\n  var arrayBufferLength = sliceLength * imageIds.length * TypedArrayConstructor.BYTES_PER_ELEMENT;\n  // indicate the number of labelMaps\n  var M = 1;\n\n  // indicate the current labelMap array index;\n  var m = 0;\n\n  // temp array for checking overlaps\n  var tempBuffer = labelmapBufferArray[m].slice(0);\n\n  // temp list for checking overlaps\n  var tempSegmentsOnFrame = structuredClone(segmentsOnFrameArray[m]);\n\n  /** split overlapping SEGs algorithm for each segment:\r\n   *  A) copy the labelmapBuffer in the array with index 0\r\n   *  B) add the segment pixel per pixel on the copied buffer from (A)\r\n   *  C) if no overlap, copy the results back on the orignal array from (A)\r\n   *  D) if overlap, repeat increasing the index m up to M (if out of memory, add new buffer in the array and M++);\r\n   */\n\n  var numberOfSegs = multiframe.SegmentSequence.length;\n  for (var segmentIndexToProcess = 1; segmentIndexToProcess <= numberOfSegs; ++segmentIndexToProcess) {\n    var _loop4 = function _loop4(_i2) {\n        var PerFrameFunctionalGroups = PerFrameFunctionalGroupsSequence[_i2];\n        var segmentIndex = getSegmentIndex(multiframe, _i2);\n        if (segmentIndex === undefined) {\n          throw new Error(\"Could not retrieve the segment index. Aborting segmentation loading.\");\n        }\n        if (segmentIndex !== segmentIndexToProcess) {\n          i = _i2;\n          return 0; // continue\n        }\n        var ImageOrientationPatientI = sharedImageOrientationPatient || PerFrameFunctionalGroups.PlaneOrientationSequence.ImageOrientationPatient;\n\n        // Since we moved to the chunks approach, we need to read the data\n        // and handle scenarios where the portion of data is in one chunk\n        // and the other portion is in another chunk\n        var view = readFromUnpackedChunks(pixelData, _i2 * sliceLength, sliceLength);\n        var pixelDataI2D = ndarray(view, [Rows, Columns]);\n        var alignedPixelDataI = alignPixelDataWithSourceData(pixelDataI2D, ImageOrientationPatientI, validOrientations, tolerance);\n        if (!alignedPixelDataI) {\n          throw new Error(\"Individual SEG frames are out of plane with respect to the first SEG frame. \" + \"This is not yet supported. Aborting segmentation loading.\");\n        }\n        var imageId = findReferenceSourceImageId(multiframe, _i2, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap);\n        if (!imageId) {\n          console.warn(\"Image not present in stack, can't import frame : \" + _i2 + \".\");\n          i = _i2;\n          return 0; // continue\n        }\n        var sourceImageMetadata = metadataProvider.get(\"instance\", imageId);\n        if (Rows !== sourceImageMetadata.Rows || Columns !== sourceImageMetadata.Columns) {\n          throw new Error(\"Individual SEG frames have different geometry dimensions (Rows and Columns) \" + \"respect to the source image reference frame. This is not yet supported. \" + \"Aborting segmentation loading. \");\n        }\n        var imageIdIndex = imageIds.findIndex(function (element) {\n          return element === imageId;\n        });\n        var byteOffset = sliceLength * imageIdIndex * TypedArrayConstructor.BYTES_PER_ELEMENT;\n        var labelmap2DView = new TypedArrayConstructor(tempBuffer, byteOffset, sliceLength);\n        var data = alignedPixelDataI.data;\n        var segmentOnFrame = false;\n        for (var j = 0, len = alignedPixelDataI.data.length; j < len; ++j) {\n          if (data[j]) {\n            if (labelmap2DView[j] !== 0) {\n              m++;\n              if (m >= M) {\n                labelmapBufferArray[m] = new ArrayBuffer(arrayBufferLength);\n                segmentsOnFrameArray[m] = [];\n                M++;\n              }\n              tempBuffer = labelmapBufferArray[m].slice(0);\n              tempSegmentsOnFrame = structuredClone(segmentsOnFrameArray[m]);\n              _i2 = 0;\n              break;\n            } else {\n              labelmap2DView[j] = segmentIndex;\n              segmentOnFrame = true;\n            }\n          }\n        }\n        if (segmentOnFrame) {\n          if (!tempSegmentsOnFrame[imageIdIndex]) {\n            tempSegmentsOnFrame[imageIdIndex] = [];\n          }\n          tempSegmentsOnFrame[imageIdIndex].push(segmentIndex);\n          if (!segmentsOnFrame[imageIdIndex]) {\n            segmentsOnFrame[imageIdIndex] = [];\n          }\n          segmentsOnFrame[imageIdIndex].push(segmentIndex);\n        }\n        i = _i2;\n      },\n      _ret2;\n    for (var i = 0, groupsLen = PerFrameFunctionalGroupsSequence.length; i < groupsLen; ++i) {\n      _ret2 = _loop4(i);\n      if (_ret2 === 0) continue;\n    }\n    labelmapBufferArray[m] = tempBuffer.slice(0);\n    segmentsOnFrameArray[m] = structuredClone(tempSegmentsOnFrame);\n\n    // reset temp variables/buffers for new segment\n    m = 0;\n    tempBuffer = labelmapBufferArray[m].slice(0);\n    tempSegmentsOnFrame = structuredClone(segmentsOnFrameArray[m]);\n  }\n}\nvar getSegmentIndex = function getSegmentIndex(multiframe, frame) {\n  var PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    SharedFunctionalGroupsSequence = multiframe.SharedFunctionalGroupsSequence;\n  var PerFrameFunctionalGroups = PerFrameFunctionalGroupsSequence[frame];\n  return PerFrameFunctionalGroups && PerFrameFunctionalGroups.SegmentIdentificationSequence ? PerFrameFunctionalGroups.SegmentIdentificationSequence.ReferencedSegmentNumber : SharedFunctionalGroupsSequence.SegmentIdentificationSequence ? SharedFunctionalGroupsSequence.SegmentIdentificationSequence.ReferencedSegmentNumber : undefined;\n};\nfunction insertPixelDataPlanar(segmentsOnFrame, segmentsOnFrameArray, labelmapBufferArray, pixelData, multiframe, imageIds, validOrientations, metadataProvider, tolerance, TypedArrayConstructor, segmentsPixelIndices, sopUIDImageIdIndexMap, imageIdMaps, eventTarget, triggerEvent) {\n  var SharedFunctionalGroupsSequence = multiframe.SharedFunctionalGroupsSequence,\n    PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    Rows = multiframe.Rows,\n    Columns = multiframe.Columns;\n  var sharedImageOrientationPatient = SharedFunctionalGroupsSequence.PlaneOrientationSequence ? SharedFunctionalGroupsSequence.PlaneOrientationSequence.ImageOrientationPatient : undefined;\n  var sliceLength = Columns * Rows;\n  var i = 0;\n  var groupsLen = PerFrameFunctionalGroupsSequence.length;\n  var chunkSize = Math.ceil(groupsLen / 10); // 10% of total length\n\n  var shouldTriggerEvent = triggerEvent && eventTarget;\n  var overlapping = false;\n  // Below, we chunk the processing of the frames to avoid blocking the main thread\n  // if the segmentation is large. We also use a promise to allow the caller to\n  // wait for the processing to finish.\n  return new Promise(function (resolve) {\n    function processInChunks() {\n      // process one chunk\n      for (var end = Math.min(i + chunkSize, groupsLen); i < end; ++i) {\n        var PerFrameFunctionalGroups = PerFrameFunctionalGroupsSequence[i];\n        var ImageOrientationPatientI = sharedImageOrientationPatient || PerFrameFunctionalGroups.PlaneOrientationSequence.ImageOrientationPatient;\n        var view = readFromUnpackedChunks(pixelData, i * sliceLength, sliceLength);\n        var pixelDataI2D = ndarray(view, [Rows, Columns]);\n        var alignedPixelDataI = alignPixelDataWithSourceData(pixelDataI2D, ImageOrientationPatientI, validOrientations, tolerance);\n        if (!alignedPixelDataI) {\n          throw new Error(\"Individual SEG frames are out of plane with respect to the first SEG frame. \" + \"This is not yet supported. Aborting segmentation loading.\");\n        }\n        var segmentIndex = getSegmentIndex(multiframe, i);\n        if (segmentIndex === undefined) {\n          throw new Error(\"Could not retrieve the segment index. Aborting segmentation loading.\");\n        }\n        if (!segmentsPixelIndices.has(segmentIndex)) {\n          segmentsPixelIndices.set(segmentIndex, {});\n        }\n        var imageId = findReferenceSourceImageId(multiframe, i, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap);\n        if (!imageId) {\n          console.warn(\"Image not present in stack, can't import frame : \" + i + \".\");\n          continue;\n        }\n        var sourceImageMetadata = imageIdMaps.metadata[imageId];\n        if (Rows !== sourceImageMetadata.Rows || Columns !== sourceImageMetadata.Columns) {\n          throw new Error(\"Individual SEG frames have different geometry dimensions (Rows and Columns) \" + \"respect to the source image reference frame. This is not yet supported. \" + \"Aborting segmentation loading. \");\n        }\n        var imageIdIndex = imageIdMaps.indices[imageId];\n        var byteOffset = sliceLength * imageIdIndex * TypedArrayConstructor.BYTES_PER_ELEMENT;\n        var labelmap2DView = new TypedArrayConstructor(labelmapBufferArray[0], byteOffset, sliceLength);\n        var data = alignedPixelDataI.data;\n        var indexCache = [];\n        for (var j = 0, len = alignedPixelDataI.data.length; j < len; ++j) {\n          if (data[j]) {\n            for (var x = j; x < len; ++x) {\n              if (data[x]) {\n                if (!overlapping && labelmap2DView[x] !== 0) {\n                  overlapping = true;\n                }\n                labelmap2DView[x] = segmentIndex;\n                indexCache.push(x);\n              }\n            }\n            if (!segmentsOnFrame[imageIdIndex]) {\n              segmentsOnFrame[imageIdIndex] = [];\n            }\n            segmentsOnFrame[imageIdIndex].push(segmentIndex);\n            break;\n          }\n        }\n        var segmentIndexObject = segmentsPixelIndices.get(segmentIndex);\n        segmentIndexObject[imageIdIndex] = indexCache;\n        segmentsPixelIndices.set(segmentIndex, segmentIndexObject);\n      }\n\n      // trigger an event after each chunk\n      if (shouldTriggerEvent) {\n        var percentComplete = Math.round(i / groupsLen * 100);\n        triggerEvent(eventTarget, Events.SEGMENTATION_LOAD_PROGRESS, {\n          percentComplete: percentComplete\n        });\n      }\n\n      // schedule next chunk\n      if (i < groupsLen) {\n        setTimeout(processInChunks, 0);\n      } else {\n        // resolve the Promise when all chunks have been processed\n        resolve(overlapping);\n      }\n    }\n    processInChunks();\n  });\n}\n\n/**\r\n * unpackPixelData - Unpacks bit packed pixelData if the Segmentation is BINARY.\r\n *\r\n * @param  {Object} multiframe The multiframe dataset.\r\n * @param  {Object} options    Options for the unpacking.\r\n * @return {Uint8Array}      The unpacked pixelData.\r\n */\nfunction unpackPixelData(multiframe, options) {\n  var segType = multiframe.SegmentationType;\n  var data;\n  if (Array.isArray(multiframe.PixelData)) {\n    data = multiframe.PixelData[0];\n  } else {\n    data = multiframe.PixelData;\n  }\n  if (data === undefined) {\n    log.error(\"This segmentation pixelData is undefined.\");\n  }\n  if (segType === \"BINARY\") {\n    // For extreme big data, we can't unpack the data at once and we need to\n    // chunk it and unpack each chunk separately.\n    // MAX 2GB is the limit right now to allocate a buffer\n    return getUnpackedChunks(data, options.maxBytesPerChunk);\n  }\n  var pixelData = new Uint8Array(data);\n  var max = multiframe.MaximumFractionalValue;\n  var onlyMaxAndZero = pixelData.find(function (element) {\n    return element !== 0 && element !== max;\n  }) === undefined;\n  if (!onlyMaxAndZero) {\n    // This is a fractional segmentation, which is not currently supported.\n    return;\n  }\n  log.warn(\"This segmentation object is actually binary... processing as such.\");\n  return pixelData;\n}\nfunction getUnpackedChunks(data, maxBytesPerChunk) {\n  var bitArray = new Uint8Array(data);\n  var chunks = [];\n  var maxBitsPerChunk = maxBytesPerChunk * 8;\n  var numberOfChunks = Math.ceil(bitArray.length * 8 / maxBitsPerChunk);\n  for (var i = 0; i < numberOfChunks; i++) {\n    var startBit = i * maxBitsPerChunk;\n    var endBit = Math.min(startBit + maxBitsPerChunk, bitArray.length * 8);\n    var startByte = Math.floor(startBit / 8);\n    var endByte = Math.ceil(endBit / 8);\n    var chunk = bitArray.slice(startByte, endByte);\n    var unpackedChunk = BitArray.unpack(chunk);\n    chunks.push(unpackedChunk);\n  }\n  return chunks;\n}\n\n/**\r\n * getImageIdOfSourceImageBySourceImageSequence - Returns the Cornerstone imageId of the source image.\r\n *\r\n * @param  {Object}   SourceImageSequence  Sequence describing the source image.\r\n * @param  {String[]} imageIds             A list of imageIds.\r\n * @param  {Object}   sopUIDImageIdIndexMap A map of SOPInstanceUIDs to imageIds.\r\n * @return {String}                        The corresponding imageId.\r\n */\nfunction getImageIdOfSourceImageBySourceImageSequence(SourceImageSequence, sopUIDImageIdIndexMap) {\n  var ReferencedSOPInstanceUID = SourceImageSequence.ReferencedSOPInstanceUID,\n    ReferencedFrameNumber = SourceImageSequence.ReferencedFrameNumber;\n  return ReferencedFrameNumber ? getImageIdOfReferencedFrame(ReferencedSOPInstanceUID, ReferencedFrameNumber, sopUIDImageIdIndexMap) : sopUIDImageIdIndexMap[ReferencedSOPInstanceUID];\n}\n\n/**\r\n * getImageIdOfSourceImagebyGeometry - Returns the Cornerstone imageId of the source image.\r\n *\r\n * @param  {String}    ReferencedSeriesInstanceUID    Referenced series of the source image.\r\n * @param  {String}    FrameOfReferenceUID            Frame of reference.\r\n * @param  {Object}    PerFrameFunctionalGroup        Sequence describing segmentation reference attributes per frame.\r\n * @param  {String[]}  imageIds                       A list of imageIds.\r\n * @param  {Object}    sopUIDImageIdIndexMap          A map of SOPInstanceUIDs to imageIds.\r\n * @param  {Float}     tolerance                      The tolerance parameter\r\n *\r\n * @return {String}                                   The corresponding imageId.\r\n */\nfunction getImageIdOfSourceImagebyGeometry(ReferencedSeriesInstanceUID, FrameOfReferenceUID, PerFrameFunctionalGroup, imageIds, metadataProvider, tolerance) {\n  if (ReferencedSeriesInstanceUID === undefined || PerFrameFunctionalGroup.PlanePositionSequence === undefined || PerFrameFunctionalGroup.PlanePositionSequence[0] === undefined || PerFrameFunctionalGroup.PlanePositionSequence[0].ImagePositionPatient === undefined) {\n    return undefined;\n  }\n  for (var imageIdsIndexc = 0; imageIdsIndexc < imageIds.length; ++imageIdsIndexc) {\n    var sourceImageMetadata = metadataProvider.get(\"instance\", imageIds[imageIdsIndexc]);\n    if (sourceImageMetadata === undefined || sourceImageMetadata.ImagePositionPatient === undefined || sourceImageMetadata.FrameOfReferenceUID !== FrameOfReferenceUID || sourceImageMetadata.SeriesInstanceUID !== ReferencedSeriesInstanceUID) {\n      continue;\n    }\n    if (compareArrays(PerFrameFunctionalGroup.PlanePositionSequence[0].ImagePositionPatient, sourceImageMetadata.ImagePositionPatient, tolerance)) {\n      return imageIds[imageIdsIndexc];\n    }\n  }\n}\n\n/**\r\n * getImageIdOfReferencedFrame - Returns the imageId corresponding to the\r\n * specified sopInstanceUid and frameNumber for multi-frame images.\r\n *\r\n * @param  {String} sopInstanceUid   The sopInstanceUid of the desired image.\r\n * @param  {Number} frameNumber      The frame number.\r\n * @param  {String} imageIds         The list of imageIds.\r\n * @param  {Object} sopUIDImageIdIndexMap A map of SOPInstanceUIDs to imageIds.\r\n * @return {String}                  The imageId that corresponds to the sopInstanceUid.\r\n */\nfunction getImageIdOfReferencedFrame(sopInstanceUid, frameNumber, sopUIDImageIdIndexMap) {\n  var imageId = sopUIDImageIdIndexMap[sopInstanceUid];\n  if (!imageId) {\n    return;\n  }\n  var imageIdFrameNumber = Number(imageId.split(\"frame=\")[1]);\n  return imageIdFrameNumber === frameNumber - 1 ? imageId : undefined;\n}\n\n/**\r\n * getValidOrientations - returns an array of valid orientations.\r\n *\r\n * @param  {Number[6]} iop The row (0..2) an column (3..5) direction cosines.\r\n * @return {Number[8][6]} An array of valid orientations.\r\n */\nfunction getValidOrientations(iop) {\n  var orientations = [];\n\n  // [0,  1,  2]: 0,   0hf,   0vf\n  // [3,  4,  5]: 90,  90hf,  90vf\n  // [6, 7]:      180, 270\n\n  orientations[0] = iop;\n  orientations[1] = flipIOP.h(iop);\n  orientations[2] = flipIOP.v(iop);\n  var iop90 = rotateDirectionCosinesInPlane(iop, Math.PI / 2);\n  orientations[3] = iop90;\n  orientations[4] = flipIOP.h(iop90);\n  orientations[5] = flipIOP.v(iop90);\n  orientations[6] = rotateDirectionCosinesInPlane(iop, Math.PI);\n  orientations[7] = rotateDirectionCosinesInPlane(iop, 1.5 * Math.PI);\n  return orientations;\n}\n\n/**\r\n * alignPixelDataWithSourceData -\r\n *\r\n * @param {Ndarray} pixelData2D - The data to align.\r\n * @param {Number[6]} iop - The orientation of the image slice.\r\n * @param {Number[8][6]} orientations - An array of valid imageOrientationPatient values.\r\n * @param {Number} tolerance.\r\n * @return {Ndarray} The aligned pixelData.\r\n */\nfunction alignPixelDataWithSourceData(pixelData2D, iop, orientations, tolerance) {\n  if (compareArrays(iop, orientations[0], tolerance)) {\n    return pixelData2D;\n  } else if (compareArrays(iop, orientations[1], tolerance)) {\n    // Flipped vertically.\n\n    // Undo Flip\n    return flipMatrix2D.v(pixelData2D);\n  } else if (compareArrays(iop, orientations[2], tolerance)) {\n    // Flipped horizontally.\n\n    // Unfo flip\n    return flipMatrix2D.h(pixelData2D);\n  } else if (compareArrays(iop, orientations[3], tolerance)) {\n    //Rotated 90 degrees\n\n    // Rotate back\n    return rotateMatrix902D(pixelData2D);\n  } else if (compareArrays(iop, orientations[4], tolerance)) {\n    //Rotated 90 degrees and fliped horizontally.\n\n    // Undo flip and rotate back.\n    return rotateMatrix902D(flipMatrix2D.h(pixelData2D));\n  } else if (compareArrays(iop, orientations[5], tolerance)) {\n    // Rotated 90 degrees and fliped vertically\n\n    // Unfo flip and rotate back.\n    return rotateMatrix902D(flipMatrix2D.v(pixelData2D));\n  } else if (compareArrays(iop, orientations[6], tolerance)) {\n    // Rotated 180 degrees. // TODO -> Do this more effeciently, there is a 1:1 mapping like 90 degree rotation.\n\n    return rotateMatrix902D(rotateMatrix902D(pixelData2D));\n  } else if (compareArrays(iop, orientations[7], tolerance)) {\n    // Rotated 270 degrees\n\n    // Rotate back.\n    return rotateMatrix902D(rotateMatrix902D(rotateMatrix902D(pixelData2D)));\n  }\n}\nfunction getSegmentMetadata(multiframe, seriesInstanceUid) {\n  var segmentSequence = multiframe.SegmentSequence;\n  var data = [];\n  if (Array.isArray(segmentSequence)) {\n    data = [undefined].concat(_toConsumableArray(segmentSequence));\n  } else {\n    // Only one segment, will be stored as an object.\n    data = [undefined, segmentSequence];\n  }\n  return {\n    seriesInstanceUid: seriesInstanceUid,\n    data: data\n  };\n}\n\n/**\r\n * Reads a range of bytes from an array of ArrayBuffer chunks and\r\n * aggregate them into a new Uint8Array.\r\n *\r\n * @param {ArrayBuffer[]} chunks - An array of ArrayBuffer chunks.\r\n * @param {number} offset - The offset of the first byte to read.\r\n * @param {number} length - The number of bytes to read.\r\n * @returns {Uint8Array} A new Uint8Array containing the requested bytes.\r\n */\nfunction readFromUnpackedChunks(chunks, offset, length) {\n  var mapping = getUnpackedOffsetAndLength(chunks, offset, length);\n\n  // If all the data is in one chunk, we can just slice that chunk\n  if (mapping.start.chunkIndex === mapping.end.chunkIndex) {\n    return new Uint8Array(chunks[mapping.start.chunkIndex].buffer, mapping.start.offset, length);\n  } else {\n    // If the data spans multiple chunks, we need to create a new Uint8Array and copy the data from each chunk\n    var result = new Uint8Array(length);\n    var resultOffset = 0;\n    for (var i = mapping.start.chunkIndex; i <= mapping.end.chunkIndex; i++) {\n      var start = i === mapping.start.chunkIndex ? mapping.start.offset : 0;\n      var end = i === mapping.end.chunkIndex ? mapping.end.offset : chunks[i].length;\n      result.set(new Uint8Array(chunks[i].buffer, start, end - start), resultOffset);\n      resultOffset += end - start;\n    }\n    return result;\n  }\n}\nfunction getUnpackedOffsetAndLength(chunks, offset, length) {\n  var totalBytes = chunks.reduce(function (total, chunk) {\n    return total + chunk.length;\n  }, 0);\n  if (offset < 0 || offset + length > totalBytes) {\n    throw new Error(\"Offset and length out of bounds\");\n  }\n  var startChunkIndex = 0;\n  var startOffsetInChunk = offset;\n  while (startOffsetInChunk >= chunks[startChunkIndex].length) {\n    startOffsetInChunk -= chunks[startChunkIndex].length;\n    startChunkIndex++;\n  }\n  var endChunkIndex = startChunkIndex;\n  var endOffsetInChunk = startOffsetInChunk + length;\n  while (endOffsetInChunk > chunks[endChunkIndex].length) {\n    endOffsetInChunk -= chunks[endChunkIndex].length;\n    endChunkIndex++;\n  }\n  return {\n    start: {\n      chunkIndex: startChunkIndex,\n      offset: startOffsetInChunk\n    },\n    end: {\n      chunkIndex: endChunkIndex,\n      offset: endOffsetInChunk\n    }\n  };\n}\nfunction calculateCentroid(imageIdIndexBufferIndex, multiframe, metadataProvider, imageIds) {\n  var xAcc = 0;\n  var yAcc = 0;\n  var zAcc = 0;\n  var worldXAcc = 0;\n  var worldYAcc = 0;\n  var worldZAcc = 0;\n  var count = 0;\n  for (var _i3 = 0, _Object$entries = Object.entries(imageIdIndexBufferIndex); _i3 < _Object$entries.length; _i3++) {\n    var _Object$entries$_i = _slicedToArray(_Object$entries[_i3], 2),\n      imageIdIndex = _Object$entries$_i[0],\n      bufferIndices = _Object$entries$_i[1];\n    var z = Number(imageIdIndex);\n    if (!bufferIndices || bufferIndices.length === 0) {\n      continue;\n    }\n\n    // Get metadata for this slice\n    var imageId = imageIds[z];\n    var imagePlaneModule = metadataProvider.get(\"imagePlaneModule\", imageId);\n    if (!imagePlaneModule) {\n      console.debug(\"Missing imagePlaneModule metadata for centroid calculation\");\n      continue;\n    }\n    var imagePositionPatient = imagePlaneModule.imagePositionPatient,\n      rowCosines = imagePlaneModule.rowCosines,\n      columnCosines = imagePlaneModule.columnCosines,\n      rowPixelSpacing = imagePlaneModule.rowPixelSpacing,\n      columnPixelSpacing = imagePlaneModule.columnPixelSpacing;\n    var _iterator2 = _createForOfIteratorHelper(bufferIndices),\n      _step2;\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var bufferIndex = _step2.value;\n        var y = Math.floor(bufferIndex / multiframe.Rows);\n        var x = bufferIndex % multiframe.Rows;\n\n        // Image coordinates\n        xAcc += x;\n        yAcc += y;\n        zAcc += z;\n\n        // Calculate world coordinates\n        // P(world) = P(image) * IOP * spacing + IPP\n        var worldX = imagePositionPatient[0] + x * rowCosines[0] * columnPixelSpacing + y * columnCosines[0] * rowPixelSpacing;\n        var worldY = imagePositionPatient[1] + x * rowCosines[1] * columnPixelSpacing + y * columnCosines[1] * rowPixelSpacing;\n        var worldZ = imagePositionPatient[2] + x * rowCosines[2] * columnPixelSpacing + y * columnCosines[2] * rowPixelSpacing;\n        worldXAcc += worldX;\n        worldYAcc += worldY;\n        worldZAcc += worldZ;\n        count++;\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n  }\n  return {\n    image: {\n      x: Math.floor(xAcc / count),\n      y: Math.floor(yAcc / count),\n      z: Math.floor(zAcc / count)\n    },\n    world: {\n      x: worldXAcc / count,\n      y: worldYAcc / count,\n      z: worldZAcc / count\n    },\n    count: count\n  };\n}\nvar Segmentation = {\n  generateSegmentation: generateSegmentation,\n  generateToolState: generateToolState,\n  fillSegmentation: fillSegmentation\n};\n\nexport { Segmentation as default, fillSegmentation, generateSegmentation, generateToolState };\n","import Segmentation$1 from './Segmentation_3X.js';\nimport Segmentation from './Segmentation_4X.js';\n\n/**\r\n * generateSegmentation - Generates a DICOM Segmentation object given cornerstoneTools data.\r\n *\r\n * @param  {object[]} images    An array of the cornerstone image objects.\r\n * @param  {Object|Object[]} labelmaps3DorBrushData For 4.X: The cornerstone `Labelmap3D` object, or an array of objects.\r\n *                                                  For 3.X: the BrushData.\r\n * @param  {number} cornerstoneToolsVersion The cornerstoneTools major version to map against.\r\n * @returns {Object}\r\n */\nfunction generateSegmentation(images, labelmaps3DorBrushData) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n    includeSliceSpacing: true\n  };\n  var cornerstoneToolsVersion = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 4;\n  if (cornerstoneToolsVersion === 4) {\n    return Segmentation.generateSegmentation(images, labelmaps3DorBrushData, options);\n  }\n  if (cornerstoneToolsVersion === 3) {\n    return Segmentation$1.generateSegmentation(images, labelmaps3DorBrushData, options);\n  }\n  console.warn(\"No generateSegmentation adapter for cornerstone version \".concat(cornerstoneToolsVersion, \", exiting.\"));\n}\n\n/**\r\n * generateToolState - Given a set of cornerstoneTools imageIds and a Segmentation buffer,\r\n * derive cornerstoneTools toolState and brush metadata.\r\n *\r\n * @param  {string[]} imageIds    An array of the imageIds.\r\n * @param  {ArrayBuffer} arrayBuffer The SEG arrayBuffer.\r\n * @param {*} metadataProvider\r\n * @param  {boolean} skipOverlapping - skip checks for overlapping segs, default value false.\r\n * @param  {number} tolerance - default value 1.e-3.\r\n * @param  {number} cornerstoneToolsVersion - default value 4.\r\n *\r\n * @returns {Object}  The toolState and an object from which the\r\n *                    segment metadata can be derived.\r\n */\nfunction generateToolState(imageIds, arrayBuffer, metadataProvider) {\n  var skipOverlapping = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var tolerance = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1e-3;\n  var cornerstoneToolsVersion = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 4;\n  if (cornerstoneToolsVersion === 4) {\n    return Segmentation.generateToolState(imageIds, arrayBuffer, metadataProvider, skipOverlapping, tolerance);\n  }\n  if (cornerstoneToolsVersion === 3) {\n    return Segmentation$1.generateToolState(imageIds, arrayBuffer, metadataProvider);\n  }\n  console.warn(\"No generateToolState adapter for cornerstone version \".concat(cornerstoneToolsVersion, \", exiting.\"));\n}\n\n/**\r\n * fillSegmentation - Fills a derived segmentation dataset with cornerstoneTools `LabelMap3D` data.\r\n *\r\n * @param  {object[]} segmentation An empty segmentation derived dataset.\r\n * @param  {Object|Object[]} inputLabelmaps3D The cornerstone `Labelmap3D` object, or an array of objects.\r\n * @param  {Object} userOptions Options object to override default options.\r\n * @returns {Blob}           description\r\n */\nfunction fillSegmentation(segmentation, inputLabelmaps3D) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n    includeSliceSpacing: true\n  };\n  var cornerstoneToolsVersion = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 4;\n  if (cornerstoneToolsVersion === 4) {\n    return Segmentation.fillSegmentation(segmentation, inputLabelmaps3D, options);\n  }\n  console.warn(\"No generateSegmentation adapter for cornerstone version \".concat(cornerstoneToolsVersion, \", exiting.\"));\n}\n\nexport { fillSegmentation, generateSegmentation, generateToolState };\n","import { asyncToGenerator as _asyncToGenerator, regenerator as _regenerator, toConsumableArray as _toConsumableArray } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { data, normalizers, log } from 'dcmjs';\nimport checkOrientation from '../helpers/checkOrientation.js';\nimport compareArrays from '../helpers/compareArrays.js';\n\nvar DicomMessage = data.DicomMessage,\n  DicomMetaDictionary = data.DicomMetaDictionary;\nvar Normalizer = normalizers.Normalizer;\nfunction generateToolState(_x, _x2, _x3) {\n  return _generateToolState.apply(this, arguments);\n}\nfunction _generateToolState() {\n  _generateToolState = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(imageIds, arrayBuffer, metadataProvider) {\n    var tolerance,\n      dicomData,\n      dataset,\n      multiframe,\n      imagePlaneModule,\n      ImageOrientationPatient,\n      validOrientations,\n      pixelData,\n      orientation,\n      sopUIDImageIdIndexMap,\n      orientationText,\n      imageIdMaps,\n      _args = arguments;\n    return _regenerator().w(function (_context) {\n      while (1) switch (_context.n) {\n        case 0:\n          tolerance = _args.length > 3 && _args[3] !== undefined ? _args[3] : 1e-3;\n          dicomData = DicomMessage.readFile(arrayBuffer);\n          dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n          dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n          multiframe = Normalizer.normalizeToDataset([dataset]);\n          imagePlaneModule = metadataProvider.get(\"imagePlaneModule\", imageIds[0]);\n          if (!imagePlaneModule) {\n            console.warn(\"Insufficient metadata, imagePlaneModule missing.\");\n          }\n          ImageOrientationPatient = Array.isArray(imagePlaneModule.rowCosines) ? [].concat(_toConsumableArray(imagePlaneModule.rowCosines), _toConsumableArray(imagePlaneModule.columnCosines)) : [imagePlaneModule.rowCosines.x, imagePlaneModule.rowCosines.y, imagePlaneModule.rowCosines.z, imagePlaneModule.columnCosines.x, imagePlaneModule.columnCosines.y, imagePlaneModule.columnCosines.z];\n          validOrientations = [ImageOrientationPatient];\n          pixelData = getPixelData(multiframe);\n          orientation = checkOrientation(multiframe, validOrientations, [imagePlaneModule.rows, imagePlaneModule.columns, imageIds.length], tolerance);\n          sopUIDImageIdIndexMap = imageIds.reduce(function (acc, imageId) {\n            var _metadataProvider$get = metadataProvider.get(\"generalImageModule\", imageId),\n              sopInstanceUID = _metadataProvider$get.sopInstanceUID;\n            acc[sopInstanceUID] = imageId;\n            return acc;\n          }, {});\n          if (!(orientation !== \"Planar\")) {\n            _context.n = 1;\n            break;\n          }\n          orientationText = {\n            Perpendicular: \"orthogonal\",\n            Oblique: \"oblique\"\n          };\n          throw new Error(\"Parametric maps \".concat(orientationText[orientation], \" to the acquisition plane of the source data are not yet supported.\"));\n        case 1:\n          imageIdMaps = imageIds.reduce(function (acc, curr, index) {\n            acc.indices[curr] = index;\n            acc.metadata[curr] = metadataProvider.get(\"instance\", curr);\n            return acc;\n          }, {\n            indices: {},\n            metadata: {}\n          });\n          _context.n = 2;\n          return insertPixelDataPlanar(pixelData, multiframe, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap, imageIdMaps);\n        case 2:\n          return _context.a(2, {\n            pixelData: pixelData\n          });\n      }\n    }, _callee);\n  }));\n  return _generateToolState.apply(this, arguments);\n}\nfunction insertPixelDataPlanar(sourcePixelData, multiframe, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap, imageIdMaps) {\n  var targetPixelData = new sourcePixelData.constructor(sourcePixelData.length);\n  var PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    Rows = multiframe.Rows,\n    Columns = multiframe.Columns;\n  var sliceLength = Columns * Rows;\n  var numSlices = PerFrameFunctionalGroupsSequence.length;\n  for (var i = 0; i < numSlices; i++) {\n    var sourceSliceDataView = new sourcePixelData.constructor(sourcePixelData.buffer, i * sliceLength, sliceLength);\n    var imageId = findReferenceSourceImageId(multiframe, i, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap);\n    if (!imageId) {\n      console.warn(\"Image not present in stack, can't import frame : \" + i + \".\");\n      continue;\n    }\n    var sourceImageMetadata = imageIdMaps.metadata[imageId];\n    if (Rows !== sourceImageMetadata.Rows || Columns !== sourceImageMetadata.Columns) {\n      throw new Error(\"Parametric map have different geometry dimensions (Rows and Columns) \" + \"respect to the source image reference frame. This is not yet supported.\");\n    }\n    var imageIdIndex = imageIdMaps.indices[imageId];\n    var byteOffset = sliceLength * imageIdIndex * targetPixelData.BYTES_PER_ELEMENT;\n    var targetSliceDataView = new targetPixelData.constructor(targetPixelData.buffer, byteOffset, sliceLength);\n    targetSliceDataView.set(sourceSliceDataView);\n  }\n  return targetPixelData;\n}\nfunction getPixelData(multiframe) {\n  var TypedArrayClass;\n  var data;\n  if (multiframe.PixelData) {\n    var _multiframe$PixelRepr;\n    var validTypedArrays = multiframe.BitsAllocated === 16 ? [Uint16Array, Int16Array] : [Uint32Array, Int32Array];\n    TypedArrayClass = validTypedArrays[(_multiframe$PixelRepr = multiframe.PixelRepresentation) !== null && _multiframe$PixelRepr !== void 0 ? _multiframe$PixelRepr : 0];\n    data = multiframe.PixelData;\n  } else if (multiframe.FloatPixelData) {\n    TypedArrayClass = Float32Array;\n    data = multiframe.FloatPixelData;\n  } else if (multiframe.DoubleFloatPixelData) {\n    TypedArrayClass = Float64Array;\n    data = multiframe.DoubleFloatPixelData;\n  }\n  if (data === undefined) {\n    log.error(\"This parametric map pixel data is undefined.\");\n  }\n  if (Array.isArray(data)) {\n    data = data[0];\n  }\n  return new TypedArrayClass(data);\n}\nfunction findReferenceSourceImageId(multiframe, frameSegment, imageIds, metadataProvider, tolerance, sopUIDImageIdIndexMap) {\n  var imageId = undefined;\n  if (!multiframe) {\n    return imageId;\n  }\n  var FrameOfReferenceUID = multiframe.FrameOfReferenceUID,\n    PerFrameFunctionalGroupsSequence = multiframe.PerFrameFunctionalGroupsSequence,\n    SourceImageSequence = multiframe.SourceImageSequence,\n    ReferencedSeriesSequence = multiframe.ReferencedSeriesSequence;\n  if (!PerFrameFunctionalGroupsSequence || PerFrameFunctionalGroupsSequence.length === 0) {\n    return imageId;\n  }\n  var PerFrameFunctionalGroup = PerFrameFunctionalGroupsSequence[frameSegment];\n  if (!PerFrameFunctionalGroup) {\n    return imageId;\n  }\n  var frameSourceImageSequence = undefined;\n  if (PerFrameFunctionalGroup.DerivationImageSequence) {\n    var DerivationImageSequence = PerFrameFunctionalGroup.DerivationImageSequence;\n    if (Array.isArray(DerivationImageSequence)) {\n      if (DerivationImageSequence.length !== 0) {\n        DerivationImageSequence = DerivationImageSequence[0];\n      } else {\n        DerivationImageSequence = undefined;\n      }\n    }\n    if (DerivationImageSequence) {\n      frameSourceImageSequence = DerivationImageSequence.SourceImageSequence;\n      if (Array.isArray(frameSourceImageSequence)) {\n        if (frameSourceImageSequence.length !== 0) {\n          frameSourceImageSequence = frameSourceImageSequence[0];\n        } else {\n          frameSourceImageSequence = undefined;\n        }\n      }\n    }\n  } else if (SourceImageSequence && SourceImageSequence.length !== 0) {\n    console.warn(\"DerivationImageSequence not present, using SourceImageSequence assuming SEG has the same geometry as the source image.\");\n    frameSourceImageSequence = SourceImageSequence[frameSegment];\n  }\n  if (frameSourceImageSequence) {\n    imageId = getImageIdOfSourceImageBySourceImageSequence(frameSourceImageSequence, sopUIDImageIdIndexMap);\n  }\n  if (imageId === undefined && ReferencedSeriesSequence) {\n    var referencedSeriesSequence = Array.isArray(ReferencedSeriesSequence) ? ReferencedSeriesSequence[0] : ReferencedSeriesSequence;\n    var ReferencedSeriesInstanceUID = referencedSeriesSequence.SeriesInstanceUID;\n    imageId = getImageIdOfSourceImagebyGeometry(ReferencedSeriesInstanceUID, FrameOfReferenceUID, PerFrameFunctionalGroup, imageIds, metadataProvider, tolerance);\n  }\n  return imageId;\n}\nfunction getImageIdOfSourceImageBySourceImageSequence(SourceImageSequence, sopUIDImageIdIndexMap) {\n  var ReferencedSOPInstanceUID = SourceImageSequence.ReferencedSOPInstanceUID,\n    ReferencedFrameNumber = SourceImageSequence.ReferencedFrameNumber;\n  return ReferencedFrameNumber ? getImageIdOfReferencedFrame(ReferencedSOPInstanceUID, ReferencedFrameNumber, sopUIDImageIdIndexMap) : sopUIDImageIdIndexMap[ReferencedSOPInstanceUID];\n}\nfunction getImageIdOfSourceImagebyGeometry(ReferencedSeriesInstanceUID, FrameOfReferenceUID, PerFrameFunctionalGroup, imageIds, metadataProvider, tolerance) {\n  if (ReferencedSeriesInstanceUID === undefined || PerFrameFunctionalGroup.PlanePositionSequence === undefined || PerFrameFunctionalGroup.PlanePositionSequence[0] === undefined || PerFrameFunctionalGroup.PlanePositionSequence[0].ImagePositionPatient === undefined) {\n    return undefined;\n  }\n  for (var imageIdsIndex = 0; imageIdsIndex < imageIds.length; ++imageIdsIndex) {\n    var sourceImageMetadata = metadataProvider.get(\"instance\", imageIds[imageIdsIndex]);\n    if (sourceImageMetadata === undefined || sourceImageMetadata.ImagePositionPatient === undefined || sourceImageMetadata.FrameOfReferenceUID !== FrameOfReferenceUID || sourceImageMetadata.SeriesInstanceUID !== ReferencedSeriesInstanceUID) {\n      continue;\n    }\n    if (compareArrays(PerFrameFunctionalGroup.PlanePositionSequence[0].ImagePositionPatient, sourceImageMetadata.ImagePositionPatient, tolerance)) {\n      return imageIds[imageIdsIndex];\n    }\n  }\n}\nfunction getImageIdOfReferencedFrame(sopInstanceUid, frameNumber, sopUIDImageIdIndexMap) {\n  var imageId = sopUIDImageIdIndexMap[sopInstanceUid];\n  if (!imageId) {\n    return;\n  }\n  var imageIdFrameNumber = Number(imageId.split(\"frame=\")[1]);\n  return imageIdFrameNumber === frameNumber - 1 ? imageId : undefined;\n}\nvar ParametricMapObj = {\n  generateToolState: generateToolState\n};\n\nexport { ParametricMapObj as ParametricMap, ParametricMapObj as default };\n","import { objectSpread2 as _objectSpread2, createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities, derivations, normalizers, data } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport { toArray } from '../helpers/toArray.js';\nimport { codeMeaningEquals } from '../helpers/codeMeaningEquals.js';\nimport '../helpers/downloadDICOMData.js';\nimport CodingScheme from './CodingScheme.js';\n\nvar _MeasurementReport;\nvar TID1500 = utilities.TID1500,\n  addAccessors = utilities.addAccessors;\nvar StructuredReport = derivations.StructuredReport;\nvar Normalizer = normalizers.Normalizer;\nvar TID1500MeasurementReport = TID1500.TID1500MeasurementReport,\n  TID1501MeasurementGroup = TID1500.TID1501MeasurementGroup;\nvar DicomMetaDictionary = data.DicomMetaDictionary;\nvar FINDING = {\n  CodingSchemeDesignator: \"DCM\",\n  CodeValue: \"121071\"\n};\nvar FINDING_SITE = {\n  CodingSchemeDesignator: \"SCT\",\n  CodeValue: \"363698007\"\n};\nvar FINDING_SITE_OLD = {\n  CodingSchemeDesignator: \"SRT\",\n  CodeValue: \"G-C0E3\"\n};\nvar codeValueMatch = function codeValueMatch(group, code, oldCode) {\n  var ConceptNameCodeSequence = group.ConceptNameCodeSequence;\n  if (!ConceptNameCodeSequence) {\n    return;\n  }\n  var CodingSchemeDesignator = ConceptNameCodeSequence.CodingSchemeDesignator,\n    CodeValue = ConceptNameCodeSequence.CodeValue;\n  return CodingSchemeDesignator == code.CodingSchemeDesignator && CodeValue == code.CodeValue || oldCode && CodingSchemeDesignator == oldCode.CodingSchemeDesignator && CodeValue == oldCode.CodeValue;\n};\nfunction getTID300ContentItem(tool, toolType, ReferencedSOPSequence, toolClass, worldToImageCoords) {\n  var args = toolClass.getTID300RepresentationArguments(tool, worldToImageCoords);\n  args.ReferencedSOPSequence = ReferencedSOPSequence;\n  var TID300Measurement = new toolClass.TID300Representation(args);\n  return TID300Measurement;\n}\nfunction getMeasurementGroup(toolType, toolData, ReferencedSOPSequence, worldToImageCoords) {\n  var toolTypeData = toolData[toolType];\n  var toolClass = MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[toolType];\n  if (!toolTypeData || !toolTypeData.data || !toolTypeData.data.length || !toolClass) {\n    return;\n  }\n  var Measurements = toolTypeData.data.map(function (tool) {\n    return getTID300ContentItem(tool, toolType, ReferencedSOPSequence, toolClass, worldToImageCoords);\n  });\n  return new TID1501MeasurementGroup(Measurements);\n}\nvar MeasurementReport = /*#__PURE__*/function () {\n  function MeasurementReport() {\n    _classCallCheck(this, MeasurementReport);\n  }\n  return _createClass(MeasurementReport, null, [{\n    key: \"getCornerstoneLabelFromDefaultState\",\n    value: function getCornerstoneLabelFromDefaultState(defaultState) {\n      var _defaultState$finding = defaultState.findingSites,\n        findingSites = _defaultState$finding === void 0 ? [] : _defaultState$finding,\n        finding = defaultState.finding;\n      var cornersoneFreeTextCodingValue = CodingScheme.codeValues.CORNERSTONEFREETEXT;\n      var freeTextLabel = findingSites.find(function (fs) {\n        return fs.CodeValue === cornersoneFreeTextCodingValue;\n      });\n      if (freeTextLabel) {\n        return freeTextLabel.CodeMeaning;\n      }\n      if (finding && finding.CodeValue === cornersoneFreeTextCodingValue) {\n        return finding.CodeMeaning;\n      }\n    }\n  }, {\n    key: \"generateDatasetMeta\",\n    value: function generateDatasetMeta() {\n      var fileMetaInformationVersionArray = new Uint8Array(2);\n      fileMetaInformationVersionArray[1] = 1;\n      var _meta = {\n        FileMetaInformationVersion: {\n          Value: [fileMetaInformationVersionArray.buffer],\n          vr: \"OB\"\n        },\n        TransferSyntaxUID: {\n          Value: [\"1.2.840.10008.1.2.1\"],\n          vr: \"UI\"\n        },\n        ImplementationClassUID: {\n          Value: [DicomMetaDictionary.uid()],\n          vr: \"UI\"\n        },\n        ImplementationVersionName: {\n          Value: [\"dcmjs\"],\n          vr: \"SH\"\n        }\n      };\n      return _meta;\n    }\n  }, {\n    key: \"getSetupMeasurementData\",\n    value: function getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, toolType) {\n      var ContentSequence = MeasurementGroup.ContentSequence;\n      var contentSequenceArr = toArray(ContentSequence);\n      var findingGroup = contentSequenceArr.find(function (group) {\n        return codeValueMatch(group, FINDING);\n      });\n      var findingSiteGroups = contentSequenceArr.filter(function (group) {\n        return codeValueMatch(group, FINDING_SITE, FINDING_SITE_OLD);\n      }) || [];\n      var NUMGroup = contentSequenceArr.find(function (group) {\n        return group.ValueType === \"NUM\";\n      });\n      var SCOORDGroup = toArray(NUMGroup.ContentSequence).find(function (group) {\n        return group.ValueType === \"SCOORD\";\n      });\n      var ReferencedSOPSequence = SCOORDGroup.ContentSequence.ReferencedSOPSequence;\n      var ReferencedSOPInstanceUID = ReferencedSOPSequence.ReferencedSOPInstanceUID,\n        ReferencedFrameNumber = ReferencedSOPSequence.ReferencedFrameNumber;\n      var referencedImageId = sopInstanceUIDToImageIdMap[ReferencedSOPInstanceUID];\n      var imagePlaneModule = metadata.get(\"imagePlaneModule\", referencedImageId);\n      var finding = findingGroup ? addAccessors(findingGroup.ConceptCodeSequence) : undefined;\n      var findingSites = findingSiteGroups.map(function (fsg) {\n        return addAccessors(fsg.ConceptCodeSequence);\n      });\n      var defaultState = {\n        description: undefined,\n        sopInstanceUid: ReferencedSOPInstanceUID,\n        annotation: {\n          annotationUID: DicomMetaDictionary.uid(),\n          metadata: {\n            toolName: toolType,\n            referencedImageId: referencedImageId,\n            FrameOfReferenceUID: imagePlaneModule.frameOfReferenceUID,\n            label: \"\"\n          },\n          data: undefined\n        },\n        finding: finding,\n        findingSites: findingSites\n      };\n      if (defaultState.finding) {\n        defaultState.description = defaultState.finding.CodeMeaning;\n      }\n      defaultState.annotation.metadata.label = MeasurementReport.getCornerstoneLabelFromDefaultState(defaultState);\n      return {\n        defaultState: defaultState,\n        NUMGroup: NUMGroup,\n        SCOORDGroup: SCOORDGroup,\n        ReferencedSOPSequence: ReferencedSOPSequence,\n        ReferencedSOPInstanceUID: ReferencedSOPInstanceUID,\n        ReferencedFrameNumber: ReferencedFrameNumber\n      };\n    }\n  }, {\n    key: \"generateReport\",\n    value: function generateReport(toolState, metadataProvider, worldToImageCoords, options) {\n      var allMeasurementGroups = [];\n      var sopInstanceUIDsToSeriesInstanceUIDMap = {};\n      var derivationSourceDatasets = [];\n      var _meta = MeasurementReport.generateDatasetMeta();\n      Object.keys(toolState).forEach(function (imageId) {\n        var sopCommonModule = metadataProvider.get(\"sopCommonModule\", imageId);\n        var instance = metadataProvider.get(\"instance\", imageId);\n        var sopInstanceUID = sopCommonModule.sopInstanceUID,\n          sopClassUID = sopCommonModule.sopClassUID;\n        var seriesInstanceUID = instance.SeriesInstanceUID;\n        sopInstanceUIDsToSeriesInstanceUIDMap[sopInstanceUID] = seriesInstanceUID;\n        if (!derivationSourceDatasets.find(function (dsd) {\n          return dsd.SeriesInstanceUID === seriesInstanceUID;\n        })) {\n          var derivationSourceDataset = MeasurementReport.generateDerivationSourceDataset(instance);\n          derivationSourceDatasets.push(derivationSourceDataset);\n        }\n        var frameNumber = metadataProvider.get(\"frameNumber\", imageId);\n        var toolData = toolState[imageId];\n        var toolTypes = Object.keys(toolData);\n        var ReferencedSOPSequence = {\n          ReferencedSOPClassUID: sopClassUID,\n          ReferencedSOPInstanceUID: sopInstanceUID,\n          ReferencedFrameNumber: undefined\n        };\n        if (instance && instance.NumberOfFrames && instance.NumberOfFrames > 1 || Normalizer.isMultiframeSOPClassUID(sopClassUID)) {\n          ReferencedSOPSequence.ReferencedFrameNumber = frameNumber;\n        }\n        var measurementGroups = [];\n        toolTypes.forEach(function (toolType) {\n          var group = getMeasurementGroup(toolType, toolData, ReferencedSOPSequence, worldToImageCoords);\n          if (group) {\n            measurementGroups.push(group);\n          }\n        });\n        allMeasurementGroups = allMeasurementGroups.concat(measurementGroups);\n      });\n      var tid1500MeasurementReport = new TID1500MeasurementReport({\n        TID1501MeasurementGroups: allMeasurementGroups\n      }, options);\n      var report = new StructuredReport(derivationSourceDatasets, options);\n      var contentItem = tid1500MeasurementReport.contentItem(derivationSourceDatasets, _objectSpread2(_objectSpread2({}, options), {}, {\n        sopInstanceUIDsToSeriesInstanceUIDMap: sopInstanceUIDsToSeriesInstanceUIDMap\n      }));\n      report.dataset = Object.assign(report.dataset, contentItem);\n      report.dataset._meta = _meta;\n      report.SpecificCharacterSet = \"ISO_IR 192\";\n      return report;\n    }\n  }, {\n    key: \"generateToolState\",\n    value: function generateToolState(dataset, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata, hooks) {\n      if (dataset.ContentTemplateSequence.TemplateIdentifier !== \"1500\") {\n        throw new Error(\"This package can currently only interpret DICOM SR TID 1500\");\n      }\n      var REPORT = \"Imaging Measurements\";\n      var GROUP = \"Measurement Group\";\n      var TRACKING_IDENTIFIER = \"Tracking Identifier\";\n      var TRACKING_UNIQUE_IDENTIFIER = \"Tracking Unique Identifier\";\n      var imagingMeasurementContent = toArray(dataset.ContentSequence).find(codeMeaningEquals(REPORT));\n      var measurementGroups = toArray(imagingMeasurementContent.ContentSequence).filter(codeMeaningEquals(GROUP));\n      var measurementData = {};\n      var cornerstoneToolClasses = MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE;\n      var registeredToolClasses = [];\n      Object.keys(cornerstoneToolClasses).forEach(function (key) {\n        registeredToolClasses.push(cornerstoneToolClasses[key]);\n        measurementData[key] = [];\n      });\n      measurementGroups.forEach(function (measurementGroup) {\n        try {\n          var _hooks$getToolClass;\n          var measurementGroupContentSequence = toArray(measurementGroup.ContentSequence);\n          var TrackingIdentifierGroup = measurementGroupContentSequence.find(function (contentItem) {\n            return contentItem.ConceptNameCodeSequence.CodeMeaning === TRACKING_IDENTIFIER;\n          });\n          var TrackingIdentifierValue = TrackingIdentifierGroup.TextValue;\n          var TrackingUniqueIdentifierGroup = measurementGroupContentSequence.find(function (contentItem) {\n            return contentItem.ConceptNameCodeSequence.CodeMeaning === TRACKING_UNIQUE_IDENTIFIER;\n          });\n          var TrackingUniqueIdentifierValue = TrackingUniqueIdentifierGroup === null || TrackingUniqueIdentifierGroup === void 0 ? void 0 : TrackingUniqueIdentifierGroup.UID;\n          var toolClass = (hooks === null || hooks === void 0 || (_hooks$getToolClass = hooks.getToolClass) === null || _hooks$getToolClass === void 0 ? void 0 : _hooks$getToolClass.call(hooks, measurementGroup, dataset, registeredToolClasses)) || registeredToolClasses.find(function (tc) {\n            return tc.isValidCornerstoneTrackingIdentifier(TrackingIdentifierValue);\n          });\n          if (toolClass) {\n            var measurement = toolClass.getMeasurementData(measurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata);\n            measurement.TrackingUniqueIdentifier = TrackingUniqueIdentifierValue;\n            console.log(\"=== \".concat(toolClass.toolType, \" ===\"));\n            console.log(measurement);\n            measurementData[toolClass.toolType].push(measurement);\n          }\n        } catch (e) {\n          console.warn(\"Unable to generate tool state for\", measurementGroup, e);\n        }\n      });\n      return measurementData;\n    }\n  }, {\n    key: \"registerTool\",\n    value: function registerTool(toolClass) {\n      MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[toolClass.utilityToolType] = toolClass;\n      MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[toolClass.toolType] = toolClass;\n      MeasurementReport.MEASUREMENT_BY_TOOLTYPE[toolClass.toolType] = toolClass.utilityToolType;\n    }\n  }]);\n}();\n_MeasurementReport = MeasurementReport;\n_MeasurementReport.CORNERSTONE_3D_TAG = CORNERSTONE_3D_TAG;\n_MeasurementReport.MEASUREMENT_BY_TOOLTYPE = {};\n_MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE = {};\n_MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE = {};\n_MeasurementReport.generateDerivationSourceDataset = function (instance) {\n  var _vrMap = {\n    PixelData: \"OW\"\n  };\n  var _meta = _MeasurementReport.generateDatasetMeta();\n  var derivationSourceDataset = _objectSpread2(_objectSpread2({}, instance), {}, {\n    _meta: _meta,\n    _vrMap: _vrMap\n  });\n  return derivationSourceDataset;\n};\n\nexport { MeasurementReport as default };\n","import MeasurementReport from './MeasurementReport.js';\nimport Length from './Length.js';\nimport FreehandRoi from './FreehandRoi.js';\nimport Bidirectional from './Bidirectional.js';\nimport EllipticalRoi from './EllipticalRoi.js';\nimport CircleRoi from './CircleRoi.js';\nimport ArrowAnnotate from './ArrowAnnotate.js';\nimport CobbAngle from './CobbAngle.js';\nimport Angle from './Angle.js';\nimport RectangleRoi from './RectangleRoi.js';\nimport * as Segmentation from './Segmentation.js';\nimport ParametricMapObj from './ParametricMap.js';\n\nvar CornerstoneSR = {\n  Length: Length,\n  FreehandRoi: FreehandRoi,\n  Bidirectional: Bidirectional,\n  EllipticalRoi: EllipticalRoi,\n  CircleRoi: CircleRoi,\n  ArrowAnnotate: ArrowAnnotate,\n  MeasurementReport: MeasurementReport,\n  CobbAngle: CobbAngle,\n  Angle: Angle,\n  RectangleRoi: RectangleRoi\n};\nvar CornerstoneSEG = {\n  Segmentation: Segmentation\n};\nvar CornerstonePMAP = {\n  ParametricMap: ParametricMapObj\n};\n\nexport { CornerstonePMAP, CornerstoneSEG, CornerstoneSR };\n","var CORNERSTONE_3D_TAG = \"Cornerstone3DTools@^0.1.0\";\n\nexport { CORNERSTONE_3D_TAG as default };\n","// This is a custom coding scheme defined to store some annotations from Cornerstone.\n// Note: CodeMeaning is VR type LO, which means we only actually support 64 characters\n// here this is fine for most labels, but may be problematic at some point.\nvar CORNERSTONEFREETEXT = \"CORNERSTONEFREETEXT\";\n\n// Cornerstone specified coding scheme for storing findings\nvar CodingSchemeDesignator = \"CORNERSTONEJS\";\nvar CodingScheme = {\n  CodingSchemeDesignator: CodingSchemeDesignator,\n  codeValues: {\n    CORNERSTONEFREETEXT: CORNERSTONEFREETEXT\n  }\n};\n\nexport { CodingScheme as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport MeasurementReport from './MeasurementReport.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport CodingScheme from './CodingScheme.js';\n\nvar TID300Point = utilities.TID300.Point;\nvar ARROW_ANNOTATE = \"ArrowAnnotate\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(ARROW_ANNOTATE);\nvar codeValues = CodingScheme.codeValues,\n  CodingSchemeDesignator = CodingScheme.CodingSchemeDesignator;\nvar ArrowAnnotate = /*#__PURE__*/function () {\n  function ArrowAnnotate() {\n    _classCallCheck(this, ArrowAnnotate);\n  }\n  return _createClass(ArrowAnnotate, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, ArrowAnnotate.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var text = defaultState.annotation.metadata.label;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n\n      // Since the arrowAnnotate measurement is just a point, to generate the tool state\n      // we derive the second point based on the image size relative to the first point.\n      if (worldCoords.length === 1) {\n        var imagePixelModule = metadata.get(\"imagePixelModule\", referencedImageId);\n        var xOffset = 10;\n        var yOffset = 10;\n        if (imagePixelModule) {\n          var columns = imagePixelModule.columns,\n            rows = imagePixelModule.rows;\n          xOffset = columns / 10;\n          yOffset = rows / 10;\n        }\n        var secondPoint = imageToWorldCoords(referencedImageId, [GraphicData[0] + xOffset, GraphicData[1] + yOffset]);\n        worldCoords.push(secondPoint);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        text: text,\n        handles: {\n          arrowFirst: true,\n          points: [worldCoords[0], worldCoords[1]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        metadata = tool.metadata;\n      var finding = tool.finding,\n        findingSites = tool.findingSites;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"ArrowAnnotate.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var _data$handles = data.handles,\n        points = _data$handles.points,\n        arrowFirst = _data$handles.arrowFirst;\n      var point;\n      var point2;\n      if (arrowFirst) {\n        point = points[0];\n        point2 = points[1];\n      } else {\n        point = points[1];\n        point2 = points[0];\n      }\n      var pointImage = worldToImageCoords(referencedImageId, point);\n      var pointImage2 = worldToImageCoords(referencedImageId, point2);\n      var TID300RepresentationArguments = {\n        points: [{\n          x: pointImage[0],\n          y: pointImage[1]\n        }, {\n          x: pointImage2[0],\n          y: pointImage2[1]\n        }],\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        findingSites: findingSites || []\n      };\n\n      // If freetext finding isn't present, add it from the tool text.\n      if (!finding || finding.CodeValue !== codeValues.CORNERSTONEFREETEXT) {\n        finding = {\n          CodeValue: codeValues.CORNERSTONEFREETEXT,\n          CodingSchemeDesignator: CodingSchemeDesignator,\n          CodeMeaning: data.text\n        };\n      }\n      TID300RepresentationArguments.finding = finding;\n      return TID300RepresentationArguments;\n    }\n  }]);\n}();\nArrowAnnotate.toolType = ARROW_ANNOTATE;\nArrowAnnotate.utilityToolType = ARROW_ANNOTATE;\nArrowAnnotate.TID300Representation = TID300Point;\nArrowAnnotate.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === ARROW_ANNOTATE;\n};\nMeasurementReport.registerTool(ArrowAnnotate);\n\nexport { ArrowAnnotate as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\nimport { toArray } from '../helpers/toArray.js';\nimport '../helpers/downloadDICOMData.js';\n\nvar _Bidirectional;\nvar TID300Bidirectional = utilities.TID300.Bidirectional;\nvar BIDIRECTIONAL = \"Bidirectional\";\nvar LONG_AXIS = \"Long Axis\";\nvar SHORT_AXIS = \"Short Axis\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(BIDIRECTIONAL);\nvar Bidirectional = /*#__PURE__*/function () {\n  function Bidirectional() {\n    _classCallCheck(this, Bidirectional);\n  }\n  return _createClass(Bidirectional, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, Bidirectional.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var ContentSequence = MeasurementGroup.ContentSequence;\n      var longAxisNUMGroup = toArray(ContentSequence).find(function (group) {\n        return group.ConceptNameCodeSequence.CodeMeaning === LONG_AXIS;\n      });\n      var longAxisSCOORDGroup = toArray(longAxisNUMGroup.ContentSequence).find(function (group) {\n        return group.ValueType === \"SCOORD\";\n      });\n      var shortAxisNUMGroup = toArray(ContentSequence).find(function (group) {\n        return group.ConceptNameCodeSequence.CodeMeaning === SHORT_AXIS;\n      });\n      var shortAxisSCOORDGroup = toArray(shortAxisNUMGroup.ContentSequence).find(function (group) {\n        return group.ValueType === \"SCOORD\";\n      });\n      var worldCoords = [];\n      [longAxisSCOORDGroup, shortAxisSCOORDGroup].forEach(function (group) {\n        var GraphicData = group.GraphicData;\n        for (var i = 0; i < GraphicData.length; i += 2) {\n          var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n          worldCoords.push(point);\n        }\n      });\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [worldCoords[0], worldCoords[1], worldCoords[2], worldCoords[3]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          length: longAxisNUMGroup.MeasuredValueSequence.NumericValue,\n          width: shortAxisNUMGroup.MeasuredValueSequence.NumericValue\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"Bidirectional.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var _ref = cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        length = _ref.length,\n        width = _ref.width;\n      var points = handles.points;\n      var firstPointPairs = [points[0], points[1]];\n      var secondPointPairs = [points[2], points[3]];\n      var firstPointPairsDistance = Math.sqrt(Math.pow(firstPointPairs[0][0] - firstPointPairs[1][0], 2) + Math.pow(firstPointPairs[0][1] - firstPointPairs[1][1], 2) + Math.pow(firstPointPairs[0][2] - firstPointPairs[1][2], 2));\n      var secondPointPairsDistance = Math.sqrt(Math.pow(secondPointPairs[0][0] - secondPointPairs[1][0], 2) + Math.pow(secondPointPairs[0][1] - secondPointPairs[1][1], 2) + Math.pow(secondPointPairs[0][2] - secondPointPairs[1][2], 2));\n      var shortAxisPoints;\n      var longAxisPoints;\n      if (firstPointPairsDistance > secondPointPairsDistance) {\n        shortAxisPoints = firstPointPairs;\n        longAxisPoints = secondPointPairs;\n      } else {\n        shortAxisPoints = secondPointPairs;\n        longAxisPoints = firstPointPairs;\n      }\n      var longAxisStartImage = worldToImageCoords(referencedImageId, shortAxisPoints[0]);\n      var longAxisEndImage = worldToImageCoords(referencedImageId, shortAxisPoints[1]);\n      var shortAxisStartImage = worldToImageCoords(referencedImageId, longAxisPoints[0]);\n      var shortAxisEndImage = worldToImageCoords(referencedImageId, longAxisPoints[1]);\n      return {\n        longAxis: {\n          point1: {\n            x: longAxisStartImage[0],\n            y: longAxisStartImage[1]\n          },\n          point2: {\n            x: longAxisEndImage[0],\n            y: longAxisEndImage[1]\n          }\n        },\n        shortAxis: {\n          point1: {\n            x: shortAxisStartImage[0],\n            y: shortAxisStartImage[1]\n          },\n          point2: {\n            x: shortAxisEndImage[0],\n            y: shortAxisEndImage[1]\n          }\n        },\n        longAxisLength: length,\n        shortAxisLength: width,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_Bidirectional = Bidirectional;\n_Bidirectional.toolType = BIDIRECTIONAL;\n_Bidirectional.utilityToolType = BIDIRECTIONAL;\n_Bidirectional.TID300Representation = TID300Bidirectional;\n_Bidirectional.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === BIDIRECTIONAL;\n};\nMeasurementReport.registerTool(Bidirectional);\n\nexport { Bidirectional as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\n\nvar _Angle;\nvar TID300CobbAngle = utilities.TID300.CobbAngle;\nvar MEASUREMENT_TYPE = \"Angle\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(MEASUREMENT_TYPE);\nvar Angle = /*#__PURE__*/function () {\n  function Angle() {\n    _classCallCheck(this, Angle);\n  }\n  return _createClass(Angle, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, Angle.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [worldCoords[0], worldCoords[1], worldCoords[3]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          angle: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : null\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"Angle.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var start1 = worldToImageCoords(referencedImageId, handles.points[0]);\n      var middle = worldToImageCoords(referencedImageId, handles.points[1]);\n      var end = worldToImageCoords(referencedImageId, handles.points[2]);\n      var point1 = {\n        x: start1[0],\n        y: start1[1]\n      };\n      var point2 = {\n        x: middle[0],\n        y: middle[1]\n      };\n      var point3 = point2;\n      var point4 = {\n        x: end[0],\n        y: end[1]\n      };\n      var _ref = cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        angle = _ref.angle;\n      return {\n        point1: point1,\n        point2: point2,\n        point3: point3,\n        point4: point4,\n        rAngle: angle,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_Angle = Angle;\n_Angle.toolType = MEASUREMENT_TYPE;\n_Angle.utilityToolType = MEASUREMENT_TYPE;\n_Angle.TID300Representation = TID300CobbAngle;\n_Angle.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === MEASUREMENT_TYPE;\n};\nMeasurementReport.registerTool(Angle);\n\nexport { Angle as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\n\nvar _CobbAngle;\nvar TID300CobbAngle = utilities.TID300.CobbAngle;\nvar MEASUREMENT_TYPE = \"CobbAngle\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(MEASUREMENT_TYPE);\nvar CobbAngle = /*#__PURE__*/function () {\n  function CobbAngle() {\n    _classCallCheck(this, CobbAngle);\n  }\n  return _createClass(CobbAngle, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, CobbAngle.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [worldCoords[0], worldCoords[1], worldCoords[2], worldCoords[3]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          angle: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : null\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var start1 = worldToImageCoords(referencedImageId, handles.points[0]);\n      var end1 = worldToImageCoords(referencedImageId, handles.points[1]);\n      var start2 = worldToImageCoords(referencedImageId, handles.points[2]);\n      var end2 = worldToImageCoords(referencedImageId, handles.points[3]);\n      var point1 = {\n        x: start1[0],\n        y: start1[1]\n      };\n      var point2 = {\n        x: end1[0],\n        y: end1[1]\n      };\n      var point3 = {\n        x: start2[0],\n        y: start2[1]\n      };\n      var point4 = {\n        x: end2[0],\n        y: end2[1]\n      };\n      var _ref = cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        angle = _ref.angle;\n      return {\n        point1: point1,\n        point2: point2,\n        point3: point3,\n        point4: point4,\n        rAngle: angle,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_CobbAngle = CobbAngle;\n_CobbAngle.toolType = MEASUREMENT_TYPE;\n_CobbAngle.utilityToolType = MEASUREMENT_TYPE;\n_CobbAngle.TID300Representation = TID300CobbAngle;\n_CobbAngle.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === MEASUREMENT_TYPE;\n};\nMeasurementReport.registerTool(CobbAngle);\n\nexport { CobbAngle as default };\n","import { createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport MeasurementReport from './MeasurementReport.js';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport isValidCornerstoneTrackingIdentifier from './isValidCornerstoneTrackingIdentifier.js';\n\nvar _CircleROI;\nvar TID300Circle = utilities.TID300.Circle;\nvar CIRCLEROI = \"CircleROI\";\nvar CircleROI = /*#__PURE__*/function () {\n  function CircleROI() {\n    _classCallCheck(this, CircleROI);\n  }\n  return _createClass(CircleROI, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, CircleROI.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var pointsWorld = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var worldPos = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        pointsWorld.push(worldPos);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [].concat(pointsWorld),\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0,\n          radius: 0,\n          perimeter: 0\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"CircleROI.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var center = worldToImageCoords(referencedImageId, handles.points[0]);\n      var end = worldToImageCoords(referencedImageId, handles.points[1]);\n      var points = [];\n      points.push({\n        x: center[0],\n        y: center[1]\n      });\n      points.push({\n        x: end[0],\n        y: end[1]\n      });\n      var _ref = cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        area = _ref.area,\n        radius = _ref.radius;\n      var perimeter = 2 * Math.PI * radius;\n      return {\n        area: area,\n        perimeter: perimeter,\n        radius: radius,\n        points: points,\n        trackingIdentifierTextValue: this.trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_CircleROI = CircleROI;\n_CircleROI.trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(CIRCLEROI);\n_CircleROI.toolType = CIRCLEROI;\n_CircleROI.utilityToolType = CIRCLEROI;\n_CircleROI.TID300Representation = TID300Circle;\n_CircleROI.isValidCornerstoneTrackingIdentifier = isValidCornerstoneTrackingIdentifier;\nMeasurementReport.registerTool(CircleROI);\n\nexport { CircleROI as default };\n","import { slicedToArray as _slicedToArray } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\n\nfunction isValidCornerstoneTrackingIdentifier(trackingIdentifier) {\n  if (!trackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _trackingIdentifier$s = trackingIdentifier.split(\":\"),\n    _trackingIdentifier$s2 = _slicedToArray(_trackingIdentifier$s, 2),\n    cornerstone3DTag = _trackingIdentifier$s2[0],\n    toolType = _trackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType.toLowerCase() === this.toolType.toLowerCase();\n}\n\nexport { isValidCornerstoneTrackingIdentifier as default };\n","import { createClass as _createClass, toConsumableArray as _toConsumableArray, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { vec3 } from 'gl-matrix';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\nimport isValidCornerstoneTrackingIdentifier from './isValidCornerstoneTrackingIdentifier.js';\n\nvar _EllipticalROI;\nvar TID300Ellipse = utilities.TID300.Ellipse;\nvar ELLIPTICALROI = \"EllipticalROI\";\nvar EPSILON = 1e-4;\nvar EllipticalROI = /*#__PURE__*/function () {\n  function EllipticalROI() {\n    _classCallCheck(this, EllipticalROI);\n  }\n  return _createClass(EllipticalROI, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, EllipticalROI.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var pointsWorld = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var worldPos = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        pointsWorld.push(worldPos);\n      }\n      var majorAxisStart = vec3.fromValues.apply(vec3, _toConsumableArray(pointsWorld[0]));\n      var majorAxisEnd = vec3.fromValues.apply(vec3, _toConsumableArray(pointsWorld[1]));\n      var minorAxisStart = vec3.fromValues.apply(vec3, _toConsumableArray(pointsWorld[2]));\n      var minorAxisEnd = vec3.fromValues.apply(vec3, _toConsumableArray(pointsWorld[3]));\n      var majorAxisVec = vec3.create();\n      vec3.sub(majorAxisVec, majorAxisEnd, majorAxisStart);\n      vec3.normalize(majorAxisVec, majorAxisVec);\n      var minorAxisVec = vec3.create();\n      vec3.sub(minorAxisVec, minorAxisEnd, minorAxisStart);\n      vec3.normalize(minorAxisVec, minorAxisVec);\n      var imagePlaneModule = metadata.get(\"imagePlaneModule\", referencedImageId);\n      if (!imagePlaneModule) {\n        throw new Error(\"imageId does not have imagePlaneModule metadata\");\n      }\n      var columnCosines = imagePlaneModule.columnCosines;\n      var columnCosinesVec = vec3.fromValues(columnCosines[0], columnCosines[1], columnCosines[2]);\n      var projectedMajorAxisOnColVec = vec3.dot(columnCosinesVec, majorAxisVec);\n      var projectedMinorAxisOnColVec = vec3.dot(columnCosinesVec, minorAxisVec);\n      var absoluteOfMajorDotProduct = Math.abs(projectedMajorAxisOnColVec);\n      var absoluteOfMinorDotProduct = Math.abs(projectedMinorAxisOnColVec);\n      var ellipsePoints = [];\n      if (Math.abs(absoluteOfMajorDotProduct - 1) < EPSILON) {\n        ellipsePoints = [pointsWorld[0], pointsWorld[1], pointsWorld[2], pointsWorld[3]];\n      } else if (Math.abs(absoluteOfMinorDotProduct - 1) < EPSILON) {\n        ellipsePoints = [pointsWorld[2], pointsWorld[3], pointsWorld[0], pointsWorld[1]];\n      } else {\n        console.warn(\"OBLIQUE ELLIPSE NOT YET SUPPORTED\");\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: _toConsumableArray(ellipsePoints),\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var rotation = data.initialRotation || 0;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"EllipticalROI.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var top, bottom, left, right;\n      if (rotation == 90 || rotation == 270) {\n        bottom = worldToImageCoords(referencedImageId, handles.points[2]);\n        top = worldToImageCoords(referencedImageId, handles.points[3]);\n        left = worldToImageCoords(referencedImageId, handles.points[0]);\n        right = worldToImageCoords(referencedImageId, handles.points[1]);\n      } else {\n        top = worldToImageCoords(referencedImageId, handles.points[0]);\n        bottom = worldToImageCoords(referencedImageId, handles.points[1]);\n        left = worldToImageCoords(referencedImageId, handles.points[2]);\n        right = worldToImageCoords(referencedImageId, handles.points[3]);\n      }\n      var topBottomLength = Math.abs(top[1] - bottom[1]);\n      var leftRightLength = Math.abs(left[0] - right[0]);\n      var points = [];\n      if (topBottomLength > leftRightLength) {\n        points.push({\n          x: top[0],\n          y: top[1]\n        });\n        points.push({\n          x: bottom[0],\n          y: bottom[1]\n        });\n        points.push({\n          x: left[0],\n          y: left[1]\n        });\n        points.push({\n          x: right[0],\n          y: right[1]\n        });\n      } else {\n        points.push({\n          x: left[0],\n          y: left[1]\n        });\n        points.push({\n          x: right[0],\n          y: right[1]\n        });\n        points.push({\n          x: top[0],\n          y: top[1]\n        });\n        points.push({\n          x: bottom[0],\n          y: bottom[1]\n        });\n      }\n      var _ref = cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        area = _ref.area;\n      return {\n        area: area,\n        points: points,\n        trackingIdentifierTextValue: this.trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_EllipticalROI = EllipticalROI;\n_EllipticalROI.trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(ELLIPTICALROI);\n_EllipticalROI.toolType = ELLIPTICALROI;\n_EllipticalROI.utilityToolType = ELLIPTICALROI;\n_EllipticalROI.TID300Representation = TID300Ellipse;\n_EllipticalROI.isValidCornerstoneTrackingIdentifier = isValidCornerstoneTrackingIdentifier;\nMeasurementReport.registerTool(EllipticalROI);\n\nexport { EllipticalROI as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\n\nvar _RectangleROI;\nvar TID300Polyline = utilities.TID300.Polyline;\nvar TOOLTYPE = \"RectangleROI\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(TOOLTYPE);\nvar RectangleROI = /*#__PURE__*/function () {\n  function RectangleROI() {\n    _classCallCheck(this, RectangleROI);\n  }\n  return _createClass(RectangleROI, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, RectangleROI.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [worldCoords[0], worldCoords[1], worldCoords[3], worldCoords[2]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : null\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var corners = handles.points.map(function (point) {\n        return worldToImageCoords(referencedImageId, point);\n      });\n      var area = cachedStats.area,\n        perimeter = cachedStats.perimeter;\n      return {\n        points: [corners[0], corners[1], corners[3], corners[2], corners[0]],\n        area: area,\n        perimeter: perimeter,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_RectangleROI = RectangleROI;\n_RectangleROI.toolType = TOOLTYPE;\n_RectangleROI.utilityToolType = TOOLTYPE;\n_RectangleROI.TID300Representation = TID300Polyline;\n_RectangleROI.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === TOOLTYPE;\n};\nMeasurementReport.registerTool(RectangleROI);\n\nexport { RectangleROI as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\n\nvar TID300Length = utilities.TID300.Length;\nvar LENGTH = \"Length\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(LENGTH);\nvar Length = /*#__PURE__*/function () {\n  function Length() {\n    _classCallCheck(this, Length);\n  }\n  return _createClass(Length, null, [{\n    key: \"getMeasurementData\",\n    value:\n    // TODO: this function is required for all Cornerstone Tool Adapters, since it is called by MeasurementReport.\n    function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, Length.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [worldCoords[0], worldCoords[1]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          length: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : 0\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$cachedStats = data.cachedStats,\n        cachedStats = _data$cachedStats === void 0 ? {} : _data$cachedStats,\n        handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"Length.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var start = worldToImageCoords(referencedImageId, handles.points[0]);\n      var end = worldToImageCoords(referencedImageId, handles.points[1]);\n      var point1 = {\n        x: start[0],\n        y: start[1]\n      };\n      var point2 = {\n        x: end[0],\n        y: end[1]\n      };\n      var _ref = cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        distance = _ref.length;\n      return {\n        point1: point1,\n        point2: point2,\n        distance: distance,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\nLength.toolType = LENGTH;\nLength.utilityToolType = LENGTH;\nLength.TID300Representation = TID300Length;\nLength.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === LENGTH;\n};\nMeasurementReport.registerTool(Length);\n\nexport { Length as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, defineProperty as _defineProperty, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport MeasurementReport from './MeasurementReport.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport { vec3 } from 'gl-matrix';\n\nvar _PlanarFreehandROI;\nvar TID300Polyline = utilities.TID300.Polyline;\nvar PLANARFREEHANDROI = \"PlanarFreehandROI\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(PLANARFREEHANDROI);\nvar closedContourThreshold = 1e-5;\nvar PlanarFreehandROI = /*#__PURE__*/function () {\n  function PlanarFreehandROI() {\n    _classCallCheck(this, PlanarFreehandROI);\n  }\n  return _createClass(PlanarFreehandROI, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, PlanarFreehandROI.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        NUMGroup = _MeasurementReport$ge.NUMGroup,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var distanceBetweenFirstAndLastPoint = vec3.distance(worldCoords[worldCoords.length - 1], worldCoords[0]);\n      var isOpenContour = true;\n      if (distanceBetweenFirstAndLastPoint < closedContourThreshold) {\n        worldCoords.pop();\n        isOpenContour = false;\n      }\n      var points = [];\n      if (isOpenContour) {\n        points.push(worldCoords[0], worldCoords[worldCoords.length - 1]);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        contour: {\n          polyline: worldCoords,\n          closed: !isOpenContour\n        },\n        handles: {\n          points: points,\n          activeHandleIndex: null,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: _defineProperty({}, \"imageId:\".concat(referencedImageId), {\n          area: NUMGroup ? NUMGroup.MeasuredValueSequence.NumericValue : null\n        }),\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var _data$contour = data.contour,\n        polyline = _data$contour.polyline,\n        closed = _data$contour.closed;\n      var isOpenContour = closed !== true;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"PlanarFreehandROI.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var points = polyline.map(function (worldPos) {\n        return worldToImageCoords(referencedImageId, worldPos);\n      });\n      if (!isOpenContour) {\n        var firstPoint = points[0];\n        points.push([firstPoint[0], firstPoint[1]]);\n      }\n      var _ref = data.cachedStats[\"imageId:\".concat(referencedImageId)] || {},\n        area = _ref.area,\n        areaUnit = _ref.areaUnit,\n        modalityUnit = _ref.modalityUnit,\n        perimeter = _ref.perimeter,\n        mean = _ref.mean,\n        max = _ref.max,\n        stdDev = _ref.stdDev;\n      return {\n        points: points,\n        area: area,\n        areaUnit: areaUnit,\n        perimeter: perimeter,\n        modalityUnit: modalityUnit,\n        mean: mean,\n        max: max,\n        stdDev: stdDev,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_PlanarFreehandROI = PlanarFreehandROI;\n_PlanarFreehandROI.toolType = PLANARFREEHANDROI;\n_PlanarFreehandROI.utilityToolType = PLANARFREEHANDROI;\n_PlanarFreehandROI.TID300Representation = TID300Polyline;\n_PlanarFreehandROI.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === PLANARFREEHANDROI;\n};\nMeasurementReport.registerTool(PlanarFreehandROI);\n\nexport { PlanarFreehandROI as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\n\nvar TID300Point = utilities.TID300.Point;\nvar PROBE = \"Probe\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(PROBE);\nvar Probe = /*#__PURE__*/function () {\n  function Probe() {\n    _classCallCheck(this, Probe);\n  }\n  return _createClass(Probe, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, Probe.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: worldCoords,\n          activeHandleIndex: null,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        metadata = tool.metadata;\n      var finding = tool.finding,\n        findingSites = tool.findingSites;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"Probe.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var points = data.handles.points;\n      var pointsImage = points.map(function (point) {\n        var pointImage = worldToImageCoords(referencedImageId, point);\n        return {\n          x: pointImage[0],\n          y: pointImage[1]\n        };\n      });\n      var TID300RepresentationArguments = {\n        points: pointsImage,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        findingSites: findingSites || [],\n        finding: finding\n      };\n      return TID300RepresentationArguments;\n    }\n  }]);\n}();\nProbe.toolType = PROBE;\nProbe.utilityToolType = PROBE;\nProbe.TID300Representation = TID300Point;\nProbe.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === PROBE;\n};\nMeasurementReport.registerTool(Probe);\n\nexport { Probe as default };\n","import { slicedToArray as _slicedToArray, createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from 'dcmjs';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport MeasurementReport from './MeasurementReport.js';\n\nvar _UltrasoundDirectional;\nvar TID300Length = utilities.TID300.Length;\nvar ULTRASOUND_DIRECTIONAL = \"UltrasoundDirectionalTool\";\nvar trackingIdentifierTextValue = \"\".concat(CORNERSTONE_3D_TAG, \":\").concat(ULTRASOUND_DIRECTIONAL);\nvar UltrasoundDirectional = /*#__PURE__*/function () {\n  function UltrasoundDirectional() {\n    _classCallCheck(this, UltrasoundDirectional);\n  }\n  return _createClass(UltrasoundDirectional, null, [{\n    key: \"getMeasurementData\",\n    value: function getMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, imageToWorldCoords, metadata) {\n      var _MeasurementReport$ge = MeasurementReport.getSetupMeasurementData(MeasurementGroup, sopInstanceUIDToImageIdMap, metadata, UltrasoundDirectional.toolType),\n        defaultState = _MeasurementReport$ge.defaultState,\n        SCOORDGroup = _MeasurementReport$ge.SCOORDGroup,\n        ReferencedFrameNumber = _MeasurementReport$ge.ReferencedFrameNumber;\n      var referencedImageId = defaultState.annotation.metadata.referencedImageId;\n      var GraphicData = SCOORDGroup.GraphicData;\n      var worldCoords = [];\n      for (var i = 0; i < GraphicData.length; i += 2) {\n        var point = imageToWorldCoords(referencedImageId, [GraphicData[i], GraphicData[i + 1]]);\n        worldCoords.push(point);\n      }\n      var state = defaultState;\n      state.annotation.data = {\n        handles: {\n          points: [worldCoords[0], worldCoords[1]],\n          activeHandleIndex: 0,\n          textBox: {\n            hasMoved: false\n          }\n        },\n        cachedStats: {},\n        frameNumber: ReferencedFrameNumber\n      };\n      return state;\n    }\n  }, {\n    key: \"getTID300RepresentationArguments\",\n    value: function getTID300RepresentationArguments(tool, worldToImageCoords) {\n      var data = tool.data,\n        finding = tool.finding,\n        findingSites = tool.findingSites,\n        metadata = tool.metadata;\n      var handles = data.handles;\n      var referencedImageId = metadata.referencedImageId;\n      if (!referencedImageId) {\n        throw new Error(\"UltrasoundDirectionalTool.getTID300RepresentationArguments: referencedImageId is not defined\");\n      }\n      var start = worldToImageCoords(referencedImageId, handles.points[0]);\n      var end = worldToImageCoords(referencedImageId, handles.points[1]);\n      var point1 = {\n        x: start[0],\n        y: start[1]\n      };\n      var point2 = {\n        x: end[0],\n        y: end[1]\n      };\n      return {\n        point1: point1,\n        point2: point2,\n        trackingIdentifierTextValue: trackingIdentifierTextValue,\n        finding: finding,\n        findingSites: findingSites || []\n      };\n    }\n  }]);\n}();\n_UltrasoundDirectional = UltrasoundDirectional;\n_UltrasoundDirectional.toolType = ULTRASOUND_DIRECTIONAL;\n_UltrasoundDirectional.utilityToolType = ULTRASOUND_DIRECTIONAL;\n_UltrasoundDirectional.TID300Representation = TID300Length;\n_UltrasoundDirectional.isValidCornerstoneTrackingIdentifier = function (TrackingIdentifier) {\n  if (!TrackingIdentifier.includes(\":\")) {\n    return false;\n  }\n  var _TrackingIdentifier$s = TrackingIdentifier.split(\":\"),\n    _TrackingIdentifier$s2 = _slicedToArray(_TrackingIdentifier$s, 2),\n    cornerstone3DTag = _TrackingIdentifier$s2[0],\n    toolType = _TrackingIdentifier$s2[1];\n  if (cornerstone3DTag !== CORNERSTONE_3D_TAG) {\n    return false;\n  }\n  return toolType === ULTRASOUND_DIRECTIONAL;\n};\nMeasurementReport.registerTool(UltrasoundDirectional);\n\nexport { UltrasoundDirectional as default };\n","import { objectSpread2 as _objectSpread2 } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport { normalizers, derivations } from 'dcmjs';\nimport { fillSegmentation } from '../../Cornerstone/Segmentation_4X.js';\n\nvar Normalizer = normalizers.Normalizer;\nvar SegmentationDerivation = derivations.Segmentation;\nfunction generateSegmentation(images, labelmaps, metadata) {\n  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  var segmentation = _createMultiframeSegmentationFromReferencedImages(images, metadata, options);\n  return fillSegmentation(segmentation, labelmaps, options);\n}\nfunction _createMultiframeSegmentationFromReferencedImages(images, metadata, options) {\n  var datasets = images.map(function (image) {\n    var instance = metadata.get(\"instance\", image.imageId);\n    return _objectSpread2(_objectSpread2(_objectSpread2({}, image), instance), {}, {\n      SOPClassUID: instance.SopClassUID || instance.SOPClassUID,\n      SOPInstanceUID: instance.SopInstanceUID || instance.SOPInstanceUID,\n      PixelData: image.voxelManager.getScalarData(),\n      _vrMap: {\n        PixelData: \"OW\"\n      },\n      _meta: {}\n    });\n  });\n  var multiframe = Normalizer.normalizeToDataset(datasets);\n  if (!multiframe) {\n    throw new Error(\"Failed to normalize the multiframe dataset, the data is not multi-frame.\");\n  }\n  return new SegmentationDerivation([multiframe], options);\n}\n\nexport { generateSegmentation };\n","function generateLabelMaps2DFrom3D(labelmap3D) {\n  var scalarData = labelmap3D.scalarData,\n    dimensions = labelmap3D.dimensions;\n  var labelmaps2D = [];\n  var segmentsOnLabelmap3D = new Set();\n  for (var z = 0; z < dimensions[2]; z++) {\n    var pixelData = scalarData.slice(z * dimensions[0] * dimensions[1], (z + 1) * dimensions[0] * dimensions[1]);\n    var segmentsOnLabelmap = [];\n    for (var i = 0; i < pixelData.length; i++) {\n      var segment = pixelData[i];\n      if (!segmentsOnLabelmap.includes(segment) && segment !== 0) {\n        segmentsOnLabelmap.push(segment);\n      }\n    }\n    var labelmap2D = {\n      segmentsOnLabelmap: segmentsOnLabelmap,\n      pixelData: pixelData,\n      rows: dimensions[1],\n      columns: dimensions[0]\n    };\n    if (segmentsOnLabelmap.length === 0) {\n      continue;\n    }\n    segmentsOnLabelmap.forEach(function (segmentIndex) {\n      segmentsOnLabelmap3D.add(segmentIndex);\n    });\n    labelmaps2D[dimensions[2] - 1 - z] = labelmap2D;\n  }\n  labelmap3D.segmentsOnLabelmap = Array.from(segmentsOnLabelmap3D);\n  labelmap3D.labelmaps2D = labelmaps2D;\n  return labelmap3D;\n}\n\nexport { generateLabelMaps2DFrom3D };\n","import { generateToolState as generateToolState$1 } from '../../Cornerstone/Segmentation.js';\n\nfunction generateToolState(imageIds, arrayBuffer, metadataProvider) {\n  var skipOverlapping = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var tolerance = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1e-3;\n  return generateToolState$1(imageIds, arrayBuffer, metadataProvider, skipOverlapping, tolerance);\n}\n\nexport { generateToolState };\n","import { CornerstonePMAP } from '../../Cornerstone/index.js';\n\nvar ParametricMap = CornerstonePMAP.ParametricMap;\nvar generateToolStateCornerstone = ParametricMap.generateToolState;\nfunction generateToolState(imageIds, arrayBuffer, metadataProvider) {\n  var skipOverlapping = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var tolerance = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1e-3;\n  return generateToolStateCornerstone(imageIds, arrayBuffer, metadataProvider, skipOverlapping, tolerance);\n}\n\nexport { generateToolState };\n","import { toConsumableArray as _toConsumableArray } from '../../../../_virtual/_rollupPluginBabelHelpers.js';\n\nfunction getReferencedFrameOfReferenceSequence(metadata, metadataProvider, dataset) {\n  var imageId = metadata.referencedImageId,\n    FrameOfReferenceUID = metadata.FrameOfReferenceUID;\n  var instance = metadataProvider.get(\"instance\", imageId);\n  var SeriesInstanceUID = instance.SeriesInstanceUID;\n  var ReferencedSeriesSequence = dataset.ReferencedSeriesSequence;\n  return [{\n    FrameOfReferenceUID: FrameOfReferenceUID,\n    RTReferencedStudySequence: [{\n      ReferencedSOPClassUID: dataset.SOPClassUID,\n      ReferencedSOPInstanceUID: dataset.SOPInstanceUID,\n      RTReferencedSeriesSequence: [{\n        SeriesInstanceUID: SeriesInstanceUID,\n        ContourImageSequence: _toConsumableArray(ReferencedSeriesSequence[0].ReferencedInstanceSequence)\n      }]\n    }]\n  }];\n}\n\nexport { getReferencedFrameOfReferenceSequence as default };\n","function getReferencedSeriesSequence(metadata, _index, metadataProvider, DicomMetadataStore) {\n  // grab imageId from toolData\n  var imageId = metadata.referencedImageId;\n  var instance = metadataProvider.get(\"instance\", imageId);\n  var SeriesInstanceUID = instance.SeriesInstanceUID,\n    StudyInstanceUID = instance.StudyInstanceUID;\n  var ReferencedSeriesSequence = [];\n  if (SeriesInstanceUID) {\n    var series = DicomMetadataStore.getSeries(StudyInstanceUID, SeriesInstanceUID);\n    var ReferencedSeries = {\n      SeriesInstanceUID: SeriesInstanceUID,\n      ReferencedInstanceSequence: []\n    };\n    series.instances.forEach(function (instance) {\n      var SOPInstanceUID = instance.SOPInstanceUID,\n        SOPClassUID = instance.SOPClassUID;\n      ReferencedSeries.ReferencedInstanceSequence.push({\n        ReferencedSOPClassUID: SOPClassUID,\n        ReferencedSOPInstanceUID: SOPInstanceUID\n      });\n    });\n    ReferencedSeriesSequence.push(ReferencedSeries);\n  }\n  return ReferencedSeriesSequence;\n}\n\nexport { getReferencedSeriesSequence as default };\n","function getStructureSetModule(contour, index) {\n  var FrameOfReferenceUID = contour.metadata.FrameOfReferenceUID;\n  return {\n    ROINumber: index + 1,\n    ROIName: contour.name || \"Todo: name \".concat(index + 1),\n    ROIDescription: \"Todo: description \".concat(index + 1),\n    ROIGenerationAlgorithm: \"Todo: algorithm\",\n    ReferencedFrameOfReferenceUID: FrameOfReferenceUID\n  };\n}\n\nexport { getStructureSetModule as default };\n","import { objectSpread2 as _objectSpread2 } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport { utilities } from '@cornerstonejs/tools';\nimport dcmjs from 'dcmjs';\nimport getPatientModule from './utilities/getPatientModule.js';\nimport getReferencedFrameOfReferenceSequence from './utilities/getReferencedFrameOfReferenceSequence.js';\nimport getReferencedSeriesSequence from './utilities/getReferencedSeriesSequence.js';\nimport getRTROIObservationsSequence from './utilities/getRTROIObservationsSequence.js';\nimport getRTSeriesModule from './utilities/getRTSeriesModule.js';\nimport getStructureSetModule from './utilities/getStructureSetModule.js';\n\nvar _utilities$contours = utilities.contours,\n  generateContourSetsFromLabelmap = _utilities$contours.generateContourSetsFromLabelmap,\n  AnnotationToPointData = _utilities$contours.AnnotationToPointData;\nvar DicomMetaDictionary = dcmjs.data.DicomMetaDictionary;\nfunction generateRTSSFromSegmentations(segmentations, metadataProvider, DicomMetadataStore) {\n  var roiContours = [];\n  var contourSets = generateContourSetsFromLabelmap({\n    segmentations: segmentations\n  });\n  contourSets.forEach(function (contourSet, segIndex) {\n    if (contourSet) {\n      var contourSequence = [];\n      contourSet.sliceContours.forEach(function (sliceContour) {\n        var sopCommon = metadataProvider.get(\"sopCommonModule\", sliceContour.referencedImageId);\n        var ReferencedSOPClassUID = sopCommon.sopClassUID;\n        var ReferencedSOPInstanceUID = sopCommon.sopInstanceUID;\n        var ContourImageSequence = [{\n          ReferencedSOPClassUID: ReferencedSOPClassUID,\n          ReferencedSOPInstanceUID: ReferencedSOPInstanceUID\n        }];\n        var sliceContourPolyData = sliceContour.polyData;\n        sliceContour.contours.forEach(function (contour, index) {\n          var ContourGeometricType = contour.type;\n          var NumberOfContourPoints = contour.contourPoints.length;\n          var ContourData = [];\n          contour.contourPoints.forEach(function (point) {\n            var pointData = sliceContourPolyData.points[point];\n            pointData[0] = +pointData[0].toFixed(2);\n            pointData[1] = +pointData[1].toFixed(2);\n            pointData[2] = +pointData[2].toFixed(2);\n            ContourData.push(pointData[0]);\n            ContourData.push(pointData[1]);\n            ContourData.push(pointData[2]);\n          });\n          contourSequence.push({\n            ContourImageSequence: ContourImageSequence,\n            ContourGeometricType: ContourGeometricType,\n            NumberOfContourPoints: NumberOfContourPoints,\n            ContourNumber: index + 1,\n            ContourData: ContourData\n          });\n        });\n      });\n      var segLabel = contourSet.label || \"Segment \".concat(segIndex + 1);\n      var ROIContour = {\n        name: segLabel,\n        description: segLabel,\n        contourSequence: contourSequence,\n        color: contourSet.color,\n        metadata: contourSet.metadata\n      };\n      roiContours.push(ROIContour);\n    }\n  });\n  var rtMetadata = {\n    name: segmentations.label,\n    label: segmentations.label\n  };\n  var dataset = _initializeDataset(rtMetadata, roiContours[0].metadata, metadataProvider);\n  roiContours.forEach(function (contour, index) {\n    var roiContour = {\n      ROIDisplayColor: contour.color || [255, 0, 0],\n      ContourSequence: contour.contourSequence,\n      ReferencedROINumber: index + 1\n    };\n    dataset.StructureSetROISequence.push(getStructureSetModule(contour, index));\n    dataset.ROIContourSequence.push(roiContour);\n    dataset.ReferencedSeriesSequence = getReferencedSeriesSequence(contour.metadata, index, metadataProvider, DicomMetadataStore);\n    dataset.ReferencedFrameOfReferenceSequence = getReferencedFrameOfReferenceSequence(contour.metadata, metadataProvider, dataset);\n  });\n  var fileMetaInformationVersionArray = new Uint8Array(2);\n  fileMetaInformationVersionArray[1] = 1;\n  var _meta = {\n    FileMetaInformationVersion: {\n      Value: [fileMetaInformationVersionArray.buffer],\n      vr: \"OB\"\n    },\n    TransferSyntaxUID: {\n      Value: [\"1.2.840.10008.1.2.1\"],\n      vr: \"UI\"\n    },\n    ImplementationClassUID: {\n      Value: [DicomMetaDictionary.uid()],\n      vr: \"UI\"\n    },\n    ImplementationVersionName: {\n      Value: [\"dcmjs\"],\n      vr: \"SH\"\n    }\n  };\n  dataset._meta = _meta;\n  dataset.SpecificCharacterSet = \"ISO_IR 192\";\n  return dataset;\n}\nfunction generateRTSSFromAnnotations(annotations, metadataProvider, DicomMetadataStore) {\n  var rtMetadata = {\n    name: \"RTSS from Annotations\",\n    label: \"RTSS from Annotations\"\n  };\n  var dataset = _initializeDataset(rtMetadata, annotations[0].metadata, metadataProvider);\n  annotations.forEach(function (annotation, index) {\n    var ContourSequence = AnnotationToPointData.convert(annotation, index, metadataProvider);\n    dataset.StructureSetROISequence.push(getStructureSetModule(annotation, index));\n    dataset.ROIContourSequence.push(ContourSequence);\n    dataset.RTROIObservationsSequence.push(getRTROIObservationsSequence(annotation, index));\n    dataset.ReferencedSeriesSequence = getReferencedSeriesSequence(annotation.metadata, index, metadataProvider, DicomMetadataStore);\n    dataset.ReferencedFrameOfReferenceSequence = getReferencedFrameOfReferenceSequence(annotation.metadata, metadataProvider, dataset);\n  });\n  var fileMetaInformationVersionArray = new Uint8Array(2);\n  fileMetaInformationVersionArray[1] = 1;\n  var _meta = {\n    FileMetaInformationVersion: {\n      Value: [fileMetaInformationVersionArray.buffer],\n      vr: \"OB\"\n    },\n    TransferSyntaxUID: {\n      Value: [\"1.2.840.10008.1.2.1\"],\n      vr: \"UI\"\n    },\n    ImplementationClassUID: {\n      Value: [DicomMetaDictionary.uid()],\n      vr: \"UI\"\n    },\n    ImplementationVersionName: {\n      Value: [\"dcmjs\"],\n      vr: \"SH\"\n    }\n  };\n  dataset._meta = _meta;\n  dataset.SpecificCharacterSet = \"ISO_IR 192\";\n  return dataset;\n}\nfunction _initializeDataset(rtMetadata, imgMetadata, metadataProvider) {\n  var rtSOPInstanceUID = DicomMetaDictionary.uid();\n  var imageId = imgMetadata.referencedImageId,\n    FrameOfReferenceUID = imgMetadata.FrameOfReferenceUID;\n  var _metadataProvider$get = metadataProvider.get(\"generalSeriesModule\", imageId),\n    studyInstanceUID = _metadataProvider$get.studyInstanceUID;\n  var patientModule = getPatientModule(imageId, metadataProvider);\n  var rtSeriesModule = getRTSeriesModule(DicomMetaDictionary);\n  return _objectSpread2(_objectSpread2(_objectSpread2({\n    StructureSetROISequence: [],\n    ROIContourSequence: [],\n    RTROIObservationsSequence: [],\n    ReferencedSeriesSequence: [],\n    ReferencedFrameOfReferenceSequence: []\n  }, patientModule), rtSeriesModule), {}, {\n    StudyInstanceUID: studyInstanceUID,\n    SOPClassUID: \"1.2.840.10008.5.1.4.1.1.481.3\",\n    SOPInstanceUID: rtSOPInstanceUID,\n    Manufacturer: \"dcmjs\",\n    Modality: \"RTSTRUCT\",\n    FrameOfReferenceUID: FrameOfReferenceUID,\n    PositionReferenceIndicator: \"\",\n    StructureSetLabel: rtMetadata.label || \"\",\n    StructureSetName: rtMetadata.name || \"\",\n    ReferringPhysicianName: \"\",\n    OperatorsName: \"\",\n    StructureSetDate: DicomMetaDictionary.date(),\n    StructureSetTime: DicomMetaDictionary.time(),\n    _meta: null\n  });\n}\n\nexport { generateRTSSFromAnnotations, generateRTSSFromSegmentations };\n","function getRTROIObservationsSequence(toolData, index) {\n  return {\n    ObservationNumber: index + 1,\n    ReferencedROINumber: index + 1,\n    RTROIInterpretedType: \"Todo: type\",\n    ROIInterpreter: \"Todo: interpreter\"\n  };\n}\n\nexport { getRTROIObservationsSequence as default };\n","function getPatientModule(imageId, metadataProvider) {\n  var generalSeriesModule = metadataProvider.get(\"generalSeriesModule\", imageId);\n  var generalStudyModule = metadataProvider.get(\"generalStudyModule\", imageId);\n  var patientStudyModule = metadataProvider.get(\"patientStudyModule\", imageId);\n  var patientModule = metadataProvider.get(\"patientModule\", imageId);\n  var patientDemographicModule = metadataProvider.get(\"patientDemographicModule\", imageId);\n  return {\n    Modality: generalSeriesModule.modality,\n    PatientID: patientModule.patientId,\n    PatientName: patientModule.patientName,\n    PatientBirthDate: \"\",\n    PatientAge: patientStudyModule.patientAge,\n    PatientSex: patientDemographicModule.patientSex,\n    PatientWeight: patientStudyModule.patientWeight,\n    StudyDate: generalStudyModule.studyDate,\n    StudyTime: generalStudyModule.studyTime,\n    StudyID: \"ToDo\",\n    AccessionNumber: generalStudyModule.accessionNumber\n  };\n}\n\nexport { getPatientModule as default };\n","function getRTSeriesModule(DicomMetaDictionary) {\n  return {\n    SeriesInstanceUID: DicomMetaDictionary.uid(),\n    // generate a new series instance uid\n    SeriesNumber: \"99\" // Todo:: what should be the series number?\n  };\n}\n\nexport { getRTSeriesModule as default };\n","import { utilities } from '@cornerstonejs/tools';\nexport { generateRTSSFromAnnotations, generateRTSSFromSegmentations } from './RTSS.js';\n\nvar generateContourSetsFromLabelmap = utilities.contours.generateContourSetsFromLabelmap;\n\nexport { generateContourSetsFromLabelmap };\n","import MeasurementReport from './MeasurementReport.js';\nimport CodingScheme from './CodingScheme.js';\nimport CORNERSTONE_3D_TAG from './cornerstone3DTag.js';\nimport ArrowAnnotate from './ArrowAnnotate.js';\nimport Bidirectional from './Bidirectional.js';\nimport Angle from './Angle.js';\nimport CobbAngle from './CobbAngle.js';\nimport CircleROI from './CircleROI.js';\nimport EllipticalROI from './EllipticalROI.js';\nimport RectangleROI from './RectangleROI.js';\nimport Length from './Length.js';\nimport PlanarFreehandROI from './PlanarFreehandROI.js';\nimport Probe from './Probe.js';\nimport UltrasoundDirectional from './UltrasoundDirectional.js';\nimport * as index from './Segmentation/index.js';\nimport * as index$1 from './ParametricMap/index.js';\nimport * as index$2 from './RTStruct/index.js';\n\nvar Cornerstone3DSR = {\n  Bidirectional: Bidirectional,\n  CobbAngle: CobbAngle,\n  Angle: Angle,\n  Length: Length,\n  CircleROI: CircleROI,\n  EllipticalROI: EllipticalROI,\n  RectangleROI: RectangleROI,\n  ArrowAnnotate: ArrowAnnotate,\n  Probe: Probe,\n  PlanarFreehandROI: PlanarFreehandROI,\n  UltrasoundDirectional: UltrasoundDirectional,\n  MeasurementReport: MeasurementReport,\n  CodeScheme: CodingScheme,\n  CORNERSTONE_3D_TAG: CORNERSTONE_3D_TAG\n};\nvar Cornerstone3DSEG = {\n  Segmentation: index\n};\nvar Cornerstone3DPMAP = {\n  ParametricMap: index$1\n};\nvar Cornerstone3DRT = {\n  RTSS: index$2\n};\n\nexport { Cornerstone3DPMAP, Cornerstone3DRT, Cornerstone3DSEG, Cornerstone3DSR };\n","import { createClass as _createClass, classCallCheck as _classCallCheck } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport { data } from 'dcmjs';\n\nvar Colors = data.Colors,\n  BitArray = data.BitArray;\n\n// TODO: Is there a better name for this? RGBAInt?\n// Should we move it to Colors.js\nfunction dicomlab2RGBA(cielab) {\n  var rgba = Colors.dicomlab2RGB(cielab).map(function (x) {\n    return Math.round(x * 255);\n  });\n  rgba.push(255);\n  return rgba;\n}\n\n// TODO: Copied these functions in from VTK Math so we don't need a dependency.\n// I guess we should put them somewhere\n// https://github.com/Kitware/vtk-js/blob/master/Sources/Common/Core/Math/index.js\nfunction cross(x, y, out) {\n  var Zx = x[1] * y[2] - x[2] * y[1];\n  var Zy = x[2] * y[0] - x[0] * y[2];\n  var Zz = x[0] * y[1] - x[1] * y[0];\n  out[0] = Zx;\n  out[1] = Zy;\n  out[2] = Zz;\n}\nfunction norm(x) {\n  var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\n  switch (n) {\n    case 1:\n      return Math.abs(x);\n    case 2:\n      return Math.sqrt(x[0] * x[0] + x[1] * x[1]);\n    case 3:\n      return Math.sqrt(x[0] * x[0] + x[1] * x[1] + x[2] * x[2]);\n    default:\n      {\n        var sum = 0;\n        for (var i = 0; i < n; i++) {\n          sum += x[i] * x[i];\n        }\n        return Math.sqrt(sum);\n      }\n  }\n}\nfunction normalize(x) {\n  var den = norm(x);\n  if (den !== 0.0) {\n    x[0] /= den;\n    x[1] /= den;\n    x[2] /= den;\n  }\n  return den;\n}\nfunction subtract(a, b, out) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n}\n\n// TODO: This is a useful utility on its own. We should move it somewhere?\n// dcmjs.adapters.vtk.Multiframe? dcmjs.utils?\nfunction geometryFromFunctionalGroups(dataset, PerFrameFunctionalGroups) {\n  var geometry = {};\n  var pixelMeasures = dataset.SharedFunctionalGroupsSequence.PixelMeasuresSequence;\n  var planeOrientation = dataset.SharedFunctionalGroupsSequence.PlaneOrientationSequence;\n\n  // Find the origin of the volume from the PerFrameFunctionalGroups' ImagePositionPatient values\n  //\n  // TODO: assumes sorted frames. This should read the ImagePositionPatient from each frame and\n  // sort them to obtain the first and last position along the acquisition axis.\n  var firstFunctionalGroup = PerFrameFunctionalGroups[0];\n  var lastFunctionalGroup = PerFrameFunctionalGroups[PerFrameFunctionalGroups.length - 1];\n  var firstPosition = firstFunctionalGroup.PlanePositionSequence.ImagePositionPatient.map(Number);\n  var lastPosition = lastFunctionalGroup.PlanePositionSequence.ImagePositionPatient.map(Number);\n  geometry.origin = firstPosition;\n\n  // NB: DICOM PixelSpacing is defined as Row then Column,\n  // unlike ImageOrientationPatient\n  geometry.spacing = [pixelMeasures.PixelSpacing[1], pixelMeasures.PixelSpacing[0], pixelMeasures.SpacingBetweenSlices].map(Number);\n  geometry.dimensions = [dataset.Columns, dataset.Rows, PerFrameFunctionalGroups.length].map(Number);\n  var orientation = planeOrientation.ImageOrientationPatient.map(Number);\n  var columnStepToPatient = orientation.slice(0, 3);\n  var rowStepToPatient = orientation.slice(3, 6);\n  geometry.planeNormal = [];\n  cross(columnStepToPatient, rowStepToPatient, geometry.planeNormal);\n  geometry.sliceStep = [];\n  subtract(lastPosition, firstPosition, geometry.sliceStep);\n  normalize(geometry.sliceStep);\n  geometry.direction = columnStepToPatient.concat(rowStepToPatient).concat(geometry.sliceStep);\n  return geometry;\n}\nvar Segmentation = /*#__PURE__*/function () {\n  function Segmentation() {\n    _classCallCheck(this, Segmentation);\n  }\n\n  /**\r\n   * Produces an array of Segments from an input DICOM Segmentation dataset\r\n   *\r\n   * Segments are returned with Geometry values that can be used to create\r\n   * VTK Image Data objects.\r\n   *\r\n   * @example Example usage to create VTK Volume actors from each segment:\r\n   *\r\n   * const actors = [];\r\n   * const segments = generateToolState(dataset);\r\n   * segments.forEach(segment => {\r\n   *   // now make actors using the segment information\r\n   *   const scalarArray = vtk.Common.Core.vtkDataArray.newInstance({\r\n   *        name: \"Scalars\",\r\n   *        numberOfComponents: 1,\r\n   *        values: segment.pixelData,\r\n   *    });\r\n   *\r\n   *    const imageData = vtk.Common.DataModel.vtkImageData.newInstance();\r\n   *    imageData.getPointData().setScalars(scalarArray);\r\n   *    imageData.setDimensions(geometry.dimensions);\r\n   *    imageData.setSpacing(geometry.spacing);\r\n   *    imageData.setOrigin(geometry.origin);\r\n   *    imageData.setDirection(geometry.direction);\r\n   *\r\n   *    const mapper = vtk.Rendering.Core.vtkVolumeMapper.newInstance();\r\n   *    mapper.setInputData(imageData);\r\n   *    mapper.setSampleDistance(2.);\r\n   *\r\n   *    const actor = vtk.Rendering.Core.vtkVolume.newInstance();\r\n   *    actor.setMapper(mapper);\r\n   *\r\n   *    actors.push(actor);\r\n   * });\r\n   *\r\n   * @param dataset\r\n   * @return {{}}\r\n   */\n  return _createClass(Segmentation, null, [{\n    key: \"generateSegments\",\n    value: function generateSegments(dataset) {\n      if (dataset.SegmentSequence.constructor.name !== \"Array\") {\n        dataset.SegmentSequence = [dataset.SegmentSequence];\n      }\n      dataset.SegmentSequence.forEach(function (segment) {\n        // TODO: other interesting fields could be extracted from the segment\n        // TODO: Read SegmentsOverlay field\n        // http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.8.20.2.html\n\n        // TODO: Looks like vtkColor only wants RGB in 0-1 values.\n        // Why was this example converting to RGBA with 0-255 values?\n        var color = dicomlab2RGBA(segment.RecommendedDisplayCIELabValue);\n        segments[segment.SegmentNumber] = {\n          color: color,\n          functionalGroups: [],\n          offset: null,\n          size: null,\n          pixelData: null\n        };\n      });\n\n      // make a list of functional groups per segment\n      dataset.PerFrameFunctionalGroupsSequence.forEach(function (functionalGroup) {\n        var segmentNumber = functionalGroup.SegmentIdentificationSequence.ReferencedSegmentNumber;\n        segments[segmentNumber].functionalGroups.push(functionalGroup);\n      });\n\n      // determine per-segment index into the pixel data\n      // TODO: only handles one-bit-per pixel\n      var frameSize = Math.ceil(dataset.Rows * dataset.Columns / 8);\n      var nextOffset = 0;\n      Object.keys(segments).forEach(function (segmentNumber) {\n        var segment = segments[segmentNumber];\n        segment.numberOfFrames = segment.functionalGroups.length;\n        segment.size = segment.numberOfFrames * frameSize;\n        segment.offset = nextOffset;\n        nextOffset = segment.offset + segment.size;\n        var packedSegment = dataset.PixelData.slice(segment.offset, nextOffset);\n        segment.pixelData = BitArray.unpack(packedSegment);\n        var geometry = geometryFromFunctionalGroups(dataset, segment.functionalGroups);\n        segment.geometry = geometry;\n      });\n      return segments;\n    }\n  }]);\n}();\n\nexport { Segmentation as default };\n","import { CornerstoneSR, CornerstoneSEG, CornerstonePMAP } from './Cornerstone/index.js';\nimport { Cornerstone3DSR, Cornerstone3DSEG, Cornerstone3DPMAP, Cornerstone3DRT } from './Cornerstone3D/index.js';\nimport { VTKjsSEG } from './VTKjs/index.js';\nimport './enums/Events.js';\nimport './helpers/downloadDICOMData.js';\n\nvar adaptersSR = {\n  Cornerstone: CornerstoneSR,\n  Cornerstone3D: Cornerstone3DSR\n};\nvar adaptersSEG = {\n  Cornerstone: CornerstoneSEG,\n  Cornerstone3D: Cornerstone3DSEG,\n  VTKjs: VTKjsSEG\n};\nvar adaptersPMAP = {\n  Cornerstone: CornerstonePMAP,\n  Cornerstone3D: Cornerstone3DPMAP\n};\nvar adaptersRT = {\n  Cornerstone3D: Cornerstone3DRT\n};\n\nexport { adaptersPMAP, adaptersRT, adaptersSEG, adaptersSR };\n","import Segmentation from './Segmentation.js';\n\nvar VTKjsSEG = {\n  Segmentation: Segmentation\n};\n\nexport { VTKjsSEG };\n"],"names":["_arrayLikeToArray","r","a","length","e","n","Array","asyncGeneratorStep","t","o","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","this","arguments","apply","_next","_throw","_classCallCheck","TypeError","_defineProperties","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","_createForOfIteratorHelper","Symbol","iterator","isArray","_unsupportedIterableToArray","F","s","f","call","next","return","_defineProperty","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread2","forEach","getOwnPropertyDescriptors","defineProperties","_regenerator","toStringTag","Generator","create","_regeneratorDefine","p","y","G","v","d","bind","l","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","_invoke","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","from","_iterableToArray","_nonIterableSpread","toPrimitive","String","Number","_toPrimitive","toString","slice","constructor","name","test","toArray","x","codeMeaningEquals","codeMeaningName","contentItem","ConceptNameCodeSequence","CodeMeaning","datasetToDict","downloadDICOMData","bufferOrDataset","filename","blob","ArrayBuffer","Blob","type","_meta","Error","buffer","write","link","document","createElement","href","window","URL","createObjectURL","download","click","TID1500","addAccessors","StructuredReport","Normalizer","TID1500MeasurementReport","TID1501MeasurementGroup","DicomMetaDictionary","FINDING","CodingSchemeDesignator","CodeValue","FINDING_SITE","FINDING_SITE_OLD","codeValueMatch","group","code","oldCode","getMeasurementGroup","toolType","toolData","ReferencedSOPSequence","toolTypeData","toolClass","MeasurementReport","CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE","data","Measurements","map","tool","args","getTID300RepresentationArguments","TID300Representation","getTID300ContentItem","MeasurementGroup","ContentSequence","contentSequenceArr","findingGroup","find","findingSiteGroups","NUMGroup","ValueType","SCOORDGroup","ReferencedSOPInstanceUID","ReferencedFrameNumber","defaultState","sopInstanceUid","frameIndex","complete","finding","ConceptCodeSequence","undefined","findingSites","fsg","description","findingSite","location","toolState","metadataProvider","options","allMeasurementGroups","firstImageId","generalSeriesModule","get","studyInstanceUID","seriesInstanceUID","imageId","sopCommonModule","frameNumber","toolTypes","ReferencedSOPClassUID","sopClassUID","sopInstanceUID","isMultiframeSOPClassUID","measurementGroups","concat","_MeasurementReport","TID1501MeasurementGroups","fileMetaInformationVersionArray","Uint8Array","derivationSourceDataset","StudyInstanceUID","SeriesInstanceUID","FileMetaInformationVersion","Value","vr","TransferSyntaxUID","ImplementationClassUID","uid","ImplementationVersionName","_vrMap","PixelData","report","dataset","assign","SpecificCharacterSet","hooks","ContentTemplateSequence","TemplateIdentifier","imagingMeasurementContent","measurementData","cornerstoneToolClasses","CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE","registeredToolClasses","measurementGroup","TrackingIdentifierValue","TextValue","getToolClass","tc","isValidCornerstoneTrackingIdentifier","measurement","getMeasurementData","console","log","utilityToolType","MEASUREMENT_BY_TOOLTYPE","CORNERSTONE_4_TAG","TID300Length","TID300","Length","LENGTH","_MeasurementReport$ge","getSetupMeasurementData","state","MeasuredValueSequence","NumericValue","handles","start","end","textBox","hasMoved","movesIndependently","drawnIndependently","allowedOutsideImage","hasBoundingBox","_SCOORDGroup$GraphicD","GraphicData","point1","point2","distance","trackingIdentifierTextValue","TrackingIdentifier","includes","_TrackingIdentifier$s2","split","cornerstone4Tag","registerTool","TID300Polyline","Polyline","FreehandRoi","points","active","cachedStats","area","color","invalidated","_tool$cachedStats","_cachedStats$area","_cachedStats$perimete","perimeter","TID300Bidirectional","Bidirectional","BIDIRECTIONAL","longAxisNUMGroup","longAxisSCOORDGroup","shortAxisNUMGroup","shortAxisSCOORDGroup","longestDiameter","shortestDiameter","bottomRight","Math","max","highlight","index","perpendicularStart","perpendicularEnd","isCreating","toolName","visible","_tool$handles","longAxis","shortAxis","longAxisLength","shortAxisLength","TID300Ellipse","Ellipse","ELLIPTICALROI","EllipticalRoi","majorAxis","minorAxis","minorAxisLength","sqrt","pow","minorAxisDirection","halfMinorAxisLength","corner1","corner2","initialRotation","halfXLength","abs","halfYLength","center","TID300Circle","Circle","CIRCLEROI","CircleRoi","radius","PI","TID300Point","Point","ARROW_ANNOTATE","CORNERSTONEFREETEXT","ArrowAnnotate","text","TID300RepresentationArguments","TID300CobbAngle","CobbAngle","COBB_ANGLE","rAngle","start2","end2","point3","point4","TID300Angle","Angle","ANGLE","middle","RectangleRoi","DicomMessage","getDatasetsFromImages","images","isMultiframe","datasets","arrayBuffer","byteArray","dicomData","readFile","naturalizeDataset","dict","namifyDataset","meta","_arrayBuffer","_dicomData","_dataset","normalizeToDataset","_utilities$orientatio","orientation","rotateDirectionCosinesInPlane","flipIOP","flipImageOrientationPatient","flipMatrix2D","rotateMatrix902D","datasetToBlob","BitArray","SegmentationDerivation","Segmentation","generateSegmentation","brushData","includeSliceSpacing","segments","image0","dims","columns","rows","z","xy","_getSegCount","seg","multiframe","_createSegFromImages","_getNumberOfFramesPer","segmentIndicies","referencedFramesPerSegment","imageIdSpecificToolState","_i2","segIdx","brush","pixelData","_getNumberOfFramesPerSegment","NumberOfFrames","setNumberOfFrames","_i","segmentIndex","referencedFrameIndicies","referencedFrameNumbers","element","segment","addSegment","_extractCornerstoneToolsPixelData","bitPackPixelData","generateToolState","imageIds","imagePlaneModule","warn","validOrientations","iop","orientations","h","iop90","getValidOrientations","rowCosines","columnCosines","SharedFunctionalGroupsSequence","sharedImageOrientationPatient","PlaneOrientationSequence","ImageOrientationPatient","sliceLength","Columns","Rows","segMetadata","segmentSequence","SegmentSequence","seriesInstanceUid","ReferencedSeriesSequence","getSegmentMetadata","segType","SegmentationType","unpack","MaximumFractionalValue","onlyMaxAndZero","unpackPixelData","PerFrameFunctionalGroupsSequence","inPlane","PerFrameFunctionalGroups","ImageOrientationPatientI","alignedPixelDataI","alignPixelDataWithSourceData","SegmentIdentificationSequence","ReferencedSegmentNumber","addImageIdSpecificBrushToolState","getImageIdOfSourceImage","DerivationImageSequence","SourceImageSequence","referencedFrames","pixelDataIndex","brushPixelData","numSegments","pixelData2D","brushDataI","cToolsPixelData","imageIdFrameNumber","getImageIdOfReferencedFrame","getImageIdOfReferencedSingleFramedSOPInstance","compareIOP","dx","iop1","iop2","Events","nearlyEqual","compareArrays","array1","array2","tolerance","checkOrientation","sourceDataDimensions","some","operation","absDotColumnCosines","absDotRowCosines","checkIfPerpendicular","Events$1","_utilities$compressio","compression","encode","decode","generateSegmentationDefaultOptions","rleEncode","fillSegmentation","segmentation","inputLabelmaps3D","userOptions","labelmaps3D","numberOfFrames","referencedFramesPerLabelmap","_loop","labelmap3D","labelmapIndex","labelmaps2D","metadata","_loop2","labelmap2D","segmentsOnLabelmap","_labelmapIndex","segmentMetadata","labelmaps","_getLabelmapsFromReferencedFrameIndicies","addSegmentFromLabelmap","rleEncodedFrames","assignToDataset","BitsAllocated","BitsStored","HighBit","SegmentationFractionalType","frame","_generateToolState","_callee","_options$skipOverlapp","skipOverlapping","_options$tolerance","_options$TypedArrayCo","TypedArrayConstructor","_options$maxBytesPerC","maxBytesPerChunk","eventTarget","triggerEvent","pixelDataChunks","sopUIDImageIdIndexMap","overlapping","insertFunction","segmentsOnFrameArray","segmentsOnFrame","arrayBufferLength","labelmapBufferArray","imageIdMaps","segmentsPixelIndices","overlappingSegments","centroidXYZ","_t","_context","reduce","acc","checkSEGsOverlapping","insertOverlappingPixelDataPlanar","insertPixelDataPlanar","BYTES_PER_ELEMENT","curr","indices","Map","imageIdIndexBufferIndex","centroids","calculateCentroid","set","findReferenceSourceImageId","frameSegment","FrameOfReferenceUID","PerFrameFunctionalGroup","frameSourceImageSequence","getImageIdOfSourceImageBySourceImageSequence","ReferencedSeriesInstanceUID","PlanePositionSequence","ImagePositionPatient","imageIdsIndexc","sourceImageMetadata","getImageIdOfSourceImagebyGeometry","groupsLen","frameSegmentsMapping","_loop3","getSegmentIndex","imageIdIndex","findIndex","has","segmentArray","_step","_iterator","entries","role","temp2DArray","fill","_frameSegment","view","readFromUnpackedChunks","j","len","err","M","tempBuffer","tempSegmentsOnFrame","structuredClone","numberOfSegs","segmentIndexToProcess","_loop4","byteOffset","labelmap2DView","segmentOnFrame","chunkSize","ceil","shouldTriggerEvent","processInChunks","min","indexCache","segmentIndexObject","percentComplete","round","SEGMENTATION_LOAD_PROGRESS","setTimeout","error","bitArray","chunks","maxBitsPerChunk","numberOfChunks","startBit","endBit","startByte","floor","endByte","chunk","unpackedChunk","getUnpackedChunks","offset","mapping","totalBytes","total","startChunkIndex","startOffsetInChunk","endChunkIndex","endOffsetInChunk","chunkIndex","getUnpackedOffsetAndLength","result","resultOffset","xAcc","yAcc","zAcc","worldXAcc","worldYAcc","worldZAcc","count","_i3","_Object$entries","_Object$entries$_i","bufferIndices","_step2","imagePositionPatient","rowPixelSpacing","columnPixelSpacing","_iterator2","bufferIndex","worldX","worldY","worldZ","debug","image","world","_x","_x2","_x3","_x4","labelmaps3DorBrushData","cornerstoneToolsVersion","_args","getPixelData","Perpendicular","Oblique","sourcePixelData","targetPixelData","numSlices","sourceSliceDataView","TypedArrayClass","_multiframe$PixelRepr","Uint16Array","Int16Array","Uint32Array","Int32Array","PixelRepresentation","FloatPixelData","Float32Array","DoubleFloatPixelData","Float64Array","imageIdsIndex","CornerstoneSR","CornerstoneSEG","CornerstonePMAP","ParametricMap","CORNERSTONE_3D_TAG","CodingScheme","codeValues","_defaultState$finding","cornersoneFreeTextCodingValue","freeTextLabel","fs","sopInstanceUIDToImageIdMap","referencedImageId","annotation","annotationUID","frameOfReferenceUID","label","getCornerstoneLabelFromDefaultState","worldToImageCoords","sopInstanceUIDsToSeriesInstanceUIDMap","derivationSourceDatasets","generateDatasetMeta","instance","dsd","generateDerivationSourceDataset","tid1500MeasurementReport","imageToWorldCoords","_hooks$getToolClass","measurementGroupContentSequence","TrackingUniqueIdentifierGroup","TrackingUniqueIdentifierValue","UID","TrackingUniqueIdentifier","_Bidirectional","worldCoords","point","imagePixelModule","xOffset","yOffset","secondPoint","arrowFirst","activeHandleIndex","_data$handles","pointImage","pointImage2","cornerstone3DTag","_Angle","width","_data$cachedStats","shortAxisPoints","longAxisPoints","_ref","firstPointPairs","secondPointPairs","longAxisStartImage","longAxisEndImage","shortAxisStartImage","shortAxisEndImage","_CobbAngle","MEASUREMENT_TYPE","angle","start1","_CircleROI","end1","trackingIdentifier","_trackingIdentifier$s2","toLowerCase","CircleROI","pointsWorld","worldPos","_EllipticalROI","_RectangleROI","EPSILON","EllipticalROI","majorAxisStart","majorAxisEnd","minorAxisStart","minorAxisEnd","majorAxisVec","minorAxisVec","columnCosinesVec","projectedMajorAxisOnColVec","projectedMinorAxisOnColVec","absoluteOfMajorDotProduct","absoluteOfMinorDotProduct","ellipsePoints","top","bottom","left","right","rotation","TOOLTYPE","RectangleROI","corners","_PlanarFreehandROI","PLANARFREEHANDROI","PlanarFreehandROI","isOpenContour","pop","contour","polyline","closed","_data$contour","firstPoint","areaUnit","modalityUnit","mean","stdDev","_UltrasoundDirectional","PROBE","Probe","ULTRASOUND_DIRECTIONAL","UltrasoundDirectional","SOPClassUID","SopClassUID","SOPInstanceUID","SopInstanceUID","voxelManager","getScalarData","_createMultiframeSegmentationFromReferencedImages","generateLabelMaps2DFrom3D","scalarData","dimensions","segmentsOnLabelmap3D","Set","add","generateToolStateCornerstone","getReferencedFrameOfReferenceSequence","RTReferencedStudySequence","RTReferencedSeriesSequence","ContourImageSequence","ReferencedInstanceSequence","getReferencedSeriesSequence","_index","DicomMetadataStore","series","getSeries","ReferencedSeries","instances","getStructureSetModule","ROINumber","ROIName","ROIDescription","ROIGenerationAlgorithm","ReferencedFrameOfReferenceUID","_utilities$contours","utilities","generateContourSetsFromLabelmap","AnnotationToPointData","generateRTSSFromSegmentations","segmentations","roiContours","contourSet","segIndex","contourSequence","sliceContours","sliceContour","sopCommon","sliceContourPolyData","polyData","contours","ContourGeometricType","NumberOfContourPoints","contourPoints","ContourData","pointData","toFixed","ContourNumber","segLabel","ROIContour","_initializeDataset","roiContour","ROIDisplayColor","ContourSequence","ReferencedROINumber","StructureSetROISequence","ROIContourSequence","ReferencedFrameOfReferenceSequence","generateRTSSFromAnnotations","annotations","convert","RTROIObservationsSequence","ObservationNumber","RTROIInterpretedType","ROIInterpreter","getRTROIObservationsSequence","rtMetadata","imgMetadata","rtSOPInstanceUID","patientModule","generalStudyModule","patientStudyModule","patientDemographicModule","Modality","modality","PatientID","patientId","PatientName","patientName","PatientBirthDate","PatientAge","patientAge","PatientSex","patientSex","PatientWeight","patientWeight","StudyDate","studyDate","StudyTime","studyTime","StudyID","AccessionNumber","accessionNumber","getPatientModule","rtSeriesModule","SeriesNumber","getRTSeriesModule","Manufacturer","PositionReferenceIndicator","StructureSetLabel","StructureSetName","ReferringPhysicianName","OperatorsName","StructureSetDate","date","StructureSetTime","time","Cornerstone3DSR","CodeScheme","Cornerstone3DSEG","Cornerstone3DPMAP","Cornerstone3DRT","RTSS","Colors","normalize","den","sum","norm","cielab","rgba","RecommendedDisplayCIELabValue","dicomlab2RGB","SegmentNumber","functionalGroups","size","functionalGroup","segmentNumber","frameSize","nextOffset","packedSegment","geometry","pixelMeasures","PixelMeasuresSequence","planeOrientation","firstFunctionalGroup","lastFunctionalGroup","firstPosition","lastPosition","origin","spacing","PixelSpacing","SpacingBetweenSlices","out","Zx","Zy","Zz","columnStepToPatient","rowStepToPatient","planeNormal","sliceStep","b","subtract","direction","geometryFromFunctionalGroups","adaptersSR","Cornerstone","Cornerstone3D","adaptersSEG","VTKjs","adaptersPMAP","adaptersRT"],"sourceRoot":""}