{"version":3,"file":"128.bundle.31984c7b99df392cfb68.js","mappings":"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","sources":["webpack:///../../../extensions/cornerstone-dicom-seg/src/id.js","webpack:///../../../extensions/cornerstone-dicom-seg/src/getSopClassHandlerModule.js","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/callInputDialog.tsx","webpack:///../../ui/src/components/DualInputRange/DualInputRange.tsx","webpack:///../../ui/src/components/DualInputRange/index.js","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/brushToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/cscissorsToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/paintFillToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/rectangleROIStartEndToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/rectangleROIToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/rscissorsToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/sscissorsToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/undoToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segToolsEditSection/baseToolEdit.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segConfigurationIO/index.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/segmentationIO/index.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/panels/PanelSegmentation.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/getHangingProtocolModule.ts","webpack:///../../../extensions/cornerstone-dicom-seg/src/index.tsx"],"sourcesContent":["import packageJson from '../package.json';\n\nconst id = packageJson.name;\nconst SOPClassHandlerName = 'dicom-seg';\nconst SOPClassHandlerId = `${id}.sopClassHandlerModule.${SOPClassHandlerName}`;\n\nexport { id, SOPClassHandlerId, SOPClassHandlerName };\n","import vtkMath from '@kitware/vtk.js/Common/Core/Math';\n\nimport { utils } from '@ohif/core';\n\nimport { SOPClassHandlerId } from './id';\nimport dcmjs from 'dcmjs';\n\nconst { DicomMessage, DicomMetaDictionary } = dcmjs.data;\n\nconst sopClassUids = ['1.2.840.10008.5.1.4.1.1.66.4'];\n\nlet loadPromises = {};\n\nfunction _getDisplaySetsFromSeries(\n  instances,\n  servicesManager,\n  extensionManager\n) {\n  const instance = instances[0];\n\n  const {\n    StudyInstanceUID,\n    SeriesInstanceUID,\n    SOPInstanceUID,\n    SeriesDescription,\n    SeriesNumber,\n    SeriesDate,\n    SOPClassUID,\n    wadoRoot,\n    wadoUri,\n    wadoUriRoot,\n  } = instance;\n\n  const displaySet = {\n    Modality: 'SEG',\n    loading: false,\n    isReconstructable: true, // by default for now since it is a volumetric SEG currently\n    displaySetInstanceUID: utils.guid(),\n    SeriesDescription,\n    SeriesNumber,\n    SeriesDate,\n    SOPInstanceUID,\n    SeriesInstanceUID,\n    StudyInstanceUID,\n    SOPClassHandlerId,\n    SOPClassUID,\n    referencedImages: null,\n    referencedSeriesInstanceUID: null,\n    referencedDisplaySetInstanceUID: null,\n    isDerivedDisplaySet: true,\n    isLoaded: false,\n    isHydrated: false,\n    segments: {},\n    sopClassUids,\n    instance,\n    instances: [instance],\n    wadoRoot,\n    wadoUriRoot,\n    wadoUri,\n    isOverlayDisplaySet: true,\n  };\n\n  const referencedSeriesSequence = instance.ReferencedSeriesSequence;\n\n  if (!referencedSeriesSequence) {\n    throw new Error('ReferencedSeriesSequence is missing for the SEG');\n  }\n\n  const referencedSeries = referencedSeriesSequence[0];\n\n  displaySet.referencedImages =\n    instance.ReferencedSeriesSequence.ReferencedInstanceSequence;\n  displaySet.referencedSeriesInstanceUID = referencedSeries.SeriesInstanceUID;\n\n  displaySet.getReferenceDisplaySet = () => {\n    const { displaySetService } = servicesManager.services;\n    const referencedDisplaySets = displaySetService.getDisplaySetsForSeries(\n      displaySet.referencedSeriesInstanceUID\n    );\n\n    if (!referencedDisplaySets || referencedDisplaySets.length === 0) {\n      throw new Error('Referenced DisplaySet is missing for the SEG');\n    }\n\n    const referencedDisplaySet = referencedDisplaySets[0];\n\n    displaySet.referencedDisplaySetInstanceUID =\n      referencedDisplaySet.displaySetInstanceUID;\n\n    // Todo: this needs to be able to work with other reference volumes (other than streaming) such as nifti, etc.\n    displaySet.referencedVolumeURI = referencedDisplaySet.displaySetInstanceUID;\n    const referencedVolumeId = `cornerstoneStreamingImageVolume:${displaySet.referencedVolumeURI}`;\n    displaySet.referencedVolumeId = referencedVolumeId;\n\n    return referencedDisplaySet;\n  };\n\n  displaySet.load = async ({ headers }) =>\n    await _load(displaySet, servicesManager, extensionManager, headers);\n\n  return [displaySet];\n}\n\nfunction _load(segDisplaySet, servicesManager, extensionManager, headers) {\n  const { SOPInstanceUID } = segDisplaySet;\n  const { segmentationService } = servicesManager.services;\n\n  if (\n    (segDisplaySet.loading || segDisplaySet.isLoaded) &&\n    loadPromises[SOPInstanceUID] &&\n    _segmentationExists(segDisplaySet, segmentationService)\n  ) {\n    return loadPromises[SOPInstanceUID];\n  }\n\n  segDisplaySet.loading = true;\n\n  // We don't want to fire multiple loads, so we'll wait for the first to finish\n  // and also return the same promise to any other callers.\n  loadPromises[SOPInstanceUID] = new Promise(async (resolve, reject) => {\n    if (\n      !segDisplaySet.segments ||\n      Object.keys(segDisplaySet.segments).length === 0\n    ) {\n      const segments = await _loadSegments(\n        extensionManager,\n        segDisplaySet,\n        headers\n      );\n\n      segDisplaySet.segments = segments;\n    }\n\n    const suppressEvents = true;\n    segmentationService\n      .createSegmentationForSEGDisplaySet(segDisplaySet, null, suppressEvents)\n      .then(() => {\n        segDisplaySet.loading = false;\n        resolve();\n      })\n      .catch(error => {\n        segDisplaySet.loading = false;\n        reject(error);\n      });\n  });\n\n  return loadPromises[SOPInstanceUID];\n}\n\nasync function _loadSegments(extensionManager, segDisplaySet, headers) {\n  const utilityModule = extensionManager.getModuleEntry(\n    '@ohif/extension-cornerstone.utilityModule.common'\n  );\n\n  const { dicomLoaderService } = utilityModule.exports;\n  const segArrayBuffer = await dicomLoaderService.findDicomDataPromise(\n    segDisplaySet,\n    null,\n    headers\n  );\n\n  const dicomData = DicomMessage.readFile(segArrayBuffer);\n  const dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n  dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n\n  if (!Array.isArray(dataset.SegmentSequence)) {\n    dataset.SegmentSequence = [dataset.SegmentSequence];\n  }\n\n  const segments = _getSegments(dataset);\n  return segments;\n}\n\nfunction _segmentationExists(segDisplaySet, segmentationService) {\n  // This should be abstracted with the CornerstoneCacheService\n  return segmentationService.getSegmentation(\n    segDisplaySet.displaySetInstanceUID\n  );\n}\n\nfunction _getPixelData(dataset, segments) {\n  let frameSize = Math.ceil((dataset.Rows * dataset.Columns) / 8);\n  let nextOffset = 0;\n\n  Object.keys(segments).forEach(segmentKey => {\n    const segment = segments[segmentKey];\n    segment.numberOfFrames = segment.functionalGroups.length;\n    segment.size = segment.numberOfFrames * frameSize;\n    segment.offset = nextOffset;\n    nextOffset = segment.offset + segment.size;\n    const packedSegment = dataset.PixelData[0].slice(\n      segment.offset,\n      nextOffset\n    );\n\n    segment.pixelData = dcmjs.data.BitArray.unpack(packedSegment);\n    segment.geometry = geometryFromFunctionalGroups(\n      dataset,\n      segment.functionalGroups\n    );\n  });\n\n  return segments;\n}\n\nfunction geometryFromFunctionalGroups(dataset, perFrame) {\n  let pixelMeasures =\n    dataset.SharedFunctionalGroupsSequence.PixelMeasuresSequence;\n  let planeOrientation =\n    dataset.SharedFunctionalGroupsSequence.PlaneOrientationSequence;\n  let planePosition = perFrame[0].PlanePositionSequence; // TODO: assume sorted frames!\n\n  const geometry = {};\n\n  // NB: DICOM PixelSpacing is defined as Row then Column,\n  // unlike ImageOrientationPatient\n  let spacingBetweenSlices = pixelMeasures.SpacingBetweenSlices;\n  if (!spacingBetweenSlices) {\n    if (pixelMeasures.SliceThickness) {\n      console.log('Using SliceThickness as SpacingBetweenSlices');\n      spacingBetweenSlices = pixelMeasures.SliceThickness;\n    }\n  }\n  geometry.spacing = [\n    pixelMeasures.PixelSpacing[1],\n    pixelMeasures.PixelSpacing[0],\n    spacingBetweenSlices,\n  ].map(Number);\n\n  geometry.dimensions = [dataset.Columns, dataset.Rows, perFrame.length].map(\n    Number\n  );\n\n  let orientation = planeOrientation.ImageOrientationPatient.map(Number);\n  const columnStepToPatient = orientation.slice(0, 3);\n  const rowStepToPatient = orientation.slice(3, 6);\n  geometry.planeNormal = [];\n  vtkMath.cross(columnStepToPatient, rowStepToPatient, geometry.planeNormal);\n\n  let firstPosition = perFrame[0].PlanePositionSequence.ImagePositionPatient.map(\n    Number\n  );\n  let lastPosition = perFrame[\n    perFrame.length - 1\n  ].PlanePositionSequence.ImagePositionPatient.map(Number);\n  geometry.sliceStep = [];\n  vtkMath.subtract(lastPosition, firstPosition, geometry.sliceStep);\n  vtkMath.normalize(geometry.sliceStep);\n  geometry.direction = columnStepToPatient\n    .concat(rowStepToPatient)\n    .concat(geometry.sliceStep);\n  geometry.origin = planePosition.ImagePositionPatient.map(Number);\n\n  return geometry;\n}\n\nfunction _getSegments(dataset) {\n  const segments = {};\n\n  dataset.SegmentSequence.forEach(segment => {\n    const cielab = segment.RecommendedDisplayCIELabValue;\n    const rgba = dcmjs.data.Colors.dicomlab2RGB(cielab).map(x =>\n      Math.round(x * 255)\n    );\n\n    rgba.push(255);\n    const segmentNumber = segment.SegmentNumber;\n\n    segments[segmentNumber] = {\n      color: rgba,\n      functionalGroups: [],\n      offset: null,\n      size: null,\n      pixelData: null,\n      label: segment.SegmentLabel,\n    };\n  });\n\n  // make a list of functional groups per segment\n  dataset.PerFrameFunctionalGroupsSequence.forEach(functionalGroup => {\n    const segmentNumber =\n      functionalGroup.SegmentIdentificationSequence.ReferencedSegmentNumber;\n    segments[segmentNumber].functionalGroups.push(functionalGroup);\n  });\n\n  return _getPixelData(dataset, segments);\n}\n\nfunction getSopClassHandlerModule({ servicesManager, extensionManager }) {\n  const getDisplaySetsFromSeries = instances => {\n    return _getDisplaySetsFromSeries(\n      instances,\n      servicesManager,\n      extensionManager\n    );\n  };\n\n  return [\n    {\n      name: 'dicom-seg',\n      sopClassUids,\n      getDisplaySetsFromSeries,\n    },\n  ];\n}\n\nexport default getSopClassHandlerModule;\n","import React from 'react';\nimport { Input, Dialog } from '@ohif/ui';\n\nfunction callInputDialog(uiDialogService, label, callback) {\n  const dialogId = 'enter-segment-label';\n\n  const onSubmitHandler = ({ action, value }) => {\n    switch (action.id) {\n      case 'save':\n        callback(value.label, action.id);\n        break;\n      case 'cancel':\n        callback('', action.id);\n        break;\n    }\n    uiDialogService.dismiss({ id: dialogId });\n  };\n\n  if (uiDialogService) {\n    uiDialogService.create({\n      id: dialogId,\n      centralize: true,\n      isDraggable: false,\n      showOverlay: true,\n      content: Dialog,\n      contentProps: {\n        title: 'Segment',\n        value: { label },\n        noCloseButton: true,\n        onClose: () => uiDialogService.dismiss({ id: dialogId }),\n        actions: [\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\n          { id: 'save', text: 'Confirm', type: 'secondary' },\n        ],\n        onSubmit: onSubmitHandler,\n        body: ({ value, setValue }) => {\n          return (\n            <Input\n              label=\"Enter the segment label\"\n              labelClassName=\"text-white text-[14px] leading-[1.2]\"\n              autoFocus\n              className=\"bg-black border-primary-main\"\n              type=\"text\"\n              value={value.label}\n              onChange={event => {\n                event.persist();\n                setValue(value => ({ ...value, label: event.target.value }));\n              }}\n              onKeyPress={event => {\n                if (event.key === 'Enter') {\n                  onSubmitHandler({ value, action: { id: 'save' } });\n                }\n              }}\n            />\n          );\n        },\n      },\n    });\n  }\n}\n\nexport default callInputDialog;\n","import React, { useState, useCallback, useEffect } from 'react';\nimport classNames from 'classnames';\nimport Typography from '../Typography';\nimport './DualInputRange.css';\nimport {Button} from \"@ohif/ui\";\n\n\n/**\n * React Range Input component\n * it has two props, value and onChange\n * value is a number value\n * onChange is a function that will be called when the range input is changed\n *\n *\n */\n\nconst DualInputRange: React.FC<{\n    value1: number;\n    value2: number;\n    onChange: (value1, value2) => void;\n    minValue: number;\n    maxValue: number;\n    step: number;\n    unit?: string;\n    containerClassName?: string;\n    inputClassName?: string;\n    labelClassName?: string;\n    labelVariant?: string;\n    showLabel?: boolean;\n    labelPosition?: string;\n    trackColor?: string;\n}> = ({\n                                value1,\n                                value2,\n                                onChange,\n                                minValue,\n                                maxValue,\n                                step = 1,\n                                unit = '',\n                                containerClassName,\n                                inputClassName,\n                                labelClassName,\n                                labelVariant,\n                                showLabel = true,\n                                labelPosition = '',\n                                trackColor,\n                            }) => {\n    const [rangeValue1, setRangeValue1] = useState(value1);\n    const [rangeValue2, setRangeValue2] = useState(value2);\n\n    useEffect(() => {\n        //Change value 1\n        if(value1 < minValue) return\n        setRangeValue1(value1);\n        // if (value1 >= rangeValue2) {\n        //     setRangeValue2(value1);\n        // }\n\n        //Change value 2\n        if(value2 > maxValue) return\n        setRangeValue2(value2);\n        // if (value2 <= rangeValue1) {\n        //     setRangeValue1(value2);\n        // }\n    }, [value1, value2])\n\n    const handleChange1 = (e) => {\n        const value = Number(e.target.value);\n        if(value < minValue) return\n        setRangeValue1(value);\n        // if (value >= rangeValue2) {\n        //     setRangeValue2(value);\n        // }\n        onChange(value, rangeValue2)\n    };\n\n    const handleChange2 = (e) => {\n        const value = Number(e.target.value);\n        if(value > maxValue) return\n        setRangeValue2(value);\n        // if (value <= rangeValue1) {\n        //     setRangeValue1(value);\n        // }\n        onChange(rangeValue1, value)\n    }\n\n    const rangeValuePercentage1 = ((rangeValue1 - minValue) / (maxValue - minValue)) * 100;\n    const rangeValuePercentage2 = ((rangeValue2 - minValue) / (maxValue - minValue)) * 100;\n\n    const rangeValueForStr1 = step >= 1 ? rangeValue1.toFixed(0) : rangeValue1.toFixed(1);\n    const rangeValueForStr2 = step >= 1 ? rangeValue2.toFixed(0) : rangeValue2.toFixed(1);\n\n    return (\n        <div\n            style={{flexDirection:'column'}}\n            className={`flex items-center cursor-pointer space-x-1 ${\n                containerClassName ? containerClassName : ''\n            }`}\n        >\n            {showLabel && labelPosition === 'left' && (\n                <>\n                    <Typography\n                        variant={labelVariant ?? 'subtitle'}\n                        component=\"p\"\n                        className={classNames('w-8', labelClassName ?? 'text-white')}\n                    >\n                        {rangeValueForStr1}\n                        {unit}\n                    </Typography>\n                    <Typography\n                        variant={labelVariant ?? 'subtitle'}\n                        component=\"p\"\n                        className={classNames('w-8', labelClassName ?? 'text-white')}\n                    >\n                        {rangeValueForStr2}\n                        {unit}\n                    </Typography>\n                </>\n            )}\n            <div style={{flexDirection:'row'}} className={'flex pb-[5px]'}>\n                <input\n                    type=\"range\"\n                    min={minValue}\n                    max={maxValue}\n                    value={rangeValue1}\n                    className={`appearance-none h-[3px] rounded-lg input-range-thumb-design ${\n                        inputClassName ? inputClassName : ''\n                    }`}\n                    style={{background: '#3a3f99',}}\n                    onChange={handleChange1}\n                    id=\"myRange1\"\n                    step={step}\n                />\n                <input\n                    type=\"range\"\n                    min={minValue}\n                    max={maxValue}\n                    value={rangeValue2}\n                    className={`appearance-none h-[3px] rounded-lg input-range-thumb-design ${\n                        inputClassName ? inputClassName : ''\n                    }`}\n                    style={{background: '#3a3f99',}}\n                    onChange={handleChange2}\n                    id=\"myRange2\"\n                    step={step}\n                />\n            </div>\n            {showLabel && (!labelPosition || labelPosition === 'right') && (\n                <div style={{flexDirection:'row', width:'100%'}} className={'flex pb-[5px]'}>\n                    <Typography\n                        variant={labelVariant ?? 'subtitle'}\n                        component=\"p\"\n                        className={classNames('w-1/2', labelClassName ?? 'text-white', 'flex', 'justify-center')}\n                    >\n                        {'Min : '}\n                        {rangeValueForStr1}\n                        {unit}\n                    </Typography>\n                    <Typography\n                        variant={labelVariant ?? 'subtitle'}\n                        component=\"p\"\n                        className={classNames('w-1/2', labelClassName ?? 'text-white', 'flex', 'justify-center')}\n                    >\n                        {'Max : '}\n                        {rangeValueForStr2}\n                        {unit}\n                    </Typography>\n                </div>\n            )}\n            <div className={'flex'} style={{width:'100%'}}>\n                <div className={'flex w-1/2 justify-center'}>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange1({target: {value: rangeValue1 - 10}})\n                    }}>{'--'}</Button>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange1({target: {value: rangeValue1 - 1}})\n                    }}>{'-'}</Button>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange1({target: {value: rangeValue1 + 1}})\n                    }}>{'+'}</Button>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange1({target: {value: rangeValue1 + 10}})\n                    }}>{'++'}</Button>\n                </div>\n                <div className={'flex w-1/2 justify-center'}>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange2({target: {value: rangeValue2 - 10}})\n                    }}>{'--'}</Button>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange2({target: {value: rangeValue2 - 1}})\n                    }}>{'-'}</Button>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange2({target: {value: rangeValue2 + 1}})\n                    }}>{'+'}</Button>\n                    <Button size={'small'} color={'black'} onClick={() => {\n                        handleChange2({target: {value: rangeValue2 + 10}})\n                    }}>{'++'}</Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default DualInputRange;\n","import DualInputRange from './DualInputRange';\n\nexport default DualInputRange;\n","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport InputRange from '../../../../../platform/ui/src/components/InputRange';\nimport DualInputRange from '../../../../../platform/ui/src/components/DualInputRange';\nimport {Button, useViewportGrid, ListMenu} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport { useTranslation } from 'react-i18next';\nconst { Enums: csToolsEnums } = csTools\nconst { MouseBindings, Events } = csToolsEnums;\nimport {\n    getEnabledElement,\n    VolumeViewport,\n    triggerEvent,\n    eventTarget,\n    utilities as csUtils,\n    utilities,\n} from '@cornerstonejs/core';\n\nconst DefaultListItemRenderer = ({ label, activeMode, eraseReplaceFocus }) => {\n    const isActive = label === eraseReplaceFocus;\n    if (label === 'All' && activeMode === Brush_Mode.REPLACE) {\n        label = 'Background';\n    }\n\n    return (\n        <div\n            className={classNames(\n                'flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark',\n                'text-base whitespace-pre',\n                isActive && 'bg-primary-dark',\n                isActive\n                    ? 'text-[#348CFD]'\n                    : 'text-common-bright hover:bg-primary-dark hover:text-primary-light'\n            )}\n        >\n            <span className=\"mr-5\">{label}</span>\n        </div>\n    );\n};\nconst listItemRenderer = DefaultListItemRenderer\n\nenum Brush_Tool {\n    CIRCLE      =   'CIRCLE',\n    SPHERE      =   'SPHERE'\n}\n\nenum Brush_Mode {\n    FILL        =   'FILL',\n    THRESHOLD   =   'THRESHOLD',\n    ERASE       =   'ERASE',\n    REPLACE     =   'REPLACE'\n}\n\nconst getBrushStrategy = (tool: Brush_Tool, mode: Brush_Mode) => {\n    return mode + '_INSIDE_' + tool;\n}\n\nconst EVENT_LISTENERS = []\n\nexport default function BrushToolEdit ({cornerstoneViewportService, segmentationService}){\n    const { t } = useTranslation('Buttons');\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [isEraseReplaceOnlyMinimized, setIsEraseReplaceOnlyMinimized] = useState(true);\n    const [eraseReplaceFocus, setEraseReplaceFocus] = useState('All')\n    const [pipetteMode, setPipetteMode] = useState({active: false, minimum: true})\n\n    // @ts-ignore\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n    const [activeMode, setActiveMode] = useState(Brush_Mode.FILL);\n    const [activeTool, setActiveTool] = useState(Brush_Tool.CIRCLE);\n    const [brushSize, setBrushSize] = useState(25)\n    const [circleThresholdValue, setCircleThresholdValue] = useState([-1000, 5000])\n    const [circleTargetSegmentIndex, setCircleTargetSegmentIndex] = useState(0)\n    const [segments, setSegments] = useState([])\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const brushInstance = toolGroup.getToolInstance('Brush');\n        setActiveMode(Brush_Mode.FILL);\n        setActiveTool(Brush_Tool.CIRCLE);\n        setBrushSize(brushInstance.configuration.brushSize)\n        setCircleThresholdValue(brushInstance.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold)\n        setCircleTargetSegmentIndex(brushInstance.configuration.strategySpecificConfiguration.REPLACE_INSIDE_CIRCLE.targetSegmentIndex)\n\n        const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n        setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                const {label, segmentIndex} = args\n                const strategySpecificConfiguration = brushInstance.configuration.strategySpecificConfiguration;\n                strategySpecificConfiguration.REPLACE_INSIDE_CIRCLE.targetSegmentIndex = segmentIndex;\n                brushInstance.setConfiguration({eraseFocusIndex: segmentIndex, strategySpecificConfiguration: strategySpecificConfiguration})\n                setEraseReplaceFocus(label)\n            }\n        }}))\n\n        toolGroup.setToolActive('Undo', {\n            bindings: [\n                {\n                    mouseButton: MouseBindings.Primary, // Left Click\n                },\n            ],\n        })\n    }, [])\n\n    //Update \"erase more\" list on segment modified\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const brushInstance = toolGroup.getToolInstance('Brush');\n        const added = segmentationService.EVENTS.SEGMENTATION_ADDED;\n        const updated = segmentationService.EVENTS.SEGMENTATION_UPDATED;\n        const removed = segmentationService.EVENTS.SEGMENTATION_REMOVED;\n        const subscriptions = [];\n\n        [added, updated, removed].forEach(evt => {\n            segmentationService.subscribe(evt, () => {\n                const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n                setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                        const {label, segmentIndex} = args\n                        const strategySpecificConfiguration = brushInstance.configuration.strategySpecificConfiguration;\n                        strategySpecificConfiguration.REPLACE_INSIDE_CIRCLE.targetSegmentIndex = segmentIndex;\n                        brushInstance.setConfiguration({eraseFocusIndex: segmentIndex, strategySpecificConfiguration: strategySpecificConfiguration})\n                        setEraseReplaceFocus(label)\n                    }\n                }}))\n                }\n            );\n        });\n\n        return () => {\n            subscriptions.forEach(unsub => {\n                unsub();\n            });\n        };\n    }, []);\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const brushInstance = toolGroup.getToolInstance('Brush');\n        brushInstance.setConfiguration({\n            brushSize: brushSize,\n            activeStrategy: getBrushStrategy(activeTool, activeMode),\n            strategySpecificConfiguration: {\n                THRESHOLD_INSIDE_CIRCLE: {\n                    threshold: circleThresholdValue, // E.g. CT Fat // Only used during threshold strategies.\n                },\n                REPLACE_INSIDE_CIRCLE: {\n                    targetSegmentIndex: circleTargetSegmentIndex, // E.g. Only used during replace strategies.\n                },\n            },\n        })\n    }, [brushSize, activeTool, activeMode, circleThresholdValue])\n\n    const setThresholdCallback = (evt, minimum) => {\n        //If left click\n        if(evt.detail.mouseButton === 1) {\n            const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n            const worldPoints = evt.detail.currentPoints.world\n            const imageData = viewport.getImageData()\n            const index = imageData.imageData.worldToIndex(worldPoints).map(Math.round)\n\n            index[0] = Math.round(index[0]);\n            index[1] = Math.round(index[1]);\n            index[2] = Math.round(index[2]);\n\n            const {scalarData, dimensions} = imageData\n            if (csUtils.indexWithinDimensions(index, dimensions)) {\n                const yMultiple = dimensions[0];\n                const zMultiple = dimensions[0] * dimensions[1];\n\n                const value =\n                    scalarData[index[2] * zMultiple + index[1] * yMultiple + index[0]];\n                if (minimum) {\n                    setCircleThresholdValue([value, circleThresholdValue[1]])\n                } else {\n                    setCircleThresholdValue([circleThresholdValue[0], value])\n                }\n            }\n        }\n    }\n\n    //Create event listeners to catch mouse click for pipette threshold tool\n    //Active probe tool is pipette active to display HU values on screen\n    //Go back to brush tool if we deactivate pipette\n    //Wrapper around addEventListener to not have multiple listeners\n    useEffect(() => {\n        const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            viewport.id,\n            viewport.renderingEngineId\n        );\n        const currentElement = viewport.element\n        currentElement.addEvent = (evt, callback) => {\n            if(EVENT_LISTENERS[evt]) {\n                currentElement.removeEventListener(evt, EVENT_LISTENERS[evt])\n                EVENT_LISTENERS[evt] = null\n            }\n            EVENT_LISTENERS[evt] = callback\n            currentElement.addEventListener(evt, callback)\n        }\n        currentElement.removeEvent = (evt) => {\n            currentElement.removeEventListener(evt, EVENT_LISTENERS[evt])\n            EVENT_LISTENERS[evt] = null\n        }\n\n        if(pipetteMode.active){\n            toolGroup.setToolPassive('Brush')\n            toolGroup.setToolActive('DragProbe', {\n                bindings: [\n                    {\n                        mouseButton: MouseBindings.Primary, // Left Click\n                    },\n                ],\n            })\n            currentElement.addEvent(Events.MOUSE_DRAG, (evt) => {setThresholdCallback(evt, pipetteMode.minimum)});\n        }\n        else{\n            toolGroup.setToolPassive('DragProbe')\n            toolGroup.setToolActive('Brush', {\n                bindings: [\n                    {\n                        mouseButton: MouseBindings.Primary, // Left Click\n                    },\n                ],\n            })\n            currentElement.removeEvent(Events.MOUSE_DRAG)\n        }\n    }, [pipetteMode.active, pipetteMode.minimum])\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Paint Brush Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\">\n                            {'Tool and mode'}\n                        </span>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeTool === Brush_Tool.CIRCLE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveTool(Brush_Tool.CIRCLE)}}\n                            >{'Circle'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeTool === Brush_Tool.SPHERE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveTool(Brush_Tool.SPHERE)}}\n                            >{'Sphere'}</Button>\n\n                        </div>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeMode === Brush_Mode.FILL ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveMode(Brush_Mode.FILL)}}\n                            >{'Fill'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeMode === Brush_Mode.THRESHOLD ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveMode(Brush_Mode.THRESHOLD)}}\n                            >{'Threshold'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeMode === Brush_Mode.ERASE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveMode(Brush_Mode.ERASE)}}\n                            >{'Erase'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeMode === Brush_Mode.REPLACE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveMode(Brush_Mode.REPLACE)}}\n                            >{'Replace'}</Button>\n                        </div>\n                        <div className=\"flex items-center col-span-2\">\n                            <div className=\"text-[#ffffff] text-[12px] pr-[9px]\">{'Radius'}</div>\n                            <InputRange\n                                minValue={0}\n                                maxValue={100}\n                                value={brushSize}\n                                onChange={(value) => {setBrushSize(value)}}\n                                step={1}\n                                containerClassName=\"mt-[4px] mb-[4px]\"\n                                inputClassName=\"w-[64px]\"\n                                labelClassName=\"text-white text-[12px]\"\n                                unit=\"px\"\n                            />\n                        </div>\n                        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n                            <div className=\"bg-primary-dark\">\n                                <div\n                                    className=\"flex cursor-pointer items-center\"\n                                    onClick={evt => {\n                                        evt.stopPropagation();\n                                        setIsEraseReplaceOnlyMinimized(!isEraseReplaceOnlyMinimized);\n                                    }}\n                                >\n                                    <Icon\n                                        name=\"panel-group-open-close\"\n                                        className={classNames(\n                                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                                            {\n                                                'transform rotate-90': !isEraseReplaceOnlyMinimized,\n                                            }\n                                        )}\n                                    />\n                                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                                        {'Erase/replace options'}\n                                    </span>\n                                </div>\n                                {/* active segmentation */}\n                                {!isEraseReplaceOnlyMinimized && (\n                                    <div className=\"pl-2 pr-2\" style={{display:'flex', flexDirection:\"column\"}}>\n                                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]\">\n                                            {'Erase/replace focus on:'}\n                                        </span>\n                                        <ListMenu\n                                            items={segments}\n                                            renderer={args => listItemRenderer({...args, activeMode, eraseReplaceFocus})}\n                                        />\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                        {\n                            (activeMode === Brush_Mode.THRESHOLD && (\n                                <div className=\"flex items-center col-span-2\" style={{flexDirection:'column', width:'100%'}}>\n                                    <div className=\"h-[1px] bg-[#212456] mb-[8px] mx-1\" style={{width: '100%'}}></div>\n                                    <div className=\"text-[#ffffff] text-[12px] pr-[9px]\" style={{width:'100%'}}>\n                                        {'Threshold values'}\n                                    </div>\n                                    <DualInputRange\n                                        minValue={-1000}\n                                        maxValue={5000}\n                                        value1={circleThresholdValue[0]}\n                                        value2={circleThresholdValue[1]}\n                                        onChange={(vmin, vmax) => {setCircleThresholdValue([vmin, vmax])}}\n                                        step={5}\n                                        containerClassName=\"mt-[4px] mb-[4px] w-full\"\n                                        inputClassName=\"w-full\"\n                                        labelClassName=\"text-white text-[12px] w-full\"\n                                        unit=\"HU\"\n                                    />\n                                    <div className=\"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]\" style={{width:'100%'}}>\n                                        {'Select threshold value with pipette for :'}\n                                    </div>\n                                    <div className=\"flex flex-row justify-evenly w-full mb-[8px]\">\n                                        <Button\n                                            fullWidth={true}\n                                            size={'small'}\n                                            color={'secondary'}\n                                            onClick={() => { setPipetteMode({active: true, minimum: true})}}\n                                        >{'Minimum'}</Button>\n                                        <Button\n                                            fullWidth={true}\n                                            size={'small'}\n                                            color={'secondary'}\n                                            onClick={() => { setPipetteMode({active: true, minimum: false})}}\n                                        >{'Maximum'}</Button>\n                                    </div>\n                                    {\n                                        pipetteMode.active && (\n                                            <Button\n                                                size={'small'}\n                                                color={'secondary'}\n                                                onClick={() => { setPipetteMode({active: false, minimum: true})}}\n                                            >\n                                                {'Back to annotation'}\n                                            </Button>\n                                        )\n                                    }\n                                </div>\n                            ))\n                        }\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport {Button, useViewportGrid, ListMenu} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport {useTranslation} from \"react-i18next\";\n\nconst DefaultListItemRenderer = ({ label, t, eraseFocus }) => {\n    const isActive = label === eraseFocus;\n\n    return (\n        <div\n            className={classNames(\n                'flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark',\n                'text-base whitespace-pre',\n                isActive && 'bg-primary-dark',\n                isActive\n                    ? 'text-[#348CFD]'\n                    : 'text-common-bright hover:bg-primary-dark hover:text-primary-light'\n            )}\n        >\n            <span className=\"mr-5\">{label}</span>\n        </div>\n    );\n};\nconst listItemRenderer = DefaultListItemRenderer\n\nenum Circle_Strategies {\n    FILL_INSIDE = 'FILL_INSIDE',\n    ERASE_INSIDE = 'ERASE_INSIDE'\n}\n\nexport default function CircleScissorsToolEdit ({cornerstoneViewportService, segmentationService}){\n    const { t } = useTranslation('Buttons');\n\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [activeStrategy, setActiveStrategy] = useState(Circle_Strategies.FILL_INSIDE)\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    const [segments, setSegments] = useState([])\n    const [isEraseOnlyMinimized, setIsEraseOnlyMinimized] = useState(true);\n    const [eraseFocus, setEraseFocus] = useState('All')\n\n    //Update \"erase more\" list on segment modified\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const cscissorsInstance = toolGroup.getToolInstance('CircleScissor');\n        const added = segmentationService.EVENTS.SEGMENTATION_ADDED;\n        const updated = segmentationService.EVENTS.SEGMENTATION_UPDATED;\n        const removed = segmentationService.EVENTS.SEGMENTATION_REMOVED;\n        const subscriptions = [];\n\n        [added, updated, removed].forEach(evt => {\n            segmentationService.subscribe(evt, () => {\n                    const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n                    setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                            const {label, segmentIndex} = args\n                            cscissorsInstance.setConfiguration({eraseFocusIndex: segmentIndex})\n                            setEraseFocus(label)\n                        }\n                    }}))\n                }\n            );\n        });\n\n        return () => {\n            subscriptions.forEach(unsub => {\n                unsub();\n            });\n        };\n    }, []);\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const circleInstance = toolGroup.getToolInstance('CircleScissor');\n        setActiveStrategy(circleInstance.configuration.activeStrategy)\n\n        const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n        setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                const {label, segmentIndex} = args\n                setEraseFocus(label)\n                circleInstance.setConfiguration({eraseFocusIndex: segmentIndex})\n            }\n        }}))\n    }, [])\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const CircleInstance = toolGroup.getToolInstance('CircleScissor');\n        CircleInstance.setConfiguration({\n            activeStrategy: activeStrategy,\n        })\n    }, [activeStrategy])\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Circle Segmentation Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\">\n                          {'Mode'}\n                        </span>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeStrategy === Circle_Strategies.FILL_INSIDE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveStrategy(Circle_Strategies.FILL_INSIDE)}}\n                            >{'Fill'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeStrategy === Circle_Strategies.ERASE_INSIDE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveStrategy(Circle_Strategies.ERASE_INSIDE)}}\n                            >{'Erase'}</Button>\n                        </div>\n                        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n                            <div className=\"bg-primary-dark\">\n                                <div\n                                    className=\"flex cursor-pointer items-center\"\n                                    onClick={evt => {\n                                        evt.stopPropagation();\n                                        setIsEraseOnlyMinimized(!isEraseOnlyMinimized);\n                                    }}\n                                >\n                                    <Icon\n                                        name=\"panel-group-open-close\"\n                                        className={classNames(\n                                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                                            {\n                                                'transform rotate-90': !isEraseOnlyMinimized,\n                                            }\n                                        )}\n                                    />\n                                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                                        {'Erase Options'}\n                                    </span>\n                                </div>\n                                {/* active segmentation */}\n                                {!isEraseOnlyMinimized && (\n                                    <div className=\"pl-2 pr-2\" style={{display:'flex', flexDirection:\"column\"}}>\n                                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]\">\n                                          {'Erase focus on:'}\n                                        </span>\n                                        <ListMenu\n                                            items={segments}\n                                            renderer={args => listItemRenderer({...args, t, eraseFocus})}\n                                        />\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\n\nexport default function PaintFillToolEdit ({}){\n    const [isMinimized, setIsMinimized] = useState(false);\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Fill Holes Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\">\n                          {'No configurations for this tool'}\n                        </span>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport DualInputRange from '../../../../../platform/ui/src/components/DualInputRange';\nimport InputRange from '../../../../../platform/ui/src/components/InputRange'\nimport {Button, useViewportGrid} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport {cache, utilities as csUtils} from \"@cornerstonejs/core\";\nimport { ImageVolume } from '@cornerstonejs/core/src/cache/classes/ImageVolume';\nimport {computeNormal} from \"@kitware/vtk.js/Common/DataModel/Triangle\";\nconst { Enums: csToolsEnums } = csTools\nconst { MouseBindings, Events } = csToolsEnums;\n\nconst EVENT_LISTENERS = []\n\nexport default function RectangleROIStartEndThresholdToolEdit ({\n                                                            segmentationService,\n                                                            cornerstoneViewportService,\n                                                            commandsManager\n                                                       }){\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    const [thresholdValue, setThresholdValue] = useState([-1000, 5000])\n    const [slicesToPropagate, setSlicesToPropagate] = useState(0)\n    const [pipetteMode, setPipetteMode] = useState({active: false, minimum: true})\n\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const rectangleROIInstance = toolGroup.getToolInstance('RectangleROIStartEndThreshold');\n        setSlicesToPropagate(rectangleROIInstance.configuration.numSlicesToPropagate)\n    }, [])\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const brushInstance = toolGroup.getToolInstance('RectangleROIStartEndThreshold');\n        brushInstance.setConfiguration({\n            numSlicesToPropagate: slicesToPropagate\n        })\n        console.log('SET CONFIGURATION', slicesToPropagate)\n    }, [slicesToPropagate])\n\n    const setThresholdCallback = (evt, minimum) => {\n        //If left click\n        if(evt.detail.mouseButton === 1) {\n            const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n            const worldPoints = evt.detail.currentPoints.world\n            const imageData = viewport.getImageData()\n            const index = imageData.imageData.worldToIndex(worldPoints).map(Math.round)\n\n            index[0] = Math.round(index[0]);\n            index[1] = Math.round(index[1]);\n            index[2] = Math.round(index[2]);\n\n            const {scalarData, dimensions} = imageData\n            if (csUtils.indexWithinDimensions(index, dimensions)) {\n                const yMultiple = dimensions[0];\n                const zMultiple = dimensions[0] * dimensions[1];\n\n                const value =\n                    scalarData[index[2] * zMultiple + index[1] * yMultiple + index[0]];\n                if (minimum) {\n                    setThresholdValue([value, thresholdValue[1]])\n                } else {\n                    setThresholdValue([thresholdValue[0], value])\n                }\n            }\n        }\n    }\n\n    useEffect(() => {\n        const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            viewport.id,\n            viewport.renderingEngineId\n        );\n        const currentElement = viewport.element\n        currentElement.addEvent = (evt, callback) => {\n            if(EVENT_LISTENERS[evt]) {\n                currentElement.removeEventListener(evt, EVENT_LISTENERS[evt])\n                EVENT_LISTENERS[evt] = null\n            }\n            EVENT_LISTENERS[evt] = callback\n            currentElement.addEventListener(evt, callback)\n        }\n        currentElement.removeEvent = (evt) => {\n            currentElement.removeEventListener(evt, EVENT_LISTENERS[evt])\n            EVENT_LISTENERS[evt] = null\n        }\n\n        if(pipetteMode.active){\n            toolGroup.setToolPassive('RectangleROIStartEndThreshold')\n            toolGroup.setToolActive('DragProbe', {\n                bindings: [\n                    {\n                        mouseButton: MouseBindings.Primary, // Left Click\n                    },\n                ],\n            })\n            currentElement.addEvent(Events.MOUSE_DRAG, (evt) => {setThresholdCallback(evt, pipetteMode.minimum)});\n        }\n        else{\n            toolGroup.setToolPassive('DragProbe')\n            toolGroup.setToolActive('RectangleROIStartEndThreshold', {\n                bindings: [\n                    {\n                        mouseButton: MouseBindings.Primary, // Left Click\n                    },\n                ],\n            })\n            currentElement.removeEvent(Events.MOUSE_DRAG)\n        }\n    }, [pipetteMode.active, pipetteMode.minimum])\n\n    const computeThreshold = () => {\n        const actors = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).getActors()\n        const imageVolumes = actors\n            .map((va) => {\n                // prefer the referenceUID if it is set, since it can be a derived actor\n                // and the uid does not necessarily match the volumeId\n                const actorUID = va.referenceId ?? va.uid;\n                return cache.getVolume(actorUID);\n            })\n            //filter to get only ImageVolume instances (and not StreamingImageVolume)\n            .filter((iv) => !!iv);\n\n        const selectedAnnotationUIDs = csTools.annotation.selection.getAnnotationsSelectedByToolName(\n            'RectangleROIStartEndThreshold'\n        ) as Array<string>;\n\n        if (!selectedAnnotationUIDs) {\n            throw new Error('No annotation selected ');\n        }\n\n        const annotationUID = selectedAnnotationUIDs[0];\n        const annotation = csTools.annotation.state.getAnnotation(\n            annotationUID\n        ) as csTools.Types.ToolSpecificAnnotationTypes.RectangleROIStartEndThresholdAnnotation;\n\n        if (!annotation) return\n\n        // Todo: this only works for volumeViewport\n        const ctVolume = imageVolumes.filter(iv => iv.imageIds)[0];\n        const segmentationVolume = imageVolumes.filter(iv => !iv.imageIds)[0];\n        const segmentations = segmentationService.getSegmentations();\n\n        csTools.utilities.segmentation.rectangleROIThresholdVolumeByRange(\n            selectedAnnotationUIDs,\n            segmentationVolume,\n            [\n                { volume: ctVolume, lower: thresholdValue[0], upper: thresholdValue[1] },\n            ],\n            {\n                numSlicesToProject: 0,\n                overwrite: false,\n                overlapType: 1,\n                segmentIndex: segmentations[0].activeSegmentIndex,\n            }\n        );\n    }\n\n    const deleteRegion = () => {\n        const selectedAnnotationUIDs = csTools.annotation.selection.getAnnotationsSelectedByToolName(\n            'RectangleROIStartEndThreshold'\n        ) as Array<string>;\n\n        if (!selectedAnnotationUIDs) {\n            throw new Error('No annotation selected ');\n        }\n        console.log('selected annotation uid', selectedAnnotationUIDs)\n\n        const annotationUID = selectedAnnotationUIDs[0];\n        console.log('CSTOOLS STATE', csTools.annotation.state)\n        csTools.annotation.state.removeAnnotation(annotationUID)\n        cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).render()\n    }\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'3D Rectangle Threshold Segmentation Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <div className=\"flex items-center col-span-2\" style={{flexDirection:'column', width:'100%'}}>\n                            <div className=\"text-[#ffffff] text-[12px] pr-[9px]\" style={{width:'100%'}}>{'Threshold values'}</div>\n                            <DualInputRange\n                                minValue={-1000}\n                                maxValue={5000}\n                                value1={thresholdValue[0]}\n                                value2={thresholdValue[1]}\n                                onChange={(vmin, vmax) => {setThresholdValue([vmin, vmax])}}\n                                step={5}\n                                containerClassName=\"mt-[4px] mb-[4px] w-full\"\n                                inputClassName=\"w-full\"\n                                labelClassName=\"text-white text-[12px] w-full\"\n                                unit=\"\"\n                            />\n                            <div className=\"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]\" style={{width:'100%'}}>{'Select threshold value with pipette for :'}</div>\n                            <div className=\"flex flex-row justify-evenly w-full mb-[8px]\">\n                                <Button\n                                    fullWidth={true}\n                                    size={'small'}\n                                    color={'secondary'}\n                                    onClick={() => { setPipetteMode({active: true, minimum: true})}}\n                                >{'Minimum'}</Button>\n                                <Button\n                                    fullWidth={true}\n                                    size={'small'}\n                                    color={'secondary'}\n                                    onClick={() => { setPipetteMode({active: true, minimum: false})}}\n                                >{'Maximum'}</Button>\n                            </div>\n                            {\n                                pipetteMode.active && (\n                                    <Button\n                                        size={'small'}\n                                        color={'secondary'}\n                                        onClick={() => { setPipetteMode({active: false, minimum: true})}}\n                                    >\n                                        {'Back to annotation'}\n                                    </Button>\n                                )\n                            }\n                        </div>\n                        <div className=\"flex items-center col-span-2\" style={{width:'100%', flexDirection:'column'}}>\n                            <div className=\"text-[#ffffff] text-[12px] pr-[9px]\" style={{width:'100%'}}>{'Slices Propagation'}</div>\n                            <InputRange\n                                minValue={0}\n                                maxValue={200}\n                                value={slicesToPropagate}\n                                onChange={(value) => {setSlicesToPropagate(value)}}\n                                step={1}\n                                containerClassName=\"mt-[4px] mb-[4px] w-full\"\n                                inputClassName=\"w-full\"\n                                labelClassName=\"text-white text-[12px] w-full\"\n                                unit=\"\"\n                            />\n                        </div>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={() => {computeThreshold()}}\n                            >{'Compute Threshold'}</Button>\n                        </div>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={() => {deleteRegion()}}\n                            >{'Delete selected region'}</Button>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport DualInputRange from '../../../../../platform/ui/src/components/DualInputRange';\nimport {Button, useViewportGrid} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport {cache, utilities as csUtils} from \"@cornerstonejs/core\";\nimport { ImageVolume } from '@cornerstonejs/core/src/cache/classes/ImageVolume';\nimport {computeNormal} from \"@kitware/vtk.js/Common/DataModel/Triangle\";\nconst { Enums: csToolsEnums } = csTools\nconst { MouseBindings, Events } = csToolsEnums;\n\nconst EVENT_LISTENERS = []\n\nexport default function RectangleROIThresholdToolEdit ({\n    segmentationService,\n    cornerstoneViewportService,\n    commandsManager\n}){\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    const [thresholdValue, setThresholdValue] = useState([-1000, 5000])\n    const [pipetteMode, setPipetteMode] = useState({active: false, minimum: true})\n\n    const setThresholdCallback = (evt, minimum) => {\n        //If left click\n        if(evt.detail.mouseButton === 1) {\n            const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n            const worldPoints = evt.detail.currentPoints.world\n            const imageData = viewport.getImageData()\n            const index = imageData.imageData.worldToIndex(worldPoints).map(Math.round)\n\n            index[0] = Math.round(index[0]);\n            index[1] = Math.round(index[1]);\n            index[2] = Math.round(index[2]);\n\n            const {scalarData, dimensions} = imageData\n            if (csUtils.indexWithinDimensions(index, dimensions)) {\n                const yMultiple = dimensions[0];\n                const zMultiple = dimensions[0] * dimensions[1];\n\n                const value =\n                    scalarData[index[2] * zMultiple + index[1] * yMultiple + index[0]];\n                if (minimum) {\n                    setThresholdValue([value, thresholdValue[1]])\n                } else {\n                    setThresholdValue([thresholdValue[0], value])\n                }\n            }\n        }\n    }\n\n    useEffect(() => {\n        const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            viewport.id,\n            viewport.renderingEngineId\n        );\n        const currentElement = viewport.element\n        currentElement.addEvent = (evt, callback) => {\n            if(EVENT_LISTENERS[evt]) {\n                currentElement.removeEventListener(evt, EVENT_LISTENERS[evt])\n                EVENT_LISTENERS[evt] = null\n            }\n            EVENT_LISTENERS[evt] = callback\n            currentElement.addEventListener(evt, callback)\n        }\n        currentElement.removeEvent = (evt) => {\n            currentElement.removeEventListener(evt, EVENT_LISTENERS[evt])\n            EVENT_LISTENERS[evt] = null\n        }\n\n        if(pipetteMode.active){\n            toolGroup.setToolPassive('RectangleROIThreshold')\n            toolGroup.setToolActive('DragProbe', {\n                bindings: [\n                    {\n                        mouseButton: MouseBindings.Primary, // Left Click\n                    },\n                ],\n            })\n            currentElement.addEvent(Events.MOUSE_DRAG, (evt) => {setThresholdCallback(evt, pipetteMode.minimum)});\n        }\n        else{\n            toolGroup.setToolPassive('DragProbe')\n            toolGroup.setToolActive('RectangleROIThreshold', {\n                bindings: [\n                    {\n                        mouseButton: MouseBindings.Primary, // Left Click\n                    },\n                ],\n            })\n            currentElement.removeEvent(Events.MOUSE_DRAG)\n        }\n    }, [pipetteMode.active, pipetteMode.minimum])\n\n    const computeThreshold = () => {\n        const actors = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).getActors()\n        const imageVolumes = actors\n            .map((va) => {\n                // prefer the referenceUID if it is set, since it can be a derived actor\n                // and the uid does not necessarily match the volumeId\n                const actorUID = va.referenceId ?? va.uid;\n                return cache.getVolume(actorUID);\n            })\n            //filter to get only ImageVolume instances (and not StreamingImageVolume)\n            .filter((iv) => !!iv);\n\n        const selectedAnnotationUIDs = csTools.annotation.selection.getAnnotationsSelectedByToolName(\n            'RectangleROIThreshold'\n        ) as Array<string>;\n\n        if (!selectedAnnotationUIDs) {\n            throw new Error('No annotation selected ');\n        }\n\n        const annotationUID = selectedAnnotationUIDs[0];\n        const annotation = csTools.annotation.state.getAnnotation(\n            annotationUID\n        ) as csTools.Types.ToolSpecificAnnotationTypes.RectangleROIThresholdAnnotation;\n\n        if (!annotation) return\n\n        // Todo: this only works for volumeViewport\n        const ctVolume = imageVolumes.filter(iv => iv.imageIds)[0];\n        const segmentationVolume = imageVolumes.filter(iv => !iv.imageIds)[0];\n\n        const segmentations = segmentationService.getSegmentations();\n        console.log('SEGMENTATION', segmentations)\n\n        csTools.utilities.segmentation.rectangleROIThresholdVolumeByRange(\n            selectedAnnotationUIDs,\n            segmentationVolume,\n            [\n                { volume: ctVolume, lower: thresholdValue[0], upper: thresholdValue[1] },\n            ],\n            {\n                numSlicesToProject: 0,\n                overwrite: false,\n                overlapType: 1,\n                segmentIndex: segmentations[0].activeSegmentIndex,\n            }\n        );\n    }\n\n    const deleteRegion = () => {\n        const selectedAnnotationUIDs = csTools.annotation.selection.getAnnotationsSelectedByToolName(\n            'RectangleROIThreshold'\n        ) as Array<string>;\n\n        if (!selectedAnnotationUIDs) {\n            throw new Error('No annotation selected ');\n        }\n        console.log('selected annotation uid', selectedAnnotationUIDs)\n\n        const annotationUID = selectedAnnotationUIDs[0];\n        console.log('CSTOOLS STATE', csTools.annotation.state)\n        csTools.annotation.state.removeAnnotation(annotationUID)\n        cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).render()\n    }\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Rectangle Threshold Segmentation Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <div className=\"flex items-center col-span-2 pb-[9px]\" style={{flexDirection:'column', width:'100%'}}>\n                            <div className=\"text-[#ffffff] text-[12px] pr-[9px] pb-[3px]\" style={{width:'100%'}}>{'Threshold values'}</div>\n                            <DualInputRange\n                                minValue={-1000}\n                                maxValue={5000}\n                                value1={thresholdValue[0]}\n                                value2={thresholdValue[1]}\n                                onChange={(vmin, vmax) => {setThresholdValue([vmin, vmax])}}\n                                step={5}\n                                containerClassName=\"mt-[4px] mb-[4px] w-full pb-[3px]\"\n                                inputClassName=\"w-full\"\n                                labelClassName=\"text-white text-[12px] w-full\"\n                                unit=\"HU\"\n                            />\n                            <div className=\"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]\" style={{width:'100%'}}>{'Select threshold value with pipette for :'}</div>\n                            <div className=\"flex flex-row justify-evenly w-full mb-[8px]\">\n                                <Button\n                                    fullWidth={true}\n                                    size={'small'}\n                                    color={'secondary'}\n                                    onClick={() => { setPipetteMode({active: true, minimum: true})}}\n                                >{'Minimum'}</Button>\n                                <Button\n                                    fullWidth={true}\n                                    size={'small'}\n                                    color={'secondary'}\n                                    onClick={() => { setPipetteMode({active: true, minimum: false})}}\n                                >{'Maximum'}</Button>\n                            </div>\n                            {\n                                pipetteMode.active && (\n                                    <Button\n                                        size={'small'}\n                                        color={'secondary'}\n                                        onClick={() => { setPipetteMode({active: false, minimum: true})}}\n                                    >\n                                        {'Back to annotation'}\n                                    </Button>\n                                )\n                            }\n                        </div>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={() => {computeThreshold()}}\n                            >{'Compute Threshold'}</Button>\n                        </div>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={() => {deleteRegion()}}\n                            >{'Delete selected region'}</Button>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport {Button, useViewportGrid, ListMenu} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport {useTranslation} from \"react-i18next\";\n\nconst DefaultListItemRenderer = ({ label, t, eraseFocus }) => {\n    const isActive = label === eraseFocus;\n\n    return (\n        <div\n            className={classNames(\n                'flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark',\n                'text-base whitespace-pre',\n                isActive && 'bg-primary-dark',\n                isActive\n                    ? 'text-[#348CFD]'\n                    : 'text-common-bright hover:bg-primary-dark hover:text-primary-light'\n            )}\n        >\n            <span className=\"mr-5\">{label}</span>\n        </div>\n    );\n};\nconst listItemRenderer = DefaultListItemRenderer\n\nenum Rectangle_Strategies {\n    FILL_INSIDE = 'FILL_INSIDE',\n    ERASE_INSIDE = 'ERASE_INSIDE'\n}\n\nexport default function RectangleScissorsToolEdit ({cornerstoneViewportService, segmentationService}){\n    const { t } = useTranslation('Buttons');\n\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [activeStrategy, setActiveStrategy] = useState(Rectangle_Strategies.FILL_INSIDE)\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    const [segments, setSegments] = useState([])\n    const [isEraseOnlyMinimized, setIsEraseOnlyMinimized] = useState(true);\n    const [eraseFocus, setEraseFocus] = useState('All')\n\n    //Update \"erase more\" list on segment modified\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const rscissorsInstance = toolGroup.getToolInstance('RectangleScissor');\n        const added = segmentationService.EVENTS.SEGMENTATION_ADDED;\n        const updated = segmentationService.EVENTS.SEGMENTATION_UPDATED;\n        const removed = segmentationService.EVENTS.SEGMENTATION_REMOVED;\n        const subscriptions = [];\n\n        [added, updated, removed].forEach(evt => {\n            segmentationService.subscribe(evt, () => {\n                    const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n                    setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                            const {label, segmentIndex} = args\n                            rscissorsInstance.setConfiguration({eraseFocusIndex: segmentIndex})\n                            setEraseFocus(label)\n                        }\n                    }}))\n                }\n            );\n        });\n\n        return () => {\n            subscriptions.forEach(unsub => {\n                unsub();\n            });\n        };\n    }, []);\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const rectangleInstance = toolGroup.getToolInstance('RectangleScissor');\n        setActiveStrategy(rectangleInstance.configuration.activeStrategy)\n\n        const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n        setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                const {label, segmentIndex} = args\n                setEraseFocus(label)\n                rectangleInstance.setConfiguration({eraseFocusIndex: segmentIndex})\n            }\n        }}))\n    }, [])\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const rectangleInstance = toolGroup.getToolInstance('RectangleScissor');\n        rectangleInstance.setConfiguration({\n            activeStrategy: activeStrategy,\n        })\n    }, [activeStrategy])\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Rectangle Scissors Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\">\n                          {'Mode'}\n                        </span>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeStrategy === Rectangle_Strategies.FILL_INSIDE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveStrategy(Rectangle_Strategies.FILL_INSIDE)}}\n                            >{'Fill'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeStrategy === Rectangle_Strategies.ERASE_INSIDE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveStrategy(Rectangle_Strategies.ERASE_INSIDE)}}\n                            >{'Erase'}</Button>\n                        </div>\n                        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n                            <div className=\"bg-primary-dark\">\n                                <div\n                                    className=\"flex cursor-pointer items-center\"\n                                    onClick={evt => {\n                                        evt.stopPropagation();\n                                        setIsEraseOnlyMinimized(!isEraseOnlyMinimized);\n                                    }}\n                                >\n                                    <Icon\n                                        name=\"panel-group-open-close\"\n                                        className={classNames(\n                                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                                            {\n                                                'transform rotate-90': !isEraseOnlyMinimized,\n                                            }\n                                        )}\n                                    />\n                                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                                        {'Erase Options'}\n                                    </span>\n                                </div>\n                                {/* active segmentation */}\n                                {!isEraseOnlyMinimized && (\n                                    <div className=\"pl-2 pr-2\" style={{display:'flex', flexDirection:\"column\"}}>\n                                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]\">\n                                          {'Erase focus on:'}\n                                        </span>\n                                        <ListMenu\n                                            items={segments}\n                                            renderer={args => listItemRenderer({...args, t, eraseFocus})}\n                                        />\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport {Button, useViewportGrid, ListMenu} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport {useTranslation} from \"react-i18next\";\n\nconst DefaultListItemRenderer = ({ label, t, eraseFocus }) => {\n    const isActive = label === eraseFocus;\n\n    return (\n        <div\n            className={classNames(\n                'flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark',\n                'text-base whitespace-pre',\n                isActive && 'bg-primary-dark',\n                isActive\n                    ? 'text-[#348CFD]'\n                    : 'text-common-bright hover:bg-primary-dark hover:text-primary-light'\n            )}\n        >\n            <span className=\"mr-5\">{label}</span>\n        </div>\n    );\n};\nconst listItemRenderer = DefaultListItemRenderer\n\nenum Sphere_Strategies {\n    FILL_INSIDE = 'FILL_INSIDE',\n    ERASE_INSIDE = 'ERASE_INSIDE'\n}\n\nexport default function SphereScissorsToolEdit ({cornerstoneViewportService, segmentationService}){\n    const { t } = useTranslation('Buttons');\n\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [activeStrategy, setActiveStrategy] = useState(Sphere_Strategies.FILL_INSIDE)\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    const [segments, setSegments] = useState([])\n    const [isEraseOnlyMinimized, setIsEraseOnlyMinimized] = useState(true);\n    const [eraseFocus, setEraseFocus] = useState('All')\n\n    //Update \"erase more\" list on segment modified\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const sscissorsInstance = toolGroup.getToolInstance('RectangleScissor');\n        const added = segmentationService.EVENTS.SEGMENTATION_ADDED;\n        const updated = segmentationService.EVENTS.SEGMENTATION_UPDATED;\n        const removed = segmentationService.EVENTS.SEGMENTATION_REMOVED;\n        const subscriptions = [];\n\n        [added, updated, removed].forEach(evt => {\n            segmentationService.subscribe(evt, () => {\n                    const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n                    setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                            const {label, segmentIndex} = args\n                            sscissorsInstance.setConfiguration({eraseFocusIndex: segmentIndex})\n                            setEraseFocus(label)\n                        }\n                    }}))\n                }\n            );\n        });\n\n        return () => {\n            subscriptions.forEach(unsub => {\n                unsub();\n            });\n        };\n    }, []);\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const sphereInstance = toolGroup.getToolInstance('SphereScissor');\n        setActiveStrategy(sphereInstance.configuration.activeStrategy)\n\n        const segmentation = segmentationService.getSegmentations().filter(s => s.isActive)[0]\n        setSegments([{label: 'All', segmentIndex: 0}, ...segmentation.segments.filter(s => s)].map(s => {return {...s, onClick: (args) => {\n                const {label, segmentIndex} = args\n                setEraseFocus(label)\n                sphereInstance.setConfiguration({eraseFocusIndex: segmentIndex})\n            }\n        }}))\n    }, [])\n\n    useEffect(() => {\n        const toolGroup = csTools.ToolGroupManager.getToolGroupForViewport(\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).id,\n            cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex).renderingEngineId\n        );\n        const sphereInstance = toolGroup.getToolInstance('SphereScissor');\n        sphereInstance.setConfiguration({\n            activeStrategy: activeStrategy,\n        })\n    }, [activeStrategy])\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Sphere Scissors Tool Edit'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\">\n                          {'Mode'}\n                        </span>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]\"\n                            style={{display:'inline-flex', justifyContent:'space-evenly'}}\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeStrategy === Sphere_Strategies.FILL_INSIDE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveStrategy(Sphere_Strategies.FILL_INSIDE)}}\n                            >{'Fill'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={activeStrategy === Sphere_Strategies.ERASE_INSIDE ? 'primary' : 'secondary'}\n                                onClick={() => {setActiveStrategy(Sphere_Strategies.ERASE_INSIDE)}}\n                            >{'Erase'}</Button>\n                        </div>\n                        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n                            <div className=\"bg-primary-dark\">\n                                <div\n                                    className=\"flex cursor-pointer items-center\"\n                                    onClick={evt => {\n                                        evt.stopPropagation();\n                                        setIsEraseOnlyMinimized(!isEraseOnlyMinimized);\n                                    }}\n                                >\n                                    <Icon\n                                        name=\"panel-group-open-close\"\n                                        className={classNames(\n                                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                                            {\n                                                'transform rotate-90': !isEraseOnlyMinimized,\n                                            }\n                                        )}\n                                    />\n                                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                                        {'Erase Options'}\n                                    </span>\n                                </div>\n                                {/* active segmentation */}\n                                {!isEraseOnlyMinimized && (\n                                    <div className=\"pl-2 pr-2\" style={{display:'flex', flexDirection:\"column\"}}>\n                                        <span className=\"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]\">\n                                          {'Erase focus on:'}\n                                        </span>\n                                        <ListMenu\n                                            items={segments}\n                                            renderer={args => listItemRenderer({...args, t, eraseFocus})}\n                                        />\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport classNames from \"classnames\";\nimport Icon from '../../../../../platform/ui/src/components/Icon'\nimport {Button, useViewportGrid, ListMenu} from \"@ohif/ui\";\nimport * as csTools from '@cornerstonejs/tools';\nimport {useTranslation} from \"react-i18next\";\nconst { Enums: csToolsEnums } = csTools\nconst { Events } = csToolsEnums\n\nclass CappedArray extends Array {\n    private readonly maxLength: number;\n\n    constructor(maxLength) {\n        super();\n        this.maxLength = maxLength;\n    }\n\n    push(...elements) {\n        // Appeler la méthode push de la classe Array parente\n        const r = super.push(...elements);\n\n        // Si la longueur dépasse maxLength, retirer les éléments les plus anciens\n        if (this.length > this.maxLength) {\n            const excess = this.length - this.maxLength;\n            this.splice(0, excess);\n        }\n\n        return r\n    }\n}\n\nconst MAX_CACHE_LENGTH = 10\nconst CACHE_SEGMENTATION_VOLUMES = new CappedArray(MAX_CACHE_LENGTH)\n\nexport default function UndoToolEdit ({cornerstoneViewportService, segmentationService}){\n    const { t } = useTranslation('Buttons');\n\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n    const [currentCacheIndex, setCurrentCacheIndex] = useState(CACHE_SEGMENTATION_VOLUMES.length)\n\n    useEffect(() => {\n        const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n        const currentElement = viewport.element\n        // Save previous segmentation states for \"undo\" functionality\n        currentElement.addEventListener(Events.MOUSE_DOWN, evt => {\n            const old_segmentation = segmentationService.getSegmentations()[0]\n            const old_seg_volume = new Uint8ClampedArray(segmentationService.getLabelmapVolume(old_segmentation.id).getScalarData())\n\n            //Add current segmentation volume in cache to save its state\n            if (CACHE_SEGMENTATION_VOLUMES.length === MAX_CACHE_LENGTH) {\n                CACHE_SEGMENTATION_VOLUMES.shift()\n            }\n            CACHE_SEGMENTATION_VOLUMES.push(old_seg_volume)\n            setCurrentCacheIndex(CACHE_SEGMENTATION_VOLUMES.length)\n        })\n    }, [])\n\n    const apply_replace = (cacheIndex) => {\n        const viewport = cornerstoneViewportService.getCornerstoneViewportByIndex(activeViewportIndex)\n        const currentElement = viewport.element\n\n        const previous_volume = CACHE_SEGMENTATION_VOLUMES[cacheIndex]\n        if(!previous_volume) return\n\n        const replace_event = new CustomEvent('UNDO_REDO_TOOL', {\n            detail: {\n                element: currentElement,\n                oldScalarData: previous_volume\n            }\n        })\n        window.dispatchEvent(replace_event)\n        setCurrentCacheIndex(cacheIndex)\n    }\n\n    const undo = () => {\n        if(currentCacheIndex === 0) return\n        apply_replace(currentCacheIndex - 1)\n    }\n\n    const redo = () => {\n        if(currentCacheIndex === MAX_CACHE_LENGTH) return\n        apply_replace(currentCacheIndex + 1)\n    }\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Undo/redo Segmentation'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px] pt-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] justify-evenly inline-flex\"\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={undo}\n                            >{'Undo'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={redo}\n                            >{'Redo'}</Button>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}\n","import React, { useEffect, useState, useCallback } from 'react';\nimport {useViewportGrid} from '@ohif/ui';\nimport * as csTools from '@cornerstonejs/tools';\nconst { Enums: csToolsEnums } = csTools\nconst { Events } = csToolsEnums\nconst { state } = csTools\n\nimport BrushToolEdit from \"./brushToolEdit\";\nimport CircleScissorsToolEdit from \"./cscissorsToolEdit\";\nimport PaintFillToolEdit from \"./paintFillToolEdit\";\nimport RectangleROIStartEndThresholdToolEdit from \"./rectangleROIStartEndToolEdit\";\nimport RectangleROIThresholdToolEdit from \"./rectangleROIToolEdit\";\nimport RectangleScissorsToolEdit from \"./rscissorsToolEdit\";\nimport SphereScissorsToolEdit from \"./sscissorsToolEdit\";\nimport UndoToolEdit from \"./undoToolEdit\";\n\nconst SEG_TOOL_NAMES = [\n    'Brush',\n    'CircleScissor',\n    'PaintFill',\n    'RectangleROIStartEndThreshold',\n    'RectangleROIThreshold',\n    'RectangleScissor',\n    'SphereScissor'\n]\n\nexport default function BaseToolEdit (\n    {\n        segmentationService,\n        toolbarService,\n        toolGroupService,\n        cornerstoneViewportService,\n        commandsManager\n    }){\n    // @ts-ignore\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n    const [activeSegTool, setActiveSegTool] = useState(null)\n\n    const searchActiveSegTool = () => {\n        const toolStates = state.toolGroups.filter(tg => tg.id === 'mpr')[0]?.toolOptions\n        if(!toolStates) setActiveSegTool(null)\n        const toolStatesArray = Object.keys(toolStates).map(function (key) {\n            return [key, toolStates[key]];\n        });\n        let activeSegTool = false\n        toolStatesArray.forEach(tool => {\n            //Check if tool is a segmentation tool\n            if (SEG_TOOL_NAMES.includes(tool[0])){\n                //Check if tool is active\n                if(tool[1].mode === 'Active'){\n                    activeSegTool = true\n                    setActiveSegTool(tool[0])\n                    return;\n                }\n            }\n        })\n        if(!activeSegTool) setActiveSegTool(null)\n    }\n\n    useEffect(() => {\n        searchActiveSegTool()\n    },[])\n\n    useEffect(() => {\n        const { unsubscribe } = toolbarService.subscribe(\n            toolbarService.EVENTS.TOOL_BAR_STATE_MODIFIED,\n            searchActiveSegTool\n        );\n\n        return () => {\n            unsubscribe();\n        };\n    }, [toolbarService]);\n\n    const renderActiveTool = () => {\n        switch (activeSegTool){\n            case 'Brush':\n                return <BrushToolEdit\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    segmentationService={segmentationService}\n                />\n            case 'CircleScissor':\n                return <CircleScissorsToolEdit\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    segmentationService={segmentationService}\n                />\n            case 'PaintFill':\n                return <PaintFillToolEdit />\n            case 'RectangleROIStartEndThreshold':\n                return <RectangleROIStartEndThresholdToolEdit\n                    segmentationService={segmentationService}\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    commandsManager={commandsManager}\n                />\n            case 'RectangleROIThreshold':\n                return <RectangleROIThresholdToolEdit\n                    segmentationService={segmentationService}\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    commandsManager={commandsManager}\n                />\n            case 'RectangleScissor':\n                return <RectangleScissorsToolEdit\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    segmentationService={segmentationService}\n                />\n            case 'SphereScissor':\n                return <SphereScissorsToolEdit\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    segmentationService={segmentationService}\n                />\n            default:\n                return null\n        }\n    }\n\n    return (\n        <>\n            {activeSegTool && (\n                <UndoToolEdit\n                    cornerstoneViewportService={cornerstoneViewportService}\n                    segmentationService={segmentationService}\n                />\n            )}\n            {renderActiveTool()}\n        </>\n    )\n}","import {Button, useViewportGrid, Icon} from \"@ohif/ui\";\nimport React, {useState} from \"react\";\nimport classNames from \"classnames\";\nimport {Segmentation} from \"@ohif/extension-cornerstone/src/services/SegmentationService/SegmentationServiceTypes\";\nimport PropTypes from \"prop-types\";\nimport {saveAs, FileSaver} from 'file-saver'\n\nfunction SegmentsConfigurationImportExport({segmentationService, segmentations}) : React.JSX.Element {\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    const exportConfiguration = () : void => {\n        const json = JSON.stringify(segmentations[0].segments)\n        const json_blob = new Blob([json], {type: \"text/plain;charset=utf-8\"});\n        saveAs(json_blob, 'segments_configuration.json')\n    }\n\n    const importConfiguration = () : void => {\n        console.log('SEGS AT IMPORT', segmentations)\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.accept = 'application/json'\n        input.onchange = _ => {\n            const json_file = Array.from(input.files)[0];\n            const reader = new FileReader();\n            reader.onload = function(event) {\n                try {\n                    if (typeof event.target.result === \"string\") {\n                        for(let i = 1; i < segmentations[0].segments.length; i++){\n                            segmentationService.removeSegment(segmentations[0].id, i)\n                        }\n\n                        const jsonContent = JSON.parse(event.target.result);\n                        jsonContent.forEach(segment => {\n                            if(segment){\n                                const {segmentIndex} = segment\n                                segmentationService.addSegment(\n                                    segmentations[0].id,\n                                    segmentIndex,\n                                    viewports[activeViewportIndex].viewportOptions.toolGroupId,\n                                    segment,\n                                    true\n                                )\n                            }\n                        })\n                    }\n                    else {\n                        console.error(\"ERROR::JSON_READING::CORRUPTED_CONTENT\");\n                    }\n                } catch (error) {\n                    console.error(\"ERROR::JSON_READING\", error);\n                }\n            };\n            reader.readAsText(json_file);\n        };\n        input.click();\n    }\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Segments Configuration I/O'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px] pt-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <div\n                            className=\"text-[#d8d8d8] text-[12px] font-[300] justify-evenly inline-flex\"\n                        >\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={importConfiguration}\n                            >{'Import File'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={exportConfiguration}\n                            >{'Export File'}</Button>\n                        </div>\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}\n\nSegmentsConfigurationImportExport.propTypes = {\n    segmentations: PropTypes.array.isRequired\n}\n\nexport default SegmentsConfigurationImportExport","import {Button, useViewportGrid, Icon} from \"@ohif/ui\";\nimport React, {useEffect, useState} from \"react\";\nimport classNames from \"classnames\";\nimport PropTypes from \"prop-types\";\nimport {saveAs, FileSaver} from 'file-saver'\nimport JSZip from \"jszip\";\nimport ProgressBar from \"@ramonak/react-progress-bar\";\nimport { segmentation as cstSegmentation } from '@cornerstonejs/tools';\nimport { cache } from '@cornerstonejs/core';\n\n\nfunction SegmentationImportExport({segmentationService, segmentations, cornerstoneViewportService}) : React.JSX.Element {\n\n    const [isProcessingLayer, setIsProcessingLayer] = useState(false)\n    const [processingLayerPercent, setProcessingLayerPercent] = useState(0)\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n\n    useEffect(() => {\n        if(isProcessingLayer){\n            setProcessingLayerPercent(0)\n            setTimeout(exportSegmentation, 500)\n        }\n    }, [isProcessingLayer])\n\n    const exportSegmentation = () => {\n        const labelmapVolume = segmentationService.getLabelmapVolume(segmentations[0].id)\n        const {\n            dimensions,\n            direction,\n            scalarData\n        } = labelmapVolume\n        const segments_info = segmentations[0].segments\n        const existing_segment_indexes = segments_info\n            .map((s, i) => {if (s) return i})\n            .filter(i => i)\n        const data = new Uint32Array(scalarData)\n        console.log('START COMPUTING INDEX ARRAY...')\n\n        //Convert segmentation in PNG Images using JSON\n        //Iterate through one layer (one PNG image)\n        const all_layers_blobs = new Array<Blob>(dimensions[2] - 1)\n        for(let layer_i = 0; layer_i < data.length; layer_i += (dimensions[0] * dimensions[1])){\n            const current_processed_layer = layer_i / (dimensions[0] * dimensions[1])\n            const segmented_layer = new Uint8ClampedArray(dimensions[0] * dimensions[1] * 4)\n                .fill(0)\n                .map((el, i) => {return (i - 3) % 4 === 0 ? 255 : el})\n            const scalar_layer = data.slice(layer_i, layer_i + (dimensions[0] * dimensions[1]))\n            //Map through existing segment indexes\n            Promise.allSettled(existing_segment_indexes.map(segment_index => {\n                //Get indexes of values that matches the segment_index in parameter\n                const mapIndexSerial = (segment_index) => {\n                    return scalar_layer\n                        .map((v, i) => {if(v !== 0 && v === segment_index) return i})\n                        .filter(i => i !== 0)\n                }\n                return mapIndexSerial(segment_index)\n            })).then((indexes_array) => {\n                //List of arrays of indexes matching a segment index (length = number of segment indexes)\n\n                indexes_array.forEach((promise, i) => {\n                    const segment_array = promise.value\n                    //Fill segmented layer with corresponding segment color\n                    if(segment_array.length !== 0){\n                        const corresponding_segment_index = existing_segment_indexes[i]\n                        const color_to_fill = [...segments_info[corresponding_segment_index].color, 255]\n                        segment_array.forEach(index_to_color => {\n                            segmented_layer[index_to_color * 4] = color_to_fill[0]\n                            segmented_layer[index_to_color * 4 + 1] = color_to_fill[1]\n                            segmented_layer[index_to_color * 4 + 2] = color_to_fill[2]\n                        })\n                    }\n                })\n\n                // console.log(`SEGMENTED ${current_processed_layer}`, segmented_layer)\n\n                const fillingPromise = () => {\n                    return new Promise<void>((resolve, reject) => {\n                        const canvas = document.createElement('canvas')\n                        const ctx = canvas.getContext('2d')\n                        canvas.width = dimensions[0]\n                        canvas.height = dimensions[1]\n                        const imgData = new ImageData(segmented_layer, dimensions[0], dimensions[1], {colorSpace: \"srgb\"});\n                        ctx.putImageData(imgData, 0, 0)\n                        canvas.toBlob((blob) => {\n                            if(blob){\n                                all_layers_blobs[current_processed_layer] = blob\n                                resolve()\n                            }\n                        }, \"image/png\")\n                    })\n                }\n                fillingPromise().then(() => {\n                    const completed_layers = all_layers_blobs.filter(el => {return el}).length\n                    setProcessingLayerPercent(~~((completed_layers * 100) / dimensions[2]))\n                })\n            })\n        }\n\n        const waitUntilArrayDone = () => {\n            return new Promise<void>((resolve, reject) => {\n                (function waitForArray(){\n                    const completed_layers = all_layers_blobs.filter(el => {return el}).length\n                    if(completed_layers === dimensions[2]) return resolve();\n                    else {\n                        setTimeout(waitForArray, 500);}\n                })()\n            })\n        }\n        waitUntilArrayDone().then(() => {\n            const zip = new JSZip()\n            //Add layers in zip as PNG files\n            all_layers_blobs.forEach((blob, index) => {\n                zip.file(`layer_${index}.png`, blob)\n            })\n\n            //Add segments information as JSON File\n            const json = JSON.stringify(segmentations[0].segments, null, '\\t')\n            const json_blob = new Blob([json], {type: \"text/plain;charset=utf-8\"});\n            zip.file('segmentation_informations.json', json_blob)\n\n            //Add scalar data as binary file\n            const labelmapVolume = segmentationService.getLabelmapVolume(segmentations[0].id);\n            const scalarData = new Uint8Array(labelmapVolume.scalarData);\n            const dataBlob = new Blob([scalarData], { type: 'application/octet-stream' })\n            zip.file('scalarData.bin', dataBlob);\n\n            zip.generateAsync({type:'blob'}).then((content) => {\n                saveAs(content, 'segmentation.zip')\n                setIsProcessingLayer(false)\n            })\n        })\n    }\n\n    const importSegmentation = () => {\n        console.log('SEGS AT IMPORT', segmentations);\n\n        let viewport = viewports[activeViewportIndex];\n        if (viewport.viewportOptions.viewportType !== 'volume') {\n            viewport = viewports.find(vp => vp.viewportOptions.viewportType === 'volume');\n            console.assert(viewport, 'ImportSegmentation: Could not find \"volume\" viewport');\n            viewportGridService.setActiveViewportIndex(viewport.viewportIndex);\n        }\n        const cornerstoneVP = cornerstoneViewportService.getCornerstoneViewport(viewport.id);\n        const actorEntries = cornerstoneVP.getActors();\n        console.assert(actorEntries && actorEntries.length, 'ImportSegmentation: No actors on volume viewport');\n        const imageVolumes = actorEntries.map((va) => {\n            const actorUID = va.referenceId ?? va.uid;\n            return cache.getVolume(actorUID);\n        });\n        const segmentationVolume = imageVolumes.filter(iv => !iv.imageIds)[0];\n        const segmentationId = segmentationVolume.volumeId;\n        const segmentationScalarData = segmentationVolume.getScalarData();\n\n        // Load binary file\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.accept = 'application/octet-stream';\n        input.onchange = async _ => {\n            const file = Array.from(input.files)[0];\n            const reader = new FileReader();\n            reader.onload = async function(event) {\n                const newScalarData = new Uint8Array(event.target.result as ArrayBuffer);\n                // Replace values of current scalar data\n                for (let i = 0; i < segmentationScalarData.length; i++) {\n                    segmentationScalarData[i] = newScalarData[i];\n                }\n                // Trigger rendering\n                cstSegmentation.triggerSegmentationEvents.triggerSegmentationDataModified(segmentationId);\n            }\n            reader.readAsArrayBuffer(file);\n        };\n        input.click();\n    }\n\n    return (\n        <div className=\"flex flex-col min-h-0 font-inter font-[300]\">\n            <div className=\"bg-primary-dark\">\n                <div\n                    className=\"flex cursor-pointer items-center\"\n                    onClick={evt => {\n                        evt.stopPropagation();\n                        setIsMinimized(!isMinimized);\n                    }}\n                >\n                    <Icon\n                        name=\"panel-group-open-close\"\n                        className={classNames(\n                            'w-5 h-5 text-white transition duration-300 cursor-pointer',\n                            {\n                                'transform rotate-90': !isMinimized,\n                            }\n                        )}\n                    />\n                    <span className=\"text-[#d8d8d8] text-[12px] font-[300]\">\n                        {'Segmentations I/O'}\n                    </span>\n                </div>\n                {/* active segmentation */}\n                {!isMinimized && (\n                    <div className=\"pl-2 pr-2 pb-[9px] pt-[9px]\" style={{display:'flex', flexDirection:\"column\"}}>\n                        <div className=\"text-[#d8d8d8] text-[12px] font-[300] justify-evenly flex\">\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={importSegmentation}\n                            >{'Import Segmentation'}</Button>\n                            <Button\n                                fullWidth={true}\n                                size={'small'}\n                                color={'secondary'}\n                                onClick={() => {\n                                    setIsProcessingLayer(true);\n                                    exportSegmentation;\n                                }}\n                            >{'Export Segmentation'}</Button>\n                        </div>\n                        {isProcessingLayer &&\n                            <div className={'w-full mt-[9px]'}>\n                                <p style={{color:'white'}}>{'Processing layers...'}</p>\n                                <ProgressBar\n                                    className={'w-full mt-[3px]'}\n                                    bgColor={processingLayerPercent < 100 ? '#5ACCE6' : '#50C878'}\n                                    completed={processingLayerPercent}\n                                    transitionDuration={\"0.05s\"}\n                                    transitionTimingFunction={\"linear\"}\n                                />\n                            </div>\n                        }\n                    </div>\n                )}\n                <div className=\"h-[6px] bg-black \"></div>\n            </div>\n        </div>\n    )\n}\n\nSegmentationImportExport.propTypes = {\n    segmentations: PropTypes.array.isRequired\n}\n\nexport default SegmentationImportExport\n","import React, {useCallback, useEffect, useState} from 'react';\nimport PropTypes, {element} from 'prop-types';\nimport {Button, SegmentationGroupTable, useViewportGrid, ListMenu} from '@ohif/ui';\nimport callInputDialog from './callInputDialog';\nimport * as csTools from '@cornerstonejs/tools';\nimport BaseToolEdit from \"./segToolsEditSection/baseToolEdit\";\nimport SegmentsConfigurationImportExport from \"./segConfigurationIO\";\nimport SegmentationImportExport from \"./segmentationIO\";\nimport {useTranslation} from 'react-i18next';\n\n\nconst LABELMAP = csTools.Enums.SegmentationRepresentations.Labelmap;\n\nexport default function PanelSegmentation({\n  servicesManager,\n  commandsManager,\n}) {\n  const [{ activeViewportIndex, viewports }, viewportGridService] = useViewportGrid();\n  const {\n      segmentationService,\n      uiDialogService,\n      cornerstoneViewportService,\n      hangingProtocolService,\n      toolGroupService,\n      toolbarService,\n      uiNotificationService\n  } = servicesManager.services;\n\n  const { t } = useTranslation('PanelSegmentation');\n  const [selectedSegmentationId, setSelectedSegmentationId] = useState(null);\n  const [segmentationConfiguration, setSegmentationConfiguration] = useState(\n    segmentationService.getConfiguration()\n  );\n\n  const [segmentations, setSegmentations] = useState(() =>\n    segmentationService.getSegmentations()\n  );\n\n  const [isMinimized, setIsMinimized] = useState({});\n\n  const onToggleMinimizeSegmentation = useCallback(\n    id => {\n      setIsMinimized(prevState => ({\n        ...prevState,\n        [id]: !prevState[id],\n      }));\n    },\n    [setIsMinimized]\n  );\n\n  // Only expand the last segmentation added to the list and collapse the rest\n  useEffect(() => {\n    const lastSegmentationId = segmentations[segmentations.length - 1]?.id;\n    if (lastSegmentationId) {\n      setIsMinimized(prevState => ({\n        ...prevState,\n        [lastSegmentationId]: false,\n      }));\n    }\n  }, [segmentations, setIsMinimized]);\n\n  useEffect(() => {\n    // Change view to default\n    const state = viewportGridService.getState();\n    console.log('STATE', state);\n    console.log('HP', hangingProtocolService.getActiveProtocol());\n    if (hangingProtocolService.getActiveProtocol().protocol.id !== 'mprAnd3DVolumeViewport') {\n        commandsManager.runCommand('toggleHangingProtocol', {\n            protocolId: 'mprAnd3DVolumeViewport',\n            stageIndex: 0,\n        });\n    }\n\n    // ~~ Subscription\n    const added = segmentationService.EVENTS.SEGMENTATION_ADDED;\n    const updated = segmentationService.EVENTS.SEGMENTATION_UPDATED;\n    const removed = segmentationService.EVENTS.SEGMENTATION_REMOVED;\n    const subscriptions = [];\n\n    [added, updated, removed].forEach(evt => {\n      const { unsubscribe } = segmentationService.subscribe(evt, () => {\n        const segmentations = segmentationService.getSegmentations();\n        setSegmentations(segmentations);\n        setSegmentationConfiguration(segmentationService.getConfiguration());\n      });\n      subscriptions.push(unsubscribe);\n    });\n\n    return () => {\n      subscriptions.forEach(unsub => {\n        unsub();\n      });\n    };\n  }, []);\n\n  const onSegmentationClick = (segmentationId: string) => {\n    segmentationService.setActiveSegmentationForToolGroup(segmentationId);\n  };\n\n  const onSegmentationDelete = (segmentationId: string) => {\n    segmentationService.remove(segmentationId);\n  };\n\n  const getToolGroupIds = segmentationId => {\n    const toolGroupIds = segmentationService.getToolGroupIdsWithSegmentation(\n      segmentationId\n    );\n\n    return toolGroupIds;\n  };\n\n  const onSegmentClick = (segmentationId, segmentIndex) => {\n    segmentationService.setActiveSegmentForSegmentation(\n      segmentationId,\n      segmentIndex\n    );\n\n    const toolGroupIds = getToolGroupIds(segmentationId);\n\n    toolGroupIds.forEach(toolGroupId => {\n      // const toolGroupId =\n      segmentationService.setActiveSegmentationForToolGroup(\n        segmentationId,\n        toolGroupId\n      );\n      segmentationService.jumpToSegmentCenter(\n        segmentationId,\n        segmentIndex,\n        toolGroupId\n      );\n    });\n  };\n\n  const onSegmentEdit = (segmentationId, segmentIndex) => {\n    const segmentation = segmentationService.getSegmentation(segmentationId);\n\n    const segment = segmentation.segments[segmentIndex];\n    const { label } = segment;\n\n    callInputDialog(uiDialogService, label, (label, actionId) => {\n      if (label === '') {\n        return;\n      }\n\n      segmentationService.setSegmentLabelForSegmentation(\n        segmentationId,\n        segmentIndex,\n        label\n      );\n    });\n  };\n\n  const onSegmentAdd = (segmentationId) => {\n    const currentSegmentation = segmentationService.getSegmentation(segmentationId)\n    segmentationService.addSegment(\n        segmentationId,\n        currentSegmentation.segments.length,\n        viewports[activeViewportIndex].viewportOptions.toolGroupId,\n        {\n          label: `Segmentation ${currentSegmentation.segmentCount + 1}`,\n          color: [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],\n          opacity: 255,\n          visibility: true,\n          isLocked: false,\n          active: true\n        }\n    )\n  }\n\n  const onSegmentationEdit = segmentationId => {\n    const segmentation = segmentationService.getSegmentation(segmentationId);\n    const { label } = segmentation;\n\n    callInputDialog(uiDialogService, label, (label, actionId) => {\n      if (label === '') {\n        return;\n      }\n\n      segmentationService.addOrUpdateSegmentation(\n        {\n          id: segmentationId,\n          label,\n        },\n        false, // suppress event\n        true // notYetUpdatedAtSource\n      );\n    });\n  };\n\n  const onSegmentColorChange = (segmentationId, segmentIndex, newColor) => {\n    segmentationService.setSegmentColor(\n        segmentationId,\n        segmentIndex,\n        newColor,\n        viewports[activeViewportIndex].viewportOptions.toolGroupId\n    )\n    return;\n  };\n\n  const onSegmentDelete = (segmentationId, segmentIndex) => {\n    segmentationService.removeSegment(\n      segmentationId,\n      segmentIndex\n    );\n  };\n\n  const onToggleSegmentVisibility = (segmentationId, segmentIndex) => {\n    const segmentation = segmentationService.getSegmentation(segmentationId);\n    const segmentInfo = segmentation.segments[segmentIndex];\n    const isVisible = !segmentInfo.isVisible;\n    const toolGroupIds = getToolGroupIds(segmentationId);\n\n    // Todo: right now we apply the visibility to all tool groups\n    toolGroupIds.forEach(toolGroupId => {\n      segmentationService.setSegmentVisibility(\n        segmentationId,\n        segmentIndex,\n        isVisible,\n        toolGroupId\n      );\n    });\n  };\n\n  const onToggleSegmentationVisibility = segmentationId => {\n    segmentationService.toggleSegmentationVisibility(segmentationId);\n  };\n\n  const _setSegmentationConfiguration = useCallback(\n    (segmentationId, key, value) => {\n      segmentationService.setConfiguration({\n        segmentationId,\n        [key]: value,\n      });\n    },\n    [segmentationService]\n  );\n\n  const createSegmentationForSelectedViewport = () => {\n    viewports.forEach(vp => {\n      //Select chosen active viewport to create a segmentation on\n      if(vp.viewportIndex === activeViewportIndex){\n        if(vp.viewportOptions.viewportType === 'volume3d'){\n          uiNotificationService.show({\n            title: 'Create Segmentation',\n            message: 'Can\\'t create segmentation in viewport 3D, select a 2D viewport',\n            type: 'error',\n          });\n          return\n        }\n\n        console.log('SEG VP', vp)\n        segmentationService.createSegmentationForDisplaySet(\n            vp.displaySetInstanceUIDs[0]\n        ).then(segId => {\n          const segmentation = segmentationService.getSegmentation(segId)\n          console.log('CREATED SEGMENTATION', segmentation)\n          segmentationService.addSegmentationRepresentationToToolGroup(\n              vp.viewportOptions.toolGroupId,\n              segId,\n              true,\n              LABELMAP\n          ).then(() => {\n            segmentationService.setActiveSegmentationForToolGroup(\n                segId,\n                vp.viewportOptions.toolGroupId\n            );\n            segmentationService.addSegment(\n                segId,\n                1,\n                viewports[activeViewportIndex].viewportOptions.toolGroupId,\n                {\n                  label: `Segmentation 1`,\n                  color: [255, 0, 0],\n                  opacity: 255,\n                  visibility: true,\n                  isLocked: false,\n                  active: true\n                }\n            )\n            //Add segmentation tools to toolbar\n            console.log('MTOOLS', toolbarService.getButtonSection('MeasurementTools', {}))\n            toolbarService.createButtonSection('primary', [\n                'MeasurementTools',\n                'Zoom',\n                'WindowLevel',\n                'Pan',\n                'Capture',\n                'Crosshairs',\n                'MoreTools',\n                'SegmentationTools'\n            ])\n          });\n\n        })\n      }\n    })\n  }\n\n  // useEffect(() => {\n  //   console.log('SEGMENTATIONS', segmentations)\n  // },)\n\n  const isSegmentationForDisplaySet = () => {\n    const displaySetUID = viewports.filter(vp => vp.viewportIndex === activeViewportIndex)[0]?.displaySetInstanceUIDs[0]\n    const matchingSegs = segmentations.filter(seg => seg.displaySetInstanceUID === displaySetUID)\n    return matchingSegs.length > 0;\n  }\n\n  const volume3dCheck = () => {\n    if (viewports[activeViewportIndex].viewportOptions.viewportType === 'volume3d') {\n      uiNotificationService.show({\n        title: 'Segmentation Panel',\n        message: 'Can\\'t use segmentation panel in viewport 3D, select a 2D viewport',\n        type: 'info',\n      });\n      return true;\n    }\n\n    return false;\n  }\n\n  return (\n    <>\n      { !volume3dCheck() && (\n        <div className=\"flex flex-col flex-auto mt-1\">\n          {/* Segmentation tool edition */}\n          <BaseToolEdit\n              segmentationService={segmentationService}\n              cornerstoneViewportService={cornerstoneViewportService}\n              toolGroupService={toolGroupService}\n              toolbarService={toolbarService}\n              commandsManager={commandsManager}\n          />\n          {isSegmentationForDisplaySet() && (\n              <SegmentsConfigurationImportExport\n                  segmentationService={segmentationService}\n                  segmentations={segmentations}\n              />\n          )}\n          {/* show segmentation table */}\n          {isSegmentationForDisplaySet() ? (\n            <SegmentationGroupTable\n              title={t('Segmentations')}\n              showAddSegment={true}\n              segmentations={segmentations}\n              isMinimized={isMinimized}\n              activeSegmentationId={selectedSegmentationId || ''}\n              onSegmentationClick={onSegmentationClick}\n              onSegmentationDelete={onSegmentationDelete}\n              onSegmentationEdit={onSegmentationEdit}\n              onSegmentClick={onSegmentClick}\n              onSegmentEdit={onSegmentEdit}\n              onSegmentAdd={onSegmentAdd}\n              onSegmentColorChange={onSegmentColorChange}\n              onSegmentDelete={onSegmentDelete}\n              onToggleSegmentVisibility={onToggleSegmentVisibility}\n              onToggleSegmentationVisibility={onToggleSegmentationVisibility}\n              onToggleMinimizeSegmentation={onToggleMinimizeSegmentation}\n              segmentationConfig={{ initialConfig: segmentationConfiguration }}\n              setRenderOutline={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'renderOutline',\n                  value\n                )\n              }\n              setOutlineOpacityActive={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'outlineOpacity',\n                  value\n                )\n              }\n              setRenderFill={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'renderFill',\n                  value\n                )\n              }\n              setRenderInactiveSegmentations={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'renderInactiveSegmentations',\n                  value\n                )\n              }\n              setOutlineWidthActive={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'outlineWidthActive',\n                  value\n                )\n              }\n              setFillAlpha={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'fillAlpha',\n                  value\n                )\n              }\n              setFillAlphaInactive={value =>\n                _setSegmentationConfiguration(\n                  selectedSegmentationId,\n                  'fillAlphaInactive',\n                  value\n                )\n              }\n            />\n          ) : null}\n          {isSegmentationForDisplaySet() ? (\n                  <SegmentationImportExport\n                      segmentationService={segmentationService}\n                      segmentations={segmentations}\n                      cornerstoneViewportService={cornerstoneViewportService}\n                  />\n              ) : segmentations.length === 0 && (\n              <Button\n                  className={'pt-1/10 pb-1/10'}\n                  onClick={createSegmentationForSelectedViewport}\n              >\n                {\"Create Segmentation For Selected Viewport\"}\n              </Button>\n              )\n          }\n        </div>\n      )}\n    </>\n  );\n}\n\nPanelSegmentation.propTypes = {\n  commandsManager: PropTypes.shape({\n    runCommand: PropTypes.func.isRequired,\n  }),\n  servicesManager: PropTypes.shape({\n    services: PropTypes.shape({\n      segmentationService: PropTypes.shape({\n        getSegmentation: PropTypes.func.isRequired,\n        getSegmentations: PropTypes.func.isRequired,\n        toggleSegmentationVisibility: PropTypes.func.isRequired,\n        subscribe: PropTypes.func.isRequired,\n        EVENTS: PropTypes.object.isRequired,\n      }).isRequired,\n    }).isRequired,\n  }).isRequired,\n};\n","import { Types } from '@ohif/core';\n\nconst segProtocol: Types.HangingProtocol.Protocol = {\n  id: '@ohif/seg',\n  // Don't store this hanging protocol as it applies to the currently active\n  // display set by default\n  // cacheId: null,\n  hasUpdatedPriorsInformation: false,\n  name: 'Segmentations',\n  // Just apply this one when specifically listed\n  protocolMatchingRules: [],\n  toolGroupIds: ['default'],\n  // -1 would be used to indicate active only, whereas other values are\n  // the number of required priors referenced - so 0 means active with\n  // 0 or more priors.\n  numberOfPriorsReferenced: 0,\n  // Default viewport is used to define the viewport when\n  // additional viewports are added using the layout tool\n  defaultViewport: {\n    viewportOptions: {\n      viewportType: 'stack',\n      toolGroupId: 'default',\n      allowUnmatchedView: true,\n    },\n    displaySets: [\n      {\n        id: 'segDisplaySetId',\n        matchedDisplaySetsIndex: -1,\n      },\n    ],\n  },\n  displaySetSelectors: {\n    segDisplaySetId: {\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: 'SEG',\n          },\n        },\n      ],\n    },\n  },\n  stages: [\n    {\n      name: 'Segmentations',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 1,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: { allowUnmatchedView: true },\n          displaySets: [\n            {\n              id: 'segDisplaySetId',\n            },\n          ],\n        },\n      ],\n    },\n  ],\n};\n\nfunction getHangingProtocolModule() {\n  return [\n    {\n      name: segProtocol.id,\n      protocol: segProtocol,\n    },\n  ];\n}\n\nexport default getHangingProtocolModule;\nexport { segProtocol };\n","import { id } from './id';\nimport React from 'react';\n\nimport { Types } from '@ohif/core';\n\nimport getSopClassHandlerModule from './getSopClassHandlerModule';\nimport PanelSegmentation from './panels/PanelSegmentation';\nimport getHangingProtocolModule from './getHangingProtocolModule';\n\nconst Component = React.lazy(() => {\n  return import(\n    /* webpackPrefetch: true */ './viewports/OHIFCornerstoneSEGViewport'\n  );\n});\n\nconst OHIFCornerstoneSEGViewport = props => {\n  return (\n    <React.Suspense fallback={<div>Loading...</div>}>\n      <Component {...props} />\n    </React.Suspense>\n  );\n};\n\n/**\n * You can remove any of the following modules if you don't need them.\n */\nconst extension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   * You ID can be anything you want, but it should be unique.\n   */\n  id,\n\n  /**\n   * PanelModule should provide a list of panels that will be available in OHIF\n   * for Modes to consume and render. Each panel is defined by a {name,\n   * iconName, iconLabel, label, component} object. Example of a panel module\n   * is the StudyBrowserPanel that is provided by the default extension in OHIF.\n   */\n  getPanelModule: ({\n    servicesManager,\n    commandsManager,\n    extensionManager,\n  }): Types.Panel[] => {\n    const wrappedPanelSegmentation = () => {\n      return (\n        <PanelSegmentation\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n          extensionManager={extensionManager}\n        />\n      );\n    };\n\n    return [\n      {\n        name: 'panelSegmentation',\n        iconName: 'tab-segmentation',\n        iconLabel: 'Segmentation',\n        label: 'Segmentation',\n        component: wrappedPanelSegmentation,\n      },\n    ];\n  },\n\n  getViewportModule({ servicesManager, extensionManager }) {\n    const ExtendedOHIFCornerstoneSEGViewport = props => {\n      return (\n        <OHIFCornerstoneSEGViewport\n          servicesManager={servicesManager}\n          extensionManager={extensionManager}\n          {...props}\n        />\n      );\n    };\n\n    return [\n      { name: 'dicom-seg', component: ExtendedOHIFCornerstoneSEGViewport },\n    ];\n  },\n  /**\n   * SopClassHandlerModule should provide a list of sop class handlers that will be\n   * available in OHIF for Modes to consume and use to create displaySets from Series.\n   * Each sop class handler is defined by a { name, sopClassUids, getDisplaySetsFromSeries}.\n   * Examples include the default sop class handler provided by the default extension\n   */\n  getSopClassHandlerModule,\n  getHangingProtocolModule,\n};\n\nexport default extension;"],"names":["id","packageJson","SOPClassHandlerId","DicomMessage","DicomMetaDictionary","dcmjs","sopClassUids","loadPromises","_getDisplaySetsFromSeries","instances","servicesManager","extensionManager","instance","StudyInstanceUID","SeriesInstanceUID","SOPInstanceUID","SeriesDescription","SeriesNumber","SeriesDate","SOPClassUID","wadoRoot","wadoUri","wadoUriRoot","displaySet","Modality","loading","isReconstructable","displaySetInstanceUID","utils","guid","referencedImages","referencedSeriesInstanceUID","referencedDisplaySetInstanceUID","isDerivedDisplaySet","isLoaded","isHydrated","segments","isOverlayDisplaySet","referencedSeriesSequence","ReferencedSeriesSequence","Error","referencedSeries","ReferencedInstanceSequence","getReferenceDisplaySet","displaySetService","services","referencedDisplaySets","getDisplaySetsForSeries","length","referencedDisplaySet","referencedVolumeURI","referencedVolumeId","load","async","headers","segDisplaySet","segmentationService","getSegmentation","_segmentationExists","Promise","resolve","reject","Object","keys","utilityModule","getModuleEntry","dicomLoaderService","exports","segArrayBuffer","findDicomDataPromise","dicomData","readFile","dataset","naturalizeDataset","dict","_meta","namifyDataset","meta","Array","isArray","SegmentSequence","forEach","segment","cielab","RecommendedDisplayCIELabValue","rgba","Colors","dicomlab2RGB","map","x","Math","round","push","segmentNumber","SegmentNumber","color","functionalGroups","offset","size","pixelData","label","SegmentLabel","PerFrameFunctionalGroupsSequence","functionalGroup","SegmentIdentificationSequence","ReferencedSegmentNumber","frameSize","ceil","Rows","Columns","nextOffset","segmentKey","numberOfFrames","packedSegment","PixelData","slice","BitArray","unpack","geometry","perFrame","pixelMeasures","SharedFunctionalGroupsSequence","PixelMeasuresSequence","planeOrientation","PlaneOrientationSequence","planePosition","PlanePositionSequence","spacingBetweenSlices","SpacingBetweenSlices","SliceThickness","console","log","spacing","PixelSpacing","Number","dimensions","orientation","ImageOrientationPatient","columnStepToPatient","rowStepToPatient","planeNormal","vtkMath","firstPosition","ImagePositionPatient","lastPosition","sliceStep","direction","concat","origin","geometryFromFunctionalGroups","_getPixelData","_getSegments","_loadSegments","suppressEvents","createSegmentationForSEGDisplaySet","then","catch","error","_load","name","getDisplaySetsFromSeries","uiDialogService","callback","dialogId","onSubmitHandler","action","value","dismiss","create","centralize","isDraggable","showOverlay","content","Dialog","contentProps","title","noCloseButton","onClose","actions","text","type","onSubmit","body","setValue","React","Input","labelClassName","autoFocus","className","onChange","event","persist","target","onKeyPress","key","DualInputRange","value1","value2","minValue","maxValue","step","unit","containerClassName","inputClassName","labelVariant","showLabel","labelPosition","trackColor","rangeValue1","setRangeValue1","useState","rangeValue2","setRangeValue2","useEffect","handleChange1","e","handleChange2","rangeValueForStr1","toFixed","rangeValueForStr2","style","flexDirection","Typography","variant","component","classNames","min","max","background","width","Button","onClick","Enums","csToolsEnums","csTools","MouseBindings","Events","listItemRenderer","DefaultListItemRenderer","activeMode","eraseReplaceFocus","isActive","Brush_Mode","REPLACE","Brush_Tool","getBrushStrategy","tool","mode","EVENT_LISTENERS","BrushToolEdit","cornerstoneViewportService","t","useTranslation","isMinimized","setIsMinimized","isEraseReplaceOnlyMinimized","setIsEraseReplaceOnlyMinimized","setEraseReplaceFocus","pipetteMode","setPipetteMode","active","minimum","activeViewportIndex","viewports","viewportGridService","useViewportGrid","setActiveMode","FILL","activeTool","setActiveTool","CIRCLE","brushSize","setBrushSize","circleThresholdValue","setCircleThresholdValue","circleTargetSegmentIndex","setCircleTargetSegmentIndex","setSegments","toolGroup","getCornerstoneViewportByIndex","renderingEngineId","brushInstance","getToolInstance","configuration","strategySpecificConfiguration","THRESHOLD_INSIDE_CIRCLE","threshold","REPLACE_INSIDE_CIRCLE","targetSegmentIndex","segmentation","getSegmentations","filter","s","segmentIndex","args","setConfiguration","eraseFocusIndex","setToolActive","bindings","mouseButton","Primary","added","EVENTS","SEGMENTATION_ADDED","updated","SEGMENTATION_UPDATED","removed","SEGMENTATION_REMOVED","subscriptions","evt","subscribe","unsub","activeStrategy","viewport","currentElement","element","addEvent","removeEventListener","addEventListener","removeEvent","setToolPassive","MOUSE_DRAG","setThresholdCallback","detail","worldPoints","currentPoints","world","imageData","getImageData","index","worldToIndex","scalarData","csUtils","yMultiple","zMultiple","stopPropagation","Icon","display","justifyContent","fullWidth","SPHERE","THRESHOLD","ERASE","InputRange","ListMenu","items","renderer","vmin","vmax","eraseFocus","Circle_Strategies","CircleScissorsToolEdit","setActiveStrategy","FILL_INSIDE","isEraseOnlyMinimized","setIsEraseOnlyMinimized","setEraseFocus","cscissorsInstance","circleInstance","ERASE_INSIDE","PaintFillToolEdit","RectangleROIStartEndThresholdToolEdit","commandsManager","thresholdValue","setThresholdValue","slicesToPropagate","setSlicesToPropagate","rectangleROIInstance","numSlicesToPropagate","computeThreshold","imageVolumes","getActors","va","actorUID","referenceId","uid","cache","getVolume","iv","selectedAnnotationUIDs","annotationUID","ctVolume","imageIds","segmentationVolume","segmentations","volume","lower","upper","numSlicesToProject","overwrite","overlapType","activeSegmentIndex","deleteRegion","render","RectangleROIThresholdToolEdit","Rectangle_Strategies","RectangleScissorsToolEdit","rscissorsInstance","rectangleInstance","Sphere_Strategies","SphereScissorsToolEdit","sscissorsInstance","sphereInstance","MAX_CACHE_LENGTH","CACHE_SEGMENTATION_VOLUMES","constructor","maxLength","super","this","elements","r","excess","splice","UndoToolEdit","currentCacheIndex","setCurrentCacheIndex","MOUSE_DOWN","old_segmentation","old_seg_volume","Uint8ClampedArray","getLabelmapVolume","getScalarData","shift","apply_replace","cacheIndex","previous_volume","replace_event","CustomEvent","oldScalarData","window","dispatchEvent","undo","redo","state","SEG_TOOL_NAMES","BaseToolEdit","toolbarService","toolGroupService","activeSegTool","setActiveSegTool","searchActiveSegTool","toolStates","toolGroups","tg","toolOptions","toolStatesArray","includes","unsubscribe","TOOL_BAR_STATE_MODIFIED","renderActiveTool","SegmentsConfigurationImportExport","importConfiguration","input","document","createElement","accept","onchange","_","json_file","from","files","reader","FileReader","onload","result","i","removeSegment","JSON","parse","addSegment","viewportOptions","toolGroupId","readAsText","click","exportConfiguration","json","stringify","json_blob","Blob","saveAs","propTypes","PropTypes","isRequired","SegmentationImportExport","isProcessingLayer","setIsProcessingLayer","processingLayerPercent","setProcessingLayerPercent","setTimeout","exportSegmentation","labelmapVolume","segments_info","existing_segment_indexes","data","Uint32Array","all_layers_blobs","layer_i","current_processed_layer","segmented_layer","fill","el","scalar_layer","allSettled","segment_index","v","mapIndexSerial","indexes_array","promise","segment_array","corresponding_segment_index","color_to_fill","index_to_color","canvas","ctx","getContext","height","imgData","ImageData","colorSpace","putImageData","toBlob","blob","completed_layers","waitForArray","zip","JSZip","file","Uint8Array","dataBlob","generateAsync","importSegmentation","viewportType","find","vp","assert","setActiveViewportIndex","viewportIndex","actorEntries","getCornerstoneViewport","segmentationId","volumeId","segmentationScalarData","newScalarData","cstSegmentation","readAsArrayBuffer","ProgressBar","bgColor","completed","transitionDuration","transitionTimingFunction","LABELMAP","Labelmap","PanelSegmentation","hangingProtocolService","uiNotificationService","selectedSegmentationId","setSelectedSegmentationId","segmentationConfiguration","setSegmentationConfiguration","getConfiguration","setSegmentations","onToggleMinimizeSegmentation","useCallback","prevState","lastSegmentationId","getState","getActiveProtocol","protocol","runCommand","protocolId","stageIndex","getToolGroupIds","getToolGroupIdsWithSegmentation","_setSegmentationConfiguration","isSegmentationForDisplaySet","displaySetUID","displaySetInstanceUIDs","seg","show","message","SegmentationGroupTable","showAddSegment","activeSegmentationId","onSegmentationClick","setActiveSegmentationForToolGroup","onSegmentationDelete","remove","onSegmentationEdit","callInputDialog","actionId","addOrUpdateSegmentation","onSegmentClick","setActiveSegmentForSegmentation","jumpToSegmentCenter","onSegmentEdit","setSegmentLabelForSegmentation","onSegmentAdd","currentSegmentation","segmentCount","floor","random","opacity","visibility","isLocked","onSegmentColorChange","newColor","setSegmentColor","onSegmentDelete","onToggleSegmentVisibility","isVisible","setSegmentVisibility","onToggleSegmentationVisibility","toggleSegmentationVisibility","segmentationConfig","initialConfig","setRenderOutline","setOutlineOpacityActive","setRenderFill","setRenderInactiveSegmentations","setOutlineWidthActive","setFillAlpha","setFillAlphaInactive","createSegmentationForSelectedViewport","createSegmentationForDisplaySet","segId","addSegmentationRepresentationToToolGroup","getButtonSection","createButtonSection","segProtocol","hasUpdatedPriorsInformation","protocolMatchingRules","toolGroupIds","numberOfPriorsReferenced","defaultViewport","allowUnmatchedView","displaySets","matchedDisplaySetsIndex","displaySetSelectors","segDisplaySetId","seriesMatchingRules","attribute","constraint","equals","stages","viewportStructure","layoutType","properties","rows","columns","Component","OHIFCornerstoneSEGViewport","props","fallback","getPanelModule","iconName","iconLabel","wrappedPanelSegmentation","getViewportModule","_extends","getSopClassHandlerModule","getHangingProtocolModule"],"sourceRoot":""}