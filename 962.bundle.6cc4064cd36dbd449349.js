(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[962],{73432:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Se});const a=JSON.parse('{"u2":"@ohif/extension-cornerstone-dicom-seg"}').u2,o=`${a}.sopClassHandlerModule.dicom-seg`;var r=n(32735),s=n(92780),i=n(48501),l=n(22737);const{DicomMessage:c,DicomMetaDictionary:m}=l.default.data,d=["1.2.840.10008.5.1.4.1.1.66.4"];let p={};function u(e,t,n){const a=e[0],{StudyInstanceUID:r,SeriesInstanceUID:u,SOPInstanceUID:g,SeriesDescription:E,SeriesNumber:f,SeriesDate:x,SOPClassUID:S,wadoRoot:v,wadoUri:I,wadoUriRoot:h}=a,y={Modality:"SEG",loading:!1,isReconstructable:!0,displaySetInstanceUID:i.utils.guid(),SeriesDescription:E,SeriesNumber:f,SeriesDate:x,SOPInstanceUID:g,SeriesInstanceUID:u,StudyInstanceUID:r,SOPClassHandlerId:o,SOPClassUID:S,referencedImages:null,referencedSeriesInstanceUID:null,referencedDisplaySetInstanceUID:null,isDerivedDisplaySet:!0,isLoaded:!1,isHydrated:!1,segments:{},sopClassUids:d,instance:a,instances:[a],wadoRoot:v,wadoUriRoot:h,wadoUri:I,isOverlayDisplaySet:!0},N=a.ReferencedSeriesSequence;if(!N)throw new Error("ReferencedSeriesSequence is missing for the SEG");const w=N[0];return y.referencedImages=a.ReferencedSeriesSequence.ReferencedInstanceSequence,y.referencedSeriesInstanceUID=w.SeriesInstanceUID,y.getReferenceDisplaySet=()=>{const{displaySetService:e}=t.services,n=e.getDisplaySetsForSeries(y.referencedSeriesInstanceUID);if(!n||0===n.length)throw new Error("Referenced DisplaySet is missing for the SEG");const a=n[0];y.referencedDisplaySetInstanceUID=a.displaySetInstanceUID,y.referencedVolumeURI=a.displaySetInstanceUID;const o=`cornerstoneStreamingImageVolume:${y.referencedVolumeURI}`;return y.referencedVolumeId=o,a},y.load=async e=>{let{headers:a}=e;return await function(e,t,n,a){const{SOPInstanceUID:o}=e,{segmentationService:r}=t.services;if((e.loading||e.isLoaded)&&p[o]&&function(e,t){return t.getSegmentation(e.displaySetInstanceUID)}(e,r))return p[o];return e.loading=!0,p[o]=new Promise((async(t,o)=>{if(!e.segments||0===Object.keys(e.segments).length){const t=await async function(e,t,n){const a=e.getModuleEntry("@ohif/extension-cornerstone.utilityModule.common"),{dicomLoaderService:o}=a.exports,r=await o.findDicomDataPromise(t,null,n),i=c.readFile(r),d=m.naturalizeDataset(i.dict);d._meta=m.namifyDataset(i.meta),Array.isArray(d.SegmentSequence)||(d.SegmentSequence=[d.SegmentSequence]);const p=function(e){const t={};return e.SegmentSequence.forEach((e=>{const n=e.RecommendedDisplayCIELabValue,a=l.default.data.Colors.dicomlab2RGB(n).map((e=>Math.round(255*e)));a.push(255);const o=e.SegmentNumber;t[o]={color:a,functionalGroups:[],offset:null,size:null,pixelData:null,label:e.SegmentLabel}})),e.PerFrameFunctionalGroupsSequence.forEach((e=>{const n=e.SegmentIdentificationSequence.ReferencedSegmentNumber;t[n].functionalGroups.push(e)})),function(e,t){let n=Math.ceil(e.Rows*e.Columns/8),a=0;return Object.keys(t).forEach((o=>{const r=t[o];r.numberOfFrames=r.functionalGroups.length,r.size=r.numberOfFrames*n,r.offset=a,a=r.offset+r.size;const i=e.PixelData[0].slice(r.offset,a);r.pixelData=l.default.data.BitArray.unpack(i),r.geometry=function(e,t){let n=e.SharedFunctionalGroupsSequence.PixelMeasuresSequence,a=e.SharedFunctionalGroupsSequence.PlaneOrientationSequence,o=t[0].PlanePositionSequence;const r={};let i=n.SpacingBetweenSlices;i||n.SliceThickness&&(console.log("Using SliceThickness as SpacingBetweenSlices"),i=n.SliceThickness);r.spacing=[n.PixelSpacing[1],n.PixelSpacing[0],i].map(Number),r.dimensions=[e.Columns,e.Rows,t.length].map(Number);let l=a.ImageOrientationPatient.map(Number);const c=l.slice(0,3),m=l.slice(3,6);r.planeNormal=[],s.default.cross(c,m,r.planeNormal);let d=t[0].PlanePositionSequence.ImagePositionPatient.map(Number),p=t[t.length-1].PlanePositionSequence.ImagePositionPatient.map(Number);return r.sliceStep=[],s.default.subtract(p,d,r.sliceStep),s.default.normalize(r.sliceStep),r.direction=c.concat(m).concat(r.sliceStep),r.origin=o.ImagePositionPatient.map(Number),r}(e,r.functionalGroups)})),t}(e,t)}(d);return p}(n,e,a);e.segments=t}const i=!0;r.createSegmentationForSEGDisplaySet(e,null,i).then((()=>{e.loading=!1,t()})).catch((t=>{e.loading=!1,o(t)}))})),p[o]}(y,t,n,a)},[y]}const g=function(e){let{servicesManager:t,extensionManager:n}=e;return[{name:"dicom-seg",sopClassUids:d,getDisplaySetsFromSeries:e=>u(e,t,n)}]};var E=n(60216),f=n.n(E),x=n(22605);const S=function(e,t,n){const a="enter-segment-label",o=t=>{let{action:o,value:r}=t;switch(o.id){case"save":n(r.label,o.id);break;case"cancel":n("",o.id)}e.dismiss({id:a})};e&&e.create({id:a,centralize:!0,isDraggable:!1,showOverlay:!0,content:x.Vq,contentProps:{title:"Segment",value:{label:t},noCloseButton:!0,onClose:()=>e.dismiss({id:a}),actions:[{id:"cancel",text:"Cancel",type:"primary"},{id:"save",text:"Confirm",type:"secondary"}],onSubmit:o,body:e=>{let{value:t,setValue:n}=e;return r.createElement(x.II,{label:"Enter the segment label",labelClassName:"text-white text-[14px] leading-[1.2]",autoFocus:!0,className:"bg-black border-primary-main",type:"text",value:t.label,onChange:e=>{e.persist(),n((t=>({...t,label:e.target.value})))},onKeyPress:e=>{"Enter"===e.key&&o({value:t,action:{id:"save"}})}})}}})};var v=n(29905),I=n(40841),h=n.n(I),y=n(96665),N=n(20777),w=n(81122);const b=e=>{let{value1:t,value2:n,onChange:a,minValue:o,maxValue:s,step:i=1,unit:l="",containerClassName:c,inputClassName:m,labelClassName:d,labelVariant:p,showLabel:u=!0,labelPosition:g="",trackColor:E}=e;const[f,S]=(0,r.useState)(t),[v,I]=(0,r.useState)(n);(0,r.useEffect)((()=>{t<o||(S(t),n>s||I(n))}),[t,n]);const y=e=>{const t=Number(e.target.value);t<o||(S(t),a(t,v))},N=e=>{const t=Number(e.target.value);t>s||(I(t),a(f,t))},b=i>=1?f.toFixed(0):f.toFixed(1),C=i>=1?v.toFixed(0):v.toFixed(1);return r.createElement("div",{style:{flexDirection:"column"},className:`flex items-center cursor-pointer space-x-1 ${c||""}`},u&&"left"===g&&r.createElement(r.Fragment,null,r.createElement(w.Z,{variant:p??"subtitle",component:"p",className:h()("w-8",d??"text-white")},b,l),r.createElement(w.Z,{variant:p??"subtitle",component:"p",className:h()("w-8",d??"text-white")},C,l)),r.createElement("div",{style:{flexDirection:"row"},className:"flex pb-[5px]"},r.createElement("input",{type:"range",min:o,max:s,value:f,className:`appearance-none h-[3px] rounded-lg input-range-thumb-design ${m||""}`,style:{background:"#3a3f99"},onChange:y,id:"myRange1",step:i}),r.createElement("input",{type:"range",min:o,max:s,value:v,className:`appearance-none h-[3px] rounded-lg input-range-thumb-design ${m||""}`,style:{background:"#3a3f99"},onChange:N,id:"myRange2",step:i})),u&&(!g||"right"===g)&&r.createElement("div",{style:{flexDirection:"row",width:"100%"},className:"flex pb-[5px]"},r.createElement(w.Z,{variant:p??"subtitle",component:"p",className:h()("w-1/2",d??"text-white","flex","justify-center")},"Min : ",b,l),r.createElement(w.Z,{variant:p??"subtitle",component:"p",className:h()("w-1/2",d??"text-white","flex","justify-center")},"Max : ",C,l)),r.createElement("div",{className:"flex",style:{width:"100%"}},r.createElement("div",{className:"flex w-1/2 justify-center"},r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:f-10}})}},"--"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:f-1}})}},"-"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:f+1}})}},"+"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:f+10}})}},"++")),r.createElement("div",{className:"flex w-1/2 justify-center"},r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{N({target:{value:v-10}})}},"--"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{N({target:{value:v-1}})}},"-"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{N({target:{value:v+1}})}},"+"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{N({target:{value:v+10}})}},"++"))))};var C=n(21572),T=n(36791);const{Enums:D}=v,{MouseBindings:R,Events:V}=D,A=e=>{let{label:t,t:n,eraseFocus:a}=e;const o=t===a;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",o&&"bg-primary-dark",o?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},t))};var k=function(e){return e.FILL_INSIDE_CIRCLE="FILL_INSIDE_CIRCLE",e.THRESHOLD_INSIDE_CIRCLE="THRESHOLD_INSIDE_CIRCLE",e.THRESHOLD_INSIDE_SPHERE="THRESHOLD_INSIDE_SPHERE",e.ERASE_INSIDE_CIRCLE="ERASE_INSIDE_CIRCLE",e.FILL_INSIDE_SPHERE="FILL_INSIDE_SPHERE",e.ERASE_INSIDE_SPHERE="ERASE_INSIDE_SPHERE",e}(k||{});const O=[];function _(e){let{cornerstoneViewportService:t,segmentationService:n}=e;const{t:a}=(0,C.$G)("Buttons"),[o,s]=(0,r.useState)(!1),[i,l]=(0,r.useState)(!0),[c,m]=(0,r.useState)("All"),[d,p]=(0,r.useState)({active:!1,minimum:!0}),[{activeViewportIndex:u,viewports:g},E]=(0,x.O_)(),[f,S]=(0,r.useState)(k.FILL_INSIDE_CIRCLE),[I,w]=(0,r.useState)(25),[D,_]=(0,r.useState)([-1e3,5e3]),[M,P]=(0,r.useState)([]);(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(u).id,t.getCornerstoneViewportByIndex(u).renderingEngineId).getToolInstance("Brush");S(e.configuration.activeStrategy),w(e.configuration.brushSize),_(e.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold);const a=n.getSegmentations().filter((e=>e.isActive))[0];P([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;m(n),e.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(u).id,t.getCornerstoneViewportByIndex(u).renderingEngineId).getToolInstance("Brush"),a=n.EVENTS.SEGMENTATION_ADDED,o=n.EVENTS.SEGMENTATION_UPDATED,r=n.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((t=>{n.subscribe(t,(()=>{const t=n.getSegmentations().filter((e=>e.isActive))[0];P([{label:"All",segmentIndex:0},...t.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;e.setConfiguration({eraseFocusIndex:a}),m(n)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(u).id,t.getCornerstoneViewportByIndex(u).renderingEngineId).getToolInstance("Brush").setConfiguration({brushSize:I,activeStrategy:f,strategySpecificConfiguration:{THRESHOLD_INSIDE_CIRCLE:{threshold:D}}})}),[I,f,D]);return(0,r.useEffect)((()=>{const e=t.getCornerstoneViewportByIndex(u),n=v.ToolGroupManager.getToolGroupForViewport(e.id,e.renderingEngineId),a=e.element;a.addEvent=(e,t)=>{O[e]&&(a.removeEventListener(e,O[e]),O[e]=null),O[e]=t,a.addEventListener(e,t)},a.removeEvent=e=>{a.removeEventListener(e,O[e]),O[e]=null},d.active?(n.setToolPassive("Brush"),n.setToolActive("DragProbe",{bindings:[{mouseButton:R.Primary}]}),a.addEvent(V.MOUSE_DRAG,(e=>{((e,n)=>{if(1===e.detail.mouseButton){const a=t.getCornerstoneViewportByIndex(u),o=e.detail.currentPoints.world,r=a.getImageData(),s=r.imageData.worldToIndex(o).map(Math.round);s[0]=Math.round(s[0]),s[1]=Math.round(s[1]),s[2]=Math.round(s[2]);const{scalarData:i,dimensions:l}=r;if(T.utilities.indexWithinDimensions(s,l)){const e=l[0],t=l[0]*l[1],a=i[s[2]*t+s[1]*e+s[0]];_(n?[a,D[1]]:[D[0],a])}}})(e,d.minimum)}))):(n.setToolPassive("DragProbe"),n.setToolActive("Brush",{bindings:[{mouseButton:R.Primary}]}),a.removeEvent(V.MOUSE_DRAG))}),[d.active,d.minimum]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),s(!o)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!o})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Paint Brush Tool Edit")),!o&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Filling mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:f===k.FILL_INSIDE_CIRCLE?"primary":"secondary",onClick:()=>{S(k.FILL_INSIDE_CIRCLE)}},"Circle"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:f===k.THRESHOLD_INSIDE_CIRCLE?"primary":"secondary",onClick:()=>{S(k.THRESHOLD_INSIDE_CIRCLE)}},"Circle Threshold")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:f===k.FILL_INSIDE_SPHERE?"primary":"secondary",onClick:()=>{S(k.FILL_INSIDE_SPHERE)}},"Sphere"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:f===k.THRESHOLD_INSIDE_SPHERE?"primary":"secondary",onClick:()=>{S(k.THRESHOLD_INSIDE_SPHERE)}},"Sphere Threshold")),r.createElement("div",{className:"h-[1px] bg-[#212456] mb-[8px] mx-1"}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Erase mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:f===k.ERASE_INSIDE_CIRCLE?"primary":"secondary",onClick:()=>{S(k.ERASE_INSIDE_CIRCLE)}},"Circle"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:f===k.ERASE_INSIDE_SPHERE?"primary":"secondary",onClick:()=>{S(k.ERASE_INSIDE_SPHERE)}},"Sphere")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),l(!i)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!i})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!i&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:M,renderer:e=>A({...e,t:a,eraseFocus:c})})))),r.createElement("div",{className:"h-[1px] bg-[#212456] mb-[8px] mx-1 mt-[8px]"}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Attributes"),r.createElement("div",{className:"flex items-center col-span-2"},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]"},"Radius"),r.createElement(N.Z,{minValue:0,maxValue:100,value:I,onChange:e=>{w(e)},step:1,containerClassName:"mt-[4px] mb-[4px]",inputClassName:"w-[64px]",labelClassName:"text-white text-[12px]",unit:"px"})),(f===k.THRESHOLD_INSIDE_CIRCLE||f===k.THRESHOLD_INSIDE_SPHERE)&&r.createElement("div",{className:"flex items-center col-span-2",style:{flexDirection:"column",width:"100%"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]",style:{width:"100%"}},"Threshold values"),r.createElement(b,{minValue:-1e3,maxValue:5e3,value1:D[0],value2:D[1],onChange:(e,t)=>{_([e,t])},step:5,containerClassName:"mt-[4px] mb-[4px] w-full",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:"HU"}),r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]",style:{width:"100%"}},"Select threshold value with pipette for :"),r.createElement("div",{className:"flex flex-row justify-evenly w-full mb-[8px]"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{p({active:!0,minimum:!0})}},"Minimum"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{p({active:!0,minimum:!1})}},"Maximum")),d.active&&r.createElement(x.zx,{size:"small",color:"secondary",onClick:()=>{p({active:!1,minimum:!0})}},"Back to annotation"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const M=e=>{let{label:t,t:n,eraseFocus:a}=e;const o=t===a;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",o&&"bg-primary-dark",o?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},t))};var P=function(e){return e.FILL_INSIDE="FILL_INSIDE",e.ERASE_INSIDE="ERASE_INSIDE",e}(P||{});function F(e){let{cornerstoneViewportService:t,segmentationService:n}=e;const{t:a}=(0,C.$G)("Buttons"),[o,s]=(0,r.useState)(!1),[i,l]=(0,r.useState)(P.FILL_INSIDE),[{activeViewportIndex:c,viewports:m},d]=(0,x.O_)(),[p,u]=(0,r.useState)([]),[g,E]=(0,r.useState)(!0),[f,S]=(0,r.useState)("All");return(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("CircleScissor"),a=n.EVENTS.SEGMENTATION_ADDED,o=n.EVENTS.SEGMENTATION_UPDATED,r=n.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((t=>{n.subscribe(t,(()=>{const t=n.getSegmentations().filter((e=>e.isActive))[0];u([{label:"All",segmentIndex:0},...t.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;e.setConfiguration({eraseFocusIndex:a}),S(n)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("CircleScissor");l(e.configuration.activeStrategy);const a=n.getSegmentations().filter((e=>e.isActive))[0];u([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;S(n),e.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("CircleScissor").setConfiguration({activeStrategy:i})}),[i]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),s(!o)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!o})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Circle Segmentation Tool Edit")),!o&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:i===P.FILL_INSIDE?"primary":"secondary",onClick:()=>{l(P.FILL_INSIDE)}},"Fill"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:i===P.ERASE_INSIDE?"primary":"secondary",onClick:()=>{l(P.ERASE_INSIDE)}},"Erase")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),E(!g)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!g})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!g&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:p,renderer:e=>M({...e,t:a,eraseFocus:f})}))))),r.createElement("div",{className:"h-[6px] bg-black "})))}function L(e){let{}=e;const[t,n]=(0,r.useState)(!1);return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),n(!t)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!t})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Fill Holes Tool Edit")),!t&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"No configurations for this tool")),r.createElement("div",{className:"h-[6px] bg-black "})))}const{Enums:G}=v,{MouseBindings:B,Events:z}=G,U=[];function H(e){let{segmentationService:t,cornerstoneViewportService:n,commandsManager:a}=e;const[o,s]=(0,r.useState)(!1),[{activeViewportIndex:i,viewports:l},c]=(0,x.O_)(),[m,d]=(0,r.useState)([-1e3,5e3]),[p,u]=(0,r.useState)(0),[g,E]=(0,r.useState)({active:!1,minimum:!0});(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(n.getCornerstoneViewportByIndex(i).id,n.getCornerstoneViewportByIndex(i).renderingEngineId).getToolInstance("RectangleROIStartEndThreshold");u(e.configuration.numSlicesToPropagate)}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(n.getCornerstoneViewportByIndex(i).id,n.getCornerstoneViewportByIndex(i).renderingEngineId).getToolInstance("RectangleROIStartEndThreshold").setConfiguration({numSlicesToPropagate:p})}),[p]);(0,r.useEffect)((()=>{const e=n.getCornerstoneViewportByIndex(i),t=v.ToolGroupManager.getToolGroupForViewport(e.id,e.renderingEngineId),a=e.element;a.addEvent=(e,t)=>{U[e]&&(a.removeEventListener(e,U[e]),U[e]=null),U[e]=t,a.addEventListener(e,t)},a.removeEvent=e=>{a.removeEventListener(e,U[e]),U[e]=null},g.active?(t.setToolPassive("Brush"),t.setToolActive("DragProbe",{bindings:[{mouseButton:B.Primary}]}),a.addEvent(z.MOUSE_DRAG,(e=>{((e,t)=>{if(1===e.detail.mouseButton){const a=n.getCornerstoneViewportByIndex(i),o=e.detail.currentPoints.world,r=a.getImageData(),s=r.imageData.worldToIndex(o).map(Math.round);s[0]=Math.round(s[0]),s[1]=Math.round(s[1]),s[2]=Math.round(s[2]);const{scalarData:l,dimensions:c}=r;if(T.utilities.indexWithinDimensions(s,c)){const e=c[0],n=c[0]*c[1],a=l[s[2]*n+s[1]*e+s[0]];d(t?[a,m[1]]:[m[0],a])}}})(e,g.minimum)}))):(t.setToolPassive("DragProbe"),t.setToolActive("Brush",{bindings:[{mouseButton:B.Primary}]}),a.removeEvent(z.MOUSE_DRAG))}),[g.active,g.minimum]);return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),s(!o)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!o})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"3D Rectangle Threshold Segmentation Tool Edit")),!o&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"flex items-center col-span-2",style:{flexDirection:"column",width:"100%"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]",style:{width:"100%"}},"Threshold values"),r.createElement(b,{minValue:-1e3,maxValue:5e3,value1:m[0],value2:m[1],onChange:(e,t)=>{d([e,t])},step:5,containerClassName:"mt-[4px] mb-[4px] w-full",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:""}),r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]",style:{width:"100%"}},"Select threshold value with pipette for :"),r.createElement("div",{className:"flex flex-row justify-evenly w-full mb-[8px]"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{E({active:!0,minimum:!0})}},"Minimum"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{E({active:!0,minimum:!1})}},"Maximum")),g.active&&r.createElement(x.zx,{size:"small",color:"secondary",onClick:()=>{E({active:!1,minimum:!0})}},"Back to annotation")),r.createElement("div",{className:"flex items-center col-span-2",style:{width:"100%",flexDirection:"column"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]",style:{width:"100%"}},"Slices Propagation"),r.createElement(N.Z,{minValue:0,maxValue:200,value:p,onChange:e=>{u(e)},step:1,containerClassName:"mt-[4px] mb-[4px] w-full",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:""})),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const e=n.getCornerstoneViewportByIndex(i).getActors().map((e=>{const t=e.referenceId??e.uid;return T.cache.getVolume(t)})).filter((e=>!!e)),a=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIStartEndThreshold");if(!a)throw new Error("No annotation selected ");const o=a[0];if(!v.annotation.state.getAnnotation(o))return;const r=e.filter((e=>e.imageIds))[0],s=e.filter((e=>!e.imageIds))[0],l=t.getSegmentations();v.utilities.segmentation.rectangleROIThresholdVolumeByRange(a,s,[{volume:r,lower:m[0],upper:m[1]}],{numSlicesToProject:0,overwrite:!1,overlapType:1,segmentIndex:l[0].activeSegmentIndex})})()}},"Compute Threshold")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const e=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIStartEndThreshold");if(!e)throw new Error("No annotation selected ");console.log("selected annotation uid",e);const t=e[0];console.log("CSTOOLS STATE",v.annotation.state),v.annotation.state.removeAnnotation(t),n.getCornerstoneViewportByIndex(i).render()})()}},"Delete selected region"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const{Enums:j}=v,{MouseBindings:q,Events:W}=j,Z=[];function $(e){let{segmentationService:t,cornerstoneViewportService:n,commandsManager:a}=e;const[o,s]=(0,r.useState)(!1),[{activeViewportIndex:i,viewports:l},c]=(0,x.O_)(),[m,d]=(0,r.useState)([-1e3,5e3]),[p,u]=(0,r.useState)({active:!1,minimum:!0});(0,r.useEffect)((()=>{const e=n.getCornerstoneViewportByIndex(i),t=v.ToolGroupManager.getToolGroupForViewport(e.id,e.renderingEngineId),a=e.element;a.addEvent=(e,t)=>{Z[e]&&(a.removeEventListener(e,Z[e]),Z[e]=null),Z[e]=t,a.addEventListener(e,t)},a.removeEvent=e=>{a.removeEventListener(e,Z[e]),Z[e]=null},p.active?(t.setToolPassive("Brush"),t.setToolActive("DragProbe",{bindings:[{mouseButton:q.Primary}]}),a.addEvent(W.MOUSE_DRAG,(e=>{((e,t)=>{if(1===e.detail.mouseButton){const a=n.getCornerstoneViewportByIndex(i),o=e.detail.currentPoints.world,r=a.getImageData(),s=r.imageData.worldToIndex(o).map(Math.round);s[0]=Math.round(s[0]),s[1]=Math.round(s[1]),s[2]=Math.round(s[2]);const{scalarData:l,dimensions:c}=r;if(T.utilities.indexWithinDimensions(s,c)){const e=c[0],n=c[0]*c[1],a=l[s[2]*n+s[1]*e+s[0]];d(t?[a,m[1]]:[m[0],a])}}})(e,p.minimum)}))):(t.setToolPassive("DragProbe"),t.setToolActive("Brush",{bindings:[{mouseButton:q.Primary}]}),a.removeEvent(W.MOUSE_DRAG))}),[p.active,p.minimum]);return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),s(!o)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!o})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Rectangle Threshold Segmentation Tool Edit")),!o&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"flex items-center col-span-2 pb-[9px]",style:{flexDirection:"column",width:"100%"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pb-[3px]",style:{width:"100%"}},"Threshold values"),r.createElement(b,{minValue:-1e3,maxValue:5e3,value1:m[0],value2:m[1],onChange:(e,t)=>{d([e,t])},step:5,containerClassName:"mt-[4px] mb-[4px] w-full pb-[3px]",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:"HU"}),r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]",style:{width:"100%"}},"Select threshold value with pipette for :"),r.createElement("div",{className:"flex flex-row justify-evenly w-full mb-[8px]"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{u({active:!0,minimum:!0})}},"Minimum"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{u({active:!0,minimum:!1})}},"Maximum")),p.active&&r.createElement(x.zx,{size:"small",color:"secondary",onClick:()=>{u({active:!1,minimum:!0})}},"Back to annotation")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const e=n.getCornerstoneViewportByIndex(i).getActors().map((e=>{const t=e.referenceId??e.uid;return T.cache.getVolume(t)})).filter((e=>!!e)),a=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIThreshold");if(!a)throw new Error("No annotation selected ");const o=a[0];if(!v.annotation.state.getAnnotation(o))return;const r=e.filter((e=>e.imageIds))[0],s=e.filter((e=>!e.imageIds))[0],l=t.getSegmentations();console.log("SEGMENTATION",l),v.utilities.segmentation.rectangleROIThresholdVolumeByRange(a,s,[{volume:r,lower:m[0],upper:m[1]}],{numSlicesToProject:0,overwrite:!1,overlapType:1,segmentIndex:l[0].activeSegmentIndex})})()}},"Compute Threshold")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const e=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIThreshold");if(!e)throw new Error("No annotation selected ");console.log("selected annotation uid",e);const t=e[0];console.log("CSTOOLS STATE",v.annotation.state),v.annotation.state.removeAnnotation(t),n.getCornerstoneViewportByIndex(i).render()})()}},"Delete selected region"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const J=e=>{let{label:t,t:n,eraseFocus:a}=e;const o=t===a;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",o&&"bg-primary-dark",o?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},t))};var Q=function(e){return e.FILL_INSIDE="FILL_INSIDE",e.ERASE_INSIDE="ERASE_INSIDE",e}(Q||{});function X(e){let{cornerstoneViewportService:t,segmentationService:n}=e;const{t:a}=(0,C.$G)("Buttons"),[o,s]=(0,r.useState)(!1),[i,l]=(0,r.useState)(Q.FILL_INSIDE),[{activeViewportIndex:c,viewports:m},d]=(0,x.O_)(),[p,u]=(0,r.useState)([]),[g,E]=(0,r.useState)(!0),[f,S]=(0,r.useState)("All");return(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("RectangleScissor"),a=n.EVENTS.SEGMENTATION_ADDED,o=n.EVENTS.SEGMENTATION_UPDATED,r=n.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((t=>{n.subscribe(t,(()=>{const t=n.getSegmentations().filter((e=>e.isActive))[0];u([{label:"All",segmentIndex:0},...t.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;e.setConfiguration({eraseFocusIndex:a}),S(n)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("RectangleScissor");l(e.configuration.activeStrategy);const a=n.getSegmentations().filter((e=>e.isActive))[0];u([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;S(n),e.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("RectangleScissor").setConfiguration({activeStrategy:i})}),[i]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),s(!o)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!o})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Rectangle Scissors Tool Edit")),!o&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:i===Q.FILL_INSIDE?"primary":"secondary",onClick:()=>{l(Q.FILL_INSIDE)}},"Fill"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:i===Q.ERASE_INSIDE?"primary":"secondary",onClick:()=>{l(Q.ERASE_INSIDE)}},"Erase")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),E(!g)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!g})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!g&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:p,renderer:e=>J({...e,t:a,eraseFocus:f})}))))),r.createElement("div",{className:"h-[6px] bg-black "})))}const K=e=>{let{label:t,t:n,eraseFocus:a}=e;const o=t===a;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",o&&"bg-primary-dark",o?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},t))};var Y=function(e){return e.FILL_INSIDE="FILL_INSIDE",e.ERASE_INSIDE="ERASE_INSIDE",e}(Y||{});function ee(e){let{cornerstoneViewportService:t,segmentationService:n}=e;const{t:a}=(0,C.$G)("Buttons"),[o,s]=(0,r.useState)(!1),[i,l]=(0,r.useState)(Y.FILL_INSIDE),[{activeViewportIndex:c,viewports:m},d]=(0,x.O_)(),[p,u]=(0,r.useState)([]),[g,E]=(0,r.useState)(!0),[f,S]=(0,r.useState)("All");return(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("RectangleScissor"),a=n.EVENTS.SEGMENTATION_ADDED,o=n.EVENTS.SEGMENTATION_UPDATED,r=n.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((t=>{n.subscribe(t,(()=>{const t=n.getSegmentations().filter((e=>e.isActive))[0];u([{label:"All",segmentIndex:0},...t.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;e.setConfiguration({eraseFocusIndex:a}),S(n)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("SphereScissor");l(e.configuration.activeStrategy);const a=n.getSegmentations().filter((e=>e.isActive))[0];u([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((t=>({...t,onClick:t=>{const{label:n,segmentIndex:a}=t;S(n),e.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(c).id,t.getCornerstoneViewportByIndex(c).renderingEngineId).getToolInstance("SphereScissor").setConfiguration({activeStrategy:i})}),[i]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),s(!o)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!o})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Sphere Scissors Tool Edit")),!o&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:i===Y.FILL_INSIDE?"primary":"secondary",onClick:()=>{l(Y.FILL_INSIDE)}},"Fill"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:i===Y.ERASE_INSIDE?"primary":"secondary",onClick:()=>{l(Y.ERASE_INSIDE)}},"Erase")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),E(!g)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!g})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!g&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:p,renderer:e=>K({...e,t:a,eraseFocus:f})}))))),r.createElement("div",{className:"h-[6px] bg-black "})))}const te=["Brush","CircleScissor","PaintFill","RectangleROIStartEndThreshold","RectangleROIThreshold","RectangleScissor","SphereScissor"];function ne(e){let{segmentationService:t,toolbarService:n,toolGroupService:a,cornerstoneViewportService:o,commandsManager:s}=e;const[{activeViewportIndex:i,viewports:l},c]=(0,x.O_)(),[m,d]=(0,r.useState)(null),p=()=>{const e=o.getCornerstoneViewportByIndex(i).id,t=a.getToolGroupForViewport(e).toolOptions,n=Object.keys(t).map((function(e){return[e,t[e]]}));let r=!1;n.forEach((e=>{if(te.includes(e[0])&&"Active"===e[1].mode)return r=!0,void d(e[0])})),r||d(null)};(0,r.useEffect)((()=>{p()}),[]),(0,r.useEffect)((()=>{const{unsubscribe:e}=n.subscribe(n.EVENTS.TOOL_BAR_STATE_MODIFIED,p);return()=>{e()}}),[n]);return(()=>{switch(m){case"Brush":return r.createElement(_,{cornerstoneViewportService:o,segmentationService:t});case"CircleScissor":return r.createElement(F,{cornerstoneViewportService:o,segmentationService:t});case"PaintFill":return r.createElement(L,null);case"RectangleROIStartEndThreshold":return r.createElement(H,{segmentationService:t,cornerstoneViewportService:o,commandsManager:s});case"RectangleROIThreshold":return r.createElement($,{segmentationService:t,cornerstoneViewportService:o,commandsManager:s});case"RectangleScissor":return r.createElement(X,{cornerstoneViewportService:o,segmentationService:t});case"SphereScissor":return r.createElement(ee,{cornerstoneViewportService:o,segmentationService:t});default:return null}})()}var ae=n(45546);function oe(e){let{segmentationService:t,segmentations:n}=e;const[a,o]=(0,r.useState)(!1),[{activeViewportIndex:s,viewports:i},l]=(0,x.O_)();return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(x.JO,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Segments Configuration I/O")),!a&&r.createElement("div",{className:"pl-2 pb-[9px] pt-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] justify-evenly flex"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{console.log("SEGS AT IMPORT",n);const e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=a=>{const o=Array.from(e.files)[0],r=new FileReader;r.onload=function(e){try{if("string"==typeof e.target.result){for(let e=1;e<n[0].segments.length;e++)t.removeSegment(n[0].id,e);JSON.parse(e.target.result).forEach((e=>{if(e){const{segmentIndex:a}=e;t.addSegment(n[0].id,a,i[s].viewportOptions.toolGroupId,e,!0)}}))}else console.error("ERROR::JSON_READING::CORRUPTED_CONTENT")}catch(e){console.error("ERROR::JSON_READING",e)}},r.readAsText(o)},e.click()}},"Import File"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{const e=JSON.stringify(n[0].segments),t=new Blob([e],{type:"text/plain;charset=utf-8"});(0,ae.saveAs)(t,"segments_configuration.json")}},"Export File"))),r.createElement("div",{className:"h-[6px] bg-black "})))}oe.propTypes={segmentations:f().array.isRequired};const re=oe;var se=n(62467),ie=n.n(se),le=n(22148);function ce(e){let{segmentationService:t,segmentations:n}=e;const[a,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(0);(0,r.useEffect)((()=>{a&&(i(0),setTimeout(l,500))}),[a]);const l=()=>{const e=t.getLabelmapVolume(n[0].id),{dimensions:a,direction:r,scalarData:s}=e,l=n[0].segments,c=l.map(((e,t)=>{if(e)return t})).filter((e=>e)),m=new Uint32Array(s);console.log("START COMPUTING INDEX ARRAY...");const d=new Array(a[0]-1);for(let e=0;e<m.length;e+=a[1]*a[2]){const t=e/(a[1]*a[2]),n=new Uint8ClampedArray(a[1]*a[2]*4).fill(0).map(((e,t)=>(t-3)%4==0?255:e)),o=m.slice(e,e+a[1]*a[2]);Promise.allSettled(c.map((e=>(e=>o.map(((t,n)=>{if(0!==t&&t===e)return n})).filter((e=>0!==e)))(e)))).then((e=>{e.forEach(((e,t)=>{const a=e.value;if(0!==a.length){const e=c[t],o=[...l[e].color,255];a.forEach((e=>{n[4*e]=o[0],n[4*e+1]=o[1],n[4*e+2]=o[2]}))}}));new Promise(((e,o)=>{const r=document.createElement("canvas"),s=r.getContext("2d");r.width=a[1],r.height=a[2];const i=new ImageData(n,a[1],a[2]);s.putImageData(i,0,0),r.toBlob((n=>{n&&(d[t]=n,e())}),"image/png")})).then((()=>{const e=d.filter((e=>e)).length;i(~~(100*e/a[0]))}))}))}new Promise(((e,t)=>{!function t(){if(d.filter((e=>e)).length===a[0])return e();setTimeout(t,500)}()})).then((()=>{const e=new(ie());d.forEach(((t,n)=>{e.file(`layer_${n}.png`,t)}));const t=JSON.stringify(n[0].segments,null,"\t"),a=new Blob([t],{type:"text/plain;charset=utf-8"});e.file("segmentation_informations.json",a),e.generateAsync({type:"blob"}).then((e=>{(0,ae.saveAs)(e,"segmentation.zip"),o(!1)}))}))};return r.createElement("div",{className:"flex flex-col w-full h-74 justify-between"},r.createElement(x.zx,{className:"pt-1/10 pb-1/10 w-full",onClick:()=>{o(!0)}},"Export Segmentation"),a&&r.createElement("div",{className:"w-full mt-[9px]"},r.createElement("p",{style:{color:"white"}},"Processing layers..."),r.createElement(le.Z,{className:"w-full mt-[3px]",bgColor:s<100?"#5ACCE6":"#50C878",completed:s,transitionDuration:"0.05s",transitionTimingFunction:"linear"})))}ce.propTypes={segmentations:f().array.isRequired};const me=ce,de=v.Enums.SegmentationRepresentations.Labelmap;function pe(e){let{servicesManager:t,commandsManager:n}=e;const[{activeViewportIndex:a,viewports:o},s]=(0,x.O_)(),{segmentationService:i,uiDialogService:l,cornerstoneViewportService:c,toolGroupService:m,toolbarService:d,uiNotificationService:p}=t.services,{t:u}=(0,C.$G)("PanelSegmentation"),[g,E]=(0,r.useState)(null),[f,I]=(0,r.useState)(i.getConfiguration()),[h,y]=(0,r.useState)((()=>i.getSegmentations())),[N,w]=(0,r.useState)({}),b=(0,r.useCallback)((e=>{w((t=>({...t,[e]:!t[e]})))}),[w]);(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(c.getCornerstoneViewportByIndex(a).id,c.getCornerstoneViewportByIndex(a).renderingEngineId);console.log("TOOL GROUP",e)})),(0,r.useEffect)((()=>{const e=h[h.length-1]?.id;e&&w((t=>({...t,[e]:!1})))}),[h,w]),(0,r.useEffect)((()=>{const e=i.EVENTS.SEGMENTATION_ADDED,t=i.EVENTS.SEGMENTATION_UPDATED,n=i.EVENTS.SEGMENTATION_REMOVED,a=[];return[e,t,n].forEach((e=>{const{unsubscribe:t}=i.subscribe(e,(()=>{const e=i.getSegmentations();y(e),I(i.getConfiguration())}));a.push(t)})),()=>{a.forEach((e=>{e()}))}}),[]);const T=e=>i.getToolGroupIdsWithSegmentation(e),D=(0,r.useCallback)(((e,t,n)=>{i.setConfiguration({segmentationId:e,[t]:n})}),[i]);return r.createElement("div",{className:"flex flex-col flex-auto min-h-0F mt-1"},r.createElement(ne,{segmentationService:i,cornerstoneViewportService:c,toolGroupService:m,toolbarService:d,commandsManager:n}),h?.length&&r.createElement(re,{segmentationService:i,segmentations:h}),h?.length?r.createElement(x.cX,{title:u("Segmentations"),showAddSegment:!0,segmentations:h,isMinimized:N,activeSegmentationId:g||"",onSegmentationClick:e=>{i.setActiveSegmentationForToolGroup(e)},onSegmentationDelete:e=>{i.remove(e)},onSegmentationEdit:e=>{const t=i.getSegmentation(e),{label:n}=t;S(l,n,((t,n)=>{""!==t&&i.addOrUpdateSegmentation({id:e,label:t},!1,!0)}))},onSegmentClick:(e,t)=>{i.setActiveSegmentForSegmentation(e,t);T(e).forEach((n=>{i.setActiveSegmentationForToolGroup(e,n),i.jumpToSegmentCenter(e,t,n)}))},onSegmentEdit:(e,t)=>{const n=i.getSegmentation(e).segments[t],{label:a}=n;S(l,a,((n,a)=>{""!==n&&i.setSegmentLabelForSegmentation(e,t,n)}))},onSegmentAdd:e=>{const t=i.getSegmentation(e);i.addSegment(e,t.segments.length,o[a].viewportOptions.toolGroupId,{label:`Segmentation ${t.segmentCount+1}`,color:[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],opacity:255,visibility:!0,isLocked:!1,active:!0})},onSegmentColorChange:(e,t,n)=>{i.setSegmentColor(e,t,n,o[a].viewportOptions.toolGroupId)},onSegmentDelete:(e,t)=>{i.removeSegment(e,t)},onToggleSegmentVisibility:(e,t)=>{const n=!i.getSegmentation(e).segments[t].isVisible;T(e).forEach((a=>{i.setSegmentVisibility(e,t,n,a)}))},onToggleSegmentationVisibility:e=>{i.toggleSegmentationVisibility(e)},onToggleMinimizeSegmentation:b,segmentationConfig:{initialConfig:f},setRenderOutline:e=>D(g,"renderOutline",e),setOutlineOpacityActive:e=>D(g,"outlineOpacity",e),setRenderFill:e=>D(g,"renderFill",e),setRenderInactiveSegmentations:e=>D(g,"renderInactiveSegmentations",e),setOutlineWidthActive:e=>D(g,"outlineWidthActive",e),setFillAlpha:e=>D(g,"fillAlpha",e),setFillAlphaInactive:e=>D(g,"fillAlphaInactive",e)}):null,h.length?r.createElement(me,{segmentationService:i,segmentations:h}):r.createElement(x.zx,{className:"pt-1/10 pb-1/10",onClick:()=>{o.forEach((e=>{if(e.viewportIndex===a){if("volume3d"===e.viewportOptions.viewportType)return void p.show({title:"Create Segmentation",message:"Can't create segmentation in viewport 3D, select a 2D viewport",type:"error"});console.log("SEG VP",e),i.createSegmentationForDisplaySet(e.displaySetInstanceUIDs[0]).then((t=>{const n=i.getSegmentation(t);console.log("CREATED SEGMENTATION",n),i.addSegmentationRepresentationToToolGroup(e.viewportOptions.toolGroupId,t,!0,de).then((()=>{i.setActiveSegmentationForToolGroup(t,e.viewportOptions.toolGroupId),i.addSegment(t,1,o[a].viewportOptions.toolGroupId,{label:"Segmentation 1",color:[255,0,0],opacity:255,visibility:!0,isLocked:!1,active:!0})}))}))}}))}},"Create Segmentation For Selected Viewport"))}pe.propTypes={commandsManager:f().shape({runCommand:f().func.isRequired}),servicesManager:f().shape({services:f().shape({segmentationService:f().shape({getSegmentation:f().func.isRequired,getSegmentations:f().func.isRequired,toggleSegmentationVisibility:f().func.isRequired,subscribe:f().func.isRequired,EVENTS:f().object.isRequired}).isRequired}).isRequired}).isRequired};const ue={id:"@ohif/seg",hasUpdatedPriorsInformation:!1,name:"Segmentations",protocolMatchingRules:[],toolGroupIds:["default"],numberOfPriorsReferenced:0,defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"segDisplaySetId",matchedDisplaySetsIndex:-1}]},displaySetSelectors:{segDisplaySetId:{seriesMatchingRules:[{attribute:"Modality",constraint:{equals:"SEG"}}]}},stages:[{name:"Segmentations",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{allowUnmatchedView:!0},displaySets:[{id:"segDisplaySetId"}]}]}]};const ge=function(){return[{name:ue.id,protocol:ue}]};function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ee.apply(this,arguments)}const fe=r.lazy((()=>n.e(569).then(n.bind(n,33569)))),xe=e=>r.createElement(r.Suspense,{fallback:r.createElement("div",null,"Loading...")},r.createElement(fe,e)),Se={id:a,getPanelModule:e=>{let{servicesManager:t,commandsManager:n,extensionManager:a}=e;return[{name:"panelSegmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:()=>r.createElement(pe,{commandsManager:n,servicesManager:t,extensionManager:a})}]},getViewportModule(e){let{servicesManager:t,extensionManager:n}=e;return[{name:"dicom-seg",component:e=>r.createElement(xe,Ee({servicesManager:t,extensionManager:n},e))}]},getSopClassHandlerModule:g,getHangingProtocolModule:ge}},78753:()=>{}}]);
//# sourceMappingURL=962.bundle.6cc4064cd36dbd449349.js.map