{"version":3,"file":"994.bundle.d952a210e6e10bdd8aab.js","mappings":"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","sources":["webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/measurementTrackingMachine.js","webpack:///../../../extensions/measurement-tracking/src/_shared/PROMPT_RESPONSES.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptSaveReport.js","webpack:///../../../extensions/measurement-tracking/src/_shared/getNextSRSeriesNumber.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptHydrateStructuredReport.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/hydrateStructuredReport.tsx","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptLabelAnnotation.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/TrackedMeasurementsContext.tsx","webpack:///../../../extensions/measurement-tracking/src/getContextModule.tsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/PanelStudyBrowserTracking.tsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/getImageSrcFromImageId.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/requestDisplaySetCreationForStudy.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/index.tsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelMeasurementTableTracking/index.tsx","webpack:///../../../extensions/measurement-tracking/src/getPanelModule.tsx","webpack:///../../../extensions/measurement-tracking/src/getViewportModule.tsx","webpack:///../../../extensions/measurement-tracking/src/index.tsx","webpack:///../../../extensions/measurement-tracking/src/id.js"],"sourcesContent":["import { hydrateStructuredReport } from '@ohif/extension-cornerstone-dicom-sr';\nimport { assign } from 'xstate';\n\nconst RESPONSE = {\n  NO_NEVER: -1,\n  CANCEL: 0,\n  CREATE_REPORT: 1,\n  ADD_SERIES: 2,\n  SET_STUDY_AND_SERIES: 3,\n  NO_NOT_FOR_SERIES: 4,\n  HYDRATE_REPORT: 5,\n};\n\nconst machineConfiguration = {\n  id: 'measurementTracking',\n  initial: 'idle',\n  context: {\n    activeViewportId: null,\n    trackedStudy: '',\n    trackedSeries: [],\n    ignoredSeries: [],\n    //\n    prevTrackedStudy: '',\n    prevTrackedSeries: [],\n    prevIgnoredSeries: [],\n    //\n    ignoredSRSeriesForHydration: [],\n    isDirty: false,\n  },\n  states: {\n    off: {\n      type: 'final',\n    },\n    labellingOnly: {\n      on: {\n        TRACK_SERIES: [\n          {\n            target: 'promptLabelAnnotation',\n            actions: ['setPreviousState'],\n          },\n          {\n            target: 'off',\n          },\n        ],\n      },\n    },\n    idle: {\n      entry: 'clearContext',\n      on: {\n        TRACK_SERIES: [\n          {\n            target: 'promptLabelAnnotation',\n            cond: 'isLabelOnMeasure',\n            actions: ['setPreviousState'],\n          },\n          {\n            target: 'promptBeginTracking',\n            actions: ['setPreviousState'],\n          },\n        ],\n        // Unused? We may only do PROMPT_HYDRATE_SR now?\n        SET_TRACKED_SERIES: [\n          {\n            target: 'tracking',\n            actions: ['setTrackedStudyAndMultipleSeries', 'setIsDirtyToClean'],\n          },\n        ],\n        PROMPT_HYDRATE_SR: {\n          target: 'promptHydrateStructuredReport',\n          cond: 'hasNotIgnoredSRSeriesForHydration',\n        },\n        RESTORE_PROMPT_HYDRATE_SR: 'promptHydrateStructuredReport',\n        HYDRATE_SR: 'hydrateStructuredReport',\n        UPDATE_ACTIVE_VIEWPORT_ID: {\n          actions: assign({\n            activeViewportId: (_, event) => event.activeViewportId,\n          }),\n        },\n      },\n    },\n    promptBeginTracking: {\n      invoke: {\n        src: 'promptBeginTracking',\n        onDone: [\n          {\n            target: 'tracking',\n            actions: ['setTrackedStudyAndSeries', 'setIsDirty'],\n            cond: 'shouldSetStudyAndSeries',\n          },\n          {\n            target: 'labellingOnly',\n            cond: 'isLabelOnMeasureAndShouldKillMachine',\n          },\n          {\n            target: 'off',\n            cond: 'shouldKillMachine',\n          },\n          {\n            target: 'idle',\n          },\n        ],\n        onError: {\n          target: 'idle',\n        },\n      },\n    },\n    tracking: {\n      on: {\n        TRACK_SERIES: [\n          {\n            target: 'promptLabelAnnotation',\n            cond: 'isLabelOnMeasure',\n            actions: ['setPreviousState'],\n          },\n          {\n            target: 'promptTrackNewStudy',\n            cond: 'isNewStudy',\n          },\n          {\n            target: 'promptTrackNewSeries',\n            cond: 'isNewSeries',\n          },\n        ],\n        UNTRACK_SERIES: [\n          {\n            target: 'tracking',\n            actions: ['removeTrackedSeries', 'setIsDirty'],\n            cond: 'hasRemainingTrackedSeries',\n          },\n          {\n            target: 'idle',\n          },\n        ],\n        SET_TRACKED_SERIES: [\n          {\n            target: 'tracking',\n            actions: ['setTrackedStudyAndMultipleSeries'],\n          },\n        ],\n        SAVE_REPORT: 'promptSaveReport',\n        SET_DIRTY: [\n          {\n            target: 'tracking',\n            actions: ['setIsDirty'],\n            cond: 'shouldSetDirty',\n          },\n          {\n            target: 'tracking',\n          },\n        ],\n      },\n    },\n    promptTrackNewSeries: {\n      invoke: {\n        src: 'promptTrackNewSeries',\n        onDone: [\n          {\n            target: 'tracking',\n            actions: ['addTrackedSeries', 'setIsDirty'],\n            cond: 'shouldAddSeries',\n          },\n          {\n            target: 'tracking',\n            actions: [\n              'discardPreviouslyTrackedMeasurements',\n              'setTrackedStudyAndSeries',\n              'setIsDirty',\n            ],\n            cond: 'shouldSetStudyAndSeries',\n          },\n          {\n            target: 'promptSaveReport',\n            cond: 'shouldPromptSaveReport',\n          },\n          {\n            target: 'tracking',\n          },\n        ],\n        onError: {\n          target: 'idle',\n        },\n      },\n    },\n    promptTrackNewStudy: {\n      invoke: {\n        src: 'promptTrackNewStudy',\n        onDone: [\n          {\n            target: 'tracking',\n            actions: [\n              'discardPreviouslyTrackedMeasurements',\n              'setTrackedStudyAndSeries',\n              'setIsDirty',\n            ],\n            cond: 'shouldSetStudyAndSeries',\n          },\n          {\n            target: 'tracking',\n            actions: ['ignoreSeries'],\n            cond: 'shouldAddIgnoredSeries',\n          },\n          {\n            target: 'promptSaveReport',\n            cond: 'shouldPromptSaveReport',\n          },\n          {\n            target: 'tracking',\n          },\n        ],\n        onError: {\n          target: 'idle',\n        },\n      },\n    },\n    promptSaveReport: {\n      invoke: {\n        src: 'promptSaveReport',\n        onDone: [\n          // \"clicked the save button\"\n          // - should clear all measurements\n          // - show DICOM SR\n          {\n            target: 'idle',\n            actions: ['clearAllMeasurements', 'showStructuredReportDisplaySetInActiveViewport'],\n            cond: 'shouldSaveAndContinueWithSameReport',\n          },\n          // \"starting a new report\"\n          // - remove \"just saved\" measurements\n          // - start tracking a new study + report\n          {\n            target: 'tracking',\n            actions: ['discardPreviouslyTrackedMeasurements', 'setTrackedStudyAndSeries'],\n            cond: 'shouldSaveAndStartNewReport',\n          },\n          // Cancel, back to tracking\n          {\n            target: 'tracking',\n          },\n        ],\n        onError: {\n          target: 'idle',\n        },\n      },\n    },\n    promptHydrateStructuredReport: {\n      invoke: {\n        src: 'promptHydrateStructuredReport',\n        onDone: [\n          {\n            target: 'tracking',\n            actions: [\n              'setTrackedStudyAndMultipleSeries',\n              'jumpToSameImageInActiveViewport',\n              'setIsDirtyToClean',\n            ],\n            cond: 'shouldHydrateStructuredReport',\n          },\n          {\n            target: 'idle',\n            actions: ['ignoreHydrationForSRSeries'],\n            cond: 'shouldIgnoreHydrationForSR',\n          },\n        ],\n        onError: {\n          target: 'idle',\n        },\n      },\n    },\n    hydrateStructuredReport: {\n      invoke: {\n        src: 'hydrateStructuredReport',\n        onDone: [\n          {\n            target: 'tracking',\n            actions: [\n              'setTrackedStudyAndMultipleSeries',\n              'jumpToSameImageInActiveViewport',\n              'setIsDirtyToClean',\n            ],\n          },\n        ],\n        onError: {\n          target: 'idle',\n        },\n      },\n    },\n    promptLabelAnnotation: {\n      invoke: {\n        src: 'promptLabelAnnotation',\n        onDone: [\n          {\n            target: 'labellingOnly',\n            cond: 'wasLabellingOnly',\n          },\n          {\n            target: 'promptBeginTracking',\n            cond: 'wasIdle',\n          },\n          {\n            target: 'promptTrackNewStudy',\n            cond: 'wasTrackingAndIsNewStudy',\n          },\n          {\n            target: 'promptTrackNewSeries',\n            cond: 'wasTrackingAndIsNewSeries',\n          },\n          {\n            target: 'tracking',\n            cond: 'wasTracking',\n          },\n          {\n            target: 'off',\n          },\n        ],\n      },\n    },\n  },\n  strict: true,\n};\n\nconst defaultOptions = {\n  services: {\n    // Disabled for now\n    /*promptBeginTracking: (ctx, evt) => {\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\n    },\n    promptTrackNewStudy: (ctx, evt) => {\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\n    },\n    promptTrackNewSeries: (ctx, evt) => {\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\n    },*/\n  },\n  actions: {\n    discardPreviouslyTrackedMeasurements: (ctx, evt) => {\n      console.log('discardPreviouslyTrackedMeasurements: not implemented');\n    },\n    clearAllMeasurements: (ctx, evt) => {\n      console.log('clearAllMeasurements: not implemented');\n    },\n    jumpToFirstMeasurementInActiveViewport: (ctx, evt) => {\n      console.warn('jumpToFirstMeasurementInActiveViewport: not implemented');\n    },\n    showStructuredReportDisplaySetInActiveViewport: (ctx, evt) => {\n      console.warn('showStructuredReportDisplaySetInActiveViewport: not implemented');\n    },\n    clearContext: assign({\n      trackedStudy: '',\n      trackedSeries: [],\n      ignoredSeries: [],\n      prevTrackedStudy: '',\n      prevTrackedSeries: [],\n      prevIgnoredSeries: [],\n    }),\n    // Promise resolves w/ `evt.data.*`\n    setTrackedStudyAndSeries: assign((ctx, evt) => ({\n      prevTrackedStudy: ctx.trackedStudy,\n      prevTrackedSeries: ctx.trackedSeries.slice(),\n      prevIgnoredSeries: ctx.ignoredSeries.slice(),\n      //\n      trackedStudy: evt.data.StudyInstanceUID,\n      trackedSeries: [evt.data.SeriesInstanceUID],\n      ignoredSeries: [],\n    })),\n    setTrackedStudyAndMultipleSeries: assign((ctx, evt) => {\n      const studyInstanceUID = evt.StudyInstanceUID || evt.data.StudyInstanceUID;\n      const seriesInstanceUIDs = evt.SeriesInstanceUIDs || evt.data.SeriesInstanceUIDs;\n\n      return {\n        prevTrackedStudy: ctx.trackedStudy,\n        prevTrackedSeries: ctx.trackedSeries.slice(),\n        prevIgnoredSeries: ctx.ignoredSeries.slice(),\n        //\n        trackedStudy: studyInstanceUID,\n        trackedSeries: [...ctx.trackedSeries, ...seriesInstanceUIDs],\n        ignoredSeries: [],\n      };\n    }),\n    setIsDirtyToClean: assign((ctx, evt) => ({\n      isDirty: false,\n    })),\n    setIsDirty: assign((ctx, evt) => ({\n      isDirty: true,\n    })),\n    ignoreSeries: assign((ctx, evt) => ({\n      prevIgnoredSeries: [...ctx.ignoredSeries],\n      ignoredSeries: [...ctx.ignoredSeries, evt.data.SeriesInstanceUID],\n    })),\n    ignoreHydrationForSRSeries: assign((ctx, evt) => ({\n      ignoredSRSeriesForHydration: [\n        ...ctx.ignoredSRSeriesForHydration,\n        evt.data.srSeriesInstanceUID,\n      ],\n    })),\n    addTrackedSeries: assign((ctx, evt) => ({\n      prevTrackedSeries: [...ctx.trackedSeries],\n      trackedSeries: [...ctx.trackedSeries, evt.data.SeriesInstanceUID],\n    })),\n    removeTrackedSeries: assign((ctx, evt) => ({\n      prevTrackedSeries: ctx.trackedSeries.slice().filter(ser => ser !== evt.SeriesInstanceUID),\n      trackedSeries: ctx.trackedSeries.slice().filter(ser => ser !== evt.SeriesInstanceUID),\n    })),\n    setPreviousState: assign((ctx, evt, meta) => {\n      return {\n        prevState: meta.state.value,\n      };\n    }),\n  },\n  guards: {\n    // We set dirty any time we performan an action that:\n    // - Tracks a new study\n    // - Tracks a new series\n    // - Adds a measurement to an already tracked study/series\n    //\n    // We set clean any time we restore from an SR\n    //\n    // This guard/condition is specific to \"new measurements\"\n    // to make sure we only track dirty when the new measurement is specific\n    // to a series we're already tracking\n    //\n    // tl;dr\n    // Any report change, that is not a hydration of an existing report, should\n    // result in a \"dirty\" report\n    //\n    // Where dirty means there would be \"loss of data\" if we blew away measurements\n    // without creating a new SR.\n    shouldSetDirty: (ctx, evt) => {\n      return (\n        // When would this happen?\n        evt.SeriesInstanceUID === undefined || ctx.trackedSeries.includes(evt.SeriesInstanceUID)\n      );\n    },\n    wasLabellingOnly: (ctx, evt, condMeta) => {\n      return ctx.prevState === 'labellingOnly';\n    },\n    wasIdle: (ctx, evt, condMeta) => {\n      return ctx.prevState === 'idle';\n    },\n    wasTracking: (ctx, evt, condMeta) => {\n      return ctx.prevState === 'tracking';\n    },\n    wasTrackingAndIsNewStudy: (ctx, evt, condMeta) => {\n      return (\n        ctx.prevState === 'tracking' &&\n        !ctx.ignoredSeries.includes(evt.data.SeriesInstanceUID) &&\n        ctx.trackedStudy !== evt.data.StudyInstanceUID\n      );\n    },\n    wasTrackingAndIsNewSeries: (ctx, evt, condMeta) => {\n      return (\n        ctx.prevState === 'tracking' &&\n        !ctx.ignoredSeries.includes(evt.data.SeriesInstanceUID) &&\n        !ctx.trackedSeries.includes(evt.data.SeriesInstanceUID)\n      );\n    },\n\n    shouldKillMachine: (ctx, evt) => evt.data && evt.data.userResponse === RESPONSE.NO_NEVER,\n    shouldAddSeries: (ctx, evt) => evt.data && evt.data.userResponse === RESPONSE.ADD_SERIES,\n    shouldSetStudyAndSeries: (ctx, evt) =>\n      evt.data && evt.data.userResponse === RESPONSE.SET_STUDY_AND_SERIES,\n    shouldAddIgnoredSeries: (ctx, evt) =>\n      evt.data && evt.data.userResponse === RESPONSE.NO_NOT_FOR_SERIES,\n    shouldPromptSaveReport: (ctx, evt) =>\n      evt.data && evt.data.userResponse === RESPONSE.CREATE_REPORT,\n    shouldIgnoreHydrationForSR: (ctx, evt) => evt.data && evt.data.userResponse === RESPONSE.CANCEL,\n    shouldSaveAndContinueWithSameReport: (ctx, evt) =>\n      evt.data &&\n      evt.data.userResponse === RESPONSE.CREATE_REPORT &&\n      evt.data.isBackupSave === true,\n    shouldSaveAndStartNewReport: (ctx, evt) =>\n      evt.data &&\n      evt.data.userResponse === RESPONSE.CREATE_REPORT &&\n      evt.data.isBackupSave === false,\n    shouldHydrateStructuredReport: (ctx, evt) =>\n      evt.data && evt.data.userResponse === RESPONSE.HYDRATE_REPORT,\n    // Has more than 1, or SeriesInstanceUID is not in list\n    // --> Post removal would have non-empty trackedSeries array\n    hasRemainingTrackedSeries: (ctx, evt) =>\n      ctx.trackedSeries.length > 1 || !ctx.trackedSeries.includes(evt.SeriesInstanceUID),\n    hasNotIgnoredSRSeriesForHydration: (ctx, evt) => {\n      return !ctx.ignoredSRSeriesForHydration.includes(evt.SeriesInstanceUID);\n    },\n    isNewStudy: (ctx, evt) =>\n      !ctx.ignoredSeries.includes(evt.SeriesInstanceUID) &&\n      ctx.trackedStudy !== evt.StudyInstanceUID,\n    isNewSeries: (ctx, evt) =>\n      !ctx.ignoredSeries.includes(evt.SeriesInstanceUID) &&\n      !ctx.trackedSeries.includes(evt.SeriesInstanceUID),\n  },\n};\n\nexport { defaultOptions, machineConfiguration, RESPONSE };\n","const RESPONSE = {\n  NO_NEVER: -1,\n  CANCEL: 0,\n  CREATE_REPORT: 1,\n  ADD_SERIES: 2,\n  SET_STUDY_AND_SERIES: 3,\n  NO_NOT_FOR_SERIES: 4,\n};\n\nexport default RESPONSE;\n","import { createReportAsync, createReportDialogPrompt } from '@ohif/extension-default';\nimport getNextSRSeriesNumber from '../../_shared/getNextSRSeriesNumber';\nimport RESPONSE from '../../_shared/PROMPT_RESPONSES';\n\nasync function promptSaveReport({ servicesManager, commandsManager, extensionManager }, ctx, evt) {\n  const { uiDialogService, measurementService, displaySetService } = servicesManager.services;\n  const viewportId = evt.viewportId === undefined ? evt.data.viewportId : evt.viewportId;\n  const isBackupSave = evt.isBackupSave === undefined ? evt.data.isBackupSave : evt.isBackupSave;\n  const StudyInstanceUID = evt?.data?.StudyInstanceUID;\n  const SeriesInstanceUID = evt?.data?.SeriesInstanceUID;\n\n  const { trackedStudy, trackedSeries } = ctx;\n  let displaySetInstanceUIDs;\n\n  try {\n    const promptResult = await createReportDialogPrompt(uiDialogService, {\n      extensionManager,\n    });\n\n    if (promptResult.action === RESPONSE.CREATE_REPORT) {\n      const dataSources = extensionManager.getDataSources();\n      const dataSource = dataSources[0];\n      const measurements = measurementService.getMeasurements();\n      const trackedMeasurements = measurements\n        .filter(\n          m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\n        )\n        .filter(m => m.referencedImageId != null);\n\n      const SeriesDescription =\n        // isUndefinedOrEmpty\n        promptResult.value === undefined || promptResult.value === ''\n          ? 'Research Derived Series' // default\n          : promptResult.value; // provided value\n\n      const SeriesNumber = getNextSRSeriesNumber(displaySetService);\n\n      const getReport = async () => {\n        return commandsManager.runCommand(\n          'storeMeasurements',\n          {\n            measurementData: trackedMeasurements,\n            dataSource,\n            additionalFindingTypes: ['ArrowAnnotate'],\n            options: {\n              SeriesDescription,\n              SeriesNumber,\n            },\n          },\n          'CORNERSTONE_STRUCTURED_REPORT'\n        );\n      };\n      displaySetInstanceUIDs = await createReportAsync({\n        servicesManager,\n        getReport,\n      });\n    } else if (promptResult.action === RESPONSE.CANCEL) {\n      // Do nothing\n    }\n\n    return {\n      userResponse: promptResult.action,\n      createdDisplaySetInstanceUIDs: displaySetInstanceUIDs,\n      StudyInstanceUID,\n      SeriesInstanceUID,\n      viewportId,\n      isBackupSave,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport default promptSaveReport;\n","const MIN_SR_SERIES_NUMBER = 4700;\n\nexport default function getNextSRSeriesNumber(displaySetService) {\n  const activeDisplaySets = displaySetService.getActiveDisplaySets();\n  const srDisplaySets = activeDisplaySets.filter(ds => ds.Modality === 'SR');\n  const srSeriesNumbers = srDisplaySets.map(ds => ds.SeriesNumber);\n  const maxSeriesNumber = Math.max(...srSeriesNumbers, MIN_SR_SERIES_NUMBER);\n\n  return maxSeriesNumber + 1;\n}\n","import { hydrateStructuredReport } from '@ohif/extension-cornerstone-dicom-sr';\nimport { ButtonEnums } from '@ohif/ui';\n\nconst RESPONSE = {\n  NO_NEVER: -1,\n  CANCEL: 0,\n  CREATE_REPORT: 1,\n  ADD_SERIES: 2,\n  SET_STUDY_AND_SERIES: 3,\n  NO_NOT_FOR_SERIES: 4,\n  HYDRATE_REPORT: 5,\n};\n\nfunction promptHydrateStructuredReport({ servicesManager, extensionManager, appConfig }, ctx, evt) {\n  const { uiViewportDialogService, displaySetService } = servicesManager.services;\n  const { viewportId, displaySetInstanceUID } = evt;\n  const srDisplaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\n  return new Promise(async function (resolve, reject) {\n    const promptResult = appConfig?.disableConfirmationPrompts\n      ? RESPONSE.HYDRATE_REPORT\n      : await _askTrackMeasurements(uiViewportDialogService, viewportId);\n\n    // Need to do action here... So we can set state...\n    let StudyInstanceUID, SeriesInstanceUIDs;\n\n    if (promptResult === RESPONSE.HYDRATE_REPORT) {\n      console.warn('!! HYDRATING STRUCTURED REPORT');\n      const hydrationResult = hydrateStructuredReport(\n        { servicesManager, extensionManager, appConfig },\n        displaySetInstanceUID\n      );\n\n      StudyInstanceUID = hydrationResult.StudyInstanceUID;\n      SeriesInstanceUIDs = hydrationResult.SeriesInstanceUIDs;\n    }\n\n    resolve({\n      userResponse: promptResult,\n      displaySetInstanceUID: evt.displaySetInstanceUID,\n      srSeriesInstanceUID: srDisplaySet.SeriesInstanceUID,\n      viewportId,\n      StudyInstanceUID,\n      SeriesInstanceUIDs,\n    });\n  });\n}\n\nfunction _askTrackMeasurements(uiViewportDialogService, viewportId) {\n  return new Promise(function (resolve, reject) {\n    const message = 'Do you want to continue tracking measurements for this study?';\n    const actions = [\n      {\n        id: 'no-hydrate',\n        type: ButtonEnums.type.secondary,\n        text: 'No',\n        value: RESPONSE.CANCEL,\n      },\n      {\n        id: 'yes-hydrate',\n        type: ButtonEnums.type.primary,\n        text: 'Yes',\n        value: RESPONSE.HYDRATE_REPORT,\n      },\n    ];\n    const onSubmit = result => {\n      uiViewportDialogService.hide();\n      resolve(result);\n    };\n\n    uiViewportDialogService.show({\n      viewportId,\n      type: 'info',\n      message,\n      actions,\n      onSubmit,\n      onOutsideClick: () => {\n        uiViewportDialogService.hide();\n        resolve(RESPONSE.CANCEL);\n      },\n      onKeyPress: event => {\n        if (event.key === 'Enter') {\n          const action = actions.find(action => action.value === RESPONSE.HYDRATE_REPORT);\n          onSubmit(action.value);\n        }\n      },\n    });\n  });\n}\n\nexport default promptHydrateStructuredReport;\n","import { hydrateStructuredReport as baseHydrateStructuredReport } from '@ohif/extension-cornerstone-dicom-sr';\n\nfunction hydrateStructuredReport(\n  { servicesManager, extensionManager, appConfig }: withAppTypes,\n  ctx,\n  evt\n) {\n  const { displaySetService } = servicesManager.services;\n  const { viewportId, displaySetInstanceUID } = evt;\n  const srDisplaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\n\n  return new Promise((resolve, reject) => {\n    const hydrationResult = baseHydrateStructuredReport(\n      { servicesManager, extensionManager, appConfig },\n      displaySetInstanceUID\n    );\n\n    const StudyInstanceUID = hydrationResult.StudyInstanceUID;\n    const SeriesInstanceUIDs = hydrationResult.SeriesInstanceUIDs;\n\n    resolve({\n      displaySetInstanceUID: evt.displaySetInstanceUID,\n      srSeriesInstanceUID: srDisplaySet.SeriesInstanceUID,\n      viewportId,\n      StudyInstanceUID,\n      SeriesInstanceUIDs,\n    });\n  });\n}\n\nexport default hydrateStructuredReport;\n","function promptLabelAnnotation({ servicesManager, extensionManager }, ctx, evt) {\n  const { measurementService, customizationService } = servicesManager.services;\n  const { viewportId, StudyInstanceUID, SeriesInstanceUID, measurementId } = evt;\n  const utilityModule = extensionManager.getModuleEntry(\n    '@ohif/extension-cornerstone.utilityModule.common'\n  );\n  const { showLabelAnnotationPopup } = utilityModule.exports;\n  return new Promise(async function (resolve) {\n    const labelConfig = customizationService.get('measurementLabels');\n    const measurement = measurementService.getMeasurement(measurementId);\n    const value = await showLabelAnnotationPopup(\n      measurement,\n      servicesManager.services.uiDialogService,\n      labelConfig\n    );\n\n    measurementService.update(\n      measurementId,\n      {\n        ...value,\n      },\n      true\n    );\n\n    resolve({\n      StudyInstanceUID,\n      SeriesInstanceUID,\n      viewportId,\n    });\n  });\n}\n\nexport default promptLabelAnnotation;\n","import React, { useContext, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { Machine } from 'xstate';\nimport { useMachine } from '@xstate/react';\nimport { useViewportGrid } from '@ohif/ui';\nimport { machineConfiguration, defaultOptions, RESPONSE } from './measurementTrackingMachine';\nimport promptBeginTracking from './promptBeginTracking';\nimport promptTrackNewSeries from './promptTrackNewSeries';\nimport promptTrackNewStudy from './promptTrackNewStudy';\nimport promptSaveReport from './promptSaveReport';\nimport promptHydrateStructuredReport from './promptHydrateStructuredReport';\nimport hydrateStructuredReport from './hydrateStructuredReport';\nimport { useAppConfig } from '@state';\nimport promptLabelAnnotation from './promptLabelAnnotation';\n\nconst TrackedMeasurementsContext = React.createContext();\nTrackedMeasurementsContext.displayName = 'TrackedMeasurementsContext';\nconst useTrackedMeasurements = () => useContext(TrackedMeasurementsContext);\n\nconst SR_SOPCLASSHANDLERID = '@ohif/extension-cornerstone-dicom-sr.sopClassHandlerModule.dicom-sr';\n\n/**\n *\n * @param {*} param0\n */\nfunction TrackedMeasurementsContextProvider(\n  { servicesManager, commandsManager, extensionManager }: withAppTypes, // Bound by consumer\n  { children } // Component props\n) {\n  const [appConfig] = useAppConfig();\n\n  const [viewportGrid, viewportGridService] = useViewportGrid();\n  const { activeViewportId, viewports } = viewportGrid;\n  const {\n    measurementService,\n    displaySetService,\n    customizationService,\n    cornerstoneViewportService,\n  } = servicesManager.services;\n\n  const machineOptions = Object.assign({}, defaultOptions);\n  machineOptions.actions = Object.assign({}, machineOptions.actions, {\n    jumpToFirstMeasurementInActiveViewport: (ctx, evt) => {\n      const { trackedStudy, trackedSeries, activeViewportId } = ctx;\n      const measurements = measurementService.getMeasurements();\n      const trackedMeasurements = measurements.filter(\n        m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\n      );\n\n      console.log(\n        'jumping to measurement reset viewport',\n        activeViewportId,\n        trackedMeasurements[0]\n      );\n\n      const referencedDisplaySetUID = trackedMeasurements[0].displaySetInstanceUID;\n      const referencedDisplaySet = displaySetService.getDisplaySetByUID(referencedDisplaySetUID);\n\n      const referencedImages = referencedDisplaySet.images;\n      const isVolumeIdReferenced = referencedImages[0].imageId.startsWith('volumeId');\n\n      const measurementData = trackedMeasurements[0].data;\n\n      let imageIndex = 0;\n      if (!isVolumeIdReferenced && measurementData) {\n        // if it is imageId referenced find the index of the imageId, we don't have\n        // support for volumeId referenced images yet\n        imageIndex = referencedImages.findIndex(image => {\n          const imageIdToUse = Object.keys(measurementData)[0].substring(8);\n          return image.imageId === imageIdToUse;\n        });\n\n        if (imageIndex === -1) {\n          console.warn('Could not find image index for tracked measurement, using 0');\n          imageIndex = 0;\n        }\n      }\n\n      viewportGridService.setDisplaySetsForViewport({\n        viewportId: activeViewportId,\n        displaySetInstanceUIDs: [referencedDisplaySetUID],\n        viewportOptions: {\n          initialImageOptions: {\n            index: imageIndex,\n          },\n        },\n      });\n    },\n\n    jumpToSameImageInActiveViewport: (ctx, evt) => {\n      const { trackedStudy, trackedSeries, activeViewportId } = ctx;\n      const measurements = measurementService.getMeasurements();\n      const trackedMeasurements = measurements.filter(\n        m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\n      );\n\n      const trackedMeasurement = trackedMeasurements[0];\n      const referencedDisplaySetUID = trackedMeasurement.displaySetInstanceUID;\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(activeViewportId);\n      const imageIndex = viewport.getCurrentImageIdIndex();\n\n      viewportGridService.setDisplaySetsForViewport({\n        viewportId: activeViewportId,\n        displaySetInstanceUIDs: [referencedDisplaySetUID],\n        viewportOptions: {\n          initialImageOptions: {\n            index: imageIndex,\n          },\n        },\n      });\n    },\n    showStructuredReportDisplaySetInActiveViewport: (ctx, evt) => {\n      if (evt.data.createdDisplaySetInstanceUIDs.length > 0) {\n        const StructuredReportDisplaySetInstanceUID = evt.data.createdDisplaySetInstanceUIDs[0];\n\n        viewportGridService.setDisplaySetsForViewport({\n          viewportId: evt.data.viewportId,\n          displaySetInstanceUIDs: [StructuredReportDisplaySetInstanceUID],\n        });\n      }\n    },\n    discardPreviouslyTrackedMeasurements: (ctx, evt) => {\n      const measurements = measurementService.getMeasurements();\n      const filteredMeasurements = measurements.filter(ms =>\n        ctx.prevTrackedSeries.includes(ms.referenceSeriesUID)\n      );\n      const measurementIds = filteredMeasurements.map(fm => fm.id);\n\n      for (let i = 0; i < measurementIds.length; i++) {\n        measurementService.remove(measurementIds[i]);\n      }\n    },\n    clearAllMeasurements: (ctx, evt) => {\n      const measurements = measurementService.getMeasurements();\n      const measurementIds = measurements.map(fm => fm.uid);\n\n      for (let i = 0; i < measurementIds.length; i++) {\n        measurementService.remove(measurementIds[i]);\n      }\n    },\n  });\n  machineOptions.services = Object.assign({}, machineOptions.services, {\n    // Disabled for now\n    /*promptBeginTracking: promptBeginTracking.bind(null, {\n      servicesManager,\n      extensionManager,\n      appConfig,\n    }),\n    promptTrackNewSeries: promptTrackNewSeries.bind(null, {\n      servicesManager,\n      extensionManager,\n      appConfig,\n    }),\n    promptTrackNewStudy: promptTrackNewStudy.bind(null, {\n      servicesManager,\n      extensionManager,\n      appConfig,\n    }),*/\n    promptSaveReport: promptSaveReport.bind(null, {\n      servicesManager,\n      commandsManager,\n      extensionManager,\n      appConfig,\n    }),\n    promptHydrateStructuredReport: promptHydrateStructuredReport.bind(null, {\n      servicesManager,\n      extensionManager,\n      appConfig,\n    }),\n    hydrateStructuredReport: hydrateStructuredReport.bind(null, {\n      servicesManager,\n      extensionManager,\n      appConfig,\n    }),\n    promptLabelAnnotation: promptLabelAnnotation.bind(null, {\n      servicesManager,\n      extensionManager,\n    }),\n  });\n  machineOptions.guards = Object.assign({}, machineOptions.guards, {\n    isLabelOnMeasure: (ctx, evt, condMeta) => {\n      const labelConfig = customizationService.get('measurementLabels');\n      return labelConfig?.labelOnMeasure;\n    },\n    isLabelOnMeasureAndShouldKillMachine: (ctx, evt, condMeta) => {\n      const labelConfig = customizationService.get('measurementLabels');\n      return evt.data && evt.data.userResponse === RESPONSE.NO_NEVER && labelConfig?.labelOnMeasure;\n    },\n  });\n\n  // TODO: IMPROVE\n  // - Add measurement_updated to cornerstone; debounced? (ext side, or consumption?)\n  // - Friendlier transition/api in front of measurementTracking machine?\n  // - Blocked: viewport overlay shouldn't clip when resized\n  // TODO: PRIORITY\n  // - Fix \"ellipses\" series description dynamic truncate length\n  // - Fix viewport border resize\n  // - created/destroyed hooks for extensions (cornerstone measurement subscriptions in it's `init`)\n\n  const measurementTrackingMachine = Machine(machineConfiguration, machineOptions);\n\n  const [trackedMeasurements, sendTrackedMeasurementsEvent] = useMachine(\n    measurementTrackingMachine\n  );\n\n  useEffect(() => {\n    // Update the state machine with the active viewport ID\n    sendTrackedMeasurementsEvent('UPDATE_ACTIVE_VIEWPORT_ID', {\n      activeViewportId,\n    });\n  }, [activeViewportId, sendTrackedMeasurementsEvent]);\n\n  // ~~ Listen for changes to ViewportGrid for potential SRs hung in panes when idle\n  useEffect(() => {\n    const triggerPromptHydrateFlow = async () => {\n      if (viewports.size > 0) {\n        const activeViewport = viewports.get(activeViewportId);\n\n        if (!activeViewport || !activeViewport?.displaySetInstanceUIDs?.length) {\n          return;\n        }\n\n        // Todo: Getting the first displaySetInstanceUID is wrong, but we don't have\n        // tracking fusion viewports yet. This should change when we do.\n        const { displaySetService } = servicesManager.services;\n        const displaySet = displaySetService.getDisplaySetByUID(\n          activeViewport.displaySetInstanceUIDs[0]\n        );\n\n        if (!displaySet) {\n          return;\n        }\n\n        // If this is an SR produced by our SR SOPClassHandler,\n        // and it hasn't been loaded yet, do that now so we\n        // can check if it can be rehydrated or not.\n        //\n        // Note: This happens:\n        // - If the viewport is not currently an OHIFCornerstoneSRViewport\n        // - If the displaySet has never been hung\n        //\n        // Otherwise, the displaySet will be loaded by the useEffect handler\n        // listening to displaySet changes inside OHIFCornerstoneSRViewport.\n        // The issue here is that this handler in TrackedMeasurementsContext\n        // ends up occurring before the Viewport is created, so the displaySet\n        // is not loaded yet, and isRehydratable is undefined unless we call load().\n        if (\n          displaySet.SOPClassHandlerId === SR_SOPCLASSHANDLERID &&\n          !displaySet.isLoaded &&\n          displaySet.load\n        ) {\n          await displaySet.load();\n        }\n\n        // Magic string\n        // load function added by our sopClassHandler module\n        if (\n          displaySet.SOPClassHandlerId === SR_SOPCLASSHANDLERID &&\n          displaySet.isRehydratable === true\n        ) {\n          console.log('sending event...', trackedMeasurements);\n          sendTrackedMeasurementsEvent('PROMPT_HYDRATE_SR', {\n            displaySetInstanceUID: displaySet.displaySetInstanceUID,\n            SeriesInstanceUID: displaySet.SeriesInstanceUID,\n            viewportId: activeViewportId,\n          });\n        }\n      }\n    };\n    triggerPromptHydrateFlow();\n  }, [\n    trackedMeasurements,\n    activeViewportId,\n    sendTrackedMeasurementsEvent,\n    servicesManager.services,\n    viewports,\n  ]);\n\n  return (\n    <TrackedMeasurementsContext.Provider\n      value={[trackedMeasurements, sendTrackedMeasurementsEvent]}\n    >\n      {children}\n    </TrackedMeasurementsContext.Provider>\n  );\n}\n\nTrackedMeasurementsContextProvider.propTypes = {\n  children: PropTypes.oneOf([PropTypes.func, PropTypes.node]),\n  servicesManager: PropTypes.object.isRequired,\n  commandsManager: PropTypes.object.isRequired,\n  extensionManager: PropTypes.object.isRequired,\n  appConfig: PropTypes.object,\n};\n\nexport { TrackedMeasurementsContext, TrackedMeasurementsContextProvider, useTrackedMeasurements };\n","import {\n  TrackedMeasurementsContext,\n  TrackedMeasurementsContextProvider,\n  useTrackedMeasurements,\n} from './contexts';\n\nfunction getContextModule({ servicesManager, extensionManager, commandsManager }) {\n  const BoundTrackedMeasurementsContextProvider = TrackedMeasurementsContextProvider.bind(null, {\n    servicesManager,\n    extensionManager,\n    commandsManager,\n  });\n\n  return [\n    {\n      name: 'TrackedMeasurementsContext',\n      context: TrackedMeasurementsContext,\n      provider: BoundTrackedMeasurementsContextProvider,\n    },\n  ];\n}\n\nexport { useTrackedMeasurements };\nexport default getContextModule;\n","import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport PropTypes from 'prop-types';\nimport { utils } from '@ohif/core';\nimport { StudyBrowser, useImageViewer, useViewportGrid, Dialog, ButtonEnums } from '@ohif/ui';\nimport { useTrackedMeasurements } from '../../getContextModule';\n\nconst { formatDate, createStudyBrowserTabs } = utils;\n\n/**\n *\n * @param {*} param0\n */\nfunction PanelStudyBrowserTracking({\n  servicesManager,\n  getImageSrc,\n  getStudiesForPatientByMRN,\n  requestDisplaySetCreationForStudy,\n  dataSource,\n}: withAppTypes) {\n  const {\n    displaySetService,\n    uiDialogService,\n    hangingProtocolService,\n    uiNotificationService,\n    measurementService,\n    studyPrefetcherService,\n  } = servicesManager.services;\n  const navigate = useNavigate();\n\n  const { t } = useTranslation('Common');\n\n  // Normally you nest the components so the tree isn't so deep, and the data\n  // doesn't have to have such an intense shape. This works well enough for now.\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\n  const { StudyInstanceUIDs } = useImageViewer();\n  const [{ activeViewportId, viewports, isHangingProtocolLayout }, viewportGridService] =\n    useViewportGrid();\n  const [trackedMeasurements, sendTrackedMeasurementsEvent] = useTrackedMeasurements();\n  const [activeTabName, setActiveTabName] = useState('primary');\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\n    ...StudyInstanceUIDs,\n  ]);\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\n  const [displaySets, setDisplaySets] = useState([]);\n  const [displaySetsLoadingState, setDisplaySetsLoadingState] = useState({});\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\n  const [jumpToDisplaySet, setJumpToDisplaySet] = useState(null);\n\n  const onDoubleClickThumbnailHandler = displaySetInstanceUID => {\n    let updatedViewports = [];\n    const viewportId = activeViewportId;\n    try {\n      updatedViewports = hangingProtocolService.getViewportsRequireUpdate(\n        viewportId,\n        displaySetInstanceUID,\n        isHangingProtocolLayout\n      );\n    } catch (error) {\n      console.warn(error);\n      uiNotificationService.show({\n        title: 'Thumbnail Double Click',\n        message:\n          'The selected display sets could not be added to the viewport due to a mismatch in the Hanging Protocol rules.',\n        type: 'info',\n        duration: 3000,\n      });\n    }\n\n    viewportGridService.setDisplaySetsForViewports(updatedViewports);\n  };\n\n  const activeViewportDisplaySetInstanceUIDs =\n    viewports.get(activeViewportId)?.displaySetInstanceUIDs;\n\n  const { trackedSeries } = trackedMeasurements.context;\n\n  // ~~ studyDisplayList\n  useEffect(() => {\n    // Fetch all studies for the patient in each primary study\n    async function fetchStudiesForPatient(StudyInstanceUID) {\n      // current study qido\n      const qidoForStudyUID = await dataSource.query.studies.search({\n        studyInstanceUid: StudyInstanceUID,\n      });\n\n      if (!qidoForStudyUID?.length) {\n        navigate('/notfoundstudy', '_self');\n        throw new Error('Invalid study URL');\n      }\n\n      let qidoStudiesForPatient = qidoForStudyUID;\n\n      // try to fetch the prior studies based on the patientID if the\n      // server can respond.\n      try {\n        qidoStudiesForPatient = await getStudiesForPatientByMRN(qidoForStudyUID);\n      } catch (error) {\n        console.warn(error);\n      }\n\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\n        return {\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\n          date: formatDate(qidoStudy.StudyDate) || t('NoStudyDate'),\n          description: qidoStudy.StudyDescription,\n          modalities: qidoStudy.ModalitiesInStudy,\n          numInstances: qidoStudy.NumInstances,\n        };\n      });\n\n      setStudyDisplayList(prevArray => {\n        const ret = [...prevArray];\n        for (const study of actuallyMappedStudies) {\n          if (!prevArray.find(it => it.studyInstanceUid === study.studyInstanceUid)) {\n            ret.push(study);\n          }\n        }\n        return ret;\n      });\n    }\n\n    StudyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [StudyInstanceUIDs, getStudiesForPatientByMRN]);\n\n  // ~~ Initial Thumbnails\n  useEffect(() => {\n    const currentDisplaySets = displaySetService.activeDisplaySets;\n\n    if (!currentDisplaySets.length) {\n      return;\n    }\n\n    currentDisplaySets.forEach(async dSet => {\n      const newImageSrcEntry = {};\n      const displaySet = displaySetService.getDisplaySetByUID(dSet.displaySetInstanceUID);\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n\n      const imageId = getImageIdForThumbnail(displaySet, imageIds);\n\n      // TODO: Is it okay that imageIds are not returned here for SR displaySets?\n      if (!imageId || displaySet?.unsupported) {\n        return;\n      }\n      // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n      newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(imageId);\n\n      setThumbnailImageSrcMap(prevState => {\n        return { ...prevState, ...newImageSrcEntry };\n      });\n    });\n  }, [displaySetService, dataSource, getImageSrc]);\n\n  // ~~ displaySets\n  useEffect(() => {\n    const currentDisplaySets = displaySetService.activeDisplaySets;\n\n    if (!currentDisplaySets.length) {\n      return;\n    }\n\n    const mappedDisplaySets = _mapDisplaySets(\n      currentDisplaySets,\n      displaySetsLoadingState,\n      thumbnailImageSrcMap,\n      trackedSeries,\n      viewports,\n      viewportGridService,\n      dataSource,\n      displaySetService,\n      uiDialogService,\n      uiNotificationService\n    );\n\n    setDisplaySets(mappedDisplaySets);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    displaySetService.activeDisplaySets,\n    displaySetsLoadingState,\n    trackedSeries,\n    viewports,\n    dataSource,\n    thumbnailImageSrcMap,\n  ]);\n\n  // -- displaySetsLoadingState\n  useEffect(() => {\n    const { unsubscribe } = studyPrefetcherService.subscribe(\n      studyPrefetcherService.EVENTS.DISPLAYSET_LOAD_PROGRESS,\n      updatedDisplaySetLoadingState => {\n        const { displaySetInstanceUID, loadingProgress } = updatedDisplaySetLoadingState;\n\n        setDisplaySetsLoadingState(prevState => ({\n          ...prevState,\n          [displaySetInstanceUID]: loadingProgress,\n        }));\n      }\n    );\n\n    return () => unsubscribe();\n  }, [studyPrefetcherService]);\n\n  // ~~ subscriptions --> displaySets\n  useEffect(() => {\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\n    const SubscriptionDisplaySetsAdded = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_ADDED,\n      data => {\n        const { displaySetsAdded, options } = data;\n        displaySetsAdded.forEach(async dSet => {\n          const displaySetInstanceUID = dSet.displaySetInstanceUID;\n\n          const newImageSrcEntry = {};\n          const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\n          if (displaySet?.unsupported) {\n            return;\n          }\n\n          if (options.madeInClient) {\n            setJumpToDisplaySet(displaySetInstanceUID);\n          }\n\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n          const imageId = getImageIdForThumbnail(displaySet, imageIds);\n\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\n          if (!imageId) {\n            return;\n          }\n\n          // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n          newImageSrcEntry[displaySetInstanceUID] = await getImageSrc(imageId);\n          setThumbnailImageSrcMap(prevState => {\n            return { ...prevState, ...newImageSrcEntry };\n          });\n        });\n      }\n    );\n\n    return () => {\n      SubscriptionDisplaySetsAdded.unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [displaySetService, dataSource, getImageSrc, thumbnailImageSrcMap, trackedSeries, viewports]);\n\n  useEffect(() => {\n    // TODO: Will this always hold _all_ the displaySets we care about?\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\n    const SubscriptionDisplaySetsChanged = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_CHANGED,\n      changedDisplaySets => {\n        const mappedDisplaySets = _mapDisplaySets(\n          changedDisplaySets,\n          displaySetsLoadingState,\n          thumbnailImageSrcMap,\n          trackedSeries,\n          viewports,\n          viewportGridService,\n          dataSource,\n          displaySetService,\n          uiDialogService,\n          uiNotificationService\n        );\n\n        setDisplaySets(mappedDisplaySets);\n      }\n    );\n\n    const SubscriptionDisplaySetMetaDataInvalidated = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,\n      () => {\n        const mappedDisplaySets = _mapDisplaySets(\n          displaySetService.getActiveDisplaySets(),\n          displaySetsLoadingState,\n          thumbnailImageSrcMap,\n          trackedSeries,\n          viewports,\n          viewportGridService,\n          dataSource,\n          displaySetService,\n          uiDialogService,\n          uiNotificationService\n        );\n\n        setDisplaySets(mappedDisplaySets);\n      }\n    );\n\n    return () => {\n      SubscriptionDisplaySetsChanged.unsubscribe();\n      SubscriptionDisplaySetMetaDataInvalidated.unsubscribe();\n    };\n  }, [\n    displaySetsLoadingState,\n    thumbnailImageSrcMap,\n    trackedSeries,\n    viewports,\n    dataSource,\n    displaySetService,\n  ]);\n\n  const tabs = createStudyBrowserTabs(StudyInstanceUIDs, studyDisplayList, displaySets);\n\n  // TODO: Should not fire this on \"close\"\n  function _handleStudyClick(StudyInstanceUID) {\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\n      ? [...expandedStudyInstanceUIDs.filter(stdyUid => stdyUid !== StudyInstanceUID)]\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\n\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\n\n    if (!shouldCollapseStudy) {\n      const madeInClient = true;\n      requestDisplaySetCreationForStudy(displaySetService, StudyInstanceUID, madeInClient);\n    }\n  }\n\n  useEffect(() => {\n    if (jumpToDisplaySet) {\n      // Get element by displaySetInstanceUID\n      const displaySetInstanceUID = jumpToDisplaySet;\n      const element = document.getElementById(`thumbnail-${displaySetInstanceUID}`);\n\n      if (element && typeof element.scrollIntoView === 'function') {\n        // TODO: Any way to support IE here?\n        element.scrollIntoView({ behavior: 'smooth' });\n\n        setJumpToDisplaySet(null);\n      }\n    }\n  }, [jumpToDisplaySet, expandedStudyInstanceUIDs, activeTabName]);\n\n  useEffect(() => {\n    if (!jumpToDisplaySet) {\n      return;\n    }\n\n    const displaySetInstanceUID = jumpToDisplaySet;\n    // Set the activeTabName and expand the study\n    const thumbnailLocation = _findTabAndStudyOfDisplaySet(displaySetInstanceUID, tabs);\n    if (!thumbnailLocation) {\n      console.warn('jumpToThumbnail: displaySet thumbnail not found.');\n\n      return;\n    }\n    const { tabName, StudyInstanceUID } = thumbnailLocation;\n    setActiveTabName(tabName);\n    const studyExpanded = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\n    if (!studyExpanded) {\n      const updatedExpandedStudyInstanceUIDs = [...expandedStudyInstanceUIDs, StudyInstanceUID];\n      setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\n    }\n  }, [expandedStudyInstanceUIDs, jumpToDisplaySet, tabs]);\n\n  const onClickUntrack = displaySetInstanceUID => {\n    const onConfirm = () => {\n      const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\n      sendTrackedMeasurementsEvent('UNTRACK_SERIES', {\n        SeriesInstanceUID: displaySet.SeriesInstanceUID,\n      });\n      const measurements = measurementService.getMeasurements();\n      measurements.forEach(m => {\n        if (m.referenceSeriesUID === displaySet.SeriesInstanceUID) {\n          measurementService.remove(m.uid);\n        }\n      });\n    };\n\n    uiDialogService.create({\n      id: 'untrack-series',\n      centralize: true,\n      isDraggable: false,\n      showOverlay: true,\n      content: Dialog,\n      contentProps: {\n        title: 'Untrack Series',\n        body: () => (\n          <div className=\"bg-primary-dark p-4 text-white\">\n            <p>Are you sure you want to untrack this series?</p>\n            <p className=\"mt-2\">\n              This action cannot be undone and will delete all your existing measurements.\n            </p>\n          </div>\n        ),\n        actions: [\n          {\n            id: 'cancel',\n            text: 'Cancel',\n            type: ButtonEnums.type.secondary,\n          },\n          {\n            id: 'yes',\n            text: 'Yes',\n            type: ButtonEnums.type.primary,\n            classes: ['untrack-yes-button'],\n          },\n        ],\n        onClose: () => uiDialogService.dismiss({ id: 'untrack-series' }),\n        onSubmit: async ({ action }) => {\n          switch (action.id) {\n            case 'yes':\n              onConfirm();\n              uiDialogService.dismiss({ id: 'untrack-series' });\n              break;\n            case 'cancel':\n              uiDialogService.dismiss({ id: 'untrack-series' });\n              break;\n          }\n        },\n      },\n    });\n  };\n\n  return (\n    <StudyBrowser\n      tabs={tabs}\n      servicesManager={servicesManager}\n      activeTabName={activeTabName}\n      expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\n      onClickStudy={_handleStudyClick}\n      onClickTab={clickedTabName => {\n        setActiveTabName(clickedTabName);\n      }}\n      onClickUntrack={displaySetInstanceUID => {\n        onClickUntrack(displaySetInstanceUID);\n      }}\n      onClickThumbnail={() => {}}\n      onDoubleClickThumbnail={onDoubleClickThumbnailHandler}\n      activeDisplaySetInstanceUIDs={activeViewportDisplaySetInstanceUIDs}\n    />\n  );\n}\n\nPanelStudyBrowserTracking.propTypes = {\n  servicesManager: PropTypes.object.isRequired,\n  dataSource: PropTypes.shape({\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\n  }).isRequired,\n  getImageSrc: PropTypes.func.isRequired,\n  getStudiesForPatientByMRN: PropTypes.func.isRequired,\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\n};\n\nexport default PanelStudyBrowserTracking;\n\nfunction getImageIdForThumbnail(displaySet: any, imageIds: any) {\n  let imageId;\n  if (displaySet.isDynamicVolume) {\n    const timePoints = displaySet.dynamicVolumeInfo.timePoints;\n    const middleIndex = Math.floor(timePoints.length / 2);\n    const middleTimePointImageIds = timePoints[middleIndex];\n    imageId = middleTimePointImageIds[Math.floor(middleTimePointImageIds.length / 2)];\n  } else {\n    imageId = imageIds[Math.floor(imageIds.length / 2)];\n  }\n  return imageId;\n}\n\n/**\n * Maps from the DataSource's format to a naturalized object\n *\n * @param {*} studies\n */\nfunction _mapDataSourceStudies(studies) {\n  return studies.map(study => {\n    // TODO: Why does the data source return in this format?\n    return {\n      AccessionNumber: study.accession,\n      StudyDate: study.date,\n      StudyDescription: study.description,\n      NumInstances: study.instances,\n      ModalitiesInStudy: study.modalities,\n      PatientID: study.mrn,\n      PatientName: study.patientName,\n      StudyInstanceUID: study.studyInstanceUid,\n      StudyTime: study.time,\n    };\n  });\n}\n\nfunction _mapDisplaySets(\n  displaySets,\n  displaySetLoadingState,\n  thumbnailImageSrcMap,\n  trackedSeriesInstanceUIDs,\n  viewports, // TODO: make array of `displaySetInstanceUIDs`?\n  viewportGridService,\n  dataSource,\n  displaySetService,\n  uiDialogService,\n  uiNotificationService\n) {\n  const thumbnailDisplaySets = [];\n  const thumbnailNoImageDisplaySets = [];\n  displaySets\n    .filter(ds => !ds.excludeFromThumbnailBrowser)\n    .forEach(ds => {\n      const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\n      const componentType = _getComponentType(ds);\n      const numPanes = viewportGridService.getNumViewportPanes();\n\n      const array =\n        componentType === 'thumbnailTracked' ? thumbnailDisplaySets : thumbnailNoImageDisplaySets;\n\n      const { displaySetInstanceUID } = ds;\n      const loadingProgress = displaySetLoadingState?.[displaySetInstanceUID];\n\n      const thumbnailProps = {\n        displaySetInstanceUID,\n        description: ds.SeriesDescription,\n        seriesNumber: ds.SeriesNumber,\n        modality: ds.Modality,\n        seriesDate: formatDate(ds.SeriesDate),\n        numInstances: ds.numImageFrames,\n        loadingProgress,\n        countIcon: ds.countIcon,\n        messages: ds.messages,\n        StudyInstanceUID: ds.StudyInstanceUID,\n        componentType,\n        imageSrc,\n        dragData: {\n          type: 'displayset',\n          displaySetInstanceUID,\n          // .. Any other data to pass\n        },\n        isTracked: trackedSeriesInstanceUIDs.includes(ds.SeriesInstanceUID),\n        isHydratedForDerivedDisplaySet: ds.isHydrated,\n      };\n\n      if (componentType === 'thumbnailNoImage') {\n        if (dataSource.reject && dataSource.reject.series) {\n          thumbnailProps.canReject = !ds?.unsupported;\n          thumbnailProps.onReject = () => {\n            uiDialogService.create({\n              id: 'ds-reject-sr',\n              centralize: true,\n              isDraggable: false,\n              showOverlay: true,\n              content: Dialog,\n              contentProps: {\n                title: 'Delete Report',\n                body: () => (\n                  <div className=\"bg-primary-dark p-4 text-white\">\n                    <p>Are you sure you want to delete this report?</p>\n                    <p className=\"mt-2\">This action cannot be undone.</p>\n                  </div>\n                ),\n                actions: [\n                  {\n                    id: 'cancel',\n                    text: 'Cancel',\n                    type: ButtonEnums.type.secondary,\n                  },\n                  {\n                    id: 'yes',\n                    text: 'Yes',\n                    type: ButtonEnums.type.primary,\n                    classes: ['reject-yes-button'],\n                  },\n                ],\n                onClose: () => uiDialogService.dismiss({ id: 'ds-reject-sr' }),\n                onShow: () => {\n                  const yesButton = document.querySelector('.reject-yes-button');\n\n                  yesButton.focus();\n                },\n                onSubmit: async ({ action }) => {\n                  switch (action.id) {\n                    case 'yes':\n                      try {\n                        await dataSource.reject.series(ds.StudyInstanceUID, ds.SeriesInstanceUID);\n                        displaySetService.deleteDisplaySet(displaySetInstanceUID);\n                        uiDialogService.dismiss({ id: 'ds-reject-sr' });\n                        uiNotificationService.show({\n                          title: 'Delete Report',\n                          message: 'Report deleted successfully',\n                          type: 'success',\n                        });\n                      } catch (error) {\n                        uiDialogService.dismiss({ id: 'ds-reject-sr' });\n                        uiNotificationService.show({\n                          title: 'Delete Report',\n                          message: 'Failed to delete report',\n                          type: 'error',\n                        });\n                      }\n                      break;\n                    case 'cancel':\n                      uiDialogService.dismiss({ id: 'ds-reject-sr' });\n                      break;\n                  }\n                },\n              },\n            });\n          };\n        } else {\n          thumbnailProps.canReject = false;\n        }\n      }\n\n      array.push(thumbnailProps);\n    });\n\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\n}\n\nconst thumbnailNoImageModalities = ['SR', 'SEG', 'SM', 'RTSTRUCT', 'RTPLAN', 'RTDOSE', 'DOC', 'OT'];\n\nfunction _getComponentType(ds) {\n  if (thumbnailNoImageModalities.includes(ds.Modality) || ds?.unsupported) {\n    return 'thumbnailNoImage';\n  }\n\n  return 'thumbnailTracked';\n}\n\nfunction _findTabAndStudyOfDisplaySet(displaySetInstanceUID, tabs) {\n  for (let t = 0; t < tabs.length; t++) {\n    const { studies } = tabs[t];\n\n    for (let s = 0; s < studies.length; s++) {\n      const { displaySets } = studies[s];\n\n      for (let d = 0; d < displaySets.length; d++) {\n        const displaySet = displaySets[d];\n\n        if (displaySet.displaySetInstanceUID === displaySetInstanceUID) {\n          return {\n            tabName: tabs[t].name,\n            StudyInstanceUID: studies[s].studyInstanceUid,\n          };\n        }\n      }\n    }\n  }\n}\n","/**\n * @param {*} cornerstone\n * @param {*} imageId\n */\nfunction getImageSrcFromImageId(cornerstone, imageId) {\n  return new Promise((resolve, reject) => {\n    const canvas = document.createElement('canvas');\n    cornerstone.utilities\n      .loadImageToCanvas({ canvas, imageId, thumbnail: true })\n      .then(imageId => {\n        resolve(canvas.toDataURL());\n      })\n      .catch(reject);\n  });\n}\n\nexport default getImageSrcFromImageId;\n","function requestDisplaySetCreationForStudy(\n  dataSource,\n  displaySetService,\n  StudyInstanceUID,\n  madeInClient\n) {\n  if (\n    displaySetService.activeDisplaySets.some(\n      displaySet => displaySet.StudyInstanceUID === StudyInstanceUID\n    )\n  ) {\n    return;\n  }\n\n  dataSource.retrieve.series.metadata({ StudyInstanceUID, madeInClient });\n}\n\nexport default requestDisplaySetCreationForStudy;\n","import React, { useCallback } from 'react';\nimport PropTypes from 'prop-types';\n//\nimport PanelStudyBrowserTracking from './PanelStudyBrowserTracking';\nimport getImageSrcFromImageId from './getImageSrcFromImageId';\nimport requestDisplaySetCreationForStudy from './requestDisplaySetCreationForStudy';\n\nfunction _getStudyForPatientUtility(extensionManager) {\n  const utilityModule = extensionManager.getModuleEntry(\n    '@ohif/extension-default.utilityModule.common'\n  );\n\n  const { getStudiesForPatientByMRN } = utilityModule.exports;\n  return getStudiesForPatientByMRN;\n}\n\n/**\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\n *\n * @param {object} params\n * @param {object} commandsManager\n * @param {object} extensionManager\n */\nfunction WrappedPanelStudyBrowserTracking({\n  commandsManager,\n  extensionManager,\n  servicesManager,\n}: withAppTypes) {\n  const dataSource = extensionManager.getActiveDataSource()[0];\n\n  const getStudiesForPatientByMRN = _getStudyForPatientUtility(extensionManager);\n  const _getStudiesForPatientByMRN = getStudiesForPatientByMRN.bind(null, dataSource);\n  const _getImageSrcFromImageId = useCallback(\n    _createGetImageSrcFromImageIdFn(extensionManager),\n    []\n  );\n  const _requestDisplaySetCreationForStudy = requestDisplaySetCreationForStudy.bind(\n    null,\n    dataSource\n  );\n\n  return (\n    <PanelStudyBrowserTracking\n      servicesManager={servicesManager}\n      dataSource={dataSource}\n      getImageSrc={_getImageSrcFromImageId}\n      getStudiesForPatientByMRN={_getStudiesForPatientByMRN}\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\n    />\n  );\n}\n\n/**\n * Grabs cornerstone library reference using a dependent command from\n * the @ohif/extension-cornerstone extension. Then creates a helper function\n * that can take an imageId and return an image src.\n *\n * @param {func} getCommand - CommandManager's getCommand method\n * @returns {func} getImageSrcFromImageId - A utility function powered by\n * cornerstone\n */\nfunction _createGetImageSrcFromImageIdFn(extensionManager) {\n  const utilities = extensionManager.getModuleEntry(\n    '@ohif/extension-cornerstone.utilityModule.common'\n  );\n\n  try {\n    const { cornerstone } = utilities.exports.getCornerstoneLibraries();\n    return getImageSrcFromImageId.bind(null, cornerstone);\n  } catch (ex) {\n    throw new Error('Required command not found');\n  }\n}\n\nWrappedPanelStudyBrowserTracking.propTypes = {\n  commandsManager: PropTypes.object.isRequired,\n  extensionManager: PropTypes.object.isRequired,\n  servicesManager: PropTypes.object.isRequired,\n};\n\nexport default WrappedPanelStudyBrowserTracking;\n","import React, { useEffect, useState, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { StudySummary, MeasurementTable, useViewportGrid, ActionButtons } from '@ohif/ui';\nimport { DicomMetadataStore, utils } from '@ohif/core';\nimport { useDebounce } from '@hooks';\nimport { useAppConfig } from '@state';\nimport { useTrackedMeasurements } from '../../getContextModule';\nimport debounce from 'lodash.debounce';\nimport { useTranslation } from 'react-i18next';\n\nconst { downloadCSVReport } = utils;\nconst { formatDate } = utils;\n\nconst DISPLAY_STUDY_SUMMARY_INITIAL_VALUE = {\n  key: undefined, //\n  date: '', // '07-Sep-2010',\n  modality: '', // 'CT',\n  description: '', // 'CHEST/ABD/PELVIS W CONTRAST',\n};\n\nfunction PanelMeasurementTableTracking({ servicesManager, extensionManager }: withAppTypes) {\n  const [viewportGrid] = useViewportGrid();\n  const { t } = useTranslation('MeasurementTable');\n  const [measurementChangeTimestamp, setMeasurementsUpdated] = useState(Date.now().toString());\n  const debouncedMeasurementChangeTimestamp = useDebounce(measurementChangeTimestamp, 200);\n  const { measurementService, uiDialogService, displaySetService, customizationService } =\n    servicesManager.services;\n  const [trackedMeasurements, sendTrackedMeasurementsEvent] = useTrackedMeasurements();\n  const { trackedStudy, trackedSeries } = trackedMeasurements.context;\n  const [displayStudySummary, setDisplayStudySummary] = useState(\n    DISPLAY_STUDY_SUMMARY_INITIAL_VALUE\n  );\n  const [displayMeasurements, setDisplayMeasurements] = useState([]);\n  const measurementsPanelRef = useRef(null);\n  const [appConfig] = useAppConfig();\n\n  useEffect(() => {\n    const measurements = measurementService.getMeasurements();\n    const filteredMeasurements = measurements.filter(\n      m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\n    );\n\n    const mappedMeasurements = filteredMeasurements.map(m =>\n      _mapMeasurementToDisplay(m, measurementService.VALUE_TYPES, displaySetService)\n    );\n    setDisplayMeasurements(mappedMeasurements);\n    // eslint-ignore-next-line\n  }, [measurementService, trackedStudy, trackedSeries, debouncedMeasurementChangeTimestamp]);\n\n  const updateDisplayStudySummary = async () => {\n    if (trackedMeasurements.matches('tracking')) {\n      const StudyInstanceUID = trackedStudy;\n      const studyMeta = DicomMetadataStore.getStudy(StudyInstanceUID);\n      const instanceMeta = studyMeta.series[0].instances[0];\n      const { StudyDate, StudyDescription } = instanceMeta;\n\n      const modalities = new Set();\n      studyMeta.series.forEach(series => {\n        if (trackedSeries.includes(series.SeriesInstanceUID)) {\n          modalities.add(series.instances[0].Modality);\n        }\n      });\n      const modality = Array.from(modalities).join('/');\n\n      if (displayStudySummary.key !== StudyInstanceUID) {\n        setDisplayStudySummary({\n          key: StudyInstanceUID,\n          date: StudyDate, // TODO: Format: '07-Sep-2010'\n          modality,\n          description: StudyDescription,\n        });\n      }\n    } else if (trackedStudy === '' || trackedStudy === undefined) {\n      setDisplayStudySummary(DISPLAY_STUDY_SUMMARY_INITIAL_VALUE);\n    }\n  };\n\n  // ~~ DisplayStudySummary\n  useEffect(() => {\n    updateDisplayStudySummary();\n  }, [displayStudySummary.key, trackedMeasurements, trackedStudy, updateDisplayStudySummary]);\n\n  // TODO: Better way to consolidated, debounce, check on change?\n  // Are we exposing the right API for measurementService?\n  // This watches for ALL measurementService changes. It updates a timestamp,\n  // which is debounced. After a brief period of inactivity, this triggers\n  // a re-render where we grab up-to-date measurements\n  useEffect(() => {\n    const added = measurementService.EVENTS.MEASUREMENT_ADDED;\n    const addedRaw = measurementService.EVENTS.RAW_MEASUREMENT_ADDED;\n    const updated = measurementService.EVENTS.MEASUREMENT_UPDATED;\n    const removed = measurementService.EVENTS.MEASUREMENT_REMOVED;\n    const cleared = measurementService.EVENTS.MEASUREMENTS_CLEARED;\n    const subscriptions = [];\n\n    [added, addedRaw, updated, removed, cleared].forEach(evt => {\n      subscriptions.push(\n        measurementService.subscribe(evt, () => {\n          setMeasurementsUpdated(Date.now().toString());\n          if (evt === added) {\n            debounce(() => {\n              measurementsPanelRef.current.scrollTop = measurementsPanelRef.current.scrollHeight;\n            }, 300)();\n          }\n        }).unsubscribe\n      );\n    });\n\n    return () => {\n      subscriptions.forEach(unsub => {\n        unsub();\n      });\n    };\n  }, [measurementService, sendTrackedMeasurementsEvent]);\n\n  async function exportReport() {\n    const measurements = measurementService.getMeasurements();\n    const trackedMeasurements = measurements.filter(\n      m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\n    );\n\n    downloadCSVReport(trackedMeasurements, measurementService);\n  }\n\n  const jumpToImage = ({ uid, isActive }) => {\n    measurementService.jumpToMeasurement(viewportGrid.activeViewportId, uid);\n\n    onMeasurementItemClickHandler({ uid, isActive });\n  };\n\n  const onMeasurementItemEditHandler = ({ uid, isActive }) => {\n    jumpToImage({ uid, isActive });\n    const labelConfig = customizationService.get('measurementLabels');\n    const measurement = measurementService.getMeasurement(uid);\n    const utilityModule = extensionManager.getModuleEntry(\n      '@ohif/extension-cornerstone.utilityModule.common'\n    );\n    const { showLabelAnnotationPopup } = utilityModule.exports;\n    showLabelAnnotationPopup(measurement, uiDialogService, labelConfig).then(\n      (val: Map<any, any>) => {\n        measurementService.update(\n          uid,\n          {\n            ...val,\n          },\n          true\n        );\n      }\n    );\n  };\n\n  const onMeasurementItemClickHandler = ({ uid, isActive }) => {\n    if (!isActive) {\n      const measurements = [...displayMeasurements];\n      const measurement = measurements.find(m => m.uid === uid);\n\n      measurements.forEach(m => (m.isActive = m.uid !== uid ? false : true));\n      measurement.isActive = true;\n      setDisplayMeasurements(measurements);\n    }\n  };\n\n  const displayMeasurementsWithoutFindings = displayMeasurements.filter(\n    dm => dm.measurementType !== measurementService.VALUE_TYPES.POINT && dm.referencedImageId\n  );\n  const additionalFindings = displayMeasurements.filter(\n    dm => dm.measurementType === measurementService.VALUE_TYPES.POINT && dm.referencedImageId\n  );\n\n  const nonAcquisitionMeasurements = displayMeasurements.filter(dm => dm.referencedImageId == null);\n\n  const disabled =\n    additionalFindings.length === 0 &&\n    displayMeasurementsWithoutFindings.length === 0 &&\n    nonAcquisitionMeasurements.length === 0;\n\n  return (\n    <>\n      <div\n        className=\"invisible-scrollbar overflow-y-auto overflow-x-hidden\"\n        ref={measurementsPanelRef}\n        data-cy={'trackedMeasurements-panel'}\n      >\n        {displayStudySummary.key && (\n          <StudySummary\n            date={formatDate(displayStudySummary.date)}\n            modality={displayStudySummary.modality}\n            description={displayStudySummary.description}\n          />\n        )}\n        <MeasurementTable\n          title=\"Measurements\"\n          data={displayMeasurementsWithoutFindings}\n          servicesManager={servicesManager}\n          onClick={jumpToImage}\n          onEdit={onMeasurementItemEditHandler}\n        />\n        {additionalFindings.length !== 0 && (\n          <MeasurementTable\n            title=\"Additional Findings\"\n            data={additionalFindings}\n            servicesManager={servicesManager}\n            onClick={jumpToImage}\n            onEdit={onMeasurementItemEditHandler}\n          />\n        )}\n        {nonAcquisitionMeasurements.length !== 0 && (\n          <MeasurementTable\n            title=\"Non-tracked\"\n            data={nonAcquisitionMeasurements}\n            servicesManager={servicesManager}\n            onClick={jumpToImage}\n            onEdit={onMeasurementItemEditHandler}\n          />\n        )}\n      </div>\n      {!appConfig?.disableEditing && (\n        <div className=\"flex justify-center p-4\">\n          <ActionButtons\n            t={t}\n            actions={[\n              {\n                label: 'Download CSV',\n                onClick: exportReport,\n              },\n              {\n                label: 'Create Report',\n                onClick: () => {\n                  sendTrackedMeasurementsEvent('SAVE_REPORT', {\n                    viewportId: viewportGrid.activeViewportId,\n                    isBackupSave: true,\n                  });\n                },\n              },\n            ]}\n            disabled={disabled}\n          />\n        </div>\n      )}\n    </>\n  );\n}\n\nPanelMeasurementTableTracking.propTypes = {\n  servicesManager: PropTypes.shape({\n    services: PropTypes.shape({\n      measurementService: PropTypes.shape({\n        getMeasurements: PropTypes.func.isRequired,\n        VALUE_TYPES: PropTypes.object.isRequired,\n      }).isRequired,\n    }).isRequired,\n  }).isRequired,\n};\n\n// TODO: This could be a measurementService mapper\nfunction _mapMeasurementToDisplay(measurement, types, displaySetService) {\n  const { referenceStudyUID, referenceSeriesUID, SOPInstanceUID } = measurement;\n\n  // TODO: We don't deal with multiframe well yet, would need to update\n  // This in OHIF-312 when we add FrameIndex to measurements.\n\n  const instance = DicomMetadataStore.getInstance(\n    referenceStudyUID,\n    referenceSeriesUID,\n    SOPInstanceUID\n  );\n\n  const displaySets = displaySetService.getDisplaySetsForSeries(referenceSeriesUID);\n\n  if (!displaySets[0] || !displaySets[0].images) {\n    throw new Error('The tracked measurements panel should only be tracking \"stack\" displaySets.');\n  }\n\n  const {\n    displayText: baseDisplayText,\n    uid,\n    label: baseLabel,\n    type,\n    selected,\n    findingSites,\n    finding,\n    referencedImageId,\n  } = measurement;\n\n  const firstSite = findingSites?.[0];\n  const label = baseLabel || finding?.text || firstSite?.text || '(empty)';\n  let displayText = baseDisplayText || [];\n  if (findingSites) {\n    const siteText = [];\n    findingSites.forEach(site => {\n      if (site?.text !== label) {\n        siteText.push(site.text);\n      }\n    });\n    displayText = [...siteText, ...displayText];\n  }\n  if (finding && finding?.text !== label) {\n    displayText = [finding.text, ...displayText];\n  }\n\n  return {\n    uid,\n    label,\n    baseLabel,\n    measurementType: type,\n    displayText,\n    baseDisplayText,\n    isActive: selected,\n    finding,\n    findingSites,\n    referencedImageId,\n  };\n}\n\nexport default PanelMeasurementTableTracking;\n","import { Types } from '@ohif/core';\nimport { PanelMeasurementTableTracking, PanelStudyBrowserTracking } from './panels';\nimport i18n from 'i18next';\n\n// TODO:\n// - No loading UI exists yet\n// - cancel promises when component is destroyed\n// - show errors in UI for thumbnails if promise fails\nfunction getPanelModule({ commandsManager, extensionManager, servicesManager }): Types.Panel[] {\n  return [\n    {\n      name: 'seriesList',\n      iconName: 'tab-studies',\n      iconLabel: 'Studies',\n      label: i18n.t('SidePanel:Studies'),\n      component: PanelStudyBrowserTracking.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n\n    {\n      name: 'trackedMeasurements',\n      iconName: 'tab-linear',\n      iconLabel: 'Measure',\n      label: i18n.t('SidePanel:Measurements'),\n      component: PanelMeasurementTableTracking.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n  ];\n}\n\nexport default getPanelModule;\n","import React from 'react';\n\nconst Component = React.lazy(() => {\n  return import(/* webpackPrefetch: true */ './viewports/TrackedCornerstoneViewport');\n});\n\nconst OHIFCornerstoneViewport = props => {\n  return (\n    <React.Suspense fallback={<div>Loading...</div>}>\n      <Component {...props} />\n    </React.Suspense>\n  );\n};\n\nfunction getViewportModule({ servicesManager, commandsManager, extensionManager }) {\n  const ExtendedOHIFCornerstoneTrackingViewport = props => {\n    return (\n      <OHIFCornerstoneViewport\n        servicesManager={servicesManager}\n        commandsManager={commandsManager}\n        extensionManager={extensionManager}\n        {...props}\n      />\n    );\n  };\n\n  return [\n    {\n      name: 'cornerstone-tracked',\n      component: ExtendedOHIFCornerstoneTrackingViewport,\n    },\n  ];\n}\n\nexport default getViewportModule;\n","import getContextModule from './getContextModule';\nimport getPanelModule from './getPanelModule';\nimport getViewportModule from './getViewportModule';\nimport { id } from './id.js';\n\nconst measurementTrackingExtension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id,\n\n  getContextModule,\n  getPanelModule,\n  getViewportModule,\n};\n\nexport default measurementTrackingExtension;\n","import packageJson from '../package.json';\n\nconst id = packageJson.name;\n\nexport { id };\n"],"names":["RESPONSE","machineConfiguration","id","initial","context","activeViewportId","trackedStudy","trackedSeries","ignoredSeries","prevTrackedStudy","prevTrackedSeries","prevIgnoredSeries","ignoredSRSeriesForHydration","isDirty","states","off","type","labellingOnly","on","TRACK_SERIES","target","actions","idle","entry","cond","SET_TRACKED_SERIES","PROMPT_HYDRATE_SR","RESTORE_PROMPT_HYDRATE_SR","HYDRATE_SR","UPDATE_ACTIVE_VIEWPORT_ID","assign","_","event","promptBeginTracking","invoke","src","onDone","onError","tracking","UNTRACK_SERIES","SAVE_REPORT","SET_DIRTY","promptTrackNewSeries","promptTrackNewStudy","promptSaveReport","promptHydrateStructuredReport","hydrateStructuredReport","promptLabelAnnotation","strict","defaultOptions","services","discardPreviouslyTrackedMeasurements","ctx","evt","console","log","clearAllMeasurements","jumpToFirstMeasurementInActiveViewport","warn","showStructuredReportDisplaySetInActiveViewport","clearContext","setTrackedStudyAndSeries","slice","data","StudyInstanceUID","SeriesInstanceUID","setTrackedStudyAndMultipleSeries","studyInstanceUID","seriesInstanceUIDs","SeriesInstanceUIDs","setIsDirtyToClean","setIsDirty","ignoreSeries","ignoreHydrationForSRSeries","srSeriesInstanceUID","addTrackedSeries","removeTrackedSeries","filter","ser","setPreviousState","meta","prevState","state","value","guards","shouldSetDirty","undefined","includes","wasLabellingOnly","condMeta","wasIdle","wasTracking","wasTrackingAndIsNewStudy","wasTrackingAndIsNewSeries","shouldKillMachine","userResponse","shouldAddSeries","shouldSetStudyAndSeries","shouldAddIgnoredSeries","shouldPromptSaveReport","shouldIgnoreHydrationForSR","shouldSaveAndContinueWithSameReport","isBackupSave","shouldSaveAndStartNewReport","shouldHydrateStructuredReport","hasRemainingTrackedSeries","length","hasNotIgnoredSRSeriesForHydration","isNewStudy","isNewSeries","NO_NEVER","CANCEL","CREATE_REPORT","ADD_SERIES","SET_STUDY_AND_SERIES","NO_NOT_FOR_SERIES","async","servicesManager","commandsManager","extensionManager","uiDialogService","measurementService","displaySetService","viewportId","displaySetInstanceUIDs","promptResult","createReportDialogPrompt","action","dataSource","getDataSources","trackedMeasurements","getMeasurements","m","referenceStudyUID","referenceSeriesUID","referencedImageId","SeriesDescription","SeriesNumber","srSeriesNumbers","getActiveDisplaySets","ds","Modality","map","Math","max","getNextSRSeriesNumber","getReport","runCommand","measurementData","additionalFindingTypes","options","createReportAsync","createdDisplaySetInstanceUIDs","error","appConfig","uiViewportDialogService","displaySetInstanceUID","srDisplaySet","getDisplaySetByUID","Promise","resolve","reject","disableConfirmationPrompts","message","ButtonEnums","secondary","text","primary","onSubmit","result","hide","show","onOutsideClick","onKeyPress","key","find","_askTrackMeasurements","hydrationResult","baseHydrateStructuredReport","customizationService","measurementId","utilityModule","getModuleEntry","showLabelAnnotationPopup","exports","labelConfig","get","measurement","getMeasurement","update","TrackedMeasurementsContext","React","displayName","useTrackedMeasurements","useContext","SR_SOPCLASSHANDLERID","TrackedMeasurementsContextProvider","children","useAppConfig","viewportGrid","viewportGridService","useViewportGrid","viewports","cornerstoneViewportService","machineOptions","Object","referencedDisplaySetUID","referencedImages","images","isVolumeIdReferenced","imageId","startsWith","imageIndex","findIndex","image","imageIdToUse","keys","substring","setDisplaySetsForViewport","viewportOptions","initialImageOptions","index","jumpToSameImageInActiveViewport","getCornerstoneViewport","getCurrentImageIdIndex","StructuredReportDisplaySetInstanceUID","measurementIds","ms","fm","i","remove","uid","bind","isLabelOnMeasure","labelOnMeasure","isLabelOnMeasureAndShouldKillMachine","measurementTrackingMachine","Machine","sendTrackedMeasurementsEvent","useMachine","useEffect","size","activeViewport","displaySet","SOPClassHandlerId","isLoaded","load","isRehydratable","triggerPromptHydrateFlow","Provider","propTypes","PropTypes","isRequired","BoundTrackedMeasurementsContextProvider","name","provider","formatDate","createStudyBrowserTabs","utils","PanelStudyBrowserTracking","getImageSrc","getStudiesForPatientByMRN","requestDisplaySetCreationForStudy","hangingProtocolService","uiNotificationService","studyPrefetcherService","navigate","useNavigate","t","useTranslation","StudyInstanceUIDs","useImageViewer","isHangingProtocolLayout","activeTabName","setActiveTabName","useState","expandedStudyInstanceUIDs","setExpandedStudyInstanceUIDs","studyDisplayList","setStudyDisplayList","displaySets","setDisplaySets","displaySetsLoadingState","setDisplaySetsLoadingState","thumbnailImageSrcMap","setThumbnailImageSrcMap","jumpToDisplaySet","setJumpToDisplaySet","activeViewportDisplaySetInstanceUIDs","forEach","sid","qidoForStudyUID","query","studies","search","studyInstanceUid","Error","qidoStudiesForPatient","actuallyMappedStudies","study","AccessionNumber","accession","StudyDate","date","StudyDescription","description","NumInstances","instances","ModalitiesInStudy","modalities","PatientID","mrn","PatientName","patientName","StudyTime","time","qidoStudy","numInstances","prevArray","ret","it","push","fetchStudiesForPatient","currentDisplaySets","activeDisplaySets","newImageSrcEntry","dSet","getImageIdForThumbnail","getImageIdsForDisplaySet","unsupported","mappedDisplaySets","_mapDisplaySets","unsubscribe","subscribe","EVENTS","DISPLAYSET_LOAD_PROGRESS","updatedDisplaySetLoadingState","loadingProgress","SubscriptionDisplaySetsAdded","DISPLAY_SETS_ADDED","displaySetsAdded","madeInClient","SubscriptionDisplaySetsChanged","DISPLAY_SETS_CHANGED","changedDisplaySets","SubscriptionDisplaySetMetaDataInvalidated","DISPLAY_SET_SERIES_METADATA_INVALIDATED","tabs","element","document","getElementById","scrollIntoView","behavior","thumbnailLocation","s","d","tabName","_findTabAndStudyOfDisplaySet","updatedExpandedStudyInstanceUIDs","onClickUntrack","create","centralize","isDraggable","showOverlay","content","Dialog","contentProps","title","body","className","classes","onClose","dismiss","onConfirm","StudyBrowser","onClickStudy","shouldCollapseStudy","stdyUid","onClickTab","clickedTabName","onClickThumbnail","onDoubleClickThumbnail","updatedViewports","getViewportsRequireUpdate","duration","setDisplaySetsForViewports","activeDisplaySetInstanceUIDs","imageIds","isDynamicVolume","timePoints","dynamicVolumeInfo","middleTimePointImageIds","floor","displaySetLoadingState","trackedSeriesInstanceUIDs","thumbnailDisplaySets","thumbnailNoImageDisplaySets","excludeFromThumbnailBrowser","imageSrc","componentType","thumbnailNoImageModalities","_getComponentType","array","getNumViewportPanes","thumbnailProps","seriesNumber","modality","seriesDate","SeriesDate","numImageFrames","countIcon","messages","dragData","isTracked","isHydratedForDerivedDisplaySet","isHydrated","series","canReject","onReject","onShow","querySelector","focus","deleteDisplaySet","cornerstone","canvas","createElement","utilities","loadImageToCanvas","thumbnail","then","toDataURL","catch","some","retrieve","metadata","WrappedPanelStudyBrowserTracking","getActiveDataSource","_getStudyForPatientUtility","_getStudiesForPatientByMRN","_getImageSrcFromImageId","useCallback","getCornerstoneLibraries","getImageSrcFromImageId","ex","_createGetImageSrcFromImageIdFn","_requestDisplaySetCreationForStudy","downloadCSVReport","DISPLAY_STUDY_SUMMARY_INITIAL_VALUE","PanelMeasurementTableTracking","measurementChangeTimestamp","setMeasurementsUpdated","Date","now","toString","debouncedMeasurementChangeTimestamp","useDebounce","displayStudySummary","setDisplayStudySummary","displayMeasurements","setDisplayMeasurements","measurementsPanelRef","useRef","mappedMeasurements","types","SOPInstanceUID","DicomMetadataStore","getInstance","getDisplaySetsForSeries","displayText","baseDisplayText","label","baseLabel","selected","findingSites","finding","firstSite","siteText","site","measurementType","isActive","_mapMeasurementToDisplay","VALUE_TYPES","updateDisplayStudySummary","matches","studyMeta","getStudy","instanceMeta","Set","add","Array","from","join","added","MEASUREMENT_ADDED","addedRaw","RAW_MEASUREMENT_ADDED","updated","MEASUREMENT_UPDATED","removed","MEASUREMENT_REMOVED","cleared","MEASUREMENTS_CLEARED","subscriptions","debounce","current","scrollTop","scrollHeight","unsub","jumpToImage","jumpToMeasurement","onMeasurementItemClickHandler","onMeasurementItemEditHandler","val","measurements","displayMeasurementsWithoutFindings","dm","POINT","additionalFindings","nonAcquisitionMeasurements","disabled","ref","StudySummary","MeasurementTable","onClick","onEdit","disableEditing","ActionButtons","iconName","iconLabel","i18n","component","Component","OHIFCornerstoneViewport","props","fallback","_extends","packageJson","getContextModule","getPanelModule","getViewportModule"],"sourceRoot":""}