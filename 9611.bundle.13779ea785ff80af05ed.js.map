{"version":3,"file":"9611.bundle.13779ea785ff80af05ed.js","mappings":"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","sources":["webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportImageScrollbar.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportOrientationMarkers.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportImageSliceLoadingIndicator.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/CornerstoneOverlays.tsx","webpack:///../../../extensions/cornerstone/src/components/CinePlayer/CinePlayer.tsx","webpack:///../../../extensions/cornerstone/src/components/CinePlayer/index.ts","webpack:///../../../extensions/cornerstone/src/components/OHIFViewportActionCorners.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/Colormap.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/Colorbar.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/WindowLevel.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingPresetsContent.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingPresets.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingQuality.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeShift.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeLighting.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeShade.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingOptions.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/WindowLevelActionMenu.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/getWindowLevelActionMenu.tsx","webpack:///../../../extensions/cornerstone/src/components/ViewportDataOverlaySettingMenu/ViewportSegmentationMenu.tsx","webpack:///../../../extensions/cornerstone/src/components/ViewportDataOverlaySettingMenu/ViewportSegmentationMenuWrapper.tsx","webpack:///../../../extensions/cornerstone/src/components/ViewportDataOverlaySettingMenu/index.tsx","webpack:///../../../extensions/cornerstone/src/utils/ActiveViewportBehavior.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/OHIFCornerstoneViewport.tsx","webpack:///../../../extensions/cornerstone/src/utils/presentations/getViewportPresentations.ts"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Enums, VolumeViewport3D, utilities as csUtils } from '@cornerstonejs/core';\r\nimport { ImageScrollbar } from '@ohif/ui';\r\n\r\nfunction CornerstoneImageScrollbar({\r\n  viewportData,\r\n  viewportId,\r\n  element,\r\n  imageSliceData,\r\n  setImageSliceData,\r\n  scrollbarWidth,\r\n  servicesManager,\r\n}: withAppTypes<{\r\n  element: HTMLElement;\r\n}>) {\r\n  const { cineService, cornerstoneViewportService, panoramicService, viewportGridService } =\r\n    servicesManager.services;\r\n\r\n  const [isDentascan, setIsDentascan] = useState(viewportId.startsWith('dentascan'));\r\n\r\n  const onImageScrollbarChange = (imageIndex, viewportId) => {\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n    const { isCineEnabled } = cineService.getState();\r\n\r\n    if (isCineEnabled) {\r\n      // on image scrollbar change, stop the CINE if it is playing\r\n      cineService.stopClip(element, { viewportId });\r\n      cineService.setCine({ id: viewportId, isPlaying: false });\r\n    }\r\n\r\n    csUtils.jumpToSlice(viewport.element, {\r\n      imageIndex,\r\n      debounceLoading: true,\r\n    });\r\n\r\n    const _isDentascan = viewportId.startsWith('dentascan');\r\n    setIsDentascan(_isDentascan);\r\n    if (viewportId === 'panoramic' || _isDentascan) {\r\n      // Hardcoded for scrollbar in panoramic\r\n      if (_isDentascan) {\r\n        const viewportIds = cornerstoneViewportService.getViewportIds();\r\n        const viewportIndex = viewportIds.findIndex(vpId => vpId === viewportId);\r\n        const middleDentascanViewportIndex = Math.round(viewportIds.length / 2);\r\n        imageIndex += (viewportIndex - middleDentascanViewportIndex) * 2;\r\n      }\r\n      const displaySetUID = viewportGridService.getDisplaySetsUIDsForViewport('default')[0];\r\n      panoramicService.setDentascanIndex(displaySetUID, imageIndex);\r\n      setImageSliceData({\r\n        imageIndex: imageIndex,\r\n        numberOfSlices: imageSliceData.numberOfSlices,\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!viewportData) {\r\n      return;\r\n    }\r\n\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n    if (!viewport || viewport instanceof VolumeViewport3D) {\r\n      return;\r\n    }\r\n\r\n    const imageIndex = viewport.getCurrentImageIdIndex();\r\n    const numberOfSlices = viewport.getNumberOfSlices();\r\n\r\n    setImageSliceData({\r\n      imageIndex: imageIndex,\r\n      numberOfSlices,\r\n    });\r\n\r\n    setIsDentascan(viewportId.startsWith('dentascan'));\r\n    if (viewportId === 'panoramic') {\r\n      const displaySetUID = viewportGridService.getDisplaySetsUIDsForViewport('default')[0];\r\n      const widthPanoramic =\r\n        panoramicService.getPanoramicState(displaySetUID).panoramicDimensions[0];\r\n      setImageSliceData({\r\n        imageIndex: Math.round(widthPanoramic / 2),\r\n        numberOfSlices: widthPanoramic,\r\n      });\r\n    }\r\n  }, [viewportId, viewportData]);\r\n\r\n  useEffect(() => {\r\n    if (!viewportData) {\r\n      return;\r\n    }\r\n    const { viewportType } = viewportData;\r\n    const eventId =\r\n      (viewportType === Enums.ViewportType.STACK && Enums.Events.STACK_VIEWPORT_SCROLL) ||\r\n      (viewportType === Enums.ViewportType.ORTHOGRAPHIC && Enums.Events.VOLUME_NEW_IMAGE) ||\r\n      Enums.Events.IMAGE_RENDERED;\r\n\r\n    const updateIndex = event => {\r\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n      if (!viewport || viewport instanceof VolumeViewport3D) {\r\n        return;\r\n      }\r\n      const { imageIndex, newImageIdIndex = imageIndex } = event.detail;\r\n      const numberOfSlices = viewport.getNumberOfSlices();\r\n      // find the index of imageId in the imageIds\r\n      setImageSliceData({\r\n        imageIndex: newImageIdIndex,\r\n        numberOfSlices,\r\n      });\r\n    };\r\n\r\n    element.addEventListener(eventId, updateIndex);\r\n\r\n    return () => {\r\n      element.removeEventListener(eventId, updateIndex);\r\n    };\r\n  }, [viewportData, element]);\r\n\r\n  return (\r\n    !isDentascan && (\r\n      <ImageScrollbar\r\n        onChange={evt => onImageScrollbarChange(evt, viewportId)}\r\n        max={imageSliceData.numberOfSlices ? imageSliceData.numberOfSlices - 1 : 0}\r\n        height={scrollbarWidth}\r\n        value={imageSliceData.imageIndex || 0}\r\n      />\r\n    )\r\n  );\r\n}\r\n\r\nCornerstoneImageScrollbar.propTypes = {\r\n  viewportData: PropTypes.object,\r\n  viewportId: PropTypes.string.isRequired,\r\n  element: PropTypes.instanceOf(Element),\r\n  scrollbarHeight: PropTypes.string,\r\n  imageSliceData: PropTypes.object.isRequired,\r\n  setImageSliceData: PropTypes.func.isRequired,\r\n  servicesManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default CornerstoneImageScrollbar;\r\n","import React, { useEffect, useState, useMemo } from 'react';\r\nimport classNames from 'classnames';\r\nimport { metaData, Enums, Types, getEnabledElement } from '@cornerstonejs/core';\r\nimport { utilities } from '@cornerstonejs/tools';\r\nimport { vec3 } from 'gl-matrix';\r\n\r\nimport './ViewportOrientationMarkers.css';\r\n\r\nconst { getOrientationStringLPS, invertOrientationStringLPS } = utilities.orientation;\r\n\r\nfunction ViewportOrientationMarkers({\r\n  element,\r\n  viewportData,\r\n  imageSliceData,\r\n  viewportId,\r\n  servicesManager,\r\n  orientationMarkers = ['top', 'left'],\r\n}: withAppTypes) {\r\n  // Rotation is in degrees\r\n  const [rotation, setRotation] = useState(0);\r\n  const [flipHorizontal, setFlipHorizontal] = useState(false);\r\n  const [flipVertical, setFlipVertical] = useState(false);\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n\r\n  useEffect(() => {\r\n    const cameraModifiedListener = (evt: Types.EventTypes.CameraModifiedEvent) => {\r\n      const { previousCamera, camera } = evt.detail;\r\n\r\n      const { rotation } = camera;\r\n      if (rotation !== undefined) {\r\n        setRotation(rotation);\r\n      }\r\n\r\n      if (\r\n        camera.flipHorizontal !== undefined &&\r\n        previousCamera.flipHorizontal !== camera.flipHorizontal\r\n      ) {\r\n        setFlipHorizontal(camera.flipHorizontal);\r\n      }\r\n\r\n      if (\r\n        camera.flipVertical !== undefined &&\r\n        previousCamera.flipVertical !== camera.flipVertical\r\n      ) {\r\n        setFlipVertical(camera.flipVertical);\r\n      }\r\n    };\r\n\r\n    element.addEventListener(Enums.Events.CAMERA_MODIFIED, cameraModifiedListener);\r\n\r\n    return () => {\r\n      element.removeEventListener(Enums.Events.CAMERA_MODIFIED, cameraModifiedListener);\r\n    };\r\n  }, []);\r\n\r\n  const markers = useMemo(() => {\r\n    if (!viewportData) {\r\n      return '';\r\n    }\r\n\r\n    let rowCosines, columnCosines, isDefaultValueSetForRowCosine, isDefaultValueSetForColumnCosine;\r\n    if (viewportData.viewportType === 'stack') {\r\n      const imageIndex = imageSliceData.imageIndex;\r\n      const imageId = viewportData.data[0].imageIds?.[imageIndex];\r\n\r\n      // Workaround for below TODO stub\r\n      if (!imageId) {\r\n        return false;\r\n      }\r\n\r\n      ({\r\n        rowCosines,\r\n        columnCosines,\r\n        isDefaultValueSetForColumnCosine,\r\n        isDefaultValueSetForColumnCosine,\r\n      } = metaData.get('imagePlaneModule', imageId) || {});\r\n    } else {\r\n      if (!element || !getEnabledElement(element)) {\r\n        return '';\r\n      }\r\n\r\n      const { viewport } = getEnabledElement(element);\r\n      const { viewUp, viewPlaneNormal } = viewport.getCamera();\r\n\r\n      const viewRight = vec3.create();\r\n      vec3.cross(viewRight, viewUp, viewPlaneNormal);\r\n\r\n      columnCosines = [-viewUp[0], -viewUp[1], -viewUp[2]];\r\n      rowCosines = viewRight;\r\n    }\r\n\r\n    if (\r\n      !rowCosines ||\r\n      !columnCosines ||\r\n      rotation === undefined ||\r\n      isDefaultValueSetForRowCosine ||\r\n      isDefaultValueSetForColumnCosine\r\n    ) {\r\n      return '';\r\n    }\r\n\r\n    const markers = _getOrientationMarkers(\r\n      rowCosines,\r\n      columnCosines,\r\n      rotation,\r\n      flipVertical,\r\n      flipHorizontal\r\n    );\r\n\r\n    const ohifViewport = cornerstoneViewportService.getViewportInfo(viewportId);\r\n\r\n    if (!ohifViewport) {\r\n      console.log('ViewportOrientationMarkers::No viewport');\r\n      return null;\r\n    }\r\n\r\n    return orientationMarkers.map((m, index) => (\r\n      <div\r\n        className={classNames(\r\n          'overlay-text',\r\n          `${m}-mid orientation-marker`,\r\n          'text-aqua-pale',\r\n          'text-[13px]',\r\n          'leading-5'\r\n        )}\r\n        key={`${m}-mid orientation-marker`}\r\n      >\r\n        <div className=\"orientation-marker-value\">{markers[m]}</div>\r\n      </div>\r\n    ));\r\n  }, [\r\n    viewportData,\r\n    imageSliceData,\r\n    rotation,\r\n    flipVertical,\r\n    flipHorizontal,\r\n    orientationMarkers,\r\n    element,\r\n  ]);\r\n\r\n  return <div className=\"ViewportOrientationMarkers select-none\">{markers}</div>;\r\n}\r\n\r\n/**\r\n *\r\n * Computes the orientation labels on a Cornerstone-enabled Viewport element\r\n * when the viewport settings change (e.g. when a horizontal flip or a rotation occurs)\r\n *\r\n * @param {*} rowCosines\r\n * @param {*} columnCosines\r\n * @param {*} rotation in degrees\r\n * @returns\r\n */\r\nfunction _getOrientationMarkers(rowCosines, columnCosines, rotation, flipVertical, flipHorizontal) {\r\n  const rowString = getOrientationStringLPS(rowCosines);\r\n  const columnString = getOrientationStringLPS(columnCosines);\r\n  const oppositeRowString = invertOrientationStringLPS(rowString);\r\n  const oppositeColumnString = invertOrientationStringLPS(columnString);\r\n\r\n  const markers = {\r\n    top: oppositeColumnString,\r\n    left: oppositeRowString,\r\n    right: rowString,\r\n    bottom: columnString,\r\n  };\r\n\r\n  // If any vertical or horizontal flips are applied, change the orientation strings ahead of\r\n  // the rotation applications\r\n  if (flipVertical) {\r\n    markers.top = invertOrientationStringLPS(markers.top);\r\n    markers.bottom = invertOrientationStringLPS(markers.bottom);\r\n  }\r\n\r\n  if (flipHorizontal) {\r\n    markers.left = invertOrientationStringLPS(markers.left);\r\n    markers.right = invertOrientationStringLPS(markers.right);\r\n  }\r\n\r\n  // Swap the labels accordingly if the viewport has been rotated\r\n  // This could be done in a more complex way for intermediate rotation values (e.g. 45 degrees)\r\n  if (rotation === 90 || rotation === -270) {\r\n    return {\r\n      top: markers.left,\r\n      left: invertOrientationStringLPS(markers.top),\r\n      right: invertOrientationStringLPS(markers.bottom),\r\n      bottom: markers.right, // left\r\n    };\r\n  } else if (rotation === -90 || rotation === 270) {\r\n    return {\r\n      top: invertOrientationStringLPS(markers.left),\r\n      left: markers.top,\r\n      bottom: markers.left,\r\n      right: markers.bottom,\r\n    };\r\n  } else if (rotation === 180 || rotation === -180) {\r\n    return {\r\n      top: invertOrientationStringLPS(markers.top),\r\n      left: invertOrientationStringLPS(markers.left),\r\n      bottom: invertOrientationStringLPS(markers.bottom),\r\n      right: invertOrientationStringLPS(markers.right),\r\n    };\r\n  }\r\n\r\n  return markers;\r\n}\r\n\r\nexport default ViewportOrientationMarkers;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Enums } from '@cornerstonejs/core';\r\n\r\nfunction ViewportImageSliceLoadingIndicator({ viewportData, element }) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(false);\r\n\r\n  const loadIndicatorRef = useRef(null);\r\n  const imageIdToBeLoaded = useRef(null);\r\n\r\n  const setLoadingState = evt => {\r\n    clearTimeout(loadIndicatorRef.current);\r\n\r\n    loadIndicatorRef.current = setTimeout(() => {\r\n      setLoading(true);\r\n    }, 50);\r\n  };\r\n\r\n  const setFinishLoadingState = evt => {\r\n    clearTimeout(loadIndicatorRef.current);\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  const setErrorState = evt => {\r\n    clearTimeout(loadIndicatorRef.current);\r\n\r\n    if (imageIdToBeLoaded.current === evt.detail.imageId) {\r\n      setError(evt.detail.error);\r\n      imageIdToBeLoaded.current = null;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    element.addEventListener(Enums.Events.STACK_VIEWPORT_SCROLL, setLoadingState);\r\n    element.addEventListener(Enums.Events.IMAGE_LOAD_ERROR, setErrorState);\r\n    element.addEventListener(Enums.Events.STACK_NEW_IMAGE, setFinishLoadingState);\r\n\r\n    return () => {\r\n      element.removeEventListener(Enums.Events.STACK_VIEWPORT_SCROLL, setLoadingState);\r\n\r\n      element.removeEventListener(Enums.Events.STACK_NEW_IMAGE, setFinishLoadingState);\r\n\r\n      element.removeEventListener(Enums.Events.IMAGE_LOAD_ERROR, setErrorState);\r\n    };\r\n  }, [element, viewportData]);\r\n\r\n  if (error) {\r\n    return (\r\n      <>\r\n        <div className=\"absolute top-0 left-0 h-full w-full bg-black opacity-50\">\r\n          <div className=\"transparent flex h-full w-full items-center justify-center\">\r\n            <p className=\"text-primary-light text-xl font-light\">\r\n              <h4>Error Loading Image</h4>\r\n              <p>An error has occurred.</p>\r\n              <p>{error}</p>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      // IMPORTANT: we need to use the pointer-events-none class to prevent the loading indicator from\r\n      // interacting with the mouse, since scrolling should propagate to the viewport underneath\r\n      <div className=\"pointer-events-none absolute top-0 left-0 h-full w-full bg-black opacity-50\">\r\n        <div className=\"transparent flex h-full w-full items-center justify-center\">\r\n          <p className=\"text-primary-light text-xl font-light\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nViewportImageSliceLoadingIndicator.propTypes = {\r\n  error: PropTypes.object,\r\n  element: PropTypes.object,\r\n};\r\n\r\nexport default ViewportImageSliceLoadingIndicator;\r\n","import React, { useEffect, useState } from 'react';\r\n\r\nimport ViewportImageScrollbar from './ViewportImageScrollbar';\r\nimport CustomizableViewportOverlay from './CustomizableViewportOverlay';\r\nimport ViewportOrientationMarkers from './ViewportOrientationMarkers';\r\nimport ViewportImageSliceLoadingIndicator from './ViewportImageSliceLoadingIndicator';\r\n\r\nfunction CornerstoneOverlays(props: withAppTypes) {\r\n  const { viewportId, element, scrollbarWidth, servicesManager } = props;\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const [imageSliceData, setImageSliceData] = useState({\r\n    imageIndex: 0,\r\n    numberOfSlices: 0,\r\n  });\r\n  const [viewportData, setViewportData] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const { unsubscribe } = cornerstoneViewportService.subscribe(\r\n      cornerstoneViewportService.EVENTS.VIEWPORT_DATA_CHANGED,\r\n      props => {\r\n        if (props.viewportId !== viewportId) {\r\n          return;\r\n        }\r\n\r\n        setViewportData(props.viewportData);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewportId]);\r\n\r\n  if (!element) {\r\n    return null;\r\n  }\r\n\r\n  if (viewportData) {\r\n    const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n\r\n    if (viewportInfo?.viewportOptions?.customViewportProps?.hideOverlays) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"noselect\">\r\n      <ViewportImageScrollbar\r\n        viewportId={viewportId}\r\n        viewportData={viewportData}\r\n        element={element}\r\n        imageSliceData={imageSliceData}\r\n        setImageSliceData={setImageSliceData}\r\n        scrollbarWidth={scrollbarWidth}\r\n        servicesManager={servicesManager}\r\n      />\r\n\r\n      <CustomizableViewportOverlay\r\n        imageSliceData={imageSliceData}\r\n        viewportData={viewportData}\r\n        viewportId={viewportId}\r\n        servicesManager={servicesManager}\r\n        element={element}\r\n      />\r\n\r\n      <ViewportImageSliceLoadingIndicator\r\n        viewportData={viewportData}\r\n        element={element}\r\n      />\r\n\r\n      <ViewportOrientationMarkers\r\n        imageSliceData={imageSliceData}\r\n        element={element}\r\n        viewportData={viewportData}\r\n        servicesManager={servicesManager}\r\n        viewportId={viewportId}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CornerstoneOverlays;\r\n","import React, { useCallback, useEffect, useState, useRef } from 'react';\r\nimport { CinePlayer, useCine } from '@ohif/ui';\r\nimport { Enums, eventTarget, cache } from '@cornerstonejs/core';\r\nimport { useAppConfig } from '@state';\r\n\r\nfunction WrappedCinePlayer({\r\n  enabledVPElement,\r\n  viewportId,\r\n  servicesManager,\r\n}: withAppTypes<{\r\n  enabledVPElement: HTMLElement;\r\n  viewportId: string;\r\n}>) {\r\n  const { customizationService, displaySetService, viewportGridService } = servicesManager.services;\r\n  const [{ isCineEnabled, cines }, cineService] = useCine();\r\n  const [newStackFrameRate, setNewStackFrameRate] = useState(24);\r\n  const [dynamicInfo, setDynamicInfo] = useState(null);\r\n  const [appConfig] = useAppConfig();\r\n  const isMountedRef = useRef(null);\r\n\r\n  const cineHandler = () => {\r\n    if (!cines?.[viewportId] || !enabledVPElement) {\r\n      return;\r\n    }\r\n\r\n    const { isPlaying = false, frameRate = 24 } = cines[viewportId];\r\n    const validFrameRate = Math.max(frameRate, 1);\r\n\r\n    return isPlaying\r\n      ? cineService.playClip(enabledVPElement, { framesPerSecond: validFrameRate, viewportId })\r\n      : cineService.stopClip(enabledVPElement);\r\n  };\r\n\r\n  const newDisplaySetHandler = useCallback(() => {\r\n    if (!enabledVPElement || !isCineEnabled) {\r\n      return;\r\n    }\r\n\r\n    const { viewports } = viewportGridService.getState();\r\n    const { displaySetInstanceUIDs } = viewports.get(viewportId);\r\n    let frameRate = 24;\r\n    let isPlaying = cines[viewportId]?.isPlaying || false;\r\n    displaySetInstanceUIDs.forEach(displaySetInstanceUID => {\r\n      const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n      if (displaySet.FrameRate) {\r\n        // displaySet.FrameRate corresponds to DICOM tag (0018,1063) which is defined as the the frame time in milliseconds\r\n        // So a bit of math to get the actual frame rate.\r\n        frameRate = Math.round(1000 / displaySet.FrameRate);\r\n        isPlaying ||= !!appConfig.autoPlayCine;\r\n      }\r\n\r\n      // check if the displaySet is dynamic and set the dynamic info\r\n      if (displaySet.isDynamicVolume) {\r\n        const { dynamicVolumeInfo } = displaySet;\r\n        const numTimePoints = dynamicVolumeInfo.timePoints.length;\r\n        const label = dynamicVolumeInfo.splittingTag;\r\n        const timePointIndex = dynamicVolumeInfo.timePointIndex || 0;\r\n        setDynamicInfo({\r\n          volumeId: displaySet.displaySetInstanceUID,\r\n          timePointIndex,\r\n          numTimePoints,\r\n          label,\r\n        });\r\n      } else {\r\n        setDynamicInfo(null);\r\n      }\r\n    });\r\n\r\n    if (isPlaying) {\r\n      cineService.setIsCineEnabled(isPlaying);\r\n    }\r\n    cineService.setCine({ id: viewportId, isPlaying, frameRate });\r\n    setNewStackFrameRate(frameRate);\r\n  }, [displaySetService, viewportId, viewportGridService, cines, isCineEnabled, enabledVPElement]);\r\n\r\n  useEffect(() => {\r\n    isMountedRef.current = true;\r\n\r\n    newDisplaySetHandler();\r\n\r\n    return () => {\r\n      isMountedRef.current = false;\r\n    };\r\n  }, [isCineEnabled, newDisplaySetHandler]);\r\n\r\n  useEffect(() => {\r\n    if (!isCineEnabled) {\r\n      return;\r\n    }\r\n\r\n    cineHandler();\r\n  }, [isCineEnabled, cineHandler, enabledVPElement]);\r\n\r\n  /**\r\n   * Use effect for handling new display set\r\n   */\r\n  useEffect(() => {\r\n    if (!enabledVPElement) {\r\n      return;\r\n    }\r\n\r\n    enabledVPElement.addEventListener(Enums.Events.VIEWPORT_NEW_IMAGE_SET, newDisplaySetHandler);\r\n    // this doesn't makes sense that we are listening to this event on viewport element\r\n    enabledVPElement.addEventListener(\r\n      Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,\r\n      newDisplaySetHandler\r\n    );\r\n\r\n    return () => {\r\n      cineService.setCine({ id: viewportId, isPlaying: false });\r\n\r\n      enabledVPElement.removeEventListener(\r\n        Enums.Events.VIEWPORT_NEW_IMAGE_SET,\r\n        newDisplaySetHandler\r\n      );\r\n      enabledVPElement.removeEventListener(\r\n        Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,\r\n        newDisplaySetHandler\r\n      );\r\n    };\r\n  }, [enabledVPElement, newDisplaySetHandler, viewportId]);\r\n\r\n  useEffect(() => {\r\n    if (!cines || !cines[viewportId] || !enabledVPElement || !isMountedRef.current) {\r\n      return;\r\n    }\r\n\r\n    cineHandler();\r\n\r\n    return () => {\r\n      cineService.stopClip(enabledVPElement, { viewportId });\r\n    };\r\n  }, [cines, viewportId, cineService, enabledVPElement, cineHandler]);\r\n\r\n  if (!isCineEnabled) {\r\n    return null;\r\n  }\r\n\r\n  const cine = cines[viewportId];\r\n  const isPlaying = cine?.isPlaying || false;\r\n\r\n  return (\r\n    <RenderCinePlayer\r\n      viewportId={viewportId}\r\n      cineService={cineService}\r\n      newStackFrameRate={newStackFrameRate}\r\n      isPlaying={isPlaying}\r\n      dynamicInfo={dynamicInfo}\r\n      customizationService={customizationService}\r\n    />\r\n  );\r\n}\r\n\r\nfunction RenderCinePlayer({\r\n  viewportId,\r\n  cineService,\r\n  newStackFrameRate,\r\n  isPlaying,\r\n  dynamicInfo: dynamicInfoProp,\r\n  customizationService,\r\n}) {\r\n  const { component: CinePlayerComponent = CinePlayer } =\r\n    customizationService.get('cinePlayer') ?? {};\r\n\r\n  const [dynamicInfo, setDynamicInfo] = useState(dynamicInfoProp);\r\n\r\n  useEffect(() => {\r\n    setDynamicInfo(dynamicInfoProp);\r\n  }, [dynamicInfoProp]);\r\n\r\n  /**\r\n   * Use effect for handling 4D time index changed\r\n   */\r\n  useEffect(() => {\r\n    if (!dynamicInfo) {\r\n      return;\r\n    }\r\n\r\n    const handleTimePointIndexChange = evt => {\r\n      const { volumeId, timePointIndex, numTimePoints, splittingTag } = evt.detail;\r\n      setDynamicInfo({ volumeId, timePointIndex, numTimePoints, label: splittingTag });\r\n    };\r\n\r\n    eventTarget.addEventListener(\r\n      Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,\r\n      handleTimePointIndexChange\r\n    );\r\n\r\n    return () => {\r\n      eventTarget.removeEventListener(\r\n        Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,\r\n        handleTimePointIndexChange\r\n      );\r\n    };\r\n  }, [dynamicInfo]);\r\n\r\n  useEffect(() => {\r\n    if (!dynamicInfo) {\r\n      return;\r\n    }\r\n\r\n    const { volumeId, timePointIndex, numTimePoints, splittingTag } = dynamicInfo || {};\r\n    const volume = cache.getVolume(volumeId, true);\r\n    volume.timePointIndex = timePointIndex;\r\n\r\n    setDynamicInfo({ volumeId, timePointIndex, numTimePoints, label: splittingTag });\r\n  }, []);\r\n\r\n  const updateDynamicInfo = useCallback(props => {\r\n    const { volumeId, timePointIndex } = props;\r\n    const volume = cache.getVolume(volumeId, true);\r\n    volume.timePointIndex = timePointIndex;\r\n  }, []);\r\n\r\n  return (\r\n    <CinePlayerComponent\r\n      className=\"absolute left-1/2 bottom-3 -translate-x-1/2\"\r\n      frameRate={newStackFrameRate}\r\n      isPlaying={isPlaying}\r\n      onClose={() => {\r\n        // also stop the clip\r\n        cineService.setCine({\r\n          id: viewportId,\r\n          isPlaying: false,\r\n        });\r\n        cineService.setIsCineEnabled(false);\r\n        cineService.setViewportCineClosed(viewportId);\r\n      }}\r\n      onPlayPauseChange={isPlaying => {\r\n        cineService.setCine({\r\n          id: viewportId,\r\n          isPlaying,\r\n        });\r\n      }}\r\n      onFrameRateChange={frameRate =>\r\n        cineService.setCine({\r\n          id: viewportId,\r\n          frameRate,\r\n        })\r\n      }\r\n      dynamicInfo={dynamicInfo}\r\n      updateDynamicInfo={updateDynamicInfo}\r\n    />\r\n  );\r\n}\r\n\r\nexport default WrappedCinePlayer;\r\n","import CinePlayer from './CinePlayer';\r\n\r\nexport default CinePlayer;\r\n","import React from 'react';\r\nimport { useViewportActionCornersContext } from '../contextProviders/ViewportActionCornersProvider';\r\nimport { ViewportActionCorners } from '@ohif/ui';\r\n\r\nexport type OHIFViewportActionCornersProps = {\r\n  viewportId: string;\r\n};\r\n\r\nfunction OHIFViewportActionCorners({ viewportId }: OHIFViewportActionCornersProps) {\r\n  const [viewportActionCornersState] = useViewportActionCornersContext();\r\n\r\n  if (!viewportActionCornersState[viewportId]) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <ViewportActionCorners\r\n      cornerComponents={viewportActionCornersState[viewportId]}\r\n    ></ViewportActionCorners>\r\n  );\r\n}\r\n\r\nexport default OHIFViewportActionCorners;\r\n","import React, { ReactElement, useCallback, useEffect, useRef, useState, useMemo } from 'react';\r\nimport { AllInOneMenu, ButtonGroup, SwitchButton } from '@ohif/ui';\r\nimport { StackViewport, Types } from '@cornerstonejs/core';\r\nimport { ColormapProps } from '../../types/Colormap';\r\n\r\nexport function Colormap({\r\n  colormaps,\r\n  viewportId,\r\n  displaySets,\r\n  commandsManager,\r\n  servicesManager,\r\n}: ColormapProps): ReactElement {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n\r\n  const [activeDisplaySet, setActiveDisplaySet] = useState(displaySets[0]);\r\n\r\n  const [showPreview, setShowPreview] = useState(false);\r\n  const [prePreviewColormap, setPrePreviewColormap] = useState(null);\r\n\r\n  const showPreviewRef = useRef(showPreview);\r\n  showPreviewRef.current = showPreview;\r\n  const prePreviewColormapRef = useRef(prePreviewColormap);\r\n  prePreviewColormapRef.current = prePreviewColormap;\r\n  const activeDisplaySetRef = useRef(activeDisplaySet);\r\n  activeDisplaySetRef.current = activeDisplaySet;\r\n\r\n  const onSetColorLUT = useCallback(\r\n    props => {\r\n      // TODO: Better way to check if it's a fusion\r\n      const oneOpacityColormaps = ['Grayscale', 'X Ray'];\r\n      const opacity =\r\n        displaySets.length > 1 && !oneOpacityColormaps.includes(props.colormap.name) ? 0.5 : 1;\r\n      commandsManager.run({\r\n        commandName: 'setViewportColormap',\r\n        commandOptions: {\r\n          ...props,\r\n          opacity,\r\n          immediate: true,\r\n        },\r\n        context: 'CORNERSTONE',\r\n      });\r\n    },\r\n    [commandsManager]\r\n  );\r\n\r\n  const getViewportColormap = (viewportId, displaySet) => {\r\n    const { displaySetInstanceUID } = displaySet;\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    if (viewport instanceof StackViewport) {\r\n      const { colormap } = viewport.getProperties();\r\n      if (!colormap) {\r\n        return colormaps.find(c => c.Name === 'Grayscale') || colormaps[0];\r\n      }\r\n      return colormap;\r\n    }\r\n    const actorEntries = viewport.getActors();\r\n    const actorEntry = actorEntries?.find(entry =>\r\n      entry.referencedId.includes(displaySetInstanceUID)\r\n    );\r\n    const { colormap } = (viewport as Types.IVolumeViewport).getProperties(actorEntry.referencedId);\r\n    if (!colormap) {\r\n      return colormaps.find(c => c.Name === 'Grayscale') || colormaps[0];\r\n    }\r\n    return colormap;\r\n  };\r\n\r\n  const buttons = useMemo(() => {\r\n    return displaySets.map((displaySet, index) => ({\r\n      children: displaySet.Modality,\r\n      key: index,\r\n      style: {\r\n        minWidth: `calc(100% / ${displaySets.length})`,\r\n        fontSize: '0.8rem',\r\n        textAlign: 'center',\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n      },\r\n    }));\r\n  }, [displaySets]);\r\n\r\n  useEffect(() => {\r\n    setActiveDisplaySet(displaySets[displaySets.length - 1]);\r\n  }, [displaySets]);\r\n\r\n  return (\r\n    <>\r\n      {buttons.length > 1 && (\r\n        <div className=\"all-in-one-menu-item flex w-full justify-center\">\r\n          <ButtonGroup\r\n            onActiveIndexChange={index => {\r\n              setActiveDisplaySet(displaySets[index]);\r\n              setPrePreviewColormap(null);\r\n            }}\r\n            activeIndex={\r\n              displaySets.findIndex(\r\n                ds => ds.displaySetInstanceUID === activeDisplaySetRef.current.displaySetInstanceUID\r\n              ) || 1\r\n            }\r\n            className=\"w-[70%] text-[10px]\"\r\n          >\r\n            {buttons.map(({ children, key, style }) => (\r\n              <div\r\n                key={key}\r\n                style={style}\r\n              >\r\n                {children}\r\n              </div>\r\n            ))}\r\n          </ButtonGroup>\r\n        </div>\r\n      )}\r\n      <div className=\"all-in-one-menu-item flex w-full justify-center\">\r\n        <SwitchButton\r\n          label=\"Preview in viewport\"\r\n          checked={showPreview}\r\n          onChange={checked => {\r\n            setShowPreview(checked);\r\n          }}\r\n        />\r\n      </div>\r\n      <AllInOneMenu.DividerItem />\r\n      <AllInOneMenu.ItemPanel>\r\n        {colormaps.map((colormap, index) => (\r\n          <AllInOneMenu.Item\r\n            key={index}\r\n            label={colormap.description}\r\n            onClick={() => {\r\n              onSetColorLUT({\r\n                viewportId,\r\n                colormap,\r\n                displaySetInstanceUID: activeDisplaySetRef.current.displaySetInstanceUID,\r\n              });\r\n              setPrePreviewColormap(null);\r\n            }}\r\n            onMouseEnter={() => {\r\n              if (showPreviewRef.current) {\r\n                setPrePreviewColormap(getViewportColormap(viewportId, activeDisplaySetRef.current));\r\n                onSetColorLUT({\r\n                  viewportId,\r\n                  colormap,\r\n                  displaySetInstanceUID: activeDisplaySetRef.current.displaySetInstanceUID,\r\n                });\r\n              }\r\n            }}\r\n            onMouseLeave={() => {\r\n              if (showPreviewRef.current && prePreviewColormapRef.current) {\r\n                onSetColorLUT({\r\n                  viewportId,\r\n                  colormap: prePreviewColormapRef.current,\r\n                  displaySetInstanceUID: activeDisplaySetRef.current.displaySetInstanceUID,\r\n                });\r\n              }\r\n            }}\r\n          ></AllInOneMenu.Item>\r\n        ))}\r\n      </AllInOneMenu.ItemPanel>\r\n    </>\r\n  );\r\n}\r\n","import React, { ReactElement, useCallback, useEffect, useState } from 'react';\r\nimport { SwitchButton } from '@ohif/ui';\r\nimport { StackViewport, VolumeViewport } from '@cornerstonejs/core';\r\nimport { ColorbarProps } from '../../types/Colorbar';\r\nimport { utilities } from '@cornerstonejs/core';\r\n\r\nexport function setViewportColorbar(\r\n  viewportId,\r\n  displaySets,\r\n  commandsManager,\r\n  servicesManager: AppTypes.ServicesManager,\r\n  colorbarOptions\r\n) {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n\r\n  const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n  const backgroundColor = viewportInfo.getViewportOptions().background;\r\n  const isLight = backgroundColor ? utilities.isEqual(backgroundColor, [1, 1, 1]) : false;\r\n\r\n  if (isLight) {\r\n    colorbarOptions.ticks = {\r\n      position: 'left',\r\n      style: {\r\n        font: '12px Arial',\r\n        color: '#000000',\r\n        maxNumTicks: 8,\r\n        tickSize: 5,\r\n        tickWidth: 1,\r\n        labelMargin: 3,\r\n      },\r\n    };\r\n  }\r\n\r\n  const displaySetInstanceUIDs = [];\r\n\r\n  if (viewport instanceof StackViewport) {\r\n    displaySetInstanceUIDs.push(viewportId);\r\n  }\r\n\r\n  if (viewport instanceof VolumeViewport) {\r\n    displaySets.forEach(ds => {\r\n      displaySetInstanceUIDs.push(ds.displaySetInstanceUID);\r\n    });\r\n  }\r\n\r\n  commandsManager.run({\r\n    commandName: 'toggleViewportColorbar',\r\n    commandOptions: {\r\n      viewportId,\r\n      options: colorbarOptions,\r\n      displaySetInstanceUIDs,\r\n    },\r\n    context: 'CORNERSTONE',\r\n  });\r\n}\r\n\r\nexport function Colorbar({\r\n  viewportId,\r\n  displaySets,\r\n  commandsManager,\r\n  servicesManager,\r\n  colorbarProperties,\r\n}: withAppTypes<ColorbarProps>): ReactElement {\r\n  const { colorbarService } = servicesManager.services;\r\n  const {\r\n    width: colorbarWidth,\r\n    colorbarTickPosition,\r\n    colorbarContainerPosition,\r\n    colormaps,\r\n    colorbarInitialColormap,\r\n  } = colorbarProperties;\r\n  const [showColorbar, setShowColorbar] = useState(colorbarService.hasColorbar(viewportId));\r\n\r\n  const onSetColorbar = useCallback(() => {\r\n    setViewportColorbar(viewportId, displaySets, commandsManager, servicesManager, {\r\n      viewportId,\r\n      colormaps,\r\n      ticks: {\r\n        position: colorbarTickPosition,\r\n      },\r\n      width: colorbarWidth,\r\n      position: colorbarContainerPosition,\r\n      activeColormapName: colorbarInitialColormap,\r\n    });\r\n  }, [commandsManager]);\r\n\r\n  useEffect(() => {\r\n    const updateColorbarState = () => {\r\n      setShowColorbar(colorbarService.hasColorbar(viewportId));\r\n    };\r\n\r\n    const { unsubscribe } = colorbarService.subscribe(\r\n      colorbarService.EVENTS.STATE_CHANGED,\r\n      updateColorbarState\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewportId]);\r\n\r\n  return (\r\n    <div className=\"all-in-one-menu-item flex w-full justify-center\">\r\n      <div className=\"mr-2 w-[28px]\"></div>\r\n      <SwitchButton\r\n        label=\"Display Color bar\"\r\n        checked={showColorbar}\r\n        onChange={() => {\r\n          onSetColorbar();\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React, { ReactElement, useCallback } from 'react';\r\nimport { AllInOneMenu } from '@ohif/ui';\r\nimport { WindowLevelPreset } from '../../types/WindowLevel';\r\nimport { CommandsManager } from '@ohif/core';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport type WindowLevelProps = {\r\n  viewportId: string;\r\n  presets: Array<Record<string, Array<WindowLevelPreset>>>;\r\n  commandsManager: CommandsManager;\r\n};\r\n\r\nexport function WindowLevel({\r\n  viewportId,\r\n  commandsManager,\r\n  presets,\r\n}: WindowLevelProps): ReactElement {\r\n  const { t } = useTranslation('WindowLevelActionMenu');\r\n\r\n  const onSetWindowLevel = useCallback(\r\n    props => {\r\n      commandsManager.run({\r\n        commandName: 'setViewportWindowLevel',\r\n        commandOptions: {\r\n          ...props,\r\n          viewportId,\r\n        },\r\n        context: 'CORNERSTONE',\r\n      });\r\n    },\r\n    [commandsManager, viewportId]\r\n  );\r\n\r\n  return (\r\n    <AllInOneMenu.ItemPanel>\r\n      {presets.map((modalityPresets, modalityIndex) => (\r\n        <React.Fragment key={modalityIndex}>\r\n          {Object.entries(modalityPresets).map(([modality, presetsArray]) => (\r\n            <React.Fragment key={modality}>\r\n              <AllInOneMenu.HeaderItem>\r\n                {t('Modality Presets', { modality })}\r\n              </AllInOneMenu.HeaderItem>\r\n              {presetsArray.map((preset, index) => (\r\n                <AllInOneMenu.Item\r\n                  key={`${modality}-${index}`}\r\n                  label={preset.description}\r\n                  secondaryLabel={`${preset.window} / ${preset.level}`}\r\n                  onClick={() => onSetWindowLevel(preset)}\r\n                />\r\n              ))}\r\n            </React.Fragment>\r\n          ))}\r\n        </React.Fragment>\r\n      ))}\r\n    </AllInOneMenu.ItemPanel>\r\n  );\r\n}\r\n","import { Icon } from '@ohif/ui';\r\nimport { ButtonEnums } from '@ohif/ui';\r\nimport React, { ReactElement, useState, useCallback } from 'react';\r\nimport { Button, InputFilterText } from '@ohif/ui';\r\nimport { ViewportPreset, VolumeRenderingPresetsContentProps } from '../../types/ViewportPresets';\r\n\r\nexport function VolumeRenderingPresetsContent({\r\n  presets,\r\n  viewportId,\r\n  commandsManager,\r\n  onClose,\r\n}: VolumeRenderingPresetsContentProps): ReactElement {\r\n  const [filteredPresets, setFilteredPresets] = useState(presets);\r\n  const [searchValue, setSearchValue] = useState('');\r\n  const [selectedPreset, setSelectedPreset] = useState<ViewportPreset | null>(null);\r\n\r\n  const handleSearchChange = useCallback(\r\n    (value: string) => {\r\n      setSearchValue(value);\r\n      const filtered = value\r\n        ? presets.filter(preset => preset.name.toLowerCase().includes(value.toLowerCase()))\r\n        : presets;\r\n      setFilteredPresets(filtered);\r\n    },\r\n    [presets]\r\n  );\r\n\r\n  const handleApply = useCallback(\r\n    props => {\r\n      commandsManager.runCommand('setViewportPreset', {\r\n        ...props,\r\n      });\r\n    },\r\n    [commandsManager]\r\n  );\r\n\r\n  const formatLabel = (label: string, maxChars: number) => {\r\n    return label.length > maxChars ? `${label.slice(0, maxChars)}...` : label;\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex min-h-full w-full flex-col justify-between\">\r\n      <div className=\"border-secondary-light h-[433px] w-full overflow-hidden rounded border bg-black px-2.5\">\r\n        <div className=\"flex h-[46px] w-full items-center justify-start\">\r\n          <div className=\"h-[26px] w-[200px]\">\r\n            <InputFilterText\r\n              value={searchValue}\r\n              onDebounceChange={handleSearchChange}\r\n              placeholder={'Search all'}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"ohif-scrollbar overflow h-[385px] w-full overflow-y-auto\">\r\n          <div className=\"grid grid-cols-4 gap-3 pt-2 pr-3\">\r\n            {filteredPresets.map((preset, index) => (\r\n              <div\r\n                key={index}\r\n                className=\"flex cursor-pointer flex-col items-start\"\r\n                onClick={() => {\r\n                  setSelectedPreset(preset);\r\n                  handleApply({ preset: preset.name, viewportId });\r\n                }}\r\n              >\r\n                <Icon\r\n                  name={preset.name}\r\n                  className={\r\n                    selectedPreset?.name === preset.name\r\n                      ? 'border-primary-light h-[75px] w-[95px] max-w-none rounded border-2'\r\n                      : 'hover:border-primary-light h-[75px] w-[95px] max-w-none rounded border-2 border-black'\r\n                  }\r\n                />\r\n                <label className=\"text-aqua-pale mt-2 text-left text-xs\">\r\n                  {formatLabel(preset.name, 11)}\r\n                </label>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <footer className=\"flex h-[60px] w-full items-center justify-end\">\r\n        <div className=\"flex\">\r\n          <Button\r\n            name=\"Cancel\"\r\n            size={ButtonEnums.size.medium}\r\n            type={ButtonEnums.type.secondary}\r\n            onClick={onClose}\r\n          >\r\n            {' '}\r\n            Cancel{' '}\r\n          </Button>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n}\r\n","import { AllInOneMenu, Icon } from '@ohif/ui';\r\nimport React, { ReactElement } from 'react';\r\nimport { VolumeRenderingPresetsProps } from '../../types/ViewportPresets';\r\nimport { VolumeRenderingPresetsContent } from './VolumeRenderingPresetsContent';\r\n\r\nexport function VolumeRenderingPresets({\r\n  viewportId,\r\n  servicesManager,\r\n  commandsManager,\r\n  volumeRenderingPresets,\r\n}: VolumeRenderingPresetsProps): ReactElement {\r\n  const { uiModalService } = servicesManager.services;\r\n\r\n  const onClickPresets = () => {\r\n    uiModalService.show({\r\n      content: VolumeRenderingPresetsContent,\r\n      title: 'Rendering Presets',\r\n      movable: true,\r\n      contentProps: {\r\n        onClose: uiModalService.hide,\r\n        presets: volumeRenderingPresets,\r\n        viewportId,\r\n        commandsManager,\r\n      },\r\n      containerDimensions: 'h-[543px] w-[460px]',\r\n      contentDimensions: 'h-[493px] w-[460px]  pl-[12px] pr-[12px]',\r\n    });\r\n  };\r\n\r\n  return (\r\n    <AllInOneMenu.Item\r\n      label=\"Rendering Presets\"\r\n      icon={<Icon name=\"VolumeRendering\" />}\r\n      rightIcon={<Icon name=\"action-new-dialog\" />}\r\n      onClick={onClickPresets}\r\n    />\r\n  );\r\n}\r\n","import React, { ReactElement, useCallback, useState, useEffect } from 'react';\r\nimport { VolumeRenderingQualityProps } from '../../types/ViewportPresets';\r\n\r\nexport function VolumeRenderingQuality({\r\n  volumeRenderingQualityRange,\r\n  commandsManager,\r\n  servicesManager,\r\n  viewportId,\r\n}: VolumeRenderingQualityProps): ReactElement {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const { min, max, step } = volumeRenderingQualityRange;\r\n  const [quality, setQuality] = useState(null);\r\n\r\n  const onChange = useCallback(\r\n    (value: number) => {\r\n      commandsManager.runCommand('setVolumeRenderingQulaity', {\r\n        viewportId,\r\n        volumeQuality: value,\r\n      });\r\n      setQuality(value);\r\n    },\r\n    [commandsManager, viewportId]\r\n  );\r\n\r\n  const calculateBackground = value => {\r\n    const percentage = ((value - 0) / (1 - 0)) * 100;\r\n    return `linear-gradient(to right, #5acce6 0%, #5acce6 ${percentage}%, #3a3f99 ${percentage}%, #3a3f99 100%)`;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    const { actor } = viewport.getActors()[0];\r\n    const mapper = actor.getMapper();\r\n    const image = mapper.getInputData();\r\n    const spacing = image.getSpacing();\r\n    const sampleDistance = mapper.getSampleDistance();\r\n    const averageSpacing = spacing.reduce((a, b) => a + b) / 3.0;\r\n    if (sampleDistance === averageSpacing) {\r\n      setQuality(1);\r\n    } else {\r\n      setQuality(Math.sqrt(averageSpacing / (sampleDistance * 0.5)));\r\n    }\r\n  }, [cornerstoneViewportService, viewportId]);\r\n  return (\r\n    <>\r\n      <div className=\"all-in-one-menu-item flex w-full flex-row !items-center justify-between gap-[10px]\">\r\n        <label\r\n          className=\"block text-white\"\r\n          htmlFor=\"volume\"\r\n        >\r\n          Quality\r\n        </label>\r\n        {quality !== null && (\r\n          <input\r\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\r\n            value={quality}\r\n            id=\"volume\"\r\n            max={max}\r\n            min={min}\r\n            type=\"range\"\r\n            step={step}\r\n            onChange={e => onChange(parseInt(e.target.value, 10))}\r\n            style={{\r\n              background: calculateBackground((quality - min) / (max - min)),\r\n              '--thumb-inner-color': '#5acce6',\r\n              '--thumb-outer-color': '#090c29',\r\n            }}\r\n          />\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React, { ReactElement, useCallback, useEffect, useState, useRef } from 'react';\r\nimport { VolumeShiftProps } from '../../types/ViewportPresets';\r\n\r\nexport function VolumeShift({\r\n  viewportId,\r\n  commandsManager,\r\n  servicesManager,\r\n}: VolumeShiftProps): ReactElement {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const [minShift, setMinShift] = useState<number | null>(null);\r\n  const [maxShift, setMaxShift] = useState<number | null>(null);\r\n  const [shift, setShift] = useState<number | null>(\r\n    cornerstoneViewportService.getCornerstoneViewport(viewportId)?.shiftedBy || 0\r\n  );\r\n  const [step, setStep] = useState<number | null>(null);\r\n  const [isBlocking, setIsBlocking] = useState(false);\r\n\r\n  const prevShiftRef = useRef<number>(shift);\r\n\r\n  const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n  const { actor } = viewport.getActors()[0];\r\n  const ofun = actor.getProperty().getScalarOpacity(0);\r\n\r\n  useEffect(() => {\r\n    if (isBlocking) {\r\n      return;\r\n    }\r\n    const range = ofun.getRange();\r\n\r\n    const transferFunctionWidth = range[1] - range[0];\r\n\r\n    const minShift = -transferFunctionWidth;\r\n    const maxShift = transferFunctionWidth;\r\n\r\n    setMinShift(minShift);\r\n    setMaxShift(maxShift);\r\n    setStep(Math.pow(10, Math.floor(Math.log10(transferFunctionWidth / 500))));\r\n  }, [cornerstoneViewportService, viewportId, actor, ofun, isBlocking]);\r\n\r\n  const onChangeRange = useCallback(\r\n    newShift => {\r\n      const shiftDifference = newShift - prevShiftRef.current;\r\n      prevShiftRef.current = newShift;\r\n      viewport.shiftedBy = newShift;\r\n      commandsManager.runCommand('shiftVolumeOpacityPoints', {\r\n        viewportId,\r\n        shift: shiftDifference,\r\n      });\r\n    },\r\n    [commandsManager, viewportId, viewport]\r\n  );\r\n\r\n  const calculateBackground = value => {\r\n    const percentage = ((value - 0) / (1 - 0)) * 100;\r\n    return `linear-gradient(to right, #5acce6 0%, #5acce6 ${percentage}%, #3a3f99 ${percentage}%, #3a3f99 100%)`;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"all-in-one-menu-item flex w-full flex-row !items-center justify-between gap-[10px]\">\r\n        <label\r\n          className=\"block text-white\"\r\n          htmlFor=\"shift\"\r\n        >\r\n          Shift\r\n        </label>\r\n        {step !== null && (\r\n          <input\r\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\r\n            value={shift}\r\n            onChange={e => {\r\n              const shiftValue = parseInt(e.target.value, 10);\r\n              setShift(shiftValue);\r\n              onChangeRange(shiftValue);\r\n            }}\r\n            id=\"shift\"\r\n            onMouseDown={() => setIsBlocking(true)}\r\n            onMouseUp={() => setIsBlocking(false)}\r\n            max={maxShift}\r\n            min={minShift}\r\n            type=\"range\"\r\n            step={step}\r\n            style={{\r\n              background: calculateBackground((shift - minShift) / (maxShift - minShift)),\r\n              '--thumb-inner-color': '#5acce6',\r\n              '--thumb-outer-color': '#090c29',\r\n            }}\r\n          />\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React, { ReactElement, useState, useEffect, useCallback } from 'react';\r\nimport { VolumeLightingProps } from '../../types/ViewportPresets';\r\n\r\nexport function VolumeLighting({\r\n  servicesManager,\r\n  commandsManager,\r\n  viewportId,\r\n}: VolumeLightingProps): ReactElement {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const [ambient, setAmbient] = useState(null);\r\n  const [diffuse, setDiffuse] = useState(null);\r\n  const [specular, setSpecular] = useState(null);\r\n\r\n  const onAmbientChange = useCallback(() => {\r\n    commandsManager.runCommand('setVolumeLighting', { viewportId, options: { ambient } });\r\n  }, [ambient, commandsManager, viewportId]);\r\n\r\n  const onDiffuseChange = useCallback(() => {\r\n    commandsManager.runCommand('setVolumeLighting', { viewportId, options: { diffuse } });\r\n  }, [diffuse, commandsManager, viewportId]);\r\n\r\n  const onSpecularChange = useCallback(() => {\r\n    commandsManager.runCommand('setVolumeLighting', { viewportId, options: { specular } });\r\n  }, [specular, commandsManager, viewportId]);\r\n\r\n  const calculateBackground = value => {\r\n    const percentage = ((value - 0) / (1 - 0)) * 100;\r\n    return `linear-gradient(to right, #5acce6 0%, #5acce6 ${percentage}%, #3a3f99 ${percentage}%, #3a3f99 100%)`;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    const { actor } = viewport.getActors()[0];\r\n    const ambient = actor.getProperty().getAmbient();\r\n    const diffuse = actor.getProperty().getDiffuse();\r\n    const specular = actor.getProperty().getSpecular();\r\n    setAmbient(ambient);\r\n    setDiffuse(diffuse);\r\n    setSpecular(specular);\r\n  }, [viewportId, cornerstoneViewportService]);\r\n  return (\r\n    <>\r\n      <div className=\"all-in-one-menu-item flex w-full flex-row !items-center justify-between gap-[10px]\">\r\n        <label\r\n          className=\"block text-white\"\r\n          htmlFor=\"ambient\"\r\n        >\r\n          Ambient\r\n        </label>\r\n        {ambient !== null && (\r\n          <input\r\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\r\n            value={ambient}\r\n            onChange={e => {\r\n              setAmbient(e.target.value);\r\n              onAmbientChange();\r\n            }}\r\n            id=\"ambient\"\r\n            max={1}\r\n            min={0}\r\n            type=\"range\"\r\n            step={0.1}\r\n            style={{\r\n              background: calculateBackground(ambient),\r\n              '--thumb-inner-color': '#5acce6',\r\n              '--thumb-outer-color': '#090c29',\r\n            }}\r\n          />\r\n        )}\r\n      </div>\r\n      <div className=\"all-in-one-menu-item flex w-full flex-row !items-center justify-between gap-[10px]\">\r\n        <label\r\n          className=\"block text-white\"\r\n          htmlFor=\"diffuse\"\r\n        >\r\n          Diffuse\r\n        </label>\r\n        {diffuse !== null && (\r\n          <input\r\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\r\n            value={diffuse}\r\n            onChange={e => {\r\n              setDiffuse(e.target.value);\r\n              onDiffuseChange();\r\n            }}\r\n            id=\"diffuse\"\r\n            max={1}\r\n            min={0}\r\n            type=\"range\"\r\n            step={0.1}\r\n            style={{\r\n              background: calculateBackground(diffuse),\r\n              '--thumb-inner-color': '#5acce6',\r\n              '--thumb-outer-color': '#090c29',\r\n            }}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"all-in-one-menu-item flex w-full flex-row !items-center justify-between gap-[10px]\">\r\n        <label\r\n          className=\"block text-white\"\r\n          htmlFor=\"specular\"\r\n        >\r\n          Specular\r\n        </label>\r\n        {specular !== null && (\r\n          <input\r\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\r\n            value={specular}\r\n            onChange={e => {\r\n              setSpecular(e.target.value);\r\n              onSpecularChange();\r\n            }}\r\n            id=\"specular\"\r\n            max={1}\r\n            min={0}\r\n            type=\"range\"\r\n            step={0.1}\r\n            style={{\r\n              background: calculateBackground(specular),\r\n              '--thumb-inner-color': '#5acce6',\r\n              '--thumb-outer-color': '#090c29',\r\n            }}\r\n          />\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React, { ReactElement, useCallback, useEffect, useState } from 'react';\r\nimport { SwitchButton } from '@ohif/ui';\r\nimport { VolumeShadeProps } from '../../types/ViewportPresets';\r\n\r\nexport function VolumeShade({\r\n  commandsManager,\r\n  viewportId,\r\n  servicesManager,\r\n}: VolumeShadeProps): ReactElement {\r\n  const { cornerstoneViewportService } = servicesManager.services;\r\n  const [shade, setShade] = useState(true);\r\n  const [key, setKey] = useState(0);\r\n\r\n  const onShadeChange = useCallback(\r\n    (checked: boolean) => {\r\n      commandsManager.runCommand('setVolumeLighting', { viewportId, options: { shade: checked } });\r\n    },\r\n    [commandsManager, viewportId]\r\n  );\r\n  useEffect(() => {\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    const { actor } = viewport.getActors()[0];\r\n    const shade = actor.getProperty().getShade();\r\n    setShade(shade);\r\n    setKey(key + 1);\r\n  }, [viewportId, cornerstoneViewportService]);\r\n\r\n  return (\r\n    <SwitchButton\r\n      key={key}\r\n      label=\"Shade\"\r\n      checked={shade}\r\n      onChange={() => {\r\n        setShade(!shade);\r\n        onShadeChange(!shade);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { ReactElement } from 'react';\r\nimport { AllInOneMenu } from '@ohif/ui';\r\nimport { VolumeRenderingOptionsProps } from '../../types/ViewportPresets';\r\nimport { VolumeRenderingQuality } from './VolumeRenderingQuality';\r\nimport { VolumeShift } from './VolumeShift';\r\nimport { VolumeLighting } from './VolumeLighting';\r\nimport { VolumeShade } from './VolumeShade';\r\nexport function VolumeRenderingOptions({\r\n  viewportId,\r\n  commandsManager,\r\n  volumeRenderingQualityRange,\r\n  servicesManager,\r\n}: VolumeRenderingOptionsProps): ReactElement {\r\n  return (\r\n    <AllInOneMenu.ItemPanel>\r\n      <VolumeRenderingQuality\r\n        viewportId={viewportId}\r\n        commandsManager={commandsManager}\r\n        servicesManager={servicesManager}\r\n        volumeRenderingQualityRange={volumeRenderingQualityRange}\r\n      />\r\n\r\n      <VolumeShift\r\n        viewportId={viewportId}\r\n        commandsManager={commandsManager}\r\n        servicesManager={servicesManager}\r\n      />\r\n      <div className=\"all-in-one-menu-item mt-2 flex !h-[20px] w-full justify-start\">\r\n        <div className=\"text-aqua-pale text-[13px]\">LIGHTING</div>\r\n      </div>\r\n      <div className=\"bg-primary-dark mt-1 mb-1 h-[2px] w-full\"></div>\r\n      <div className=\"all-in-one-menu-item flex w-full justify-center\">\r\n        <VolumeShade\r\n          commandsManager={commandsManager}\r\n          servicesManager={servicesManager}\r\n          viewportId={viewportId}\r\n        />\r\n      </div>\r\n      <VolumeLighting\r\n        viewportId={viewportId}\r\n        commandsManager={commandsManager}\r\n        servicesManager={servicesManager}\r\n      />\r\n    </AllInOneMenu.ItemPanel>\r\n  );\r\n}\r\n","import React, { ReactElement, useCallback, useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport { AllInOneMenu, useViewportGrid } from '@ohif/ui';\r\nimport { Colormap } from './Colormap';\r\nimport { Colorbar } from './Colorbar';\r\nimport { setViewportColorbar } from './Colorbar';\r\nimport { WindowLevelPreset } from '../../types/WindowLevel';\r\nimport { ColorbarProperties } from '../../types/Colorbar';\r\nimport { VolumeRenderingQualityRange } from '../../types/ViewportPresets';\r\nimport { WindowLevel } from './WindowLevel';\r\nimport { VolumeRenderingPresets } from './VolumeRenderingPresets';\r\nimport { VolumeRenderingOptions } from './VolumeRenderingOptions';\r\nimport { ViewportPreset } from '../../types/ViewportPresets';\r\nimport { VolumeViewport3D } from '@cornerstonejs/core';\r\nimport { utilities } from '@cornerstonejs/core';\r\n\r\nexport const nonWLModalities = ['SR', 'SEG', 'SM', 'RTSTRUCT', 'RTPLAN', 'RTDOSE'];\r\n\r\nexport type WindowLevelActionMenuProps = {\r\n  viewportId: string;\r\n  element: HTMLElement;\r\n  presets: Array<Record<string, Array<WindowLevelPreset>>>;\r\n  colorbarProperties: ColorbarProperties;\r\n  displaySets: Array<any>;\r\n  volumeRenderingPresets: Array<ViewportPreset>;\r\n  volumeRenderingQualityRange: VolumeRenderingQualityRange;\r\n};\r\n\r\nexport function WindowLevelActionMenu({\r\n  viewportId,\r\n  element,\r\n  presets,\r\n  verticalDirection,\r\n  horizontalDirection,\r\n  commandsManager,\r\n  servicesManager,\r\n  colorbarProperties,\r\n  displaySets,\r\n  volumeRenderingPresets,\r\n  volumeRenderingQualityRange,\r\n}: withAppTypes<WindowLevelActionMenuProps>): ReactElement {\r\n  const {\r\n    colormaps,\r\n    colorbarContainerPosition,\r\n    colorbarInitialColormap,\r\n    colorbarTickPosition,\r\n    width: colorbarWidth,\r\n  } = colorbarProperties;\r\n  const { colorbarService, cornerstoneViewportService } = servicesManager.services;\r\n  const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n  const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n  const backgroundColor = viewportInfo.getViewportOptions().background;\r\n  const isLight = backgroundColor ? utilities.isEqual(backgroundColor, [1, 1, 1]) : false;\r\n\r\n  const { t } = useTranslation('WindowLevelActionMenu');\r\n\r\n  const [viewportGrid] = useViewportGrid();\r\n  const { activeViewportId } = viewportGrid;\r\n\r\n  const [vpHeight, setVpHeight] = useState(element?.clientHeight);\r\n  const [menuKey, setMenuKey] = useState(0);\r\n  const [is3DVolume, setIs3DVolume] = useState(false);\r\n\r\n  const onSetColorbar = useCallback(() => {\r\n    setViewportColorbar(viewportId, displaySets, commandsManager, servicesManager, {\r\n      colormaps,\r\n      ticks: {\r\n        position: colorbarTickPosition,\r\n      },\r\n      width: colorbarWidth,\r\n      position: colorbarContainerPosition,\r\n      activeColormapName: colorbarInitialColormap,\r\n    });\r\n  }, [commandsManager]);\r\n\r\n  useEffect(() => {\r\n    const newVpHeight = element?.clientHeight;\r\n    if (vpHeight !== newVpHeight) {\r\n      setVpHeight(newVpHeight);\r\n    }\r\n  }, [element, vpHeight]);\r\n\r\n  useEffect(() => {\r\n    if (!colorbarService.hasColorbar(viewportId)) {\r\n      return;\r\n    }\r\n    window.setTimeout(() => {\r\n      colorbarService.removeColorbar(viewportId);\r\n      onSetColorbar();\r\n    }, 0);\r\n  }, [viewportId, displaySets, viewport]);\r\n\r\n  useEffect(() => {\r\n    setMenuKey(menuKey + 1);\r\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\r\n    if (viewport instanceof VolumeViewport3D) {\r\n      setIs3DVolume(true);\r\n    } else {\r\n      setIs3DVolume(false);\r\n    }\r\n  }, [\r\n    displaySets,\r\n    viewportId,\r\n    presets,\r\n    volumeRenderingQualityRange,\r\n    volumeRenderingPresets,\r\n    colorbarProperties,\r\n    activeViewportId,\r\n    viewportGrid,\r\n  ]);\r\n\r\n  return (\r\n    <AllInOneMenu.IconMenu\r\n      icon=\"viewport-window-level\"\r\n      verticalDirection={verticalDirection}\r\n      horizontalDirection={horizontalDirection}\r\n      iconClassName={classNames(\r\n        // Visible on hover and for the active viewport\r\n        activeViewportId === viewportId ? 'visible' : 'invisible group-hover/pane:visible',\r\n        'flex shrink-0 cursor-pointer rounded active:text-white text-primary-light',\r\n        isLight ? ' hover:bg-secondary-dark' : 'hover:bg-secondary-light/60'\r\n      )}\r\n      menuStyle={{ maxHeight: vpHeight - 32, minWidth: 218 }}\r\n      onVisibilityChange={() => {\r\n        setVpHeight(element.clientHeight);\r\n      }}\r\n      menuKey={menuKey}\r\n    >\r\n      <AllInOneMenu.ItemPanel>\r\n        {!is3DVolume && (\r\n          <Colorbar\r\n            viewportId={viewportId}\r\n            displaySets={displaySets.filter(ds => !nonWLModalities.includes(ds.Modality))}\r\n            commandsManager={commandsManager}\r\n            servicesManager={servicesManager}\r\n            colorbarProperties={colorbarProperties}\r\n          />\r\n        )}\r\n\r\n        {colormaps && !is3DVolume && (\r\n          <AllInOneMenu.SubMenu\r\n            key=\"colorLUTPresets\"\r\n            itemLabel=\"Color LUT\"\r\n            itemIcon=\"icon-color-lut\"\r\n          >\r\n            <Colormap\r\n              colormaps={colormaps}\r\n              viewportId={viewportId}\r\n              displaySets={displaySets.filter(ds => !nonWLModalities.includes(ds.Modality))}\r\n              commandsManager={commandsManager}\r\n              servicesManager={servicesManager}\r\n            />\r\n          </AllInOneMenu.SubMenu>\r\n        )}\r\n\r\n        {presets && presets.length > 0 && !is3DVolume && (\r\n          <AllInOneMenu.SubMenu\r\n            key=\"windowLevelPresets\"\r\n            itemLabel={t('Modality Window Presets')}\r\n            itemIcon=\"viewport-window-level\"\r\n          >\r\n            <WindowLevel\r\n              viewportId={viewportId}\r\n              commandsManager={commandsManager}\r\n              presets={presets}\r\n            />\r\n          </AllInOneMenu.SubMenu>\r\n        )}\r\n\r\n        {volumeRenderingPresets && is3DVolume && (\r\n          <VolumeRenderingPresets\r\n            servicesManager={servicesManager}\r\n            viewportId={viewportId}\r\n            commandsManager={commandsManager}\r\n            volumeRenderingPresets={volumeRenderingPresets}\r\n          />\r\n        )}\r\n\r\n        {volumeRenderingQualityRange && is3DVolume && (\r\n          <AllInOneMenu.SubMenu itemLabel=\"Rendering Options\">\r\n            <VolumeRenderingOptions\r\n              viewportId={viewportId}\r\n              commandsManager={commandsManager}\r\n              volumeRenderingQualityRange={volumeRenderingQualityRange}\r\n              servicesManager={servicesManager}\r\n            />\r\n          </AllInOneMenu.SubMenu>\r\n        )}\r\n      </AllInOneMenu.ItemPanel>\r\n    </AllInOneMenu.IconMenu>\r\n  );\r\n}\r\n","import React, { ReactNode } from 'react';\r\nimport { nonWLModalities, WindowLevelActionMenu } from './WindowLevelActionMenu';\r\n\r\nexport function getWindowLevelActionMenu({\r\n  viewportId,\r\n  element,\r\n  displaySets,\r\n  servicesManager,\r\n  commandsManager,\r\n  verticalDirection,\r\n  horizontalDirection,\r\n}: withAppTypes<{\r\n  viewportId: string;\r\n  element: HTMLElement;\r\n  displaySets: AppTypes.DisplaySet[];\r\n}>): ReactNode {\r\n  const { customizationService } = servicesManager.services;\r\n\r\n  const { presets } = customizationService.get('cornerstone.windowLevelPresets');\r\n  const colorbarProperties = customizationService.get('cornerstone.colorbar');\r\n  const { volumeRenderingPresets, volumeRenderingQualityRange } = customizationService.get(\r\n    'cornerstone.3dVolumeRendering'\r\n  );\r\n\r\n  const displaySetPresets = displaySets\r\n    .filter(displaySet => presets[displaySet.Modality])\r\n    .map(displaySet => {\r\n      return { [displaySet.Modality]: presets[displaySet.Modality] };\r\n    });\r\n\r\n  const modalities = displaySets\r\n    .map(displaySet => displaySet.Modality)\r\n    .filter(modality => !nonWLModalities.includes(modality));\r\n\r\n  if (modalities.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <WindowLevelActionMenu\r\n      viewportId={viewportId}\r\n      element={element}\r\n      presets={displaySetPresets}\r\n      verticalDirection={verticalDirection}\r\n      horizontalDirection={horizontalDirection}\r\n      commandsManager={commandsManager}\r\n      servicesManager={servicesManager}\r\n      colorbarProperties={colorbarProperties}\r\n      displaySets={displaySets}\r\n      volumeRenderingPresets={volumeRenderingPresets}\r\n      volumeRenderingQualityRange={volumeRenderingQualityRange}\r\n    />\r\n  );\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Button, Icons, Separator } from '@ohif/ui-next';\r\nimport { SegmentationRepresentations } from '@cornerstonejs/tools/enums';\r\n\r\nfunction ViewportSegmentationMenu({\r\n  viewportId,\r\n  servicesManager,\r\n}: withAppTypes<{ viewportId: string }>) {\r\n  const { segmentationService } = servicesManager.services;\r\n  const [activeSegmentations, setActiveSegmentations] = useState([]);\r\n  const [availableSegmentations, setAvailableSegmentations] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const updateSegmentations = () => {\r\n      const active = segmentationService.getSegmentationRepresentations(viewportId);\r\n      setActiveSegmentations(active);\r\n\r\n      const all = segmentationService.getSegmentations();\r\n      const available = all.filter(\r\n        seg => !active.some(activeSeg => activeSeg.segmentationId === seg.segmentationId)\r\n      );\r\n      setAvailableSegmentations(available);\r\n    };\r\n\r\n    updateSegmentations();\r\n\r\n    const subscriptions = [\r\n      segmentationService.EVENTS.SEGMENTATION_MODIFIED,\r\n      segmentationService.EVENTS.SEGMENTATION_REMOVED,\r\n      segmentationService.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,\r\n    ].map(event => segmentationService.subscribe(event, updateSegmentations));\r\n\r\n    return () => {\r\n      subscriptions.forEach(subscription => subscription.unsubscribe());\r\n    };\r\n  }, [segmentationService, viewportId]);\r\n\r\n  const toggleSegmentationRepresentationVisibility = (\r\n    segmentationId,\r\n    type = SegmentationRepresentations.Labelmap\r\n  ) => {\r\n    segmentationService.toggleSegmentationRepresentationVisibility(viewportId, {\r\n      segmentationId,\r\n      type,\r\n    });\r\n  };\r\n\r\n  const addSegmentationToViewport = segmentationId => {\r\n    segmentationService.addSegmentationRepresentation(viewportId, { segmentationId });\r\n  };\r\n\r\n  const removeSegmentationFromViewport = segmentationId => {\r\n    segmentationService.removeSegmentationRepresentations(viewportId, {\r\n      segmentationId,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-muted flex h-full w-[262px] flex-col rounded p-3\">\r\n      <span className=\"text-muted-foreground mb-2 text-xs font-semibold\">Current Viewport</span>\r\n      <ul className=\"space-y-1\">\r\n        {activeSegmentations.map(segmentation => (\r\n          <li\r\n            key={segmentation.id}\r\n            className=\"flex items-center text-sm\"\r\n          >\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              className=\"text-muted-foreground mr-2\"\r\n              onClick={() => removeSegmentationFromViewport(segmentation.segmentationId)}\r\n            >\r\n              <Icons.Minus className=\"h-6 w-6\" />\r\n            </Button>\r\n            <span className=\"text-foreground flex-grow\">{segmentation.label}</span>\r\n            {segmentation.visible ? (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"text-muted-foreground\"\r\n                onClick={() =>\r\n                  toggleSegmentationRepresentationVisibility(\r\n                    segmentation.segmentationId,\r\n                    segmentation.type\r\n                  )\r\n                }\r\n              >\r\n                <Icons.Hide className=\"h-6 w-6\" />\r\n              </Button>\r\n            ) : (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"text-muted-foreground\"\r\n                onClick={() =>\r\n                  toggleSegmentationRepresentationVisibility(\r\n                    segmentation.segmentationId,\r\n                    segmentation.type\r\n                  )\r\n                }\r\n              >\r\n                <Icons.Show className=\"h-6 w-6\" />\r\n              </Button>\r\n            )}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n      {availableSegmentations.length > 0 && (\r\n        <>\r\n          <Separator className=\"bg-input mb-3\" />\r\n          <span className=\"text-muted-foreground mb-2 text-xs font-semibold\">Available</span>\r\n          <ul className=\"space-y-1\">\r\n            {availableSegmentations.map(({segmentationId, label}) => (\r\n              <li\r\n                key={segmentationId}\r\n                className=\"flex items-center text-sm\"\r\n              >\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className=\"text-muted-foreground mr-2\"\r\n                  onClick={() => addSegmentationToViewport(segmentationId)}\r\n                >\r\n                  <Icons.Plus className=\"h-6 w-6\" />\r\n                </Button>\r\n                <span className=\"text-foreground/60\">{label}</span>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ViewportSegmentationMenu;\r\n","import React, { ReactNode, useEffect, useState } from 'react';\r\nimport { Button, Icons, Popover, PopoverContent, PopoverTrigger } from '@ohif/ui-next';\r\nimport ViewportSegmentationMenu from './ViewportSegmentationMenu';\r\nimport classNames from 'classnames';\r\nimport { useSegmentations } from '../../hooks/useSegmentations';\r\n\r\nexport function ViewportSegmentationMenuWrapper({\r\n  viewportId,\r\n  displaySets,\r\n  servicesManager,\r\n  commandsManager,\r\n  location,\r\n}: withAppTypes<{\r\n  viewportId: string;\r\n  element: HTMLElement;\r\n}>): ReactNode {\r\n  const { viewportActionCornersService, viewportGridService } = servicesManager.services;\r\n\r\n  const segmentations = useSegmentations({ servicesManager });\r\n\r\n  const activeViewportId = viewportGridService.getActiveViewportId();\r\n  const isActiveViewport = viewportId === activeViewportId;\r\n\r\n  const { align, side } = getAlignAndSide(viewportActionCornersService, location);\r\n\r\n  if (!segmentations?.length) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Popover>\r\n      <PopoverTrigger\r\n        asChild\r\n        className=\"flex items-center justify-center\"\r\n      >\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n        >\r\n          <Icons.ViewportViews\r\n            className={classNames(\r\n              'text-highlight',\r\n              isActiveViewport ? 'visible' : 'invisible group-hover/pane:visible'\r\n            )}\r\n          />\r\n        </Button>\r\n      </PopoverTrigger>\r\n      <PopoverContent\r\n        className=\"border-none bg-transparent p-0 shadow-none\"\r\n        side={side}\r\n        align={align}\r\n        alignOffset={-15}\r\n        sideOffset={5}\r\n      >\r\n        <ViewportSegmentationMenu\r\n          className=\"w-full\"\r\n          viewportId={viewportId}\r\n          displaySets={displaySets}\r\n          servicesManager={servicesManager}\r\n          commandsManager={commandsManager}\r\n        />\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n}\r\n\r\nconst getAlignAndSide = (viewportActionCornersService, location) => {\r\n  const ViewportActionCornersLocations = viewportActionCornersService.LOCATIONS;\r\n\r\n  switch (location) {\r\n    case ViewportActionCornersLocations.topLeft:\r\n      return { align: 'start', side: 'bottom' };\r\n    case ViewportActionCornersLocations.topRight:\r\n      return { align: 'end', side: 'bottom' };\r\n    case ViewportActionCornersLocations.bottomLeft:\r\n      return { align: 'start', side: 'top' };\r\n    case ViewportActionCornersLocations.bottomRight:\r\n      return { align: 'end', side: 'top' };\r\n    default:\r\n      console.debug('Unknown location, defaulting to bottom-start');\r\n      return { align: 'start', side: 'bottom' };\r\n  }\r\n};\r\n","import React, { ReactNode } from 'react';\r\nimport { ViewportSegmentationMenuWrapper } from './ViewportSegmentationMenuWrapper';\r\n\r\nexport function getViewportDataOverlaySettingsMenu(\r\n  props: withAppTypes<{\r\n    viewportId: string;\r\n    element: HTMLElement;\r\n  }>\r\n): ReactNode {\r\n  return <ViewportSegmentationMenuWrapper {...props} />;\r\n}\r\n","import { useEffect, useState, memo } from 'react';\r\n\r\nconst MODALITIES_REQUIRING_CINE_AUTO_MOUNT = ['US'];\r\n\r\nconst ActiveViewportBehavior = memo(\r\n  ({ servicesManager, viewportId }: withAppTypes<{ viewportId: string }>) => {\r\n    const { displaySetService, cineService, viewportGridService, customizationService } =\r\n      servicesManager.services;\r\n\r\n    const [activeViewportId, setActiveViewportId] = useState(viewportId);\r\n\r\n    useEffect(() => {\r\n      const subscription = viewportGridService.subscribe(\r\n        viewportGridService.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,\r\n        ({ viewportId }) => setActiveViewportId(viewportId)\r\n      );\r\n\r\n      return () => subscription.unsubscribe();\r\n    }, [viewportId, viewportGridService]);\r\n\r\n    useEffect(() => {\r\n      if (cineService.isViewportCineClosed(activeViewportId)) {\r\n        return;\r\n      }\r\n\r\n      const displaySetInstanceUIDs =\r\n        viewportGridService.getDisplaySetsUIDsForViewport(activeViewportId);\r\n\r\n      if (!displaySetInstanceUIDs) {\r\n        return;\r\n      }\r\n\r\n      const displaySets = displaySetInstanceUIDs.map(uid =>\r\n        displaySetService.getDisplaySetByUID(uid)\r\n      );\r\n\r\n      if (!displaySets.length) {\r\n        return;\r\n      }\r\n\r\n      const modalities = displaySets.map(displaySet => displaySet?.Modality);\r\n\r\n      const { modalities: sourceModalities } = customizationService.getModeCustomization(\r\n        'autoCineModalities',\r\n        {\r\n          id: 'autoCineModalities',\r\n          modalities: MODALITIES_REQUIRING_CINE_AUTO_MOUNT,\r\n        }\r\n      );\r\n\r\n      const requiresCine = modalities.some(modality => sourceModalities.includes(modality));\r\n\r\n      if (requiresCine && !cineService.getState().isCineEnabled) {\r\n        cineService.setIsCineEnabled(true);\r\n      }\r\n    }, [\r\n      activeViewportId,\r\n      cineService,\r\n      viewportGridService,\r\n      displaySetService,\r\n      customizationService,\r\n    ]);\r\n\r\n    return null;\r\n  },\r\n  arePropsEqual\r\n);\r\n\r\nActiveViewportBehavior.displayName = 'ActiveViewportBehavior';\r\n\r\nfunction arePropsEqual(prevProps, nextProps) {\r\n  return (\r\n    prevProps.viewportId === nextProps.viewportId &&\r\n    prevProps.servicesManager === nextProps.servicesManager\r\n  );\r\n}\r\n\r\nexport default ActiveViewportBehavior;\r\n","import React, { useEffect, useRef, useCallback, useState } from 'react';\r\nimport { useResizeDetector } from 'react-resize-detector';\r\nimport * as cs3DTools from '@cornerstonejs/tools';\r\nimport { Enums, eventTarget, getEnabledElement } from '@cornerstonejs/core';\r\nimport { MeasurementService } from '@ohif/core';\r\nimport { AllInOneMenu, Notification, useViewportDialog } from '@ohif/ui';\r\nimport type { Types as csTypes } from '@cornerstonejs/core';\r\n\r\nimport { setEnabledElement } from '../state';\r\n\r\nimport './OHIFCornerstoneViewport.css';\r\nimport CornerstoneOverlays from './Overlays/CornerstoneOverlays';\r\nimport CinePlayer from '../components/CinePlayer';\r\nimport type { Types } from '@ohif/core';\r\n\r\nimport OHIFViewportActionCorners from '../components/OHIFViewportActionCorners';\r\nimport { getWindowLevelActionMenu } from '../components/WindowLevelActionMenu/getWindowLevelActionMenu';\r\nimport { useAppConfig } from '@state';\r\nimport { getViewportDataOverlaySettingsMenu } from '../components/ViewportDataOverlaySettingMenu';\r\nimport { getViewportPresentations } from '../utils/presentations/getViewportPresentations';\r\nimport { useSynchronizersStore } from '../stores/useSynchronizersStore';\r\nimport ActiveViewportBehavior from '../utils/ActiveViewportBehavior';\r\n\r\nconst STACK = 'stack';\r\n\r\n/**\r\n * Caches the jump to measurement operation, so that if display set is shown,\r\n * it can jump to the measurement.\r\n */\r\nlet cacheJumpToMeasurementEvent;\r\n\r\n// Todo: This should be done with expose of internal API similar to react-vtkjs-viewport\r\n// Then we don't need to worry about the re-renders if the props change.\r\nconst OHIFCornerstoneViewport = React.memo(\r\n  (\r\n    props: withAppTypes<{\r\n      viewportId: string;\r\n      displaySets: AppTypes.DisplaySet[];\r\n      viewportOptions: AppTypes.ViewportGrid.GridViewportOptions;\r\n      initialImageIndex: number;\r\n    }>\r\n  ) => {\r\n    const {\r\n      displaySets,\r\n      dataSource,\r\n      viewportOptions,\r\n      displaySetOptions,\r\n      servicesManager,\r\n      commandsManager,\r\n      onElementEnabled,\r\n      // eslint-disable-next-line react/prop-types\r\n      onElementDisabled,\r\n      isJumpToMeasurementDisabled = false,\r\n      // Note: you SHOULD NOT use the initialImageIdOrIndex for manipulation\r\n      // of the imageData in the OHIFCornerstoneViewport. This prop is used\r\n      // to set the initial state of the viewport's first image to render\r\n      // eslint-disable-next-line react/prop-types\r\n      initialImageIndex,\r\n      // if the viewport is part of a hanging protocol layout\r\n      // we should not really rely on the old synchronizers and\r\n      // you see below we only rehydrate the synchronizers if the viewport\r\n      // is not part of the hanging protocol layout. HPs should\r\n      // define their own synchronizers. Since the synchronizers are\r\n      // viewportId dependent and\r\n      // eslint-disable-next-line react/prop-types\r\n      isHangingProtocolLayout,\r\n    } = props;\r\n    const viewportId = viewportOptions.viewportId;\r\n\r\n    if (!viewportId) {\r\n      throw new Error('Viewport ID is required');\r\n    }\r\n\r\n    // Make sure displaySetOptions has one object per displaySet\r\n    while (displaySetOptions.length < displaySets.length) {\r\n      displaySetOptions.push({});\r\n    }\r\n\r\n    // Since we only have support for dynamic data in volume viewports, we should\r\n    // handle this case here and set the viewportType to volume if any of the\r\n    // displaySets are dynamic volumes\r\n    viewportOptions.viewportType = displaySets.some(\r\n      ds => ds.isDynamicVolume && ds.isReconstructable\r\n    )\r\n      ? 'volume'\r\n      : viewportOptions.viewportType;\r\n\r\n    const [scrollbarWidth, setScrollbarWidth] = useState('100px');\r\n    const [enabledVPElement, setEnabledVPElement] = useState(null);\r\n    const elementRef = useRef() as React.MutableRefObject<HTMLDivElement>;\r\n    const [appConfig] = useAppConfig();\r\n\r\n    const {\r\n      displaySetService,\r\n      toolbarService,\r\n      toolGroupService,\r\n      syncGroupService,\r\n      cornerstoneViewportService,\r\n      segmentationService,\r\n      cornerstoneCacheService,\r\n      viewportActionCornersService,\r\n    } = servicesManager.services;\r\n\r\n    const [viewportDialogState] = useViewportDialog();\r\n    // useCallback for scroll bar height calculation\r\n    const setImageScrollBarHeight = useCallback(() => {\r\n      const scrollbarWidth = `${elementRef.current.clientWidth - 40}px`;\r\n      setScrollbarWidth(scrollbarWidth);\r\n    }, [elementRef]);\r\n\r\n    // useCallback for onResize\r\n    const onResize = useCallback(() => {\r\n      if (elementRef.current) {\r\n        cornerstoneViewportService.resize();\r\n        setImageScrollBarHeight();\r\n      }\r\n    }, [elementRef]);\r\n\r\n    const cleanUpServices = useCallback(\r\n      viewportInfo => {\r\n        const renderingEngineId = viewportInfo.getRenderingEngineId();\r\n        const syncGroups = viewportInfo.getSyncGroups();\r\n\r\n        toolGroupService.removeViewportFromToolGroup(viewportId, renderingEngineId);\r\n        syncGroupService.removeViewportFromSyncGroup(viewportId, renderingEngineId, syncGroups);\r\n\r\n        segmentationService.clearSegmentationRepresentations(viewportId);\r\n\r\n        viewportActionCornersService.clear(viewportId);\r\n      },\r\n      [\r\n        viewportId,\r\n        segmentationService,\r\n        syncGroupService,\r\n        toolGroupService,\r\n        viewportActionCornersService,\r\n      ]\r\n    );\r\n\r\n    const elementEnabledHandler = useCallback(\r\n      evt => {\r\n        // check this is this element reference and return early if doesn't match\r\n        if (evt.detail.element !== elementRef.current) {\r\n          return;\r\n        }\r\n\r\n        const { viewportId, element } = evt.detail;\r\n        const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n        setEnabledElement(viewportId, element);\r\n        setEnabledVPElement(element);\r\n\r\n        const renderingEngineId = viewportInfo.getRenderingEngineId();\r\n        const toolGroupId = viewportInfo.getToolGroupId();\r\n        const syncGroups = viewportInfo.getSyncGroups();\r\n\r\n        toolGroupService.addViewportToToolGroup(viewportId, renderingEngineId, toolGroupId);\r\n\r\n        syncGroupService.addViewportToSyncGroup(viewportId, renderingEngineId, syncGroups);\r\n\r\n        // we don't need reactivity here so just use state\r\n        const { synchronizersStore } = useSynchronizersStore.getState();\r\n        if (synchronizersStore?.[viewportId]?.length && !isHangingProtocolLayout) {\r\n          // If the viewport used to have a synchronizer, re apply it again\r\n          _rehydrateSynchronizers(viewportId, syncGroupService);\r\n        }\r\n\r\n        if (onElementEnabled && typeof onElementEnabled === 'function') {\r\n          onElementEnabled(evt);\r\n        }\r\n      },\r\n      [viewportId, onElementEnabled, toolGroupService]\r\n    );\r\n\r\n    // disable the element upon unmounting\r\n    useEffect(() => {\r\n      cornerstoneViewportService.enableViewport(viewportId, elementRef.current);\r\n\r\n      eventTarget.addEventListener(Enums.Events.ELEMENT_ENABLED, elementEnabledHandler);\r\n\r\n      setImageScrollBarHeight();\r\n\r\n      return () => {\r\n        const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n\r\n        if (!viewportInfo) {\r\n          return;\r\n        }\r\n\r\n        cornerstoneViewportService.storePresentation({ viewportId });\r\n\r\n        // This should be done after the store presentation since synchronizers\r\n        // will get cleaned up and they need the viewportInfo to be present\r\n        cleanUpServices(viewportInfo);\r\n\r\n        if (onElementDisabled && typeof onElementDisabled === 'function') {\r\n          onElementDisabled(viewportInfo);\r\n        }\r\n\r\n        cornerstoneViewportService.disableElement(viewportId);\r\n\r\n        eventTarget.removeEventListener(Enums.Events.ELEMENT_ENABLED, elementEnabledHandler);\r\n      };\r\n    }, []);\r\n\r\n    // subscribe to displaySet metadata invalidation (updates)\r\n    // Currently, if the metadata changes we need to re-render the display set\r\n    // for it to take effect in the viewport. As we deal with scaling in the loading,\r\n    // we need to remove the old volume from the cache, and let the\r\n    // viewport to re-add it which will use the new metadata. Otherwise, the\r\n    // viewport will use the cached volume and the new metadata will not be used.\r\n    // Note: this approach does not actually end of sending network requests\r\n    // and it uses the network cache\r\n    useEffect(() => {\r\n      const { unsubscribe } = displaySetService.subscribe(\r\n        displaySetService.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,\r\n        async ({\r\n          displaySetInstanceUID: invalidatedDisplaySetInstanceUID,\r\n          invalidateData,\r\n        }: Types.DisplaySetSeriesMetadataInvalidatedEvent) => {\r\n          if (!invalidateData) {\r\n            return;\r\n          }\r\n\r\n          const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\r\n\r\n          if (viewportInfo.hasDisplaySet(invalidatedDisplaySetInstanceUID)) {\r\n            const viewportData = viewportInfo.getViewportData();\r\n            const newViewportData = await cornerstoneCacheService.invalidateViewportData(\r\n              viewportData,\r\n              invalidatedDisplaySetInstanceUID,\r\n              dataSource,\r\n              displaySetService\r\n            );\r\n\r\n            const keepCamera = true;\r\n            cornerstoneViewportService.updateViewport(viewportId, newViewportData, keepCamera);\r\n          }\r\n        }\r\n      );\r\n      return () => {\r\n        unsubscribe();\r\n      };\r\n    }, [viewportId]);\r\n\r\n    useEffect(() => {\r\n      // handle the default viewportType to be stack\r\n      if (!viewportOptions.viewportType) {\r\n        viewportOptions.viewportType = STACK;\r\n      }\r\n\r\n      const loadViewportData = async () => {\r\n        const viewportData = await cornerstoneCacheService.createViewportData(\r\n          displaySets,\r\n          viewportOptions,\r\n          dataSource,\r\n          initialImageIndex\r\n        );\r\n\r\n        const presentations = getViewportPresentations(viewportId, viewportOptions);\r\n\r\n        let measurement;\r\n        if (cacheJumpToMeasurementEvent?.viewportId === viewportId) {\r\n          measurement = cacheJumpToMeasurementEvent.measurement;\r\n          // Delete the position presentation so that viewport navigates direct\r\n          presentations.positionPresentation = null;\r\n          cacheJumpToMeasurementEvent = null;\r\n        }\r\n\r\n        // Note: This is a hack to get the grid to re-render the OHIFCornerstoneViewport component\r\n        // Used for segmentation hydration right now, since the logic to decide whether\r\n        // a viewport needs to render a segmentation lives inside the CornerstoneViewportService\r\n        // so we need to re-render (force update via change of the needsRerendering) so that React\r\n        // does the diffing and decides we should render this again (although the id and element has not changed)\r\n        // so that the CornerstoneViewportService can decide whether to render the segmentation or not. Not that we reached here we can turn it off.\r\n        if (viewportOptions.needsRerendering) {\r\n          viewportOptions.needsRerendering = false;\r\n        }\r\n\r\n        cornerstoneViewportService.setViewportData(\r\n          viewportId,\r\n          viewportData,\r\n          viewportOptions,\r\n          displaySetOptions,\r\n          presentations\r\n        );\r\n\r\n        if (measurement) {\r\n          cs3DTools.annotation.selection.setAnnotationSelected(measurement.uid);\r\n        }\r\n      };\r\n\r\n      loadViewportData();\r\n    }, [viewportOptions, displaySets, dataSource]);\r\n\r\n    /**\r\n     * There are two scenarios for jump to click\r\n     * 1. Current viewports contain the displaySet that the annotation was drawn on\r\n     * 2. Current viewports don't contain the displaySet that the annotation was drawn on\r\n     * and we need to change the viewports displaySet for jumping.\r\n     * Since measurement_jump happens via events and listeners, the former case is handled\r\n     * by the measurement_jump direct callback, but the latter case is handled first by\r\n     * the viewportGrid to set the correct displaySet on the viewport, AND THEN we check\r\n     * the cache for jumping to see if there is any jump queued, then we jump to the correct slice.\r\n     */\r\n    useEffect(() => {\r\n      if (isJumpToMeasurementDisabled) {\r\n        return;\r\n      }\r\n\r\n      const unsubscribeFromJumpToMeasurementEvents = _subscribeToJumpToMeasurementEvents(\r\n        elementRef,\r\n        viewportId,\r\n        servicesManager\r\n      );\r\n\r\n      _checkForCachedJumpToMeasurementEvents(elementRef, viewportId, displaySets, servicesManager);\r\n\r\n      return () => {\r\n        unsubscribeFromJumpToMeasurementEvents();\r\n      };\r\n    }, [displaySets, elementRef, viewportId, isJumpToMeasurementDisabled, servicesManager]);\r\n\r\n    // Set up the window level action menu in the viewport action corners.\r\n    useEffect(() => {\r\n      // Doing an === check here because the default config value when not set is true\r\n      if (appConfig.addWindowLevelActionMenu === false) {\r\n        return;\r\n      }\r\n\r\n      const location = viewportActionCornersService.LOCATIONS.topRight;\r\n\r\n      // TODO: In the future we should consider using the customization service\r\n      // to determine if and in which corner various action components should go.\r\n      viewportActionCornersService.addComponent({\r\n        viewportId,\r\n        id: 'windowLevelActionMenu',\r\n        component: getWindowLevelActionMenu({\r\n          viewportId,\r\n          element: elementRef.current,\r\n          displaySets,\r\n          servicesManager,\r\n          commandsManager,\r\n          location,\r\n          verticalDirection: AllInOneMenu.VerticalDirection.TopToBottom,\r\n          horizontalDirection: AllInOneMenu.HorizontalDirection.RightToLeft,\r\n        }),\r\n        location,\r\n      });\r\n\r\n      viewportActionCornersService.addComponent({\r\n        viewportId,\r\n        id: 'segmentation',\r\n        component: getViewportDataOverlaySettingsMenu({\r\n          viewportId,\r\n          element: elementRef.current,\r\n          displaySets,\r\n          servicesManager,\r\n          commandsManager,\r\n          location,\r\n        }),\r\n        location,\r\n      });\r\n    }, [\r\n      displaySets,\r\n      viewportId,\r\n      viewportActionCornersService,\r\n      servicesManager,\r\n      commandsManager,\r\n      appConfig,\r\n    ]);\r\n\r\n    const { ref: resizeRef } = useResizeDetector({\r\n      onResize,\r\n    });\r\n\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"viewport-wrapper\">\r\n          <div\r\n            className=\"cornerstone-viewport-element\"\r\n            style={{ height: '100%', width: '100%' }}\r\n            onContextMenu={e => e.preventDefault()}\r\n            onMouseDown={e => e.preventDefault()}\r\n            ref={el => {\r\n              resizeRef.current = el;\r\n              elementRef.current = el;\r\n            }}\r\n          ></div>\r\n          <CornerstoneOverlays\r\n            viewportId={viewportId}\r\n            toolBarService={toolbarService}\r\n            element={elementRef.current}\r\n            scrollbarWidth={scrollbarWidth}\r\n            servicesManager={servicesManager}\r\n          />\r\n          <CinePlayer\r\n            enabledVPElement={enabledVPElement}\r\n            viewportId={viewportId}\r\n            servicesManager={servicesManager}\r\n          />\r\n          <ActiveViewportBehavior\r\n            viewportId={viewportId}\r\n            servicesManager={servicesManager}\r\n          />\r\n        </div>\r\n        {/* top offset of 24px to account for ViewportActionCorners. */}\r\n        <div className=\"absolute top-[24px] w-full\">\r\n          {viewportDialogState.viewportId === viewportId && (\r\n            <Notification\r\n              id=\"viewport-notification\"\r\n              message={viewportDialogState.message}\r\n              type={viewportDialogState.type}\r\n              actions={viewportDialogState.actions}\r\n              onSubmit={viewportDialogState.onSubmit}\r\n              onOutsideClick={viewportDialogState.onOutsideClick}\r\n              onKeyPress={viewportDialogState.onKeyPress}\r\n            />\r\n          )}\r\n        </div>\r\n        {/* The OHIFViewportActionCorners follows the viewport in the DOM so that it is naturally at a higher z-index.*/}\r\n        <OHIFViewportActionCorners viewportId={viewportId} />\r\n      </React.Fragment>\r\n    );\r\n  },\r\n  areEqual\r\n);\r\n\r\nfunction _subscribeToJumpToMeasurementEvents(elementRef, viewportId, servicesManager) {\r\n  const { measurementService, cornerstoneViewportService } = servicesManager.services;\r\n\r\n  const { unsubscribe } = measurementService.subscribe(\r\n    MeasurementService.EVENTS.JUMP_TO_MEASUREMENT_VIEWPORT,\r\n    props => {\r\n      cacheJumpToMeasurementEvent = props;\r\n      const { viewportId: jumpId, measurement, isConsumed } = props;\r\n      if (!measurement || isConsumed) {\r\n        return;\r\n      }\r\n      if (cacheJumpToMeasurementEvent.cornerstoneViewport === undefined) {\r\n        // Decide on which viewport should handle this\r\n        cacheJumpToMeasurementEvent.cornerstoneViewport =\r\n          cornerstoneViewportService.getViewportIdToJump(jumpId, {\r\n            displaySetInstanceUID: measurement.displaySetInstanceUID,\r\n            ...measurement.metadata,\r\n            referencedImageId:\r\n              measurement.referencedImageId || measurement.metadata?.referencedImageId,\r\n          });\r\n      }\r\n      if (cacheJumpToMeasurementEvent.cornerstoneViewport !== viewportId) {\r\n        return;\r\n      }\r\n      _jumpToMeasurement(measurement, elementRef, viewportId, servicesManager);\r\n    }\r\n  );\r\n\r\n  return unsubscribe;\r\n}\r\n\r\n// Check if there is a queued jumpToMeasurement event\r\nfunction _checkForCachedJumpToMeasurementEvents(\r\n  elementRef,\r\n  viewportId,\r\n  displaySets,\r\n  servicesManager\r\n) {\r\n  if (!cacheJumpToMeasurementEvent) {\r\n    return;\r\n  }\r\n  if (cacheJumpToMeasurementEvent.isConsumed) {\r\n    cacheJumpToMeasurementEvent = null;\r\n    return;\r\n  }\r\n  const displaysUIDs = displaySets.map(displaySet => displaySet.displaySetInstanceUID);\r\n  if (!displaysUIDs?.length) {\r\n    return;\r\n  }\r\n\r\n  // Jump to measurement if the measurement exists\r\n  const { measurement } = cacheJumpToMeasurementEvent;\r\n  if (measurement && elementRef) {\r\n    if (displaysUIDs.includes(measurement?.displaySetInstanceUID)) {\r\n      _jumpToMeasurement(measurement, elementRef, viewportId, servicesManager);\r\n    }\r\n  }\r\n}\r\n\r\nfunction _jumpToMeasurement(measurement, targetElementRef, viewportId, servicesManager) {\r\n  const { viewportGridService } = servicesManager.services;\r\n\r\n  const targetElement = targetElementRef.current;\r\n\r\n  // Todo: setCornerstoneMeasurementActive should be handled by the toolGroupManager\r\n  //  to set it properly\r\n  // setCornerstoneMeasurementActive(measurement);\r\n\r\n  viewportGridService.setActiveViewportId(viewportId);\r\n\r\n  const enabledElement = getEnabledElement(targetElement);\r\n\r\n  if (enabledElement) {\r\n    // See how the jumpToSlice() of Cornerstone3D deals with imageIdx param.\r\n    const viewport = enabledElement.viewport as csTypes.IStackViewport | csTypes.IVolumeViewport;\r\n\r\n    const { metadata } = measurement;\r\n    if (!viewport.isReferenceViewable(metadata, { withNavigation: true, withOrientation: true })) {\r\n      console.log(\"Reference isn't viewable, postponing until updated\");\r\n      return;\r\n    }\r\n\r\n    viewport.setViewReference(metadata);\r\n\r\n    cs3DTools.annotation.selection.setAnnotationSelected(measurement.uid);\r\n    // Jump to measurement consumed, remove.\r\n    cacheJumpToMeasurementEvent?.consume?.();\r\n    cacheJumpToMeasurementEvent = null;\r\n  }\r\n}\r\n\r\nfunction _rehydrateSynchronizers(viewportId: string, syncGroupService: any) {\r\n  const { synchronizersStore } = useSynchronizersStore.getState();\r\n  const synchronizers = synchronizersStore[viewportId];\r\n\r\n  if (!synchronizers) {\r\n    return;\r\n  }\r\n\r\n  synchronizers.forEach(synchronizerObj => {\r\n    if (!synchronizerObj.id) {\r\n      return;\r\n    }\r\n\r\n    const { id, sourceViewports, targetViewports } = synchronizerObj;\r\n\r\n    const synchronizer = syncGroupService.getSynchronizer(id);\r\n\r\n    if (!synchronizer) {\r\n      return;\r\n    }\r\n\r\n    const sourceViewportInfo = sourceViewports.find(\r\n      sourceViewport => sourceViewport.viewportId === viewportId\r\n    );\r\n\r\n    const targetViewportInfo = targetViewports.find(\r\n      targetViewport => targetViewport.viewportId === viewportId\r\n    );\r\n\r\n    const isSourceViewportInSynchronizer = synchronizer\r\n      .getSourceViewports()\r\n      .find(sourceViewport => sourceViewport.viewportId === viewportId);\r\n\r\n    const isTargetViewportInSynchronizer = synchronizer\r\n      .getTargetViewports()\r\n      .find(targetViewport => targetViewport.viewportId === viewportId);\r\n\r\n    // if the viewport was previously a source viewport, add it again\r\n    if (sourceViewportInfo && !isSourceViewportInSynchronizer) {\r\n      synchronizer.addSource({\r\n        viewportId: sourceViewportInfo.viewportId,\r\n        renderingEngineId: sourceViewportInfo.renderingEngineId,\r\n      });\r\n    }\r\n\r\n    // if the viewport was previously a target viewport, add it again\r\n    if (targetViewportInfo && !isTargetViewportInSynchronizer) {\r\n      synchronizer.addTarget({\r\n        viewportId: targetViewportInfo.viewportId,\r\n        renderingEngineId: targetViewportInfo.renderingEngineId,\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n// Component displayName\r\nOHIFCornerstoneViewport.displayName = 'OHIFCornerstoneViewport';\r\n\r\nfunction areEqual(prevProps, nextProps) {\r\n  if (nextProps.needsRerendering) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: needsRerendering');\r\n    return false;\r\n  }\r\n\r\n  if (prevProps.displaySets.length !== nextProps.displaySets.length) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: displaySets length change');\r\n    return false;\r\n  }\r\n\r\n  if (prevProps.viewportOptions.orientation !== nextProps.viewportOptions.orientation) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: orientation change');\r\n    return false;\r\n  }\r\n\r\n  if (prevProps.viewportOptions.toolGroupId !== nextProps.viewportOptions.toolGroupId) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: toolGroupId change');\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    nextProps.viewportOptions.viewportType &&\r\n    prevProps.viewportOptions.viewportType !== nextProps.viewportOptions.viewportType\r\n  ) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: viewportType change');\r\n    return false;\r\n  }\r\n\r\n  if (nextProps.viewportOptions.needsRerendering) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: viewportOptions.needsRerendering');\r\n    return false;\r\n  }\r\n\r\n  const prevDisplaySets = prevProps.displaySets;\r\n  const nextDisplaySets = nextProps.displaySets;\r\n\r\n  if (prevDisplaySets.length !== nextDisplaySets.length) {\r\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: displaySets length mismatch');\r\n    return false;\r\n  }\r\n\r\n  for (let i = 0; i < prevDisplaySets.length; i++) {\r\n    const prevDisplaySet = prevDisplaySets[i];\r\n\r\n    const foundDisplaySet = nextDisplaySets.find(\r\n      nextDisplaySet =>\r\n        nextDisplaySet.displaySetInstanceUID === prevDisplaySet.displaySetInstanceUID\r\n    );\r\n\r\n    if (!foundDisplaySet) {\r\n      console.debug('OHIFCornerstoneViewport: Rerender caused by: displaySet not found');\r\n      return false;\r\n    }\r\n\r\n    // check they contain the same image\r\n    if (foundDisplaySet.images?.length !== prevDisplaySet.images?.length) {\r\n      console.debug('OHIFCornerstoneViewport: Rerender caused by: images length mismatch');\r\n      return false;\r\n    }\r\n\r\n    // check if their imageIds are the same\r\n    if (foundDisplaySet.images?.length) {\r\n      for (let j = 0; j < foundDisplaySet.images.length; j++) {\r\n        if (foundDisplaySet.images[j].imageId !== prevDisplaySet.images[j].imageId) {\r\n          console.debug('OHIFCornerstoneViewport: Rerender caused by: imageId mismatch');\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// Helper function to check if display sets have changed\r\nfunction haveDisplaySetsChanged(prevDisplaySets, currentDisplaySets) {\r\n  if (prevDisplaySets.length !== currentDisplaySets.length) {\r\n    return true;\r\n  }\r\n\r\n  return currentDisplaySets.some((currentDS, index) => {\r\n    const prevDS = prevDisplaySets[index];\r\n    return currentDS.displaySetInstanceUID !== prevDS.displaySetInstanceUID;\r\n  });\r\n}\r\n\r\nexport default OHIFCornerstoneViewport;\r\n","import { usePositionPresentationStore } from '../../stores/usePositionPresentationStore';\r\nimport { useLutPresentationStore } from '../../stores/useLutPresentationStore';\r\nimport { useSegmentationPresentationStore } from '../../stores/useSegmentationPresentationStore';\r\n\r\nexport function getViewportPresentations(\r\n  viewportId: string,\r\n  viewportOptions: AppTypes.ViewportGrid.GridViewportOptions\r\n) {\r\n  const { lutPresentationStore } = useLutPresentationStore.getState();\r\n  const { positionPresentationStore } = usePositionPresentationStore.getState();\r\n  const { segmentationPresentationStore } = useSegmentationPresentationStore.getState();\r\n\r\n  // NOTE: this is the new viewport state, we should not get the presentationIds from the cornerstoneViewportService\r\n  // since that has the old viewport state\r\n  const { presentationIds } = viewportOptions;\r\n\r\n  if (!presentationIds) {\r\n    return {\r\n      positionPresentation: null,\r\n      lutPresentation: null,\r\n      segmentationPresentation: null,\r\n    };\r\n  }\r\n\r\n  const { lutPresentationId, positionPresentationId, segmentationPresentationId } = presentationIds;\r\n\r\n  return {\r\n    positionPresentation: positionPresentationStore[positionPresentationId],\r\n    lutPresentation: lutPresentationStore[lutPresentationId],\r\n    segmentationPresentation: segmentationPresentationStore[segmentationPresentationId],\r\n  };\r\n}\r\n"],"names":["CornerstoneImageScrollbar","viewportData","viewportId","element","imageSliceData","setImageSliceData","scrollbarWidth","servicesManager","cineService","cornerstoneViewportService","panoramicService","viewportGridService","services","isDentascan","setIsDentascan","useState","startsWith","useEffect","viewport","getCornerstoneViewport","VolumeViewport3D","imageIndex","getCurrentImageIdIndex","numberOfSlices","getNumberOfSlices","displaySetUID","getDisplaySetsUIDsForViewport","widthPanoramic","getPanoramicState","panoramicDimensions","Math","round","viewportType","eventId","Enums","STACK","STACK_VIEWPORT_SCROLL","ORTHOGRAPHIC","VOLUME_NEW_IMAGE","IMAGE_RENDERED","updateIndex","event","newImageIdIndex","detail","addEventListener","removeEventListener","React","ImageScrollbar","onChange","evt","onImageScrollbarChange","isCineEnabled","getState","stopClip","setCine","id","isPlaying","csUtils","debounceLoading","_isDentascan","viewportIds","getViewportIds","findIndex","vpId","length","setDentascanIndex","max","height","value","propTypes","PropTypes","isRequired","Element","scrollbarHeight","getOrientationStringLPS","invertOrientationStringLPS","utilities","orientationMarkers","rotation","setRotation","flipHorizontal","setFlipHorizontal","flipVertical","setFlipVertical","cameraModifiedListener","previousCamera","camera","undefined","CAMERA_MODIFIED","markers","useMemo","rowCosines","columnCosines","isDefaultValueSetForColumnCosine","imageId","data","imageIds","metaData","getEnabledElement","viewUp","viewPlaneNormal","getCamera","viewRight","vec3","rowString","columnString","oppositeRowString","top","left","right","bottom","_getOrientationMarkers","getViewportInfo","map","m","index","className","classNames","key","console","log","ViewportImageSliceLoadingIndicator","loading","setLoading","error","setError","loadIndicatorRef","useRef","imageIdToBeLoaded","setLoadingState","clearTimeout","current","setTimeout","setFinishLoadingState","setErrorState","IMAGE_LOAD_ERROR","STACK_NEW_IMAGE","props","setViewportData","unsubscribe","subscribe","EVENTS","VIEWPORT_DATA_CHANGED","viewportInfo","viewportOptions","customViewportProps","hideOverlays","ViewportImageScrollbar","CustomizableViewportOverlay","ViewportOrientationMarkers","RenderCinePlayer","newStackFrameRate","dynamicInfo","dynamicInfoProp","customizationService","component","CinePlayerComponent","CinePlayer","get","setDynamicInfo","handleTimePointIndexChange","volumeId","timePointIndex","numTimePoints","splittingTag","label","eventTarget","DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED","cache","getVolume","updateDynamicInfo","useCallback","frameRate","onClose","setIsCineEnabled","setViewportCineClosed","onPlayPauseChange","onFrameRateChange","enabledVPElement","displaySetService","cines","useCine","setNewStackFrameRate","appConfig","useAppConfig","isMountedRef","cineHandler","validFrameRate","playClip","framesPerSecond","newDisplaySetHandler","viewports","displaySetInstanceUIDs","forEach","displaySetInstanceUID","displaySet","getDisplaySetByUID","FrameRate","autoPlayCine","isDynamicVolume","dynamicVolumeInfo","timePoints","VIEWPORT_NEW_IMAGE_SET","VOLUME_VIEWPORT_NEW_VOLUME","cine","viewportActionCornersState","useViewportActionCornersContext","ViewportActionCorners","cornerComponents","Colormap","colormaps","displaySets","commandsManager","activeDisplaySet","setActiveDisplaySet","showPreview","setShowPreview","prePreviewColormap","setPrePreviewColormap","showPreviewRef","prePreviewColormapRef","activeDisplaySetRef","onSetColorLUT","opacity","includes","colormap","name","run","commandName","commandOptions","immediate","context","buttons","children","Modality","style","minWidth","fontSize","textAlign","display","justifyContent","alignItems","ButtonGroup","onActiveIndexChange","activeIndex","ds","SwitchButton","checked","AllInOneMenu","description","onClick","onMouseEnter","getViewportColormap","StackViewport","getProperties","find","c","Name","actorEntries","getActors","actorEntry","entry","referencedId","onMouseLeave","setViewportColorbar","colorbarOptions","backgroundColor","getViewportOptions","background","ticks","position","font","color","maxNumTicks","tickSize","tickWidth","labelMargin","push","VolumeViewport","options","Colorbar","colorbarProperties","colorbarService","width","colorbarWidth","colorbarTickPosition","colorbarContainerPosition","colorbarInitialColormap","showColorbar","setShowColorbar","hasColorbar","onSetColorbar","activeColormapName","STATE_CHANGED","updateColorbarState","WindowLevel","presets","t","useTranslation","onSetWindowLevel","modalityPresets","modalityIndex","Object","entries","modality","presetsArray","preset","secondaryLabel","window","level","VolumeRenderingPresetsContent","filteredPresets","setFilteredPresets","searchValue","setSearchValue","selectedPreset","setSelectedPreset","handleSearchChange","filtered","filter","toLowerCase","handleApply","runCommand","InputFilterText","onDebounceChange","placeholder","Icon","maxChars","slice","formatLabel","Button","size","ButtonEnums","medium","type","secondary","VolumeRenderingPresets","volumeRenderingPresets","uiModalService","icon","rightIcon","onClickPresets","show","content","title","movable","contentProps","hide","containerDimensions","contentDimensions","VolumeRenderingQuality","volumeRenderingQualityRange","min","step","quality","setQuality","volumeQuality","actor","mapper","getMapper","spacing","getInputData","getSpacing","sampleDistance","getSampleDistance","averageSpacing","reduce","a","b","sqrt","htmlFor","e","parseInt","target","percentage","calculateBackground","VolumeShift","minShift","setMinShift","maxShift","setMaxShift","shift","setShift","shiftedBy","setStep","isBlocking","setIsBlocking","prevShiftRef","ofun","getProperty","getScalarOpacity","range","getRange","transferFunctionWidth","pow","floor","log10","onChangeRange","newShift","shiftDifference","shiftValue","onMouseDown","onMouseUp","VolumeLighting","ambient","setAmbient","diffuse","setDiffuse","specular","setSpecular","onAmbientChange","onDiffuseChange","onSpecularChange","getAmbient","getDiffuse","getSpecular","VolumeShade","shade","setShade","setKey","onShadeChange","getShade","VolumeRenderingOptions","nonWLModalities","WindowLevelActionMenu","verticalDirection","horizontalDirection","isLight","viewportGrid","useViewportGrid","activeViewportId","vpHeight","setVpHeight","clientHeight","menuKey","setMenuKey","is3DVolume","setIs3DVolume","newVpHeight","removeColorbar","iconClassName","menuStyle","maxHeight","onVisibilityChange","itemLabel","itemIcon","getWindowLevelActionMenu","displaySetPresets","segmentationService","activeSegmentations","setActiveSegmentations","availableSegmentations","setAvailableSegmentations","updateSegmentations","active","getSegmentationRepresentations","available","getSegmentations","seg","some","activeSeg","segmentationId","subscriptions","SEGMENTATION_MODIFIED","SEGMENTATION_REMOVED","SEGMENTATION_REPRESENTATION_MODIFIED","subscription","toggleSegmentationRepresentationVisibility","SegmentationRepresentations","Labelmap","segmentation","variant","removeSegmentationFromViewport","removeSegmentationRepresentations","Icons","Minus","visible","Hide","Show","Separator","addSegmentationRepresentation","addSegmentationToViewport","Plus","ViewportSegmentationMenuWrapper","location","viewportActionCornersService","segmentations","useSegmentations","isActiveViewport","getActiveViewportId","align","side","getAlignAndSide","Popover","PopoverTrigger","asChild","ViewportViews","PopoverContent","alignOffset","sideOffset","ViewportSegmentationMenu","ViewportActionCornersLocations","LOCATIONS","topLeft","topRight","bottomLeft","bottomRight","debug","getViewportDataOverlaySettingsMenu","MODALITIES_REQUIRING_CINE_AUTO_MOUNT","ActiveViewportBehavior","memo","setActiveViewportId","ACTIVE_VIEWPORT_ID_CHANGED","isViewportCineClosed","uid","modalities","sourceModalities","getModeCustomization","arePropsEqual","prevProps","nextProps","displayName","cacheJumpToMeasurementEvent","OHIFCornerstoneViewport","dataSource","displaySetOptions","onElementEnabled","onElementDisabled","isJumpToMeasurementDisabled","initialImageIndex","isHangingProtocolLayout","Error","isReconstructable","setScrollbarWidth","setEnabledVPElement","elementRef","toolbarService","toolGroupService","syncGroupService","cornerstoneCacheService","viewportDialogState","useViewportDialog","setImageScrollBarHeight","clientWidth","onResize","resize","cleanUpServices","renderingEngineId","getRenderingEngineId","syncGroups","getSyncGroups","removeViewportFromToolGroup","removeViewportFromSyncGroup","clearSegmentationRepresentations","clear","elementEnabledHandler","setEnabledElement","toolGroupId","getToolGroupId","addViewportToToolGroup","addViewportToSyncGroup","synchronizersStore","useSynchronizersStore","synchronizers","synchronizerObj","sourceViewports","targetViewports","synchronizer","getSynchronizer","sourceViewportInfo","sourceViewport","targetViewportInfo","targetViewport","isSourceViewportInSynchronizer","getSourceViewports","isTargetViewportInSynchronizer","getTargetViewports","addSource","addTarget","_rehydrateSynchronizers","enableViewport","ELEMENT_ENABLED","storePresentation","disableElement","DISPLAY_SET_SERIES_METADATA_INVALIDATED","async","invalidatedDisplaySetInstanceUID","invalidateData","hasDisplaySet","getViewportData","newViewportData","invalidateViewportData","keepCamera","updateViewport","createViewportData","presentations","lutPresentationStore","useLutPresentationStore","positionPresentationStore","usePositionPresentationStore","segmentationPresentationStore","useSegmentationPresentationStore","presentationIds","positionPresentation","lutPresentation","segmentationPresentation","lutPresentationId","positionPresentationId","segmentationPresentationId","getViewportPresentations","measurement","needsRerendering","cs3DTools","loadViewportData","unsubscribeFromJumpToMeasurementEvents","measurementService","MeasurementService","JUMP_TO_MEASUREMENT_VIEWPORT","jumpId","isConsumed","cornerstoneViewport","getViewportIdToJump","metadata","referencedImageId","_jumpToMeasurement","_subscribeToJumpToMeasurementEvents","displaysUIDs","_checkForCachedJumpToMeasurementEvents","addWindowLevelActionMenu","addComponent","TopToBottom","RightToLeft","ref","resizeRef","useResizeDetector","onContextMenu","preventDefault","el","CornerstoneOverlays","toolBarService","Notification","message","actions","onSubmit","onOutsideClick","onKeyPress","OHIFViewportActionCorners","areEqual","targetElementRef","targetElement","enabledElement","isReferenceViewable","withNavigation","withOrientation","setViewReference","consume","orientation","prevDisplaySets","nextDisplaySets","i","prevDisplaySet","foundDisplaySet","nextDisplaySet","images","j"],"sourceRoot":""}