"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3902],{58295:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var a=n(86326),s=n(99993),r=n(93213);const i=function(e,t,n){const{tools:a}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,a)},o=0,l=5;const c=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateCallback:s}){const{uiViewportDialogService:i}=e.services,c=e._extensionManager._appConfig;return new Promise(async function(e,p){const u=c?.disableConfirmationPrompts?l:await function(e,t){return new Promise(function(n,a){const s="Do you want to open this Segmentation?",i=[{id:"no-hydrate",type:r.Ny.NW.secondary,text:"No",value:o},{id:"yes-hydrate",type:r.Ny.NW.primary,text:"Yes",value:l}],c=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:s,actions:i,onSubmit:c,onOutsideClick:()=>{e.hide(),n(o)},onKeyPress:e=>{"Enter"===e.key&&c(l)}})})}(i,n);u===l&&(a?.forEach(e=>{e()}),window.setTimeout(async()=>{const a=await s({segDisplaySet:t,viewportId:n});e(a)},0))})};function p({isHydrated:e,onStatusClick:t}){let n=null,i=null;switch(e){case!0:i=()=>a.createElement(r.In,{name:"status-alert"}),n=()=>a.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:i=()=>a.createElement(r.In,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>a.createElement("div",null,"Click LOAD to load segmentation.")}const o=()=>{const{t:n}=(0,s.Bd)("Common"),r=n("LOAD");return a.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},a.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},a.createElement(i,null),a.createElement("span",{className:"ml-1"},"SEG")),!e&&a.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},r))};return a.createElement(a.Fragment,null,n&&a.createElement(r.m_,{content:a.createElement(n,null),position:"bottom-left"},a.createElement(o,null)),!n&&a.createElement(o,null))}var u=n(92860),d=n(99737);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(null,arguments)}const S=function(e){const{children:t,displaySets:n,viewportOptions:o,servicesManager:l,extensionManager:S,commandsManager:y}=e,{t:g}=(0,s.Bd)("SEGViewport"),I=o.viewportId,{displaySetService:v,toolGroupService:w,segmentationService:E,customizationService:f,viewportActionCornersService:b}=l.services,h=`SEGToolGroup-${I}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const D=n[0],[C,N]=(0,r.ih)(),[P,T]=(0,a.useState)(1),{setPositionPresentation:k}=(0,u.usePositionPresentationStore)(),[x,A]=(0,a.useState)(D.isHydrated),[M,O]=(0,a.useState)(!D.isLoaded),[U,G]=(0,a.useState)(null),[L,V]=(0,a.useState)({percentComplete:null,totalSegments:null}),R=(0,a.useRef)(null),{viewports:_,activeViewportId:B}=C,F=D.referencedDisplaySetInstanceUID,H=v.getDisplaySetByUID(F),j=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=a,r=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:i,SliceThickness:o}=r,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||o,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||i};return c}(H,D);R.current={displaySet:H,metadata:j};const q=()=>{G(null)},W=(0,a.useCallback)(()=>{C?.viewports.forEach(({viewportId:e})=>{y.runCommand("storePresentation",{viewportId:e})})},[C]),Y=(0,a.useCallback)(()=>{const{component:t}=S.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone");return a.createElement(t,m({},e,{displaySets:[D],viewportOptions:{viewportType:o.viewportType,toolGroupId:h,orientation:o.orientation,viewportId:o.viewportId,presentationIds:o.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{G(e.detail.element)})(t)},onElementDisabled:q}))},[I,D,h]),$=(0,a.useCallback)(e=>{const t=D.displaySetInstanceUID,n=E.getSegmentation(t),{segments:a}=n,s=Object.keys(a).length;let r=P+e;r>s-1?r=1:0===r&&(r=s-1),E.jumpToSegmentCenter(t,r,I),T(r)},[P]),z=(0,a.useCallback)(()=>{y.runCommand("updateStoredSegmentationPresentation",{displaySet:D,type:d.SegmentationRepresentations.Labelmap}),y.runCommand("updateStoredPositionPresentation",{viewportId:I,displaySetInstanceUID:H.displaySetInstanceUID}),N.setDisplaySetsForViewport({viewportId:I,displaySetInstanceUIDs:[H.displaySetInstanceUID]})},[y,I,H,D]);(0,a.useEffect)(()=>{M||c({servicesManager:l,viewportId:I,segDisplaySet:D,preHydrateCallbacks:[W],hydrateCallback:z}).then(e=>{e&&A(!0)})},[l,I,D,M,z]),(0,a.useEffect)(()=>{E.clearSegmentationRepresentations(I);const{unsubscribe:e}=E.subscribe(E.EVENTS.SEGMENTATION_LOADING_COMPLETE,e=>{if(e.segDisplaySet.displaySetInstanceUID===D.displaySetInstanceUID&&O(!1),D?.firstSegmentedSliceImageId&&o?.presentationIds){const{firstSegmentedSliceImageId:e}=D,{presentationIds:t}=o;k(t.positionPresentationId,{viewReference:{referencedImageId:e}})}});return()=>{e()}},[D]),(0,a.useEffect)(()=>{const{unsubscribe:e}=E.subscribe(E.EVENTS.SEGMENT_LOADING_COMPLETE,({percentComplete:e,numSegments:t})=>{V({percentComplete:e,totalSegments:t})});return()=>{e()}},[D]),(0,a.useEffect)(()=>{const e=v.subscribe(v.EVENTS.DISPLAY_SETS_REMOVED,({displaySetInstanceUIDs:e})=>{const t=_.get(B);e.includes(t.displaySetInstanceUID)&&N.setDisplaySetsForViewport({viewportId:B,displaySetInstanceUIDs:[]})});return()=>{e.unsubscribe()}},[]),(0,a.useEffect)(()=>{let e=w.getToolGroup(h);if(!e)return y.runCommand("updateStoredSegmentationPresentation",{displaySet:D,type:d.SegmentationRepresentations.Labelmap}),E.clearSegmentationRepresentations(I),e=i(w,f,h),()=>{E.clearSegmentationRepresentations(I),w.destroyToolGroup(h)}},[]);const K=(0,a.useCallback)(async()=>{W(),z()},[W,z]);(0,a.useEffect)(()=>{b.addComponents([{viewportId:I,id:"viewportStatusComponent",component:p({isHydrated:x,onStatusClick:K}),indexPriority:-100,location:b.LOCATIONS.topLeft},{viewportId:I,id:"viewportActionArrowsComponent",component:a.createElement(r.$I,{key:"actionArrows",onArrowsClick:$,className:I===B?"visible":"invisible group-hover/pane:visible"}),indexPriority:0,location:b.LOCATIONS.topRight}])},[B,x,$,K,b,I]);let J=null;return R.current&&H.displaySetInstanceUID===R.current.displaySet.displaySetInstanceUID?(t&&t.length&&(J=t.map((e,t)=>e&&a.cloneElement(e,{viewportId:I,key:t}))),a.createElement(a.Fragment,null,a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},M&&a.createElement(r.pT,{className:"h-full w-full",totalNumbers:L.totalSegments,percentComplete:L.percentComplete,loadingText:"Loading SEG..."}),Y(),J))):null}}}]);
//# sourceMappingURL=3902.bundle.2aa96a6f44383305b9ba.js.map