/*! For license information please see 665.bundle.9e3df225d3467deced0a.js.LICENSE.txt */
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[665],{5057:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(53586),r=n(48080),o=n(92885),a=n(71209);function s(e,t){const n=e.image;if(!e.canvas||!e.image)return;const s=(0,i.A)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let i=n.render;i||(i=e.viewport.colormap?a.l:n.color?r.f:o.j),i(e,t)}const l=(0,i.A)()-s;n.stats.lastRenderTime=l,e.invalid=!1,e.needsRedraw=!1}},7808:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(45354);function r(e,t){const n=new i.d;if(!e.viewport.displayedArea)return n;n.translate(e.canvas.width/2,e.canvas.height/2);const r=e.viewport.rotation;0!==r&&n.rotate(r*Math.PI/180);let o=e.viewport.scale,a=e.viewport.scale;const s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);if("NONE"===e.viewport.displayedArea.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?o*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(a*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(o=e.viewport.displayedArea.columnPixelSpacing,a=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode){const t=e.canvas.height/(l*a),n=e.canvas.width/(s*o);o=a=Math.min(n,t),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?o*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(a*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing)}return n.scale(o,a),0!==r&&n.rotate(-r*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==r&&n.rotate(r*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},36931:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(12132),r=n(57162);function o(e,t,n,o){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)return(0,i.A)();const a=(0,r.A)(e,t,0).scaleFactor;let s;return"PT"===n&&t.isPreScaled?s={windowWidth:5,windowCenter:2.5}:void 0!==t.windowWidth&&void 0!==t.windowCenter&&(s={windowWidth:Array.isArray(t.windowWidth)?t.windowWidth[0]:t.windowWidth,windowCenter:Array.isArray(t.windowCenter)?t.windowCenter[0]:t.windowCenter}),{scale:a,translation:{x:0,y:0},voi:s,invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,modality:n,voiLUT:t.voiLUT,colormap:void 0!==o?o:t.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},98834:(e,t,n)=>{"use strict";n.d(t,{ge:()=>s,x:()=>a,oI:()=>i.Ay,A7:()=>r.A});n(18897),n(92099);var i=n(30135),r=n(10809),o=n(46347);const a=async function(e,t,n,i=!1,r=!1){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!(n instanceof o.A))return void console.warn(`Viewport with Id ${t} is not a BaseVolumeViewport. Cannot add volume to this viewport.`)}const a=n.map(async n=>{const o=e.getViewport(n);await o.addVolumes(t,i,r)});await Promise.all(a)};n(90740);const s=async function(e,t,n){for(const t of n){const n=e.getStackViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!n.addImages)return void console.warn(`Viewport with Id ${t} does not have addImages. Cannot add image segmentation to this viewport.`)}const i=n.map(async n=>{e.getStackViewport(n).addImages(t)});await Promise.all(i)}},90808:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});class i{constructor(e){this._color=[200,0,0],this.id=e.id,this._points=e.points,this._polys=e.polys,this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes(),this._updateCentroid()}_getSizeInBytes(){return 4*this._points.length+4*this._polys.length}_updateCentroid(){const e=this._points.length/3;let t=0,n=0,i=0;for(let e=0;e<this._points.length;e+=3)t+=this._points[e],n+=this._points[e+1],i+=this._points[e+2];this._centroid=[t/e,n/e,i/e]}get color(){return this._color}set color(e){this._color=e}get points(){return this._points}set points(e){this._points=e,this._updateCentroid()}get polys(){return this._polys}set polys(e){this._polys=e}get segmentIndex(){return this._segmentIndex}get centroid(){return this._centroid}get flatPointsArray(){return this._points}get totalNumberOfPoints(){return this._points.length/3}}},31749:(e,t,n)=>{"use strict";n.d(t,{BlendModes:()=>u,CalibrationTypes:()=>g,Events:()=>i.A,GenerateImageType:()=>v,GeometryType:()=>p,ImageQualityStatus:()=>_.A,InterpolationType:()=>a.A,MetadataModules:()=>E.A,OrientationAxis:()=>h.A,RequestType:()=>r.A,VOILUTFunctionType:()=>m.A,VideoEnums:()=>w,ViewportStatus:()=>y.A,ViewportType:()=>o.A});var i=n(32643),r=n(43213),o=n(41864),a=n(29310),s=n(67737);const{BlendMode:l}=s.Ay;var c;!function(e){e[e.COMPOSITE=l.COMPOSITE_BLEND]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=l.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=l.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=l.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND"}(c||(c={}));const u=c;var d,h=n(18735);!function(e){e.CONTOUR="CONTOUR",e.SURFACE="SURFACE"}(d||(d={}));const p=d;n(86066);var f,m=n(82501);n(91369);!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(f||(f={}));const g=f;var v,y=n(1814),_=n(77474),w=n(13545),E=n(69850);!function(e){e.SUM="SUM",e.SUBTRACT="SUBTRACT",e.AVERAGE="AVERAGE"}(v||(v={}))},86846:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>r,b1:()=>o,yj:()=>a,zb:()=>s});var i=n(39536);function r(e){if(!e)return;const{viewportUid:t,renderingEngineUid:n}=e.dataset;return o(t,n)}function o(e,t){if(!t||!e)return;const n=(0,i.Ay)(t);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(e);if(!r)return;const o=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:e,renderingEngineId:t,FrameOfReferenceUID:o}}function a(e){const t=(0,i.qO)();for(let n=0;n<t.length;n++){const i=t[n];if(i.getViewport(e))return o(e,i.id)}}function s(){const e=[];return(0,i.qO)().forEach(t=>{t.getViewports().forEach(({element:t})=>{e.push(r(t))})}),e}},15327:(e,t,n)=>{"use strict";n.d(t,{BaseVolumeViewport:()=>a.A,CONSTANTS:()=>r,Enums:()=>i,Settings:()=>w,StackViewport:()=>s.A,VideoViewport:()=>l.A,VolumeViewport:()=>o.A,addImageSlicesToViewports:()=>N.ge,addVolumesToViewports:()=>N.x,cache:()=>d.Ay,eventTarget:()=>c.A,geometryLoader:()=>D,getEnabledElement:()=>p.Ay,getEnabledElementByIds:()=>p.b1,getEnabledElementByViewportId:()=>p.yj,getEnabledElements:()=>p.zb,getRenderingEngine:()=>u.lD,getRenderingEngines:()=>u.qO,getWebWorkerManager:()=>m.G_,imageLoadPoolManager:()=>h.A,imageLoader:()=>S,metaData:()=>f,triggerEvent:()=>T.A,utilities:()=>A,volumeLoader:()=>I});var i=n(31749),r=n(19325),o=(n(56706),n(18897),n(92099),n(30135),n(94155)),a=(n(40893),n(46347)),s=n(58165),l=n(32501),c=(n(81466),n(10056),n(10364)),u=n(39536),d=(n(58927),n(49038)),h=(n(91073),n(51159)),p=n(86846),f=n(74876),m=n(59693);const g=Symbol("DefaultSettings"),v=Symbol("RuntimeSettings"),y=Symbol("ObjectSettingsMap"),_=Symbol("Dictionary");class w{constructor(e){const t=Object.create(e instanceof w&&_ in e?e[_]:null);Object.seal(Object.defineProperty(this,_,{value:t}))}set(e,t){return b(this[_],e,t,null)}get(e){return function(e,t){return e[t]}(this[_],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const i=t,r=i.slice(0,-1),o=0===r.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o||t.startsWith(i)||t===r)&&(delete e[t],++n);return n>0}return delete e[t]}(this[_],e+"")}forEach(e){E(this[_],e)}extend(){return new w(this)}import(e){x(e)&&Object.keys(e).forEach(t=>{b(this[_],t,e[t],null)})}dump(){const e={};return E(this[_],(t,n)=>{void 0!==n&&C(e,t,n)}),e}static assert(e){return e instanceof w?e:w.getRuntimeSettings()}static getDefaultSettings(e=null){let t=w[g];if(t instanceof w||(t=new w,w[g]=t),e){const n={};return t.forEach(i=>{if(i.startsWith(e)){const r=i.split(`${e}.`)[1];n[r]=t.get(i)}}),n}return t}static getRuntimeSettings(){let e=w[v];return e instanceof w||(e=new w(w.getDefaultSettings()),w[v]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof w)n=e;else if("object"==typeof e&&null!==e){let i=w[y];i instanceof WeakMap||(i=new WeakMap,w[y]=i),n=i.get(e),n instanceof w||(n=new w(w.assert(w.getObjectSettings(t))),i.set(e,n))}return n}static extendRuntimeSettings(){return w.getRuntimeSettings().extend()}}function E(e,t){for(const n in e)t(n,e[n])}function b(e,t,n,i){return!!function(e){let t,n,i;if("string"!=typeof e||(t=e.length-1)<0)return!1;i=-1;for(;(n=e.indexOf(".",i+1))>=0;){if(n-i<2||n===t)return!1;i=n}return!0}(t)&&(x(n)?function(e,t,n,i){let r;if(i.has(n))return b(e,t,null,i);i.add(n),r=0;for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(b(e,0===o.length?t:`${t}.${o}`,n[o],i)||++r);return i.delete(n),0===r}(e,t,n,i instanceof WeakSet?i:new WeakSet):(e[t]=n,!0))}function x(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function C(e,t,n){const i=t.indexOf(".");if(i>=0){const r=t.slice(0,i);let o=e[r];if("object"!=typeof o||null===o){const t=o;o={},void 0!==t&&(o[""]=t),e[r]=o}C(o,t.slice(i+1,t.length),n)}else e[t]=n}w.getDefaultSettings().set("useCursors",!0);var I=n(39561),S=n(80068),D=n(98181),A=(n(36822),n(49035)),T=n(69372),N=(n(55500),n(55509),n(98834))},59693:(e,t,n)=>{"use strict";n.d(t,{lk:()=>h,D0:()=>m,LH:()=>p,G_:()=>g,Dh:()=>f,a:()=>v});n(39536),n(74268);var i=n(99178),r=n(31749),o=n(24743);const a=class{constructor(){this.workerRegistry={},this.workerPoolManager=new o.R("webworker")}registerWorker(e,t,n={}){const{maxWorkerInstances:r=1,overwrite:o=!1,autoTerminateOnIdle:a={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!o)return void console.warn(`Worker type '${e}' is already registered...`);o&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:a.enabled,idleCheckIntervalId:null,idleTimeThreshold:a.idleTimeThreshold};s.loadCounters=Array(r).fill(0),s.lastActiveTime=Array(r).fill(null);for(let e=0;e<r;e++){const e=t();s.instances.push(i.LV(e)),s.nativeWorkers.push(e),s.workerFn=t}this.workerRegistry[e]=s}getNextWorkerAPI(e){const t=this.workerRegistry[e];if(!t)return console.error(`Worker type '${e}' is not registered.`),null;const n=t.instances.filter(e=>null!==e);let r=0,o=t.loadCounters[0]||0;for(let e=1;e<n.length;e++){const n=t.loadCounters[e]||0;n<o&&(r=e,o=n)}if(null===t.instances[r]){const e=t.workerFn();t.instances[r]=i.LV(e),t.nativeWorkers[r]=e}return t.loadCounters[r]+=1,{api:t.instances[r],index:r}}executeTask(e,t,n={},{requestType:o=r.RequestType.Compute,priority:a=0,options:s={},callbacks:l=[]}={}){return new Promise((r,c)=>{this.workerPoolManager.addRequest(async()=>{const{api:o,index:a}=this.getNextWorkerAPI(e);if(!o){const t=new Error(`No available worker instance for '${e}'`);return console.error(t),void c(t)}try{let s=[];l.length&&(s=l.map(e=>i.BX(e)));const c=this.workerRegistry[e];c.processing=!0;const u=await o[t](n,...s);c.processing=!1,c.lastActiveTime[a]=Date.now(),c.autoTerminateOnIdle&&!c.idleCheckIntervalId&&c.idleTimeThreshold&&(c.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,c.idleTimeThreshold)},c.idleTimeThreshold)),r(u)}catch(n){console.error(`Error executing method '${t}' on worker '${e}':`,n),c(n)}finally{this.workerRegistry[e].loadCounters[a]--}},o,s,a)})}terminateIdleWorkers(e,t){const n=this.workerRegistry[e];if(n.processing)return;const i=Date.now();n.instances.forEach((r,o)=>{const a=n.lastActiveTime[o];!(null!==a&&n.loadCounters[o]>0)&&i-a>t&&this.terminateWorkerInstance(e,o)})}terminate(e){const t=this.workerRegistry[e];t?t.instances.forEach((t,n)=>{this.terminateWorkerInstance(e,n)}):console.error(`Worker type '${e}' is not registered.`)}terminateWorkerInstance(e,t){const n=this.workerRegistry[e],r=n.instances[t];null!==r&&(r[i.A2](),n.nativeWorkers[t].terminate(),n.instances[t]=null,n.lastActiveTime[t]=null)}};let s=!1;const l={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0},peerImport:e=>null};let c={...l,rendering:{...l.rendering}},u=null;function d(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function h(){return!d()}function p(){return c.rendering.useCPURendering}function f(){return s}function m(){return c}function g(){return u||(u=new a),u}function v(e){return c.peerImport(e)}},98181:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createAndCacheGeometry:()=>y,loadAndCacheGeometry:()=>v,loadGeometry:()=>g,registerGeometryLoader:()=>_,registerUnknownGeometryLoader:()=>w});n(98455);var i=n(49038),r=n(31749);const o=class{constructor(e){const{points:t,type:n}=e.data;this.id=e.id,this._points=t,this._type=n,this._color=e.color,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return 3*this._points.length}get points(){return this._points}set points(e){this._points=e}get color(){return this._color}set color(e){this._color=e}get type(){return this._type}set type(e){this._type=e}get segmentIndex(){return this._segmentIndex}set segmentIndex(e){this._segmentIndex=e}get flatPointsArray(){return this._points.map(e=>[...e]).flat()}};class a{constructor(e){this._color=[200,0,0],this.id=e.id,this._contours=[],this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(e=>{const{points:t,type:n,color:i}=e,r=new o({id:`${this.id}-segment-${this._segmentIndex}`,data:{points:t,type:n,segmentIndex:this._segmentIndex,color:i??this._color},segmentIndex:this._segmentIndex,color:i??this._color});this._contours.push(r)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.totalNumberOfPoints,t=this.flatPointsArray,n=t.reduce((e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],[0,0,0]),i=[n[0]/e,n[1]/e,n[2]/e],r=t.reduce((e,t)=>this._getDistance(i,t)<this._getDistance(i,e)?t:e,t[0]);this._centroid=r}_getSizeInBytes(){return this._contours.reduce((e,t)=>e+t.sizeInBytes,0)}_getDistance(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}get centroid(){return this._centroid}get segmentIndex(){return this._segmentIndex}get color(){return this._color}set color(e){this._color=e,this._contours.forEach(t=>{t instanceof o&&(t.color=e)})}get contours(){return this._contours}get flatPointsArray(){return this._contours.flatMap(e=>e.points)}get numberOfContours(){return this._contours.length}get totalNumberOfPoints(){return this._contours.reduce((e,t)=>e+t.points.length,0)}get numberOfPointsArray(){return this._contours.map(e=>e.points.length)}getPointsInContour(e){return this._contours[e].points}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}}function s(e,t){!function(e){if(!e||0===e.data.length)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!e.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!e.data||!Array.isArray(e.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");e.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(e=>{if(!e||!Array.isArray(e)||3!==e.length)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}(t);const n=new a({id:t.id,data:t.data,color:t.color,frameOfReferenceUID:t.frameOfReferenceUID,segmentIndex:t.segmentIndex??1});return{id:e,type:r.GeometryType.CONTOUR,data:n,sizeInBytes:n.sizeInBytes}}var l=n(90808);function c(e,t){!function(e){if(!e.id)throw new Error("Surface must have an id");if(0===e.points?.length)throw new Error("Surface must have non-empty points array");if(0===e.polys?.length)throw new Error("Surface must have non-empty polys array");if(!e.frameOfReferenceUID)throw new Error("Surface must have a frameOfReferenceUID")}(t);const n=new l.u({id:t.id,points:t.points,polys:t.polys,color:t.color,frameOfReferenceUID:t.frameOfReferenceUID,segmentIndex:t.segmentIndex??1});return{id:e,type:r.GeometryType.SURFACE,data:n,sizeInBytes:n.sizeInBytes}}var u=n(32643),d=n(10364),h=n(69372);const p={};let f;function m(e,t){const n=e.indexOf(":"),i=e.substring(0,n);let r=p[i];if(null==r){if(null==f||"function"!=typeof f)throw new Error(`No geometry loader for scheme ${i} has been registered`);r=f}const o=r(e,t);return o.promise.then(function(e){(0,h.A)(d.A,u.A.GEOMETRY_LOADED,{geometry:e})},function(t){const n={geometryId:e,error:t};(0,h.A)(d.A,u.A.GEOMETRY_LOADED_FAILED,n)}),o}function g(e,t){if(void 0===e)throw new Error("loadGeometry: parameter geometryId must not be undefined");let n=i.Ay.getGeometryLoadObject(e);return void 0!==n||(n=m(e,t)),n.promise}async function v(e,t){if(void 0===e)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let n=i.Ay.getGeometryLoadObject(e);return void 0!==n||(n=m(e,t),await i.Ay.putGeometryLoadObject(e,n)),n.promise}function y(e,t){if(void 0===e)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let n=i.Ay.getGeometry(e);if(n)return n;if(t.type===r.GeometryType.CONTOUR)n=s(e,t.geometryData);else{if(t.type!==r.GeometryType.SURFACE)throw new Error("Unknown geometry type");n=c(e,t.geometryData)}return i.Ay.putGeometrySync(e,n),n}function _(e,t){p[e]=t}function w(e){const t=f;return f=e,t}},80068:(e,t,n)=>{"use strict";n.r(t),n.d(t,{cancelLoadAll:()=>I,cancelLoadImage:()=>x,cancelLoadImages:()=>C,createAndCacheDerivedImage:()=>w,createAndCacheDerivedImages:()=>E,createAndCacheDerivedLabelmapImage:()=>N,createAndCacheDerivedLabelmapImages:()=>T,createAndCacheLocalImage:()=>b,loadAndCacheImage:()=>y,loadAndCacheImages:()=>_,loadImage:()=>v,registerImageLoader:()=>S,registerUnknownImageLoader:()=>D,unregisterAllImageLoaders:()=>A});var i=n(49038),r=n(32643),o=n(10364),a=n(27119),s=n(99576),l=n(69372),c=n(80221),u=n(24623),d=n(51159),h=n(74876);const p={};let f;function m(e,t){const n=i.Ay.getImageLoadObject(e);if(n)return g(n.promise,e),n;const r=e.split(":")[0],o=p[r]||f;if(!o)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const a=o(e,t);return g(a.promise,e),a}function g(e,t){Promise.resolve(e).then(e=>{!function(e){if(!e.voxelManager){const{width:t,height:n,numberOfComponents:i}=e,r=u.A.createImageVoxelManager({scalarData:e.getPixelData(),width:t,height:n,numberOfComponents:i});e.voxelManager=r,e.getPixelData=()=>r.getScalarData(),delete e.imageFrame.pixelData}}(e),(0,l.A)(o.A,r.A.IMAGE_LOADED,{image:e})}).catch(e=>{const n={imageId:t,error:e};(0,l.A)(o.A,r.A.IMAGE_LOAD_FAILED,n)})}function v(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return m(e,t).promise}function y(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=m(e,t);return i.Ay.getImageLoadObject(e)||i.Ay.putImageLoadObject(e,n),n.promise}function _(e,t={priority:0,requestType:"prefetch"}){if(!e||0===e.length)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return e.map(e=>y(e,t))}function w(e,t={}){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,c.A)()}`);const{imageId:n,skipCreateBuffer:r,onCacheAdd:o}=t,l=h.get("imagePlaneModule",e),u=l.rows*l.columns,{TypedArrayConstructor:d}=(0,s.h)(t.targetBuffer?.type,u),p=new d(r?1:u),f=n,m=h.get("imagePlaneModule",e);a.A.add(f,{type:"imagePlaneModule",metadata:m});const g=h.get("generalSeriesModule",e);a.A.add(f,{type:"generalSeriesModule",metadata:g}),a.A.add(f,{type:"generalImageModule",metadata:{instanceNumber:t.instanceNumber}});const v=h.get("imagePixelModule",e);a.A.add(f,{type:"imagePixelModule",metadata:{...v,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const y=b(n,{scalarData:p,onCacheAdd:o,skipCreateBuffer:r,targetBuffer:{type:p.constructor.name},dimensions:[l.columns,l.rows],spacing:[l.columnPixelSpacing,l.rowPixelSpacing],origin:l.imagePositionPatient,direction:l.imageOrientationPatient,frameOfReferenceUID:l.frameOfReferenceUID});return y.referencedImageId=e,i.Ay.getImageLoadObject(n)||i.Ay.putImageSync(n,y),y}function E(e,t={}){if(0===e.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[];return e.map((e,i)=>{const r={imageId:t?.getDerivedImageId?.(e)||`derived:${(0,c.A)()}`,...t};return n.push(r.imageId),w(e,{...r,instanceNumber:i+1})})}function b(e,t){const{scalarData:n,origin:r,direction:o,targetBuffer:l,skipCreateBuffer:c,onCacheAdd:d,frameOfReferenceUID:h}=t,p=t.dimensions,f=t.spacing;if(!p||!f)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const m=p[0],g=p[1],v=f[0],y=f[1],_={frameOfReferenceUID:h,rows:g,columns:m,imageOrientationPatient:o??[1,0,0,0,1,0],rowCosines:o?o.slice(0,3):[1,0,0],columnCosines:o?o.slice(3,6):[0,1,0],imagePositionPatient:r??[0,0,0],pixelSpacing:[y,v],rowPixelSpacing:y,columnPixelSpacing:v},w=m*g,E=n.length/w;let b,x,C,I;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");b=n}else if(!c){const{numBytes:e,TypedArrayConstructor:t}=(0,s.h)(l?.type,w);b=new t(w)}if(b instanceof Uint8Array)x=8,C=8,I=7;else if(b instanceof Uint16Array)x=16,C=16,I=15;else if(b instanceof Int16Array)x=16,C=16,I=15;else{if(!(b instanceof Float32Array))throw new Error("Unsupported scalarData type");x=32,C=32,I=31}const S={samplesPerPixel:1,photometricInterpretation:b.length>p[0]*p[1]?"RGB":"MONOCHROME2",rows:g,columns:m,bitsAllocated:x,bitsStored:C,highBit:I},D={imagePlaneModule:_,imagePixelModule:S};["imagePlaneModule","imagePixelModule"].forEach(t=>{a.A.add(e,{type:t,metadata:D[t]||{}})});const A=u.A.createImageVoxelManager({height:g,width:m,numberOfComponents:E,scalarData:b});let T=b[0],N=b[0];for(let e=1;e<b.length;e++)b[e]<T&&(T=b[e]),b[e]>N&&(N=b[e]);const O={imageId:e,intercept:0,windowCenter:0,windowWidth:0,color:"RGB"===S.photometricInterpretation,numberOfComponents:S.samplesPerPixel,dataType:l?.type,slope:1,minPixelValue:T,maxPixelValue:N,rows:S.rows,columns:S.columns,getCanvas:void 0,height:S.rows,width:S.columns,rgba:void 0,columnPixelSpacing:_.columnPixelSpacing,rowPixelSpacing:_.rowPixelSpacing,FrameOfReferenceUID:_.frameOfReferenceUID,invert:!1,getPixelData:()=>A.getScalarData(),voxelManager:A,sizeInBytes:n.byteLength};return d?.(O),i.Ay.putImageSync(O.imageId,O),O}function x(e){d.A.filterRequests(({additionalDetails:t})=>!t.imageId||t.imageId!==e);const t=i.Ay.getImageLoadObject(e);t&&t.cancelFn()}function C(e){e.forEach(e=>{x(e)})}function I(){const e=d.A.getRequestPool();Object.keys(e).forEach(t=>{const n=e[t];Object.keys(n).forEach(e=>{const t=n[e].pop().additionalDetails,{imageId:r,volumeId:o}=t;let a;r?a=i.Ay.getImageLoadObject(r):o&&(a=i.Ay.getVolumeLoadObject(o)),a&&a.cancel()}),d.A.clearRequestStack(t)})}function S(e,t){p[e]=t}function D(e){const t=f;return f=e,t}function A(){Object.keys(p).forEach(e=>delete p[e]),f=void 0}function T(e,t={}){return E(e,{...t,targetBuffer:{type:"Uint8Array"}})}function N(e,t={}){return w(e,{...t,targetBuffer:{type:"Uint8Array"}})}},39561:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createAndCacheDerivedLabelmapVolume:()=>S,createAndCacheDerivedVolume:()=>y,createAndCacheVolume:()=>v,createAndCacheVolumeFromImages:()=>_,createAndCacheVolumeFromImagesSync:()=>w,createLocalLabelmapVolume:()=>D,createLocalVolume:()=>E,getUnknownVolumeLoaderSchema:()=>I,getVolumeLoaderSchemes:()=>x,loadVolume:()=>g,registerUnknownVolumeLoader:()=>C,registerVolumeLoader:()=>b});n(7742);var i=n(86252),r=n(49038),o=n(32643),a=n(10364),s=n(69372),l=n(80221),c=n(24623),u=n(80068),d=n(9734),h=n(55500);const p={};let f=h.F;function m(e,t){const n=e.indexOf(":"),i=e.substring(0,n);let r=p[i];if(null==r){if(null==f||"function"!=typeof f)throw new Error(`No volume loader for scheme ${i} has been registered`);r=f}const l=r(e,t);return l.promise.then(function(e){(0,s.A)(a.A,o.A.VOLUME_LOADED,{volume:e})},function(t){const n={volumeId:e,error:t};(0,s.A)(a.A,o.A.VOLUME_LOADED_FAILED,n)}),l}function g(e,t={imageIds:[]}){if(void 0===e)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=r.Ay.getVolumeLoadObject(e);return void 0!==n?n.promise:(n=m(e,t),n.promise.then(e=>e))}async function v(e,t){if(void 0===e)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=r.Ay.getVolumeLoadObject(e);return void 0!==n||(n=m(e,t),r.Ay.putVolumeLoadObject(e,n)),n.promise}function y(e,t){const n=r.Ay.getVolume(e);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${e} does not exist.`);let{volumeId:o}=t;void 0===o&&(o=(0,l.A)());const{metadata:a,dimensions:s,spacing:c,origin:d,direction:h}=n,p=n.isDynamicVolume()?n.getCurrentTimePointImageIds():n.imageIds??[],f=(0,u.createAndCacheDerivedImages)(p,{targetBuffer:t.targetBuffer}),m=f[0].dataType,g=f.map(e=>e.imageId),v=new i.Q({volumeId:o,dataType:m,metadata:structuredClone(a),dimensions:[s[0],s[1],s[2]],spacing:c,origin:d,direction:h,referencedVolumeId:e,imageIds:g,referencedImageIds:n.imageIds??[]});return r.Ay.putVolumeSync(o,v),v}async function _(e,t){if(void 0===t)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(void 0===e)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const n=r.Ay.getVolume(e);if(n)return n;if(0===t.filter(e=>!r.Ay.getImage(e)).length)return w(e,t);return await v(e,{imageIds:t})}function w(e,t){if(void 0===t)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(void 0===e)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const n=r.Ay.getVolume(e);if(n)return n;const o=(0,d.D)(t,e),a=new i.Q({volumeId:e,dataType:o.dataType,metadata:structuredClone(o.metadata),dimensions:o.dimensions,spacing:o.spacing,origin:o.origin,direction:o.direction,referencedVolumeId:o.referencedVolumeId,imageIds:o.imageIds,referencedImageIds:o.referencedImageIds});return r.Ay.putVolumeSync(e,a),a}function E(e,t={}){const{metadata:n,dimensions:o,spacing:a,origin:s,direction:l,scalarData:d,targetBuffer:h,preventCache:p=!1}=t,f=r.Ay.getVolume(e);if(f)return f;const m=o[0]*o[1],g=d?d.constructor.name:h?.type??"Float32Array",v=m*o[2];let y;switch(g){case"Uint8Array":case"Int8Array":y=v;break;case"Uint16Array":case"Int16Array":y=2*v;break;case"Float32Array":y=4*v}if(!r.Ay.isCacheable(y))throw new Error(`Cannot created derived volume: Volume with id ${e} is not cacheable.`);const _=[],w=[];for(let t=0;t<o[2];t++){const n=`${e}_slice_${t}`;_.push(n);const i=d.subarray(t*m,(t+1)*m),r=(0,u.createAndCacheLocalImage)(n,{scalarData:i,dimensions:[o[0],o[1]],spacing:[a[0],a[1]],origin:s,direction:l,targetBuffer:{type:g}});w.push(r)}const E=new i.Q({volumeId:e,metadata:structuredClone(n),dimensions:[o[0],o[1],o[2]],spacing:a,origin:s,direction:l,imageIds:_,dataType:g}),b=c.A.createImageVolumeVoxelManager({imageIds:_,dimensions:o,numberOfComponents:1});return E.voxelManager=b,p||r.Ay.putVolumeSync(e,E),E}function b(e,t){p[e]=t}function x(){return Object.keys(p)}function C(e){const t=f;return f=e,t}function I(){return f.name}function S(e,t={}){return y(e,{...t,targetBuffer:{type:"Uint8Array"}})}function D(e,t,n=!1){return e.scalarData||(e.scalarData=new Uint8Array(e.dimensions[0]*e.dimensions[1]*e.dimensions[2])),E(t,{...e,preventCache:n})}},22191:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});class i{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const t=new i("as iterator");return e.then(e=>{try{t.add(e,!0)}catch(e){t.reject(e)}},e=>{t.reject(e)}),t}add(e,t=!1){this.nextValue=e,this.done||=t,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(void 0!==this.nextValue&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,t)=>{this.waiting.resolve=e,this.waiting.reject=t})),await this.waiting.promise}yield this.nextValue}async forEach(e,t){let n=0;try{for await(const i of this){const{done:r}=this;try{await e(i,r,n),n++}catch(e){if(!r){console.warn("Caught exception in intermediate value",e);continue}if(!t)throw e;t(e,r)}}}catch(e){if(!t)throw e;t(e,!0)}}generate(e,t){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},e=>{this.reject(e),t?t(e):console.warn("Couldn't process because",e)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}}},67645:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});class i{constructor(e,t,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numberOfComponents=1,this.defaultValue=0,this.pixelDataConstructor=Uint8Array,this.get=e=>{const t=e%this.jMultiple,n=(e-t)/this.jMultiple,i=this.getRLE(t,n);return i?.value||this.defaultValue},this.getRun=(e,t)=>{const n=e+t*this.height;return this.rows.get(n)},this.set=(e,t)=>{if(void 0===t)throw new Error("Can't set undefined at "+e%this.width);const n=e%this.width,i=(e-n)/this.width,r=this.rows.get(i);if(!r)return void this.rows.set(i,[{start:n,end:n+1,value:t}]);const o=this.findIndex(r,n),a=r[o],s=r[o-1];if(!a)return s&&s.value===t&&s.end===n?void s.end++:void(r[o]={start:n,end:n+1,value:t});const{start:l,end:c,value:u}=a;if(t===u&&n>=l)return;const d={start:n,end:n+1,value:t},h=n>l,p=h?o+1:o,f=h?a:s;let m=h?r[o+1]:a;if(f?.value===t&&f.end===n)return f.end++,void(m?.value===t&&m.start===n+1?(f.end=m.end,r.splice(o,1)):m?.start===n&&(m.start++,m.start===m.end&&(r.splice(o,1),m=r[o],m?.start===n+1&&m.value===t&&(f.end=m.end,r.splice(o,1)))));if(m?.value===t&&m.start===n+1)return m.start--,void(f?.end>n&&(f.end=n,f.end===f.start&&r.splice(o,1)));if(m?.start===n&&m.end===n+1){m.value=t;const e=r[o+1];return void(e?.start==n+1&&e?.value===t&&(r.splice(o+1,1),m.end=e.end))}n===m?.start&&m.start++,h&&c>n+1?r.splice(p,0,d,{start:n+1,end:f.end,value:f.value}):r.splice(p,0,d),f?.end>n&&(f.end=n)},this.width=e,this.height=t,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*t}getRLE(e,t,n=0){const i=this.rows.get(t+n*this.height);if(!i)return;const r=i[this.findIndex(i,e)];return e>=r?.start?r:void 0}findIndex(e,t){for(let n=0;n<e.length;n++){const{end:i}=e[n];if(t<i)return n}return e.length}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,t){t?t.fill(0):t=new this.pixelDataConstructor(this.width*this.height*this.numberOfComponents);const{width:n,height:i,numberOfComponents:r}=this;for(let o=0;o<i;o++){const i=this.getRun(o,e);if(i)if(1===r)for(const e of i){const i=o*n,{start:r,end:a,value:s}=e;for(let e=r;e<a;e++)t[i+e]=s}else for(const e of i){const i=o*n*r,{start:a,end:s,value:l}=e;for(let e=a;e<s;e+=r)for(let n=0;n<r;n++)t[i+e+n]=l[n]}}return t}}},98039:(e,t,n)=>{"use strict";function i(e){return r(e,"vtkVolume")||r(e,"vtkImageSlice")}function r(e,t){return!!("isA"in e?e:e.actor).isA(t)}n.d(t,{N:()=>r,e:()=>i})},96833:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(33739),r=n(99341);function o(e,t){const n=t.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:o}=function(e){let t=1/0,n=-1/0;for(let i=0;i<e.length;i+=4)t=Math.min(t,e[i]),n=Math.max(n,e[i]);const i=(n-t)/2;return{shiftRange:[-i,i],min:t,max:n}}(n),a=o[0],s=o[1]-o[0],l=i.Ay.newInstance(),c=[];for(let e=0;e<n.length;e+=4){let t=n[e];const i=n[e+1],r=n[e+2],o=n[e+3];t=(t-a)/s,c.push([t,i,r,o])}!function(e,t,n){const i=t[1]-t[0],r=e.map(([e,n,r,o])=>[e*i+t[0],n,r,o]);n.removeAllPoints(),r.forEach(([e,t,i,r])=>n.addRGBPoint(e,t,i,r))}(c,o,l),e.getProperty().setRGBTransferFunction(0,l);const u=t.scalarOpacity.split(" ").splice(1).map(parseFloat),d=r.Ay.newInstance(),h=[];for(let e=0;e<u.length;e+=2){let t=u[e];const n=u[e+1];t=(t-a)/s,h.push([t,n])}!function(e,t,n){const i=t[1]-t[0],r=e.map(([e,n])=>[e*i+t[0],n]);n.removeAllPoints(),r.forEach(([e,t])=>n.addPoint(e,t))}(h,o,d);const p=e.getProperty();p.setScalarOpacity(0,d);const[f,m,g,v]=t.gradientOpacity.split(" ").splice(1).map(parseFloat);p.setUseGradientOpacity(0,!0),p.setGradientOpacityMinimumValue(0,f),p.setGradientOpacityMinimumOpacity(0,m),p.setGradientOpacityMaximumValue(0,g),p.setGradientOpacityMaximumOpacity(0,v),"1"===t.interpolation&&p.setInterpolationTypeToFastLinear(),p.setShade("1"===t.shade);const y=parseFloat(t.ambient),_=parseFloat(t.diffuse),w=parseFloat(t.specular),E=parseFloat(t.specularPower);p.setAmbient(y),p.setDiffuse(_),p.setSpecular(w),p.setSpecularPower(E)}},91979:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(39536),r=n(24724);const o=e=>{const t=function(e){const t=(0,i.qO)(),n=[];return t.forEach(t=>{const i=(0,r.A)(e);i.length&&n.push({renderingEngine:t,viewportIds:i.map(e=>e.id)})}),n}(e);t?.length&&t.forEach(({renderingEngine:e,viewportIds:t})=>{e.hasBeenDestroyed||e.renderViewports(t)})}},84061:(e,t,n)=>{"use strict";function i(e,t,n){return Math.max(t,Math.min(n,e))}n.d(t,{A:()=>i,q:()=>i})},13859:(e,t,n)=>{"use strict";n.r(t),n.d(t,{findMatchingColormap:()=>u,getColormap:()=>l,getColormapNames:()=>c,registerColormap:()=>s});var i=n(50761),r=n(74638),o=n(98039);const a=new Map;function s(e){a.set(e.Name,e)}function l(e){return a.get(e)}function c(){return Array.from(a.keys())}function u(e,t){const n=i.A.rgbPresetNames.map(e=>i.A.getPresetByName(e)),a=c().map(e=>l(e)),s=n.concat(a).find(t=>{const{RGBPoints:n}=t;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=4)if(!(0,r.Ay)(n.slice(t+1,t+4),e.slice(t+1,t+4)))return!1;return!0});if(!s)return null;const u=[];if((0,o.N)(t,"vtkVolume")){const e=t.getProperty().getScalarOpacity(0).getDataPointer();if(!e)return{name:s.Name};for(let t=0;t<e.length;t+=2)u.push({value:e[t],opacity:e[t+1]})}return{name:s.Name,opacity:u}}},74657:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(33739);function r(e){const t=i.Ay.newInstance();let n=0,r=1024;return void 0!==e.lower&&void 0!==e.upper&&(n=e.lower,r=e.upper),t.addRGBPoint(n,0,0,0),t.addRGBPoint(r,1,1,1),t}},40256:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(33739),r=n(42008),o=n(68136);function a(e,t=1024){const{windowWidth:n,windowCenter:a}=o.toWindowLevel(e.lower,e.upper),s=Array.from({length:t},(e,n)=>(n+1)/(t+2)).flatMap(e=>{const t=((e,t,n)=>t-n/4*Math.log((1-e)/e))(e,a,n);return[t,e,e,e,.5,0]}),l=i.Ay.newInstance();return l.buildFunctionFromArray(r.Ay.newInstance({values:s,numberOfComponents:6})),l}},63470:(e,t,n)=>{"use strict";function i(e,t,n=0){const i=[];for(let r=n;r<e.length;r+=t)i.push(r);return i}n.d(t,{A:()=>i})},99949:(e,t,n)=>{"use strict";function i(e){if(null===e||"object"!=typeof e)return e;if("function"==typeof e)return e;if("function"==typeof structuredClone)return e;if(Array.isArray(e))return e.map(i);{const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=i(e[n]));return t}}n.d(t,{G:()=>i})},88619:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(3823),r=n(74876),o=n(85008),a=n(19325);function s(e,t,n){const{direction:s,spacing:l,imageIds:c}=e;if(!c.length)return;const u=s.slice(6,9),d=i.eR.dot(u,n);if(Math.abs(d)<1-a.EPSILON)return;const h=(0,o.A)({direction:s,spacing:l},n)/2;let p;for(let e=0;e<c.length;e++){const o=c[e],{imagePositionPatient:a}=r.get("imagePlaneModule",o),s=i.eR.create();i.eR.sub(s,t,a);const l=i.eR.dot(s,n);Math.abs(l)<h&&(p=o)}return p}},47476:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(20537),r=n(65292);const o=function(e){const t=e.getCamera(),{spacingInNormalDirection:n,imageVolume:o}=(0,r.A)(e,t);if(!o)return;const{viewPlaneNormal:a,focalPoint:s}=t,l=e.getActors().find(e=>e.referencedId===o.volumeId||e.uid===o.volumeId);l||console.warn("No actor found for with actorUID of",o.volumeId);const c=l.actor,u=(0,i.A)(c,a,s),{min:d,max:h,current:p}=u,f=Math.round((h-d)/n)+1;let m=(p-d)/(h-d)*f;return m=Math.floor(m),m>f-1?m=f-1:m<0&&(m=0),{numberOfSlices:f,imageIndex:m}}},25308:(e,t,n)=>{"use strict";function i(e){let t,n=e[0],i=e[0];const r=e.length;for(let o=1;o<r;o++)t=e[o],n=Math.min(n,t),i=Math.max(i,t);return{min:n,max:i}}n.d(t,{A:()=>i})},32173:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(74876);function r(e){const t=i.get("modalityLutModule",e)||{},n=i.get("generalSeriesModule",e)||{},{modality:r}=n,o={rescaleSlope:t.rescaleSlope||1,rescaleIntercept:t.rescaleIntercept??0,modality:r},a=i.get("scalingModule",e)||{};return{...o,..."PT"===r&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm}}}},20537:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var i=n(89265),r=n(15105),o=n(19325);const a=o.EPSILON*o.EPSILON,s=e=>Math.abs(Math.abs(e)-1)<a,l=(e,t)=>s(e[t])||s(e[t+1])||s(e[t+2]),c=e=>l(e,0)&&l(e,3)&&l(e,6);function u(e,t,n){const o=e.getMapper().getInputData();let a;const s=o.getDirection();if(c(s))a=(0,r.A)(e);else{const[e,t,n]=o.getDimensions();a=[[0,0,0],[e-1,0,0],[0,t-1,0],[e-1,t-1,0],[0,0,n-1],[e-1,0,n-1],[0,t-1,n-1],[e-1,t-1,n-1]].map(e=>o.indexToWorld(e))}const l=i.A.buildFromDegree().identity().rotateFromDirections(t,[1,0,0]);a.forEach(e=>l.apply(e));const u=[...n];l.apply(u);const d=u[0];let h=1/0,p=-1/0;for(let e=0;e<8;e++){const t=a[e][0];t>p&&(p=t),t<h&&(h=t)}return{min:h,max:p,current:d,actor:e,viewPlaneNormal:t,focalPoint:n}}},85008:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(3823);function r(e,t){const{direction:n,spacing:r}=e,o=n.slice(0,3),a=n.slice(3,6),s=n.slice(6,9),l=[i.eR.dot(o,t),i.eR.dot(a,t),i.eR.dot(s,t)],c=i.eR.create();i.eR.set(c,l[0]*r[0],l[1]*r[1],l[2]*r[2]);return i.eR.length(c)}},65292:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var i=n(49038),r=n(19325),o=n(85008),a=n(39561),s=n(12437);const l=1+r.EPSILON,c=e=>!!(0,a.getVolumeLoaderSchemes)().find(t=>{return n=e.volumeId,(i=t)===n.substring(0,Math.min(n.length,i.length));var n,i});function u(e,t,n,r=!1){const{viewPlaneNormal:o}=t,a=e.getActors();if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const u=a.map(e=>{const t=e.referencedId??e.uid;return i.Ay.getVolume(t)}).filter(e=>!!e);if(n){const t=(0,s.A)(n),i=u.findIndex(e=>t.includes(e.volumeId)),l=u[i],{uid:c}=a[i];return{imageVolume:l,spacingInNormalDirection:d(l,o,e,r),actorUID:c}}if(!u.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const h={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},p=u.find(c);for(let t=0;t<u.length;t++){const n=u[t];if(p&&!c(n))continue;const i=d(n,o,e);i*l<h.spacingInNormalDirection&&(h.spacingInNormalDirection=i,h.imageVolume=n,h.actorUID=a[t].uid)}return h}function d(e,t,n,i=!1){const{slabThickness:r}=n.getProperties();let a=r;return r&&i||(a=(0,o.A)(e,t)),a}},24724:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(39536);const r=function(e){const t=(0,i.qO)(),n=[];return t.forEach(t=>{const i=t.getVolumeViewports().filter(t=>t.hasVolumeId(e));n.push(...i)}),n}},70210:(e,t,n)=>{"use strict";function i(e){let t=[];const[n,i]=e.getRange();e.getTable(n,i,1024,t),t=t.filter((e,t)=>t%3==0);const r=[...Array(1024).keys()].map((e,t)=>n+(i-n)/1023*t),o=t[256],a=Math.log((1-o)/o),s=r[256],l=t[768],c=Math.log((1-l)/l),u=r[768],d=Math.round(4*(u-s)/(a-c)),h=Math.round(s+d*a/4);return[Math.round(h-d/2),Math.round(h+d/2)]}n.d(t,{A:()=>i})},15105:(e,t,n)=>{"use strict";function i(e){const t=e.getMapper().getInputData(),n=t.extentToBounds(t.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}n.d(t,{A:()=>i})},12437:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=e=>{const t="volumeId:",n=e.includes(t)?e.substring(9):e,i=n.indexOf("sliceIndex=");return-1===i?n:n.substring(0,i-1)}},4031:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(20537),r=n(65292);const o=function(e,t,n=!1){const o=e.getCamera(),{focalPoint:a,viewPlaneNormal:s}=o,{spacingInNormalDirection:l,actorUID:c}=(0,r.A)(e,o,t,n);if(!c)throw new Error(`Could not find image volume with id ${t} in the viewport`);const u=e.getActor(c);if(!u)return console.warn("No actor found for with actorUID of",c),null;const d=u.actor;return{sliceRange:(0,i.A)(d,s,a),spacingInNormalDirection:l,camera:o}}},61375:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(4031);const r=function(e,t,n=!1){const{sliceRange:r,spacingInNormalDirection:o,camera:a}=(0,i.A)(e,t,n),{min:s,max:l,current:c}=r,u=Math.round((l-s)/o),d=(c-s)/(l-s)*u;return{numScrollSteps:u,currentStepIndex:Math.round(d),sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:o,camera:a}}}},30169:(e,t,n)=>{"use strict";n.d(t,{a:()=>i});const i=e=>Object.values(e).some(e=>"number"==typeof e&&!Number.isInteger(e))},38883:(e,t,n)=>{"use strict";function i(e){return Array.isArray(e)?e.some(e=>Number.isNaN(e)):Number.isNaN(e)}n.d(t,{A:()=>i})},39537:(e,t,n)=>{"use strict";function i(e){const t=e.indexOf(":");return e.substring(t+1)}n.d(t,{A:()=>i})},17791:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(74876);const r=new Map,o="imageRetrieveConfiguration",a={IMAGE_RETRIEVE_CONFIGURATION:o,clear:()=>{r.clear()},add:(e,t)=>{r.set(e,t)},clone:()=>new Map(r),restore:e=>{r.clear(),e.forEach((e,t)=>{r.set(t,e)})},get:(e,...t)=>{if(e===o)return t.map(e=>r.get(e)).find(e=>void 0!==e)}};(0,i.addProvider)(a.get.bind(a));const s=a},49035:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PointsManager:()=>_e,ProgressiveIterator:()=>Ne.A,RLEVoxelMap:()=>He.A,VoxelManager:()=>je.A,actorIsA:()=>oe.N,applyPreset:()=>ye.A,autoLoad:()=>gt.A,calculateViewportsSpatialRegistration:()=>fe,calibratedPixelSpacingMetadataProvider:()=>x,clamp:()=>C.A,clip:()=>wt,color:()=>o,colormap:()=>tt,convertStackToVolumeViewport:()=>Be,convertToGrayscale:()=>$e,convertVolumeToStackViewport:()=>We,createLinearRGBTransferFunction:()=>d.A,createSigmoidRGBTransferFunction:()=>c.A,decimate:()=>Oe.A,deepClone:()=>yt.G,deepEqual:()=>at,deepMerge:()=>we.A,eventListener:()=>i,generateVolumePropsFromImageIds:()=>Le.D,genericMetadataProvider:()=>De.A,getBufferConfiguration:()=>Re.h,getClosestImageId:()=>D.A,getClosestStackImageIndexForPoint:()=>le,getCurrentVolumeViewportSlice:()=>ue,getDynamicVolumeInfo:()=>mt,getImageLegacy:()=>Ce,getImageSliceDataForVolumeViewport:()=>re.A,getMinMax:()=>m.A,getRandomSampleFromArray:()=>Ke,getRuntimeId:()=>w,getScalingParameters:()=>Ee.A,getSliceRange:()=>ne.A,getSpacingInNormalDirection:()=>A.A,getTargetVolumeAndSpacingInNormalDir:()=>T.A,getViewportImageCornersInWorld:()=>me,getViewportImageIds:()=>Xe,getViewportModality:()=>Ct,getViewportsWithImageURI:()=>ae,getViewportsWithVolumeId:()=>k.A,getVoiFromSigmoidRGBTransferFunction:()=>u.A,getVolumeActorCorners:()=>N.A,getVolumeId:()=>Je.A,getVolumeSliceRangeInfo:()=>ee.A,getVolumeViewportScrollInfo:()=>te.A,getVolumeViewportsContainingSameVolumes:()=>M,hasFloatScalingParameters:()=>Ze.a,hasNaNValues:()=>ve.A,imageIdToURI:()=>E.A,imageRetrieveMetadataProvider:()=>Pe.A,imageToWorldCoords:()=>Q,indexWithinDimensions:()=>O,invertRgbTransferFunction:()=>l.A,isEqual:()=>I.n4,isEqualAbs:()=>I.Ph,isEqualNegative:()=>I.WC,isImageActor:()=>oe.e,isOpposite:()=>S,isPTPrescaledWithSUV:()=>H,isValidVolume:()=>Ae,isVideoTransferSyntax:()=>ke,jumpToSlice:()=>xt,loadImageToCanvas:()=>Y,makeVolumeMetadata:()=>Se.A,planar:()=>se,pointInShapeCallback:()=>Qe.i,renderToCanvasCPU:()=>X,renderToCanvasGPU:()=>z,roundNumber:()=>qe,roundToPrecision:()=>Ge,scaleArray:()=>vt,scaleRgbTransferFunction:()=>h,scroll:()=>bt,snapFocalPointToSlice:()=>ie.A,sortImageIdsAndGetSpacing:()=>Ie.A,spatialRegistrationMetadataProvider:()=>pe,splitImageIdsBy4DTags:()=>ft,transferFunctionUtils:()=>nt,transformIndexToWorld:()=>L.A,transformWorldToIndex:()=>R.A,triggerEvent:()=>p.A,updateVTKImageDataWithCornerstoneImage:()=>Te.J,uuidv4:()=>f.A,windowLevel:()=>et,worldToImageCoords:()=>Z});var i={};n.r(i),n.d(i,{MultiTargetEventListenerManager:()=>s,TargetEventListeners:()=>a});var r,o={};n.r(o),n.d(o,{hexToRgb:()=>ot,rgbToHex:()=>rt}),function(e){e[e.None=0]="None",e[e.Capture=1]="Capture",e[e.Bubble=2]="Bubble"}(r||(r={}));class a{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return 0===this._eventListeners.size&&0===this._children.size}addEventListener(e,t,n){const i=e.indexOf(".");if(-1!==i){const r=e.substring(0,i);let o=this._children.get(r);o||(o=new a(this._target),this._children.set(r,o)),e=e.substring(i+1),o.addEventListener(e,t,n)}else this._addEventListener(e,t,n)}removeEventListener(e,t,n){const i=e.indexOf(".");if(-1!==i){const r=e.substring(0,i),o=this._children.get(r);if(!o)return;e=e.substring(i+1),o.removeEventListener(e,t,n),o.isEmpty&&this._children.delete(r)}else this._removeEventListener(e,t,n)}reset(){Array.from(this._children.entries()).forEach(([e,t])=>{if(t.reset(),!t.isEmpty)throw new Error("Child is not empty and cannot be removed");this._children.delete(e)}),this._unregisterAllEvents()}_addEventListener(e,t,n){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=n?.capture??!1?r.Capture:r.Bubble,a=i.get(t)??r.None;a&o?console.warn("A listener is already registered for this phase"):(i.set(t,a|o),this._target.addEventListener(e,t,n))}_removeEventListener(e,t,n){const i=n?.capture??!1?r.Capture:r.Bubble,o=this._eventListeners.get(e);if(!o)return;(t?[t]:Array.from(o.keys())).forEach(t=>{const a=o.get(t)??r.None;if(!!!(a&i))return;this._target.removeEventListener(e,t,n);const s=a^i;s===r.None?o.delete(t):o.set(t,s)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,t){Array.from(t.entries()).forEach(([t,n])=>{for(let i=r.Capture;n;i<<=1){if(!(n&i))continue;const o=i===r.Capture;this.removeEventListener(e,t,{capture:o}),n^=i}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,t])=>{this._unregisterAllListeners(e,t)})}}class s{constructor(){this._targetsEventListeners=new Map}addEventListener(e,t,n,i){let r=this._targetsEventListeners.get(e);r||(r=new a(e),this._targetsEventListeners.set(e,r)),r.addEventListener(t,n,i)}removeEventListener(e,t,n,i){const r=this._targetsEventListeners.get(e);r&&(r.removeEventListener(t,n,i),r.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,t])=>{t.reset(),this._targetsEventListeners.delete(e)})}}var l=n(50134),c=n(40256),u=n(70210),d=n(74657);function h(e,t){const n=e.getSize();for(let i=0;i<n;i++){const n=[];e.getNodeValue(i,n),n[1]=n[1]*t,n[2]=n[2]*t,n[3]=n[3]*t,e.setNodeValue(i,n)}}var p=n(69372),f=n(80221),m=n(25308);const g=Symbol("LastRuntimeId"),v={},y=4294967295,_="-";function w(e,t,n){return function(e,t,n){let i=e[t];i instanceof Array||(i=[0],Object.defineProperty(e,t,{value:i}));for(let e=!0,t=0;e&&t<i.length;++t){let r=0|i[t];r<n?(e=!1,r+=1):(r=0,t+1===i.length&&i.push(0)),i[t]=r}return i}(null!==e&&"object"==typeof e?e:v,g,("number"==typeof n&&n>0?n:y)>>>0).join("string"==typeof t?t:_)}var E=n(39537);const b={},x={add:(e,t)=>{const n=(0,E.A)(e);b[n]=t},get:(e,t)=>{if("calibratedPixelSpacing"===e){const e=(0,E.A)(t);return b[e]}}};var C=n(84061),I=n(74638);function S(e,t,n=1e-5){return Math.abs(e[0]+t[0])<n&&Math.abs(e[1]+t[1])<n&&Math.abs(e[2]+t[2])<n}var D=n(88619),A=n(85008),T=n(65292),N=n(15105);function O(e,t){return!(e[0]<0||e[0]>=t[0]||e[1]<0||e[1]>=t[1]||e[2]<0||e[2]>=t[2])}var P=n(39536);const M=function(e,t){let n;n=t?[(0,P.lD)(t)]:(0,P.qO)();const i=[];return n.forEach(t=>{const n=e.getActors(),r=t.getVolumeViewports();for(const e of r){const t=e.getActors();if(t.length!==n.length)continue;n.every(({uid:e})=>t.find(t=>e===t.uid))&&i.push(e)}}),i};var k=n(24724),R=n(38669),L=n(94741),F=n(80068),U=n(74876),B=n(31749),V=n(51159),W=n(30135),j=n(56706);const H=e=>e.preScale.scaled&&e.preScale.scalingParameters.suvbw;function z(e,t,n=void 0,i="_thumbnails",r={displayArea:{imageArea:[1,1]}}){if(!(e&&e instanceof HTMLCanvasElement))throw new Error("canvas element is required");const o=!t.imageId,a=!o&&t,s=o&&t,l=`renderGPUViewport-${a.imageId||s.volumeId}`,c=document.createElement("div"),u=window.devicePixelRatio||1;r.displayArea||(r.displayArea={imageArea:[1,1]});const d=e.width,h=e.height;c.style.width=`${d/u+W.p8}px`,c.style.height=`${h/u+W.p8}px`,c.style.visibility="hidden",c.style.position="absolute",document.body.appendChild(c);const p=l.split(":").join("-");c.setAttribute("viewport-id-for-remove",p);const f=(0,W.Ay)(c),m=(0,P.lD)(i)||new j.Ay(i);let g=m.getViewport(l);if(!g){const e={viewportId:l,type:o?B.ViewportType.ORTHOGRAPHIC:B.ViewportType.STACK,element:c,defaultOptions:{...r,suppressEvents:!0}};m.enableElement(e),g=m.getViewport(l)}return new Promise(i=>{let d=!1,{viewReference:h}=r;const v=t=>{if(d)return;if(h){const e=h;return h=null,g.setViewReference(e),void g.render()}e.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,e.width,e.height);const n=g.canvasToWorld([0,0]),r=g.canvasToWorld([f.width/u,0]),o=g.canvasToWorld([0,f.height/u]);d=!0,c.removeEventListener(B.Events.IMAGE_RENDERED,v),setTimeout(()=>{m.disableElement(l);document.querySelectorAll(`[viewport-id-for-remove="${p}"]`).forEach(e=>{e.remove()})},0),i({origin:n,bottomLeft:o,topRight:r,thicknessMm:1})};c.addEventListener(B.Events.IMAGE_RENDERED,v),o?g.setVolumes([s],!1,!0):g.renderImageObject(t),g.resetCamera(),"PT"!==n||H(a)||g.setProperties({voiRange:{lower:a.minPixelValue,upper:a.maxPixelValue}}),g.render()})}var G=n(36931),q=n(7808),$=n(5057);function X(e,t,n,i,r){if(t.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=t,a={canvas:e,viewport:(0,G.A)(e,o,n),image:o,renderingTools:{}};a.transform=(0,q.A)(a);return new Promise((e,t)=>{(0,$.A)(a,true),e(null)})}n(59693);var K=n(49038);function Y(e){const{canvas:t,imageId:n,viewReference:i,requestType:r=B.RequestType.Thumbnail,priority:o=-5,renderingEngineId:a="_thumbnails",useCPURendering:s=!1,thumbnail:l=!1,imageAspect:c=!1,viewportOptions:u}=e,d=i?.volumeId,h=d&&!n,p=i&&u?{...u,viewReference:i}:u,f=s?X:z;return new Promise((e,i)=>{function u(n,r){const{modality:o}=U.get("generalSeriesModule",r)||{},u=!h&&n,d=h&&n;u&&(u.isPreScaled=u.isPreScaled||u.preScale?.scaled),l&&(t.height=256,t.width=256),c&&u&&(t.width=u&&t.height*u.width/u.height),t.style.width=t.width/devicePixelRatio+"px",t.style.height=t.height/devicePixelRatio+"px",d&&s&&i(new Error("CPU rendering of volume not supported")),f(t,n,o,a,p).then(e)}function m(e,t){console.error(e,t),i(e)}const g={useRGBA:!!s,requestType:r};if(d){const e=K.Ay.getVolume(d);e||i(new Error(`Volume id ${d} not found in cache`));u(e,e.imageIds[0])}else V.A.addRequest(function(e,t,n){return(0,F.loadAndCacheImage)(e,n).then(t=>{u.call(this,t,e)},t=>{m.call(this,t,e)})}.bind(null,n,null,g),r,{imageId:n},o)})}var J=n(3823);const Z=function(e,t){const n=(0,U.get)("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:i,rowCosines:r,imagePositionPatient:o}=n;let{columnPixelSpacing:a,rowPixelSpacing:s}=n;a||=1,s||=1;const l=J.eR.create();J.eR.scaleAndAdd(l,o,i,-a/2),J.eR.scaleAndAdd(l,l,r,-s/2);const c=J.eR.create();return J.eR.sub(c,t,l),[J.eR.dot(c,r)/s,J.eR.dot(c,i)/a]};function Q(e,t){const n=(0,U.get)("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:i,rowCosines:r,imagePositionPatient:o}=n;let{columnPixelSpacing:a,rowPixelSpacing:s}=n;a||=1,s||=1;const l=J.eR.create();return J.eR.scaleAndAdd(l,o,r,s*(t[0]-.5)),J.eR.scaleAndAdd(l,l,i,a*(t[1]-.5)),Array.from(l)}var ee=n(4031),te=n(61375),ne=n(20537),ie=n(80500),re=n(47476),oe=n(98039);function ae(e){const t=(0,P.qO)(),n=[];return t.forEach(t=>{t.getViewports().forEach(t=>{t.hasImageURI(e)&&n.push(t)})}),n}var se=n(52268);function le(e,t){const n=function(e,t){const n=t.getImageIds(),i=t.getCurrentImageIdIndex();if(0===n.length)return null;const r=t=>{const n=function(e){const t=U.get("imagePlaneModule",e);if(!(t&&t.rowCosines instanceof Array&&3===t.rowCosines.length&&t.columnCosines instanceof Array&&3===t.columnCosines.length&&t.imagePositionPatient instanceof Array&&3===t.imagePositionPatient.length))return null;const{rowCosines:n,columnCosines:i,imagePositionPatient:r}=t,o=J.eR.set(J.eR.create(),...n),a=J.eR.set(J.eR.create(),...i),s=J.eR.cross(J.eR.create(),o,a);return{rowCosines:n,columnCosines:i,imagePositionPatient:r,planeNormal:s}}(t);if(!n)return null;const i=se.planeEquation(n.planeNormal,n.imagePositionPatient);return se.planeDistanceToPoint(i,e)},o={distance:r(n[i])??1/0,index:i},a=n.slice(i+1);for(let e=0;e<a.length;e++){const t=r(a[e]);if(null!==t){if(!(t<=o.distance))break;o.distance=t,o.index=e+i+1}}const s=n.slice(0,i);for(let e=s.length-1;e>=0;e--){const t=r(s[e]);if(null!==t&&t!==o.distance){if(!(t<o.distance))break;o.distance=t,o.index=e}}return o.distance===1/0?null:o}(e,t);return n?n.index:null}var ce=n(51919);function ue(e){const{width:t,height:n}=e.getCanvas(),{sliceToIndexMatrix:i,indexToSliceMatrix:r}=e.getSliceViewInfo(),o=(0,ce.e)(e,[0,0]),a=(0,ce.e)(e,[t-1,0]),s=(0,ce.e)(e,[0,n-1]),l=J.eR.sub(J.eR.create(),a,o),c=J.eR.sub(J.eR.create(),s,o),u=J.eR.cross(J.eR.create(),l,c);J.eR.normalize(l,l),J.eR.normalize(c,c),J.eR.normalize(u,u);const d=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2])),h=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]));if(!J.Fd.equals(1,d)||!J.Fd.equals(1,h))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:p}=e.getImageData(),f=e.getSliceViewInfo(),m=p.getSliceData(f);return{width:f.width,height:f.height,scalarData:m,sliceToIndexMatrix:i,indexToSliceMatrix:r}}const de={},he={add:(e,t)=>{const[n,i]=e,r=`${n}_${i}`;de[r]||(de[r]={}),de[r]=t},get:(e,t,n)=>{if("spatialRegistrationModule"!==e)return;const i=`${t}_${n}`;if(de[i])return de[i];const r=`${n}_${t}`;return de[r]?J.pB.invert(J.pB.create(),de[r]):void 0}};(0,U.addProvider)(he.get.bind(he));const pe=he;const fe=function(e,t){const n=e.getSliceIndex(),i=t.getSliceIndex(),r=(0,U.get)("imagePlaneModule",n.toString()),o=(0,U.get)("imagePlaneModule",i.toString());if(!r||!o)return void console.log("Viewport spatial registration requires image plane module");const{imageOrientationPatient:a}=o;if(!r.imageOrientationPatient.every((e,t)=>Math.abs(e-a[t])<.05))return void console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",r?.imageOrientationPatient,o?.imageOrientationPatient);const s=r.imagePositionPatient,l=o.imagePositionPatient,c=J.eR.subtract(J.eR.create(),s,l),u=J.pB.fromTranslation(J.pB.create(),c);pe.add([e.id,t.id],u)};function me(e){const{imageData:t,dimensions:n}=e.getImageData()||{};if(!t||!n)return[];const{canvas:i}=e,r=window.devicePixelRatio,o=[i.width/r,0],a=[i.width/r,i.height/r],s=[0,i.height/r],l=e.canvasToWorld([0,0]),c=e.canvasToWorld(o),u=e.canvasToWorld(a),d=e.canvasToWorld(s),h=t.worldToIndex(l),p=t.worldToIndex(c),f=t.worldToIndex(u),m=t.worldToIndex(d);return function({dimensions:e,imageData:t,topLeftImage:n,topRightImage:i,bottomRightImage:r,bottomLeftImage:o,topLeftWorld:a,topRightWorld:s,bottomRightWorld:l,bottomLeftWorld:c}){const u=ge(n,e)?a:t.indexToWorld([0,0,0]),d=ge(i,e)?s:t.indexToWorld([e[0]-1,0,0]),h=ge(r,e)?l:t.indexToWorld([e[0]-1,e[1]-1,0]),p=ge(o,e)?c:t.indexToWorld([0,e[1]-1,0]);return[u,d,p,h]}({dimensions:n,imageData:t,topLeftImage:h,topRightImage:p,bottomRightImage:f,bottomLeftImage:m,topLeftWorld:l,topRightWorld:c,bottomRightWorld:u,bottomLeftWorld:d})}function ge(e,t){return e[0]>0||e[0]<t[0]-1||e[1]>0||e[1]<t[1]-1||e[2]>0||e[2]<t[2]-1}var ve=n(38883),ye=n(96833);class _e{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:t=1024,dimensions:n=3,growSize:i=128}=e,r=t*n;this.growSize=i,this.array=new ArrayBuffer(r*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let t=0;t<this._length;t++)e(this.getPoint(t),t)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const t=this._dimensions*e;return this.data.subarray(t,t+this._dimensions)}getPointArray(e){const t=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let e=0;e<this._dimensions;e++)t.push(this.data[e+n]);return t}grow(e=1,t=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+t,i=new ArrayBuffer(n*this._dimensions*this._byteSize),r=new Float32Array(i);r.set(this.data),this.data=r,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let t=0;t<e;t++){const e=t*this._dimensions,n=(this._length-1-t)*this._dimensions;for(let t=0;t<this._dimensions;t++){const i=this.data[e+t];this.data[e+t]=this.data[n+t],this.data[n+t]=i}}}push(e){this.grow(1);const t=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+t]=e[n];this._length++}map(e){const t=[];for(let n=0;n<this._length;n++)t.push(e(this.getPoint(n),n));return t}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:t,y:n,z:i}=e;return this.forEach(e=>{t.push(e[0]),n.push(e[1]),i&&i.push(e[2])}),e}static fromXYZ({x:e,y:t,z:n}){const i=_e.create3(e.length);let r=0;for(let o=0;o<e.length;o++)i.data[r++]=e[o],i.data[r++]=t[o],i.data[r++]=n?n[o]:0;return i._length=e.length,i}subselect(e=10,t=0){const n=new _e({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const r=(t+Math.floor(this.length*i/e))%this.length;n.push(this.getPoint(r))}return n}static create3(e=128){return new _e({initialSize:e,dimensions:3})}static create2(e=128){return new _e({initialSize:e,dimensions:2})}}var we=n(74268),Ee=n(32173),be=n(58165),xe=n(86846);const Ce=function(e){const t=(0,xe.Ay)(e);if(!t)return;const{viewport:n}=t;if(!(n instanceof be.A))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()};var Ie=n(90537),Se=n(1865),De=n(27119);function Ae(e){const t=e[0],{modality:n,seriesInstanceUID:i}=U.get("generalSeriesModule",t),{imageOrientationPatient:r,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:l}=U.get("imagePlaneModule",t),c={modality:n,imageOrientationPatient:r,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:l,seriesInstanceUID:i},u=e.every(e=>{const{modality:t,seriesInstanceUID:n}=U.get("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:r,columns:o,rows:a}=U.get("imagePlaneModule",e);return n===c.seriesInstanceUID&&t===c.modality&&o===c.columns&&a===c.rows&&(0,I.Ay)(i,c.imageOrientationPatient)&&(0,I.Ay)(r,c.pixelSpacing)});return u}var Te=n(45278),Ne=n(22191),Oe=n(63470),Pe=n(17791);const Me=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function ke(e){if(!e)return!1;return(Array.isArray(e)?e:[e]).find(e=>Me.has(e))}var Re=n(99576),Le=n(9734),Fe=n(98834),Ue=n(39561);async function Be({viewport:e,options:t={}}){const n=e.getRenderingEngine();let i=t.volumeId||`${(0,f.A)()}`;if(0===i.split(":").length){i=`${(0,Ue.getUnknownVolumeLoaderSchema)()}:${i}`}const{id:r,element:o}=e,a=t.viewportId||r,s=e.getImageIds(),l=e.getViewPresentation(),c=e.getViewReference();n.enableElement({viewportId:a,type:B.ViewportType.ORTHOGRAPHIC,element:o,defaultOptions:{background:t.background,orientation:t.orientation}});(await(0,Ue.createAndCacheVolume)(i,{imageIds:s})).load();const u=n.getViewport(a);await(0,Fe.A7)(n,[{volumeId:i}],[a]);const d=()=>{u.render(),o.removeEventListener(B.Events.VOLUME_VIEWPORT_NEW_VOLUME,d)};return o.addEventListener(B.Events.VOLUME_VIEWPORT_NEW_VOLUME,d),u.setViewPresentation(l),u.setViewReference(c),u.render(),u}var Ve=n(86252);async function We({viewport:e,options:t}){const n=e,{id:i,element:r}=n,o=e.getRenderingEngine(),{background:a}=t,s=t.viewportId||i,l=K.Ay.getVolume(n.getVolumeId());if(!(l instanceof Ve.Q))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const c={viewportId:s,type:B.ViewportType.STACK,element:r,defaultOptions:{background:a}},u=n.getViewReference();o.enableElement(c);const d=o.getViewport(s);return await d.setStack(l.imageIds),d.setViewReference(u),d.render(),d}var je=n(24623),He=n(67645),ze=n(19325);function Ge(e){return Math.round(e/ze.EPSILON)*ze.EPSILON}const qe=function e(t,n=2){if(Array.isArray(t))return t.map(t=>e(t,n)).join(", ");if(null==t||""===t)return"NaN";t=Number(t);const i=Math.abs(t);if(i<1e-4)return`${t}`;const r=i>=100?n-2:i>=10?n-1:i>=1?n:i>=.1?n+1:i>=.01?n+2:i>=.001?n+3:n+4;return t.toFixed(r)};function $e(e,t,n){const i=e.length===t*n*4,r=e.length===t*n*3;if(i||r){const r=new Float32Array(t*n);let o=0,a=0;const s=i?4:3;for(let i=0;i<t;i++)for(let t=0;t<n;t++){const t=e[o],n=e[o+1],i=e[o+2];r[a]=(t+n+i)/3,o+=s,a++}return r}return e}const Xe=function(e){if(e instanceof j.PX){return K.Ay.getVolume(e.getVolumeId()).imageIds}if(e.getImageIds)return e.getImageIds()};function Ke(e,t){const n=[...e];return t>=n.length?(Ye(n),n):(Ye(n),n.slice(0,t))}function Ye(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}var Je=n(12437),Ze=n(30169),Qe=n(56577),et=n(68136),tt=n(13859),nt=n(85745);function it(e){const t=e.toString(16);return 1==t.length?"0"+t:t}function rt(e,t,n){return"#"+it(e)+it(t)+it(n)}function ot(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function at(e,t){if(e===t)return!0;if(null==e||null==t)return!1;try{return JSON.stringify(e)===JSON.stringify(t)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),e===t}}function st(e,t){const n={};let i=[];const r=Object.keys(e);for(let o=0;o<r.length;o++){const a=new Set,s=e[r[o]];for(let e=0;e<s.length;e++){const i=t(s[e].imageId)||0;if(n[i]=n[i]||[],n[i].push({imageId:s[e].imageId}),a.add(i),a.size-1<e)return}if(0==o)i=Array.from(a);else if(!ht(i,a))return}return n}function lt(e,t){const n=U.get(t,e);try{return parseFloat(n)}catch{return}}function ct(e){const t=U.get("20011003",e);try{const{InlineBinary:e}=t;if(e){const t=atob(e),n=new ArrayBuffer(t.length),i=new DataView(n);for(let e=0;e<t.length;e++)i.setUint8(e,t.charCodeAt(e));return new Float32Array(n)[0]}return parseFloat(t)}catch{return}}function ut(e){let t=U.get("0019100c",e)||U.get("0019100C",e);try{const{InlineBinary:e}=t;return e&&(t=atob(e)),parseFloat(t)}catch{return}}function dt(e){let t=U.get("00431039",e);try{const{InlineBinary:e}=t;return e&&(t=atob(e).split("//")),parseFloat(t[0])%1e5}catch{return}}function ht(e,t){if(e.length!=t.size)return!1;for(let n=0;n<e.length;n++)if(!t.has(e[n]))return!1;return!0}function pt(e){const t=U.get("petImageModule",e);return t?t.frameReferenceTime:0}const ft=function(e){const t=function(e){const t=e.map(e=>{const{imagePositionPatient:t}=U.get("imagePlaneModule",e)||{};return{imageId:e,imagePositionPatient:t}});if(!t.every(e=>e.imagePositionPatient))return null;const n=(i="imagePositionPatient",t.reduce((e,t)=>((e[t[i]]=e[t[i]]||[]).push(t),e),{}));var i;const r=Object.keys(n),o=n[r[0]].length;return 1===o?null:r.every(e=>n[e].length===o)?n:null}(e);if(!t)return{imageIdGroups:[e],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],i=[e=>lt(e,n[0]),e=>lt(e,n[1]),e=>lt(e,n[2]),e=>lt(e,n[3]),e=>lt(e,n[4]),ct,ut,dt,pt];for(let e=0;e<i.length;e++){const r=st(t,i[e]);if(r){return{imageIdGroups:Object.keys(r).map(Number.parseFloat).sort((e,t)=>e-t).map(e=>r[e].map(e=>e.imageId)),splittingTag:n[e]}}}return{imageIdGroups:[e],splittingTag:null}};const mt=function(e){const{imageIdGroups:t,splittingTag:n}=ft(e);return{isDynamicVolume:t.length>1,timePoints:t,splittingTag:n}};var gt=n(91979);function vt(e,t){const n=e.length,{rescaleSlope:i,rescaleIntercept:r,suvbw:o}=t;if("PT"===t.modality&&"number"==typeof o)for(let t=0;t<n;t++)e[t]=o*(e[t]*i+r);else for(let t=0;t<n;t++)e[t]=e[t]*i+r;return e}var yt=n(99949);function _t(e,t,n){return Math.min(Math.max(t,e),n)}const wt=_t;var Et=n(10364);function bt(e,t){if(!(0,xe.Ay)(e.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(e instanceof j.hS&&0===e.getImageIds().length)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:r}=t;if(e instanceof j.PX)!function(e,t,n,i=!1){const r=i,{numScrollSteps:o,currentStepIndex:a,sliceRangeInfo:s}=(0,te.A)(e,t,r);if(!s)return;const{sliceRange:l,spacingInNormalDirection:c,camera:u}=s,{focalPoint:d,viewPlaneNormal:h,position:f}=u,{newFocalPoint:m,newPosition:g}=(0,ie.A)(d,f,l,h,c,n);e.setCamera({focalPoint:m,position:g}),e.render();const v=a+n,y={volumeId:t,viewport:e,delta:n,desiredStepIndex:v,currentStepIndex:a,numScrollSteps:o,currentImageId:e.getCurrentImageId()};(v>o||v<0)&&e.getCurrentImageId()?(0,p.A)(Et.A,B.Events.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,y):(0,p.A)(Et.A,B.Events.VOLUME_VIEWPORT_SCROLL,y)}(e,n,i,r);else{const n=e.getCurrentImageIdIndex();if(n+i>e.getImageIds().length-1||n+i<0){const e={imageIdIndex:n,direction:i};(0,p.A)(Et.A,B.Events.STACK_SCROLL_OUT_OF_BOUNDS,e)}e.scroll(i,t.debounceLoading,t.loop)}}async function xt(e,t={}){const{imageIndex:n,debounceLoading:i,volumeId:r}=t,o=(0,xe.Ay)(e);if(!o)throw new Error("Element has been disabled");const{viewport:a}=o,{imageIndex:s,numberOfSlices:l}=function(e,t){if(e instanceof be.A)return{numberOfSlices:e.getImageIds().length,imageIndex:t?e.getTargetImageIdIndex():e.getCurrentImageIdIndex()};return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getSliceIndex()}}(a,i),c=function(e,t){const n=e-1;return wt(t,0,n)}(l,n);bt(a,{delta:c-s,debounceLoading:i,volumeId:r})}const Ct=(e,t)=>function(e,t,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(e.modality)return e.modality;if(e.setVolumes){if(!(t=t??e.getVolumeId())||!n)return;return n(t).metadata.Modality}throw new Error("Invalid viewport type")}(e,t,K.Ay.getVolume)},50134:(e,t,n)=>{"use strict";function i(e){if(!e)return;const t=e.getSize();for(let n=0;n<t;n++){const t=[];e.getNodeValue(n,t),t[1]=1-t[1],t[2]=1-t[2],t[3]=1-t[3],e.setNodeValue(n,t)}}n.d(t,{A:()=>i})},74638:(e,t,n)=>{"use strict";function i(e,t,n){return Math.abs(e-t)<=n}function r(e){return"number"==typeof e}function o(e){return e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&e.length>0&&"number"==typeof e[0]}function a(e,t,n=1e-5){return typeof e==typeof t&&null!==e&&null!==t&&(r(e)&&r(t)?i(e,t,n):!(!o(e)||!o(t))&&function(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!i(e[r],t[r],n))return!1;return!0}(e,t,n))}n.d(t,{Ay:()=>a,Ph:()=>u,WC:()=>c,n4:()=>a});const s=e=>"number"==typeof e?-e:e?.map?e.map(s):!e,l=e=>"number"==typeof e?Math.abs(e):e?.map?e.map(l):e,c=(e,t,n=void 0)=>a(e,s(t),n),u=(e,t,n=void 0)=>a(l(e),l(t),n)},1865:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(74876);function r(e){const t=e[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:o,highBit:a,photometricInterpretation:s,samplesPerPixel:l}=(0,i.get)("imagePixelModule",t),c=[],u=(0,i.get)("voiLutModule",t);let d;if(u){const{windowWidth:e,windowCenter:t}=u;if(d=u?.voiLUTFunction,Array.isArray(e))for(let n=0;n<e.length;n++)c.push({windowWidth:e[n],windowCenter:t[n]});else c.push({windowWidth:e,windowCenter:t})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:h,seriesInstanceUID:p}=(0,i.get)("generalSeriesModule",t),{imageOrientationPatient:f,pixelSpacing:m,frameOfReferenceUID:g,columns:v,rows:y}=(0,i.get)("imagePlaneModule",t);return{BitsAllocated:r,BitsStored:o,SamplesPerPixel:l,HighBit:a,PhotometricInterpretation:s,PixelRepresentation:n,Modality:h,ImageOrientationPatient:f,PixelSpacing:m,FrameOfReferenceUID:g,Columns:v,Rows:y,voiLut:c,VOILUTFunction:d,SeriesInstanceUID:p}}},52268:(e,t,n)=>{"use strict";n.r(t),n.d(t,{linePlaneIntersection:()=>r,planeDistanceToPoint:()=>s,planeEquation:()=>o,threePlaneIntersection:()=>a});var i=n(3823);function r(e,t,n){const[i,r,o]=e,[a,s,l]=t,[c,u,d,h]=n,p=a-i,f=s-r,m=l-o,g=-1*(c*i+u*r+d*o-h)/(c*p+u*f+d*m);return[p*g+i,f*g+r,m*g+o]}function o(e,t,n=!1){const[i,r,o]=e,a=i*t[0]+r*t[1]+o*t[2];if(n){const e=Math.sqrt(i*i+r*r+o*o);return[i/e,r/e,o/e,a/e]}return[i,r,o,a]}function a(e,t,n){const[r,o,a,s]=e,[l,c,u,d]=t,[h,p,f,m]=n,g=i.w0.fromValues(r,l,h,o,c,p,a,u,f),v=i.w0.fromValues(s,d,m,o,c,p,a,u,f),y=i.w0.fromValues(r,l,h,s,d,m,a,u,f),_=i.w0.fromValues(r,l,h,o,c,p,s,d,m);return[i.w0.determinant(v)/i.w0.determinant(g),i.w0.determinant(y)/i.w0.determinant(g),i.w0.determinant(_)/i.w0.determinant(g)]}function s(e,t,n=!1){const[i,r,o,a]=e,[s,l,c]=t,u=i*s+r*l+o*c-a,d=Math.abs(u)/Math.sqrt(i*i+r*r+o*o);return(n?Math.sign(u):1)*d}},56577:(e,t,n)=>{"use strict";n.d(t,{i:()=>r});var i=n(3823);function r(e,t){const{pointInShapeFn:n,callback:r,boundsIJK:o,returnPoints:a=!1}=t;let s,l,c,u,d,h,p;const{numComps:f}=e;if(p=e.getScalarData?e.getScalarData():e.getPointData().getScalars().getData(),!p)return void console.warn("No scalar data found for imageData",e);const m=e.getDimensions();o?[[s,l],[c,u],[d,h]]=o:(s=0,l=m[0],c=0,u=m[1],d=0,h=m[2]);const g=i.eR.fromValues(s,c,d),v=e.getDirection(),y=v.slice(0,3),_=v.slice(3,6),w=v.slice(6,9),E=e.getSpacing(),[b,x,C]=E,I=e.indexToWorld(g),S=i.eR.fromValues(y[0]*b,y[1]*b,y[2]*b),D=i.eR.fromValues(_[0]*x,_[1]*x,_[2]*x),A=i.eR.fromValues(w[0]*C,w[1]*C,w[2]*C),T=f||p.length/m[2]/m[1]/m[0],N=m[0]*T,O=m[1]*N,P=[],M=i.eR.clone(I);for(let e=d;e<=h;e++){const t=i.eR.clone(M);for(let t=c;t<=u;t++){const o=i.eR.clone(M);for(let o=s;o<=l;o++){const a=[o,t,e];if(n(M,a)){const n=e*O+t*N+o*T;let i;i=T>2?[p[n],p[n+1],p[n+2]]:p[n],P.push({value:i,index:n,pointIJK:a,pointLPS:M.slice()}),r&&r({value:i,index:n,pointIJK:a,pointLPS:M})}i.eR.add(M,M,S)}i.eR.copy(M,o),i.eR.add(M,M,D)}i.eR.copy(M,t),i.eR.add(M,M,A)}return a?P:void 0}},80500:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(3823);function r(e,t,n,r,o,a){const{min:s,max:l,current:c}=n,u=i.eR.create();i.eR.sub(u,t,e);const d=Math.round((l-s)/o),h=(c-s)/(l-s)*d;let p=Math.round(h),f=[e[0]-r[0]*h*o,e[1]-r[1]*h*o,e[2]-r[2]*h*o];p+=a,p>d?p=d:p<0&&(p=0);const m=p*o;f=[f[0]+r[0]*m,f[1]+r[1]*m,f[2]+r[2]*m];return{newFocalPoint:f,newPosition:[f[0]+u[0],f[1]+u[1],f[2]+u[2]]}}},90537:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(3823),r=n(74876),o=n(59693);function a(e,t){const{imagePositionPatient:n,imageOrientationPatient:a}=r.get("imagePlaneModule",e[0]);if(!t){const e=i.eR.fromValues(a[0],a[1],a[2]),n=i.eR.fromValues(a[3],a[4],a[5]);t=i.eR.create(),i.eR.cross(t,e,n)}const s=i.eR.create(),l="wadouri"===e[0].split(":")[0];let c,u;function d(e){const{imagePositionPatient:o}=r.get("imagePlaneModule",e),a=i.eR.create();return i.eR.sub(a,n,o),i.eR.dot(a,t)}if(i.eR.set(s,n[0],n[1],n[2]),l){const o=[e[0],e[Math.floor(e.length/2)]];c=e;d(o[0])-d(o[1])<0&&c.reverse();const a=r.get("imagePlaneModule",o[1]);if(!a)throw new Error("Incomplete metadata required for volume construction.");const s=i.eR.create();i.eR.sub(s,n,a.imagePositionPatient);const l=i.eR.dot(s,t);u=Math.abs(l)/Math.floor(e.length/2)}else{const t=e.map(e=>({distance:d(e),imageId:e}));t.sort((e,t)=>t.distance-e.distance),c=t.map(e=>e.imageId);const n=t.length;u=Math.abs(t[n-1].distance-t[0].distance)/(n-1)}const{imagePositionPatient:h,sliceThickness:p,spacingBetweenSlices:f}=r.get("imagePlaneModule",c[0]),{strictZSpacingForVolumeViewport:m}=(0,o.D0)().rendering;0!==u||m||(p&&f?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),u=f):p?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),u=p):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),u=1));return{zSpacing:u,origin:h,sortedImageIds:c}}},85745:(e,t,n)=>{"use strict";function i(e){const t=e.getSize(),n=[];for(let i=0;i<t;i++){const t=[];e.getNodeValue(i,t),n.push(t)}return n}function r(e,t){t?.length&&(e.removeAllPoints(),t.forEach(t=>{e.addRGBPoint(...t)}))}n.r(t),n.d(t,{getTransferFunctionNodes:()=>i,setTransferFunctionNodes:()=>r})},51919:(e,t,n)=>{"use strict";n.d(t,{e:()=>r});var i=n(38669);function r(e,t){const{imageData:n}=e.getImageData(),r=e.canvasToWorld(t);return(0,i.A)(n,r)}},94741:(e,t,n)=>{"use strict";function i(e,t){return e.indexToWorld(t)}n.d(t,{A:()=>i})},38669:(e,t,n)=>{"use strict";function i(e,t){return e.worldToIndex(t).map(Math.round)}n.d(t,{A:()=>i})},45278:(e,t,n)=>{"use strict";function i(e,t){const n=t.voxelManager.getScalarData();if(!e.getPointData)return;const i=e.getPointData().getScalars().getData();if(t.color&&t.rgba){const e=new Uint8Array(t.columns*t.rows*3);for(let i=0;i<t.columns*t.rows;i++)e[3*i]=n[4*i],e[3*i+1]=n[4*i+1],e[3*i+2]=n[4*i+2];t.rgba=!1,t.getPixelData=()=>e,i.set(e)}else i.set(n);e.modified()}n.d(t,{J:()=>i})},68136:(e,t,n)=>{"use strict";function i(e,t){return{windowWidth:Math.abs(t-e)+1,windowCenter:(e+t+1)/2}}function r(e,t){return{lower:t-.5-(e-1)/2,upper:t-.5+(e-1)/2}}n.r(t),n.d(t,{toLowHighRange:()=>r,toWindowLevel:()=>i})},93952:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]]},94430:(e,t,n)=>{"use strict";n.d(t,{A:()=>o,i:()=>s});const i=Symbol("DefinedCursors"),r=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class o{constructor(e,t){this.name=e+"",this.fallback=t}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:t}=this;return t instanceof o?`${e}, ${t.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const t=a(o,i);let n=t.get(e);return n instanceof o?n:r.has(e)?(n=new o(e),t.set(e,n),n):void 0}static setDefinedCursor(e,t){if(t instanceof o){return a(o,i).set(e,t),!0}return!1}}function a(e,t){let n=e[t];return n instanceof Map||(n=new Map,Object.defineProperty(e,t,{value:n})),n}const s=r.values()},7001:(e,t,n)=>{"use strict";n.d(t,{hideElementCursor:()=>s,resetElementCursor:()=>a});var i=n(94430);const r=Symbol("ElementCursorsMap");function o(e,t){const n=l(e);n[1]=n[0],n[0]=t,e.style.cursor=(t instanceof i.A?t:i.A.getDefinedCursor("auto")).getStyleProperty()}function a(e){o(e,l(e)[1])}function s(e){o(e,i.A.getDefinedCursor("none"))}function l(e){let t=l[r];t instanceof WeakMap||(t=new WeakMap,Object.defineProperty(l,r,{value:t}));let n=t.get(e);return n||(n=[null,null],t.set(e,n)),n}},79475:(e,t,n)=>{"use strict";var i=n(94430);n(15327);i.A;var r=n(99737);const o={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="{{color}}" d="M8 16L8 0"></path>\n    <path stroke="{{color}}" d="M16 8L0 8"></path>\n  '},a={x:127,y:60},s='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n',l='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>\n',c='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',u='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',d='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',h={Angle:p(o,{name:"Angle",iconContent:'<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n    10l50 50q10 10 10 23z" />',viewBox:{x:1792,y:1792}}),ArrowAnnotate:p(o,{name:"ArrowAnnotate",iconContent:'<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',viewBox:{x:24,y:24}}),Bidirectional:p(o,{name:"Bidirectional",iconContent:'<g fill="{{color}}" stroke-width="3" stroke="{{color}}">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',viewBox:{x:48,y:48}}),CobbAngle:p(o,{name:"CobbAngle",iconContent:'<g stroke="{{color}}" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',viewBox:{x:32,y:32}}),CircleROI:p(o,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:p(o,{name:"EllipticalROI",iconContent:'<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z" />',viewBox:{x:32,y:32}}),FreehandROI:p(o,{name:"FreehandROI",iconContent:'<g fill="{{color}}" stroke="{{color}}" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',viewBox:{x:18,y:18}}),FreehandROISculptor:p(o,{name:"FreehandROISculptor",iconContent:'<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n  </g>',viewBox:{x:18,y:18}}),Length:p(o,{name:"Length",iconContent:'<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',viewBox:{x:24,y:24}}),Height:p(o,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:p(o,{name:"Probe",iconContent:'<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z" />',viewBox:{x:1792,y:1792}}),RectangleROI:p(o,{name:"RectangleROI",iconContent:'<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),TextMarker:p(o,{name:"TextMarker",iconContent:'<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />',viewBox:{x:1792,y:1792}}),Crosshairs:p(o,{name:"Crosshairs",iconContent:'<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />',viewBox:{x:1792,y:1792}}),Eraser:p(o,{name:"Eraser",iconContent:'<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n    0 69.5 20.5t47.5 54.5z" />',viewBox:{x:2048,y:1792}}),Magnify:p(o,{name:"Magnify",iconContent:'<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />',viewBox:{x:512,y:512}}),Pan:p(o,{name:"Pan",iconContent:'<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />',viewBox:{x:1792,y:1792}}),Rotate:p(o,{name:"Rotate",iconContent:'<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n    39 17 39 59z" />',viewBox:{x:1792,y:1792}}),StackScroll:p(o,{name:"StackScroll",iconContent:'<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />',viewBox:{x:24,y:28}}),WindowLevelRegion:p(o,{name:"WindowLevelRegion",iconContent:'<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),WindowLevel:p(o,{name:"WindowLevel",iconContent:'\n    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />',viewBox:{x:18,y:18}}),Zoom:p(o,{name:"Zoom",iconContent:'\n  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />\n  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />',viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:p(o,{name:"SegmentationFreeHandEraseInside",iconContent:`${c} ${s}`,viewBox:a}),SegmentationFreeHandFillInside:p(o,{name:"SegmentationFreeHandFillInside",iconContent:`${c} ${l}`,viewBox:a}),SegmentationFreeHandEraseOutside:p(o,{name:"SegmentationFreeHandEraseOutside",iconContent:`${c} ${s}`,viewBox:a}),SegmentationFreeHandFillOutside:p(o,{name:"SegmentationFreeHandFillOutside",iconContent:`${c} ${l}`,viewBox:a}),SegmentationRectangleEraseInside:p(o,{name:"SegmentationRectangleEraseInside",iconContent:`${u} ${s}`,viewBox:a}),RectangleScissor:p(o,{name:"RectangleScissor",iconContent:`${u} ${l}`,viewBox:a}),"RectangleScissor.FILL_INSIDE":p(o,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${u} ${l}`,viewBox:a}),"RectangleScissor.FILL_OUTSIDE":p(o,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${u} ${l}`,viewBox:a}),"RectangleScissor.ERASE_OUTSIDE":p(o,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${u} ${s}`,viewBox:a}),"RectangleScissor.ERASE_INSIDE":p(o,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${u} ${s}`,viewBox:a}),CircleScissor:p(o,{name:"CircleScissor",iconContent:`${d} ${l}`,viewBox:a}),"CircleScissor.FILL_INSIDE":p(o,{name:"CircleScissor.FILL_INSIDE",iconContent:`${d} ${l}`,viewBox:a}),"CircleScissor.ERASE_OUTSIDE":p(o,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${d} ${s}`,viewBox:a}),"CircleScissor.FILL_OUTSIDE":p(o,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${d} ${l}`,viewBox:a})};function p(e,t){return Object.assign(Object.create(e),{...t,name:t.name||e.name})}const f=Object.keys(h);n(76712);r.AnnotationStyleStates.Highlighted,r.ToolModes.Active;n(7001);i.i},40203:(e,t,n)=>{"use strict";n.d(t,{draw:()=>d,drawArrow:()=>O,drawCircle:()=>m,drawEllipseByCoordinates:()=>g,drawHandle:()=>v,drawHandles:()=>y,drawHeight:()=>w,drawLine:()=>_,drawLinkedTextBox:()=>A,drawPath:()=>b,drawPolyline:()=>E,drawRect:()=>N,drawRectByCoordinates:()=>T,drawRedactionRect:()=>P,drawTextBox:()=>I});var i=n(85204),r=n(15327);const o="viewport-element";function a(e,t){if(i.wk.svgNodeCache[e])return i.wk.svgNodeCache[e][t]?i.wk.svgNodeCache[e][t].domRef:void 0}function s(e,t,n,r){if(!i.wk.svgNodeCache[t])return null;i.wk.svgNodeCache[t][r]={touched:!0,domRef:n},e.appendChild(n)}function l(e,t){i.wk.svgNodeCache[e]&&i.wk.svgNodeCache[e][t]&&(i.wk.svgNodeCache[e][t].touched=!0)}function c(e,t){i.wk.svgNodeCache[t]&&Object.keys(i.wk.svgNodeCache[t]).forEach(n=>{const r=i.wk.svgNodeCache[t][n];!r.touched&&r.domRef&&(e.removeChild(r.domRef),delete i.wk.svgNodeCache[t][n])})}const u=function(e){const t=(0,r.getEnabledElement)(e),{viewportId:n,renderingEngineId:u}=t,d=`${n}:${u}`,h=function(e){const t=`.${o}`,n=e.querySelector(t),i=n?.querySelector(":scope > .svg-layer");return i}(e);return Object.keys(i.wk.svgNodeCache[d]).forEach(e=>{i.wk.svgNodeCache[d][e].touched=!1}),{svgLayerElement:h,svgNodeCacheForCanvas:i.wk.svgNodeCache,getSvgNode:a.bind(this,d),appendNode:s.bind(this,h,d),setNodeTouched:l.bind(this,d),clearUntouched:c.bind(this,h,d)}};const d=function(e,t){const n=u(e);t(n),n.clearUntouched()};const h=function(e,t,n){return`${e}::${t}::${n}`};const p=function(e,t){Object.keys(e).forEach(n=>{const i=t.getAttribute(n),r=e[n];void 0===r||""===r?t.removeAttribute(n):i!==r&&t.setAttribute(n,r)})};const f=function(e,t){Object.keys(e).forEach(n=>{const i=e[n];void 0!==i&&""!==i&&t.setAttribute(n,i)})};const m=function(e,t,n,i,r,o={},a=""){const{color:s,fill:l,width:c,lineWidth:u,lineDash:d,fillOpacity:m,strokeOpacity:g}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},o),v=u||c,y=h(t,"circle",n),_=e.getSvgNode(y),w={cx:`${i[0]}`,cy:`${i[1]}`,r:`${r}`,stroke:s,fill:l,"stroke-width":v,"stroke-dasharray":d,"fill-opacity":m,"stroke-opacity":g};if(_)p(w,_),e.setNodeTouched(y);else{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");""!==a&&t.setAttribute("data-id",a),f(w,t),e.appendNode(t,y)}};const g=function(e,t,n,i,r={},o=""){const{color:a,width:s,lineWidth:l,lineDash:c}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},r),u=l||s,d=h(t,"ellipse",n),m=e.getSvgNode(d),[g,v,y,_]=i,w=Math.hypot(y[0]-_[0],y[1]-_[1]),E=Math.hypot(v[0]-g[0],v[1]-g[1]),b=180*Math.atan2(y[1]-_[1],y[0]-_[0])/Math.PI,x=[(y[0]+_[0])/2,(v[1]+g[1])/2],C={cx:`${x[0]}`,cy:`${x[1]}`,rx:`${w/2}`,ry:`${E/2}`,stroke:a,fill:"transparent",transform:`rotate(${b} ${x[0]} ${x[1]})`,"stroke-width":u,"stroke-dasharray":c};if(m)p(C,m),e.setNodeTouched(d);else{const t=document.createElementNS("http://www.w3.org/2000/svg","ellipse");""!==o&&t.setAttribute("data-id",o),f(C,t),e.appendNode(t,d)}};const v=function(e,t,n,i,r={},o){const{color:a,handleRadius:s,width:l,lineWidth:c,fill:u,type:d,opacity:m}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},r),g=c||l,v=h(t,"handle",`hg-${n}-index-${o}`);let y;if("circle"===d)y={cx:`${i[0]}`,cy:`${i[1]}`,r:s,stroke:a,fill:u,"stroke-width":g,opacity:m};else{if("rect"!==d)throw new Error(`Unsupported handle type: ${d}`);{const e=1.5*parseFloat(s);y={x:`${i[0]-.5*e}`,y:`${i[1]-.5*e}`,width:`${e}`,height:`${e}`,stroke:a,fill:u,"stroke-width":g,rx:""+.1*e,opacity:m}}}const _=e.getSvgNode(v);if(_)p(y,_),e.setNodeTouched(v);else{const t=document.createElementNS("http://www.w3.org/2000/svg",d);f(y,t),e.appendNode(t,v)}};const y=function(e,t,n,i,r={}){i.forEach((i,o)=>{v(e,t,n,i,r,o)})};function _(e,t,n,i,r,o={},a=""){if(isNaN(i[0])||isNaN(i[1])||isNaN(r[0])||isNaN(r[1]))return;const{color:s,width:l,lineWidth:c,lineDash:u,shadow:d}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},o),m=c||l,g=h(t,"line",n),v=e.getSvgNode(g),y=d?`filter:url(#shadow-${e.svgLayerElement.id});`:"",_={x1:`${i[0]}`,y1:`${i[1]}`,x2:`${r[0]}`,y2:`${r[1]}`,stroke:s,style:y,"stroke-width":m,"stroke-dasharray":u};if(v)p(_,v),e.setNodeTouched(g);else{const t=document.createElementNS("http://www.w3.org/2000/svg","line");""!==a&&t.setAttribute("data-id",a),f(_,t),e.appendNode(t,g)}}function w(e,t,n,i,r,o={}){if(isNaN(i[0])||isNaN(i[1])||isNaN(r[0])||isNaN(r[1]))return;const{color:a,width:s,lineWidth:l,lineDash:c}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),u=r[0]+(i[0]-r[0])/2,d=[u,i[1]],h=[u,r[1]],p={start:i,end:d},f={start:d,end:h},m={start:h,end:r};_(e,t,"1",p.start,p.end,{color:a,width:s,lineWidth:l}),_(e,t,"2",f.start,f.end,{color:a,width:s,lineWidth:l}),_(e,t,"3",m.start,m.end,{color:a,width:s,lineWidth:l})}function E(e,t,n,i,r){if(i.length<2)return;const{color:o="rgb(0, 255, 0)",width:a=10,fillColor:s="none",fillOpacity:l=0,lineWidth:c,lineDash:u,closePath:d=!1}=r,m=c||a,g=h(t,"polyline",n),v=e.getSvgNode(g);let y="";for(const e of i)y+=`${e[0].toFixed(1)}, ${e[1].toFixed(1)} `;if(d){const e=i[0];y+=`${e[0]}, ${e[1]}`}const _={points:y,stroke:o,fill:s,"fill-opacity":l,"stroke-width":m,"stroke-dasharray":u};if(v)p(_,v),e.setNodeTouched(g);else{const t=document.createElementNS("http://www.w3.org/2000/svg","polyline");f(_,t),e.appendNode(t,g)}}function b(e,t,n,i,r){const o=i.length&&i[0].length&&Array.isArray(i[0][0])?i:[i],{color:a="rgb(0, 255, 0)",width:s=10,fillColor:l="none",fillOpacity:c=0,lineWidth:u,lineDash:d,closePath:m=!1}=r,g=u||s,v=h(t,"path",n),y=e.getSvgNode(v);let _="";for(let e=0,t=o.length;e<t;e++){const t=o[e],n=t.length;if(!(n<2)){for(let e=0;e<n;e++){const n=t[e];_+=`${e?"L":"M"} ${n[0].toFixed(1)}, ${n[1].toFixed(1)} `}m&&(_+="Z ")}}if(!_)return;const w={d:_,stroke:a,fill:l,"fill-opacity":c,"stroke-width":g,"stroke-dasharray":d};if(y)p(w,y),e.setNodeTouched(v);else{const t=document.createElementNS("http://www.w3.org/2000/svg","path");f(w,t),e.appendNode(t,v)}}function x(e){const t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return t.setAttribute("x","0"),t.setAttribute("dy","1.2em"),t.textContent=e,t}function C(e,t){let n=e.querySelector("rect.background");if(!t)return n&&e.removeChild(n),e.getBBox();n||(n=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("class","background"),e.insertBefore(n,e.firstChild));const i=e.getBBox(),r={x:`${i.x}`,y:`${i.y}`,width:`${i.width}`,height:`${i.height}`,fill:t};return p(r,n),i}const I=function(e,t,n,i,r,o={}){return function(e,t,n,i=[""],r,o){const{padding:a,color:s,fontFamily:l,fontSize:c,background:u}=o;let d;const[f,m]=[r[0]+a,r[1]+a],g="http://www.w3.org/2000/svg",v=h(t,"text",n),y=e.getSvgNode(v);if(y){const t=y.querySelector("text"),n=Array.from(t.children);for(let e=0;e<n.length;e++){const t=n[e],r=i[e]||"";t.textContent=r}if(i.length>n.length){for(let e=0;e<i.length-n.length;e++){const r=x(i[e+n.length]);t.appendChild(r)}y.appendChild(t),e.appendNode(y,v)}const r={transform:`translate(${f} ${m})`};p({fill:s,"font-size":c,"font-family":l},t),p(r,y),d=C(y,u),e.setNodeTouched(v)}else{const t=document.createElementNS(g,"g");t.setAttribute("transform",`translate(${f} ${m})`);const n=function(e,t){const{color:n,fontFamily:i,fontSize:r}=t,o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",l=`filter:url(#shadow-${e.svgLayerElement.id});`,c=`${s}${l}`;return a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("fill",n),a.setAttribute("font-family",i),a.setAttribute("font-size",r),a.setAttribute("style",c),a}(e,o);for(let e=0;e<i.length;e++){const t=x(i[e]);n.appendChild(t)}t.appendChild(n),e.appendNode(t,v),d=C(t,u)}return Object.assign({},d,{x:f,y:m,height:d.height+a,width:d.width+a})}(e,t,n,i,r,Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},o))};var S=n(90554);const D=function(e,t,n,i,r,o,a={}){const s=i.length>0?(0,S.A)(i,r):r,l=function(e){const{x:t,y:n,height:i,width:r}=e,o=r/2,a=i/2;return[[t+o,n],[t,n+a],[t+o,n+i],[t+r,n+a]]}(o);_(e,t,`link-${n}`,s,(0,S.A)(l,s),Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},a))};const A=function(e,t,n,i,r,o,a,s={}){const l=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),c=I(e,t,n,i,r,l);return D(e,t,n,o,r,c,l),c};function T(e,t,n,i,r={},o=""){const{color:a,width:s,lineWidth:l,lineDash:c}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},r),u=l||s,d=h(t,"rect",n),m=e.getSvgNode(d),[g,v,y,_]=i,w=Math.hypot(g[0]-v[0],g[1]-v[1]),E=Math.hypot(g[0]-y[0],g[1]-y[1]),b=[(_[0]+g[0])/2,(_[1]+g[1])/2],x=[(y[0]+g[0])/2,(y[1]+g[1])/2],C=180*Math.atan2(b[1]-x[1],b[0]-x[0])/Math.PI,I={x:""+(b[0]-w/2),y:""+(b[1]-E/2),width:`${w}`,height:`${E}`,stroke:a,fill:"transparent",transform:`rotate(${C} ${b[0]} ${b[1]})`,"stroke-width":u,"stroke-dasharray":c};if(m)p(I,m),e.setNodeTouched(d);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");""!==o&&t.setAttribute("data-id",o),f(I,t),e.appendNode(t,d)}}function N(e,t,n,i,r,o={},a=""){T(e,t,n,[[i[0],i[1]],[r[0],i[1]],[i[0],r[1]],[r[0],r[1]]],o,a)}function O(e,t,n,i,r,o={}){if(isNaN(i[0])||isNaN(i[1])||isNaN(r[0])||isNaN(r[1]))return;const{color:a,width:s,lineWidth:l,lineDash:c}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o);_(e,t,n,i,r,{color:a,width:s,lineWidth:l,lineDash:c});const u=Math.atan2(r[1]-i[1],r[0]-i[0]),d={start:[r[0]-10*Math.cos(u-Math.PI/7),r[1]-10*Math.sin(u-Math.PI/7)],end:r},h={start:[r[0]-10*Math.cos(u+Math.PI/7),r[1]-10*Math.sin(u+Math.PI/7)],end:r};_(e,t,`${parseInt(n)+1}`,d.start,d.end,{color:a,width:s,lineWidth:l}),_(e,t,`${parseInt(n)+2}`,h.start,h.end,{color:a,width:s,lineWidth:l})}function P(e,t,n,i,r,o={}){const{color:a,width:s,lineWidth:l,lineDash:c}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),u=l||s,d=h(t,"rect",n),m=e.getSvgNode(d),g=[Math.min(i[0],r[0]),Math.min(i[1],r[1])],v=Math.abs(i[0]-r[0]),y=Math.abs(i[1]-r[1]),_={x:`${g[0]}`,y:`${g[1]}`,width:`${v}`,height:`${y}`,stroke:a,fill:"black","stroke-width":u,"stroke-dasharray":c};if(m)p(_,m),e.setNodeTouched(d);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");f(_,t),e.appendNode(t,d)}}},75183:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>r}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated"}(i||(i={}));const r=i},94021:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>r}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",e.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(i||(i={}));const r=i},18682:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>r}),function(e){e.Labelmap="Labelmap",e.Contour="Contour",e.Surface="Surface"}(i||(i={}));const r=i},84093:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>r}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.CreateIsTargetSegment="createIsTargetSegment",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.ComputeInnerCircleRadius="computeInnerCircleRadius"}(i||(i={}));const r=i},66452:(e,t,n)=>{"use strict";var i,r;n.d(t,{i:()=>i,q:()=>r}),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button",e[e.Wheel=524288]="Wheel",e[e.Wheel_Primary=524289]="Wheel_Primary"}(i||(i={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(r||(r={}))},49892:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>r}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(i||(i={}));const r=i},10401:(e,t,n)=>{"use strict";var i;n.d(t,{H:()=>i}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(i||(i={}))},99737:(e,t,n)=>{"use strict";n.d(t,{AnnotationStyleStates:()=>a,ChangeTypes:()=>d.A,Events:()=>l.A,KeyboardBindings:()=>r.q,MouseBindings:()=>r.i,SegmentationRepresentations:()=>c.A,StrategyCallbacks:()=>u.A,ToolModes:()=>o.A,WorkerTypes:()=>h});var i,r=n(66452),o=n(49892);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(i||(i={}));const a=i;var s,l=n(94021),c=n(18682),u=(n(10401),n(84093)),d=n(75183);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",e.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",e.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",e.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",e.SURFACE_CLIPPING="Clipping Surfaces"}(s||(s={}));const h=s},76910:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(99737);const r=e=>e.shiftKey?e.ctrlKey?i.KeyboardBindings.ShiftCtrl:e.altKey?i.KeyboardBindings.ShiftAlt:e.metaKey?i.KeyboardBindings.ShiftMeta:i.KeyboardBindings.Shift:e.ctrlKey?e.altKey?i.KeyboardBindings.CtrlAlt:e.metaKey?i.KeyboardBindings.CtrlMeta:i.KeyboardBindings.Ctrl:e.altKey?e.metaKey&&i.KeyboardBindings.AltMeta||i.KeyboardBindings.Alt:e.metaKey?i.KeyboardBindings.Meta:void 0},50986:(e,t,n)=>{"use strict";n.d(t,{r:()=>u});n(15327),n(15295),n(51440);var i=n(58640),r=n(8056),o=n(77840),a=(n(93126),n(44049),n(72967)),s=n(66403);n(7754),n(68040);const l="PlanarFreehandContourSegmentationTool";function c(e,t){const n=e.length,i=new Array(n);for(let r=0;r<n;r++)i[r]=t.worldToCanvas(e[r]);return i}function u(e,t,n){const{windingDirection:u}=t.data.contour,{windingDirection:d}=n.data.contour;(0,o.addChildAnnotation)(t,n),(0,s.removeContourSegmentationAnnotation)(n);const{contour:h}=n.data,p=c(h.polyline,e);(0,a.A)(n,{points:p,closed:h.closed},e);const{element:f}=e,m=new Set([l,t.metadata.toolName,n.metadata.toolName]);for(const e of m.values()){const t=(0,r.getViewportIdsWithToolToRender)(f,e);(0,i.A)(t)}}},90665:(e,t,n)=>{"use strict";n.d(t,{utilities:()=>P});var i=n(15327),r=n(77840),o=n(99737),a=(n(68040),n(94021));n(66452);a.A.MOUSE_MOVE;const{MOUSE_DOWN:s,MOUSE_DOWN_ACTIVATE:l,MOUSE_CLICK:c,MOUSE_UP:u,MOUSE_DRAG:d}=a.A;const h=0,p=1;let f,m;function g(e,t){const n=Date.now();if(e!==f){if(n-m<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;f=e}m=n}g.bind(null,h),g.bind(null,p);n(10401);n(76260);i.Settings.getRuntimeSettings();const{TOUCH_START:v,TOUCH_START_ACTIVATE:y,TOUCH_PRESS:_,TOUCH_DRAG:w,TOUCH_END:E,TOUCH_TAP:b,TOUCH_SWIPE:x}=a.A,C={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},I={page:0,client:0,canvas:0,world:0},S={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...C,touch:null}],lastPointsList:[{...C,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:I,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},D={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...C,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};JSON.parse(JSON.stringify(S)),JSON.parse(JSON.stringify(D));n(24917);var A=n(98870);n(59452);n(33283);var T=n(42008),N=n(58498);n(78231),n(97577),n(93210);new Map;n(66403),n(50986);var O=n(58640);var P=n(52606);n(56069);var M=n(85204),k=n(49892),R=n(7754);const{Active:L}=k.A;function F(e,t,n){if(M.wk.isInteractingWithTool)return!1;const{renderingEngineId:i,viewportId:r}=n.detail,o=(0,R.getToolGroupForViewport)(r,i);if(!o)return!1;let a;const s=Object.keys(o.toolOptions);for(let e=0;e<s.length;e++){const n=s[e],i=o.toolOptions[n],r=o.getToolInstance(n);if(i.mode===L&&"function"==typeof r[t]){a=o.getToolInstance(n);break}}a&&a[t](n)}F.bind(null,"Mouse","mouseClickCallback"),F.bind(null,"Mouse","doubleClickCallback");var U=n(17343),B=n(2076),V=n(29601);var W=n(76910);const{Active:j}=o.ToolModes;const{Active:H,Passive:z}=o.ToolModes;const{Active:G,Passive:q}=o.ToolModes;const{Active:$,Passive:X}=o.ToolModes;F.bind(null,"Mouse","mouseUpCallback");const{Active:K}=o.ToolModes;const{Active:Y,Passive:J,Enabled:Z}=o.ToolModes,{Active:Q,Passive:ee,Enabled:te}=o.ToolModes,{Active:ne}=o.ToolModes;const{Active:ie,Passive:re}=o.ToolModes;F.bind(null,"Touch","touchEndCallback"),F.bind(null,"Touch","touchTapCallback"),F.bind(null,"Touch","touchPressCallback");n(15773);const{Active:oe,Passive:ae,Enabled:se}=o.ToolModes;n(39011);n(39848);var le=n(6802);n(65136);n(48145);n(63457);n(93952);const{CAMERA_MODIFIED:ce}=i.Enums.Events;const{CAMERA_MODIFIED:ue}=i.Enums.Events;const{CAMERA_MODIFIED:de}=i.Enums.Events;var he=n(3823);const{STACK_NEW_IMAGE:pe,VOLUME_NEW_IMAGE:fe}=i.Enums.Events;const{CAMERA_MODIFIED:me}=i.Enums.Events;var ge=n(40203),ve=(n(79475),n(13369),n(47807),n(1300)),ye=n(85817);class _e extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{element:t,deltaPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),o=n.world;if(0===o[0]&&0===o[1]&&0===o[2])return;const a=r.viewport.getCamera(),{focalPoint:s,position:l}=a,c=[l[0]-o[0],l[1]-o[1],l[2]-o[2]],u=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];r.viewport.setCamera({focalPoint:u,position:c}),r.viewport.render()}}_e.toolName="Pan";var we=n(84607);class Ee extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2}}){super(e,t),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o}=r,a=o.getDefaultActor().actor.getMapper();if(!("getSampleDistance"in a||"getCurrentSampleDistance"in a))return!0;const s=a.getSampleDistance();return this._hasResolutionChanged||(a.setSampleDistance(2*s),this._hasResolutionChanged=!0,null!==this.cleanUp&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{a.setSampleDistance(s),o.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})),!0},this._getViewportsInfo=()=>(0,R.getToolGroup)(this.toolGroupId).viewportsInfo,this.onSetToolActive=()=>{const e=()=>{this._getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{if(!this._resizeObservers.has(e)){const{viewport:n}=(0,i.getEnabledElementByIds)(e,t)||{viewport:null};if(!n)return;const{element:r}=n,o=new ResizeObserver(()=>{const n=(0,i.getEnabledElementByIds)(e,t);if(!n)return;const{viewport:r}=n;r.resetCamera(),r.render()});o.observe(r),this._resizeObservers.set(e,o)}})};e(),this._viewportAddedListener=t=>{t.detail.toolGroupId===this.toolGroupId&&e()},i.eventTarget.addEventListener(o.Events.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)},this.onSetToolDisabled=()=>{this._resizeObservers.forEach((e,t)=>{e.disconnect(),this._resizeObservers.delete(t)}),this._viewportAddedListener&&(i.eventTarget.removeEventListener(o.Events.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)},this.rotateCamera=(e,t,n,i)=>{const r=e.getVtkActiveCamera(),o=r.getViewUp(),a=r.getFocalPoint(),s=r.getPosition(),l=[0,0,0],c=[0,0,0],u=[0,0,0],d=he.pB.identity(new Float32Array(16));he.pB.translate(d,d,t),he.pB.rotate(d,d,i,n),he.pB.translate(d,d,[-t[0],-t[1],-t[2]]),he.eR.transformMat4(l,s,d),he.eR.transformMat4(c,a,d),he.pB.identity(d),he.pB.rotate(d,d,i,n),he.eR.transformMat4(u,o,d),e.setCamera({position:l,viewUp:u,focalPoint:c})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:t,currentPoints:n,lastPoints:r}=e.detail,o=n.canvas,a=r.canvas,{rotateIncrementDegrees:s}=this.configuration,l=(0,i.getEnabledElement)(t),{viewport:c}=l,u=c.getCamera(),d=t.clientWidth,h=t.clientHeight,p=[o[0]/d,o[1]/h],f=[a[0]/d,a[1]/h],m=[.5*d,.5*h],g=c.canvasToWorld(m),v=(1+Math.abs(.5))**2,y=[f[0],0,0],_=[p[0],0,0],w=y[0]**2,E=_[0]**2,b=w>v?0:Math.sqrt(v-w),x=E>v?0:Math.sqrt(v-E),C=[y[0],0,b];we.Ay.normalize(C);const I=[_[0],0,x];we.Ay.normalize(I);const S=we.Ay.dot(C,I);if(Math.abs(S)>1e-4){const e=-2*Math.acos(we.Ay.clampValue(S,-1,1))*Math.sign(p[0]-f[0])*s,t=u.viewUp,n=u.viewPlaneNormal,i=[0,0,0],r=[0,0,0];we.Ay.cross(t,n,i),we.Ay.normalize(i),we.Ay.cross(n,i,r),we.Ay.normalize(r),we.Ay.normalize(t),this.rotateCamera(c,g,r,e);const o=(f[1]-p[1])*s;this.rotateCamera(c,g,i,o),c.render()}}}Ee.toolName="TrackballRotate";class be extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this._getImageDynamicRangeFromMiddleSlice=(e,t)=>{const n=Math.floor(t[2]/2),i=t[0]*t[1];let r,o;e instanceof Float32Array?(r=4,o=Float32Array):e instanceof Uint8Array?(r=1,o=Uint8Array):e instanceof Uint16Array?(r=2,o=Uint16Array):e instanceof Int16Array&&(r=2,o=Int16Array);const a=new o(e.buffer,n*i*r,i),{max:s,min:l}=this._getMinMax(a,i);return s-l}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){const{element:t,deltaPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:o}=r;let a,s,l,c,u,d,h=!1;const p=o.getProperties();if(o instanceof i.VolumeViewport){a=o.getVolumeId(),d=i.utilities.getViewportsWithVolumeId(a),({lower:s,upper:l}=p.voiRange);const e=i.cache.getVolume(a);if(!e)throw new Error("Volume not found "+a);c=e.metadata.Modality,h=e.scaling&&Object.keys(e.scaling).length>0}else{if(!p.voiRange)throw new Error("Viewport is not a valid type");{c=o.modality,({lower:s,upper:l}=p.voiRange);const{preScale:e={scaled:!1}}=o.getImageData?.()||{};h=e.scaled&&void 0!==e.scalingParameters?.suvbw}}u="PT"===c&&h?this.getPTScaledNewRange({deltaPointsCanvas:n.canvas,lower:s,upper:l,clientHeight:t.clientHeight,isPreScaled:h,viewport:o,volumeId:a}):this.getNewRange({viewport:o,deltaPointsCanvas:n.canvas,volumeId:a,lower:s,upper:l}),u.lower>=u.upper||(o.setProperties({voiRange:u}),o.render(),o instanceof i.VolumeViewport&&d.forEach(e=>{o!==e&&e.render()}))}getPTScaledNewRange({deltaPointsCanvas:e,lower:t,upper:n,clientHeight:i,viewport:r,volumeId:o,isPreScaled:a}){let s=4;s=a?5/i:this._getMultiplierFromDynamicRange(r,o)||4;return n-=e[1]*s,{lower:t,upper:n=a?Math.max(n,.1):n}}getNewRange({viewport:e,deltaPointsCanvas:t,volumeId:n,lower:r,upper:o}){const a=this._getMultiplierFromDynamicRange(e,n)||4,s=t[0]*a,l=t[1]*a;let{windowWidth:c,windowCenter:u}=i.utilities.windowLevel.toWindowLevel(r,o);return c+=s,u+=l,c=Math.max(c,1),i.utilities.windowLevel.toLowHighRange(c,u)}_getMultiplierFromDynamicRange(e,t){let n;if(t){const r=i.cache.getVolume(t),{voxelManager:o}=e.getImageData(),a=o.getMiddleSliceData().reduce((e,t)=>[Math.min(e[0],t),Math.max(e[1],t)],[1/0,-1/0]),s=r?.metadata?.BitsStored,l=s?2**s:1/0;n=Math.min(a,l)}else n=this._getImageDynamicRangeFromViewport(e);const r=n/1024;return r>1?Math.round(r):r}_getImageDynamicRangeFromViewport(e){const{imageData:t,voxelManager:n}=e.getImageData();if(n?.getRange){const e=n.getRange();return e[1]-e[0]}const i=t.getDimensions();if(t.getRange){const e=t.getRange();return e[1]-e[0]}let r,o;if(r=t.getScalarData?t.getScalarData():t.getPointData().getScalars().getData(),1!==i[2])return this._getImageDynamicRangeFromMiddleSlice(r,i);if(r.getRange)o=r.getRange();else{const{min:e,max:t}=this._getMinMax(r,r.length);o=[e,t]}return o[1]-o[0]}_getMinMax(e,t){let n=1/0,i=-1/0;for(let r=0;r<t;r++){const t=e[r];t<n&&(n=t),t>i&&(i=t)}return{max:i,min:n}}}be.toolName="WindowLevel";var xe=n(44049),Ce=n(8056),Ie=n(7001),Se=n(98643);class De extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:s}=a;this.isDrawing=!0;const l=s.getCamera(),{viewPlaneNormal:c,viewUp:u}=l,d=this.getReferencedImageId(s,o,c,u),h=s.getFrameOfReferenceUID(),p={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...c],viewUp:[...u],FrameOfReferenceUID:h,referencedImageId:d},data:{handles:{points:[[...o],[...o],[...o],[...o]]},cachedStats:{}}};(0,le.lC)(p,r);const f=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:f},this._activateDraw(r),(0,Ie.hideElementCursor)(r),e.preventDefault(),(0,O.A)(f),p},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:r}=this.editData;this._deactivateDraw(n),(0,Ie.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,(0,le.O8)(i.annotationUID),(0,O.A)(r),(0,xe.dZ)(i),this.applyWindowLevelRegion(i,n)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o}=this.editData,{data:a}=r,{currentPoints:s}=t,l=(0,i.getEnabledElement)(n),{worldToCanvas:c,canvasToWorld:u}=l.viewport,d=s.world,{points:h}=a.handles;h[3]=[...d];const p=c(h[0]),f=c(h[3]),m=[f[0],p[1]],g=[p[0],f[1]],v=u(m),y=u(g);h[1]=v,h[2]=y,r.invalidated=!0,(0,O.A)(o)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:r}=i;let o=(0,le.Rh)(this.getToolName(),r);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(r,o),!o?.length)return n;const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<o.length;e++){const r=o[e],{annotationUID:s,data:l}=r,{points:c}=l.handles,u=c.map(e=>i.worldToCanvas(e));a.annotationUID=s;const{color:d,lineWidth:h,lineDash:p}=this.getAnnotationStyle({annotation:r,styleSpecifier:a});if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const f=`${s}-rect`,m="0";(0,ge.drawRect)(t,s,m,u[0],u[3],{color:d,lineDash:p,lineWidth:h},f),n=!0}return n},this.applyWindowLevelRegion=(e,t)=>{const n=(0,i.getEnabledElement)(t),{viewport:r}=n,o=Se.windowLevel.extractWindowLevelRegionToolData(r),{data:a}=e,{points:s}=a.handles,l=s.map(e=>r.worldToCanvas(e)),c=l[0],u=l[3];let d=Math.min(c[0],u[0]),h=Math.min(c[1],u[1]),p=Math.abs(c[0]-u[0]),f=Math.abs(c[1]-u[1]);d=i.utilities.clip(d,0,o.width),h=i.utilities.clip(h,0,o.height),p=Math.floor(Math.min(p,Math.abs(o.width-d))),f=Math.floor(Math.min(f,Math.abs(o.height-h)));const m=Se.windowLevel.getLuminanceFromRegion(o,Math.round(d),Math.round(h),p,f),g=Se.windowLevel.calculateMinMaxMean(m,o.minPixelValue,o.maxPixelValue);void 0===this.configuration.minWindowWidth&&(this.configuration.minWindowWidth=10);const v=Math.max(Math.abs(g.max-g.min),this.configuration.minWindowWidth),y=g.mean,_=i.utilities.windowLevel.toLowHighRange(v,y);r.setProperties({voiRange:_}),r.render()},this.cancel=()=>null,this.isPointNearTool=()=>null,this.toolSelectedCallback=()=>null,this.handleSelectedCallback=()=>null,this._activateModify=()=>null,this._deactivateModify=()=>null}}De.toolName="WindowLevelRegion";class Ae extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,t),this.deltaY=1}mouseWheelCallback(e){this._scroll(e)}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){this._scrollDrag(e)}_scrollDrag(e){const{deltaPoints:t,viewportId:n,renderingEngineId:r}=e.detail,{viewport:o}=(0,i.getEnabledElementByIds)(n,r),{debounceIfNotLoaded:a,invert:s,loop:l}=this.configuration,c=t.canvas[1];let u;o instanceof i.VolumeViewport&&(u=o.getVolumeId());const d=this._getPixelPerImage(o),h=c+this.deltaY;if(d)if(Math.abs(h)>=d){const e=Math.round(h/d);i.utilities.scroll(o,{delta:s?-e:e,volumeId:u,debounceLoading:a,loop:l}),this.deltaY=h%d}else this.deltaY=h}_scroll(e){const{wheel:t,element:n}=e.detail,{direction:r}=t,{invert:o}=this.configuration,{viewport:a}=(0,i.getEnabledElement)(n),s=r*(o?-1:1);i.utilities.scroll(a,{delta:s,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:a instanceof i.BaseVolumeViewport?a.getVolumeId():void 0,scrollSlabs:this.configuration.scrollSlabs})}_getPixelPerImage(e){const{element:t}=e,n=e.getNumberOfSlices();return Math.max(2,t.offsetHeight/Math.max(n,8))}}Ae.toolName="StackScroll";function Te(e,t){return 3===e[0].length?function(e,t){const[n,i]=e,[r,o]=t,a=he.eR.sub(he.eR.create(),i,n),s=he.eR.sub(he.eR.create(),r,o),l=he.eR.dot(a,s)/(he.eR.length(a)*he.eR.length(s));return 180*Math.acos(l)/Math.PI}(e,t):function(e,t){const[n,i]=e,[r,o]=t,a=he.Zc.sub(he.Zc.create(),i,n),s=he.Zc.sub(he.Zc.create(),r,o),l=he.Zc.dot(a,s)/(he.Zc.length(a)*he.Zc.length(s));return Math.acos(l)*(180/Math.PI)}(e,t)}class Ne extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.mouseWheelCallback=e=>{const{element:t,wheel:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:o}=r,{invert:a}=this.configuration,s=10*n.direction*(a?-1:1);this.setAngle(o,s)},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:t,currentPoints:n,startPoints:r}=e.detail,o=n.world,a=r.world,s=(0,i.getEnabledElement)(t),{viewport:l}=s,c=l.getCamera(),u=[.5*t.clientWidth,.5*t.clientHeight],d=l.canvasToWorld(u);let h=Te([a,d],[d,o]);const{viewPlaneNormal:p}=c,f=he.eR.sub(he.eR.create(),d,a),m=he.eR.sub(he.eR.create(),d,o),g=he.eR.cross(he.eR.create(),f,m);he.eR.dot(p,g)>0&&(h=-h),Number.isNaN(h)||this.setAngle(l,h)}setAngle(e,t){const{viewPlaneNormal:n,viewUp:r}=e.getCamera();if(e instanceof i.BaseVolumeViewport){const i=(t+360)%360*Math.PI/180,o=he.pB.identity(new Float32Array(16));he.pB.rotate(o,o,i,n);const a=he.eR.transformMat4(he.eR.create(),r,o);e.setCamera({viewUp:a})}else{const{rotation:n}=e.getViewPresentation();e.setViewPresentation({rotation:(n+t+360)%360})}e.render()}}Ne.toolName="PlanarRotate";class Oe extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,t),this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:r}=t,o=r.world,a=(0,i.getEnabledElement)(n).viewport.getCamera(),{focalPoint:s}=a;this.initialMousePosWorld=o;let l=he.eR.fromValues(s[0]-o[0],s[1]-o[1],s[2]-o[2]);return l=he.eR.normalize(he.eR.create(),l),this.dirVec=l,!1},this.preTouchStartCallback=e=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(e)},this._dragParallelProjection=(e,t,n,i=!1)=>{const{element:r,deltaPoints:o}=e.detail,a=i?e.detail.deltaDistance.canvas:o.canvas[1],s=[r.clientWidth,r.clientHeight],{parallelScale:l,focalPoint:c,position:u}=n,d=a*(5/s[1])*(this.configuration.invert?-1:1),h=(1-d)*l;let p=c,f=u;if(!this.configuration.zoomToCenter){const e=he.eR.distance(c,this.initialMousePosWorld);f=he.eR.scaleAndAdd(he.eR.create(),u,this.dirVec,-e*d),p=he.eR.scaleAndAdd(he.eR.create(),c,this.dirVec,-e*d)}const m=t.getImageData();let g=[1,1,1];m&&(g=m.spacing);const{minZoomScale:v,maxZoomScale:y}=this.configuration,_=r.clientHeight*g[1]*.5,w=_/h;let E=h,b=!1;m&&(w<v?(E=_/v,b=!0):w>=y&&(E=_/y,b=!0)),t.setCamera({parallelScale:E,focalPoint:b?c:p,position:b?u:f})},this._dragPerspectiveProjection=(e,t,n,i=!1)=>{const{element:r,deltaPoints:o}=e.detail,a=i?e.detail.deltaDistance.canvas:o.canvas[1],s=[r.clientWidth,r.clientHeight],{position:l,focalPoint:c,viewPlaneNormal:u}=n,d=we.Ay.distance2BetweenPoints(l,c),h=Math.sqrt(d)/s[1],p=[-u[0],-u[1],-u[2]],f=this.configuration.invert?a/h:a*h;let m=f*p[0];l[0]+=m,c[0]+=m,m=f*p[1],l[1]+=m,c[1]+=m,m=f*p[2],l[2]+=m,c[2]+=m,t.setCamera({position:l,focalPoint:c})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:t,currentPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:o}=r,a=o.getCamera(),s=n.world,{focalPoint:l}=a;this.initialMousePosWorld=s;let c=he.eR.fromValues(l[0]-s[0],l[1]-s[1],l[2]-s[2]);c=he.eR.normalize(he.eR.create(),c),this.dirVec=c,a.parallelProjection?this._dragParallelProjection(e,o,a,!0):this._dragPerspectiveProjection(e,o,a,!0),o.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:t}=e.detail,n=(0,i.getEnabledElement)(t),{viewport:r}=n,o=r.getCamera();o.parallelProjection?this._dragParallelProjection(e,r,o):this._dragPerspectiveProjection(e,r,o),r.render()}_panCallback(e){const{element:t,deltaPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),o=n.world,a=r.viewport.getCamera(),{focalPoint:s,position:l}=a,c=[l[0]-o[0],l[1]-o[1],l[2]-o[2]],u=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];r.viewport.setCamera({focalPoint:u,position:c}),r.viewport.render()}}Oe.toolName="Zoom";var Pe=n(13165);class Me extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}){super(e,t)}mouseClickCallback(e){const{element:t,currentPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:o,renderingEngine:a}=r,s=o.getVolumeId();if(!s)throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");let l=-1/0;const c=(0,Pe.getPointInLineOfSightWithCriteria)(o,n.world,s,(e,t)=>{if(e>l)return l=e,t});if(!c||!c.length)return;const{targetViewportIds:u,toolGroupId:d}=this.configuration;a.getViewports().filter(e=>{if(u?.indexOf(e.id)>=0)return!0;const t=(0,R.getToolGroupForViewport)(e.id,a.id);return!(!d||d!==t?.id)}).forEach(e=>{e instanceof i.VolumeViewport?e.jumpToWorld(c):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")})}}Me.toolName="MIPJumpToClickTool";var ke=n(89265),Re=n(35381),Le=n(93258);const{RENDERING_DEFAULTS:Fe}=i.CONSTANTS;function Ue(){return"rgb(0, 200, 0)"}function Be(){return!0}function Ve(){return!0}function We(){return!0}const je=1,He=2,ze=3;class Ge extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},referenceLinesCenterGapRadius:20,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:i.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND,mobile:{enabled:!1,opacity:.8,handleRadius:9}}}){super(e,t),this.toolCenter=[0,0,0],this.initializeViewport=({renderingEngineId:e,viewportId:t})=>{const n=(0,i.getEnabledElementByIds)(t,e),{FrameOfReferenceUID:o,viewport:a}=n,{element:s}=a,{position:l,focalPoint:c,viewPlaneNormal:u}=a.getCamera();let d=this._getAnnotations(n);d=this.filterInteractableAnnotationsForElement(s,d),d.length&&(0,r.removeAnnotation)(d[0].annotationUID);const h={highlighted:!1,metadata:{cameraPosition:[...l],cameraFocalPoint:[...c],FrameOfReferenceUID:o,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:t}};return(0,r.addAnnotation)(h,s),{normal:u,point:a.canvasToWorld([a.canvas.clientWidth/2,a.canvas.clientHeight/2])}},this._getViewportsInfo=()=>(0,R.getToolGroup)(this.toolGroupId).viewportsInfo,this.resetCrosshairs=()=>{const e=this._getViewportsInfo();for(const t of e){const{viewportId:e,renderingEngineId:n}=t,o=(0,i.getEnabledElementByIds)(e,n),a=o.viewport,s=!0,l=!0,c=!0,u=!0,d=!0;a.resetCamera({resetPan:s,resetZoom:l,resetToCenter:c,resetRotation:u,suppressEvents:d}),a.resetSlabThickness();const{element:h}=a;let p=this._getAnnotations(o);p=this.filterInteractableAnnotationsForElement(h,p),p.length&&(0,r.removeAnnotation)(p[0].annotationUID),a.render()}this._computeToolCenter(e)},this.computeToolCenter=()=>{const e=this._getViewportsInfo();this._computeToolCenter(e)},this._computeToolCenter=e=>{if(!e.length||1===e.length)return void console.warn("For crosshairs to operate, at least two viewports must be given.");const[t,n,r]=e,{normal:o,point:a}=this.initializeViewport(t),{normal:s,point:l}=this.initializeViewport(n);let c=[0,0,0],u=he.eR.create();r?({normal:c,point:u}=this.initializeViewport(r)):(he.eR.add(u,a,l),he.eR.scale(u,u,.5),he.eR.cross(c,o,s));const d=i.utilities.planar.planeEquation(o,a),h=i.utilities.planar.planeEquation(s,l),p=i.utilities.planar.planeEquation(c,u);this.toolCenter=i.utilities.planar.threePlaneIntersection(d,h,p),(0,O.A)(e.map(({viewportId:e})=>e))},this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.world,a=(0,i.getEnabledElement)(n),{viewport:s}=a;this._jump(a,o);const l=this._getAnnotations(a),c=this.filterInteractableAnnotationsForElement(s.element,l),{data:u}=c[0],{rotationPoints:d}=u.handles,h=[];for(let e=0;e<d.length-1;++e){const t=d[e][1],n=this._getReferenceLineControllable(t.id),i=this._getReferenceLineDraggableRotatable(t.id);n&&i&&(h.push(t.id),e++)}return u.activeViewportIds=[...h],u.handles.activeOperation=je,e.preventDefault(),(0,Ie.hideElementCursor)(n),this._activateModify(n),c[0]},this.cancel=()=>{console.log("Not implemented yet")},this.handleSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0,this._activateModify(i),(0,Ie.hideElementCursor)(i),e.preventDefault()},this.isPointNearTool=(e,t,n,i)=>!!this._pointNearTool(e,t,n,6),this.toolSelectedCallback=(e,t,n)=>{const i=e.detail,{element:r}=i;t.highlighted=!0,this._activateModify(r),(0,Ie.hideElementCursor)(r),e.preventDefault()},this.onCameraModified=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{renderingEngine:o}=r,a=r.viewport,s=this._getAnnotations(r),l=this.filterInteractableAnnotationsForElement(n,s)[0];if(!l)return;const c=a.getCamera(),u=l.metadata.cameraPosition,d=[0,0,0];we.Ay.subtract(c.position,u,d);const h=l.metadata.cameraFocalPoint,p=[0,0,0];we.Ay.subtract(c.focalPoint,h,p),l.metadata.cameraPosition=[...c.position],l.metadata.cameraFocalPoint=[...c.focalPoint];const f=this._getReferenceLineControllable(a.id),m=this._getReferenceLineDraggableRotatable(a.id);if(!i.utilities.isEqual(c.position,u,.001)&&f&&m){let e=!1;i.utilities.isEqual(d,p,.001)||(e=!0);const t=Math.abs(we.Ay.dot(d,c.viewPlaneNormal))<.01;e||t||(this.toolCenter[0]+=d[0],this.toolCenter[1]+=d[1],this.toolCenter[2]+=d[2])}if(this.configuration.autoPan?.enabled){(0,R.getToolGroupForViewport)(a.id,o.id).getViewportIds().filter(e=>e!==a.id).forEach(e=>{this._autoPanViewportIfNecessary(e,o)})}const g=(0,Ce.getViewportIdsWithToolToRender)(n,this.getToolName(),!1);(0,O.A)(g)},this.onResetCamera=e=>{this.resetCrosshairs()},this.mouseMoveCallback=(e,t)=>{const{element:n,currentPoints:i}=e.detail,r=i.canvas;let o=!1;for(let e=0;e<t.length;e++){const i=t[e];if((0,B.isAnnotationLocked)(i.annotationUID))continue;const{data:a,highlighted:s}=i;if(!a.handles)continue;const l=a.handles.activeOperation,c=a.activeViewportIds&&a.activeViewportIds.length>0?[...a.activeViewportIds]:[];a.activeViewportIds=[],a.handles.activeOperation=null;let u=!1;u=!!this.getHandleNearImagePoint(n,i,r,6)||this._pointNearTool(n,i,r,6);u&&!s||!u&&s?(i.highlighted=!s,o=!0):a.handles.activeOperation===l&&this._areViewportIdArraysEqual(a.activeViewportIds,c)||(o=!0)}return o},this.filterInteractableAnnotationsForElement=(e,t)=>{if(!t||!t.length)return[];const n=(0,i.getEnabledElement)(e),{viewportId:r}=n,o=t.filter(e=>e.data.viewportId===r);return o},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i,renderingEngine:r}=e,{element:o}=i,a=this._getAnnotations(e),s=i.getCamera(),l=this.filterInteractableAnnotationsForElement(o,a)[0];if(!a?.length||!l?.data)return n;const c=l.annotationUID,{clientWidth:u,clientHeight:d}=i.canvas,h=Math.sqrt(u*u+d*d),p=Math.min(u,d),f=l.data,m=i.worldToCanvas(this.toolCenter),g=this._filterAnnotationsByUniqueViewportOrientations(e,a),v=[],y=[0,0,u,d];g.forEach(e=>{const{data:t}=e;t.handles.toolCenter=this.toolCenter;const n=r.getViewport(t.viewportId),o=n.getCamera(),a=this._getReferenceLineControllable(n.id),l=this._getReferenceLineDraggableRotatable(n.id),c=this._getReferenceLineSlabThicknessControlsOn(n.id),{clientWidth:u,clientHeight:d}=n.canvas,f=Math.sqrt(u*u+d*d),_=[.5*u,.5*d],w=n.canvasToWorld(_),E=[0,0,0];we.Ay.cross(s.viewPlaneNormal,o.viewPlaneNormal,E),we.Ay.normalize(E),we.Ay.multiplyScalar(E,f);const b=[0,0,0];we.Ay.add(w,E,b);const x=[0,0,0];we.Ay.subtract(w,E,x);const C=i.worldToCanvas(b),I=i.worldToCanvas(w),S=he.Zc.create();he.Zc.subtract(S,C,I),he.Zc.normalize(S,S);const D=he.Zc.create();he.Zc.scale(D,S,100*h);const A=he.Zc.create();he.Zc.scale(A,S,.4*p);const T=he.Zc.create();he.Zc.scale(T,S,.2*p);const N=he.Zc.create(),O=this.configuration.referenceLinesCenterGapRadius;he.Zc.scale(N,S,2===g.length?O:0);const P=he.Zc.create(),M=he.Zc.create(),k=he.Zc.create(),R=he.Zc.create();let L=he.Zc.clone(m);l&&a||(L=he.Zc.clone(I)),he.Zc.add(P,L,N),he.Zc.add(M,L,D),he.Zc.subtract(k,L,N),he.Zc.subtract(R,L,D),(0,Re.A)(P,M,y),(0,Re.A)(k,R,y);const F=he.Zc.create();he.Zc.subtract(F,m,A);const U=he.Zc.create();he.Zc.add(U,m,A);let B=he.Zc.clone(m);!l&&c&&(B=he.Zc.clone(I));let V=[...this.toolCenter];!l&&c&&(V=[...w]);const W=[0,0,0];we.Ay.subtract(b,x,W),we.Ay.normalize(W);const{viewPlaneNormal:j}=s,{matrix:H}=ke.A.buildFromDegree().rotate(90,j),z=[0,0,0];he.eR.transformMat4(z,W,H);const G=n.getSlabThickness(),q=[...z];we.Ay.multiplyScalar(q,G);const $=[0,0,0];we.Ay.add(V,q,$);const X=i.worldToCanvas($),K=he.Zc.create();he.Zc.subtract(K,B,X);const Y=he.Zc.create();he.Zc.subtract(Y,B,D),he.Zc.add(Y,Y,K);const J=he.Zc.create();he.Zc.add(J,B,D),he.Zc.add(J,J,K),(0,Re.A)(Y,J,y);const Z=he.Zc.create();he.Zc.add(Z,B,D),he.Zc.subtract(Z,Z,K);const Q=he.Zc.create();he.Zc.subtract(Q,B,D),he.Zc.subtract(Q,Q,K),(0,Re.A)(Z,Q,y);const ee=he.Zc.create(),te=he.Zc.create(),ne=he.Zc.create(),ie=he.Zc.create();he.Zc.subtract(ee,B,T),he.Zc.add(ee,ee,K),he.Zc.add(te,B,T),he.Zc.add(te,te,K),he.Zc.subtract(ne,B,T),he.Zc.subtract(ne,ne,K),he.Zc.add(ie,B,T),he.Zc.subtract(ie,ie,K),v.push([n,P,M,k,R,Y,J,Z,Q,F,U,ee,te,ne,ie])});const _=[],w=[],E=this._getReferenceLineColor(i.id),b=void 0!==E?E:"rgb(200, 200, 200)";if(v.forEach((e,n)=>{const r=e[0],o=this._getReferenceLineColor(r.id),a=this._getReferenceLineControllable(r.id),s=this._getReferenceLineDraggableRotatable(r.id)||this.configuration.mobile?.enabled,l=this._getReferenceLineSlabThicknessControlsOn(r.id)||this.configuration.mobile?.enabled,u=f.activeViewportIds.find(e=>e===r.id);let d=void 0!==o?o:"rgb(200, 200, 200)",h=1;const p=null!==f.handles.activeOperation&&f.handles.activeOperation===je&&u;p&&(h=2.5);let m=`${n}`;if(a&&s?(m=`${n}One`,(0,ge.drawLine)(t,c,m,e[1],e[2],{color:d,lineWidth:h}),m=`${n}Two`,(0,ge.drawLine)(t,c,m,e[3],e[4],{color:d,lineWidth:h})):(0,ge.drawLine)(t,c,m,e[2],e[4],{color:d,lineWidth:h}),a){d=void 0!==o?o:"rgb(200, 200, 200)";const a=f.handles.activeOperation===He,h=[e[9],e[10]],g=[i.canvasToWorld(e[9]),r,e[1],e[2]],v=[i.canvasToWorld(e[10]),r,e[3],e[4]];_.push(g,v);const y=f.handles.activeOperation===ze,E=[e[11],e[12],e[13],e[14]],b=[i.canvasToWorld(e[11]),r,e[5],e[6]],x=[i.canvasToWorld(e[12]),r,e[5],e[6]],C=[i.canvasToWorld(e[13]),r,e[7],e[8]],I=[i.canvasToWorld(e[14]),r,e[7],e[8]];if(w.push(b,x,C,I),(p||this.configuration.mobile?.enabled)&&!a&&!y&&s&&l){let e=`${n}One`;(0,ge.drawHandles)(t,c,e,h,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"circle"}),e=`${n}Two`,(0,ge.drawHandles)(t,c,e,E,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"rect"})}else if(p&&!a&&!y&&s){const e=`${n}`;(0,ge.drawHandles)(t,c,e,h,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"circle"})}else if(u&&!a&&!y&&l){const e=`${n}`;(0,ge.drawHandles)(t,c,e,E,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"rect"})}else if(a&&s){const e=`${n}`;(0,ge.drawHandles)(t,c,e,h,{color:d,handleRadius:2,fill:d,type:"circle"})}else y&&u&&l&&(0,ge.drawHandles)(t,c,m,E,{color:d,handleRadius:2,fill:d,type:"rect"});r.getSlabThickness()>.5&&l&&(m=`${n}STOne`,(0,ge.drawLine)(t,c,m,e[5],e[6],{color:d,width:1,lineDash:[2,3]}),m=`${n}STTwo`,(0,ge.drawLine)(t,c,m,e[7],e[8],{color:d,width:e,lineDash:[2,3]}))}}),n=!0,f.handles.rotationPoints=_,f.handles.slabThicknessPoints=w,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:e}=this.configuration,n=[u*(e?.xOffset||.95),d*(e?.yOffset||.05)],i=e?.circleRadius||.01*h,r="0";(0,ge.drawCircle)(t,c,r,n,i,{color:b,fill:b})}return n},this._getAnnotations=e=>{const{viewport:t}=e,n=(0,r.getAnnotations)(this.getToolName(),t.element)||[],i=this._getViewportsInfo().map(({viewportId:e})=>e),o=n.filter(e=>{const{data:t}=e;return i.includes(t.viewportId)});return o},this._onNewVolume=()=>{const e=this._getViewportsInfo();this._computeToolCenter(e)},this._areViewportIdArraysEqual=(e,t)=>e.length===t.length&&(e.forEach(e=>{let n=!1;for(let i=0;i<t.length;++i)if(e===t[i]){n=!0;break}if(!1===n)return!1}),!0),this._getAnnotationsForViewportsWithDifferentCameras=(e,t)=>{const{viewportId:n,renderingEngine:r,viewport:o}=e,a=t.filter(e=>e.data.viewportId!==n);if(!a||!a.length)return[];const s=o.getCamera(),{viewPlaneNormal:l,position:c}=s,u=a.filter(e=>{const{viewportId:t}=e.data,n=r.getViewport(t).getCamera();return!(i.utilities.isEqual(n.viewPlaneNormal,l,.01)&&i.utilities.isEqual(n.position,c,1))});return u},this._filterViewportWithSameOrientation=(e,t,n)=>{const{renderingEngine:r}=e,{data:o}=t,a=r.getViewport(o.viewportId),s=n.filter(e=>{const{data:t}=e,n=r.getViewport(t.viewportId);return!0===this._getReferenceLineControllable(n.id)});if(!s||!s.length)return[];const l=a.getCamera(),c=l.viewPlaneNormal;we.Ay.normalize(c);const u=s.filter(e=>{const{viewportId:t}=e.data,n=r.getViewport(t).getCamera(),o=n.viewPlaneNormal;return we.Ay.normalize(o),i.utilities.isEqual(c,o,.01)&&i.utilities.isEqual(l.viewUp,n.viewUp,.01)});return u},this._filterAnnotationsByUniqueViewportOrientations=(e,t)=>{const{renderingEngine:n,viewport:r}=e,o=r.getCamera().viewPlaneNormal;we.Ay.normalize(o);const a=t.filter(e=>{const{data:t}=e,i=n.getViewport(t.viewportId),o=this._getReferenceLineControllable(i.id);return r!==i&&!0===o}),s=[];for(let e=0;e<a.length;++e){const t=a[e],{viewportId:r}=t.data,l=n.getViewport(r).getCamera(),c=l.viewPlaneNormal;if(we.Ay.normalize(c),i.utilities.isEqual(o,c,.01)||i.utilities.isOpposite(o,c,.01))continue;let u=!1;for(let e=0;e<s.length;++e){const t=s[e],{viewportId:r}=t.data,o=n.getViewport(r).getCamera();i.utilities.isEqual(o.viewPlaneNormal,l.viewPlaneNormal,.01)&&i.utilities.isEqual(o.position,l.position,1)&&(u=!0)}u||s.push(t)}const l=t.filter(e=>{const{data:t}=e,i=n.getViewport(t.viewportId),o=this._getReferenceLineControllable(i.id);return r!==i&&!0!==o});for(let e=0;e<l.length;++e){const t=l[e],{viewportId:r}=t.data,a=n.getViewport(r).getCamera(),c=a.viewPlaneNormal;if(we.Ay.normalize(c),i.utilities.isEqual(o,c,.01)||i.utilities.isOpposite(o,c,.01))continue;let u=!1;for(let e=0;e<s.length;++e){const t=s[e],{viewportId:r}=t.data,o=n.getViewport(r).getCamera();i.utilities.isEqual(o.viewPlaneNormal,a.viewPlaneNormal,.01)&&i.utilities.isEqual(o.position,a.position,1)&&(u=!0)}u||s.push(t)}const c=this._getAnnotationsForViewportsWithDifferentCameras(e,t);for(let e=0;e<c.length;++e){const t=c[e];if(s.some(e=>e===t))continue;const{viewportId:r}=t.data,a=n.getViewport(r).getCamera(),l=a.viewPlaneNormal;if(we.Ay.normalize(l),i.utilities.isEqual(o,l,.01)||i.utilities.isOpposite(o,l,.01))continue;let u=!1;for(let e=0;e<s.length;++e){const t=s[e],{viewportId:r}=t.data,o=n.getViewport(r).getCamera();i.utilities.isEqual(o.viewPlaneNormal,a.viewPlaneNormal,.01)&&i.utilities.isEqual(o.position,a.position,1)&&(u=!0)}u||s.push(t)}return s},this._checkIfViewportsRenderingSameScene=(e,t)=>{const n=e.getAllVolumeIds(),i=t.getAllVolumeIds();return n.length===i.length&&n.every(e=>i.includes(e))},this._jump=(e,t)=>{M.wk.isInteractingWithTool=!0;const{viewport:n,renderingEngine:i}=e,r=this._getAnnotations(e),o=[0,0,0];we.Ay.subtract(t,this.toolCenter,o);const a=this._getAnnotationsForViewportsWithDifferentCameras(e,r).filter(e=>{const{data:t}=e,r=i.getViewport(t.viewportId),o=this._checkIfViewportsRenderingSameScene(n,r);return this._getReferenceLineControllable(r.id)&&this._getReferenceLineDraggableRotatable(r.id)&&o});return 0===a.length?(M.wk.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(i,a,o),M.wk.isInteractingWithTool=!1,!0)},this._activateModify=e=>{M.wk.isInteractingWithTool=!this.configuration.mobile?.enabled,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._endCallback=e=>{const t=e.detail,{element:n}=t;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(n),(0,Ie.resetElementCursor)(n),this.editData=null;const i=(0,Ce.getViewportIdsWithToolToRender)(n,this.getToolName(),!1);(0,O.A)(i)},this._dragCallback=e=>{const t=e.detail,n=t.deltaPoints.world;if(Math.abs(n[0])<.001&&Math.abs(n[1])<.001&&Math.abs(n[2])<.001)return;const{element:r}=t,o=(0,i.getEnabledElement)(r),{renderingEngine:a,viewport:s}=o,l=this._getAnnotations(o),c=this.filterInteractableAnnotationsForElement(r,l)[0];if(!c)return;const{handles:u}=c.data,{currentPoints:d}=e.detail,h=d.canvas;if(u.activeOperation===je){const e=this._getAnnotationsForViewportsWithDifferentCameras(o,l).filter(e=>{const{data:t}=e,n=a.getViewport(t.viewportId),i=this._getReferenceLineControllable(n.id),r=this._getReferenceLineDraggableRotatable(n.id);return!0===i&&!0===r&&c.data.activeViewportIds.find(e=>e===n.id)});this._applyDeltaShiftToSelectedViewportCameras(a,e,n)}else if(u.activeOperation===He){const e=this._getAnnotationsForViewportsWithDifferentCameras(o,l).filter(e=>{const{data:t}=e,n=a.getViewport(t.viewportId),i=this._getReferenceLineControllable(n.id),r=this._getReferenceLineDraggableRotatable(n.id);return!0===i&&!0===r}),n=he.Zc.create(),i=he.Zc.create(),r=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],c=s.worldToCanvas(r),u=t.currentPoints.canvas,d=he.Zc.create();he.Zc.sub(d,u,t.deltaPoints.canvas),he.Zc.sub(n,d,c),he.Zc.sub(i,u,c);let h=he.Zc.angle(n,i);this._isClockWise(c,d,u)&&(h*=-1),h=Math.round(100*h)/100;const p=s.getCamera().viewPlaneNormal,{matrix:f}=ke.A.buildFromRadian().translate(r[0],r[1],r[2]).rotate(h,p).translate(-r[0],-r[1],-r[2]),m=[];e.forEach(e=>{const{data:t}=e;t.handles.toolCenter=r;const n=a.getViewport(t.viewportId),i=n.getCamera(),{viewUp:o,position:s,focalPoint:l}=i;o[0]+=s[0],o[1]+=s[1],o[2]+=s[2],he.eR.transformMat4(l,l,f),he.eR.transformMat4(s,s,f),he.eR.transformMat4(o,o,f),o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],n.setCamera({position:s,viewUp:o,focalPoint:l}),m.push(n.id)}),a.renderViewports(m)}else if(u.activeOperation===ze){const e=this._getAnnotationsForViewportsWithDifferentCameras(o,l).filter(e=>{const{data:t}=e,n=a.getViewport(t.viewportId),i=this._getReferenceLineControllable(n.id),r=this._getReferenceLineSlabThicknessControlsOn(n.id);return!0===i&&!0===r&&c.data.activeViewportIds.find(e=>e===n.id)});if(0===e.length)return;const r=this._filterViewportWithSameOrientation(o,e[0],l),u=[];u.push(s.id),r.forEach(e=>{const{data:r}=e,o=a.getViewport(r.viewportId),l=o.getCamera().viewPlaneNormal,d=we.Ay.dot(n,l),p=[...l];if(we.Ay.multiplyScalar(p,d),Math.abs(p[0])>.001||Math.abs(p[1])>.001||Math.abs(p[2])>.001){const e=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]),n=t.lastPoints.world,r=[0,0,0],d=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(o.id)){const{rotationPoints:e}=this.editData.annotation.data.handles,t=e.filter(e=>e[1].uid===o.id);if(2===t.length){const e=s.canvasToWorld(t[0][3]),n=s.canvasToWorld(t[1][3]);we.Ay.add(e,n,d),we.Ay.multiplyScalar(d,.5)}}we.Ay.subtract(n,d,r);const f=we.Ay.dot(r,l),m=[...l];we.Ay.multiplyScalar(m,f);const g=[m[0],m[1],m[2]];he.eR.normalize(g,g);const v=[p[0],p[1],p[2]];he.eR.normalize(v,v);let y=o.getSlabThickness();i.utilities.isOpposite(g,v,.001)?y-=e:y+=e,y=Math.abs(y),y=Math.max(Fe.MINIMUM_SLAB_THICKNESS,y);this._pointNearReferenceLine(c,h,6,o)&&(y=Fe.MINIMUM_SLAB_THICKNESS);(0,R.getToolGroupForViewport)(o.id,a.id).getToolInstance(this.getToolName()).setSlabThickness(o,y),u.push(o.id)}}),a.renderViewports(u)}},this._pointNearReferenceLine=(e,t,n,i)=>{const{data:r}=e,{rotationPoints:o}=r.handles;for(let e=0;e<o.length-1;++e){const r=o[e][1];if(r.id!==i.id)continue;if(!this._getReferenceLineControllable(r.id))continue;const a={start:{x:o[e][2][0],y:o[e][2][1]},end:{x:o[e][3][0],y:o[e][3][1]}},s=Le.distanceToPoint([a.start.x,a.start.y],[a.end.x,a.end.y],[t[0],t[1]]),l={start:{x:o[e+1][2][0],y:o[e+1][2][1]},end:{x:o[e+1][3][0],y:o[e+1][3][1]}},c=Le.distanceToPoint([l.start.x,l.start.y],[l.end.x,l.end.y],[t[0],t[1]]);if(s<=n||c<=n)return!0;e++}return!1},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||Ue,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||Be,this._getReferenceLineDraggableRotatable=e.configuration?.getReferenceLineDraggableRotatable||Ve,this._getReferenceLineSlabThicknessControlsOn=e.configuration?.getReferenceLineSlabThicknessControlsOn||We}onSetToolActive(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e)}onSetToolPassive(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolEnabled(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolDisabled(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:e,viewportId:t})=>{const n=(0,i.getEnabledElementByIds)(t,e);if(!n)return;const o=this._getAnnotations(n);o?.length&&o.forEach(e=>{(0,r.removeAnnotation)(e.annotationUID)})})}getHandleNearImagePoint(e,t,n,r){const o=(0,i.getEnabledElement)(e),{viewport:a}=o;let s=this._getRotationHandleNearImagePoint(a,t,n,r);return null!==s?s:(s=this._getSlabThicknessHandleNearImagePoint(a,t,n,r),null!==s?s:void 0)}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,i.getEnabledElementByIds)(e,t),{element:r}=n;r.removeEventListener(i.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,i.getEnabledElementByIds)(e,t),{element:r}=n;r.addEventListener(i.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_autoPanViewportIfNecessary(e,t){const n=t.getViewport(e),{clientWidth:i,clientHeight:r}=n.canvas,o=n.worldToCanvas(this.toolCenter),a=this.configuration.autoPan.panSize,s=[o[0],o[1]];if(o[0]<0?s[0]=a:o[0]>i&&(s[0]=i-a),o[1]<0?s[1]=a:o[1]>r&&(s[1]=r-a),s[0]===o[0]&&s[1]===o[1])return;const l=n.canvasToWorld(s),c=[l[0]-this.toolCenter[0],l[1]-this.toolCenter[1],l[2]-this.toolCenter[2]],u=n.getCamera(),{focalPoint:d,position:h}=u,p=[h[0]-c[0],h[1]-c[1],h[2]-c[2]],f=[d[0]-c[0],d[1]-c[1],d[2]-c[2]];n.setCamera({focalPoint:f,position:p}),n.render()}setSlabThickness(e,t){let n;const{filterActorUIDsToSetSlabThickness:r}=this.configuration;r&&r.length>0&&(n=r);let o=this.configuration.slabThicknessBlendMode;t===Fe.MINIMUM_SLAB_THICKNESS&&(o=i.Enums.BlendModes.COMPOSITE);e.setBlendMode(o,n,!1),e.setSlabThickness(t,n)}_isClockWise(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])>0}_applyDeltaShiftToSelectedViewportCameras(e,t,n){t.forEach(t=>{this._applyDeltaShiftToViewportCamera(e,t,n)})}_applyDeltaShiftToViewportCamera(e,t,n){const{data:i}=t,r=e.getViewport(i.viewportId),o=r.getCamera(),a=o.viewPlaneNormal,s=we.Ay.dot(n,a),l=[...a];if(we.Ay.multiplyScalar(l,s),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const e=[0,0,0],t=[0,0,0];we.Ay.add(o.focalPoint,l,e),we.Ay.add(o.position,l,t),r.setCamera({focalPoint:e,position:t}),r.render()}}_getRotationHandleNearImagePoint(e,t,n,i){const{data:r}=t,{rotationPoints:o}=r.handles;for(let a=0;a<o.length;a++){const s=o[a][0],l=o[a][1];if(!this._getReferenceLineControllable(l.id))continue;if(!this._getReferenceLineDraggableRotatable(l.id))continue;const c=e.worldToCanvas(s);if(he.Zc.distance(n,c)<i)return r.handles.activeOperation=He,this.editData={annotation:t},s}return null}_getSlabThicknessHandleNearImagePoint(e,t,n,i){const{data:r}=t,{slabThicknessPoints:o}=r.handles;for(let a=0;a<o.length;a++){const s=o[a][0],l=o[a][1];if(!this._getReferenceLineControllable(l.id))continue;if(!this._getReferenceLineSlabThicknessControlsOn(l.id))continue;const c=e.worldToCanvas(s);if(he.Zc.distance(n,c)<i)return r.handles.activeOperation=ze,r.activeViewportIds=[l.id],this.editData={annotation:t},s}return null}_pointNearTool(e,t,n,r){const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{clientWidth:s,clientHeight:l}=a.canvas,c=Math.sqrt(s*s+l*l),{data:u}=t,{rotationPoints:d}=u.handles,{slabThicknessPoints:h}=u.handles,p=[];for(let e=0;e<d.length-1;++e){const t=d[e][1],i=this._getReferenceLineControllable(t.id),o=this._getReferenceLineDraggableRotatable(t.id);if(!i||!o)continue;const a={start:{x:d[e][2][0],y:d[e][2][1]},end:{x:d[e][3][0],y:d[e][3][1]}},s=Le.distanceToPoint([a.start.x,a.start.y],[a.end.x,a.end.y],[n[0],n[1]]),l={start:{x:d[e+1][2][0],y:d[e+1][2][1]},end:{x:d[e+1][3][0],y:d[e+1][3][1]}},c=Le.distanceToPoint([l.start.x,l.start.y],[l.end.x,l.end.y],[n[0],n[1]]);(s<=r||c<=r)&&(p.push(t.id),u.handles.activeOperation=je),e++}for(let e=0;e<h.length-1;++e){const t=h[e][1];if(p.find(e=>e===t.id))continue;const i=this._getReferenceLineControllable(t.id),o=this._getReferenceLineSlabThicknessControlsOn(t.id);if(!i||!o)continue;const a=h[e][2],s=h[e][3],l=he.Zc.create();he.Zc.add(l,a,s),he.Zc.scale(l,l,.5);const d=he.Zc.create();he.Zc.subtract(d,a,l),he.Zc.normalize(d,d);const f=he.Zc.create();he.Zc.scale(f,d,.05*c);const m=he.Zc.create(),g=he.Zc.create();he.Zc.add(m,l,f),he.Zc.subtract(g,l,f);const v={start:{x:m[0],y:m[1]},end:{x:a[0],y:a[1]}},y=Le.distanceToPoint([v.start.x,v.start.y],[v.end.x,v.end.y],[n[0],n[1]]),_={start:{x:g[0],y:g[1]},end:{x:s[0],y:s[1]}},w=Le.distanceToPoint([_.start.x,_.start.y],[_.end.x,_.end.y],[n[0],n[1]]);(y<=r||w<=r)&&(p.push(t.id),u.handles.activeOperation=null),e++}return u.activeViewportIds=[...p],this.editData={annotation:t},u.handles.activeOperation===je}}Ge.toolName="Crosshairs";const qe="magnify-viewport";class $e extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}){super(e,t),this._hasBeenRemoved=!1,this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:r}=t,o=(0,i.getEnabledElement)(n),{viewport:a,renderingEngine:s}=o;if(!(a instanceof i.StackViewport))throw new Error("MagnifyTool only works on StackViewports");const l=this._getReferencedImageId(a);if(!l)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const c=(0,Ce.getViewportIdsWithToolToRender)(n,this.getToolName());return this.editData={referencedImageId:l,viewportIdsToRender:c,enabledElement:o,renderingEngine:s,currentPoints:r},this._createMagnificationViewport(),this._activateDraw(n),(0,Ie.hideElementCursor)(n),e.preventDefault(),(0,O.A)(c),!0},this.preTouchStartCallback=e=>{this.preMouseDownCallback(e)},this._createMagnificationViewport=()=>{const{enabledElement:e,referencedImageId:t,viewportIdsToRender:n,renderingEngine:r,currentPoints:o}=this.editData,{viewport:a}=e,{element:s}=a,l=a.getProperties(),{canvas:c,world:u}=o;let d;if(d=s.querySelector(".magnifyTool"),null===d){const e=document.createElement("div");e.classList.add("magnifyTool"),e.style.display="block",e.style.width=`${this.configuration.magnifyWidth}px`,e.style.height=`${this.configuration.magnifyHeight}px`,e.style.position="absolute",d=e;s.querySelector(".viewport-element").appendChild(e);const t={viewportId:qe,type:i.Enums.ViewportType.STACK,element:d};r.enableElement(t)}d.style.top=c[1]-this.configuration.magnifyHeight/2+"px",d.style.left=c[0]-this.configuration.magnifyWidth/2+"px";const h=r.getViewport(qe);h.setStack([t]).then(()=>{if(this._hasBeenRemoved)return;h.setProperties(l);const{parallelScale:e}=a.getCamera(),{focalPoint:t,position:n,viewPlaneNormal:i}=h.getCamera(),r=Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)+Math.pow(t[2]-n[2],2)),o=[u[0],u[1],u[2]],s=[o[0]+r*i[0],o[1]+r*i[1],o[2]+r*i[2]];h.setCamera({parallelScale:e*(1/this.configuration.magnifySize),focalPoint:o,position:s}),h.render()}),d.style.display="block",(0,O.A)(n)},this._dragCallback=e=>{const t=e.detail,{deltaPoints:n,element:r,currentPoints:o}=t,a=n.world,s=o.canvas,l=(0,i.getEnabledElement)(r),{renderingEngine:c}=l,u=c.getViewport(qe),d=r.querySelector(".magnifyTool");if(!d)return;d.style.top=s[1]-this.configuration.magnifyHeight/2+"px",d.style.left=s[0]-this.configuration.magnifyWidth/2+"px";const{focalPoint:h,position:p}=u.getCamera(),f=[p[0]+a[0],p[1]+a[1],p[2]+a[2]],m=[h[0]+a[0],h[1]+a[1],h[2]+a[2]];u.setCamera({focalPoint:m,position:f}),u.render()},this._dragEndCallback=e=>{const{element:t}=e.detail,n=(0,i.getEnabledElement)(t),{renderingEngine:r}=n;r.disableElement(qe);const o=t.querySelector(".viewport-element"),a=o.querySelector(".magnifyTool");o.removeChild(a),this._deactivateDraw(t),(0,Ie.resetElementCursor)(t),this._hasBeenRemoved=!0},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,this._hasBeenRemoved=!1,e.addEventListener(o.Events.MOUSE_UP,this._dragEndCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._dragEndCallback),e.addEventListener(o.Events.TOUCH_END,this._dragEndCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._dragEndCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._dragEndCallback),e.removeEventListener(o.Events.TOUCH_END,this._dragEndCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)}}_getReferencedImageId(e){const t=this.getTargetId(e);let n;return e instanceof i.StackViewport&&(n=t.split("imageId:")[1]),n}}$e.toolName="Magnify";var Xe=n(29614);function Ke(e){const[t,n]=e;return(0,Xe.distanceToPoint)(t,n)}function Ye(e){const[t,n]=e,i=(0,Xe.distanceToPoint)(t,n);return[[t[0]-i,t[1]-i],[t[0]+i,t[1]+i]]}var Je=n(52905);const{Events:Ze}=i.Enums,Qe=e=>e.uid!==e.referencedId;var et;!function(e){e.ShowZoomFactorsList="showZoomFactorsList"}(et||(et={}));const tt=1-i.CONSTANTS.EPSILON;class nt extends ye.EC{static{this.Actions=et}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:o.MouseBindings.Secondary,modifierKey:o.KeyboardBindings.Shift}]}}}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=(0,i.getEnabledElement)(o),{viewport:s,renderingEngine:l}=a,c=n.world,u=n.canvas,{magnifyingGlass:d}=this.configuration,{radius:h,zoomFactor:p,autoPan:f}=d,m=this._getCanvasHandlePoints(u,h),g=s.getCamera(),{viewPlaneNormal:v,viewUp:y}=g,_=this.getReferencedImageId(s,c,v,y),w=i.utilities.uuidv4(),E=i.utilities.uuidv4(),b=s.getFrameOfReferenceUID(),x={annotationUID:w,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...v],viewUp:[...y],FrameOfReferenceUID:b,referencedImageId:_},data:{sourceViewportId:s.id,magnifyViewportId:E,zoomFactor:p,isCanvasAnnotation:!0,handles:{points:m,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(x,{magnifyViewportId:E,sourceEnabledElement:a,position:u,radius:h,zoomFactor:p,autoPan:{enabled:f.enabled,padding:f.padding,callback:e=>{const t=x.data.handles.points,{canvas:n}=e.delta;for(let e=0,i=t.length;e<i;e++){const i=t[e];i[0]+=n[0],i[1]+=n[1],x.invalidated=!0}}}}),(0,r.addAnnotation)(x,o);const C=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return e.preventDefault(),(0,O.A)(C),x},this.onSetToolDisabled=()=>{this.magnifyViewportManager.dispose();(0,r.getAllAnnotations)().forEach(e=>{e.metadata.toolName===this.getToolName()&&(0,r.removeAnnotation)(e.annotationUID)})},this.isPointNearTool=(e,t,n,i)=>{const{data:r}=t,{points:o}=r.handles,a=o,s=a[0],l=a[2],c=a[3],u=.5*Math.abs(l[1]-s[1]),d=Ke([[c[0]+u,s[1]+u],n]);return Math.abs(d-u)<2*i},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0;const r=(0,Ce.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:r},(0,Ie.hideElementCursor)(i),this._activateModify(i),(0,O.A)(r),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const i=e.detail,{element:r}=i,{data:o}=t;t.highlighted=!0;const{points:a}=o.handles,s=a.findIndex(e=>e===n),l=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:s},this._activateModify(r),(0,Ie.hideElementCursor)(r),(0,O.A)(l),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:r,newAnnotation:o}=this.editData,{data:a}=i;a.handles.activeHandleIndex=null,this._deactivateModify(n),(0,Ie.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,(0,O.A)(r),o&&(0,xe.dZ)(i)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{deltaPoints:n}=t,i=n?.canvas??[0,0,0],{annotation:r,viewportIdsToRender:o}=this.editData,{points:a}=r.data.handles;a.forEach(e=>{e[0]+=i[0],e[1]+=i[1]}),r.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(o)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:r,handleIndex:o}=this.editData,{data:a}=i;if(void 0===o){const{deltaPoints:e}=t,n=e.canvas;a.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1]}),i.invalidated=!0}else this._dragHandle(e),i.invalidated=!0;(0,O.A)(r)},this._dragHandle=e=>{const t=e.detail,{annotation:n}=this.editData,{data:i}=n,{points:r}=i.handles,o=r,a=o[0],s=o[2],l=o[3],c=.5*Math.abs(s[1]-a[1]),u=[l[0]+c,a[1]+c],{currentPoints:d}=t,h=Ke([u,d.canvas]),p=this._getCanvasHandlePoints(u,h);r[0]=p[0],r[1]=p[1],r[2]=p[2],r[3]=p[3]},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,t.annotationUID},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;a=a?.filter(e=>e.data.sourceViewportId===i.id);const s=this.filterInteractableAnnotationsForElement(o,a);if(!s?.length)return n;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<s.length;e++){const r=s[e],{annotationUID:o,data:a}=r,{magnifyViewportId:c,zoomFactor:u,handles:d}=a,{points:h,activeHandleIndex:p}=d;l.annotationUID=o;this.getStyle("lineWidth",l,r),this.getStyle("lineDash",l,r);const f=this.getStyle("color",l,r),m=h,g=m[0],v=m[2],y=m[3],_=.5*Math.abs(v[1]-g[1]),w=[y[0]+_,g[1]+_];if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let E;if(!(0,V.isAnnotationVisible)(o))continue;if((0,B.isAnnotationLocked)(o)||this.editData||null===p||(E=[m[p]]),E){const e="0";(0,ge.drawHandles)(t,o,e,E,{color:f})}const b=`${o}-advancedMagnify`,x="0";(0,ge.drawCircle)(t,o,x,w,_,{color:f,lineWidth:5},b);const C=this.magnifyViewportManager.getViewport(c);C.position=w,C.radius=_,C.zoomFactor=u,C.update(),n=!0}return n},this._getCanvasHandlePoints=(e,t)=>[[e[0],e[1]-t,0],[e[0]+t,e[1],0],[e[0],e[1]+t,0],[e[0]-t,e[1],0]],this.magnifyViewportManager=it.getInstance()}showZoomFactorsList(e,t){const{element:n,currentPoints:r}=e.detail,o=(0,i.getEnabledElement)(n),{viewport:a}=o,{canvas:s}=r,l=n.querySelector(":scope .viewport-element"),c=t.data.zoomFactor,u=this._getZoomFactorsListDropdown(c,e=>{void 0!==e&&(t.data.zoomFactor=Number.parseFloat(e),t.invalidated=!0),u.parentElement.removeChild(u),a.render()});Object.assign(u.style,{left:`${s[0]}px`,top:`${s[1]}px`}),l.appendChild(u),u.focus()}_getZoomFactorsListDropdown(e,t){const{zoomFactorList:n}=this.configuration.magnifyingGlass,i=document.createElement("select");return i.size=5,Object.assign(i.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach(e=>{i.addEventListener(e,e=>e.stopPropagation())}),i.addEventListener("change",e=>{e.stopPropagation(),t(i.value)}),i.addEventListener("keydown",e=>{((e.keyCode??27===e.which)||"escape"===e.key?.toLowerCase())&&(e.stopPropagation(),t())}),n.forEach(t=>{const n=document.createElement("option");n.label=t,n.title=`Zoom factor ${t.toFixed(1)}`,n.value=t,n.defaultSelected=t===e,i.add(n)}),i}}class it{constructor(){this.createViewport=(e,t)=>{const{magnifyViewportId:n,sourceEnabledElement:i,position:r,radius:o,zoomFactor:a,autoPan:s}=t,{viewport:l}=i,{element:c}=l,u=new rt({magnifyViewportId:n,sourceEnabledElement:i,radius:o,position:r,zoomFactor:a,autoPan:s});return this._addSourceElementEventListener(c),this._magnifyViewportsMap.set(u.viewportId,{annotation:e,magnifyViewport:u,magnifyViewportInfo:t}),u},this._annotationRemovedCallback=e=>{const{annotation:t}=e.detail;"AdvancedMagnify"===t.metadata.toolName&&this.destroyViewport(t.data.magnifyViewportId)},this._newStackImageCallback=e=>{const{viewportId:t,imageId:n}=e.detail,r=this._getMagnifyViewportsMapEntriesBySourceViewportId(t),{viewport:o}=(0,i.getEnabledElementByViewportId)(t);o.stackActorReInitialized&&this._reset(t),r.forEach(({annotation:e})=>{e.metadata.referencedImageId=n,e.invalidated=!0})},this._newVolumeImageCallback=e=>{const{renderingEngineId:t,viewportId:n}=e.detail,r=(0,i.getRenderingEngine)(t).getViewport(n),{viewPlaneNormal:o}=r.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(n).forEach(({annotation:e})=>{const{viewPlaneNormal:t}=e.metadata;if(!(Math.abs(he.eR.dot(t,o))>tt))return;const{handles:n}=e.data,i=r.canvasToWorld([0,0]),a=he.eR.sub(he.eR.create(),i,n.points[0]),s=he.eR.dot(a,o),l=he.eR.scale(he.eR.create(),o,s);for(let e=0,t=n.points.length;e<t;e++){const t=n.points[e];t[0]+=l[0],t[1]+=l[1],t[2]+=l[2]}e.invalidated=!0})},this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){return it._singleton=it._singleton??new it,it._singleton}getViewport(e){return this._magnifyViewportsMap.get(e)?.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(e){const t=this._magnifyViewportsMap.get(e);if(t){const{magnifyViewport:n}=t,{viewport:i}=n.sourceEnabledElement,{element:r}=i;this._removeSourceElementEventListener(r),n.dispose(),this._magnifyViewportsMap.delete(e)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach(e=>this.destroyViewport(e))}_getMagnifyViewportsMapEntriesBySourceViewportId(e){return Array.from(this._magnifyViewportsMap.values()).filter(({magnifyViewport:t})=>{const{viewport:n}=t.sourceEnabledElement;return n.id===e})}_reset(e){this._getMagnifyViewportsMapEntriesBySourceViewportId(e).forEach(({magnifyViewport:t,annotation:n,magnifyViewportInfo:r})=>{this.destroyViewport(t.viewportId);const o=(0,i.getEnabledElementByViewportId)(e);this.createViewport(n,{...r,sourceEnabledElement:{...o}})})}_addEventListeners(){i.eventTarget.addEventListener(o.Events.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){i.eventTarget.removeEventListener(o.Events.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(e){e.addEventListener(Ze.STACK_NEW_IMAGE,this._newStackImageCallback);const t=e=>{const{viewportId:t}=e.detail;this._reset(t)};e.addEventListener(Ze.VIEWPORT_NEW_IMAGE_SET,t);const n=e=>{const{viewportId:t}=e.detail;this._reset(t)};e.addEventListener(Ze.VOLUME_VIEWPORT_NEW_VOLUME,n),e.addEventListener(Ze.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.newStackHandler=t,e.newVolumeHandler=n}_removeSourceElementEventListener(e){e.removeEventListener(Ze.STACK_NEW_IMAGE,this._newStackImageCallback),e.removeEventListener(Ze.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.removeEventListener(Ze.VIEWPORT_NEW_IMAGE_SET,e.newStackHandler),e.removeEventListener(Ze.VOLUME_VIEWPORT_NEW_VOLUME,e.newVolumeHandler),delete e.newStackHandler,delete e.newVolumeHandler}_initialize(){this._addEventListeners()}}class rt{constructor({magnifyViewportId:e,sourceEnabledElement:t,radius:n=125,position:r=[0,0],zoomFactor:o,autoPan:a}){this._enabledElement=null,this._sourceToolGroup=null,this._magnifyToolGroup=null,this._isViewportReady=!1,this._radius=0,this._resized=!1,this._canAutoPan=!1,this._viewportId=e??i.utilities.uuidv4(),this._sourceEnabledElement=t,this._autoPan=a,this.radius=n,this.position=r,this.zoomFactor=o,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=(0,Je.A)(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(e){Math.abs(this._radius-e)>1e-5&&(this._radius=e,this._resized=!0)}update(){const{radius:e,position:t,visible:n}=this,{viewport:i}=this._enabledElement,{element:r}=i,o=2*e,[a,s]=t;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(r.style,{display:n?"block":"hidden",width:`${o}px`,height:`${o}px`,left:-e+"px",top:-e+"px",transform:`translate(${a}px, ${s}px)`}),this._isViewportReady&&(this._syncViewports(),i.render())}dispose(){const{viewport:e}=this._enabledElement,{element:t}=e,n=e.getRenderingEngine();this._removeEventListeners(t),n.disableElement(e.id),t.parentNode&&t.parentNode.removeChild(t)}_handleToolModeChanged(e){const{_magnifyToolGroup:t}=this,{toolGroupId:n,toolName:i,mode:r,toolBindingsOptions:a}=e.detail;if(this._sourceToolGroup?.id===n)switch(r){case o.ToolModes.Active:t.setToolActive(i,a);break;case o.ToolModes.Passive:t.setToolPassive(i);break;case o.ToolModes.Enabled:t.setToolEnabled(i);break;case o.ToolModes.Disabled:t.setToolDisabled(i);break;default:throw new Error(`Unknow tool mode (${r})`)}}_inheritBorderRadius(e){const t=e.querySelector(".viewport-element"),n=e.querySelector(".cornerstone-canvas");t.style.borderRadius="inherit",n.style.borderRadius="inherit"}_createViewportNode(){const e=document.createElement("div"),{radius:t}=this,n=2*t;return e.classList.add("advancedMagnifyTool"),Object.assign(e.style,{display:"block",width:`${n}px`,height:`${n}px`,position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:-t+"px",top:-t+"px",transform:"translate(-1000px, -1000px)"}),e}_convertZoomFactorToParallelScale(e,t,n){const{parallelScale:i}=e.getCamera();return i*(1/n)*(t.canvas.offsetWidth/e.canvas.offsetWidth)}_isStackViewport(e){return"setStack"in e}_isVolumeViewport(e){return"addVolumes"in e}_cloneToolGroups(e,t){const n=e.getActors(),i=`${t.id}-toolGroup`,r=(0,R.getToolGroupForViewport)(e.id,e.renderingEngineId),a=r.clone(i,e=>{const t=r.getToolInstance(e);return t instanceof ye.EC&&!(t instanceof nt)});return a.addViewport(t.id,t.renderingEngineId),n.filter(Qe).forEach(e=>{(0,ve.addSegmentationRepresentations)(this.viewportId,[{segmentationId:e.referencedId,type:o.SegmentationRepresentations.Labelmap}])}),{sourceToolGroup:r,magnifyToolGroup:a}}_cloneStack(e,t){const n=e.getImageIds();t.setStack(n).then(()=>{this._isViewportReady=!0,this.update()})}_cloneVolumes(e,t){const n=e.getActors().filter(e=>!Qe(e)).map(e=>({volumeId:e.uid}));return t.setVolumes(n).then(()=>{this._isViewportReady=!0,this.update()}),t}_cloneViewport(e,t){const{viewportId:n}=this,i=e.getRenderingEngine(),{options:r}=e,o={element:t,viewportId:n,type:e.type,defaultOptions:{...r}};i.enableElement(o);const a=i.getViewport(n);this._isStackViewport(e)?this._cloneStack(e,a):this._isVolumeViewport(e)&&this._cloneVolumes(e,a),this._inheritBorderRadius(t);const s=this._cloneToolGroups(e,a);this._sourceToolGroup=s.sourceToolGroup,this._magnifyToolGroup=s.magnifyToolGroup}_cancelMouseEventCallback(e){e.stopPropagation(),e.preventDefault()}_browserMouseUpCallback(e){const{element:t}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),t.addEventListener("mouseup",this._cancelMouseEventCallback),t.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(e){const{element:t}=this._enabledElement.viewport;this._canAutoPan=!!e.target?.closest(".advancedMagnifyTool"),document.addEventListener("mouseup",this._browserMouseUpCallback),t.removeEventListener("mouseup",this._cancelMouseEventCallback),t.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(e){if(!M.wk.isInteractingWithTool)return;const{_autoPan:t}=this;if(!t.enabled||!this._canAutoPan)return;const{currentPoints:n}=e.detail,{viewport:i}=this._enabledElement,{canvasToWorld:r}=i,{canvas:o}=n,{radius:a}=this,s=[a,a],l=(0,Xe.distanceToPoint)(s,o),c=a-t.padding;if(l<=c)return;const u=l-c,d=he.Zc.sub(he.Zc.create(),o,s);he.Zc.normalize(d,d),he.Zc.scale(d,d,u);const h=he.Zc.add(he.Zc.create(),this.position,d),p=r(this.position),f=r(h),m=he.eR.sub(he.eR.create(),f,p),g={points:{currentPosition:{canvas:this.position,world:p},newPosition:{canvas:h,world:f}},delta:{canvas:d,world:m}};t.callback(g)}_addBrowserEventListeners(e){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),e.addEventListener("mousedown",this._cancelMouseEventCallback),e.addEventListener("mouseup",this._cancelMouseEventCallback),e.addEventListener("mousemove",this._cancelMouseEventCallback),e.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(e){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),e.removeEventListener("mousedown",this._cancelMouseEventCallback),e.removeEventListener("mouseup",this._cancelMouseEventCallback),e.removeEventListener("mousemove",this._cancelMouseEventCallback),e.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(e){i.eventTarget.addEventListener(o.Events.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(o.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(e)}_removeEventListeners(e){i.eventTarget.removeEventListener(o.Events.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(o.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(e)}_initialize(){const{_sourceEnabledElement:e}=this,{viewport:t}=e,{canvas:n}=t,r=this._createViewportNode();n.parentNode.appendChild(r),this._addEventListeners(r),this._cloneViewport(t,r),this._enabledElement=(0,i.getEnabledElement)(r)}_syncViewportsCameras(e,t){const n=e.canvasToWorld(this.position),i=this._convertZoomFactorToParallelScale(e,t,this.zoomFactor),{focalPoint:r,position:o,viewPlaneNormal:a}=t.getCamera(),s=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)+Math.pow(r[2]-o[2],2)),l=[n[0],n[1],n[2]],c=[l[0]+s*a[0],l[1]+s*a[1],l[2]+s*a[2]];t.setCamera({parallelScale:i,focalPoint:l,position:c})}_syncStackViewports(e,t){t.setImageIdIndex(e.getCurrentImageIdIndex())}_syncViewports(){const{viewport:e}=this._sourceEnabledElement,{viewport:t}=this._enabledElement,n=e.getProperties();t.getImageData()&&(t.setProperties(n),this._syncViewportsCameras(e,t),this._isStackViewport(e)&&this._syncStackViewports(e,t),this._syncViewportsCameras(e,t),t.render())}_resizeViewport(){const{viewport:e}=this._enabledElement;e.getRenderingEngine().resize()}}nt.toolName="AdvancedMagnify";var ot=n(6030);const{EPSILON:at}=i.CONSTANTS;class st extends ot.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",enforceSameFrameOfReference:!0,showFullDimension:!1}}){super(e,t),this.editData=null,this._init=()=>{const e=(0,i.getRenderingEngines)()[0];if(!e)return;let t=e.getViewports();t=(0,Ce.filterViewportsWithToolEnabled)(t,this.getToolName());const n=e.getViewport(this.configuration.sourceViewportId);if(!n?.getImageData())return;const{element:o}=n,{viewUp:a,viewPlaneNormal:s}=n.getCamera(),l=i.utilities.getViewportImageCornersInWorld(n);let c=this.editData?.annotation;const u=n.getFrameOfReferenceUID();if(c)this.editData.annotation.data.handles.points=l;else{const e={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...s],viewUp:[...a],FrameOfReferenceUID:u,referencedImageId:null},data:{handles:{points:l}}};(0,r.addAnnotation)(e,o),c=e}this.editData={sourceViewportId:n.id,renderingEngine:e,annotation:c},(0,O.A)(t.filter(e=>e.id!==n.id).map(e=>e.id))},this.onSetToolEnabled=()=>{this._init()},this.onSetToolConfiguration=()=>{this._init()},this.onCameraModified=e=>{this._init()},this.renderAnnotation=(e,t)=>{const{viewport:n}=e;if(!this.editData)return!1;const{annotation:r,sourceViewportId:o}=this.editData;let a=!1;const{viewport:s}=(0,i.getEnabledElementByViewportId)(o)||{};if(!s)return a;if(s.id===n.id)return a;if(!r||!r?.data?.handles?.points)return a;if(this.configuration.enforceSameFrameOfReference&&s.getFrameOfReferenceUID()!==n.getFrameOfReferenceUID())return a;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},c=r.data.handles.points[0],u=r.data.handles.points[1],d=r.data.handles.points[2],h=r.data.handles.points[3],{focalPoint:p,viewPlaneNormal:f,viewUp:m}=n.getCamera(),{viewPlaneNormal:g}=s.getCamera();if(this.isParallel(f,g))return a;const v=i.utilities.planar.planeEquation(f,p),y=[c,d,u,h],_=[c,u,d,h];let w=y,E=he.eR.subtract(he.eR.create(),y[0],y[1]);E=he.eR.normalize(he.eR.create(),E);let b=he.eR.subtract(he.eR.create(),y[2],y[0]);b=he.eR.normalize(he.eR.create(),b);const x=he.eR.cross(he.eR.create(),E,b);if(this.isParallel(x,f))return a;this.isPerpendicular(E,f)&&(w=_);const C=i.utilities.planar.linePlaneIntersection(w[0],w[1],v),I=i.utilities.planar.linePlaneIntersection(w[2],w[3],v),{annotationUID:S}=r;l.annotationUID=S;const D=this.getStyle("lineWidth",l,r),A=this.getStyle("lineDash",l,r),T=this.getStyle("color",l,r),N=this.getStyle("shadow",l,r);let O=[C,I].map(e=>n.worldToCanvas(e));if(this.configuration.showFullDimension&&(O=this.handleFullDimension(n,C,f,m,I,O)),O.length<2)return a;const P=`${S}-line`;return(0,ge.drawLine)(t,S,"1",O[0],O[1],{color:T,width:D,lineDash:A,shadow:N},P),a=!0,a},this.isPerpendicular=(e,t)=>{const n=he.eR.dot(e,t);return Math.abs(n)<at}}handleFullDimension(e,t,n,r,o,a){e.getRenderingEngine();const s=this.getTargetId(e),l=this.getTargetImageData(s),c=this.getReferencedImageId(e,t,n,r);if(c&&l)try{const{imageData:n,dimensions:r}=l,[s,u,d,h]=[n.indexToWorld([0,0,0]),n.indexToWorld([r[0]-1,0,0]),n.indexToWorld([r[0]-1,r[1]-1,0]),n.indexToWorld([0,r[1]-1,0])].map(e=>i.utilities.worldToImageCoords(c,e)),[p,f]=[t,o].map(e=>i.utilities.worldToImageCoords(c,e));a=[[s,u],[u,d],[h,d],[s,h]].map(([e,t])=>this.intersectInfiniteLines(e,t,p,f)).filter(e=>e&&this.isInBound(e,r)).map(t=>{const n=i.utilities.imageToWorldCoords(c,t);return e.worldToCanvas(n)})}catch(e){console.log(e)}return a}intersectInfiniteLines(e,t,n,i){const[r,o]=e,[a,s]=t,[l,c]=n,[u,d]=i,h=s-o,p=r-a,f=a*o-r*s,m=d-c,g=l-u,v=u*c-l*d;if(Math.abs(h*g-m*p)<at)return;return[(p*v-g*f)/(h*g-m*p),(m*f-h*v)/(h*g-m*p)]}isParallel(e,t){return Math.abs(he.eR.dot(e,t))>1-at}isInBound(e,t){return e[0]>=0&&e[0]<=t[0]&&e[1]>=0&&e[1]<=t[1]}}st.toolName="ReferenceLines";const{EPSILON:lt}=i.CONSTANTS;class ct extends ot.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}){super(e,t),this.onSetToolEnabled=()=>{this._init()},this.onSetToolActive=()=>{this._init()},this._init=()=>{const e=this.configuration.sourceImageIds;if(!e?.length)return void console.warn("OverlayGridTool: No sourceImageIds provided in configuration");const t=i.metaData.get("imagePlaneModule",e[0]);if(!t)return void console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");const{frameOfReferenceUID:n}=t,o=(0,R.getToolGroup)(this.toolGroupId).viewportsInfo;if(!o?.length)return void console.warn("OverlayGridTool: No viewports found");const a=(0,r.getAnnotations)(this.getToolName(),n);if(!a?.length){const t=e.map(e=>this.calculateImageIdPointSets(e)),i={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:n,referencedImageId:null},data:{viewportData:new Map,pointSets:t}};(0,r.addAnnotation)(i,n)}(0,O.A)(o.map(({viewportId:e})=>e))},this.calculateImageIdPointSets=e=>{const{imagePositionPatient:t,rows:n,columns:r,rowCosines:o,columnCosines:a,rowPixelSpacing:s,columnPixelSpacing:l}=i.metaData.get("imagePlaneModule",e),c=[...t],u=[...t],d=[...t],h=[...t];he.eR.scaleAndAdd(u,t,a,r*l),he.eR.scaleAndAdd(d,t,o,n*s),he.eR.scaleAndAdd(h,d,a,r*l);return{pointSet1:[c,d,u,h],pointSet2:[c,u,d,h]}},this.renderAnnotation=(e,t)=>{const n=this.configuration.sourceImageIds;let o=!1;if(!n?.length)return o;const{viewport:a,FrameOfReferenceUID:s}=e;if(a.getImageIds().length<2)return o;const l=(0,r.getAnnotations)(this.getToolName(),s);if(!l?.length)return o;const c=l[0],{annotationUID:u}=c,{focalPoint:d,viewPlaneNormal:h}=a.getCamera(),p={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},f=this.getImageIdNormal(n[0]);if(this.isParallel(h,f))return o;const m=i.utilities.planar.planeEquation(h,d),g=c.data.pointSets,v=c.data.viewportData;for(let e=0;e<n.length;e++){const{pointSet1:n,pointSet2:r}=g[e],o=v.get(a.id)||this.initializeViewportData(v,a.id);if(!o.pointSetsToUse[e]){let t=n,a=he.eR.subtract(he.eR.create(),n[0],n[1]);a=he.eR.normalize(he.eR.create(),a),this.isPerpendicular(a,h)&&(t=r),o.pointSetsToUse[e]=t,o.lineStartsWorld[e]=i.utilities.planar.linePlaneIntersection(t[0],t[1],m),o.lineEndsWorld[e]=i.utilities.planar.linePlaneIntersection(t[2],t[3],m)}const s=o.lineStartsWorld[e],l=o.lineEndsWorld[e];p.annotationUID=u;const d=this.getStyle("lineWidth",p,c),f=this.getStyle("lineDash",p,c),y=this.getStyle("color",p,c),_=this.getStyle("shadow",p,c),w=[s,l].map(e=>a.worldToCanvas(e)),E=`${u}-line`,b=`${e}`;(0,ge.drawLine)(t,u,b,w[0],w[1],{color:y,width:d,lineDash:f,shadow:_},E)}return o=!0,o},this.initializeViewportData=(e,t)=>(e.set(t,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),e.get(t)),this.isPerpendicular=(e,t)=>{const n=he.eR.dot(e,t);return Math.abs(n)<lt}}isParallel(e,t){return Math.abs(he.eR.dot(e,t))>1-lt}getImageIdNormal(e){const{imageOrientationPatient:t}=i.metaData.get("imagePlaneModule",e),n=he.eR.fromValues(t[0],t[1],t[2]),r=he.eR.fromValues(t[3],t[4],t[5]);return he.eR.cross(he.eR.create(),n,r)}}ct.toolName="OverlayGrid";var ut=n(38726);class dt extends ot.A{constructor(e={},t={configuration:{opacity:.5}}){super(e,t),this._init=()=>{const e=(0,R.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e?.length)return void console.warn(this.getToolName()+"Tool: No viewports found");const t=(0,i.getRenderingEngine)(e[0].renderingEngineId)?.getViewport(e[0].viewportId);if(!t)return;const n=t.getFrameOfReferenceUID(),o=(0,r.getAnnotations)(this.getToolName(),n);if(!o?.length){const t=new Map;!function(e,t){t.forEach(({viewportId:t,renderingEngineId:n})=>{const r=(0,i.getRenderingEngine)(n)?.getViewport(t);ht(e,r)})}(t,e);const o={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:n,referencedImageId:null},data:{actorsWorldPointsMap:t}};(0,r.addAnnotation)(o,n)}(0,O.A)(e.map(({viewportId:e})=>e))},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=e=>{this._init()},this.renderAnnotation=(e,t)=>{const{viewport:n,FrameOfReferenceUID:i}=e;let o=!1;const a=(0,r.getAnnotations)(this.getToolName(),i);if(!a?.length)return o;const s=a[0],{annotationUID:l}=s,c=s.data.actorsWorldPointsMap;ht(c,n);const u=n.getActors(),d=pt(n);return u.forEach(e=>{if(!e?.clippingFilter)return;const i=c.get(e.uid);if(!i)return;if(!i.get(d))return;let r=1;const{worldPointsSet:o,color:a}=i.get(d);for(let i=0;i<o.length;i++){const s=o[i].map(e=>n.worldToCanvas(e)),c={color:a,fillColor:a,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},u=e.uid+"#"+r;(0,ge.drawPath)(t,l,u,s,c),r++}}),o=!0,o}}}function ht(e,t){const n=t.getActors(),i=pt(t);n.forEach(t=>{if(!t?.clippingFilter)return;let n=e.get(t.uid);if(n||(n=new Map,e.set(t.uid,n)),!n.get(i)){const e=t.clippingFilter.getOutputData(),r=P.polyDataUtils.getPolyDataPoints(e);if(!r)return;const o=function(e){function t(e){let t=Math.floor(255*e).toString(16);return 1===t.length&&(t="0"+t),t}return"#"+t(e[0])+t(e[1])+t(e[2])}(t.actor.getProperty().getColor());n.set(i,{worldPointsSet:r,color:o})}})}function pt(e){const{viewPlaneNormal:t}=e.getCamera(),n=e.getCurrentImageIdIndex();return`${e.id}-${(0,ut.l)(t)}-${n}`}dt.toolName="SegmentationIntersection";class ft extends ot.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}){super(e,t),this.isDrawing=!1,this.isHandleOutsideImage=!1,this._elementWithCursor=null,this._currentCursorWorldPosition=null,this._currentCanvasPosition=null,this._disableCursorEnabled=!1,this.mouseMoveCallback=e=>{const{detail:t}=e,{element:n,currentPoints:i}=t;this._currentCursorWorldPosition=i.world,this._currentCanvasPosition=i.canvas,this._elementWithCursor=n;const r=this.getActiveAnnotation(n);return null===r?(this.createInitialAnnotation(i.world,n),!1):(this.updateAnnotationPosition(n,r),!1)},this.createInitialAnnotation=(e,t)=>{const n=(0,i.getEnabledElement)(t);if(!n)throw new Error("No enabled element found");const{viewport:o,renderingEngine:a}=n;this.isDrawing=!0;const s=o.getCamera(),{viewPlaneNormal:l,viewUp:c}=s;if(!l||!c)throw new Error("Camera not found");const u=this.getReferencedImageId(o,e,l,c),d=o.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...c],FrameOfReferenceUID:d,referencedImageId:u},data:{label:"",handles:{points:[[...e]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if((0,r.getAnnotations)(this.getToolName(),t).length>0)return null;if(null===(0,r.addAnnotation)(h,t))return;const p=(0,Ce.getViewportIdsWithToolToRender)(t,this.getToolName(),!1);(0,O.A)(p)},this.onCameraModified=e=>{const t=e.detail,{element:n,previousCamera:r,camera:o}=t,a=(0,i.getEnabledElement)(n).viewport;if(n!==this._elementWithCursor)return;const s=r.focalPoint,l=o.viewPlaneNormal,c=o.focalPoint,u=[0,0,0];if(we.Ay.subtract(c,s,u),0===u.reduce((e,t)=>e+t,0))return;const d=we.Ay.dot(u,l);if(Math.abs(d)<.01)return;if(!this._currentCanvasPosition)return;const h=a.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=h,this.updateAnnotationPosition(n,this.getActiveAnnotation(n))},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i,FrameOfReferenceUID:o}=e,a=this._elementWithCursor===i.element;this.configuration.positionSync&&!a&&this.updateViewportImage(i);const{element:s}=i;let l=(0,r.getAnnotations)(this.getToolName(),s);if(!l?.length)return n;if(l=this.filterInteractableAnnotationsForElement(s,l),!l?.length)return n;const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<l.length;e++){const r=l[e],{annotationUID:o,data:s}=r,{handles:u}=s,{points:d}=u;if(!o)return n;c.annotationUID=o;const h=parseFloat(this.getStyle("lineWidth",c,r)),p=h,f=this.getStyle("lineDash",c,r),m=this.getStyle("color",c,r);if(d[0].some(e=>isNaN(e)))return n;const g=d.map(e=>i.worldToCanvas(e));if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,V.isAnnotationVisible)(o))continue;const v={upper:"upper",right:"right",lower:"lower",left:"left"},[y,_]=g[0],w=a?20:7,E=a?5:7;(0,ge.drawLine)(t,o,v.upper,[y,_-(w/2+E)],[y,_-w/2],{color:m,lineDash:f,lineWidth:p}),(0,ge.drawLine)(t,o,v.lower,[y,_+(w/2+E)],[y,_+w/2],{color:m,lineDash:f,lineWidth:p}),(0,ge.drawLine)(t,o,v.right,[y+(w/2+E),_],[y+w/2,_],{color:m,lineDash:f,lineWidth:p}),(0,ge.drawLine)(t,o,v.left,[y-(w/2+E),_],[y-w/2,_],{color:m,lineDash:f,lineWidth:p}),n=!0}return n},this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const e=(0,R.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e)return;e.map(e=>(0,i.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)).forEach(e=>{e&&(0,Ie.hideElementCursor)(e.viewport.element)})}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const e=(0,R.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e)return;e.map(e=>(0,i.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)).forEach(e=>{e&&(0,Ie.resetElementCursor)(e.viewport.element)})}getActiveAnnotation(e){const t=(0,r.getAnnotations)(this.getToolName(),e);if(!t.length)return null;return t[0]}updateAnnotationPosition(e,t){const n=this._currentCursorWorldPosition;if(!n)return;if(!t.data?.handles?.points)return;t.data.handles.points=[[...n]],t.invalidated=!0;const r=(0,Ce.getViewportIdsWithToolToRender)(e,this.getToolName(),!1);(0,i.getEnabledElement)(e)&&(0,O.A)(r)}filterInteractableAnnotationsForElement(e,t){if(!(t instanceof Array)||0===t.length)return[];const n=t[0],r=(0,i.getEnabledElement)(e)?.viewport;if(!r)return[];const o=r.getCamera(),{viewPlaneNormal:a,focalPoint:s}=o;if(!a||!s)return[];const l=n.data?.handles?.points;if(!(l instanceof Array)||1!==l.length)return[];const c=l[0],u=i.utilities.planar.planeEquation(a,s);return i.utilities.planar.planeDistanceToPoint(u,c)<this.configuration.displayThreshold?[n]:[]}updateViewportImage(e){const t=this._currentCursorWorldPosition;if(t&&!t.some(e=>isNaN(e)))if(e instanceof i.StackViewport){const n=i.utilities.getClosestStackImageIndexForPoint(t,e);if(null===n)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof i.VolumeViewport){const{focalPoint:n,viewPlaneNormal:r}=e.getCamera();if(!n||!r)return;const o=i.utilities.planar.planeEquation(r,n),a=i.utilities.planar.planeDistanceToPoint(o,t,!0);if(Math.abs(a)<.5)return;const s=he.eR.normalize(he.eR.create(),he.eR.fromValues(...r)),l=he.eR.scale(he.eR.create(),s,a),c=he.eR.add(he.eR.create(),he.eR.fromValues(...n),l);if(!0){e.setCamera({focalPoint:c});const t=e.getRenderingEngine();t&&t.renderViewport(e.id)}}}}ft.toolName="ReferenceCursors";const mt=[];class gt extends ot.A{constructor(e={},t={configuration:{viewportId:"",scaleLocation:"bottom"}}){super(e,t),this.editData=null,this._init=()=>{const e=(0,i.getRenderingEngines)()[0];if(!e)return;const t=(0,R.getToolGroup)(this.toolGroupId).viewportsInfo;if(!t)return;const n=t.map(e=>(0,i.getEnabledElementByIds)(e.viewportId,e.renderingEngineId));let{viewport:o}=n[0];const{FrameOfReferenceUID:a}=n[0];if(this.configuration.viewportId&&n.forEach(e=>{e.viewport.id==this.configuration.viewportId&&(o=e.viewport)}),!o)return;const{viewUp:s,viewPlaneNormal:l}=o.getCamera(),c=i.utilities.getViewportImageCornersInWorld(o);let u=this.editData?.annotation;const d=(0,r.getAnnotations)(this.getToolName(),o.element);d.length&&(u=d.filter(e=>e.data.viewportId==o.id)[0]),n.forEach(e=>{const{viewport:t}=e;if(!mt.includes(t.id)){const e={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...s],FrameOfReferenceUID:a,referencedImageId:null},data:{handles:{points:i.utilities.getViewportImageCornersInWorld(t)},viewportId:t.id}};mt.push(t.id),(0,r.addAnnotation)(e,t.element),u=e}}),this.editData?.annotation&&this.editData.annotation.data.viewportId==o.id&&(this.editData.annotation.data.handles.points=c,this.editData.annotation.data.viewportId=o.id),this.editData={viewport:o,renderingEngine:e,annotation:u}},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=e=>{this.configuration.viewportId=e.detail.viewportId,this._init()},this.computeScaleSize=(e,t,n)=>{const i=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let r;return r="top"==n||"bottom"==n?i.filter(t=>t<.6*e&&t>.2*e):i.filter(e=>e<.6*t&&e>.2*t),r[0]},this.computeEndScaleTicks=(e,t)=>{const n={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]};return{endTick1:[[e[1][0]+n[t][0][0],e[1][1]+n[t][0][0]],[e[1][0]+n[t][1][0],e[1][1]+n[t][1][1]]],endTick2:[[e[0][0]+n[t][0][0],e[0][1]+n[t][0][0]],[e[0][0]+n[t][1][0],e[0][1]+n[t][1][1]]]}},this.computeInnerScaleTicks=(e,t,n,i,r)=>{let o;"bottom"==t||"top"==t?o=r[0][0]-i[0][0]:"left"!=t&&"right"!=t||(o=r[0][1]-i[0][1]);const a=[],s=[],l=[];let c=e;e>=50&&(c=e/10);const u=o/c;for(let e=0;e<c-1;e++){const r={bottom:[[u*(e+1),0],[u*(e+1),5]],top:[[u*(e+1),0],[u*(e+1),-5]],left:[[0,u*(e+1)],[-5,u*(e+1)]],right:[[0,u*(e+1)],[5,u*(e+1)]]};a.push(`${n}-tick${e}`),s.push(`tick${e}`),(e+1)%5==0?l.push([[i[0][0]+r[t][0][0],i[0][1]+r[t][0][1]],[i[1][0]+r[t][0][0],i[1][1]+r[t][0][1]]]):l.push([[i[0][0]+r[t][0][0],i[0][1]+r[t][0][1]],[i[1][0]+r[t][1][0],i[1][1]+r[t][1][1]]])}return{tickIds:a,tickUIDs:s,tickCoordinates:l}},this.computeWorldScaleCoordinates=(e,t,n)=>{let i,r=he.eR.subtract(he.eR.create(),n[0],n[1]);r=he.eR.normalize(he.eR.create(),r);let o=he.eR.subtract(he.eR.create(),n[2],n[0]);o=he.eR.normalize(he.eR.create(),o);const a={bottom:[n[1],n[2]],top:[n[0],n[3]],right:[n[2],n[3]],left:[n[0],n[1]]},s=he.eR.add(he.eR.create(),a[t][0],a[t][0]).map(e=>e/2),l=e/2/Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2));return"top"==t||"bottom"==t?i=[he.eR.subtract(he.eR.create(),s,o.map(e=>e*l)),he.eR.add(he.eR.create(),s,o.map(e=>e*l))]:"left"!=t&&"right"!=t||(i=[he.eR.add(he.eR.create(),s,r.map(e=>e*l)),he.eR.subtract(he.eR.create(),s,r.map(e=>e*l))]),i},this.computeCanvasScaleCoordinates=(e,t,n,i,r)=>{let o;if("top"==r||"bottom"==r){const i=t[0][0]-t[1][0];o=[[e.width/2-i/2,n.height],[e.width/2+i/2,n.height]]}else if("left"==r||"right"==r){const n=t[0][1]-t[1][1];o=[[i.width,e.height/2-n/2],[i.width,e.height/2+n/2]]}return o},this.computeScaleBounds=(e,t,n,i)=>{const r=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),a={bottom:[-o,-r],top:[o,r],left:[o,r],right:[-o,-r]},s={bottom:[e.height,e.width],top:[0,e.width],left:[e.height,0],right:[e.height,e.width]};return{height:s[i][0]+a[i][0],width:s[i][1]+a[i][1]}}}renderAnnotation(e,t){if(!this.editData||!this.editData.viewport)return;const n=this.configuration.scaleLocation,{viewport:i}=e,o=(0,r.getAnnotations)(this.getToolName(),i.element).filter(e=>e.data.viewportId==i.id)[0],a=e.viewport.canvas,s=!1;if(!i)return s;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},c={width:a.width/window.devicePixelRatio||1,height:a.height/window.devicePixelRatio||1},u=o.data.handles.points[0],d=o.data.handles.points[1],h=o.data.handles.points[2],p=o.data.handles.points[3],f=[u,h,d,p],m=he.eR.distance(h,p),g=he.eR.distance(u,h),v=this.computeScaleBounds(c,.05,.05,n),y=this.computeScaleBounds(c,.05,.05,n),_=this.computeScaleSize(m,g,n),w=this.computeWorldScaleCoordinates(_,n,f).map(e=>i.worldToCanvas(e)),E=this.computeCanvasScaleCoordinates(c,w,y,v,n),b=this.computeEndScaleTicks(E,n),{annotationUID:x}=o;l.annotationUID=x;const C=this.getStyle("lineWidth",l,o),I=this.getStyle("lineDash",l,o),S=this.getStyle("color",l,o),D=this.getStyle("shadow",l,o),A=`${x}-scaleline`;(0,ge.drawLine)(t,x,"1",E[0],E[1],{color:S,width:C,lineDash:I,shadow:D},A);const T=`${x}-left`;(0,ge.drawLine)(t,x,"2",b.endTick1[0],b.endTick1[1],{color:S,width:C,lineDash:I,shadow:D},T);const N=`${x}-right`;(0,ge.drawLine)(t,x,"3",b.endTick2[0],b.endTick2[1],{color:S,width:C,lineDash:I,shadow:D},N);const O={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},P=[E[0][0]+O[n][0],E[0][1]+O[n][1]],M=this._getTextLines(_),{tickIds:k,tickUIDs:R,tickCoordinates:L}=this.computeInnerScaleTicks(_,n,x,b.endTick1,b.endTick2);for(let e=0;e<R.length;e++)(0,ge.drawLine)(t,x,R[e],L[e][0],L[e][1],{color:S,width:C,lineDash:I,shadow:D},k[e]);return(0,ge.drawTextBox)(t,x,"text0",M,[P[0],P[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:S}),s}_getTextLines(e){let t,n;e>=50?(t=e/10,n=" cm"):(t=e,n=" mm");return[t.toString().concat(n)]}}gt.toolName="ScaleOverlay";var vt=n(51440),yt=n(76712);const _t=(e,t,n)=>{if(!t?.data?.contour?.polyline?.length)return;const{polyline:i}=t.data.contour,{length:r}=i;let o=1/0;for(let t=0;t<r;t++){const r=e.worldToCanvas(i[t]),a=vt.point.distanceToPoint(r,n);o=Math.min(o,a)}return o===1/0||isNaN(o)?void 0:o};class wt{constructor(){this.toolInfo={toolSize:null,maxToolSize:null}}static{this.shapeName="Circle"}renderShape(e,t,n){(0,ge.drawCircle)(e,"SculptorTool","0",t,this.toolInfo.toolSize,n)}pushHandles(e,t){const{points:n,mouseCanvasPoint:i}=t,r={first:void 0,last:void 0};for(let o=0;o<n.length;o++){const a=e.worldToCanvas(n[o]),s=vt.point.distanceToPoint(a,i);s>this.toolInfo.toolSize||(this.pushOneHandle(o,s,t),void 0===r.first?(r.first=o,r.last=o):r.last=o)}return r}configureToolSize(e){const t=this.toolInfo;if(t.toolSize&&t.maxToolSize)return;const n=e.detail.element,i=Math.min(n.clientWidth,n.clientHeight)/12;t.toolSize=i,t.maxToolSize=i}updateToolSize(e,t,n){const i=this.toolInfo,r=_t(t,n,e);r>0&&(i.toolSize=Math.min(i.maxToolSize,r))}getMaxSpacing(e){return Math.max(this.toolInfo.toolSize/4,e)}getInsertPosition(e,t,n){let r;const{points:o,element:a,mouseCanvasPoint:s}=n,l=this.toolInfo.toolSize,c=(0,i.getEnabledElement)(a),{viewport:u}=c,d=u.worldToCanvas(o[e]),h=u.worldToCanvas(o[t]),p=[(d[0]+h[0])/2,(d[1]+h[1])/2],f=vt.point.distanceToPoint(s,p);if(f<l){const e={x:(p[0]-s[0])/f,y:(p[1]-s[1])/f};r=[s[0]+l*e.x,s[1]+l*e.y]}else r=p;return u.canvasToWorld(r)}pushOneHandle(e,t,n){const{points:i,mousePoint:r}=n,o=this.toolInfo.toolSize,a=i[e],s=(a[0]-r[0])/t,l=(a[1]-r[1])/t,c=(a[2]-r[2])/t,u={x:r[0]+o*s,y:r[1]+o*l,z:r[2]+o*c};a[0]=u.x,a[1]=u.y,a[2]=u.z}}const Et=wt;class bt extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}){super(e,t),this.registeredShapes=new Map,this.isActive=!1,this.commonData={activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0},this.preMouseDownCallback=e=>{const t=e.detail,n=t.element;if(this.configureToolSize(e),this.selectFreehandTool(t),null!==this.commonData.activeAnnotationUID)return this.isActive=!0,(0,Ie.hideElementCursor)(n),this.activateModify(n),!0},this.mouseMoveCallback=e=>{this.mode===o.ToolModes.Active?(this.configureToolSize(e),this.updateCursor(e)):this.commonData.canvasLocation=void 0},this.endCallback=e=>{const t=e.detail,{element:n}=t,r=this.configuration,o=(0,i.getEnabledElement)(n);this.isActive=!1,this.deactivateModify(n),(0,Ie.resetElementCursor)(n);const{renderingEngineId:a,viewportId:s}=o,l=(0,R.getToolGroupForViewport)(s,a).getToolInstance(r.referencedToolName),c=this.filterSculptableAnnotationsForElement(n).find(e=>e.annotationUID===this.commonData.activeAnnotationUID);l.configuration.calculateStats&&(c.invalidated=!0),(0,xe.XF)(c,n)},this.dragCallback=e=>{const t=e.detail,n=t.element;this.updateCursor(e);const i=this.filterSculptableAnnotationsForElement(n),r=i.find(e=>e.annotationUID===this.commonData.activeAnnotationUID);if(!i?.length||!this.isActive)return;const o=r.data.contour.polyline;this.sculpt(t,o)},this.registerShapes(Et.shapeName,Et),this.setToolShape(this.configuration.toolShape)}registerShapes(e,t){const n=new t;this.registeredShapes.set(e,n)}sculpt(e,t){const n=this.configuration,r=e.element,o=(0,i.getEnabledElement)(r),{viewport:a}=o,s=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:e.currentPoints.world,mouseCanvasPoint:e.currentPoints.canvas,points:t,maxSpacing:s.getMaxSpacing(n.minSpacing),element:r};const l=s.pushHandles(a,this.sculptData);void 0!==l.first&&this.insertNewHandles(l)}interpolatePointsWithinMaxSpacing(e,t,n,r){const{element:o}=this.sculptData,a=(0,i.getEnabledElement)(o),{viewport:s}=a,l=xt(e+1,t.length),c=s.worldToCanvas(t[e]),u=s.worldToCanvas(t[l]);vt.point.distanceToPoint(c,u)>r&&n.push(e)}updateCursor(e){const t=e.detail,n=t.element,r=(0,i.getEnabledElement)(n),{renderingEngine:o,viewport:a}=r;this.commonData.viewportIdsToRender=[a.id];const s=this.filterSculptableAnnotationsForElement(n);if(!s?.length)return;const l=s.find(e=>e.annotationUID===this.commonData.activeAnnotationUID);if(this.commonData.canvasLocation=t.currentPoints.canvas,this.isActive)l.highlighted=!0;else{const e=this.registeredShapes.get(this.selectedShape),n=t.currentPoints.canvas;e.updateToolSize(n,a,l)}(0,O.t)(this.commonData.viewportIdsToRender)}filterSculptableAnnotationsForElement(e){const t=this.configuration,n=(0,i.getEnabledElement)(e),{renderingEngineId:r,viewportId:o}=n,a=[],s=(0,R.getToolGroupForViewport)(o,r).getToolInstance(t.referencedToolName);return t.referencedToolNames.forEach(t=>{const n=(0,le.Rh)(t,e);n&&a.push(...n)}),s.filterInteractableAnnotationsForElement(e,a)}configureToolSize(e){this.registeredShapes.get(this.selectedShape).configureToolSize(e)}insertNewHandles(e){const t=this.findNewHandleIndices(e);let n=0;for(let e=0;e<t?.length;e++){const i=t[e]+1+n;this.insertHandleRadially(i),n++}}findNewHandleIndices(e){const{points:t,maxSpacing:n}=this.sculptData,i=[];for(let r=e.first;r<=e.last;r++)this.interpolatePointsWithinMaxSpacing(r,t,i,n);return i}insertHandleRadially(e){const{points:t}=this.sculptData;if(e>t.length-1&&this.commonData.isEditingOpenContour)return;const n=this.registeredShapes.get(this.selectedShape),i=e-1,r=xt(e,t.length),o=n.getInsertPosition(i,r,this.sculptData);t.splice(e,0,o)}selectFreehandTool(e){const t=this.getClosestFreehandToolOnElement(e);void 0!==t&&(this.commonData.activeAnnotationUID=t)}getClosestFreehandToolOnElement(e){const{element:t}=e,n=(0,i.getEnabledElement)(t),{viewport:r}=n,o=this.configuration,a=this.filterSculptableAnnotationsForElement(t);if(!a?.length)return;const s=e.currentPoints.canvas,l={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let e=0;e<a?.length;e++){if(a[e].isLocked||!a[e].isVisible)continue;const t=_t(r,a[e],s);-1!==t&&(t<l.distance&&(l.distance=t,l.toolIndex=e,l.annotationUID=a[e].annotationUID))}return this.commonData.isEditingOpenContour=!a[l.toolIndex].data.contour.closed,o.referencedToolName=a[l.toolIndex].metadata.toolName,l.annotationUID}activateModify(e){e.addEventListener(o.Events.MOUSE_UP,this.endCallback),e.addEventListener(o.Events.MOUSE_CLICK,this.endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this.dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this.endCallback),e.addEventListener(o.Events.TOUCH_END,this.endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this.dragCallback)}deactivateModify(e){e.removeEventListener(o.Events.MOUSE_UP,this.endCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this.endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this.dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this.endCallback),e.removeEventListener(o.Events.TOUCH_END,this.endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this.dragCallback)}setToolShape(e){this.selectedShape=this.registeredShapes.get(e)??Et.shapeName}renderAnnotation(e,t){const{viewport:n}=e,{element:i}=n,r=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==o.ToolModes.Active||!r.includes(n.id))return;const a=this.filterSculptableAnnotationsForElement(i);if(!a?.length)return;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};let l=(0,yt.h)("color",s,o.AnnotationStyleStates.Default,this.mode);this.isActive&&(l=(0,yt.h)("color",s,o.AnnotationStyleStates.Highlighted,this.mode));this.registeredShapes.get(this.selectedShape).renderShape(t,this.commonData.canvasLocation,{color:l})}}const xt=(e,t)=>(e+t)%t;bt.toolName="SculptorTool";const Ct=[0,0,1];class It extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:Ct,rotateIncrementDegrees:30}}){super(e,t)}mouseWheelCallback(e){const{element:t,wheel:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:o}=r,{direction:a,rotateIncrementDegrees:s}=this.configuration,l=o.getCamera(),{viewUp:c,position:u,focalPoint:d}=l,{direction:h}=n,[p,f,m]=d,[g,v,y]=a,_=h*(s*Math.PI)/180,w=[0,0,0],E=[0,0,0],b=[0,0,0],x=he.pB.identity(new Float32Array(16));he.pB.translate(x,x,[p,f,m]),he.pB.rotate(x,x,_,[g,v,y]),he.pB.translate(x,x,[-p,-f,-m]),he.eR.transformMat4(w,u,x),he.eR.transformMat4(E,d,x),he.pB.identity(x),he.pB.rotate(x,x,_,[g,v,y]),he.eR.transformMat4(b,c,x),o.setCamera({position:w,viewUp:b,focalPoint:E}),o.render()}}It.toolName="VolumeRotateMouseWheel";n(25072);var St=n(4096),Dt=n(27730),At=n(66990);const{transformWorldToIndex:Tt}=i.utilities;class Nt extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Ot}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l}=s;(0,Ie.hideElementCursor)(o),this.isDrawing=!0;const{viewPlaneNormal:c,viewUp:u,position:d}=l.getCamera(),h=this.getReferencedImageId(l,a,c,u),p={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[a]}),toolName:this.getToolName(),referencedImageId:h,viewUp:u,cameraPosition:d},data:{handles:{points:[[...a],[...a]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,r.addAnnotation)(p,o);const f=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:f,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,O.A)(f),p},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,[l,c]=s.handles.points,u=a.worldToCanvas(l),d=a.worldToCanvas(c),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}};return Le.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,Ie.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:r,handleIndex:o,movingTextBox:a}=this.editData,{data:s}=i;if(a){const{deltaPoints:e}=t,n=e.world,{textBox:i}=s.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===o){const{deltaPoints:e}=t,n=e.world;s.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),i.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;s.handles.points[o]=[...n],i.invalidated=!0}this.editData.hasMoved=!0,(0,O.A)(r)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(i),l=i.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const o=a[r],{annotationUID:u,data:d}=o,{points:h,activeHandleIndex:p}=d.handles;c.annotationUID=u;const{color:f,lineWidth:m,lineDash:g,shadow:v}=this.getAnnotationStyle({annotation:o,styleSpecifier:c}),y=h.map(e=>i.worldToCanvas(e));if(d.cachedStats[s]&&null!=d.cachedStats[s].unit?o.invalidated&&this._throttledCalculateCachedStats(o,l,e):(d.cachedStats[s]={length:null,unit:null},this._calculateCachedStats(o,l,e)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let _;if(!(0,V.isAnnotationVisible)(u))continue;if((0,B.isAnnotationLocked)(u)||this.editData||null===p||(_=[y[p]]),_){const e="0";(0,ge.drawHandles)(t,u,e,y,{color:f,lineDash:g,lineWidth:m})}const w=`${u}-line`,E="1";if((0,ge.drawLine)(t,u,E,y[0],y[1],{color:f,width:m,lineDash:g,shadow:v},w),n=!0,!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const b=this.getLinkedTextBoxStyle(c,o);if(!b.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const x=this.configuration.getTextLines(d,s);if(!d.handles.textBox.hasMoved){const e=(0,At.getTextBoxCoordsCanvas)(y);d.handles.textBox.worldPosition=i.canvasToWorld(e)}const C=i.worldToCanvas(d.handles.textBox.worldPosition),I="1",S=(0,ge.drawLinkedTextBox)(t,u,I,x,C,y,{},b),{x:D,y:A,width:T,height:N}=S;d.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([D,A]),topRight:i.canvasToWorld([D+T,A]),bottomLeft:i.canvasToWorld([D,A+N]),bottomRight:i.canvasToWorld([D+T,A+N])}}return n},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}static{this.hydrate=(e,t,n)=>{const o=(0,i.getEnabledElementByViewportId)(e);if(!o)return;const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:l,viewUp:c}=a.getCamera(),u=new this,d=u.getReferencedImageId(a,t[0],l,c),h={annotationUID:n?.annotationUID||i.utilities.uuidv4(),data:{handles:{points:t}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:u.getToolName(),viewPlaneNormal:l,FrameOfReferenceUID:s,referencedImageId:d,...n}};(0,r.addAnnotation)(h,a.element),(0,O.A)([a.id])}}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,Ie.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,O.A)(c),e.preventDefault()}_calculateLength(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)}_calculateCachedStats(e,t,n){const i=e.data,{element:r}=n.viewport,o=i.handles.points[0],a=i.handles.points[1],{cachedStats:s}=i,l=Object.keys(s);for(let e=0;e<l.length;e++){const t=l[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:i,dimensions:r}=n,c=Tt(i,o),u=Tt(i,a),d=[c,u],{scale:h,unit:p}=(0,St.Op)(n,d),f=this._calculateLength(o,a)/h;this._isInsideVolume(c,u,r)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,s[t]={length:f,unit:p}}return e.invalidated=!1,(0,xe.XF)(e,r),s}_isInsideVolume(e,t,n){return i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n)}}function Ot(e,t){const n=e.cachedStats[t],{length:r,unit:o}=n;if(null==r||isNaN(r))return;return[`${i.utilities.roundNumber(r)} ${o}`]}Nt.toolName="Length";const{transformWorldToIndex:Pt}=i.utilities;class Mt extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:kt}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;(0,Ie.hideElementCursor)(o),this.isDrawing=!0;const{viewPlaneNormal:u,viewUp:d,position:h}=l.getCamera(),p=this.getReferencedImageId(l,a,u,d),f={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[a]}),toolName:this.getToolName(),referencedImageId:p,viewUp:d,cameraPosition:h},data:{handles:{points:[[...a],[...a]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,r.addAnnotation)(f,o);const m=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:m,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,O.A)(m),f},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,[l,c]=s.handles.points,u=a.worldToCanvas(l),d=a.worldToCanvas(c),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}};return Le.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,Ie.hideElementCursor)(r);(0,i.getEnabledElement)(r);(0,O.A)(o),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;(0,i.getEnabledElement)(e);return(0,O.A)(n),r&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(i),l=i.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const o=a[r],{annotationUID:u,data:d}=o,{points:h,activeHandleIndex:p}=d.handles;c.annotationUID=u;const{color:f,lineWidth:m,lineDash:g,shadow:v}=this.getAnnotationStyle({annotation:o,styleSpecifier:c}),y=h.map(e=>i.worldToCanvas(e));let _;if(d.cachedStats[s]&&null!=d.cachedStats[s].unit?o.invalidated&&this._throttledCalculateCachedStats(o,l,e):(d.cachedStats[s]={length:null,unit:null},this._calculateCachedStats(o,l,e)),!(0,V.isAnnotationVisible)(u))continue;if((0,B.isAnnotationLocked)(u)||this.editData||null===p||(_=[y[p]]),_){const e="0";(0,ge.drawHandles)(t,u,e,y,{color:f,lineDash:g,lineWidth:m})}const w="0";if((0,ge.drawHeight)(t,u,w,y[0],y[1],{color:f,width:m,lineDash:g}),n=!0,!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const E=this.getLinkedTextBoxStyle(c,o);if(!E.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const b=this.configuration.getTextLines(d,s);if(!d.handles.textBox.hasMoved){const e=(0,At.getTextBoxCoordsCanvas)(y);d.handles.textBox.worldPosition=i.canvasToWorld(e)}const x=i.worldToCanvas(d.handles.textBox.worldPosition),C="1",I=(0,ge.drawLinkedTextBox)(t,u,C,b,x,y,{},E),{x:S,y:D,width:A,height:T}=I;d.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([S,D]),topRight:i.canvasToWorld([S+A,D]),bottomLeft:i.canvasToWorld([S,D+T]),bottomRight:i.canvasToWorld([S+A,D+T])}}return n},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,Ie.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,O.A)(c),e.preventDefault()}_calculateHeight(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return 0==n?0!=i?Math.abs(r):0:0==i?Math.abs(r):0==r?Math.abs(i):void 0}_calculateCachedStats(e,t,n){const i=e.data,{element:r}=n.viewport,o=i.handles.points[0],a=i.handles.points[1],{cachedStats:s}=i,l=Object.keys(s);for(let e=0;e<l.length;e++){const t=l[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:i,dimensions:r}=n,c=Pt(i,o),u=Pt(i,a),d=[c,u],{scale:h,unit:p}=(0,St.Op)(n,d),f=this._calculateHeight(o,a)/h,m=this._isInsideVolume(c,u,r);this.isHandleOutsideImage=m,s[t]={height:f,unit:p}}return e.invalidated=!1,(0,xe.XF)(e,r),s}_isInsideVolume(e,t,n){return i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n)}}function kt(e,t){const n=e.cachedStats[t],{height:r,unit:o}=n;if(null==r||isNaN(r))return;return[`${i.utilities.roundNumber(r)} ${o}`]}Mt.toolName="Height";var Rt=n(40634),Lt=n(18990);const{transformWorldToIndex:Ft}=i.utilities;class Ut extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Bt}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l}=s;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=c,h=this.getReferencedImageId(l,a,u),p=l.getFrameOfReferenceUID(),f={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:p,referencedImageId:h},data:{label:"",handles:{points:[[...a]]},cachedStats:{}}};(0,r.addAnnotation)(f,o);const m=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,newAnnotation:!0,viewportIdsToRender:m},this._activateModify(o),(0,Ie.hideElementCursor)(o),e.preventDefault(),(0,O.A)(m),f},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s}=this.editData,{viewportId:l,renderingEngine:c}=(0,i.getEnabledElement)(n);this.eventDispatchDetail={viewportId:l,renderingEngineId:c.id},this._deactivateModify(n),(0,Ie.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,{annotation:a,viewportIdsToRender:s}=this.editData,{data:l}=a;l.handles.points[0]=[...o],a.invalidated=!0;const c=(0,i.getEnabledElement)(r),{renderingEngine:u}=c;(0,O.A)(s)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:a}=o;let s=(0,r.getAnnotations)(this.getToolName(),a);if(!s?.length)return n;if(s=this.filterInteractableAnnotationsForElement(a,s),!s?.length)return n;const l=this.getTargetId(o),c=o.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<s.length;r++){const a=s[r],d=a.annotationUID,h=a.data,p=h.handles.points[0],f=o.worldToCanvas(p);u.annotationUID=d;const{color:m}=this.getAnnotationStyle({annotation:a,styleSpecifier:u});if(h.cachedStats||(h.cachedStats={}),h.cachedStats[l]&&null!=h.cachedStats[l].value){if(a.invalidated&&(this._calculateCachedStats(a,c,e),o instanceof i.VolumeViewport)){const{referencedImageId:e}=a.metadata;for(const t in h.cachedStats)if(t.startsWith("imageId")){c.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete h.cachedStats[t]}}}else h.cachedStats[l]={Modality:null,index:null,value:null},this._calculateCachedStats(a,c,e);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const g="0";(0,ge.drawHandles)(t,d,g,[f],{color:m}),n=!0;const v=this.getLinkedTextBoxStyle(u,a);if(!v.visibility)continue;const y=this.configuration.getTextLines(h,l);if(y){const e=[f[0]+6,f[1]-6],n="0";(0,ge.drawTextBox)(t,d,n,y,[e[0],e[1]],v)}}return n}}isPointNearTool(){return!1}toolSelectedCallback(){}static{this.hydrate=(e,t,n)=>{const o=(0,i.getEnabledElementByViewportId)(e);if(!o)return;const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:l,viewUp:c}=a.getCamera(),u=new this,d=u.getReferencedImageId(a,t[0],l,c),h={annotationUID:n?.annotationUID||i.utilities.uuidv4(),data:{handles:{points:t}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:u.getToolName(),viewPlaneNormal:l,FrameOfReferenceUID:s,referencedImageId:d,...n}};(0,r.addAnnotation)(h,a.element),(0,O.A)([a.id])}}getHandleNearImagePoint(e,t,n,r){const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,l=s.handles.points[0],c=a.worldToCanvas(l);if(!0===he.Zc.distance(n,c)<r)return l}handleSelectedCallback(e,t){const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o},this._activateModify(r),(0,Ie.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()}_calculateCachedStats(e,t,n){const r=e.data,{renderingEngineId:o,viewport:a}=n,{element:s}=a,l=r.handles.points[0],{cachedStats:c}=r,u=Object.keys(c);for(let t=0;t<u.length;t++){const n=u[t],r={isPreScaled:(0,Lt.u)(a,n),isSuvScaled:this.isSuvScaled(a,n,e.metadata.referencedImageId)},o=this.getTargetImageData(n);if(!o)continue;const{dimensions:d,imageData:h,metadata:p,voxelManager:f}=o,m=p.Modality;let g=Ft(h,l);if(g=he.eR.round(g,g),i.utilities.indexWithinDimensions(g,d)){this.isHandleOutsideImage=!1;let t,a=f.getAtIJKPoint(g);if(n.startsWith("imageId:")){const e=n.split("imageId:")[1],t=i.utilities.imageIdToURI(e),r=i.utilities.getViewportsWithImageURI(t)[0];g[2]=r.getCurrentImageIdIndex()}if("US"===m){const e=(0,St.Xw)(o,[g]),n=e.values.every(e=>null!==e);a=n?e.values:a,t=n?e.units:"raw"}else t=(0,Rt.j)(m,e.metadata.referencedImageId,r);c[n]={index:g,value:a,Modality:m,modalityUnit:t}}else this.isHandleOutsideImage=!0,c[n]={index:g,Modality:m};e.invalidated=!1,(0,xe.XF)(e,s)}return c}}function Bt(e,t){const n=e.cachedStats[t],{index:r,value:o,modalityUnit:a}=n;if(void 0===o)return;const s=[];if(s.push(`(${r[0]}, ${r[1]}, ${r[2]})`),o instanceof Array&&a instanceof Array)for(let e=0;e<o.length;e++)s.push(`${i.utilities.roundNumber(o[e])} ${a[e]}`);else s.push(`${i.utilities.roundNumber(o)} ${a}`);return s}Ut.toolName="Probe";const Vt=Ut;class Wt extends Vt{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:jt}}){super(e,t),this.postMouseDownCallback=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:s,renderingEngine:l}=a;this.isDrawing=!0;const c=s.getCamera(),{viewPlaneNormal:u,viewUp:d}=c,h=this.getReferencedImageId(s,o,u,d),p={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:s.getFrameOfReferenceUID(),referencedImageId:h},data:{label:"",handles:{points:[[...o]]},cachedStats:{}}},f=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:p,newAnnotation:!0,viewportIdsToRender:f},this._activateModify(r),(0,Ie.hideElementCursor)(r),e.preventDefault(),(0,O.A)(f),p},this.postTouchStartCallback=e=>this.postMouseDownCallback(e),this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e;if(!this.editData)return n;const r=this.filterInteractableAnnotationsForElement(i.element,[this.editData.annotation]);if(!r?.length)return n;const o=this.getTargetId(i),a=i.getRenderingEngine(),s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},l=this.editData.annotation,c=l.annotationUID,u=l.data,d=u.handles.points[0],h=i.worldToCanvas(d);s.annotationUID=c;const{color:p}=this.getAnnotationStyle({annotation:l,styleSpecifier:s});if(u.cachedStats[o]&&null!=u.cachedStats[o].value?l.invalidated&&this._calculateCachedStats(l,a,e):(u.cachedStats[o]={Modality:null,index:null,value:null},this._calculateCachedStats(l,a,e)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;(0,ge.drawHandles)(t,c,"0",[h],{color:p}),n=!0;const f=this.configuration.getTextLines(u,o);if(f){const e=[h[0]+6,h[1]-6],n="0";(0,ge.drawTextBox)(t,c,n,f,[e[0],e[1]],this.getLinkedTextBoxStyle(s,l))}return n}}}function jt(e,t){const n=e.cachedStats[t],{index:i,value:r,modalityUnit:o}=n;if(void 0===r)return;const a=[];return a.push(`(${i[0]}, ${i[1]}, ${i[2]})`),a.push(`${r.toFixed(2)} ${o}`),a}Wt.toolName="DragProbe";n(4010);function Ht(e,t,n,i){const r=he.eR.create();he.eR.cross(r,t,e);const o=he.eR.fromValues(...n),a=he.eR.fromValues(...i),s=he.eR.create();he.eR.subtract(s,o,a);const l=he.eR.length(s);if(l<1e-4)return{worldWidth:0,worldHeight:0};const c=he.eR.dot(s,r)/(l*he.eR.length(r));return{worldWidth:Math.sqrt(1-c*c)*l,worldHeight:c*l}}var zt=n(87009),Gt=n(79362);const{transformWorldToIndex:qt}=i.utilities;class $t extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,getTextLines:Xt,statsCalculator:Gt.BasicStatsCalculator}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(n.canvas,(0,i.getEnabledElement)(o)),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p,...l.getViewReference({points:[a]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...a],[...a],[...a],[...a]],activeHandleIndex:null},cachedStats:{},initialRotation:l.getRotation()}};(0,r.addAnnotation)(m,o);const g=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,centerWorld:a,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,Ie.hideElementCursor)(o),e.preventDefault(),(0,O.A)(g),m},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=l.map(e=>a.worldToCanvas(e)),u=(0,zt.getCanvasEllipseCorners)(c),[d,h]=u,p={left:Math.min(d[0],h[0])+r/2,top:Math.min(d[1],h[1])+r/2,width:Math.abs(d[0]-h[0])-r,height:Math.abs(d[1]-h[1])-r},f={left:Math.min(d[0],h[0])-r/2,top:Math.min(d[1],h[1])-r/2,width:Math.abs(d[0]-h[0])+r,height:Math.abs(d[1]-h[1])+r},m=this._pointInEllipseCanvas(p,n);return!(!this._pointInEllipseCanvas(f,n)||m)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},(0,Ie.hideElementCursor)(r),this._activateModify(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l,c,u,d,h,p=!1;if(n.worldPosition)p=!0;else{const{points:e}=a.handles,{viewport:t}=(0,i.getEnabledElement)(o),{worldToCanvas:r,canvasToWorld:p}=t;s=e.findIndex(e=>e===n);const f=e.map(r);h=f[s],u=Math.abs(f[2][0]-f[3][0]),d=Math.abs(f[0][1]-f[1][1]),l=[(f[2][0]+f[3][0])/2,(f[0][1]+f[1][1])/2],c=p(l)}const f=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:f,handleIndex:s,canvasWidth:u,canvasHeight:d,centerWorld:c,originalHandleCanvas:h,movingTextBox:p},this._activateModify(o),(0,Ie.hideElementCursor)(o);const m=(0,i.getEnabledElement)(o),{renderingEngine:g}=m;(0,O.A)(f),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;o.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d,centerWorld:h}=this.editData,p=l.worldToCanvas(h),{data:f}=u,m=Math.abs(o[0]-p[0]),g=Math.abs(o[1]-p[1]),v=[p[0],p[1]-g],y=[p[0],p[1]+g],_=[p[0]-m,p[1]],w=[p[0]+m,p[1]];f.handles.points=[c(v),c(y),c(_),c(w)],u.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(d)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else this._dragHandle(e),r.invalidated=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,{viewport:r}=(0,i.getEnabledElement)(n),{canvasToWorld:o,worldToCanvas:a}=r,{annotation:s,canvasWidth:l,canvasHeight:c,handleIndex:u,centerWorld:d,originalHandleCanvas:h}=this.editData,p=r.worldToCanvas(d),{data:f}=s,{points:m}=f.handles,{currentPoints:g}=t,v=g.canvas;if(0===u||1===u){const e=Math.abs(v[1]-p[1]),t=[p[0],p[1]-e],n=[p[0],p[1]+e];m[0]=o(t),m[1]=o(n);const i=l/2+(v[0]-h[0]),r=[p[0]-i,p[1]],a=[p[0]+i,p[1]];m[2]=o(r),m[3]=o(a)}else{const e=Math.abs(v[0]-p[0]),t=[p[0]-e,p[1]],n=[p[0]+e,p[1]];m[2]=o(t),m[3]=o(n);const i=c/2+(v[1]-h[1]),r=[p[0],p[1]-i],a=[p[0],p[1]+i];m[0]=o(r),m[1]=o(a)}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:a}=o;let s=(0,r.getAnnotations)(this.getToolName(),a);if(!s?.length)return n;if(s=this.filterInteractableAnnotationsForElement(a,s),!s?.length)return n;const l=this.getTargetId(o),c=o.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<s.length;r++){const a=s[r],{annotationUID:d,data:h}=a,{handles:p}=h,{points:f,activeHandleIndex:m}=p;u.annotationUID=d;const{color:g,lineWidth:v,lineDash:y}=this.getAnnotationStyle({annotation:a,styleSpecifier:u}),_=f.map(e=>o.worldToCanvas(e)),w=(0,zt.getCanvasEllipseCorners)(_),{centerPointRadius:E}=this.configuration;if(h.cachedStats[l]&&null!=h.cachedStats[l].areaUnit){if(a.invalidated&&(this._throttledCalculateCachedStats(a,o,c,e),o instanceof i.VolumeViewport)){const{referencedImageId:e}=a.metadata;for(const t in h.cachedStats)if(t.startsWith("imageId")){c.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete h.cachedStats[t]}}}else h.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(a,o,c);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let b;if(!(0,V.isAnnotationVisible)(d))continue;if((0,B.isAnnotationLocked)(d)||this.editData||null===m||(b=[_[m]]),b){const e="0";(0,ge.drawHandles)(t,d,e,b,{color:g})}const x=`${d}-ellipse`,C="0";if((0,ge.drawEllipseByCoordinates)(t,d,C,_,{color:g,lineDash:y,lineWidth:v},x),E>0){if(Math.min(Math.abs(w[0][0]-w[1][0])/2,Math.abs(w[0][1]-w[1][1])/2)>3*E){const e=this._getCanvasEllipseCenter(_);(0,ge.drawCircle)(t,d,`${C}-center`,e,E,{color:g,lineDash:y,lineWidth:v})}}n=!0;const I=this.getLinkedTextBoxStyle(u,a);if(!I.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const S=this.configuration.getTextLines(h,l);if(!S||0===S.length)continue;let D;h.handles.textBox.hasMoved||(D=(0,At.getTextBoxCoordsCanvas)(w),h.handles.textBox.worldPosition=o.canvasToWorld(D));const A=o.worldToCanvas(h.handles.textBox.worldPosition),T="1",N=(0,ge.drawLinkedTextBox)(t,d,T,S,A,_,{},I),{x:O,y:P,width:M,height:k}=N;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([O,P]),topRight:o.canvasToWorld([O+M,P]),bottomLeft:o.canvasToWorld([O,P+k]),bottomRight:o.canvasToWorld([O+M,P+k])}}return n},this._calculateCachedStats=(e,t,n)=>{const i=e.data,{element:r}=t,{points:o}=i.handles,a=o.map(e=>t.worldToCanvas(e)),{viewPlaneNormal:s,viewUp:l}=t.getCamera(),[c,u]=(0,zt.getCanvasEllipseCorners)(a),d=t.canvasToWorld(c),h=t.canvasToWorld(u),{cachedStats:p}=i,f=Object.keys(p),m=d,g=h;for(let n=0;n<f.length;n++){const i=f[n],r=this.getTargetImageData(i);if(!r)continue;const{dimensions:o,imageData:a,metadata:c,voxelManager:u}=r,v=qt(a,m);v[0]=Math.floor(v[0]),v[1]=Math.floor(v[1]),v[2]=Math.floor(v[2]);const y=qt(a,g);y[0]=Math.floor(y[0]),y[1]=Math.floor(y[1]),y[2]=Math.floor(y[2]),this.isHandleOutsideImage=!this._isInsideVolume(v,y,o);const _=[[Math.min(v[0],y[0]),Math.max(v[0],y[0])],[Math.min(v[1],y[1]),Math.max(v[1],y[1])],[Math.min(v[2],y[2]),Math.max(v[2],y[2])]],w={center:[(d[0]+h[0])/2,(d[1]+h[1])/2,(d[2]+h[2])/2],xRadius:Math.abs(d[0]-h[0])/2,yRadius:Math.abs(d[1]-h[1])/2,zRadius:Math.abs(d[2]-h[2])/2},{worldWidth:E,worldHeight:b}=Ht(s,l,m,g),x=0===E&&0===b,C=[v,y],{scale:I,areaUnit:S}=(0,St.Op)(r,C),D=Math.abs(Math.PI*(E/2)*(b/2))/I/I,A={isPreScaled:(0,Lt.u)(t,i),isSuvScaled:this.isSuvScaled(t,i,e.metadata.referencedImageId)},T=(0,Rt.j)(c.Modality,e.metadata.referencedImageId,A),N=u.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:_,imageData:a,isInObject:e=>(0,zt.pointInEllipse)(w,e,{fast:!0}),returnPoints:this.configuration.storePointData}),O=this.configuration.statsCalculator.getStatistics();p[i]={Modality:c.Modality,area:D,mean:O.mean?.value,max:O.max?.value,stdDev:O.stdDev?.value,statsArray:O.array,pointsInShape:N,isEmptyArea:x,areaUnit:S,modalityUnit:T}}return e.invalidated=!1,(0,xe.XF)(e,r),p},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(e,t){const n=e.width/2,i=e.height/2;if(n<=0||i<=0)return!1;const r=[e.left+n,e.top+i],o=[t[0]-r[0],t[1]-r[1]];return o[0]*o[0]/(n*n)+o[1]*o[1]/(i*i)<=1}_getCanvasEllipseCenter(e){const[t,n,i,r]=e,o=[i[0],n[1]],a=[r[0],t[1]];return[(o[0]+a[0])/2,(o[1]+a[1])/2]}}function Xt(e,t){const n=e.cachedStats[t],{area:r,mean:o,stdDev:a,max:s,isEmptyArea:l,areaUnit:c,modalityUnit:u}=n,d=[];if(r){const e=l?"Area: Oblique not supported":`Area: ${i.utilities.roundNumber(r)} ${c}`;d.push(e)}return o&&d.push(`Mean: ${i.utilities.roundNumber(o)} ${u}`),s&&d.push(`Max: ${i.utilities.roundNumber(s)} ${u}`),a&&d.push(`Std Dev: ${i.utilities.roundNumber(a)} ${u}`),d}$t.toolName="EllipticalROI";const{transformWorldToIndex:Kt}=i.utilities;class Yt extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,getTextLines:Jt,statsCalculator:Gt.BasicStatsCalculator}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p,...l.getViewReference({points:[a]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...a],[...a]],activeHandleIndex:null},cachedStats:{}}};(0,r.addAnnotation)(m,o);const g=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,Ie.hideElementCursor)(o),e.preventDefault(),(0,O.A)(g),m},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=l.map(e=>a.worldToCanvas(e)),u=Ke(c),d=Ke([c[0],n]);return Math.abs(d-u)<r/2},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},(0,Ie.hideElementCursor)(r),this._activateModify(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex(e=>e===n)}const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,Ie.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,O.A)(c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;o.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d}=this.editData,{data:h}=u;h.handles.points=[h.handles.points[0],c(o)],u.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(d)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else this._dragHandle(e),r.invalidated=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{canvasToWorld:o,worldToCanvas:a}=r.viewport,{annotation:s,handleIndex:l}=this.editData,{data:c}=s,{points:u}=c.handles,d=u.map(e=>a(e)),{currentPoints:h}=t,p=h.canvas;if(0===l){const e=p[0]-d[0][0],t=p[1]-d[0][1],n=p,i=[d[1][0]+e,d[1][1]+t];u[0]=o(n),u[1]=o(i)}else u[1]=o(p)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:a}=o;let s=(0,r.getAnnotations)(this.getToolName(),a);if(!s?.length)return n;if(s=this.filterInteractableAnnotationsForElement(a,s),!s?.length)return n;const l=this.getTargetId(o),c=o.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<s.length;r++){const a=s[r],{annotationUID:d,data:h}=a,{handles:p}=h,{points:f,activeHandleIndex:m}=p;u.annotationUID=d;const{color:g,lineWidth:v,lineDash:y}=this.getAnnotationStyle({annotation:a,styleSpecifier:u}),_=f.map(e=>o.worldToCanvas(e)),w=_[0],E=Ke(_),b=Ye(_),{centerPointRadius:x}=this.configuration;if(h.cachedStats[l]&&null!=h.cachedStats[l].areaUnit){if(a.invalidated&&(this._throttledCalculateCachedStats(a,o,c,e),o instanceof i.VolumeViewport)){const{referencedImageId:e}=a.metadata;for(const t in h.cachedStats)if(t.startsWith("imageId")){c.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete h.cachedStats[t]}}}else h.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(a,o,c,e);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let C;if(!(0,V.isAnnotationVisible)(d))continue;if((0,B.isAnnotationLocked)(d)||this.editData||null===m||(C=[_[m]]),C){const e="0";(0,ge.drawHandles)(t,d,e,C,{color:g})}const I=`${d}-circle`,S="0";(0,ge.drawCircle)(t,d,S,w,E,{color:g,lineDash:y,lineWidth:v},I),x>0&&E>3*x&&(0,ge.drawCircle)(t,d,`${S}-center`,w,x,{color:g,lineDash:y,lineWidth:v}),n=!0;const D=this.getLinkedTextBoxStyle(u,a);if(!D.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(h,l);if(!A||0===A.length)continue;let T;h.handles.textBox.hasMoved||(T=(0,At.getTextBoxCoordsCanvas)(b),h.handles.textBox.worldPosition=o.canvasToWorld(T));const N=o.worldToCanvas(h.handles.textBox.worldPosition),O="1",P=(0,ge.drawLinkedTextBox)(t,d,O,A,N,_,{},D),{x:M,y:k,width:R,height:L}=P;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([M,k]),topRight:o.canvasToWorld([M+R,k]),bottomLeft:o.canvasToWorld([M,k+L]),bottomRight:o.canvasToWorld([M+R,k+L])}}return n},this._calculateCachedStats=(e,t,n,i)=>{const r=e.data,{element:o}=t,{points:a}=r.handles,s=a.map(e=>t.worldToCanvas(e)),{viewPlaneNormal:l,viewUp:c}=t.getCamera(),[u,d]=Ye(s),h=t.canvasToWorld(u),p=t.canvasToWorld(d),{cachedStats:f}=r,m=Object.keys(f),g=h,v=p;for(let n=0;n<m.length;n++){const i=m[n],r=this.getTargetImageData(i);if(!r)continue;const{dimensions:o,imageData:a,metadata:s,voxelManager:u}=r,d=Kt(a,g);d[0]=Math.floor(d[0]),d[1]=Math.floor(d[1]),d[2]=Math.floor(d[2]);const y=Kt(a,v);if(y[0]=Math.floor(y[0]),y[1]=Math.floor(y[1]),y[2]=Math.floor(y[2]),this._isInsideVolume(d,y,o)){const n=[[Math.min(d[0],y[0]),Math.max(d[0],y[0])],[Math.min(d[1],y[1]),Math.max(d[1],y[1])],[Math.min(d[2],y[2]),Math.max(d[2],y[2])]],o={center:[(h[0]+p[0])/2,(h[1]+p[1])/2,(h[2]+p[2])/2],xRadius:Math.abs(h[0]-p[0])/2,yRadius:Math.abs(h[1]-p[1])/2,zRadius:Math.abs(h[2]-p[2])/2},{worldWidth:m,worldHeight:_}=Ht(l,c,g,v),w=0===m&&0===_,E=[d,y],{scale:b,unit:x,areaUnit:C}=(0,St.Op)(r,E),I=(0,St.CQ)(r),S=Math.abs(Math.PI*(m/b/2)*(_/I/b/2)),D={isPreScaled:(0,Lt.u)(t,i),isSuvScaled:this.isSuvScaled(t,i,e.metadata.referencedImageId)},A=(0,Rt.j)(s.Modality,e.metadata.referencedImageId,D),T=u.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:e=>(0,zt.pointInEllipse)(o,e,{fast:!0}),boundsIJK:n,imageData:a,returnPoints:this.configuration.storePointData}),N=this.configuration.statsCalculator.getStatistics();f[i]={Modality:s.Modality,area:S,mean:N.mean?.value,max:N.max?.value,stdDev:N.stdDev?.value,statsArray:N.array,pointsInShape:T,isEmptyArea:w,areaUnit:C,radius:m/2/b,radiusUnit:x,perimeter:2*Math.PI*(m/2)/b,modalityUnit:A}}else this.isHandleOutsideImage=!0,f[i]={Modality:s.Modality}}return e.invalidated=!1,(0,xe.XF)(e,o),f},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}static{this.hydrate=(e,t,n)=>{const o=(0,i.getEnabledElementByViewportId)(e);if(!o)return;const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:l,viewUp:c}=a.getCamera(),u=new this,d=u.getReferencedImageId(a,t[0],l,c),h={annotationUID:n?.annotationUID||i.utilities.uuidv4(),data:{handles:{points:t,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:u.getToolName(),viewPlaneNormal:l,FrameOfReferenceUID:s,referencedImageId:d,...n}};(0,r.addAnnotation)(h,a.element),(0,O.A)([a.id])}}}function Jt(e,t){const n=e.cachedStats[t],{radius:r,radiusUnit:o,area:a,mean:s,stdDev:l,max:c,isEmptyArea:u,areaUnit:d,modalityUnit:h}=n,p=[];if(r){const e=u?"Radius: Oblique not supported":`Radius: ${i.utilities.roundNumber(r)} ${o}`;p.push(e)}if(a){const e=u?"Area: Oblique not supported":`Area: ${i.utilities.roundNumber(a)} ${d}`;p.push(e)}return s&&p.push(`Mean: ${i.utilities.roundNumber(s)} ${h}`),c&&p.push(`Max: ${i.utilities.roundNumber(c)} ${h}`),l&&p.push(`Std Dev: ${i.utilities.roundNumber(l)} ${h}`),p}Yt.toolName="CircleROI";const Zt=Yt;class Qt extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,degrees:[45,135,225,315],diameters:[10,30,60]}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p,...l.getViewReference({points:[a]})},data:{label:"",handles:{points:[[...a]]}}};(0,r.addAnnotation)(m,o);const g=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,newAnnotation:!0},this._activateDraw(o),(0,Ie.hideElementCursor)(o),e.preventDefault(),(0,O.A)(g),m},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=Ke([a.worldToCanvas(l[0]),n]);return Math.abs(c)<r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o},(0,Ie.hideElementCursor)(r),this._activateModify(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this.handleSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o},this._activateModify(r),(0,Ie.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;o.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d}=this.editData,{data:h}=u;h.handles.points=[c(o),c(o)],u.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(d)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o}=this.editData,{data:a}=r,{deltaPoints:s}=t,l=s.world;a.handles.points.forEach(e=>{e[0]+=l[0],e[1]+=l[1],e[2]+=l[2]}),r.invalidated=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{canvasToWorld:o,worldToCanvas:a}=r.viewport,{annotation:s}=this.editData,{data:l}=s,{points:c}=l.handles,u=c.map(e=>a(e)),{currentPoints:d}=t,h=d.canvas,p=h[0]-u[0][0],f=h[1]-u[0][1],m=h,g=[u[1][0]+p,u[1][1]+f];c[0]=o(m),c[1]=o(g)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,i.getEnabledElement)(e);return(0,O.A)(n),r&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const r=a[e],{annotationUID:o,data:l}=r,{handles:c}=l,{points:u}=c;s.annotationUID=o;const{color:d,lineWidth:h,lineDash:p}=this.getAnnotationStyle({annotation:r,styleSpecifier:s}),f=u.map(e=>i.worldToCanvas(e))[0];if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,V.isAnnotationVisible)(o))continue;let m=`${o}-crosshair-vertical`,g=[f[0],f[1]+5],v=[f[0],f[1]-5];(0,ge.drawLine)(t,o,m,g,v,{color:d,lineDash:p,lineWidth:h}),m=`${o}-crosshair-horizontal`,g=[f[0]+5,f[1]],v=[f[0]-5,f[1]],(0,ge.drawLine)(t,o,m,g,v,{color:d,lineDash:p,lineWidth:h});const y=this.configuration.diameters.map(e=>this.worldMeasureToCanvas(e,i));for(let e=0;e<y.length;e++){const n=`${o}-circle-${e}`,i=`${o}-circle-${e}`;(0,ge.drawCircle)(t,o,i,f,y[e]/2,{color:d,lineDash:p,lineWidth:h},n)}const _=e=>e*Math.PI/180,w=this.configuration.degrees.map(e=>_(e));for(let e=0;e<w.length;e++){const n=`${o}-line-${e}`,i=[Math.cos(w[e])*y[0]/2+f[0],Math.sin(w[e])*y[0]/2+f[1]],r=[Math.cos(w[e])*y[2]/2+f[0],Math.sin(w[e])*y[2]/2+f[1]];(0,ge.drawLine)(t,o,n,i,r,{color:d,lineDash:p,lineWidth:h})}n=!0}return n}}worldMeasureToCanvas(e,t){const n=t.canvasToWorld([t.canvas.width/2,t.canvas.height/2]),{viewUp:i}=t.getCamera(),r=he.eR.scaleAndAdd(he.eR.create(),n,i,e),o=t.worldToCanvas(n),a=t.worldToCanvas(r);return Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2))}}Qt.toolName="ETDRSGrid";var en=n(93126);class tn{constructor(e){this._controlPoints=[],this._invalidated=!1,this._length=0,this._controlPoints=[],this._resolution=e?.resolution??20,this._fixedResolution=e?.fixedResolution??!1,this._closed=e?.closed??!1,this._invalidated=!0}get controlPoints(){return this._controlPoints}get numControlPoints(){return this._controlPoints.length}get resolution(){return this._resolution}set resolution(e){this._fixedResolution||this._resolution===e||(this._resolution=e,this.invalidated=!0)}get fixedResolution(){return this._fixedResolution}get closed(){return this._closed}set closed(e){this._closed!==e&&(this._closed=e,this.invalidated=!0)}get aabb(){return this._update(),this._aabb}get length(){return this._update(),this._length}get invalidated(){return this._invalidated}set invalidated(e){this._invalidated=e}hasTangentPoints(){return!1}addControlPoint(e){this._controlPoints.push([e[0],e[1]]),this.invalidated=!0}addControlPoints(e){e.forEach(e=>this.addControlPoint(e))}addControlPointAtU(e){const t=this._getLineSegmentAt(e),{start:n,end:i}=t.points,r=Math.floor(e),o=this._curveSegments[r],a=e-Math.floor(r),s=[n[0]+a*(i[0]-n[0]),n[1]+a*(i[1]-n[1])],l=this._controlPoints.indexOf(o.controlPoints.p1)+1;return this._controlPoints.splice(l,0,s),this.invalidated=!0,{index:l,point:s}}deleteControlPointByIndex(e){const t=this._closed?3:1;return e>=0&&e<this._controlPoints.length&&this._controlPoints.length>t&&(this._controlPoints.splice(e,1),this.invalidated=!0,!0)}clearControlPoints(){this._controlPoints=[],this.invalidated=!0}setControlPoints(e){this.clearControlPoints(),this.addControlPoints(e)}updateControlPoint(e,t){if(e<0||e>=this._controlPoints.length)throw new Error("Index out of bounds");this._controlPoints[e]=[...t],this.invalidated=!0}getControlPoints(){return this._controlPoints.map(e=>[e[0],e[1]])}getClosestControlPoint(e){const t=this._controlPoints;let n=1/0,i=-1;for(let r=0,o=t.length;r<o;r++){const o=t[r],a=e[0]-o[0],s=e[1]-o[1],l=a*a+s*s;l<n&&(n=l,i=r)}return{index:i,point:-1===i?void 0:[...t[i]],distance:Math.sqrt(n)}}getClosestControlPointWithinDistance(e,t){const n=this.getClosestControlPoint(e);return n.distance<=t?n:void 0}getClosestPoint(e){this._update();const t=this._getCurveSegmmentsDistanceSquaredInfo(e);if(!t.length)return;let n;t.sort((e,t)=>e.distanceSquared-t.distanceSquared);let i,r,o=-1,a=1/0;for(let s=0;s<t.length;s++){const l=t[s];if(l.distanceSquared>a)continue;const{curveSegmentIndex:c,curveSegment:u}=l,{lineSegments:d}=u;for(let t=0;t<d.length;t++){const s=d[t],{point:u,distanceSquared:h}=vt.lineSegment.distanceToPointSquaredInfo(s.points.start,s.points.end,e);h<a&&(r=s,o=c,i=l.curveSegment,n=u,a=h)}}return{point:n,uValue:o+(r.previousLineSegmentsLength+vt.point.distanceToPoint(r.points.start,n))/i.length,distance:Math.sqrt(a)}}getClosestPointOnControlPointLines(e){const t=[...this._controlPoints];if(this._closed&&t.push(this._controlPoints[0]),!t.length)return;let n,i=1/0,r=t[0];for(let o=1,a=t.length;o<a;o++){const a=t[o],{point:s,distanceSquared:l}=vt.lineSegment.distanceToPointSquaredInfo(r,a,e);l<i&&(n=s,i=l),r=a}return{point:n,distance:Math.sqrt(i)}}getPolylinePoints(){return this._update(),this._convertCurveSegmentsToPolyline(this._curveSegments)}getPreviewPolylinePoints(e,t){if(this._closed)return[];this._update();const n=this.getClosestControlPointWithinDistance(e,t),i=0===n?.index,r=this.getPreviewCurveSegments(e,i);return r?.length?this._convertCurveSegmentsToPolyline(r):[]}isPointNearCurve(e,t){this._update();const n=this._getCurveSegmmentsWithinDistance(e,t),i=t*t;for(let t=0;t<n.length;t++){const{lineSegments:r}=n[t];for(let t=0;t<r.length;t++){const n=r[t];if(vt.lineSegment.distanceToPointSquared(n.points.start,n.points.end,e)<=i)return!0}}return!1}containsPoint(e){this._update();if(this._controlPoints.length<3)return!1;const t=[...this._curveSegments],n=this._getClosingCurveSegmentWithStraightLineSegment();n&&t.push(n);let i=0;for(let n=0;n<t.length;n++){const r=t[n],{aabb:o}=r;if(!(e[0]<=o.maxX&&e[1]>=o.minY&&e[1]<o.maxY))continue;const{lineSegments:a}=r;for(let t=0;t<a.length;t++){const n=a[t],{aabb:r}=n;if(e[0]<=r.maxX&&e[1]>=r.minY&&e[1]<r.maxY){const{start:t,end:r}=n.points,o=t[0]===r[0],a=(e[1]-t[1])*(r[0]-t[0])/(r[1]-t[1])+t[0];i+=o||e[0]<=a?1:0}}}return i%2==1}_update(){if(!this._invalidated)return;const e=this.getSplineCurves();let t=0,n=1/0,i=1/0,r=-1/0,o=-1/0;for(let a=0,s=e.length;a<s;a++){const{aabb:s,length:l}=e[a];n=n<=s.minX?n:s.minX,i=i<=s.minY?i:s.minY,r=r>=s.maxX?r:s.maxX,o=o>=s.maxY?o:s.maxY,t+=l}this._curveSegments=e,this._aabb={minX:n,minY:i,maxX:r,maxY:o},this._length=t,this._invalidated=!1}_convertCurveSegmentsToPolyline(e){this._update();const t=[];return e.forEach(({lineSegments:e},n)=>{e.forEach((e,i)=>{0===n&&0===i&&t.push([...e.points.start]),t.push([...e.points.end])})}),t}_getCurveSegmmentsDistanceSquaredInfo(e){this._update();const t=[],{_curveSegments:n}=this;for(let i=0;i<n.length;i++){const r=n[i],o=vt.aabb.distanceToPointSquared(r.aabb,e);t.push({curveSegmentIndex:i,curveSegment:r,distanceSquared:o})}return t}_getCurveSegmmentsWithinDistance(e,t){this._update();const n=t*t;if(vt.aabb.distanceToPointSquared(this.aabb,e)>n)return[];const i=this._getCurveSegmmentsDistanceSquaredInfo(e),r=[];for(let e=0,t=i.length;e<t;e++){const{curveSegment:t,distanceSquared:o}=i[e];o<=n&&r.push(t)}return r}_getLineSegmentAt(e){this._update();const t=Math.floor(e),n=e-t,i=this._curveSegments[t],{lineSegments:r}=i,o=i.length*n;for(let e=0;e<r.length;e++){const t=r[e],n=t.previousLineSegmentsLength+t.length;if(o>=t.previousLineSegmentsLength&&o<=n)return t}}_getClosingCurveSegmentWithStraightLineSegment(){if(this.closed)return;const e=this._controlPoints,t=e[0],n=e[e.length-1],i={points:{start:[...t],end:[...n]},aabb:{minX:Math.min(t[0],n[0]),minY:Math.min(t[1],n[1]),maxX:Math.max(t[0],n[0]),maxY:Math.max(t[1],n[1])}};return{aabb:{minX:i.aabb.minX,minY:i.aabb.minY,maxX:i.aabb.maxX,maxY:i.aabb.maxY},lineSegments:[i]}}}class nn extends tn{getPreviewCurveSegments(e,t){const n=this._getNumCurveSegments()+1,i=Math.max(0,n-2),r=t?n:n-1,o=this.getTransformMatrix(),a=[...this.controlPoints],s=[];t||a.push(e);for(let e=i;e<=r;e++){const n=this._getCurveSegment(e,o,a,t);s.push(n)}return s}getSplineCurves(){const e=this._getNumCurveSegments(),t=new Array(e);if(e<=0)return[];const n=this.getTransformMatrix();let i=0;for(let r=0;r<e;r++){const e=this._getCurveSegment(r,n);e.previousCurveSegmentsLength=i,t[r]=e,i+=e.length}return t}_getNumCurveSegments(e=this.controlPoints,t=this.closed){return t?e.length:Math.max(0,e.length-1)}_getPoint(e,t,n=this.controlPoints,i=this.closed){const r=this._getNumCurveSegments(n,i),o=Math.floor(e);let a=o%r;const s=e-o;if(a<0||a>=r){if(!this.closed)return;a=(r+a)%r}const{p0:l,p1:c,p2:u,p3:d}=this._getCurveSegmentPoints(a,n,i),h=s*s,p=h*s,f=he.ln.fromValues(1,s,h,p),m=he.ln.transformMat4(he.ln.create(),f,t);return[he.ln.dot(m,he.ln.fromValues(l[0],c[0],u[0],d[0])),he.ln.dot(m,he.ln.fromValues(l[1],c[1],u[1],d[1]))]}_getCurveSegmentPoints(e,t=this.controlPoints,n=this.closed){const i=this._getNumCurveSegments(t,n),r=e-1,o=n?(e+1)%i:e+1,a=o+1,s=t[e],l=t[o];let c,u;return c=r>=0?t[r]:n?t[t.length-1]:vt.point.mirror(l,s),u=a<t.length?t[a]:n?t[0]:vt.point.mirror(s,l),{p0:c,p1:s,p2:l,p3:u}}_getLineSegments(e,t,n=this.controlPoints,i=this.closed){const r=this._getNumCurveSegments(n,i),o=this.resolution+1,a=1/o;let s=e+1;i||e!==r-1||(s-=1e-8);const l=[];let c,u,d=0;for(let r=0,h=e;r<=o;r++,h+=a){h=h>s?s:h;const e=this._getPoint(h,t,n,i);if(!r){c=e;continue}u=e;const o=u[0]-c[0],a=u[1]-c[1],p=Math.sqrt(o**2+a**2),f={minX:c[0]<=u[0]?c[0]:u[0],maxX:c[0]>=u[0]?c[0]:u[0],minY:c[1]<=u[1]?c[1]:u[1],maxY:c[1]>=u[1]?c[1]:u[1]};l.push({points:{start:c,end:u},aabb:f,length:p,previousLineSegmentsLength:d}),c=u,d+=p}return l}_getCurveSegment(e,t=this.getTransformMatrix(),n=this.controlPoints,i=this.closed){const{p0:r,p1:o,p2:a,p3:s}=this._getCurveSegmentPoints(e,n,i),l=this._getLineSegments(e,t,n,i);let c=0,u=1/0,d=1/0,h=-1/0,p=-1/0;return l.forEach(({aabb:e,length:t})=>{u=Math.min(u,e.minX),d=Math.min(d,e.minY),h=Math.max(h,e.maxX),p=Math.max(p,e.maxY),c+=t}),{controlPoints:{p0:r,p1:o,p2:a,p3:s},aabb:{minX:u,minY:d,maxX:h,maxY:p},length:c,previousCurveSegmentsLength:0,lineSegments:l}}}class rn extends nn{constructor(e){super(e),this._scale=e?.scale??.5,this._fixedScale=e?.fixedScale??!1}get scale(){return this._scale}set scale(e){this._fixedScale||this._scale===e||(this._scale=e,this.invalidated=!0)}get fixedScale(){return this._fixedScale}getTransformMatrix(){const{scale:e}=this,t=2*e;return[0,1,0,0,-e,0,e,0,t,e-3,3-t,-e,-e,2-e,e-2,e]}}class on extends rn{constructor(){super({resolution:0,fixedResolution:!0,scale:0,fixedScale:!0})}}class an extends rn{constructor(){super({scale:.5,fixedScale:!0})}}const sn=he.pB.multiplyScalar(he.pB.create(),he.pB.fromValues(1,4,1,0,-3,0,3,0,3,-6,3,0,-1,3,-3,1),1/6);class ln extends nn{getTransformMatrix(){return sn}}var cn=n(36320);const un={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var dn,hn;!function(e){e.Cardinal="CARDINAL",e.Linear="LINEAR",e.CatmullRom="CATMULLROM",e.BSpline="BSPLINE"}(dn||(dn={})),function(e){e.AddControlPoint="addControlPoint",e.DeleteControlPoint="deleteControlPoint"}(hn||(hn={}));class pn extends cn.A{static{this.SplineTypes=dn}static{this.Actions=hn}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:fn,contourHoleAdditionModifierKey:o.KeyboardBindings.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[dn.Cardinal]:{Class:rn,scale:.5},[dn.CatmullRom]:{Class:an},[dn.Linear]:{Class:on},[dn.BSpline]:{Class:ln,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:dn.CatmullRom,drawPreviewEnabled:!0,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[hn.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:o.MouseBindings.Primary,modifierKey:o.KeyboardBindings.Shift}]},[hn.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:o.MouseBindings.Primary,modifierKey:o.KeyboardBindings.Ctrl}]}}}}){super(e,t),this.isHandleOutsideImage=!1,this.fireChangeOnUpdate=null,this.isPointNearTool=(e,t,n,i)=>{const{instance:r}=t.data.spline;return r.isPointNearCurve(n,i)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0;const r=(0,Ce.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:r,movingTextBox:!1},this._activateModify(i),(0,P.triggerAnnotationRenderForViewportIds)(r),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex(e=>e===n)}const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,P.triggerAnnotationRenderForViewportIds)(c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:a,viewportIdsToRender:s,newAnnotation:l,contourHoleProcessingEnabled:c}=this.editData,{data:u}=a;a.autoGenerated=!1,u.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const d=(0,i.getEnabledElement)(n),h=this.getTargetImageData(this.getTargetId(d.viewport)),{imageData:p,dimensions:f}=h;this.isHandleOutsideImage=u.handles.points.map(e=>i.utilities.transformWorldToIndex(p,e)).some(e=>!i.utilities.indexWithinDimensions(e,f)),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(a.annotationUID);const m=l?o.ChangeTypes.Completed:o.ChangeTypes.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=a.annotationUID,this.fireChangeOnUpdate.changeType=m):this.fireChangeOnUpdate={annotationUID:a.annotationUID,changeType:m,contourHoleProcessingEnabled:c},(0,P.triggerAnnotationRenderForViewportIds)(s),this.editData=null,this.isDrawing=!1},this._keyDownCallback=e=>{const t=e.detail,{element:n}=t,i=t.key??"",{lastControlPointDeletionKeys:r}=this.configuration.spline;if(!r.includes(i))return;const{annotation:o}=this.editData,{data:a}=o;if(3!==a.handles.points.length){{const e=a.handles.points.length-1;this._deleteControlPointByIndex(n,o,e)}e.preventDefault()}else this.cancel(n)},this._mouseMoveCallback=e=>{const{drawPreviewEnabled:t}=this.configuration.spline;if(!t)return;const{element:n}=e.detail,{renderingEngine:r}=(0,i.getEnabledElement)(n),o=(0,Ce.getViewportIdsWithToolToRender)(n,this.getToolName());this.editData.lastCanvasPoint=e.detail.currentPoints.canvas,(0,P.triggerAnnotationRenderForViewportIds)(o),e.preventDefault()},this._mouseDownCallback=e=>{const t=e.type===o.Events.MOUSE_DOUBLE_CLICK,{annotation:n,viewportIdsToRender:r}=this.editData,{data:a}=n;if(a.contour.closed)return;const s=e.detail,{element:l}=s,{currentPoints:c}=s,{canvas:u,world:d}=c,h=(0,i.getEnabledElement)(l),{renderingEngine:p}=h;let f=a.handles.points.length>=2&&t,m=!0;if(a.handles.points.length>=3){const{instance:e}=a.spline,t=e.getClosestControlPointWithinDistance(u,10);0===t?.index&&(m=!1,f=!0)}m&&a.handles.points.push(d),a.contour.closed=a.contour.closed||f,n.invalidated=!0,(0,P.triggerAnnotationRenderForViewportIds)(r),a.contour.closed&&this._endCallback(e),e.preventDefault()},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;this.moveAnnotation(r,n)}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,P.triggerAnnotationRenderForViewportIds)(o)},this.triggerAnnotationCompleted=(e,t)=>{const n=o.Events.ANNOTATION_COMPLETED,r={annotation:e,changeType:o.ChangeTypes.Completed,contourHoleProcessingEnabled:t};(0,i.triggerEvent)(i.eventTarget,n,r)},this.triggerAnnotationModified=(e,t,n=o.ChangeTypes.StatsUpdated)=>{const{viewportId:r,renderingEngineId:a}=t,s=o.Events.ANNOTATION_MODIFIED,l={annotation:e,viewportId:r,renderingEngineId:a,changeType:n};(0,i.triggerEvent)(i.eventTarget,s,l)},this.triggerChangeEvent=(e,t,n=o.ChangeTypes.StatsUpdated,i)=>{n===o.ChangeTypes.Completed?this.triggerAnnotationCompleted(e,i):this.triggerAnnotationModified(e,t,n)},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.KEY_DOWN,this._keyDownCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._mouseMoveCallback),e.addEventListener(o.Events.MOUSE_DOWN,this._mouseDownCallback),e.addEventListener(o.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.addEventListener(o.Events.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.KEY_DOWN,this._keyDownCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._mouseMoveCallback),e.removeEventListener(o.Events.MOUSE_DOWN,this._mouseDownCallback),e.removeEventListener(o.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._mouseDownCallback)},this._renderStats=(e,t,n,i)=>{const r=e.data,o=this.getTargetId(t);if(!r.spline.instance.closed||!i.visibility)return;const a=this.configuration.getTextLines(r,o);if(!a||0===a.length)return;const s=r.handles.points.map(e=>t.worldToCanvas(e));if(!r.handles.textBox.hasMoved){const e=(0,At.getTextBoxCoordsCanvas)(s);r.handles.textBox.worldPosition=t.canvasToWorld(e)}const l=t.worldToCanvas(r.handles.textBox.worldPosition),c=(0,ge.drawLinkedTextBox)(n,e.annotationUID??"","textBox",a,l,s,{},i),{x:u,y:d,width:h,height:p}=c;r.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([u,d]),topRight:t.canvasToWorld([u+h,d]),bottomLeft:t.canvasToWorld([u,d+p]),bottomRight:t.canvasToWorld([u+h,d+p])}},this.addControlPointCallback=(e,t)=>{const{data:n}=t,r=n.spline.type,o=this._getSplineConfig(r),a=o.controlPointAdditionDistance;if(!1===o.controlPointAdditionEnabled)return;const s=e.detail,{element:l}=s,c=(0,i.getEnabledElement)(l),{renderingEngine:u,viewport:d}=c,{canvasToWorld:h}=d,{instance:p}=n.spline,f=e.detail.currentPoints.canvas,m=p.getClosestPoint(f);if(m.distance>a)return;const{index:g,point:v}=p.addControlPointAtU(m.uValue);n.handles.points.splice(g,0,h(v)),t.invalidated=!0;const y=(0,Ce.getViewportIdsWithToolToRender)(l,this.getToolName());(0,P.triggerAnnotationRenderForViewportIds)(y)},this.deleteControlPointCallback=(e,t)=>{const n=t.data.spline.type,i=this._getSplineConfig(n),r=i.controlPointDeletionDistance;if(!1===i.controlPointDeletionEnabled)return;const o=e.detail,{element:a,currentPoints:s}=o,{canvas:l}=s,{instance:c}=t.data.spline,u=c.getClosestControlPointWithinDistance(l,r);u&&this._deleteControlPointByIndex(a,t,u.index)},this._calculateCachedStats=(e,t)=>{if(!this.configuration.calculateStats)return;const n=e.data;if(!n.contour.closed)return;const r=(0,i.getEnabledElement)(t),{viewport:a}=r,{cachedStats:s}=n,{polyline:l}=n.contour,c=Object.keys(s);for(let e=0;e<c.length;e++){const t=c[e],n=this.getTargetImageData(t);if(!n)continue;const{metadata:r}=n,o=l.map(e=>a.worldToCanvas(e)),u=o[0],d=a.canvasToWorld(u),h=a.canvasToWorld([u[0]+1,u[1]]),p=a.canvasToWorld([u[0],u[1]+1]),f=he.eR.distance(d,h),m=he.eR.distance(d,p),{imageData:g}=n,{scale:v,areaUnit:y}=(0,St.Op)(n,()=>{const{maxX:e,maxY:t,minX:n,minY:r}=vt.polyline.getAABB(o),s=a.canvasToWorld([n,r]),l=i.utilities.transformWorldToIndex(g,s),c=a.canvasToWorld([e,t]);return[l,i.utilities.transformWorldToIndex(g,c)]});let _=vt.polyline.getArea(o)/v/v;_*=f*m,s[t]={Modality:r.Modality,area:_,areaUnit:y}}return this.triggerAnnotationModified(e,r,o.ChangeTypes.StatsUpdated),s},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:r}=t,{canvas:o}=n,a=(0,W.A)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,s=(0,i.getEnabledElement)(r),{renderingEngine:l}=s,c=this.createAnnotation(e);this.isDrawing=!0,this.addAnnotation(c,r);const u=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:u,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:o,contourHoleProcessingEnabled:a},this._activateDraw(r),e.preventDefault(),(0,P.triggerAnnotationRenderForViewportIds)(u),c}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData;o&&(0,r.removeAnnotation)(t.annotationUID),super.cancelAnnotation(t);const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,P.triggerAnnotationRenderForViewportIds)(n),this.editData=null,t.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:i,annotationStyle:o}=e,{viewport:a}=t,{worldToCanvas:s}=a,{element:l}=a,c=e.annotation,{annotationUID:u,data:d,highlighted:h}=c,{handles:p}=d,{points:f,activeHandleIndex:m}=p,g=this.editData?.newAnnotation,{lineWidth:v,lineDash:y,color:_,locked:w}=o,E=f.map(e=>s(e)),{drawPreviewEnabled:b}=this.configuration.spline,x=c.data.spline.type,C=this._getSplineConfig(x),I=c.data.spline.instance,S=(0,r.getChildAnnotations)(c);if(-1!==S.findIndex(e=>!e))throw new Error(`Can't find annotation for child ${c.childAnnotationUIDs.join()}`);let D;if([c,...S].filter(e=>this._isSplineROIAnnotation(e)).forEach(e=>{const t=this._updateSplineInstance(l,e).getPolylinePoints();this.updateContourPolyline(e,{points:t,closed:d.contour.closed,targetWindingDirection:en.W.Clockwise},a,{updateWindingDirection:d.contour.closed})}),super.renderAnnotationInstance(e),d.cachedStats[n]&&null!=d.cachedStats[n].areaUnit?c.invalidated&&this._throttledCalculateCachedStats(c,l):(d.cachedStats[n]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(c,l)),w||this.editData||null===m||(D=[E[m]]),D||g||h){const e="0";(0,ge.drawHandles)(i,u,e,E,{color:_,lineWidth:v,handleRadius:"3"})}if(b&&I.numControlPoints>1&&this.editData?.lastCanvasPoint&&!I.closed){const{lastCanvasPoint:e}=this.editData,t=I.getPreviewPolylinePoints(e,10);(0,ge.drawPolyline)(i,u,"previewSplineChange",t,{color:"#9EA0CA",lineDash:y,lineWidth:1})}if(C.showControlPointsConnectors){const e=[...E];I.closed&&e.push(E[0]),(0,ge.drawPolyline)(i,u,"controlPointsConnectors",e,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(c,a,i,o.textbox),this.fireChangeOnUpdate?.annotationUID===u&&(this.triggerChangeEvent(c,t,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),c.invalidated=!1,!0}createInterpolatedSplineControl(e){if(e.data.handles.points?.length)return;const{polyline:t}=e.data.contour;if(!t||!t.length)return;e.data.handles.points=[];const{points:n}=e.data.handles,i=Math.max(10,Math.floor(t.length/20));for(let e=0;e<t.length-i;e+=i)n.push(t[e]);n.push(t[t.length-1])}createAnnotation(e){const t=super.createAnnotation(e),{world:n}=e.detail.currentPoints,{type:r}=this.configuration.spline,o=this._getSplineConfig(r),a=new o.Class,s=()=>({type:o.type,instance:a,resolution:o.resolution});let l;return this.configuration.interpolation?.enabled&&(l=e=>{e.data.spline||=s(),this.createInterpolatedSplineControl(e)}),i.utilities.deepMerge(t,{data:{handles:{points:[[...n]]},spline:s(),cachedStats:{}},onInterpolationComplete:l})}_deleteControlPointByIndex(e,t,n){const o=(0,i.getEnabledElement)(e),{points:a}=t.data.handles;3===a.length?(0,r.removeAnnotation)(t.annotationUID):a.splice(n,1);const{renderingEngine:s}=o,l=(0,Ce.getViewportIdsWithToolToRender)(e,this.getToolName());t.invalidated=!0,(0,P.triggerAnnotationRenderForViewportIds)(l)}_isSplineROIAnnotation(e){return!!e.data?.spline}_getSplineConfig(e){const{configuration:t}=this,n=t.spline.configuration;return Object.assign({type:e},un,n[e])}_updateSplineInstance(e,t){const n=(0,i.getEnabledElement)(e),{viewport:r}=n,{worldToCanvas:o}=r,{data:a}=t,{type:s,instance:l}=t.data.spline,c=this._getSplineConfig(s),u=a.handles.points.map(o),d=void 0!==c.resolution?parseInt(c.resolution):void 0,h=void 0!==c.scale?parseFloat(c.scale):void 0;return l.setControlPoints(u),l.closed=!!a.contour.closed,l.fixedResolution||void 0===d||l.resolution===d||(l.resolution=d,t.invalidated=!0),l instanceof rn&&!l.fixedScale&&void 0!==h&&l.scale!==h&&(l.scale=h,t.invalidated=!0),l}static{this.hydrate=(e,t,n)=>{const o=(0,i.getEnabledElementByViewportId)(e);if(!o)return;if(t.length<3)return void console.warn("Spline requires at least 3 control points");const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:l,viewUp:c}=a.getCamera(),u=new this,d=u.getReferencedImageId(a,t[0],l,c),h=n?.splineType||dn.CatmullRom,p=new(0,u._getSplineConfig(h).Class),f=t.map(e=>a.worldToCanvas(e));p.setControlPoints(f);const m=p.getPolylinePoints().map(e=>a.canvasToWorld(e)),g={annotationUID:n?.annotationUID||i.utilities.uuidv4(),data:{handles:{points:t},label:"",cachedStats:{},spline:{type:h,instance:p},contour:{closed:!0,polyline:m}},highlighted:!1,autoGenerated:!1,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:u.getToolName(),viewPlaneNormal:l,FrameOfReferenceUID:s,referencedImageId:d,...n}};(0,r.addAnnotation)(g,a.element),(0,P.triggerAnnotationRenderForViewportIds)([a.id])}}}function fn(e,t){const n=e.cachedStats[t],{area:r,isEmptyArea:o,areaUnit:a}=n,s=[];if(r){const e=o?"Area: Oblique not supported":`Area: ${i.utilities.roundNumber(r)} ${a}`;s.push(e)}return s}pn.toolName="SplineROI";const mn=pn;class gn extends mn{constructor(e){super(i.utilities.deepMerge({configuration:{calculateStats:!1}},e))}isContourSegmentationTool(){return!0}}gn.toolName="SplineContourSegmentationTool";n(26595),n(37590);var vn=n(98013);class yn{constructor({numBits:e,getPriority:t,areEqual:n}){this._bucketCount=1<<e,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=void 0!==t?t:e=>e,this._areEqual="function"==typeof n?n:(e,t)=>e===t}push(e){const t=this._getBucketIndex(e),n={value:e,next:this._buckets[t]};this._buckets[t]=n,this._size++}pop(){if(0===this._size)throw new Error("Cannot pop because the queue is empty.");for(;null===this._buckets[this._currentBucketIndex];)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const e=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=e.next,this._size--,e.value}remove(e){if(!e)return!1;const t=this._getBucketIndex(e),n=this._buckets[t];let i,r=n;for(;null!==r&&!this._areEqual(e,r.value);)i=r,r=r.next;return null!==r&&(r===n?this._buckets[t]=r.next:i.next=r.next,this._size--,!0)}isEmpty(){return 0===this._size}_getBucketIndex(e){return this._getPriority(e)&this._mask}_buildArray(e){const t=new Array(e);return t.fill(null),t}}const{isEqual:_n}=i.utilities,wn=4294967295,En=2/(3*Math.PI);class bn{constructor(e,t,n){this._getPointIndex=(e,t)=>{const{width:n}=this;return e*n+t},this._getPointCoordinate=e=>[e%this.width,Math.floor(e/this.width)],this._getPointCost=e=>Math.round(this.searchGranularity*this.costs[e]);const i=e.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=t,this.height=n,this.grayscalePixelData=e,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(i),this.parents=new Uint32Array(i),this.costs=new Float32Array(i)}startSearch(e){const t=this._getPointIndex(e[1],e[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(wn),this.costs.fill(1/0),this.priorityQueueNew=new yn({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=e,this.costs[t]=0,this.priorityQueueNew.push(t)}findMinNearby(e,t=2){const[n,i]=e,{costs:r}=this,o=[Math.max(0,n-t),Math.min(n+t+1,this.width)],a=[Math.max(0,i-t),Math.min(i+t+1,this.height)];let s=.8*r[this._getPointIndex(i,n)],l=e;for(let n=o[0];n<o[1];n++)for(let i=a[0];i<a[1];i++){const o=1-(Math.abs(n-e[0])+Math.abs(i-e[1]))/t/2,a=.8*r[this._getPointIndex(i,n)]+.2*o;a<s&&(l=[n,i],s=a)}return l}findPathToPoint(e){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:t,_getPointIndex:n,_getPointCoordinate:i}=this,r=n(t[1],t[0]),o=n(e[1],e[0]),{visited:a,parents:s,costs:l,priorityQueueNew:c}=this;if(o===r)return[];for(;!c.isEmpty()&&s[o]===wn;){const e=c.pop();if(a[e])continue;const t=i(e),r=this._getNeighborPoints(t);a[e]=!0;for(let i=0,o=r.length;i<o;i++){const o=r[i],a=n(o[1],o[0]),u=this._getWeightedDistance(t,o),d=l[e]+u;d<l[a]&&(l[a]!==1/0&&c.remove(a),l[a]=d,s[a]=e,c.push(a))}}const u=[];let d=o;for(;d!==wn;)u.push(i(d)),d=s[d];return u.reverse()}_getDeltaX(e,t){const{grayscalePixelData:n,width:i}=this;let r=this._getPointIndex(t,e);return e+1===i&&r--,n[r+1]-n[r]}_getDeltaY(e,t){const{grayscalePixelData:n,width:i,height:r}=this;let o=this._getPointIndex(t,e);return t+1===r&&(o-=i),n[o]-n[o+i]}_getGradientMagnitude(e,t){const n=this._getDeltaX(e,t),i=this._getDeltaY(e,t);return Math.sqrt(n*n+i*i)}_getLaplace(e,t){const{grayscalePixelData:n,_getPointIndex:i}=this;let r=n[i(t-2,e)];return r+=n[i(t-1,e-1)]+2*n[i(t-1,e)]+n[i(t-1,e+1)],r+=n[i(t,e-2)]+2*n[i(t,e-1)]-16*n[i(t,e)]+2*n[i(t,e+1)]+n[i(t,e+2)],r+=n[i(t+1,e-1)]+2*n[i(t+1,e)]+n[i(t+1,e+1)],r+=n[i(t+2,e)],r}_computeGradient(){const{width:e,height:t}=this,n=new Float32Array(e*t);let i=0,r=0,o=0,a=0;for(a=0;a<t-1;a++){for(o=0;o<e-1;o++)n[i]=this._getGradientMagnitude(o,a),r=Math.max(n[i],r),i++;n[i]=n[i-1],i++}for(let t=n.length;i<t;i++)n[i]=n[i-e];for(let e=0,t=n.length;e<t;e++)n[e]=1-n[e]/r;return n}_computeLaplace(){const{width:e,height:t,_getPointIndex:n}=this,i=new Float32Array(e*t);i.fill(1,0,n(2,0));for(let r=2;r<t-2;r++){i[n(r,0)]=1,i[n(r,1)]=1;for(let t=2;t<e-2;t++)i[n(r,t)]=this._getLaplace(t,r)>.33?0:1;i[n(r,e-2)]=1,i[n(r,e-1)]=1}return i.fill(1,n(t-2,0)),i}_computeGradientX(){const{width:e,height:t}=this,n=new Float32Array(e*t);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)n[i++]=this._getDeltaX(t,r);return n}_computeGradientY(){const{width:e,height:t}=this,n=new Float32Array(e*t);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)n[i++]=this._getDeltaY(t,r);return n}_getGradientUnitVector(e,t){const{gradXNew:n,gradYNew:i,_getPointIndex:r}=this,o=n[r(t,e)],a=i[r(t,e)];let s=Math.sqrt(o*o+a*a);return s=Math.max(s,1e-100),[o/s,a/s]}_getGradientDirection(e,t,n,i){const r=this._getGradientUnitVector(e,t),o=this._getGradientUnitVector(n,i);let a=r[1]*(n-e)-r[0]*(i-t),s=o[1]*(n-e)-o[0]*(i-t);a<0&&(a=-a,s=-s),e!==n&&t!==i&&(a*=Math.SQRT1_2,s*=Math.SQRT1_2),s=Math.min(Math.max(s,-1),1);const l=En*(Math.acos(Math.min(a,1))+Math.acos(s));return isNaN(l)||!isFinite(l)?(console.warn("Found non-direction:",e,t,n,i,a,s,l),1):l}getCost(e,t){return this._getWeightedDistance(e,t)}_getWeightedDistance(e,t){const{_getPointIndex:n,width:i,height:r}=this,[o,a]=e,[s,l]=t;if(s<0||s>=i||l<0||l>=r)return 1;if(o<0||a<0||o>=i||a>=r)return 0;const c=n(l,s);let u=this.gradMagnitude[c];o!==s&&a!==l||(u*=Math.SQRT1_2);return.43*u+.43*this.laplace[c]+.11*this._getGradientDirection(o,a,s,l)}_getNeighborPoints(e){const{width:t,height:n}=this,i=[],r=Math.max(e[0]-1,0),o=Math.max(e[1]-1,0),a=Math.min(e[0]+1,t-1),s=Math.min(e[1]+1,n-1);for(let t=o;t<=s;t++)for(let n=r;n<=a;n++)n===e[0]&&t===e[1]||i.push([n,t]);return i}static createInstanceFromRawPixelData(e,t,n,i){const r=e.length,o=new Float32Array(r),{lower:a,upper:s}=i,l=s-a;for(let t=0,n=e.length;t<n;t++)o[t]=Math.max(0,Math.min(1,(e[t]-a)/l));return new bn(o,t,n)}}class xn{constructor(e,t){this.pointArray=e?e.slice():[],this._controlPointIndexes=t?t.slice():[]}getPoint(e){return this.pointArray[e]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(e){const t=this.pointArray.indexOf(e);if(-1!==t)return-1!==this._controlPointIndexes.indexOf(t);throw new Error("Error: isControlPoint called with not in list point.")}addPoint(e){this.pointArray.push(e)}addControlPoint(e){const t=this.pointArray.indexOf(e);if(-1===t)throw new Error("Cannot mark a non registered point as control point.");this._controlPointIndexes.push(t)}getControlPoints(){return this._controlPointIndexes.map(e=>this.pointArray[e])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(e){this.pointArray.splice(this.pointArray.length-e,e)}addPoints(e){this.pointArray=this.pointArray.concat(e)}prependPath(e){const t=e.pointArray.length,n=[];this.pointArray=e.pointArray.concat(this.pointArray);for(let e=0;e<this._controlPointIndexes.length;++e)n[e]=this._controlPointIndexes[e]+t;this._controlPointIndexes=e._controlPointIndexes.concat(n)}appendPath(e){this.addPoints(e.pointArray),e._controlPointIndexes.forEach(e=>this._controlPointIndexes.push(e))}}class Cn extends cn.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextLines:Sn,calculateStats:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:o.KeyboardBindings.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{undo:{method:"undo",bindings:[{key:"Escape"}]}}}}){super(e,t),this.isHandleOutsideImage=!1,this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,s=r*r,l=t.data.contour.polyline.map(e=>a.worldToCanvas(e));let c=l[l.length-1];for(let e=0;e<l.length;e++){const t=l[e];if(vt.lineSegment.distanceToPointSquared(c,t,n)<=s)return!0;c=t}return!1},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1};const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;this._activateModify(r),(0,O.A)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex(e=>e===n)}const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,O.A)(c),e.preventDefault()},this._endCallback=(e,t=!1)=>{const n=e.detail,{element:a}=n,{annotation:s,viewportIdsToRender:l,newAnnotation:c,contourHoleProcessingEnabled:u}=this.editData,{data:d}=s;d.handles.activeHandleIndex=null,this._deactivateModify(a),this._deactivateDraw(a),(0,Ie.resetElementCursor)(a);const h=(0,i.getEnabledElement)(a);if(this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage||t)return(0,r.removeAnnotation)(s.annotationUID),this.clearEditData(),void(0,O.A)(l);(0,O.A)(l);const p=c?o.ChangeTypes.Completed:o.ChangeTypes.HandlesUpdated;this.triggerChangeEvent(s,h,p,u),this.clearEditData()},this.triggerChangeEvent=(e,t,n=o.ChangeTypes.StatsUpdated,i=!1)=>{n===o.ChangeTypes.Completed?(0,xe.PS)(e,i):(0,xe.XF)(e,t.viewport.element,n)},this._mouseDownCallback=e=>{const t=e.type===o.Events.MOUSE_DOUBLE_CLICK,{annotation:n,viewportIdsToRender:r,worldToSlice:a,sliceToWorld:s}=this.editData;if(this.editData.closed)return;const l=e.detail,{element:c}=l,{currentPoints:u}=l,{canvas:d,world:h}=u;let p=h;const f=(0,i.getEnabledElement)(c),{viewport:m,renderingEngine:g}=f,v=this.editData.currentPath.getControlPoints();let y=v.length>=2&&t;if(v.length>=2){const e={index:-1,distSquared:1/0};for(let t=0,n=v.length;t<n;t++){const n=s(v[t]),i=m.worldToCanvas(n),r=vt.point.distanceToPointSquared(d,i);r<=100&&r<e.distSquared&&(e.distSquared=r,e.index=t)}0===e.index&&(y=!0)}const{snapHandleNearby:_}=this.configuration;if(_&&!this.editData.closed){const e=new xn,t=this.scissors.findMinNearby(a(h),1),n=this.scissors.findPathToPoint(t);e.addPoints(n),e.prependPath(this.editData.confirmedPath),p=s(t),this.editData.currentPath=e}this.editData.closed=this.editData.closed||y,this.editData.confirmedPath=this.editData.currentPath;const w=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(w),n.data.handles.points.push(s(w)),this.scissors.startSearch(a(p)),n.invalidated=!0,(0,O.A)(r),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(e)),e.preventDefault()},this._mouseMoveCallback=e=>{const{element:t,currentPoints:n}=e.detail,{world:r,canvas:o}=n,{renderingEngine:a}=(0,i.getEnabledElement)(t),s=(0,Ce.getViewportIdsWithToolToRender)(t,this.getToolName());this.editData.lastCanvasPoint=o;const{width:l,height:c}=this.scissors,{worldToSlice:u}=this.editData,d=u(r);if(d[0]<0||d[1]<0||d[0]>=l||d[1]>=c)return;const h=this.scissors.findPathToPoint(d),p=new xn;p.addPoints(h),p.prependPath(this.editData.confirmedPath),this.editData.currentPath=p,(0,O.A)(s),e.preventDefault()},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a)console.warn("Drag annotation not implemented");else{const{currentPoints:e}=t,i=e.world;this.editHandle(i,n,r,a)}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData;o&&(0,r.removeAnnotation)(t.annotationUID);const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,O.A)(n),this.editData=null,this.scissors=null,t.annotationUID},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_MOVE,this._mouseMoveCallback),e.addEventListener(o.Events.MOUSE_DOWN,this._mouseDownCallback),e.addEventListener(o.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.addEventListener(o.Events.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_MOVE,this._mouseMoveCallback),e.removeEventListener(o.Events.MOUSE_DOWN,this._mouseDownCallback),e.removeEventListener(o.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._mouseDownCallback)},this._calculateCachedStats=(e,t)=>{if(!this.configuration.calculateStats)return;const n=e.data;if(!n.contour.closed)return;const r=(0,i.getEnabledElement)(t),{viewport:a,renderingEngine:s}=r,{cachedStats:l}=n,{polyline:c}=n.contour,u=Object.keys(l);for(let e=0;e<u.length;e++){const t=u[e],n=this.getTargetImageData(t);if(!n)continue;const{metadata:r}=n,o=c.map(e=>a.worldToCanvas(e)),s=o[0],d=a.canvasToWorld(s),h=a.canvasToWorld([s[0]+1,s[1]]),p=a.canvasToWorld([s[0],s[1]+1]),f=he.eR.distance(d,h),m=he.eR.distance(d,p),{imageData:g}=n,{scale:v,areaUnit:y}=(0,P.getCalibratedLengthUnitsAndScale)(n,()=>{const{maxX:e,maxY:t,minX:n,minY:r}=vt.polyline.getAABB(o),s=a.canvasToWorld([n,r]),l=i.utilities.transformWorldToIndex(g,s),c=a.canvasToWorld([e,t]);return[l,i.utilities.transformWorldToIndex(g,c)]});let _=vt.polyline.getArea(o)/v/v;_*=f*m,l[t]={Modality:r.Modality,area:_,areaUnit:y}}return this.triggerAnnotationModified(e,r,o.ChangeTypes.StatsUpdated),l},this._renderStats=(e,t,n,i)=>{const r=e.data,o=this.getTargetId(t);if(!r.contour.closed||!i.visibility)return;const a=this.configuration.getTextLines(r,o);if(!a||0===a.length)return;const s=r.handles.points.map(e=>t.worldToCanvas(e));if(!r.handles.textBox.hasMoved){const e=(0,At.getTextBoxCoordsCanvas)(s);r.handles.textBox.worldPosition=t.canvasToWorld(e)}const l=t.worldToCanvas(r.handles.textBox.worldPosition),c=(0,ge.drawLinkedTextBox)(n,e.annotationUID??"","textBox",a,l,s,{},i),{x:u,y:d,width:h,height:p}=c;r.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([u,d]),topRight:t.canvasToWorld([u+h,d]),bottomLeft:t.canvasToWorld([u,d+p]),bottomRight:t.canvasToWorld([u+h,d+p])}},this.triggerAnnotationModified=(e,t,n=o.ChangeTypes.StatsUpdated)=>{const{viewportId:r,renderingEngineId:a}=t,s=o.Events.ANNOTATION_MODIFIED,l={annotation:e,viewportId:r,renderingEngineId:a,changeType:n};(0,i.triggerEvent)(i.eventTarget,s,l)},this._throttledCalculateCachedStats=(0,P.throttle)(this._calculateCachedStats,100,{trailing:!0})}setupBaseEditData(e,t,n,r,o){const a=(0,i.getEnabledElement)(t),{viewport:s}=a;this.isDrawing=!0;const l=s.getImageData(),{imageData:c}=l;let u,d,h,p,f;if(s instanceof i.VolumeViewport){if(!(s instanceof i.VolumeViewport))throw new Error("Viewport not supported");{const e=i.utilities.getCurrentVolumeViewportSlice(s),{sliceToIndexMatrix:t,indexToSliceMatrix:n}=e;u=e=>{const t=i.utilities.transformWorldToIndex(c,e),r=he.eR.transformMat4([0,0,0],t,n);return[r[0],r[1]]},d=e=>{const n=he.eR.transformMat4([0,0,0],[e[0],e[1],0],t);return i.utilities.transformIndexToWorld(c,n)},f=e.scalarData,h=e.width,p=e.height}}else h=l.dimensions[0],p=l.dimensions[1],u=e=>{const t=i.utilities.transformWorldToIndex(c,e);return[t[0],t[1]]},d=e=>i.utilities.transformIndexToWorld(c,[e[0],e[1],0]),f=l.scalarData;f=i.utilities.convertToGrayscale(f,h,p);const{voiRange:m}=s.getProperties(),g=u(e);this.scissors=bn.createInstanceFromRawPixelData(f,h,p,m),r&&(this.scissorsNext=bn.createInstanceFromRawPixelData(f,h,p,m),this.scissorsNext.startSearch(u(r))),this.scissors.startSearch(g);const v=!r,y=new xn,_=new xn,w=v?void 0:new xn;y.addPoint(g),y.addControlPoint(g);const E=(0,Ce.getViewportIdsWithToolToRender)(t,this.getToolName()),b=s.worldToCanvas(e);this.editData={annotation:n,viewportIdsToRender:E,newAnnotation:v,hasMoved:!1,lastCanvasPoint:b,confirmedPath:y,currentPath:_,confirmedPathNext:w,closed:!1,handleIndex:this.editData?.handleIndex??n.handles?.activeHandleIndex,worldToSlice:u,sliceToWorld:d,contourHoleProcessingEnabled:o}}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:i}=t,{world:r}=n,o=this.createAnnotation(e),a=(0,W.A)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(r,i,o,void 0,a),this.addAnnotation(o,i),this._activateDraw(i),e.preventDefault(),(0,O.A)(this.editData.viewportIdsToRender),o}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(e,t,n,i){const{data:r}=n,{points:o}=r.handles,{length:a}=o,s=o[(i-1+a)%a],l=o[(i+1)%a];if(!this.editData?.confirmedPathNext){this.setupBaseEditData(s,t,n,l);const{polyline:e}=r.contour,o=new xn,a=new xn,{worldToSlice:c}=this.editData,u=(0,vn.A)(n,i-1),d=(0,vn.A)(n,i+1);if(-1===d||-1===u)throw new Error(`Can't find handle index ${-1===d&&l} ${-1===u&&s}`);0===i?a.addPoints(e.slice(d+1,u).map(c)):(o.addPoints(e.slice(0,u+1).map(c)),a.addPoints(e.slice(d,e.length).map(c))),this.editData.confirmedPath=o,this.editData.confirmedPathNext=a}const{editData:c,scissors:u}=this,{worldToSlice:d,sliceToWorld:h}=c,{activeHandleIndex:p}=r.handles;if(null==p)r.handles.activeHandleIndex=i;else if(p!==i)throw new Error(`Trying to edit a different handle than the one currently being edited ${i}!==${r.handles.activeHandleIndex}`);const f=d(e);if(f[0]<0||f[0]>=u.width||f[1]<0||f[1]>=u.height)return;o[i]=h(f);const m=u.findPathToPoint(f),g=this.scissorsNext.findPathToPoint(f),v=new xn;v.prependPath(c.confirmedPath),0!==i&&v.addPoints(m),v.addPoints(g.reverse()),v.appendPath(c.confirmedPathNext),0===i&&v.addPoints(m),c.currentPath=v,n.invalidated=!0,c.hasMoved=!0,c.closed=!0}renderAnnotation(e,t){return this.updateAnnotation(this.editData?.currentPath),super.renderAnnotation(e,t)}isContourSegmentationTool(){return!1}createAnnotation(e){const t=super.createAnnotation(e),{world:n}=e.detail.currentPoints;return i.utilities.deepMerge(t,{data:{handles:{points:[[...n]]}}})}undo(e,t,n){this.editData&&this._endCallback(n,!0)}renderAnnotationInstance(e){const{annotation:t,enabledElement:n,svgDrawingHelper:i,annotationStyle:r,targetId:o}=e,{viewport:a}=n,{element:s}=a,{worldToCanvas:l}=a,{annotationUID:c,data:u,highlighted:d}=t,{handles:h}=u,p=this.editData?.newAnnotation,{lineWidth:f,lineDash:m,color:g}=r;if(d||p&&t.annotationUID===this.editData?.annotation?.annotationUID){const e="0",t=h.points.map(l);(0,ge.drawHandles)(i,c,e,t,{color:g,lineDash:m,lineWidth:f})}return super.renderAnnotationInstance(e),u.cachedStats[o]&&null!=u.cachedStats[o].areaUnit?t.invalidated&&this._throttledCalculateCachedStats(t,s):(u.cachedStats[o]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(t,s)),this._renderStats(t,a,i,r.textbox),!0}updateAnnotation(e){if(!this.editData||!e)return;const{annotation:t,sliceToWorld:n,worldToSlice:i,closed:r,newAnnotation:o}=this.editData;let{pointArray:a}=e;a.length>1&&(a=[...a,a[0]]);const s=o&&r?en.W.Clockwise:void 0;this.updateContourPolyline(t,{points:a,closed:r,targetWindingDirection:s},{canvasToWorld:n,worldToCanvas:i})}}Cn.toolName="LivewireContour";const In=Cn;function Sn(e,t){const n=e.cachedStats[t],{area:r,areaUnit:o}=n,a=[];if(r){const e=`Area: ${i.utilities.roundNumber(r)} ${o}`;a.push(e)}return a}class Dn extends In{updateInterpolatedAnnotation(e,t){!this.editData&&e.invalidated&&e.data.handles.interpolationSources&&(e.data.contour.originalPolyline=e.data.contour.polyline,queueMicrotask(()=>{if(!e.data.handles.interpolationSources)return;const{points:n}=e.data.handles,{element:r}=t.viewport;this.setupBaseEditData(n[0],r,e);const{length:a}=n,{scissors:s}=this,{nearestEdge:l,repeatInterpolation:c}=this.configuration.interpolation;e.data.handles.originalPoints=n;const{worldToSlice:u,sliceToWorld:d}=this.editData,h=[];if(l){let e=u(n[n.length-1]);n.forEach((t,r)=>{const o=u(t);e=o,h.push(o),s.startSearch(e),s.findPathToPoint(o),s.findPathToPoint(u(n[(r+3)%n.length]));const a=s.findMinNearby(o,l);i.utilities.isEqual(o,a)||(h[r]=a,e=a,n[r]=d(a))})}const p=new xn;for(let e=0;e<a;e++){s.startSearch(u(n[e]));const t=s.findPathToPoint(u(n[(e+1)%a]));p.addPoints(t)}this.updateAnnotation(p),this.scissors=null,this.scissorsNext=null,this.editData=null,e.data.handles.interpolationSources=null,c&&(0,xe.XF)(e,t.viewport.element,o.ChangeTypes.InterpolationUpdated)}))}renderAnnotationInstance(e){const{enabledElement:t,svgDrawingHelper:n}=e,i=e.annotation,{annotationUID:r}=i,{viewport:o}=t,{worldToCanvas:a}=o,{showInterpolationPolyline:s}=this.configuration.interpolation||{};this.updateInterpolatedAnnotation?.(i,t);const{originalPolyline:l}=i.data.contour,c=super.renderAnnotationInstance(e);if(s&&l&&i.autoGenerated){const e=l.map(a);e.push(e[0]),(0,ge.drawPolyline)(n,r,"interpolationContour-0",e,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return c}isContourSegmentationTool(){return!0}}Dn.toolName="LivewireContourSegmentationTool";var An;!function(e){e.POINTS="points",e.MOVABLE_POINTS="movable",e.DENTASCAN="dentascan"}(An||(An={}));class Tn extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:Nn,changeTextCallback:On,preventHandleOutsideImage:!1,arrowFirst:!1}}){super(e,t),this.removeArrowAnnotation=e=>{(0,r.removeAnnotation)(e)},this.addNewAnnotationWithMode=(e,t,n,o,a)=>{const s=(0,i.getEnabledElement)(e),{viewport:l,renderingEngine:c}=s;(0,Ie.hideElementCursor)(e),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,t[0],d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{dentascan:n===An.DENTASCAN,handmade:n===An.MOVABLE_POINTS,color:o,toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p},data:{text:"",handles:{points:t,activeHandleIndex:null,arrowFirst:!1,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""},annotationUID:i.utilities.uuidv4()},g=a??n!==An.MOVABLE_POINTS,v=n!==An.MOVABLE_POINTS;(0,V.setAnnotationVisibility)(m.annotationUID,g),(0,B.setAnnotationLocked)(m.annotationUID,v),(0,r.addAnnotation)(m,e);const y=(0,Ce.getViewportIdsWithToolToRender)(e,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:y,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,creation:!0},this._activateDraw(e),(0,O.A)(y),m.data.handles.activeHandleIndex=null,this._deactivateModify(e),this._deactivateDraw(e),(0,Ie.resetElementCursor)(e),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(m.annotationUID),m.data.text="",(0,xe.dZ)(m),(0,O.A)(y),this.editData=null,this.isDrawing=!1,m},this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;(0,Ie.hideElementCursor)(o),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),{arrowFirst:f}=this.configuration,m=l.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{dentascan:!1,handmade:!0,color:"rgb(0, 255, 0)",toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:m,referencedImageId:p,...l.getViewReference({points:[a]})},data:{text:"",handles:{points:[[...a],[...a]],activeHandleIndex:null,arrowFirst:f,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};(0,r.addAnnotation)(g,o);const v=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,creation:!0},this._activateDraw(o),e.preventDefault(),(0,O.A)(v),g},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,[l,c]=s.handles.points,u=a.worldToCanvas(l),d=a.worldToCanvas(c),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}};return Le.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,Ie.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this._manageClickCallback=e=>{const t=e.detail,{mouseButton:n}=t;this.editData.creation?this.editData.creation=!1:1===n?this._prolongateCallback(e):2===n&&this._endCallback(e)},this._endCallback=e=>{const t=e.detail,{element:n,currentPoints:i,mouseButton:o}=t,{annotation:a,viewportIdsToRender:s,newAnnotation:l,hasMoved:c}=this.editData,{data:u}=a;l&&!c||(u.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(a.annotationUID),l?(a.data.text="",(0,xe.dZ)(a),(0,O.A)(s)):(0,xe.XF)(a,n),this.editData=null,this.isDrawing=!1)},this._prolongateCallback=e=>{const t=e.detail,{currentPoints:n}=t,i=n.world,{annotation:r,viewportIdsToRender:o,handleIndex:a}=this.editData,{data:s}=r;s.handles.points[a]=[...i],s.handles.points.push([...i]),this.editData.handleIndex+=1,e.preventDefault(),(0,O.A)(o)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this.touchTapCallback=e=>{2==e.detail.taps&&this.doubleClickCallback(e)},this.doubleClickCallback=e=>{const t=e.detail,{element:n}=t;let i=(0,r.getAnnotations)(this.getToolName(),n);if(i=this.filterInteractableAnnotationsForElement(n,i),!i?.length)return;const o=i.find(e=>this.isPointNearTool(n,e,t.currentPoints.canvas,6));if(!o)return;const a=o;this.configuration.changeTextCallback(o,e.detail,this._doneChangingTextCallback.bind(this,n,a)),this.editData=null,this.isDrawing=!1,e.stopImmediatePropagation(),e.preventDefault()},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._manageClickCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._manageClickCallback),e.addEventListener(o.Events.TOUCH_TAP,this._manageClickCallback),e.addEventListener(o.Events.TOUCH_END,this._manageClickCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._manageClickCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._manageClickCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._manageClickCallback),e.removeEventListener(o.Events.TOUCH_END,this._manageClickCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(!a?.length)return n;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const r=a[e],{annotationUID:o,data:l}=r,{handles:c,text:u}=l,{points:d,activeHandleIndex:h}=c;s.annotationUID=o;const{lineWidth:p,lineDash:f}=this.getAnnotationStyle({annotation:r,styleSpecifier:s}),m=r.metadata.color??"rgb(255, 255, 255)",g=d.map(e=>i.worldToCanvas(e));let v;if(!(0,V.isAnnotationVisible)(o))continue;(0,B.isAnnotationLocked)(o)||this.editData||null===h||(v=[g[h]]);const y="0";r.metadata.handmade&&(0,ge.drawHandles)(t,o,y,g,{color:m,lineWidth:p});let _=1;for(let e=0;e<g.length-1;e++)(0,ge.drawLine)(t,o,`${_}`,g[e],g[e+1],{color:m,width:p,lineDash:f}),_+=3;if(n=!0,!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!u)continue;const w=this.getLinkedTextBoxStyle(s,r);if(!w.visibility){l.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!l.handles.textBox.hasMoved){const e=g[1];l.handles.textBox.worldPosition=i.canvasToWorld(e)}const E=i.worldToCanvas(l.handles.textBox.worldPosition),b="1",x=(0,ge.drawLinkedTextBox)(t,o,b,[u],E,g,{},w),{x:C,y:I,width:S,height:D}=x;l.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([C,I]),topRight:i.canvasToWorld([C+S,I]),bottomLeft:i.canvasToWorld([C,I+D]),bottomRight:i.canvasToWorld([C+S,I+D])}}return n}}handleSelectedCallback(e,t,n){const i=e.detail,{element:r}=i,{data:o}=t;t.highlighted=!0;let a,s=!1;n.worldPosition?s=!0:a=o.handles.points.findIndex(e=>e===n);const l=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:a,movingTextBox:s},this._activateModify(r),(0,Ie.hideElementCursor)(r),(0,O.A)(l),e.preventDefault()}_doneChangingTextCallback(e,t,n){t.data.text=n;(0,i.getEnabledElement)(e);const r=(0,Ce.getViewportIdsWithToolToRender)(e,this.getToolName());(0,O.A)(r),(0,xe.XF)(t,e)}_isInsideVolume(e,t,n){return i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n)}}function Nn(e){return e(prompt("Enter your annotation:"))}function On(e,t,n){return n(prompt("Enter your annotation:"))}Tn.toolName="ArrowAnnotate";class Pn extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Mn}}){super(e,t),this.addNewAnnotation=e=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;(0,Ie.hideElementCursor)(o),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p,...l.getViewReference({points:[a]})},data:{handles:{points:[[...a],[...a]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,r.addAnnotation)(m,o);const g=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,O.A)(g),m},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,[l,c,u]=s.handles.points,d=a.worldToCanvas(l),h=a.worldToCanvas(c),p={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};if(Le.distanceToPoint([p.start.x,p.start.y],[p.end.x,p.end.y],[n[0],n[1]])<=r)return!0;if(!u)return!1;const f=a.worldToCanvas(u),m={start:{x:h[0],y:h[1]},end:{x:f[0],y:f[1]}};return Le.distanceToPoint([m.start.x,m.start.y],[m.end.x,m.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,Ie.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,O.A)(o),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;if(this.angleStartedNotYetCompleted&&2===c.handles.points.length)return void(this.editData.handleIndex=2);this.angleStartedNotYetCompleted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,this.angleStartedNotYetCompleted=!1,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(i),l=i.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const o=a[r],{annotationUID:u,data:d}=o,{points:h,activeHandleIndex:p}=d.handles;c.annotationUID=u;const{color:f,lineWidth:m,lineDash:g}=this.getAnnotationStyle({annotation:o,styleSpecifier:c}),v=h.map(e=>i.worldToCanvas(e));let y;if(d.cachedStats[s]&&null!=d.cachedStats[s].angle?o.invalidated&&this._throttledCalculateCachedStats(o,l,e):(d.cachedStats[s]={angle:null},this._calculateCachedStats(o,l,e)),(0,B.isAnnotationLocked)(o.annotationUID)||this.editData||null===p||(y=[v[p]]),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(y){const e="0";(0,ge.drawHandles)(t,u,e,v,{color:f,lineDash:g,lineWidth:m})}let _="1";if((0,ge.drawLine)(t,u,_,v[0],v[1],{color:f,width:m,lineDash:g}),n=!0,3!==v.length)return n;if(_="2",(0,ge.drawLine)(t,u,_,v[1],v[2],{color:f,width:m,lineDash:g}),!d.cachedStats[s]?.angle)continue;const w=this.getLinkedTextBoxStyle(c,o);if(!w.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const E=this.configuration.getTextLines(d,s);if(!d.handles.textBox.hasMoved){const e=v[1];d.handles.textBox.worldPosition=i.canvasToWorld(e)}const b=i.worldToCanvas(d.handles.textBox.worldPosition),x="1",C=(0,ge.drawLinkedTextBox)(t,u,x,E,b,v,{},w),{x:I,y:S,width:D,height:A}=C;d.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([I,S]),topRight:i.canvasToWorld([I+D,S]),bottomLeft:i.canvasToWorld([I,S+A]),bottomRight:i.canvasToWorld([I+D,S+A])}}return n},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,Ie.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,O.A)(c),e.preventDefault()}_calculateCachedStats(e,t,n){const r=e.data,{element:o}=n.viewport;if(3!==r.handles.points.length)return;const a=r.handles.points[0],s=r.handles.points[1],l=r.handles.points[2],{cachedStats:c}=r,u=Object.keys(c);for(let e=0;e<u.length;e++){const t=u[e],n=Te([a,s],[s,l]),{dimensions:r,imageData:o}=this.getTargetImageData(t);this.isHandleOutsideImage=[a,s,l].map(e=>i.utilities.transformWorldToIndex(o,e)).some(e=>!i.utilities.indexWithinDimensions(e,r)),c[t]={angle:isNaN(n)?"Incomplete Angle":n}}return e.invalidated=!1,(0,xe.XF)(e,o),c}}function Mn(e,t){const n=e.cachedStats[t],{angle:r}=n;if(void 0===r)return;if(isNaN(r))return[`${r}`];return[`${i.utilities.roundNumber(r)} ${String.fromCharCode(176)}`]}Pn.toolName="Angle";const kn=(...e)=>{const t=2===e[0].length?[0,0]:[0,0,0],n=e.length;for(const i of e)t[0]+=i[0]/n,t[1]+=i[1]/n,3===t.length&&(t[2]+=i[2]/n);return t},Rn=kn;class Ln extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Fn,showArcLines:!1}}){super(e,t),this.addNewAnnotation=e=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;(0,Ie.hideElementCursor)(o),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p,...l.getViewReference({points:[a]})},data:{handles:{points:[[...a],[...a]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,r.addAnnotation)(m,o);const g=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,O.A)(g),m},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{distanceToPoint:l,distanceToPoint2:c}=this.distanceToLines({viewport:a,points:s.handles.points,canvasCoords:n,proximity:r});return l<=r||c<=r},this.toolSelectedCallback=(e,t,n,r,o=6)=>{const a=e.detail,{element:s}=a;t.highlighted=!0;const l=(0,Ce.getViewportIdsWithToolToRender)(s,this.getToolName()),c=(0,i.getEnabledElement)(s),{renderingEngine:u,viewport:d}=c,{isNearFirstLine:h,isNearSecondLine:p}=this.distanceToLines({viewport:d,points:t.data.handles.points,canvasCoords:r,proximity:o});this.editData={annotation:t,viewportIdsToRender:l,movingTextBox:!1,isNearFirstLine:h,isNearSecondLine:p},this._activateModify(s),(0,Ie.hideElementCursor)(s),(0,O.A)(l),e.preventDefault()},this._mouseUpCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;if(this.angleStartedNotYetCompleted&&c.handles.points.length<4)return(0,Ie.resetElementCursor)(n),void(this.editData.handleIndex=c.handles.points.length);this.angleStartedNotYetCompleted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o),this.editData=null,this.isDrawing=!1},this._mouseDownCallback=e=>{const{annotation:t,handleIndex:n}=this.editData,i=e.detail,{element:r,currentPoints:o}=i,a=o.world,{data:s}=t;return 1===n?(s.handles.points[1]=a,void(this.editData.hasMoved=s.handles.points[1][0]!==s.handles.points[0][0]||s.handles.points[1][1]!==s.handles.points[0][0])):3===n?(s.handles.points[3]=a,this.editData.hasMoved=s.handles.points[3][0]!==s.handles.points[2][0]||s.handles.points[3][1]!==s.handles.points[2][0],void(this.angleStartedNotYetCompleted=!1)):(this.editData.hasMoved=!1,(0,Ie.hideElementCursor)(r),s.handles.points[2]=s.handles.points[3]=a,void(this.editData.handleIndex=s.handles.points.length-1))},this._mouseDragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s,isNearFirstLine:l,isNearSecondLine:c}=this.editData,{data:u}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=u.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a&&(l||c)){const{deltaPoints:e}=t,n=e.world,i=u.handles.points;if(l){[i[0],i[1]].forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})}else if(c){[i[2],i[3]].forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})}r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;u.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const d=(0,i.getEnabledElement)(n),{renderingEngine:h}=d;(0,O.A)(o)},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:a}=t;a.handles.points.length<4&&(0,r.removeAnnotation)(t.annotationUID),t.highlighted=!1,a.handles.activeHandleIndex=null;const s=(0,i.getEnabledElement)(e),{renderingEngine:l}=s;return(0,O.A)(n),o&&(0,xe.dZ)(t),this.editData=null,this.angleStartedNotYetCompleted=!1,t.annotationUID},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(o.Events.MOUSE_DOWN,this._mouseDownCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(o.Events.MOUSE_DOWN,this._mouseDownCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(i),l=i.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const o=a[r],{annotationUID:u,data:d}=o,{points:h,activeHandleIndex:p}=d.handles;c.annotationUID=u;const{color:f,lineWidth:m,lineDash:g}=this.getAnnotationStyle({annotation:o,styleSpecifier:c}),v=h.map(e=>i.worldToCanvas(e));let y;if(d.cachedStats[s]&&null!=d.cachedStats[s].angle?o.invalidated&&this._throttledCalculateCachedStats(o,l,e):(d.cachedStats[s]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(o,l,e)),(0,B.isAnnotationLocked)(u)||this.editData||null===p||(y=[v[p]]),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(y){const e="0";(0,ge.drawHandles)(t,u,e,v,{color:f,lineDash:g,lineWidth:m})}const _=[v[0],v[1]],w=[v[2],v[3]];let E="line1";if((0,ge.drawLine)(t,u,E,_[0],_[1],{color:f,width:m,lineDash:g}),n=!0,v.length<4)return n;E="line2",(0,ge.drawLine)(t,u,E,w[0],w[1],{color:f,width:m,lineDash:g}),E="linkLine";const b=Rn(_[0],_[1]),x=Rn(w[0],w[1]);(0,ge.drawLine)(t,u,E,b,x,{color:f,lineWidth:"1",lineDash:"1,4"});const{arc1Start:C,arc1End:I,arc2End:S,arc2Start:D}=d.cachedStats[s].points.canvas,{arc1Angle:A,arc2Angle:T}=d.cachedStats[s];if(this.configuration.showArcLines&&(E="arc1",(0,ge.drawLine)(t,u,E,C,I,{color:f,lineWidth:"1"}),E="arc2",(0,ge.drawLine)(t,u,E,D,S,{color:f,lineWidth:"1"})),!d.cachedStats[s]?.angle)continue;const N=this.getLinkedTextBoxStyle(c,o);if(!N.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const O=this.configuration.getTextLines(d,s);if(!d.handles.textBox.hasMoved){const e=(0,At.getTextBoxCoordsCanvas)(v);d.handles.textBox.worldPosition=i.canvasToWorld(e)}const P=i.worldToCanvas(d.handles.textBox.worldPosition),M="cobbAngleText",k=(0,ge.drawLinkedTextBox)(t,u,M,O,P,v,{},N),{x:R,y:L,width:F,height:U}=k;if(d.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([R,L]),topRight:i.canvasToWorld([R+F,L]),bottomLeft:i.canvasToWorld([R,L+U]),bottomRight:i.canvasToWorld([R+F,L+U])},this.configuration.showArcLines){const e="arcAngle1",n=[`${A.toFixed(2)} ${String.fromCharCode(176)}`],i=Rn(C,I);(0,ge.drawTextBox)(t,u,e,n,i,{...N,padding:3});const r="arcAngle2",o=[`${T.toFixed(2)} ${String.fromCharCode(176)}`],a=Rn(D,S);(0,ge.drawTextBox)(t,u,r,o,a,{...N,padding:3})}}return n},this.distanceToLines=({viewport:e,points:t,canvasCoords:n,proximity:i})=>{const[r,o,a,s]=t,l=e.worldToCanvas(r),c=e.worldToCanvas(o),u=e.worldToCanvas(a),d=e.worldToCanvas(s),h={start:{x:l[0],y:l[1]},end:{x:c[0],y:c[1]}},p={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},f=Le.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]]),m=Le.distanceToPoint([p.start.x,p.start.y],[p.end.x,p.end.y],[n[0],n[1]]);let g=!1,v=!1;return f<=i?g=!0:m<=i&&(v=!0),{distanceToPoint:f,distanceToPoint2:m,isNearFirstLine:g,isNearSecondLine:v}},this.getArcsStartEndPoints=({firstLine:e,secondLine:t,mid1:n,mid2:i})=>{const r=[n,i],o=Te(e,r),a=Te(t,r),s=o>90?1:0,l=a>90?0:1,c=Rn(r[0],r[1]),u=Math.sqrt((r[1][0]-r[0][0])**2+(r[1][1]-r[0][1])**2),d=.1,h=Rn(e[0],e[1]),p=Rn(t[0],t[1]),f=[e[s][0]-h[0],e[s][1]-h[1]],m=Math.sqrt(f[0]**2+f[1]**2),g=[f[0]/m,f[1]/m],v=[h[0]+g[0]*u*d,h[1]+g[1]*u*d],y=[c[0]-n[0],c[1]-n[1]],_=Math.sqrt(y[0]**2+y[1]**2),w=[y[0]/_,y[1]/_],E=[n[0]+w[0]*u*d,n[1]+w[1]*u*d],b=[t[l][0]-p[0],t[l][1]-p[1]],x=Math.sqrt(b[0]**2+b[1]**2),C=[b[0]/x,b[1]/x],I=[p[0]+C[0]*u*d,p[1]+C[1]*u*d],S=[c[0]-i[0],c[1]-i[1]],D=Math.sqrt(S[0]**2+S[1]**2),A=[S[0]/D,S[1]/D];return{arc1Start:v,arc1End:E,arc2Start:I,arc2End:[i[0]+A[0]*u*d,i[1]+A[1]*u*d],arc1Angle:o>90?180-o:o,arc2Angle:a>90?180-a:a}},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(e,t,n,r="mouse"){const o=e.detail,{element:a}=o,{data:s}=t;t.highlighted=!0;let l,c=!1;n.worldPosition?c=!0:l=s.handles.points.findIndex(e=>e===n);const u=(0,Ce.getViewportIdsWithToolToRender)(a,this.getToolName());this.editData={annotation:t,viewportIdsToRender:u,handleIndex:l,movingTextBox:c},this._activateModify(a),(0,Ie.hideElementCursor)(a);const d=(0,i.getEnabledElement)(a),{renderingEngine:h}=d;(0,O.A)(u),e.preventDefault()}_calculateCachedStats(e,t,n){const i=e.data;if(4!==i.handles.points.length)return;const r=[null,null],o=[null,null];let a=Number.MAX_VALUE;for(let e=0;e<2;e+=1)for(let t=2;t<4;t+=1){const n=he.eR.distance(i.handles.points[e],i.handles.points[t]);n<a&&(a=n,r[1]=i.handles.points[e],r[0]=i.handles.points[(e+1)%2],o[0]=i.handles.points[t],o[1]=i.handles.points[2+(t-1)%2])}const{viewport:s}=n,{element:l}=s,c=i.handles.points.map(e=>s.worldToCanvas(e)),u=[c[0],c[1]],d=[c[2],c[3]],h=Rn(u[0],u[1]),p=Rn(d[0],d[1]),{arc1Start:f,arc1End:m,arc2End:g,arc2Start:v,arc1Angle:y,arc2Angle:_}=this.getArcsStartEndPoints({firstLine:u,secondLine:d,mid1:h,mid2:p}),{cachedStats:w}=i,E=Object.keys(w);for(let e=0;e<E.length;e++){w[E[e]]={angle:Te(r,o),arc1Angle:y,arc2Angle:_,points:{canvas:{arc1Start:f,arc1End:m,arc2End:g,arc2Start:v},world:{arc1Start:s.canvasToWorld(f),arc1End:s.canvasToWorld(m),arc2End:s.canvasToWorld(g),arc2Start:s.canvasToWorld(v)}}}}return e.invalidated=!1,(0,xe.XF)(e,l),w}}function Fn(e,t){const n=e.cachedStats[t],{angle:i}=n;if(void 0===i)return;return[`${i.toFixed(2)} ${String.fromCharCode(176)}`]}Ln.toolName="CobbAngle";const{transformWorldToIndex:Un}=i.utilities;class Bn extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Vn,displayBothAxesDistances:!1}}){super(e,t),this.addNewAnnotation=e=>{if(this.startedDrawing)return;this.startedDrawing=!0;const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;if(!(l instanceof i.StackViewport))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");(0,Ie.hideElementCursor)(o),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p},data:{handles:{points:[[...a],[...a]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,r.addAnnotation)(m,o);const g=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,O.A)(g),m},this.isPointNearTool=(e,t,n,i)=>!1,this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;if(this.startedDrawing&&1===c.handles.points.length)return void(this.editData.handleIndex=1);this.startedDrawing=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID),(0,O.A)(a),s&&(0,xe.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,O.A)(o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,O.A)(n),i&&(0,xe.dZ)(t),this.editData=null,this.startedDrawing=!1,t.annotationUID}},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(i),l=i.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const o=a[r],{annotationUID:u,data:d}=o,{points:h}=d.handles;c.annotationUID=u;const p=this.getStyle("color",c,o),f=h.map(e=>i.worldToCanvas(e));if(d.cachedStats[s]&&null!=d.cachedStats[s].xValues?o.invalidated&&this._throttledCalculateCachedStats(o,l,e):(d.cachedStats[s]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(o,l,e)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let m="0";if((0,ge.drawHandle)(t,u,m,f[0],{color:p},0),n=!0,2!==f.length)return n;m="1",(0,ge.drawHandle)(t,u,m,f[1],{color:p},1);if(d.cachedStats[s].isUnitless){const e=`${u}-line-1`,n="1";(0,ge.drawLine)(t,u,n,f[0],f[1],{color:p,width:1,shadow:this.configuration.shadow},e)}else{const e=f[0],n=f[1],i=n[1]-e[1],r=n[0]-e[0];let o=[0,0];o=d.cachedStats[s].isHorizontal?[e[0]+r,e[1]]:[e[0],e[1]+i];let a=`${u}-line-1`,l="1";(0,ge.drawLine)(t,u,l,f[0],o,{color:p,width:1,shadow:this.configuration.shadow},a),a=`${u}-line-2`,l="2",(0,ge.drawLine)(t,u,l,f[1],o,{color:p,width:1,lineDash:[1,1],shadow:this.configuration.shadow},a)}const g=this.getLinkedTextBoxStyle(c,o);if(!g.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const v=this.configuration.getTextLines(d,s,this.configuration);if(!d.handles.textBox.hasMoved){const e=f[1];d.handles.textBox.worldPosition=i.canvasToWorld(e)}const y=i.worldToCanvas(d.handles.textBox.worldPosition),_="1",w=(0,ge.drawLinkedTextBox)(t,u,_,v,y,f,{},g),{x:E,y:b,width:x,height:C}=w;d.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([E,b]),topRight:i.canvasToWorld([E+x,b]),bottomLeft:i.canvasToWorld([E,b+C]),bottomRight:i.canvasToWorld([E+x,b+C])}}return n},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(e,t,n,i){}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;const s=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());let l,c=!1;n.worldPosition?c=!0:l=a.handles.points.findIndex(e=>e===n),this.editData={handleIndex:l,annotation:t,viewportIdsToRender:s},this._activateModify(o),(0,Ie.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,O.A)(s),e.preventDefault()}_calculateCachedStats(e,t,n){const i=e.data,{element:r}=n.viewport;if(2!==i.handles.points.length)return;const{cachedStats:o}=i,a=Object.keys(o);for(let e=0;e<a.length;e++){const t=a[e],r=this.getTargetImageData(t);if(!r)continue;const{imageData:s}=r,l=i.handles.points[0],c=i.handles.points[1],u=Un(s,l),d=Un(s,c),{values:h,units:p}=(0,St.Xw)(r,[u]),{values:f,units:m}=(0,St.Xw)(r,[d]);let g,v,y,_,w=!1;if(p[0]!==m[0]||p[1]!==m[1]||"raw"===p[0]&&"raw"===m[0]){const e=(0,Xe.distanceToPoint)(l,c);g=[e,0],v=[e,0],y=["px"],w=!0}else{const e=n.viewport.worldToCanvas(l),t=n.viewport.worldToCanvas(c),i=t[1]-e[1],r=t[0]-e[0];_=Math.abs(r)>Math.abs(i),g=[h[0],f[0]],v=[h[1],f[1]],y=[p[0],p[1]]}o[t]={xValues:g,yValues:v,isHorizontal:_,units:y,isUnitless:w}}return e.invalidated=!1,(0,xe.XF)(e,r),o}}function Vn(e,t,n){const r=e.cachedStats[t],{xValues:o,yValues:a,units:s,isUnitless:l,isHorizontal:c}=r;if(l)return[`${i.utilities.roundNumber(o[0])} px`];if(n.displayBothAxesDistances){const e=Math.abs(o[1]-o[0]),t=Math.abs(a[1]-a[0]);return[`${i.utilities.roundNumber(e)} ${s[0]}`,`${i.utilities.roundNumber(t)} ${s[1]}`]}if(c){const e=Math.abs(o[1]-o[0]);return[`${i.utilities.roundNumber(e)} ${s[0]}`]}{const e=Math.abs(a[1]-a[0]);return[`${i.utilities.roundNumber(e)} ${s[1]}`]}}Bn.toolName="UltrasoundDirectionalTool";class Wn extends ye.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:jn,changeTextCallback:Hn,canvasPosition:[10,10],canvasSize:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s,u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,a,d,h),f=Wn.createAnnotation({metadata:{...l.getViewReference(),referencedImageId:p}});(0,r.addAnnotation)(f,o);const m=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return e.preventDefault(),(0,O.A)(m),this.configuration.getTextCallback(e=>{if(!e)return(0,r.removeAnnotation)(f.annotationUID),(0,O.A)(m),void(this.isDrawing=!1);f.data.text=e,(0,xe.dZ)(f),(0,O.A)(m)}),f},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{canvasPosition:l,canvasSize:c}=this.configuration;return!!l?.length&&(Math.abs(n[0]-l[0]+c/2)<=c/2&&Math.abs(n[1]-l[1]+c/2)<=c/2)},this.toolSelectedCallback=(e,t)=>{t.highlighted=!0,e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t;this._deactivateModify(n),(0,Ie.resetElementCursor)(n)},this.doubleClickCallback=e=>{const t=e.detail,{element:n}=t;let i=(0,r.getAnnotations)(this.getToolName(),n);if(i=this.filterInteractableAnnotationsForElement(n,i),!i?.length)return;const o=i.find(e=>this.isPointNearTool(n,e,t.currentPoints.canvas,6));if(!o)return;const a=o;this.configuration.changeTextCallback(o,e.detail,this._doneChangingTextCallback.bind(this,n,a)),this.isDrawing=!1,e.stopImmediatePropagation(),e.preventDefault()},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,r.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const r=a[e],{annotationUID:o}=r;s.annotationUID=o;const{color:l}=this.getAnnotationStyle({annotation:r,styleSpecifier:s}),{canvasPosition:c,canvasSize:u}=this.configuration;if(c?.length){const e="1";(0,ge.drawArrow)(t,o,e,c.map(e=>e+u),c,{color:l,width:1})}if(n=!0,!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n}return n}}cancel(){}handleSelectedCallback(e,t,n){}_doneChangingTextCallback(e,t,n){t.data.text=n;const r=(0,i.getEnabledElement)(e),{renderingEngine:o}=r,a=(0,Ce.getViewportIdsWithToolToRender)(e,this.getToolName());(0,O.A)(a),(0,xe.XF)(t,e)}_isInsideVolume(e,t,n){return i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n)}}function jn(e){return e(prompt("Enter your annotation:"))}function Hn(e,t,n){return n(prompt("Enter your annotation:"))}Wn.toolName="KeyImage";class zn extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.preMouseDownCallback=e=>this._deleteNearbyAnnotations(e,"mouse"),this.preTouchStartCallback=e=>this._deleteNearbyAnnotations(e,"touch")}_deleteNearbyAnnotations(e,t){const{renderingEngineId:n,viewportId:i,element:o,currentPoints:a}=e.detail,s=(0,R.getToolGroupForViewport)(i,n);if(!s)return!1;const l=s._toolInstances,c=[];for(const e in l){const n=l[e];if("function"!=typeof n.isPointNearTool||"function"!=typeof n.filterInteractableAnnotationsForElement)continue;const i=(0,r.getAnnotations)(e,o);if(!i.length)continue;const s=n.filterInteractableAnnotationsForElement(o,i)||[];for(const e of s)n.isPointNearTool(o,e,a.canvas,10,t)&&c.push(e.annotationUID)}for(const e of c)(0,U.setAnnotationSelected)(e),(0,r.removeAnnotation)(e);return e.preventDefault(),!0}}zn.toolName="Eraser";var Gn=n(72282),qn=n(26047),$n=n(40905),Xn=n(26384);const{transformWorldToIndex:Kn}=i.utilities;function Yn(e,t){const{points:n,segmentsLocked:r,segmentIndex:o,segmentationId:a}=t,{viewport:s}=e,l=(0,$n.S)({operationData:t,viewport:e.viewport});if(!l)return void console.warn("No data found for fillRectangle");const{segmentationImageData:c,segmentationVoxelManager:u}=l;let d=n.map(e=>Kn(c,e));d=d.map(e=>e.map(e=>Math.round(e)));const h=(0,Gn.getBoundingBoxAroundShapeIJK)(d,c.getDimensions()),p=s instanceof i.StackViewport||(0,Xn.l)(d),f=c.getDirection(),m=c.getSpacing(),{viewPlaneNormal:g}=s.getCamera(),v=i.utilities.getSpacingInNormalDirection({direction:f,spacing:m},g),y=(0,Gn.getBoundingBoxAroundShapeWorld)(n);let[[_,w],[E,b],[x,C]]=y;_-=v,w+=v,E-=v,b+=v,x-=v,C+=v;const I=p?()=>!0:e=>{const[t,n,i]=e;return t>=_&&t<=w&&(n>=E&&n<=b)&&(i>=x&&i<=C)};u.forEach(({value:e,index:n})=>{if(r.includes(e))return;const i=t.eraseFocusIndex??0;0!==i&&i!==u.getAtIndex(n)||u.setAtIndex(n,o)},{isInObject:I,boundsIJK:h,imageData:c}),(0,qn.triggerSegmentationDataModified)(a)}function Jn(e,t){Yn(e,t)}function Zn(e,t,n=!0){Jn(e,Object.assign({},t,{segmentIndex:0}))}function Qn(e,t){Zn(e,t,!0)}class ei extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:Jn,ERASE_INSIDE:Qn},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE",eraseFocusIndex:0}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:r}=t,a=n.world,s=(0,i.getEnabledElement)(r),{viewport:l}=s;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=c,h=ve.activeSegmentation.getActiveSegmentation(l.id);if(!h)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=h,f=ve.segmentIndex.getActiveSegmentIndex(p),m=ve.segmentLocking.getLockedSegmentIndices(p),g=ve.config.color.getSegmentIndexColor(l.id,p,f),{representationData:v}=(0,A.getSegmentation)(p),y=v[o.SegmentationRepresentations.Labelmap],_={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:g},data:{handles:{points:[[...a],[...a],[...a],[...a]],activeHandleIndex:null}}},w=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName());if(this.editData={annotation:_,segmentIndex:f,segmentationId:p,segmentsLocked:m,segmentColor:g,viewportIdsToRender:w,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},l instanceof i.BaseVolumeViewport){const{volumeId:e}=y,t=i.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const e=(0,A.getCurrentLabelmapImageIdForViewport)(l.id,p);this.editData={...this.editData,imageId:e}}return this._activateDraw(r),(0,Ie.hideElementCursor)(r),e.preventDefault(),(0,O.A)(w),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a}=this.editData,{data:s}=r,{currentPoints:l}=t,c=(0,i.getEnabledElement)(n),{worldToCanvas:u,canvasToWorld:d}=c.viewport,h=l.world,{points:p}=s.handles;let f,m,g,v,y,_,w,E;switch(p[a]=[...h],a){case 0:case 3:f=u(p[0]),v=u(p[3]),m=[v[0],f[1]],g=[f[0],v[1]],_=d(m),w=d(g),p[1]=_,p[2]=w;break;case 1:case 2:m=u(p[1]),g=u(p[2]),f=[g[0],m[1]],v=[m[0],g[1]],y=d(f),E=d(v),p[0]=y,p[3]=E}r.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(o)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,newAnnotation:o,hasMoved:a}=this.editData,{data:s}=r;if(o&&!a)return;s.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const l=(0,i.getEnabledElement)(n),c={...this.editData,points:s.handles.points,eraseFocusIndex:this.configuration.eraseFocusIndex};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(l,c)},this._activateDraw=e=>{e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:i}=e,{annotation:r}=this.editData,o=r.metadata,a=r.annotationUID,s=r.data,{points:l}=s.handles,c=l.map(e=>i.worldToCanvas(e)),u=`rgb(${o.segmentColor.slice(0,3)})`;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,ge.drawRect)(t,a,"0",c[0],c[3],{color:u}),n=!0,n}}}ei.toolName="RectangleScissor";var ti=n(56789),ni=n(33852);class ii extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:ti.kr,ERASE_INSIDE:ni.r},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE",eraseFocusIndex:0}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=n.canvas,s=(0,i.getEnabledElement)(r),{viewport:l}=s;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=c,h=ve.activeSegmentation.getActiveSegmentation(l.id);if(!h)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=h,f=ve.segmentIndex.getActiveSegmentIndex(p),m=ve.segmentLocking.getLockedSegmentIndices(p),g=ve.config.color.getSegmentIndexColor(l.id,p,f),{representationData:v}=(0,A.getSegmentation)(p),y=v.Labelmap;if(!y)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const _={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:g},data:{handles:{points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},w=[l.id];if(this.editData={annotation:_,centerCanvas:a,segmentIndex:f,segmentationId:p,segmentsLocked:m,segmentColor:g,viewportIdsToRender:w,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},l instanceof i.BaseVolumeViewport){const{volumeId:e}=y,t=i.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const e=(0,A.getCurrentLabelmapImageIdForViewport)(l.id,p);this.editData={...this.editData,imageId:e}}return this._activateDraw(r),(0,Ie.hideElementCursor)(r),e.preventDefault(),(0,O.A)(w),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d,centerCanvas:h}=this.editData,{data:p}=u,f=Math.abs(o[0]-h[0]),m=Math.abs(o[1]-h[1]),g=Math.sqrt(f*f+m*m),v=[h[0],h[1]+g],y=[h[0],h[1]-g],_=[h[0]-g,h[1]],w=[h[0]+g,h[1]];p.handles.points=[c(v),c(y),c(_),c(w)],u.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(d)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,newAnnotation:o,hasMoved:a}=this.editData,{data:s}=r,{viewPlaneNormal:l,viewUp:c}=r.metadata;if(o&&!a)return;s.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),d={...this.editData,points:s.handles.points,viewPlaneNormal:l,viewUp:c,strategySpecificConfiguration:{},eraseFocusIndex:this.configuration.eraseFocusIndex};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(u,d)},this._activateDraw=e=>{e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:i}=e,{viewportIdsToRender:r}=this.editData;if(!r.includes(i.id))return n;const{annotation:o}=this.editData,a=o.metadata,s=o.annotationUID,l=o.data,{points:c}=l.handles,u=c.map(e=>i.worldToCanvas(e)),d=u[0],h=u[1],p=[Math.floor((d[0]+h[0])/2),Math.floor((d[1]+h[1])/2)],f=Math.abs(d[1]-Math.floor((d[1]+h[1])/2)),m=`rgb(${a.segmentColor.slice(0,3)})`;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,ge.drawCircle)(t,s,"0",p,f,{color:m}),n=!0,n}}}ii.toolName="CircleScissor";var ri=n(17492),oi=n(1989);class ai extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:ri.Jq,ERASE_INSIDE:oi._},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE",eraseFocusIndex:0}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:r}=t,a=n.world,s=n.canvas,l=(0,i.getEnabledElement)(r),{viewport:c}=l;this.isDrawing=!0;const u=c.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=ve.activeSegmentation.getActiveSegmentation(c.id);if(!p)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:f}=p,m=ve.segmentIndex.getActiveSegmentIndex(f),g=ve.segmentLocking.getLockedSegmentIndices(f),v=ve.config.color.getSegmentIndexColor(c.id,f,m);this.isDrawing=!0;const y={metadata:{viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:c.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:v},data:{invalidated:!0,handles:{points:[[...a],[...a],[...a],[...a]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},_=[c.id];this.editData={annotation:y,centerCanvas:s,segmentIndex:m,segmentationId:f,segmentsLocked:g,segmentColor:v,toolGroupId:this.toolGroupId,viewportIdsToRender:_,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null};const{representationData:w}=(0,A.getSegmentation)(f),E=w[o.SegmentationRepresentations.Labelmap];if(c instanceof i.BaseVolumeViewport){const{volumeId:e}=E,t=i.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else this.editData={...this.editData};return this._activateDraw(r),(0,Ie.hideElementCursor)(r),e.preventDefault(),(0,O.A)(_),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d,centerCanvas:h}=this.editData,{data:p}=u,f=Math.abs(o[0]-h[0]),m=Math.abs(o[1]-h[1]),g=Math.sqrt(f*f+m*m),v=[h[0],h[1]+g],y=[h[0],h[1]-g],_=[h[0]-g,h[1]],w=[h[0]+g,h[1]];p.handles.points=[c(v),c(y),c(_),c(w)],u.invalidated=!0,this.editData.hasMoved=!0,(0,O.A)(d)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,newAnnotation:o,hasMoved:a,segmentIndex:s,segmentsLocked:l}=this.editData,{data:c}=r,{viewPlaneNormal:u,viewUp:d}=r.metadata;if(o&&!a)return;r.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const h=(0,i.getEnabledElement)(n),p={...this.editData,points:c.handles.points,segmentIndex:s,segmentsLocked:l,viewPlaneNormal:u,viewUp:d,eraseFocusIndex:this.configuration.eraseFocusIndex};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(h,p)},this._activateDraw=e=>{e.addEventListener(o.Events.MOUSE_UP,this._endCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(o.Events.TOUCH_END,this._endCallback),e.addEventListener(o.Events.TOUCH_TAP,this._endCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{e.removeEventListener(o.Events.MOUSE_UP,this._endCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(o.Events.TOUCH_END,this._endCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(o.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:i}=e,{viewportIdsToRender:r}=this.editData;if(!r.includes(i.id))return n;const{annotation:o}=this.editData,a=o.metadata,s=o.annotationUID,l=o.data,{points:c}=l.handles,u=c.map(e=>i.worldToCanvas(e)),d=u[0],h=u[1],p=[Math.floor((d[0]+h[0])/2),Math.floor((d[1]+h[1])/2)],f=Math.abs(d[1]-Math.floor((d[1]+h[1])/2)),m=`rgb(${a.segmentColor.slice(0,3)})`;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,ge.drawCircle)(t,s,"0",p,f,{color:m}),n=!0,n}}}ai.toolName="SphereScissor";n(40336),n(67847);const{transformWorldToIndex:si}=i.utilities;class li extends Zt{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!1,getTextLines:ci,statsCalculator:Gt.BasicStatsCalculator,showTextBox:!1}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u;let p,f,m;if(l instanceof i.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(l);m=i.utilities.getVolumeId(e),f=i.cache.getVolume(m),p=i.utilities.getClosestImageId(f,a,d)}const g=i.utilities.getSpacingInNormalDirection(f,d),v=this._getStartCoordinate(a,g,d),y=this._getEndCoordinate(a,g,d),_=l.getFrameOfReferenceUID(),w={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:_,referencedImageId:p,volumeId:m,spacingInNormal:g,enabledElement:s},data:{label:"",startCoordinate:v,endCoordinate:y,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...a],[...a]],activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[],statistics:[]},labelmapUID:null}};this._computeProjectionPoints(w,f),(0,r.addAnnotation)(w,o);const E=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:w,viewportIdsToRender:E,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,Ie.hideElementCursor)(o),e.preventDefault(),(0,O.A)(E),w},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=o;if(s&&!l)return;o.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.removeAnnotation)(o.annotationUID);const d=this.getTargetId(u.viewport),h=i.cache.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(o,h,d,u),(0,O.A)(a),s&&(0,xe.dZ)(o)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e;let a=(0,r.getAnnotations)(this.getToolName(),o.element);if(!a?.length)return n;a=(0,Pe.filterAnnotationsWithinSamePlane)(a,o.getCamera());const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const l=a[r],{annotationUID:c,data:u}=l,{startCoordinate:d,endCoordinate:h}=u,{points:p,activeHandleIndex:f}=u.handles;s.annotationUID=c;const m=this.getStyle("lineWidth",s,l),g=this.getStyle("lineDash",s,l),v=this.getStyle("color",s,l),y=p.map(e=>o.worldToCanvas(e)),_=y[0],w=Ke(y),{centerPointRadius:E}=this.configuration,b=Ye(y),x=o.getCamera().focalPoint,C=o.getCamera().viewPlaneNormal;let I=d,S=h;Array.isArray(d)&&(I=this._getCoordinateForViewplaneNormal(I,C),u.startCoordinate=I),Array.isArray(h)&&(S=this._getCoordinateForViewplaneNormal(S,C),u.endCoordinate=S);const D=i.utilities.roundToPrecision(u.startCoordinate),A=i.utilities.roundToPrecision(u.endCoordinate),T=this._getCoordinateForViewplaneNormal(x,C),N=i.utilities.roundToPrecision(T);if(N<Math.min(D,A)||N>Math.max(D,A))continue;const O=i.utilities.roundToPrecision((u.startCoordinate+u.endCoordinate)/2);let P,M=!1;if(N===O&&(M=!0),u.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(C)]=O,l.invalidated&&this._throttledCalculateCachedStats(l,e),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,V.isAnnotationVisible)(c))continue;if((0,B.isAnnotationLocked)(c)||this.editData||null===f||!M||(P=[y[f]]),P){const e="0";(0,ge.drawHandles)(t,c,e,P,{color:v})}let k=m,R=g;M?(k=m,R=[]):R=[5,5];const L="0";if((0,ge.drawCircle)(t,c,L,_,w,{color:v,lineDash:R,lineWidth:k}),E>0&&w>3*E&&(0,ge.drawCircle)(t,c,`${L}-center`,_,E,{color:v,lineDash:g,lineWidth:m}),n=!0,1==this.configuration.showTextBox&&1==this.configuration.calculatePointsInsideVolume){const e=this.getLinkedTextBoxStyle(s,l);if(!e.visibility){u.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const n=this.configuration.getTextLines(u);if(!n||0===n.length)continue;let i;u.handles.textBox.hasMoved||(i=(0,At.getTextBoxCoordsCanvas)(b),u.handles.textBox.worldPosition=o.canvasToWorld(i));const r=o.worldToCanvas(u.handles.textBox.worldPosition),a="1",d=(0,ge.drawLinkedTextBox)(t,c,a,n,r,y,{},e),{x:h,y:p,width:f,height:m}=d;u.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([h,p]),topRight:o.canvasToWorld([h+f,p]),bottomLeft:o.canvasToWorld([h,p+m]),bottomRight:o.canvasToWorld([h+f,p+m])}}}return n},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:r}=e,{viewPlaneNormal:o,spacingInNormal:a}=r,{imageData:s}=t,{startCoordinate:l,endCoordinate:c}=n,{points:u}=n.handles,d=si(s,u[0]),h=si(s,u[0]),p=i.utilities.deepClone(u),f=he.eR.create();s.indexToWorldVec3(d,f);const m=he.eR.create();s.indexToWorldVec3(h,m),2==this._getIndexOfCoordinatesForViewplaneNormal(o)?(f[2]=l,m[2]=c,p[0][2]=l,p[1][2]=l):0==this._getIndexOfCoordinatesForViewplaneNormal(o)?(f[0]=l,m[0]=c,p[0][0]=l,p[1][0]=l):1==this._getIndexOfCoordinatesForViewplaneNormal(o)&&(f[1]=l,m[1]=c,p[0][1]=l,p[1][1]=l);const g=he.eR.distance(f,m),v=[];for(let e=0;e<g;e+=a)v.push(p.map(t=>{const n=he.eR.create();return he.eR.scaleAndAdd(n,t,o,e),Array.from(n)}));n.cachedStats.projectionPoints=v}_computePointsInsideVolume(e,t,n,i){const{data:r,metadata:o}=e,{viewPlaneNormal:a,viewUp:s}=o,{viewport:l}=i,c=r.cachedStats.projectionPoints,u=[[]],d=this.getTargetImageData(n),h=r.handles.points.map(e=>l.worldToCanvas(e)),[p,f]=Ye(h),m=l.canvasToWorld(p),g=l.canvasToWorld(f),{worldWidth:v,worldHeight:y}=Ht(a,s,m,g),_=(0,St.Op)(d,r.handles),w=(0,St.CQ)(d),E=Math.abs(Math.PI*(v/_.scale/2)*(y/w/_.scale/2)),b={isPreScaled:(0,Lt.u)(l,n),isSuvScaled:this.isSuvScaled(l,n,e.metadata.referencedImageId)},x=(0,Rt.j)(o.Modality,e.metadata.referencedImageId,b);for(let e=0;e<c.length;e++){if(!t)continue;const n=c[e][0],i=c[e].map(e=>l.worldToCanvas(e)),[r,o]=Ye(i),s=l.canvasToWorld(r),d=l.canvasToWorld(o),h=s,p=d,{dimensions:f,imageData:m,voxelManager:g}=t,v=si(m,h),y=si(m,n),_=this._getIndexOfCoordinatesForViewplaneNormal(a);v[0]=Math.floor(v[0]),v[1]=Math.floor(v[1]),v[2]=Math.floor(v[2]),v[_]=y[_];const w=si(m,p);if(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.floor(w[2]),w[_]=y[_],this._isInsideVolume(v,w,f)){const e=[[Math.min(v[0],w[0]),Math.max(v[0],w[0])],[Math.min(v[1],w[1]),Math.max(v[1],w[1])],[Math.min(v[2],w[2]),Math.max(v[2],w[2])]],t={center:n,xRadius:Math.abs(s[0]-d[0])/2,yRadius:Math.abs(s[1]-d[1])/2,zRadius:Math.abs(s[2]-d[2])/2},i=g.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:e=>(0,zt.pointInEllipse)(t,e),boundsIJK:e,imageData:m,returnPoints:this.configuration.storePointData});u.push(i)}}const C=this.configuration.statsCalculator.getStatistics();r.cachedStats.pointsInVolume=u,r.cachedStats.statistics={Modality:o.Modality,area:E,mean:C.mean?.value,stdDev:C.stdDev?.value,max:C.max?.value,statsArray:C.array,areaUnit:_.areaUnit,modalityUnit:x}}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:r}=t,{cachedStats:o}=n,a=this.getTargetId(r),s=i.cache.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,s,a,t),e.invalidated=!1,(0,xe.XF)(e,r.element),o}_getStartCoordinate(e,t,n){const i=this.configuration.numSlicesToPropagate,r=Math.round(i/2),o=he.eR.create();he.eR.scaleAndAdd(o,e,n,r*-t);return this._getCoordinateForViewplaneNormal(o,n)}_getEndCoordinate(e,t,n){const i=this.configuration.numSlicesToPropagate,r=i-Math.round(i/2),o=he.eR.create();he.eR.scaleAndAdd(o,e,n,r*t);return this._getCoordinateForViewplaneNormal(o,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t.indexOf(Math.max(...t))}_getCoordinateForViewplaneNormal(e,t){return e[this._getIndexOfCoordinatesForViewplaneNormal(t)]}}function ci(e){const t=e.cachedStats.statistics,{area:n,mean:r,max:o,stdDev:a,areaUnit:s,modalityUnit:l}=t;if(void 0===r)return;const c=[];return c.push(`Area: ${i.utilities.roundNumber(n)} ${s}`),c.push(`Mean: ${i.utilities.roundNumber(r)} ${l}`),c.push(`Max: ${i.utilities.roundNumber(o)} ${l}`),c.push(`Std Dev: ${i.utilities.roundNumber(a)} ${l}`),c}li.toolName="CircleROIStartEndThreshold";n(48736);var ui=n(84882);const{transformWorldToIndex:di,isEqual:hi}=i.utilities;class pi extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.preMouseDownCallback=e=>{const t=e.detail,{currentPoints:n,element:r}=t,a=n.world,s=(0,i.getEnabledElement)(r),{viewport:l}=s,c=l.getCamera(),{viewPlaneNormal:u}=c,d=ve.activeSegmentation.getActiveSegmentation(l.id);if(!d)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:h}=d,p=ve.segmentIndex.getActiveSegmentIndex(h),f=ve.segmentLocking.getLockedSegmentIndices(h),{representationData:m}=(0,A.getSegmentation)(h);let g,v,y,_;if(l instanceof i.BaseVolumeViewport){const{volumeId:e}=m[o.SegmentationRepresentations.Labelmap],t=i.cache.getVolume(e);({dimensions:g,direction:v}=t),_=t.voxelManager,y=di(t.imageData,a)}else{const e=(0,A.getCurrentLabelmapImageIdForViewport)(l.id,h);if(!e)throw new Error("No active segmentation imageId detected, create one before using scissors tool");const{imageData:t}=l.getImageData();g=t.getDimensions(),v=t.getDirection();const n=i.cache.getImage(e);_=n.voxelManager,y=di(t,a)}const w=this.getFixedDimension(u,v);if(void 0===w)return void console.warn("Oblique paint fill not yet supported");const{floodFillGetter:E,getLabelValue:b,getScalarDataPositionFromPlane:x,inPlaneSeedPoint:C,fixedDimensionValue:I}=this.generateHelpers(_,g,y,w);if(y[0]<0||y[0]>=g[0]||y[1]<0||y[1]>=g[1]||y[2]<0||y[2]>=g[2])return;const S=b(y[0],y[1],y[2]);if(f.includes(S))return;const D=(0,ui.A)(E,C),{flooded:T}=D;T.forEach(e=>{const t=x(e[0],e[1]);_.setAtIndex(t,p)});const N=this.getFramesModified(w,I,D);return(0,qn.triggerSegmentationDataModified)(h,N),!0},this.getFramesModified=(e,t,n)=>{const{boundaries:i}=n;if(2===e)return[t];let r=1/0,o=-1/0;for(let e=0;e<i.length;e++){const t=i[e][1];t<r&&(r=t),t>o&&(o=t)}const a=[];for(let e=r;e<=o;e++)a.push(e);return a},this.generateHelpers=(e,t,n,i=2)=>{let r,o;switch(i){case 0:r=n[0],o=[n[1],n[2]];break;case 1:r=n[1],o=[n[0],n[2]];break;case 2:r=n[2],o=[n[0],n[1]];break;default:throw new Error(`Invalid fixedDimension: ${i}`)}const a=(t,n,i)=>e.getAtIJK(t,n,i),s=this.generateFloodFillGetter(t,i,r,a),l=this.generateGetScalarDataPositionFromPlane((t,n,i)=>e.toIndex([t,n,i]),i,r);return{getScalarDataPositionFromPlane:l,getLabelValue:a,floodFillGetter:s,inPlaneSeedPoint:o,fixedDimensionValue:r}},this.generateFloodFillGetter=(e,t,n,i)=>{let r;switch(t){case 0:r=(t,r)=>{if(!(t>=e[1]||t<0||r>=e[2]||r<0))return i(n,t,r)};break;case 1:r=(t,r)=>{if(!(t>=e[0]||t<0||r>=e[2]||r<0))return i(t,n,r)};break;case 2:r=(t,r)=>{if(!(t>=e[0]||t<0||r>=e[1]||r<0))return i(t,r,n)};break;default:throw new Error(`Invalid fixedDimension: ${t}`)}return r},this.generateGetScalarDataPositionFromPlane=(e,t,n)=>{let i;switch(t){case 0:i=(t,i)=>e(n,t,i);break;case 1:i=(t,i)=>e(t,n,i);break;case 2:i=(t,i)=>e(t,i,n);break;default:throw new Error(`Invalid fixedDimension: ${t}`)}return i}}getFixedDimension(e,t){const n=t.slice(0,3),i=t.slice(3,6),r=t.slice(6,9),o=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],a=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(hi(o,a))return 0;const s=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];if(hi(o,s))return 1;const l=[Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2])];return hi(o,l)?2:void 0}}pi.toolName="PaintFill";var fi=n(28906),mi=n(50036);var gi={Corners:{TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"}};const{vtkErrorMacro:vi}=fi.m,{Corners:yi}=gi;const _i={viewportCorner:gi.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function wi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,_i,n),fi.m.obj(e,t),fi.m.get(e,t,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),fi.m.setGet(e,t,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),fi.m.get(e,t,["actor"]),fi.m.moveToProtected(e,t,["interactor"]),function(e,t){t.classHierarchy.push("vtkOrientationMarkerWidget");const n={...e},i=[],r=mi.Ay.newInstance(),o=new ResizeObserver(t=>{e.updateViewport()});let a=null,s=null,l=null,c=null,u=null;function d(){t._interactor.isAnimating()||e.updateMarkerOrientation()}t._onParentRendererChanged=()=>e.updateViewport(),e.computeViewport=()=>{const e=t.parentRenderer||t._interactor.getCurrentRenderer(),[n,i,r,o]=e.getViewport(),a=t._interactor.getView(),s=a.getSize(),[l,c]=a.getViewportSize(e),u=Math.min(l,c);let d=t.viewportSize*u;d=Math.max(Math.min(t.minPixelSize,u),Math.min(t.maxPixelSize,d));const h=d/s[0],p=d/s[1];switch(t.viewportCorner){case yi.TOP_LEFT:return[n,o-p,n+h,o];case yi.TOP_RIGHT:return[r-h,o-p,r,o];case yi.BOTTOM_LEFT:return[n,i,n+h,i+p];case yi.BOTTOM_RIGHT:return[r-h,i,r,i+p];default:return vi("Invalid widget corner"),null}},e.updateViewport=()=>{t.enabled&&(r.setViewport(...e.computeViewport()),t._interactor.render())},e.updateMarkerOrientation=()=>{const e=(t.parentRenderer||t._interactor.getCurrentRenderer()).getActiveCamera();if(!e)return;const n=e.getReferenceByName("position"),o=e.getReferenceByName("focalPoint"),a=e.getReferenceByName("viewUp");if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==o[0]||i[4]!==o[1]||i[5]!==o[2]||i[6]!==a[0]||i[7]!==a[1]||i[8]!==a[2]){i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=o[0],i[4]=o[1],i[5]=o[2],i[6]=a[0],i[7]=a[1],i[8]=a[2];const e=r.getActiveCamera();e.setPosition(n[0],n[1],n[2]),e.setFocalPoint(o[0],o[1],o[2]),e.setViewUp(a[0],a[1],a[2]),r.resetCamera()}},e.setEnabled=n=>{if(n){if(t.enabled)return;if(!t.actor)return void vi("Must set actor before enabling orientation marker.");if(!t._interactor)return void vi("Must set interactor before enabling orientation marker.");const n=t.parentRenderer||t._interactor.getCurrentRenderer(),i=n.getRenderWindow();i.addRenderer(r),i.getNumberOfLayers()<2&&i.setNumberOfLayers(2),r.setLayer(i.getNumberOfLayers()-1),r.setInteractive(t.interactiveRenderer),r.addViewProp(t.actor),t.actor.setVisibility(!0),a=n.onEvent(e=>{"ActiveCameraEvent"===e.type&&(s&&s.unsubscribe(),s=e.camera.onModified(d))}),s=n.getActiveCamera().onModified(d),l=t._interactor.onAnimation(e.updateMarkerOrientation),c=t._interactor.onEndAnimation(e.updateMarkerOrientation),o.observe(t._interactor.getView().getCanvas()),e.updateViewport(),e.updateMarkerOrientation(),t.enabled=!0}else{if(!t.enabled)return;t.enabled=!1,o.disconnect(),a.unsubscribe(),a=null,s.unsubscribe(),s=null,l.unsubscribe(),l=null,c.unsubscribe(),c=null,t.actor.setVisibility(!1),r.removeViewProp(t.actor);const e=t._interactor?.findPokedRenderer()?.getRenderWindow();e&&e.removeRenderer(r)}e.modified()},e.setViewportCorner=n=>{n!==t.viewportCorner&&(t.viewportCorner=n,e.updateViewport())},e.setViewportSize=n=>{const i=Math.min(1,Math.max(0,n));i!==t.viewportSize&&(t.viewportSize=i,e.updateViewport())},e.setActor=n=>{const i=t.enabled;e.setEnabled(!1),t.actor=n,e.setEnabled(i)},e.getRenderer=()=>r,e.delete=()=>{n.delete(),u&&(u.unsubscribe(),u=null),a&&(a.unsubscribe(),a=null),s&&(s.unsubscribe(),s=null),l&&(l.unsubscribe(),l=null),c&&(c.unsubscribe(),c=null),o.disconnect()},u=e.onModified(e.updateViewport)}(e,t)}var Ei={newInstance:fi.m.newInstance(wi,"vtkOrientationMarkerWidget"),extend:wi,...gi},bi=n(7019),xi=n(82409),Ci=n(61433),Ii=n(56748);function Si(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0];const[n,i,r,o]=t,a=e.getContext("2d").getImageData(n,i,r||e.width,o||e.height),s=N.Ay.newInstance({type:"vtkImageData"});s.setOrigin(0,0,0),s.setSpacing(1,1,1),s.setExtent(0,(r||e.width)-1,0,(o||e.height)-1,0,0);const l=T.Ay.newInstance({numberOfComponents:4,values:new Uint8Array(a.data.buffer)});return l.setName("scalars"),s.getPointData().setScalars(l),s}var Di={canvasToImageData:Si,imageToImageData:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d"),{flipX:r,flipY:o,rotate:a}=t;return i.translate(n.width/2,n.height/2),i.scale(r?-1:1,o?-1:1),i.rotate(a*Math.PI/180),i.drawImage(e,-e.width/2,-e.height/2),Si(n)}};const Ai={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:e=>e/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function Ti(e,t){t.set(e)}var Ni={applyDefinitions:Ti,applyPreset:function(e,t){return Ti(Ai[e],t)},registerStylePreset:function(e,t){Ai[e]=t}};const Oi={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};const Pi={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:e=>e/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function Mi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Pi,n),bi.Ay.extend(e,t,n),fi.m.get(e,t,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),function(e,t){t.classHierarchy.push("vtkAnnotatedCubeActor"),t.xPlusFaceProperty={...t.xPlusFaceProperty},t.xMinusFaceProperty={...t.xMinusFaceProperty},t.yPlusFaceProperty={...t.yPlusFaceProperty},t.yMinusFaceProperty={...t.yMinusFaceProperty},t.zPlusFaceProperty={...t.zPlusFaceProperty},t.zMinusFaceProperty={...t.zMinusFaceProperty};let n=null;const i=document.createElement("canvas"),r=xi.Ay.newInstance(),o=Ci.Ay.newInstance();function a(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r&&Object.assign(t[`${n}FaceProperty`],r);const a={...t.defaultStyle,...t[`${n}FaceProperty`]};i.width=a.resolution,i.height=a.resolution;const s=i.getContext("2d");s.fillStyle=a.faceColor,s.fillRect(0,0,i.width,i.height),a.edgeThickness>0&&(s.strokeStyle=a.edgeColor,s.lineWidth=a.edgeThickness*i.width,s.strokeRect(0,0,i.width,i.height)),s.save(),s.translate(0,i.height),s.scale(1,-1),s.translate(i.width/2,i.height/2),s.rotate(-Math.PI*(a.faceRotation/180));const l=a.fontSizeScale(a.resolution);s.fillStyle=a.fontColor,s.textAlign="center",s.textBaseline="middle",s.font=`${a.fontStyle} ${l}px "${a.fontFamily}"`,s.fillText(a.text,0,0),s.restore();const c=Di.canvasToImageData(i);o.setInputData(c,Oi[n]),e.modified()}function s(){n=Ii.Ay.newInstance({generate3DTextureCoordinates:!0}),r.setInputConnection(n.getOutputPort()),a("xPlus"),a("xMinus"),a("yPlus"),a("yMinus"),a("zPlus"),a("zMinus")}o.setInterpolate(!0),e.setDefaultStyle=e=>{t.defaultStyle={...t.defaultStyle,...e},s()},e.setXPlusFaceProperty=e=>a("xPlus",e),e.setXMinusFaceProperty=e=>a("xMinus",e),e.setYPlusFaceProperty=e=>a("yPlus",e),e.setYMinusFaceProperty=e=>a("yMinus",e),e.setZPlusFaceProperty=e=>a("zPlus",e),e.setZMinusFaceProperty=e=>a("zMinus",e),s(),r.setInputConnection(n.getOutputPort()),e.setMapper(r),e.addTexture(o)}(e,t)}var ki={newInstance:fi.m.newInstance(Mi,"vtkAnnotatedCubeActor"),extend:Mi,Presets:Ni},Ri=n(74966),Li=n(87275),Fi=n(62612),Ui=n(28914);const{vtkErrorMacro:Bi}=fi.m;function Vi(e,t,n,i){e.set(function(e,t){let n=0;return e.map((e,i)=>i===n?(n+=e+1,e):e+t)}(t,n),i)}const Wi={outputPointsPrecision:Fi.kP.DEFAULT};function ji(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Wi,n),fi.m.setGet(e,t,["outputPointsPrecision"]),fi.m.obj(e,t),fi.m.algo(e,t,1,1),function(e,t){t.classHierarchy.push("vtkAppendPolyData"),e.requestData=(n,i)=>{const r=e.getNumberOfInputPorts();if(!r)return void Bi("No input specified.");if(1===r)return void(i[0]=n[0]);const o=Li.Ay.newInstance();let a=0,s=0,l=1,c=1,u=0,d=0,h=0,p=0,f=!0,m=!0,g=!0;for(let e=0;e<r;e++){const t=n[e];if(!t)continue;const i=t.getPoints().getNumberOfPoints();a+=i,u+=t.getVerts().getNumberOfValues(),d+=t.getLines().getNumberOfValues(),h+=t.getStrips().getNumberOfValues(),p+=t.getPolys().getNumberOfValues(),i&&(c&&(c=0,s=t.getPoints().getDataType()),l=t.getPoints().getDataType(),s=s>l?s:l);const r=t.getPointData();r?(f=f&&null!==r.getNormals(),m=m&&null!==r.getTCoords(),g=g&&null!==r.getScalars()):(f=!1,m=!1,g=!1)}t.outputPointsPrecision===Fi.kP.SINGLE?s=Ui.JA.FLOAT:t.outputPointsPrecision===Fi.kP.DOUBLE&&(s=Ui.JA.DOUBLE);const v=Ri.Ay.newInstance({dataType:s});v.setNumberOfPoints(a);const y=v.getData(),_=new Uint32Array(u),w=new Uint32Array(d),E=new Uint32Array(h),b=new Uint32Array(p);let x=null,C=null,I=null;const S=n[r-1];if(f){const e=S.getPointData().getNormals();x=T.Ay.newInstance({numberOfComponents:3,numberOfTuples:a,size:3*a,dataType:e.getDataType(),name:e.getName()})}if(m){const e=S.getPointData().getTCoords();C=T.Ay.newInstance({numberOfComponents:2,numberOfTuples:a,size:2*a,dataType:e.getDataType(),name:e.getName()})}if(g){const e=S.getPointData().getScalars();I=T.Ay.newInstance({numberOfComponents:e.getNumberOfComponents(),numberOfTuples:a,size:a*e.getNumberOfComponents(),dataType:e.getDataType(),name:e.getName()})}a=0,u=0,d=0,h=0,p=0;for(let e=0;e<r;e++){const t=n[e];y.set(t.getPoints().getData(),3*a),Vi(_,t.getVerts().getData(),a,u),u+=t.getVerts().getNumberOfValues(),Vi(w,t.getLines().getData(),a,d),d+=t.getLines().getNumberOfValues(),Vi(E,t.getStrips().getData(),a,h),h+=t.getStrips().getNumberOfValues(),Vi(b,t.getPolys().getData(),a,p),p+=t.getPolys().getNumberOfValues();const i=t.getPointData();if(f){const e=i.getNormals();x.getData().set(e.getData(),3*a)}if(m){const e=i.getTCoords();C.getData().set(e.getData(),2*a)}if(g){const e=i.getScalars();I.getData().set(e.getData(),a*I.getNumberOfComponents())}a+=t.getPoints().getNumberOfPoints()}o.setPoints(v),o.getVerts().setData(_),o.getLines().setData(w),o.getStrips().setData(E),o.getPolys().setData(b),x&&o.getPointData().setNormals(x),C&&o.getPointData().setTCoords(C),I&&o.getPointData().setScalars(I),i[0]=o}}(e,t)}var Hi={newInstance:fi.m.newInstance(ji,"vtkAppendPolyData"),extend:ji};const zi={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function Gi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,zi,n),fi.m.obj(e,t),fi.m.setGet(e,t,["height","radius","resolution","capping"]),fi.m.setGetArray(e,t,["center","direction"],3),fi.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkConeSource"),e.requestData=function(e,n){if(t.deleted)return;let i=n[0];const r=2*Math.PI/t.resolution,o=-t.height/2,a=t.resolution+1,s=4*t.resolution+1+t.resolution;let l=0;const c=fi.m.newTypedArray(t.pointType,3*a);let u=0;const d=new Uint32Array(s);c[0]=t.height/2,c[1]=0,c[2]=0,t.capping&&(d[u++]=t.resolution);for(let e=0;e<t.resolution;e++)l++,c[3*l+0]=o,c[3*l+1]=t.radius*Math.cos(e*r),c[3*l+2]=t.radius*Math.sin(e*r),t.capping&&(d[t.resolution-u+++1]=l);for(let e=0;e<t.resolution;e++)d[u++]=3,d[u++]=0,d[u++]=e+1,d[u++]=e+2>t.resolution?1:e+2;ke.A.buildFromRadian().translate(...t.center).rotateFromDirections([1,0,0],t.direction).apply(c),i=Li.Ay.newInstance(),i.getPoints().setData(c,3),i.getPolys().setData(d,1),n[0]=i}}(e,t)}var qi={newInstance:fi.m.newInstance(Gi,"vtkConeSource"),extend:Gi};const $i={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function Xi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,$i,n),fi.m.obj(e,t),fi.m.setGet(e,t,["height","initAngle","otherRadius","radius","resolution","capping"]),fi.m.setGetArray(e,t,["center","direction"],3),fi.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkCylinderSource"),e.requestData=function(e,n){if(t.deleted)return;let i=n[0];const r=2*Math.PI/t.resolution;let o=2*t.resolution,a=5*t.resolution;t.capping&&(o=4*t.resolution,a=7*t.resolution+2);const s=fi.m.newTypedArray(t.pointType,3*o);let l=0;const c=new Uint32Array(a),u=new Float32Array(3*o),d=T.Ay.newInstance({numberOfComponents:3,values:u,name:"Normals"}),h=new Float32Array(2*o),p=T.Ay.newInstance({numberOfComponents:2,values:h,name:"TCoords"}),f=[0,0,0],m=[0,0,0],g=[0,0,0],v=[0,0,0],y=[0,0],_=[0,0],w=null==t.otherRadius?t.radius:t.otherRadius;for(let e=0;e<t.resolution;e++){f[0]=Math.cos(e*r+t.initAngle),m[0]=f[0],g[0]=t.radius*f[0]+t.center[0],v[0]=g[0],y[0]=Math.abs(2*e/t.resolution-1),_[0]=y[0],g[1]=.5*t.height+t.center[1],v[1]=-.5*t.height+t.center[1],y[1]=0,_[1]=1,f[2]=-Math.sin(e*r+t.initAngle),m[2]=f[2],g[2]=w*f[2]+t.center[2],v[2]=g[2];const n=2*e;for(let e=0;e<3;e++)u[3*n+e]=f[e],u[3*(n+1)+e]=m[e],s[3*n+e]=g[e],s[3*(n+1)+e]=v[e],e<2&&(h[2*n+e]=y[e],h[2*(n+1)+e]=_[e])}for(let e=0;e<t.resolution;e++){c[l++]=4,c[l++]=2*e,c[l++]=2*e+1;const n=(2*e+3)%(2*t.resolution);c[l++]=n,c[l++]=n-1}if(t.capping){for(let e=0;e<t.resolution;e++){g[0]=t.radius*Math.cos(e*r+t.initAngle),v[0]=g[0],y[0]=g[0],_[0]=g[0],g[0]+=t.center[0],v[0]+=t.center[0],f[1]=1,m[1]=-1,g[1]=.5*t.height+t.center[1],v[1]=-.5*t.height+t.center[1],g[2]=-w*Math.sin(e*r+t.initAngle),v[2]=g[2],y[1]=g[2],_[1]=g[2],g[2]+=t.center[2],v[2]+=t.center[2];const n=2*t.resolution+e,i=3*t.resolution+t.resolution-e-1;for(let e=0;e<3;e++)u[3*n+e]=f[e],u[3*i+e]=m[e],s[3*n+e]=g[e],s[3*i+e]=v[e],e<2&&(h[2*n+e]=y[e],h[2*i+e]=_[e])}c[l++]=t.resolution;for(let e=0;e<t.resolution;e++)c[l++]=2*t.resolution+e;c[l++]=t.resolution;for(let e=0;e<t.resolution;e++)c[l++]=3*t.resolution+e}ke.A.buildFromRadian().translate(...t.center).rotateFromDirections([0,1,0],t.direction).translate(...t.center.map(e=>-1*e)).apply(s),i=Li.Ay.newInstance(),i.getPoints().setData(s,3),i.getPolys().setData(c,1),i.getPointData().setNormals(d),i.getPointData().setTCoords(p),n[0]=i}}(e,t)}var Ki={newInstance:fi.m.newInstance(Xi,"vtkCylinderSource"),extend:Xi};const Yi={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function Ji(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Yi,n),fi.m.obj(e,t),fi.m.setGet(e,t,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),fi.m.setGetArray(e,t,["direction"],3),fi.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkArrowSource"),e.requestData=function(e,n){if(t.deleted)return;const i=Ki.newInstance({capping:!0});i.setResolution(t.shaftResolution),i.setRadius(t.shaftRadius),i.setHeight(1-t.tipLength),i.setCenter(0,.5*(1-t.tipLength),0);const r=i.getOutputData(),o=r.getPoints().getData(),a=r.getPointData().getNormals().getData();ke.A.buildFromDegree().rotateZ(-90).apply(o).apply(a);const s=qi.newInstance();s.setResolution(t.tipResolution),s.setHeight(t.tipLength),s.setRadius(t.tipRadius);const l=s.getOutputData(),c=l.getPoints().getData();ke.A.buildFromRadian().translate(1-.5*t.tipLength,0,0).apply(c);const u=Hi.newInstance();u.setInputData(r),u.addInputData(l);const d=u.getOutputData(),h=d.getPoints().getData();ke.A.buildFromRadian().translate(.5*t.tipLength-.5,0,0).apply(h),t.invert?(ke.A.buildFromRadian().rotateFromDirections([1,0,0],t.direction).scale(-1,-1,-1).apply(h),n[0]=d):(ke.A.buildFromRadian().rotateFromDirections([1,0,0],t.direction).scale(1,1,1).apply(h),n[0]=u.getOutputData())}}(e,t)}var Zi={newInstance:fi.m.newInstance(Ji,"vtkArrowSource"),extend:Ji};function Qi(e){const t=e.getPoints().getBounds(),n=[.5*-(t[0]+t[1]),.5*-(t[2]+t[3]),.5*-(t[4]+t[5])];ke.A.buildFromDegree().translate(...n).apply(e.getPoints().getData())}function er(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.getPoints().getBounds(),r=[0,0,0];r[t]=n?-i[2*t+1]:-i[2*t],ke.A.buildFromDegree().translate(...r).apply(e.getPoints().getData())}function tr(e,t,n,i){const r=e.getPoints().getData().length,o=new Uint8ClampedArray(r);let a=0;for(;a<r;)o[a++]=t,o[a++]=n,o[a++]=i;e.getPointData().setScalars(T.Ay.newInstance({name:"color",numberOfComponents:3,values:o}))}function nr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};bi.Ay.extend(e,t,function(e){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...e?.config},xConfig:{color:[255,0,0],invert:!1,...e?.xConfig},yConfig:{color:[255,255,0],invert:!1,...e?.yConfig},zConfig:{color:[0,128,0],invert:!1,...e?.zConfig}}}(n)),fi.m.setGet(e,t,["config","xConfig","yConfig","zConfig"]),function(e,t){t.classHierarchy.push("vtkAxesActor");const n=xi.Ay.newInstance();e.setMapper(n),e.update=()=>{let e={...t.config,...t.xConfig};const i=Zi.newInstance({direction:[1,0,0],...e}).getOutputData();t.config.recenter?Qi(i):er(i,0,e.invert),tr(i,...e.color),e={...t.config,...t.yConfig};const r=Zi.newInstance({direction:[0,1,0],...e}).getOutputData();t.config.recenter?Qi(r):er(r,1,e.invert),tr(r,...e.color),e={...t.config,...t.zConfig};const o=Zi.newInstance({direction:[0,0,1],...e}).getOutputData();t.config.recenter?Qi(o):er(o,2,e.invert),tr(o,...e.color);const a=Hi.newInstance();a.setInputData(i),a.addInputData(r),a.addInputData(o),n.setInputConnection(a.getOutputPort())},e.update();const i=fi.m.debounce(e.update,0);e.setXAxisColor=t=>e.setXConfig({...e.getXConfig(),color:t}),e.setYAxisColor=t=>e.setYConfig({...e.getYConfig(),color:t}),e.setZAxisColor=t=>e.setZConfig({...e.getZConfig(),color:t}),e.getXAxisColor=()=>t.getXConfig().color,e.getYAxisColor=()=>t.getYConfig().color,e.getZAxisColor=()=>t.getZConfig().color,t._onConfigChanged=i,t._onXConfigChanged=i,t._onYConfigChanged=i,t._onZConfigChanged=i}(e,t)}var ir={newInstance:fi.m.newInstance(nr,"vtkAxesActor"),extend:nr},rr=n(14235),or=Uint8Array,ar=Uint16Array,sr=Uint32Array,lr=new or([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),cr=new or([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ur=new or([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dr=function(e,t){for(var n=new ar(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new sr(n[30]);for(i=1;i<30;++i)for(var o=n[i];o<n[i+1];++o)r[o]=o-n[i]<<5|i;return[n,r]},hr=dr(lr,2),pr=hr[0],fr=hr[1];pr[28]=258,fr[258]=28;for(var mr=dr(cr,0),gr=mr[0],vr=(mr[1],new ar(32768)),yr=0;yr<32768;++yr){var _r=(43690&yr)>>>1|(21845&yr)<<1;_r=(61680&(_r=(52428&_r)>>>2|(13107&_r)<<2))>>>4|(3855&_r)<<4,vr[yr]=((65280&_r)>>>8|(255&_r)<<8)>>>1}var wr=function(e,t,n){for(var i=e.length,r=0,o=new ar(t);r<i;++r)e[r]&&++o[e[r]-1];var a,s=new ar(t);for(r=0;r<t;++r)s[r]=s[r-1]+o[r-1]<<1;if(n){a=new ar(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],d=s[e[r]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[vr[d]>>>l]=c}else for(a=new ar(i),r=0;r<i;++r)e[r]&&(a[r]=vr[s[e[r]-1]++]>>>15-e[r]);return a},Er=new or(288);for(yr=0;yr<144;++yr)Er[yr]=8;for(yr=144;yr<256;++yr)Er[yr]=9;for(yr=256;yr<280;++yr)Er[yr]=7;for(yr=280;yr<288;++yr)Er[yr]=8;var br=new or(32);for(yr=0;yr<32;++yr)br[yr]=5;var xr=wr(Er,9,1),Cr=wr(br,5,1),Ir=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Sr=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Dr=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Ar=function(e){return(e+7)/8|0},Tr=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(2==e.BYTES_PER_ELEMENT?ar:4==e.BYTES_PER_ELEMENT?sr:or)(n-t);return i.set(e.subarray(t,n)),i},Nr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Or=function(e,t,n){var i=new Error(t||Nr[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,Or),!n)throw i;return i},Pr=function(e,t,n){var i=e.length;if(!i||n&&n.f&&!n.l)return t||new or(0);var r=!t||n,o=!n||n.i;n||(n={}),t||(t=new or(3*i));var a=function(e){var n=t.length;if(e>n){var i=new or(Math.max(2*n,e));i.set(t),t=i}},s=n.f||0,l=n.p||0,c=n.b||0,u=n.l,d=n.d,h=n.m,p=n.n,f=8*i;do{if(!u){s=Sr(e,l,1);var m=Sr(e,l+1,3);if(l+=3,!m){var g=e[(D=Ar(l)+4)-4]|e[D-3]<<8,v=D+g;if(v>i){o&&Or(0);break}r&&a(c+g),t.set(e.subarray(D,v),c),n.b=c+=g,n.p=l=8*v,n.f=s;continue}if(1==m)u=xr,d=Cr,h=9,p=5;else if(2==m){var y=Sr(e,l,31)+257,_=Sr(e,l+10,15)+4,w=y+Sr(e,l+5,31)+1;l+=14;for(var E=new or(w),b=new or(19),x=0;x<_;++x)b[ur[x]]=Sr(e,l+3*x,7);l+=3*_;var C=Ir(b),I=(1<<C)-1,S=wr(b,C,1);for(x=0;x<w;){var D,A=S[Sr(e,l,I)];if(l+=15&A,(D=A>>>4)<16)E[x++]=D;else{var T=0,N=0;for(16==D?(N=3+Sr(e,l,3),l+=2,T=E[x-1]):17==D?(N=3+Sr(e,l,7),l+=3):18==D&&(N=11+Sr(e,l,127),l+=7);N--;)E[x++]=T}}var O=E.subarray(0,y),P=E.subarray(y);h=Ir(O),p=Ir(P),u=wr(O,h,1),d=wr(P,p,1)}else Or(1);if(l>f){o&&Or(0);break}}r&&a(c+131072);for(var M=(1<<h)-1,k=(1<<p)-1,R=l;;R=l){var L=(T=u[Dr(e,l)&M])>>>4;if((l+=15&T)>f){o&&Or(0);break}if(T||Or(2),L<256)t[c++]=L;else{if(256==L){R=l,u=null;break}var F=L-254;if(L>264){var U=lr[x=L-257];F=Sr(e,l,(1<<U)-1)+pr[x],l+=U}var B=d[Dr(e,l)&k],V=B>>>4;B||Or(3),l+=15&B;P=gr[V];if(V>3){U=cr[V];P+=Dr(e,l)&(1<<U)-1,l+=U}if(l>f){o&&Or(0);break}r&&a(c+131072);for(var W=c+F;c<W;c+=4)t[c]=t[c-P],t[c+1]=t[c+1-P],t[c+2]=t[c+2-P],t[c+3]=t[c+3-P];c=W}}n.l=u,n.p=R,n.b=c,n.f=s,u&&(s=1,n.m=h,n.d=d,n.n=p)}while(!s);return c==t.length?t:Tr(t,0,c)},Mr=new or(0),kr=function(e){31==e[0]&&139==e[1]&&8==e[2]||Or(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[n++]);return n+(2&t)},Rr=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Lr=function(e){(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)&&Or(6,"invalid zlib data"),32&e[1]&&Or(6,"invalid zlib data: preset dictionaries not supported")};function Fr(e,t){return Pr(e,t)}function Ur(e,t){return Pr(e.subarray(kr(e),-8),t||new or(Rr(e)))}function Br(e,t){return Pr((Lr(e),e.subarray(2,-4)),t)}var Vr="undefined"!=typeof TextDecoder&&new TextDecoder;try{Vr.decode(Mr,{stream:!0})}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var Wr=n(8906);const jr=[];jr["-".charCodeAt(0)]=62,jr["_".charCodeAt(0)]=63;const Hr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let e=0;e<64;e++)jr[Hr.charCodeAt(e)]=e;function zr(e){return void 0!==jr[e.charCodeAt(0)]}function Gr(e,t,n,i){const{start:r,count:o}=t,a=o%4,s=Math.floor(o/4);let l=r,c=null,u=n;for(let t=0;t<s;t++){for(;!zr(e[l]);)l++;for(c=jr[e.charCodeAt(l++)]<<18;!zr(e[l]);)l++;for(c|=jr[e.charCodeAt(l++)]<<12;!zr(e[l]);)l++;for(c|=jr[e.charCodeAt(l++)]<<6;!zr(e[l]);)l++;c|=jr[e.charCodeAt(l++)],i[u++]=c>>16&255,i[u++]=c>>8&255,i[u++]=255&c}switch(a){case 3:for(;!zr(e[l]);)l++;for(c=jr[e.charCodeAt(l++)]<<10;!zr(e[l]);)l++;for(c|=jr[e.charCodeAt(l++)]<<4;!zr(e[l]);)l++;c|=jr[e.charCodeAt(l++)]>>2,i[u++]=c>>8&255,i[u++]=255&c;break;case 2:for(;!zr(e[l]);)l++;for(c=jr[e.charCodeAt(l++)]<<2;!zr(e[l]);)l++;c|=jr[e.charCodeAt(l++)]>>4,i[u++]=255&c;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return u}function qr(e,t,n){const i=(e<<16)+(t<<8)+n;return Hr[i>>18]+Hr[i>>12&63]+Hr[i>>6&63]+Hr[63&i]}var $r={toArrayBuffer:function(e){const t=function(e){const t=e.length,n=[];let i=null;for(let r=0;r<t;r++)zr(e[r])?(i||(i={start:r,count:0}),i.count++,i.end=r):"="===e[r]&&i&&(n.push(i),i=null);return i&&n.push(i),n}(e),n=t[t.length-1].end+1,i=(4-n%4)%4,r=new ArrayBuffer(3*(n+i)/4-i),o=new Uint8Array(r);let a=0;for(let n=0;n<t.length;n++)a+=Gr(e,t[n],a,o),a+=(4-t[n].count%4)%4;return r},fromArrayBuffer:function(e){const t=new Uint8Array(e),n=e.byteLength%3,i=e.byteLength-n,r=Array(i/3);for(let e=0;e<r.length;e++){const n=3*e;r[e]=qr(t[n],t[n+1],t[n+2])}if(n>0){const e=qr(t[i],t[i+1]||0,t[i+2]||0);1===n?r.push(`${e.substr(0,2)}==`):2===n&&r.push(`${e.substr(0,3)}=`)}return r.join("")}};const Xr={name:"",numberOfComponents:1,size:0,dataType:"string"};function Kr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,Xr,n),!t.empty&&!t.values&&!t.size)throw new TypeError("Cannot create vtkStringArray object without: size > 0, values");t.values?Array.isArray(t.values)&&(t.values=[...t.values]):t.values=[],t.values&&(t.size=t.values.length),fi.m.obj(e,t),fi.m.set(e,t,["name"]),function(e,t){t.classHierarchy.push("vtkStringArray"),e.getComponent=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.values[e*t.numberOfComponents+n]},e.setComponent=(n,i,r)=>{r!==t.values[n*t.numberOfComponents+i]&&(t.values[n*t.numberOfComponents+i]=r,e.modified())},e.getData=()=>t.values,e.getTuple=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=t.numberOfComponents||1;n.length&&(n.length=i);const r=e*i;for(let e=0;e<i;e++)n[e]=t.values[r+e];return n},e.getTupleLocation=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*t.numberOfComponents},e.getNumberOfComponents=()=>t.numberOfComponents,e.getNumberOfValues=()=>t.values.length,e.getNumberOfTuples=()=>t.values.length/t.numberOfComponents,e.getDataType=()=>t.dataType,e.newClone=()=>Yr({name:t.name,numberOfComponents:t.numberOfComponents,empty:!0}),e.getName=()=>(t.name||e.setName(`vtkStringArray${e.getMTime()}`),t.name),e.setData=(n,i)=>{t.values=n,t.size=n.length,i&&(t.numberOfComponents=i),t.size%t.numberOfComponents!==0&&(t.numberOfComponents=1),e.modified()}}(e,t)}const Yr=fi.m.newInstance(Kr,"vtkStringArray");var Jr={newInstance:Yr,extend:Kr},Zr=n(56413);n(67313);function Qr(e,t){return function(e,t){return[...e.getElementsByTagName(t)]}(e,t)[0]}const eo={Int8:Int8Array,UInt8:Uint8Array,Int16:Int16Array,UInt16:Uint16Array,Int32:Int32Array,UInt32:Uint32Array,Int64:Int32Array,UInt64:Uint32Array,Float32:Float32Array,Float64:Float64Array},to={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,Int64:8,UInt64:8,Float32:4,Float64:8};function no(e){const t=e.length-1;return e.filter((e,n)=>n<t&&n%2==0)}function io(e,t,n){if(!["UInt64","UInt32"].includes(n))throw new Error(`Cannot handle a header type of ${n}`);let i=eo[n],r=eo[t],o=!1;"UInt64"===n&&(i=eo.UInt32),/^U?Int64$/.test(t)&&(o=!0,r=eo[t.replace("64","32")]);const{byteOffset:a}=e,s=to[t],l=to[n];let c;c=a%l===0?new i(e.buffer,a,1):new i(e.buffer.slice(a,a+l));const u=Number(c[0]);let d,h=u/s;o&&(h*=2);const p=a+l;return d=p%s===0?new r(e.buffer,p,h):new r(e.buffer.slice(p,p+u)),o&&(d=no(d)),d}function ro(e,t){const n=31==(i=e)[0]&&139==i[1]&&8==i[2]?Ur(i,r):8!=(15&i[0])||i[0]>>4>7||(i[0]<<8|i[1])%31?Fr(i,r):Br(i,r);var i,r;t.uint8.set(n,t.offset),t.offset+=n.length}function oo(e,t){const n=function(e,t){if("UInt64"===t){const t=8;let n=new Uint32Array(e.buffer,0,6);const i=n[0],r=[t,i,n[2],n[4]];n=new Uint32Array(e.buffer,24,2*i);for(let e=0;e<i;e++)r.push(n[2*e]);return r}let n=new Uint32Array(e.buffer,0,3);const i=n[0],r=[4,i,n[1],n[2]];n=new Uint32Array(e.buffer,12,i);for(let e=0;e<i;e++)r.push(n[e]);return r}(e,t),i=n[1],r=n[2],o=n[3];let a=0;i>0&&(a=0===o?i*r:(i-1)*r+o);const s=new ArrayBuffer(a),l={offset:0,uint8:new Uint8Array(s)};let c=function(e){const[t]=e;return(e.length-1)*t}(n);for(;c<e.length&&120!==e[c];)c++;for(let t=0;t<i;t++){const i=n[4+t];ro(new Uint8Array(e.buffer,c,i),l),c+=i}return l.uint8}function ao(e,t,n,i,r,o){const a=t.getAttribute("type"),s=t.getAttribute("Name"),l=t.getAttribute("format"),c=Number(t.getAttribute("NumberOfComponents")||"1");let u=null;if("ascii"===l){u=new eo[a](e*c);let n=0;t.firstChild.nodeValue.split(/[\\t \\n]+/).forEach(e=>{e.trim().length&&(u[n++]=Number(e))})}else if("binary"===l){const e=new Uint8Array($r.toArrayBuffer(t.firstChild.nodeValue.trim()));if("vtkZLibDataCompressor"===n){const t=oo(e,r);u=new eo[a](t.buffer),/^U?Int64$/.test(a)&&(u=no(u))}else u=new eo[a](e.buffer,to[r]),-1!==a.indexOf("Int64")&&(u=no(u))}else if("appended"===l){const e=Number(t.getAttribute("offset"));u=io(new Uint8Array(o,e),a,r)}else console.error("Format not supported",l);return{name:s,values:u,numberOfComponents:c}}function so(e){return(new TextDecoder).decode(e).split("\0").slice(0,-1)}function lo(e,t,n,i,r){const o=[...e.getElementsByTagName("DataArray")].map(e=>T.Ay.newInstance(ao(Number(e.getAttribute("NumberOfTuples")),e,t,0,i,r))),a=[...e.getElementsByTagName("Array")].filter(e=>"String"===e.getAttribute("type")).map(e=>{const n=Jr.newInstance(function(e,t,n,i,r){const o=e.getAttribute("Name"),a=e.getAttribute("format"),s=Number(e.getAttribute("NumberOfComponents")||"1"),l=Number(e.getAttribute("NumberOfTuples")||"1")*s,c=[];if("ascii"===a){const t=e.firstChild.nodeValue.trim().split(/\s+/);let n=0;const i=[];for(;c.length<l;){const e=Number(t[n++]);0===e?(c.push(i.join("")),i.length=0):i.push(String.fromCharCode(e))}}else if("binary"===a){const n=new Uint8Array($r.toArrayBuffer(e.firstChild.nodeValue.trim()));if("vtkZLibDataCompressor"===t){const e=oo(n,i);c.push(...so(e))}else{const e=io(n,"UInt8",i);c.push(...so(e))}}else if("appended"===a){const t=Number(e.getAttribute("offset")),n=io(new Uint8Array(r,t),"UInt8",i);c.push(...so(n))}else fi.m.vtkErrorMacro(`Format not supported: ${a}`);return{name:o,values:c,numberOfComponents:s}}(e,t,0,i,r));return n});return[...o,...a]}function co(e,t){t.classHierarchy.push("vtkXMLReader"),t.dataAccessHelper||(t.dataAccessHelper=Wr.Ay.get("http")),e.setUrl=function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.url=n;const r=n.split("/");return r.pop(),t.baseURL=r.join("/"),e.loadData(i)},e.loadData=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.dataAccessHelper.fetchBinary(e,n)}(t.url,n).then(e.parseAsArrayBuffer)},e.parseAsArrayBuffer=n=>{if(!n)return!1;if(n===t.rawDataBuffer)return!0;e.modified();const{text:i,binaryBuffer:r}=(o=n,Zr.A.extractBinary(o,/^\s*<AppendedData\s+encoding="raw">\s*_/m,/\n\s*<\/AppendedData>/m));var o;t.rawDataBuffer=n,t.binaryBuffer=r;var a;const s=(a=i,(0,rr.create)(a)).root(),l=s.node,c=l.getAttribute("type"),u=l.getAttribute("compressor"),d=l.getAttribute("byte_order"),h=l.getAttribute("header_type")||"UInt32";if(u&&"vtkZLibDataCompressor"!==u)return console.error("Invalid compressor",u),!1;if(d&&"LittleEndian"!==d)return console.error("Only LittleEndian encoding is supported"),!1;if(c!==t.dataType)return console.error("Invalid data type",c,"expecting",t.dataType),!1;if(Qr(l,"AppendedData")){const e=Qr(l,"AppendedData"),n=e.getAttribute("encoding"),i=s.filter(e=>{const{node:t}=e;return t.nodeType===Node.ELEMENT_NODE&&"appended"===t.getAttribute("format")&&t.hasAttribute("offset")},!1,!0).map(e=>({node:e.node,offset:Number(e.node.getAttribute("offset"))}));i.sort((e,t)=>e.offset-t.offset);let r=t.binaryBuffer;"base64"===n&&(r=e.textContent.trim().substr(1));const o=[];for(let e=0;e<i.length;++e){const t=i[e].offset;let a=0;a=e===i.length-1?r.length||r.byteLength:i[e+1].offset,"base64"===n?o.push(new Uint8Array($r.toArrayBuffer(r.substring(t,a)))):o.push(new Uint8Array(r.slice(t,a)))}if("vtkZLibDataCompressor"===u)for(let e=0;e<o.length;++e){const t=oo(o[e],h),n=new Uint8Array(t.length+to[h]);new eo[h](n.buffer,0,1)[0]=t.length,n.set(t,to[h]),o[e]=n}const a=o.reduce((e,t)=>e+t.length,0),c=new ArrayBuffer(a),d=new Uint8Array(c);for(let e=0,t=0;e<o.length;++e)i[e].node.setAttribute("offset",t),d.set(o[e],t),t+=o[e].length;if(t.binaryBuffer=c,!t.binaryBuffer)return console.error("Processing appended data format: requires binaryBuffer to parse"),!1}e.parseXML(l,c,u,d,h);const p=l.getElementsByTagName(c)[0].getElementsByTagName("FieldData")[0];if(p){const e=lo(p,u,0,h,t.binaryBuffer);for(let n=0;n<t.output.length;n++){const i=t.output[n].getFieldData();for(let t=0;t<e.length;t++)i.addArray(e[t])}}return!0},e.requestData=(n,i)=>{e.parseAsArrayBuffer(t.rawDataBuffer)}}const uo={};var ho={extend:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,uo,n),fi.m.obj(e,t),fi.m.get(e,t,["url","baseURL"]),fi.m.setGet(e,t,["dataAccessHelper"]),fi.m.algo(e,t,0,1),co(e,t)},processDataArray:ao,processFieldData:function(e,t,n,i,r,o,a){if(t){const r={};["Scalars","Vectors","Normals","Tensors","TCoords"].forEach(e=>{const i=t.getAttribute(e);i&&(r[i]=n[`set${e}`])});const s=t.getElementsByTagName("DataArray"),l=s.length;for(let t=0;t<l;t++){const l=s[t],c=T.Ay.newInstance(ao(e,l,i,0,o,a)),u=c.getName();(r[u]||n.addArray)(c)}}},processCells:function(e,t,n,i,r,o){const a={},s=t.getElementsByTagName("DataArray");for(let e=0;e<s.length;e++){const t=s[e];a[t.getAttribute("Name")]=t}const l=ao(e,a.offsets,n,0,r,o).values,c=l[l.length-1],u=ao(c,a.connectivity,n,0,r,o).values,d=new Uint32Array(e+c);let h=0,p=0;return l.forEach(e=>{const t=e-p;d[h++]=t;for(let e=0;e<t;e++)d[h++]=u[p+e];p=e}),d}};function po(e,t,n,i,r,o,a){const s=Number(n.getAttribute(`NumberOf${t}`));if(s>0){const l=n.getElementsByTagName(t)[0].getElementsByTagName("DataArray")[0],{values:c,numberOfComponents:u}=ho.processDataArray(s,l,i,r,o,a);e[`get${t}`]().setData(c,u)}return s}function fo(e,t,n,i,r,o,a){const s=Number(n.getAttribute(`NumberOf${t}`));if(s>0){const l=ho.processCells(s,n.getElementsByTagName(t)[0],i,r,o,a);e[`get${t}`]().setData(l)}return s}const mo={dataType:"PolyData"};function go(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,mo,n),ho.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkXMLPolyDataReader"),e.parseXML=(e,n,i,r,o)=>{const a=e.getElementsByTagName(t.dataType)[0].getElementsByTagName("Piece"),s=a.length;for(let e=0;e<s;e++){const n=Li.Ay.newInstance(),s=a[e],l=po(n,"Points",s,i,r,o,t.binaryBuffer);let c=0;["Verts","Lines","Strips","Polys"].forEach(e=>{c+=fo(n,e,s,i,r,o,t.binaryBuffer)}),ho.processFieldData(l,s.getElementsByTagName("PointData")[0],n.getPointData(),i,r,o,t.binaryBuffer),ho.processFieldData(c,s.getElementsByTagName("CellData")[0],n.getCellData(),i,r,o,t.binaryBuffer),t.output[e]=n}}}(e,t)}var vo,yo={newInstance:fi.m.newInstance(go,"vtkXMLPolyDataReader"),extend:go};!function(e){e[e.ANNOTATED_CUBE=1]="ANNOTATED_CUBE",e[e.AXES=2]="AXES",e[e.CUSTOM=3]="CUSTOM"}(vo||(vo={}));class _o extends ye.oS{static{this.CUBE=1}static{this.AXIS=2}static{this.VTPFILE=3}static{this.OVERLAY_MARKER_TYPES=vo}constructor(e={},t={configuration:{orientationWidget:{enabled:!0,viewportCorner:Ei.Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:_o.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[_o.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"L",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"R",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:e=>e/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[_o.OVERLAY_MARKER_TYPES.AXES]:{},[_o.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}){super(e,t),this._resizeObservers=new Map,this.onSetToolEnabled=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolActive=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolDisabled=()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()},this._getViewportsInfo=()=>(0,R.getToolGroup)(this.toolGroupId).viewportsInfo,this.resize=e=>{const t=this.orientationMarkers[e];if(!t)return;const{orientationWidget:n}=t;n.updateViewport()},this.orientationMarkers={},this.updatingOrientationMarker={}}_unsubscribeToViewportNewVolumeSet(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,i.getEnabledElementByIds)(e,t),{element:r}=n;r.removeEventListener(i.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));this._resizeObservers.get(e).unobserve(r)})};i.eventTarget.removeEventListener(o.Events.TOOLGROUP_VIEWPORT_ADDED,t=>{t.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}_subscribeToViewportEvents(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,i.getEnabledElementByIds)(e,t),{element:r}=n;this.initViewports(),r.addEventListener(i.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const o=new ResizeObserver(()=>{setTimeout(()=>{const n=(0,i.getEnabledElementByIds)(e,t);if(!n)return;const{viewport:r}=n;this.resize(e),r.render()},100)});o.observe(r),this._resizeObservers.set(e,o)})};e(),i.eventTarget.addEventListener(o.Events.TOOLGROUP_VIEWPORT_ADDED,t=>{t.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}cleanUpData(){(0,i.getRenderingEngines)()[0].getViewports().forEach(e=>{const t=this.orientationMarkers[e.id];if(!t)return;const{actor:n,orientationWidget:i}=t;i?.setEnabled(!1),i?.delete(),n?.delete();e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow().render(),e.getRenderingEngine().render(),delete this.orientationMarkers[e.id]})}initViewports(){const e=(0,i.getRenderingEngines)()[0];if(!e)return;let t=e.getViewports();t=(0,Ce.filterViewportsWithToolEnabled)(t,this.getToolName()),t.forEach(e=>{const t=e.getWidget(this.getToolName());t&&!t.isDeleted()||this.addAxisActorInViewport(e)})}async addAxisActorInViewport(e){const t=e.id;if(!this.updatingOrientationMarker[t]){this.updatingOrientationMarker[t]=!0;const n=this.configuration.overlayMarkerType,i=this.configuration.overlayConfiguration[n];if(this.orientationMarkers[t]){const{actor:n,orientationWidget:i}=this.orientationMarkers[t];e.getRenderer().removeActor(n),i.setEnabled(!1)}let r;1===n?r=this.createAnnotationCube(i):2===n?r=ir.newInstance():3===n&&(r=await this.createCustomActor());const o=e.getRenderer(),a=e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow(),{enabled:s,viewportCorner:l,viewportSize:c,minPixelSize:u,maxPixelSize:d}=this.configuration.orientationWidget,h=Ei.newInstance({actor:r,interactor:a.getInteractor(),parentRenderer:o});h.setEnabled(s),h.setViewportCorner(l),h.setViewportSize(c),h.setMinPixelSize(u),h.setMaxPixelSize(d),h.updateMarkerOrientation(),this.orientationMarkers[t]={orientationWidget:h,actor:r},e.addWidget(this.getToolName(),h),a.render(),e.getRenderingEngine().render(),this.updatingOrientationMarker[t]=!1}}async createCustomActor(){const e=this.configuration.overlayConfiguration[vo.CUSTOM].polyDataURL,t=await fetch(e),n=await t.arrayBuffer(),i=yo.newInstance();i.parseAsArrayBuffer(n),i.update();const r=Li.Ay.newInstance();r.shallowCopy(i.getOutputData()),r.getPointData().setActiveScalars("Color");const o=xi.Ay.newInstance();o.setInputData(r),o.setColorModeToDirectScalars();const a=bi.Ay.newInstance();return a.setMapper(o),a.rotateZ(180),a}createAnnotationCube(e){const t=ki.newInstance();return t.setDefaultStyle({...e.defaultStyle}),t.setXPlusFaceProperty({...e.faceProperties.xPlus}),t.setXMinusFaceProperty({...e.faceProperties.xMinus}),t.setYPlusFaceProperty({...e.faceProperties.yPlus}),t.setYMinusFaceProperty({...e.faceProperties.yMinus}),t.setZPlusFaceProperty({...e.faceProperties.zPlus}),t.setZMinusFaceProperty({...e.faceProperties.zMinus}),t}async createAnnotatedCubeActor(){const e=ki.newInstance(),{faceProperties:t,defaultStyle:n}=this.configuration.annotatedCube;return e.setDefaultStyle(n),Object.keys(t).forEach(n=>{const i=`set${n.charAt(0).toUpperCase()+n.slice(1)}FaceProperty`;e[i](t[n])}),e}}_o.toolName="OrientationMarker";var wo=n(26228),Eo=(n(18682),n(70930)),bo=n(74802);class xo extends ye.oS{static{this.SelectMode={Inside:"Inside",Border:"Border"}}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:xo.SelectMode.Border,searchRadius:6}}){super(e,t),this.mouseMoveCallback=e=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setActiveSegment(e),this.hoverTimer=null},this.configuration.hoverTimeout),!0),this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.hoverTimer=null}_setActiveSegment(e={}){if(M.wk.isInteractingWithTool)return;const{element:t,currentPoints:n}=e.detail,r=n.world,o=(0,i.getEnabledElement)(t);if(!o)return;const{viewport:a}=o,s=(0,wo.getActiveSegmentation)(a.id);s&&this._setActiveSegmentForType(s,r,a)}_setActiveSegmentForType(e,t,n){if(!n.getImageData())return;const{segmentationId:i,representationData:r}=e;let o;if(this.configuration.mode===xo.SelectMode.Inside?o=(0,bo.getSegmentIndexAtWorldPoint)(i,t,{viewport:n}):r.Labelmap?o=(0,bo.getSegmentIndexAtLabelmapBorder)(i,t,{viewport:n,searchRadius:this.configuration.searchRadius}):r.Contour?o=(0,bo.getHoveredContourSegmentationAnnotation)(i):r.Surface,!o||0===o)return;(0,Eo.setActiveSegmentIndex)(i,o);const a=n.getRenderingEngine().getViewports().map(e=>e.id);(0,qn.triggerSegmentationModified)(i),(0,O.A)(a)}}xo.toolName="SegmentSelectTool";function Co(e,t){const{segmentationVoxelManager:n,segmentationId:i,oldScalarData:r}=t,o=n.getScalarData();for(let e=0;e<o.length;e++)o[e]=r[e];(0,qn.triggerSegmentationDataModified)(i)}class Io extends ye.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_REPLACE:Co},defaultStrategy:"FILL_REPLACE",activeStrategy:"FILL_REPLACE"}}){super(e,t),this.onSetToolPassive=()=>{window.addEventListener("replace",this.applyReplaceCallback)},this.applyReplaceCallback=e=>{const{element:t,oldScalarData:n}=e.detail,r=this.toolGroupId,a=ve.activeSegmentation.getActiveSegmentation(r);if(!a)throw new Error("No active segmentation detected, create one before using the brush tool");const{segmentationId:s}=a,{representationData:l}=ve.state.getSegmentation(s),{volumeId:c}=l[o.SegmentationRepresentations.Labelmap],u=i.cache.getVolume(c)?.voxelManager,d={segmentationVoxelManager:u,segmentationId:s,oldScalarData:n},h=(0,i.getEnabledElement)(t);this.applyActiveStrategy(h,d)}}}Io.toolName="Undo";var So=n(92282);class Do extends ye.EC{constructor(e={}){super(e,{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:s,renderingEngine:l}=a;this.isDrawing=!0;const c=s.getCamera(),{viewPlaneNormal:u,viewUp:d}=c,h=this.getReferencedImageId(s,o,u,d),p={metadata:{viewPlaneNormal:[0,0,1],viewUp:[0,1,0],FrameOfReferenceUID:s.getFrameOfReferenceUID(),referencedImageId:h,toolName:this.getToolName()},data:{invalidated:!0,handles:{points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},cachedStats:{},active:!0}};(0,le.lC)(p,r);const f=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName(),!1);return this.editData={annotation:p,viewportUIDsToRender:f,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),(0,Ie.hideElementCursor)(r),e.preventDefault(),(0,O.A)(f),p},this.getHandleNearImagePoint=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles;for(let e=0;e<l.length;e++){const t=l[e],i=a.worldToCanvas(t);if(!0===he.Zc.distance(n,i)<r)return s.handles.activeHandleIndex=e,t}s.handles.activeHandleIndex=null},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=a.worldToCanvas(l[0]),u=a.worldToCanvas(l[3]),d=this._getRectangleImageCoordinates([c,u]),h=[n[0],n[1]],{left:p,top:f,width:m,height:g}=d;if(So.distanceToPoint([p,f,m,g],h)<=r)return!0},this.toolSelectedCallback=(e,t,n="mouse")=>{const i=e.detail,{element:r}=i,{data:o}=t;o.active=!0;const a=(0,Ce.getViewportIdsWithToolToRender)(r,this.getToolName(),!1);this.editData={annotation:t,viewportUIDsToRender:a},this._activateModify(r),(0,Ie.hideElementCursor)(r),(0,O.A)(a),e.preventDefault()},this.handleSelectedCallback=(e,t,n,i="mouse")=>{const r=e.detail,{element:o}=r,{data:a}=t;a.active=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,Ce.getViewportIdsWithToolToRender)(o,this.getToolName(),!1);this.editData={annotation:t,viewportUIDsToRender:c,handleIndex:s},this._activateModify(o),(0,Ie.hideElementCursor)(o),(0,O.A)(c),e.preventDefault()},this._mouseUpCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportUIDsToRender:o,newAnnotation:a,hasMoved:s}=this.editData,{data:l}=r;if(a&&!s)return;l.active=!1,l.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,Ie.resetElementCursor)(n);(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,le.O8)(r.annotationUID),(0,O.A)(o)},this._mouseDragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportUIDsToRender:o,handleIndex:a}=this.editData,{data:s}=r;if(void 0===a){const{deltaPoints:e}=t,n=e.world,{points:i}=s.handles;i.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),s.invalidated=!0}else{const{currentPoints:e}=t,r=(0,i.getEnabledElement)(n),{worldToCanvas:o,canvasToWorld:l}=r.viewport,c=e.world,{points:u}=s.handles;let d,h,p,f,m,g,v,y;switch(u[a]=[...c],a){case 0:case 3:d=o(u[0]),f=o(u[3]),h=[f[0],d[1]],p=[d[0],f[1]],g=l(h),v=l(p),u[1]=g,u[2]=v;break;case 1:case 2:h=o(u[1]),p=o(u[2]),d=[p[0],h[1]],f=[h[0],p[1]],m=l(d),y=l(f),u[0]=m,u[3]=y}s.invalidated=!0}this.editData.hasMoved=!0;(0,i.getEnabledElement)(n);(0,O.A)(o)},this._activateDraw=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(o.Events.TOUCH_END,this._mouseUpCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._mouseDragCallback)},this._deactivateDraw=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(o.Events.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(o.Events.TOUCH_END,this._mouseUpCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._mouseDragCallback)},this._activateModify=e=>{M.wk.isInteractingWithTool=!0,e.addEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(o.Events.TOUCH_END,this._mouseUpCallback),e.addEventListener(o.Events.TOUCH_DRAG,this._mouseDragCallback)},this._deactivateModify=e=>{M.wk.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(o.Events.TOUCH_END,this._mouseUpCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this._mouseDragCallback)},this.renderAnnotation=(e,t)=>{const n=!1,{viewport:i}=e,{element:r}=i;let o=(0,le.Rh)(this.getToolName(),r);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(r,o),!o?.length)return n;this.getTargetId(i),i.getRenderingEngine();const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<o.length;e++){const n=o[e],{annotationUID:r}=n,s=(n.metadata,n.data),{points:l,activeHandleIndex:c}=s.handles,u=l.map(e=>i.worldToCanvas(e)),d=this.getStyle("lineWidth",a,n),h=this.getStyle("lineDash",a,n),p=this.getStyle("color",a,n);if(!i.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");let f;if(this.editData||null===c||(f=[u[c]]),f){const e="0";(0,ge.drawHandles)(t,r,e,f,{color:p})}const m="0";(0,ge.drawRedactionRect)(t,r,m,u[0],u[3],{color:"black",lineDash:h,lineWidth:d})}},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._calculateCachedStats=(e,t,n,r,a)=>{const{data:s}=e,{viewportUID:l,renderingEngineUID:c,sceneUID:u}=a,d=s.handles.points[0],h=s.handles.points[3],{cachedStats:p}=s,f=Object.keys(p);for(let e=0;e<f.length;e++){const i=f[e],{imageVolume:o}=this._getImageVolumeFromTargetUID(i,r),{dimensions:a,scalarData:s,vtkImageData:l,metadata:c}=o,u=he.eR.fromValues(0,0,0),m=he.eR.fromValues(0,0,0);if(l.worldToIndexVec3(d,u),u[0]=Math.floor(u[0]),u[1]=Math.floor(u[1]),u[2]=Math.floor(u[2]),l.worldToIndexVec3(h,m),m[0]=Math.floor(m[0]),m[1]=Math.floor(m[1]),m[2]=Math.floor(m[2]),this._isInsideVolume(u,m,a)){this.isHandleOutsideImage=!1;const e=Math.min(u[0],m[0]),r=Math.max(u[0],m[0]),o=Math.min(u[1],m[1]),l=Math.max(u[1],m[1]),f=Math.min(u[2],m[2]),g=Math.max(u[2],m[2]),{worldWidth:v,worldHeight:y}=Ht(t,n,d,h),_=v*y;let w=0,E=0,b=0;const x=a[0],C=a[0]*a[1];for(let t=f;t<=g;t++)for(let n=o;n<=l;n++)for(let i=e;i<=r;i++){w++,E+=s[t*C+n*x+i]}E/=w;for(let t=f;t<=g;t++)for(let n=o;n<=l;n++)for(let i=e;i<=r;i++){const e=s[t*C+n*x+i]-E;b+=e*e}b/=w,b=Math.sqrt(b),p[i]={Modality:c.Modality,area:_,mean:E,stdDev:b}}else this.isHandleOutsideImage=!0,p[i]={Modality:c.Modality}}s.invalidated=!1;const m=o.Events.ANNOTATION_MODIFIED,g={annotation:e,viewportUID:l,renderingEngineUID:c,sceneUID:u};return(0,i.triggerEvent)(i.eventTarget,m,g),p},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._getTargetVolumeUID=e=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const t=e.getVolumeActors();return t||t.length?t[0].uid:void 0},this._throttledCalculateCachedStats=(0,Dt.A)(this._calculateCachedStats,100,{trailing:!0})}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,Ie.resetElementCursor)(e);const{annotation:t,viewportUIDsToRender:n}=this.editData,{data:i}=t;return i.active=!1,i.handles.activeHandleIndex=null,(0,O.A)(n),this.editData=null,t.metadata.annotationUID}_getImageVolumeFromTargetUID(e,t){let n;if(e.startsWith("stackTarget")){const i=e.indexOf(":"),r=e.substring(i+1);n=t.getViewport(r).getImageData()}else n=i.cache.getVolume(e);return{imageVolume:n,viewport:undefined}}_getTargetStackUID(e){return`stackTarget:${e.uid}`}}Do.toolName="VideoRedaction"},39011:(e,t,n)=>{"use strict";n.d(t,{o:()=>u});var i=n(15327),r=n(99737),o=n(40203),a=n(39848);const{Active:s,Passive:l,Enabled:c}=r.ToolModes;const u=new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let t=0;t<e.length;t++){const n=e[t];if(this._needsRender.has(n)&&(this._triggerRender(n),this._needsRender.delete(n),0===this._needsRender.size))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,t){this._viewportElements.set(e,t)}removeViewportElement(e,t){this._viewportElements.delete(e),this._needsRender.delete(t),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(e=>{this._needsRender.add(e)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const t=[...this._viewportElements.values()];e.forEach(e=>{-1!==t.indexOf(e)&&this._needsRender.add(e)}),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,i.getEnabledElement)(e);if(!t)return;if(!(0,i.getRenderingEngine)(t.renderingEngineId))return void console.warn("rendering Engine has been destroyed");const n=(0,a.A)(e,[s,l,c]),{renderingEngineId:u,viewportId:d}=t,h={element:e,renderingEngineId:u,viewportId:d};(0,o.draw)(e,o=>{let a=!1;n.forEach(e=>{if(e.renderAnnotation){const n=e.renderAnnotation(t,o);a=a||n}}),a&&(0,i.triggerEvent)(e,r.Events.ANNOTATION_RENDERED,{...h})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}},67013:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var i=n(15327);class r{constructor(e){this.getGroupKey=e=>{if("string"==typeof e)return e;const t=e,n=(0,i.getEnabledElement)(t);if(!n)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return n.FrameOfReferenceUID},this._imageVolumeModifiedHandler=e=>{const t=e.detail,{FrameOfReferenceUID:n}=t,i=this.annotations[n];i&&Object.keys(i).forEach(e=>{i[e].forEach(e=>{void 0!==e.invalidated&&(e.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(e,t)=>{const n=this.annotations;return n[e]?t?n[e][t]?n[e][t]:[]:n[e]:[]},this.getAnnotation=e=>{const t=this.annotations;for(const n in t){const i=t[n];for(const t in i){const n=i[t];for(const t of n)if(e===t.annotationUID)return t}}},this.getNumberOfAnnotations=(e,t)=>{const n=this.getAnnotations(e,t);if(!n.length)return 0;if(t)return n.length;let i=0;for(const e in n)i+=n[e].length;return i},this.addAnnotation=(e,t)=>{const{metadata:n}=e,{FrameOfReferenceUID:i,toolName:r}=n;t=t||i;const o=this.annotations;let a=o[t];a||(o[t]={},a=o[t]);let s=a[r];s||(a[r]=[],s=a[r]),this.preprocessingFn&&(e=this.preprocessingFn(e)),s.push(e)},this.removeAnnotation=e=>{const{annotations:t}=this;for(const n in t){const i=t[n];for(const t in i){const n=i[t],r=n.findIndex(t=>t.annotationUID===e);-1!==r&&(n.splice(r,1),0===n.length&&delete i[t])}0===Object.keys(i).length&&delete t[n]}},this.removeAnnotations=(e,t)=>{const n=this.annotations,i=[];if(!n[e])return i;if(t){const r=n[e][t];for(const e of r)this.removeAnnotation(e.annotationUID),i.push(e)}else for(const t in n[e]){const r=n[e][t];for(const e of r)this.removeAnnotation(e.annotationUID),i.push(e)}return i},this.saveAnnotations=(e,t)=>{const n=this.annotations;if(e&&t){const i=n[e];if(!i)return;const r=i[t];return structuredClone(r)}if(e){const t=n[e];return structuredClone(t)}return structuredClone(n)},this.restoreAnnotations=(e,t,n)=>{const i=this.annotations;if(t&&n){let r=i[t];r||(i[t]={},r=i[t]),r[n]=e}else t?i[t]=e:this.annotations=structuredClone(e)},this.getAllAnnotations=()=>Object.values(this.annotations).map(e=>Object.values(e)).flat(2),this.getNumberOfAllAnnotations=()=>{let e=0;const t=this.annotations;for(const n in t){const i=t[n];for(const t in i){e+=i[t].length}}return e},this.removeAllAnnotations=()=>{const e=[];for(const t of this.getAllAnnotations())this.removeAnnotation(t.annotationUID),e.push(t);return e},e||(e=i.utilities.uuidv4()),this.annotations={},this.uid=e,i.eventTarget.addEventListener(i.Enums.Events.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const o=new r("DEFAULT")},2076:(e,t,n)=>{"use strict";n.d(t,{checkAndSetAnnotationLocked:()=>c,isAnnotationLocked:()=>l,setAnnotationLocked:()=>s});var i=n(15327),r=n(99737),o=n(69059);const a=new Set;function s(e,t=!0){const n=u();e&&(t?function(e,t,n){if(!t.has(e)){t.add(e),n.added.push(e);const i=(0,o.g)(e);i&&(i.isLocked=!0)}}(e,a,n):d(e,a,n)),h(n,a)}function l(e){return a.has(e)}function c(e){const t=l(e);return s(e,t),t}function u(){return Object.freeze({added:[],removed:[],locked:[]})}function d(e,t,n){if(t.delete(e)){n.removed.push(e);const t=(0,o.g)(e);t&&(t.isLocked=!1)}}function h(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach(t=>{e.locked.push(t)}),(0,i.triggerEvent)(i.eventTarget,r.Events.ANNOTATION_LOCK_CHANGE,e))}},17343:(e,t,n)=>{"use strict";n.d(t,{deselectAnnotation:()=>l,isAnnotationSelected:()=>c,setAnnotationSelected:()=>s});var i=n(15327),r=n(99737),o=n(69059);const a=new Set;function s(e,t=!0,n=!1){t?function(e,t=!1){const n=u();if(!t){d(a,n);const t=(0,o.g)(e);t&&(t.isSelected=!0)}if(e&&!a.has(e)){a.add(e),n.added.push(e);const t=(0,o.g)(e);t&&(t.isSelected=!0)}h(n,a)}(e,n):l(e)}function l(e){const t=u();if(e){if(a.delete(e)){t.removed.push(e);(0,o.g)(e).isSelected=!1}}else d(a,t);h(t,a)}function c(e){return a.has(e)}function u(){return Object.freeze({added:[],removed:[],selection:[]})}function d(e,t){e.forEach(n=>{if(e.delete(n)){t.removed.push(n);const e=(0,o.g)(n);e&&(e.isSelected=!1)}})}function h(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach(t=>{e.selection.push(t)}),(0,i.triggerEvent)(i.eventTarget,r.Events.ANNOTATION_SELECTION_CHANGE,e))}},77840:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addAnnotation:()=>_,addChildAnnotation:()=>g,clearParentAnnotation:()=>m,getAllAnnotations:()=>f,getAnnotation:()=>o.g,getAnnotationManager:()=>u,getAnnotations:()=>p,getChildAnnotations:()=>y,getNumberOfAnnotations:()=>w,getParentAnnotation:()=>v,invalidateAnnotation:()=>C,removeAllAnnotations:()=>b,removeAnnotation:()=>E,removeAnnotations:()=>x,resetAnnotationManager:()=>h,setAnnotationManager:()=>d});var i=n(15327),r=n(67013),o=n(69059),a=n(44049),s=n(2076);var l=n(29601);let c=r.H;function u(){return c}function d(e){c=e}function h(){c=r.H}function p(e,t){const n=u(),i=n.getGroupKey(t);return n.getAnnotations(i,e)}function f(){return u().getAllAnnotations()}function m(e){const{annotationUID:t,parentAnnotationUID:n}=e;if(!n)return;const i=(0,o.g)(n),r=i.childAnnotationUIDs.indexOf(t);i.childAnnotationUIDs.splice(r,1),e.parentAnnotationUID=void 0}function g(e,t){const{annotationUID:n}=e,{annotationUID:i}=t;m(t),e.childAnnotationUIDs||(e.childAnnotationUIDs=[]),e.childAnnotationUIDs.includes(i)||(e.childAnnotationUIDs.push(i),t.parentAnnotationUID=n)}function v(e){return e.parentAnnotationUID?(0,o.g)(e.parentAnnotationUID):void 0}function y(e){return e.childAnnotationUIDs?.map(e=>(0,o.g)(e))??[]}function _(e,t){e.annotationUID||(e.annotationUID=i.utilities.uuidv4());const n=u();if(t instanceof HTMLDivElement){const i=n.getGroupKey(t);n.addAnnotation(e,i),(0,a.$f)(e,t)}else n.addAnnotation(e,void 0),(0,a._3)(e);return e.annotationUID}function w(e,t){const n=u(),i=n.getGroupKey(t);return n.getNumberOfAnnotations(i,e)}function E(e){if(!e)return;const t=u(),n=t.getAnnotation(e);n&&(n.childAnnotationUIDs?.forEach(e=>E(e)),t.removeAnnotation(e),(0,a.SH)({annotation:n,annotationManagerUID:t.uid}))}function b(){const e=u(),t=e.removeAllAnnotations();for(const n of t)(0,a.SH)({annotation:n,annotationManagerUID:e.uid})}function x(e,t){const n=u(),i=n.getGroupKey(t),r=n.removeAnnotations(i,e);for(const e of r)(0,a.SH)({annotation:e,annotationManagerUID:n.uid})}function C(e){let t=e;for(;t;)t.invalidated=!0,t=t.parentAnnotationUID?(0,o.g)(t.parentAnnotationUID):void 0}c.setPreprocessingFn(e=>{const t=(e=(e=>(e.data||(e.data={}),e.data.cachedStats||(e.data.cachedStats={}),e))(e=(e=>(e.data||(e.data={}),e.data.handles||(e.data.handles={}),e.data.handles.textBox||(e.data.handles.textBox={}),e))(e))).annotationUID,n=(0,s.checkAndSetAnnotationLocked)(t);e.isLocked=n;const i=(0,l.checkAndSetAnnotationVisibility)(t);return e.isVisible=i,e})},29601:(e,t,n)=>{"use strict";n.d(t,{checkAndSetAnnotationVisibility:()=>p,isAnnotationVisible:()=>c,setAnnotationVisibility:()=>l});var i=n(15327),r=n(99737),o=n(17343),a=n(69059);const s=new Set;function l(e,t=!0){const n=u();e&&(t?d(e,s,n):function(e,t,n){t.has(e)||(t.add(e),(0,o.isAnnotationSelected)(e)&&(0,o.deselectAnnotation)(e),n.lastHidden.push(e))}(e,s,n)),h(n)}function c(e){if((0,a.g)(e))return!s.has(e)}function u(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function d(e,t,n){if(t.delete(e)){n.lastVisible.push(e);(0,a.g)(e).isVisible=!0}}function h(e){(e.lastHidden.length>0||e.lastVisible.length>0)&&(s.forEach(t=>{e.hidden.push(t)}),(0,i.triggerEvent)(i.eventTarget,r.Events.ANNOTATION_VISIBILITY_CHANGE,e))}function p(e){const t=!s.has(e);return l(e,t),t}},8710:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=new class{constructor(){this._initializeConfig({color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0})}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,t){let n=this.config.annotations;n||(this.config={...this.config,annotations:{}},n=this.config.annotations),n[e]=t}setViewportToolStyles(e,t){let n=this.config.viewports;n||(this.config={...this.config,viewports:{}},n=this.config.viewports),n[e]=t}setToolGroupToolStyles(e,t){let n=this.config.toolGroups;n||(this.config={...this.config,toolGroups:{}},n=this.config.toolGroups),n[e]=t}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,t){const{annotationUID:n,viewportId:i,toolGroupId:r,toolName:o}=t;return this._getToolStyle(e,n,i,r,o)}_getToolStyle(e,t,n,i,r){if(t){const n=this.getAnnotationToolStyles(t);if(n&&void 0!==n[e])return n[e]}if(n){const t=this.getViewportToolStyles(n);if(t){if(t[r]&&void 0!==t[r][e])return t[r][e];if(t.global&&void 0!==t.global[e])return t.global[e]}}if(i){const t=this.getToolGroupToolStyles(i);if(t){if(t[r]&&void 0!==t[r][e])return t[r][e];if(t.global&&void 0!==t.global[e])return t.global[e]}}const o=this.getDefaultToolStyles();return o[r]&&void 0!==o[r][e]?o[r][e]:o.global&&void 0!==o.global[e]?o.global[e]:void 0}_initializeConfig(e){const t={};for(const n in e)t[n]=e[n];this.config={default:{global:t}}}}},76712:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});var i=n(8710);function r(e,t,n,r){const o=function(e,t,n){const i=[`${e}`];return t&&i.push(`${i[0]}${t}`),n&&i.push(`${i[i.length-1]}${n}`),i}(e,n,r);for(let e=o.length-1;e>=0;--e){const n=i.A.getStyleProperty(o[e],t);if(void 0!==n)return n}}},49310:(e,t,n)=>{"use strict";n.d(t,{getState:()=>a,style:()=>s.A});var i=n(2076),r=n(17343),o=n(99737);const a=function(e){if(e){if(e.data&&e.highlighted)return o.AnnotationStyleStates.Highlighted;if((0,r.isAnnotationSelected)(e.annotationUID))return o.AnnotationStyleStates.Selected;if((0,i.isAnnotationLocked)(e.annotationUID))return o.AnnotationStyleStates.Locked;if(e.data&&e.autoGenerated)return o.AnnotationStyleStates.AutoGenerated}return o.AnnotationStyleStates.Default};n(76712);var s=n(8710)},69059:(e,t,n)=>{"use strict";n.d(t,{g:()=>r});var i=n(67013);function r(e){return i.H.getAnnotation(e)}},44049:(e,t,n)=>{"use strict";n.d(t,{$f:()=>a,PS:()=>d,SH:()=>l,XF:()=>c,_3:()=>s,dZ:()=>u});var i=n(15327),r=n(99737),o=n(7754);function a(e,t){const n=(0,i.getEnabledElement)(t),{renderingEngine:o,viewportId:a}=n,s=r.Events.ANNOTATION_ADDED,l={annotation:e,viewportId:a,renderingEngineId:o.id};(0,i.triggerEvent)(i.eventTarget,s,l)}function s(e){const{toolName:t}=e.metadata,n=(0,o.getToolGroupsWithToolName)(t);if(!n.length)return;const a=[];n.forEach(t=>{t.viewportsInfo.forEach(t=>{const{renderingEngineId:n,viewportId:r}=t,{FrameOfReferenceUID:o}=(0,i.getEnabledElementByIds)(r,n);e.metadata.FrameOfReferenceUID===o&&a.push(t)})});const s=r.Events.ANNOTATION_ADDED,l={annotation:e};a.length?a.forEach(({renderingEngineId:e,viewportId:t})=>{l.viewportId=t,l.renderingEngineId=e,(0,i.triggerEvent)(i.eventTarget,s,l)}):(0,i.triggerEvent)(i.eventTarget,s,l)}function l(e){const t=r.Events.ANNOTATION_REMOVED;(0,i.triggerEvent)(i.eventTarget,t,e)}function c(e,t,n=r.ChangeTypes.HandlesUpdated){const o=(0,i.getEnabledElement)(t),{viewportId:a,renderingEngineId:s}=o,l=r.Events.ANNOTATION_MODIFIED,c={annotation:e,viewportId:a,renderingEngineId:s,changeType:n};(0,i.triggerEvent)(i.eventTarget,l,c)}function u(e){h({annotation:e})}function d(e,t=!1){h({annotation:e,contourHoleProcessingEnabled:t})}function h(e){const t=r.Events.ANNOTATION_COMPLETED;(0,i.triggerEvent)(i.eventTarget,t,e)}},47807:(e,t,n)=>{"use strict";n.d(t,{config:()=>i,state:()=>r});var i=n(49310),r=(n(2076),n(17343),n(77840));n(29601),n(67013),n(15327),n(94021)},6802:(e,t,n)=>{"use strict";n.d(t,{O8:()=>i.removeAnnotation,Rh:()=>i.getAnnotations,gw:()=>i.getAnnotation,lC:()=>i.addAnnotation});n(67013),n(2076),n(17343);var i=n(77840)},24917:(e,t,n)=>{"use strict";n.d(t,{fy:()=>v,h6:()=>g});var i=n(15327),r=n(99737),o=n(18682),a=n(93210),s=n(94895),l=n(92300),c=n(60284),u=n(68040),d=n(85204),h=n(37590),p=n(7754);const f={[o.A.Labelmap]:c.Ay,[o.A.Contour]:l.A,[o.A.Surface]:s.Ay},m=h.A.toolName;function g(e){y.renderSegmentationsForViewport(e)}function v(e){y.renderSegmentation(e)}const y=new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>(0,i.getRenderingEngines)().flatMap(e=>e.getViewports()),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed();Array.from(this._needsRender).forEach(e=>{this._triggerRender(e)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}renderSegmentationsForViewport(e){const t=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(t)}renderSegmentation(e){const t=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(t)}_getViewportIdsForSegmentation(e){const t=this._getAllViewports(),n=[];for(const i of t){const t=i.id;if(e){const i=(0,a.r$)(t,{segmentationId:e});i?.length>0&&n.push(t)}else{const e=(0,a.r$)(t);e?.length>0&&n.push(t)}}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach(e=>{this._needsRender.add(e)}),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,a.r$)(e);if(!t?.length)return;const{viewport:n}=(0,i.getEnabledElementByViewportId)(e)||{};if(!n)return;const o=[],s=t.map(e=>{e.type===r.SegmentationRepresentations.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const t=f[e.type];try{const i=t.render(n,e);o.push(i)}catch(e){console.error(e)}return Promise.resolve({segmentationId:e.segmentationId,type:e.type})});Promise.allSettled(s).then(e=>{const t=e.filter(e=>"fulfilled"===e.status).map(e=>e.value);n.element.addEventListener(i.Enums.Events.IMAGE_RENDERED,function e(n){const{element:o,viewportId:a}=n.detail;o.removeEventListener(i.Enums.Events.IMAGE_RENDERED,e),t.forEach(e=>{const t={viewportId:a,segmentationId:e.segmentationId,type:e.type};(0,i.triggerEvent)(i.eventTarget,r.Events.SEGMENTATION_RENDERED,{...t})})}),n.render()})}_addPlanarFreeHandToolIfAbsent(e){m in d.wk.tools||(0,u.Gx)(h.A);const t=(0,p.getToolGroupForViewport)(e.id);t.hasTool(m)||(t.addTool(m),t.setToolPassive(m))}}},63457:(e,t,n)=>{"use strict";n.d(t,{_6:()=>p,Zm:()=>u,cC:()=>d});var i=n(15327),r=n(99737),o=n(33739),a=n(99341),s=n(26047),l=n(77133);const c={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};async function u({imageIds:e,options:t}){const n=e,r=t?.volumeId||i.utilities.uuidv4();return await i.volumeLoader.createAndCacheVolumeFromImages(r,n),{volumeId:r}}async function d({segmentationId:e,options:t}){const n=p.getSegmentation(e),i=n.representationData.Labelmap,{volumeId:r}=await u({imageIds:i.imageIds,options:t});n.representationData.Labelmap.volumeId=r}function h(e){const t=o.Ay.newInstance(),n=a.Ay.newInstance();return n.addPoint(0,0),e===r.SegmentationRepresentations.Labelmap?{cfun:t,ofun:n}:{}}const p=new class{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,e||=i.utilities.uuidv4(),this.state=Object.freeze(i.utilities.deepClone(c)),this.uid=e}getState(){return this.state}updateState(e){const t=i.utilities.deepClone(this.state);e(t),this.state=Object.freeze(t)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=Object.freeze(i.utilities.deepClone(c))}getSegmentation(e){return this.state.segmentations.find(t=>t.segmentationId===e)}updateSegmentation(e,t){this.updateState(n=>{const i=n.segmentations.find(t=>t.segmentationId===e);i?Object.assign(i,t):console.warn(`Segmentation with id ${e} not found. Update aborted.`)}),(0,s.triggerSegmentationModified)(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(t=>{const n=i.utilities.deepClone(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const e=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=e}t.segmentations.push(n)}),function(e){const t={segmentationId:e};(0,i.triggerEvent)(i.eventTarget,r.Events.SEGMENTATION_ADDED,t)}(e.segmentationId)}removeSegmentation(e){this.updateState(t=>{const n=t.segmentations.filter(t=>t.segmentationId!==e);t.segmentations.splice(0,t.segmentations.length,...n)}),(0,s.triggerSegmentationRemoved)(e)}addSegmentationRepresentation(e,t,n,o){if(!(0,i.getEnabledElementByViewportId)(e))return;this.getSegmentationRepresentations(e,{type:n,segmentationId:t}).length>0?console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",t):(this.updateState(i=>{i.viewportSegRepresentations[e]||(i.viewportSegRepresentations[e]=[],l.Y.setRenderInactiveSegmentations(e,!0)),n!==r.SegmentationRepresentations.Labelmap?this.addDefaultSegmentationRepresentation(i,e,t,n,o):this.addLabelmapRepresentation(i,e,t,o)}),(0,s.triggerSegmentationRepresentationModified)(e,t,n))}addDefaultSegmentationRepresentation(e,t,n,i,r){const o=e.segmentations.find(e=>e.segmentationId===n);if(!o)return;const a={};Object.keys(o.segments).forEach(e=>{a[Number(e)]={visible:!0}}),e.viewportSegRepresentations[t].push({segmentationId:n,type:i,active:!0,visible:!0,colorLUTIndex:r?.colorLUTIndex||0,segments:a,config:{...h(i),...r}}),this._setActiveSegmentation(e,t,n)}addLabelmapRepresentation(e,t,n,o=h(r.SegmentationRepresentations.Labelmap)){if(!(0,i.getEnabledElementByViewportId)(t))return;const a=this.getSegmentation(n);if(!a)return;const{representationData:s}=a;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,t,n,r.SegmentationRepresentations.Labelmap,o);this.processLabelmapRepresentationAddition(t,n),this.addDefaultSegmentationRepresentation(e,t,n,r.SegmentationRepresentations.Labelmap,o)}async processLabelmapRepresentationAddition(e,t){const n=(0,i.getEnabledElementByViewportId)(e);if(!n)return;const r=this.getSegmentation(t);if(!r)return;const o=n.viewport instanceof i.BaseVolumeViewport,{representationData:a}=r,s="volumeId"in a.Labelmap;n.viewport;o||s||this.updateLabelmapSegmentationImageReferences(e,r.segmentationId)}_updateLabelmapSegmentationReferences(e,t,n,i){const r=t.getCurrentImageId();let o=!1;for(const i of n){t.isReferenceViewable({referencedImageId:i},{asOverlay:!0})&&(o=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(r,i))}return i&&i(t,e,n),o?this._stackLabelmapImageIdReferenceMap.get(e).get(r):void 0}updateLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:r}=n;if(!r.Labelmap)return;const o=this.getLabelmapImageIds(r),a=(0,i.getEnabledElementByViewportId)(e).viewport;return this._updateLabelmapSegmentationReferences(t,a,o,null)}_updateAllLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:r}=n;if(!r.Labelmap)return;const o=this.getLabelmapImageIds(r),a=(0,i.getEnabledElementByViewportId)(e).viewport;this._updateLabelmapSegmentationReferences(t,a,o,(e,t,n)=>{e.getImageIds().forEach((i,r)=>{for(const o of n){e.isReferenceViewable({referencedImageId:o,sliceIndex:r},{asOverlay:!0,withNavigation:!0})&&this._stackLabelmapImageIdReferenceMap.get(t).set(i,o)}})})}getLabelmapImageIds(e){const t=e.Labelmap;let n;if(t.imageIds)n=t.imageIds;else if(!n&&t.volumeId){const e=t.volumeId;n=i.cache.getVolume(e).imageIds}return n}getCurrentLabelmapImageIdForViewport(e,t){const n=(0,i.getEnabledElementByViewportId)(e);if(!n)return;if(!this._stackLabelmapImageIdReferenceMap.has(t))return;const r=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(t).get(r)}getStackSegmentationImageIdsForViewport(e,t){if(!this.getSegmentation(t))return[];this._updateAllLabelmapSegmentationImageReferences(e,t);const{viewport:n}=(0,i.getEnabledElementByViewportId)(e),r=n.getImageIds(),o=this._stackLabelmapImageIdReferenceMap.get(t);return r.map(e=>o.get(e))}removeSegmentationRepresentationsInternal(e,t){const n=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const r=i.viewportSegRepresentations[e];let o=!1;if(!t||Object.values(t).every(e=>void 0===e))n.push(...r),delete i.viewportSegRepresentations[e];else{const{segmentationId:a,type:s}=t;i.viewportSegRepresentations[e]=r.filter(e=>{const t=a&&s&&e.segmentationId===a&&e.type===s||a&&!s&&e.segmentationId===a||!a&&s&&e.type===s;return t&&(n.push(e),e.active&&(o=!0)),!t}),0===i.viewportSegRepresentations[e].length?delete i.viewportSegRepresentations[e]:o&&(i.viewportSegRepresentations[e][0].active=!0)}}),n}removeSegmentationRepresentations(e,t){const n=this.removeSegmentationRepresentationsInternal(e,t);n.forEach(t=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t.segmentationId,t.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&(0,s.triggerSegmentationRepresentationModified)(e,i[0].segmentationId,i[0].type),n}removeSegmentationRepresentation(e,t,n){const i=this.removeSegmentationRepresentationsInternal(e,t);return n||i.forEach(({segmentationId:t,type:n})=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t,n)}),i}_setActiveSegmentation(e,t,n){const i=e.viewportSegRepresentations[t];i&&i.forEach(e=>{e.active=e.segmentationId===n})}setActiveSegmentation(e,t){this.updateState(n=>{const i=n.viewportSegRepresentations[e];i&&i.forEach(e=>{e.active=e.segmentationId===t})}),(0,s.triggerSegmentationRepresentationModified)(e,t)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const t=this.state.viewportSegRepresentations[e].find(e=>e.active);return t?this.getSegmentation(t.segmentationId):void 0}getSegmentationRepresentations(e,t={}){const n=this.state.viewportSegRepresentations[e];return n?t.type||t.segmentationId?n.filter(e=>{const n=!t.type||e.type===t.type,i=!t.segmentationId||e.segmentationId===t.segmentationId;return n&&i}):n:[]}getSegmentationRepresentation(e,t){return this.getSegmentationRepresentations(e,t)[0]}getSegmentationRepresentationVisibility(e,t){const n=this.getSegmentationRepresentation(e,t);return n?.visible}setSegmentationRepresentationVisibility(e,t,n){this.updateState(i=>{const r=this.getSegmentationRepresentations(e,t);r&&r.forEach(e=>{e.visible=n,Object.entries(e.segments).forEach(([e,t])=>{t.visible=n})})}),(0,s.triggerSegmentationRepresentationModified)(e,t.segmentationId,t.type)}addColorLUT(e,t){this.updateState(n=>{n.colorLUT[t]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[t]=i.utilities.deepClone(e)})}removeColorLUT(e){this.updateState(t=>{delete t.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(e=>e.slice(-Math.round(.15*e.length))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,t])=>({viewportId:e,representations:t}))}getSegmentationRepresentationsBySegmentationId(e){const t=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([n,i])=>{const r=i.filter(t=>t.segmentationId===e);r.length>0&&t.push({viewportId:n,representations:r})}),t}}("DEFAULT")},77133:(e,t,n)=>{"use strict";n.d(t,{Y:()=>c});const i={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};const r=function(){return i},o={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};const a=function(){return o};var s=n(99737),l=n(15327);const c=new class{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,t){const{viewportId:n,segmentationId:i,type:r,segmentIndex:o}=e,a=this.getStyle(e);let s;if(s=n||i?this.copyActiveToInactiveIfNotProvided({...a,...t},r):{...a,...t},!r)throw new Error("Type is required to set a style");if(n){this.config.viewportsStyle[n]||(this.config.viewportsStyle[n]={renderInactiveSegmentations:!1,representations:{}});const e=this.config.viewportsStyle[n].representations;if(i){e[i]||(e[i]={}),e[i][r]||(e[i][r]={});const t=e[i][r];void 0!==o?(t.perSegment||(t.perSegment={}),t.perSegment[o]=s):t.allSegments=s}else{const t="__allSegmentations__";e[t]||(e[t]={}),e[t][r]||(e[t][r]={}),e[t][r].allSegments=s}}else if(i){this.config.segmentations[i]||(this.config.segmentations[i]={}),this.config.segmentations[i][r]||(this.config.segmentations[i][r]={});const e=this.config.segmentations[i][r];void 0!==o?(e.perSegment||(e.perSegment={}),e.perSegment[o]=s):e.allSegments=s}else this.config.global[r]=s}copyActiveToInactiveIfNotProvided(e,t){const n={...e};if(t===s.SegmentationRepresentations.Labelmap){const e=n;e.renderOutlineInactive=e.renderOutline,e.outlineWidthInactive=e.outlineWidth,e.renderFillInactive=e.renderFill,e.fillAlphaInactive=e.fillAlpha,e.outlineOpacityInactive=e.outlineOpacity}else if(t===s.SegmentationRepresentations.Contour){const e=n;e.outlineWidthInactive=e.outlineWidth,e.outlineOpacityInactive=e.outlineOpacity,e.outlineDashInactive=e.outlineDash,e.renderOutlineInactive=e.renderOutline,e.renderFillInactive=e.renderFill,e.fillAlphaInactive=e.fillAlpha}return n}getStyle(e){const{viewportId:t,segmentationId:n,type:i,segmentIndex:r}=e;let o=this.getDefaultStyle(i),a=!1;if(this.config.global[i]&&(o={...o,...this.config.global[i]}),this.config.segmentations[n]?.[i]&&(o={...o,...this.config.segmentations[n][i].allSegments},void 0!==r&&this.config.segmentations[n][i].perSegment?.[r]&&(o={...o,...this.config.segmentations[n][i].perSegment[r]})),t&&this.config.viewportsStyle[t]){a=this.config.viewportsStyle[t].renderInactiveSegmentations;const e="__allSegmentations__";this.config.viewportsStyle[t].representations[e]?.[i]&&(o={...o,...this.config.viewportsStyle[t].representations[e][i].allSegments}),n&&this.config.viewportsStyle[t].representations[n]?.[i]&&(o={...o,...this.config.viewportsStyle[t].representations[n][i].allSegments},void 0!==r&&this.config.viewportsStyle[t].representations[n][i].perSegment?.[r]&&(o={...o,...this.config.viewportsStyle[t].representations[n][i].perSegment[r]}))}return o}getRenderInactiveSegmentations(e){return this.config.viewportsStyle[e]?.renderInactiveSegmentations}setRenderInactiveSegmentations(e,t){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=t}getDefaultStyle(e){switch(e){case s.SegmentationRepresentations.Labelmap:return a();case s.SegmentationRepresentations.Contour:return r();case s.SegmentationRepresentations.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const t=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:t,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:t}=e,n=this.getStyle(e),i=this.getDefaultStyle(t);return!l.utilities.deepEqual(n,i)}}},26228:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getActiveSegmentation:()=>o,setActiveSegmentation:()=>a});var i=n(67165),r=n(63457);function o(e){return(0,i.T)(e)}function a(e,t,n=!1){!function(e,t){r._6.setActiveSegmentation(e,t)}(e,t)}},4714:(e,t,n)=>{"use strict";n.d(t,{u:()=>s});var i=n(15327),r=n(63457),o=n(70906),a=n(93952);function s(e,t){const n=r._6,s=t??(0,o.u)();let l=[...e];if(i.utilities.isEqual(l[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),l=[[0,0,0,0],...l]),l=l.map(e=>3===e.length?[e[0],e[1],e[2],255]:e),l.length<255){const e=a.A.slice(l.length);l=[...l,...e]}return n.addColorLUT(l,s),s}},38816:(e,t,n)=>{"use strict";n.d(t,{gR:()=>u});var i=n(99737),r=n(93952),o=n(58640),a=n(26047),s=n(4714),l=(n(70906),n(63457));n(50409);function c(e){const{colorLUTOrIndex:t}=e||{};if(void 0===t){return(0,s.u)(JSON.parse(JSON.stringify(r.A)))}if("number"==typeof t)return t;if(Array.isArray(t)&&t.every(e=>Array.isArray(e)&&4===e.length)){return(0,s.u)(t)}return(0,s.u)(JSON.parse(JSON.stringify(r.A)))}function u(e,t){t.map(t=>function(e,t){const{segmentationId:n,config:r}=t,s={colorLUTIndex:c(r)};l._6.addSegmentationRepresentation(e,n,t.type,s),t.type===i.SegmentationRepresentations.Contour&&(0,o.t)([e]),(0,a.triggerSegmentationModified)(n)}(e,t))}},30935:(e,t,n)=>{"use strict";n.d(t,{d:()=>l});var i=n(63457),r=n(26047),o=n(99737),a=n(15327);const s=function(e){const{segmentationId:t,representation:n,config:i}=e,{type:r,data:s}=n,l=s?{...s}:{};if(!l)throw new Error("Segmentation representation data may not be undefined");var c;r===o.SegmentationRepresentations.Contour&&((c=l).geometryIds=c.geometryIds??[],c.annotationUIDsMap=c.annotationUIDsMap??new Map);const u=function(e,t,n){const i={};e?Object.entries(e).forEach(([e,t])=>{i[e]={segmentIndex:Number(e),label:t.label??`Segment ${e}`,locked:t.locked??!1,cachedStats:t.cachedStats??{},active:t.active??!1}}):t===o.SegmentationRepresentations.Surface?function(e,t){const{geometryIds:n}=t;n.forEach(t=>{const n=a.cache.getGeometry(t);if(n?.data){const{segmentIndex:t}=n.data;e[t]={segmentIndex:t}}})}(i,n):i[1]={segmentIndex:1,label:"Segment 1",locked:!1,cachedStats:{},active:!0};return i}(i?.segments,r,l);return delete i?.segments,{segmentationId:t,label:i?.label??null,cachedStats:i?.cachedStats??{},segments:u,representationData:{[r]:{...l}}}};function l(e,t){const n=i._6;e.forEach(e=>{const i=s(e);n.addSegmentation(i),t||(0,r.triggerSegmentationModified)(i.segmentationId)})}},93733:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addColorLUT:()=>s,getSegmentIndexColor:()=>c,setColorLUT:()=>l,setSegmentIndexColor:()=>u});var i=n(4714),r=n(50409),o=n(93210),a=n(26047);function s(e,t){if(!e)throw new Error("addColorLUT: colorLUT is required");return(0,i.u)(e,t)}function l(e,t,n){if(!(0,r.B)(n))throw new Error(`setColorLUT: could not find colorLUT with index ${n}`);const i=(0,o.r$)(e,{segmentationId:t});if(!i)throw new Error(`viewport specific state for viewport ${e} does not exist`);i.forEach(e=>{e.colorLUTIndex=n}),(0,a.triggerSegmentationRepresentationModified)(e,t)}function c(e,t,n){const i=(0,o.r$)(e,{segmentationId:t});if(!i||0===i.length)return null;const a=i[0],{colorLUTIndex:s}=a,l=(0,r.B)(s);let c=l[n];if(!c){if("number"!=typeof n)throw new Error(`Can't create colour for LUT index ${n}`);c=l[n]=[0,0,0,0]}return c}function u(e,t,n,i){const r=c(e,t,n);for(let e=0;e<i.length;e++)r[e]=i[e];(0,a.triggerSegmentationRepresentationModified)(e,t)}},98798:(e,t,n)=>{"use strict";n.d(t,{Q:()=>a});var i=n(15327),r=n(99737),o=n(64063);function a(e,t){const n={segmentationId:e,modifiedSlicesToUse:t};(0,o.HM)(e),(0,i.triggerEvent)(i.eventTarget,r.Events.SEGMENTATION_DATA_MODIFIED,n)}},60740:(e,t,n)=>{"use strict";n.d(t,{Q:()=>r});var i=n(33283);function r(e){const t=(0,i.T)(e);if(t){const e=Object.keys(t.segments).find(e=>t.segments[e].active);return e?Number(e):void 0}}},67165:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});var i=n(63457);function r(e){return i._6.getActiveSegmentation(e)}},50409:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});var i=n(63457);function r(e){return i._6.getColorLUT(e)}},97577:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});var i=n(63457);function r(e,t){return i._6.getCurrentLabelmapImageIdForViewport(e,t)}},70906:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var i=n(63457);function r(){return i._6.getNextColorLUTIndex()}},33283:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});var i=n(63457);function r(e){return i._6.getSegmentation(e)}},93210:(e,t,n)=>{"use strict";n.d(t,{Ut:()=>o,ny:()=>a,r$:()=>r});var i=n(63457);function r(e,t={}){return i._6.getSegmentationRepresentations(e,t)}function o(e,t){const n=i._6;if(!t.segmentationId||!t.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const r=n.getSegmentationRepresentations(e,t);return r?.[0]}function a(e){return i._6.getSegmentationRepresentationsBySegmentationId(e)}},33658:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});var i=n(63457);function r(e,t){return i._6.getSegmentationRepresentationVisibility(e,t)}},70758:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var i=n(63457);function r(){return i._6.getState().segmentations}},58859:(e,t,n)=>{"use strict";n.d(t,{P:()=>r});var i=n(63457);function r(e){const t=i._6.getState().viewportSegRepresentations;return Object.entries(t).filter(([,t])=>t.some(t=>t.segmentationId===e)).map(([e])=>e)}},42568:(e,t,n)=>{"use strict";n.d(t,{a:()=>o});var i=n(33283),r=n(63457);function o(e,t){return r._6.getState().viewportSegRepresentations[e].map(e=>(t&&e.type,(0,i.T)(e.segmentationId))).filter(e=>void 0!==e)}},21:(e,t,n)=>{"use strict";n.d(t,{_:()=>l,f:()=>c});var i=n(15327),r=n(33283),o=n(99737),a=n(26047),s=n(38816);async function l({volumeId:e}){return{imageIds:i.cache.getVolume(e).imageIds}}function c({segmentationId:e,options:t}){const n=(0,r.T)(e);if(!n)return;const{volumeId:l}=n.representationData.Labelmap,c=i.cache.getVolume(l);return async function({segmentationId:e,viewportId:t,imageIds:n,options:l}){const c=(0,r.T)(e);if(l?.removeOriginal){const e=c.representationData.Labelmap;i.cache.getVolume(e.volumeId)&&i.cache.removeVolumeLoadObject(e.volumeId),c.representationData.Labelmap={imageIds:n}}else c.representationData.Labelmap={...c.representationData.Labelmap,imageIds:n};await(0,s.gR)(t,[{segmentationId:e,type:o.SegmentationRepresentations.Labelmap}]),i.eventTarget.addEventListenerOnce(o.Events.SEGMENTATION_RENDERED,()=>(0,a.triggerSegmentationDataModified)(e))}({segmentationId:e,viewportId:t.viewportId,imageIds:c.imageIds,options:t})}},6994:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});var i=n(63457);async function r(e){return(0,i.Zm)(e)}},6273:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var i=n(63457),r=n(26047);async function o(e){const t=(0,i.cC)(e);return(0,r.triggerSegmentationModified)(e.segmentationId),t}},59452:(e,t,n)=>{"use strict";n.d(t,{Qe:()=>a,Th:()=>l,jU:()=>c,wV:()=>s});var i=n(15327),r=n(99737);function o(e,t,n){const r=(0,i.getEnabledElementByViewportId)(e);if(!r)return;const{renderingEngine:o,viewport:a}=r;if(!o||!a)return;const s=a.getActors().filter(n);return s.length>0?s[0]:void 0}function a(e,t){const n=s(e,t);return n?.uid}function s(e,t){return o(e,0,e=>e.representationUID?.startsWith(`${t}-${r.SegmentationRepresentations.Labelmap}`))}function l(e,t,n){return o(e,0,e=>e.representationUID?.startsWith(`${t}-${r.SegmentationRepresentations.Surface}-${n}`))}function c(e,t,n){const i=l(e,t,n?n.toString():"");return i?.uid}},27108:(e,t,n)=>{"use strict";n.d(t,{wV:()=>i.wV});n(99737),n(6934);var i=n(59452)},47098:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var i=n(93210);function r(e,t){const n=(0,i.Ut)(e,t);if(!n)return new Set;return Object.entries(n.segments).reduce((e,[t,n])=>(n.visible||e.add(Number(t)),e),new Set)}},1300:(e,t,n)=>{"use strict";n.d(t,{activeSegmentation:()=>o,addSegmentationRepresentations:()=>r.gR,config:()=>i,segmentIndex:()=>c,segmentLocking:()=>a,state:()=>s});var i={};n.r(i),n.d(i,{color:()=>l});n(53662);var r=n(38816);n(30935),n(63457),n(26047);var o=n(26228),a=n(26795),s=n(98870),l=n(93733);n(93210);n(33658),n(24917);n(70758),n(42568),n(77133);var c=n(70930),u=n(6273),d=n(6994);n(58062),n(4746),n(99945),n(69073),n(15327),n(33283);var h=n(21);n(60740),n(58859);n(63427);u.p,d.a,h.f},99945:(e,t,n)=>{"use strict";n.d(t,{D:()=>b});var i=n(99737),r=n(68997),o=n(15327),a=n(25758),s=n(42867),l=n(38726),c=n(31199);n(59452);const u=(0,o.getWebWorkerManager)(),d=new Map,h=new Map,p=(e,t)=>{(0,o.triggerEvent)(e,o.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:i.WorkerTypes.SURFACE_CLIPPING})};async function f(e,t){(0,c.b)();const n=t.getSlicesClippingPlanes?.();if(!n)return;const i=t.getSliceIndex();n.sort((e,t)=>Math.abs(e.sliceIndex-i)-Math.abs(t.sliceIndex-i)),p(o.eventTarget,0),await async function(e){const t=e.filter(e=>!h.has(e.id));if(!t.length)return;const n=await u.executeTask("polySeg","getSurfacesAABBs",{surfacesInfo:t},{callbacks:[({progress:e})=>{p(o.eventTarget,e)}]});n.forEach((e,t)=>{h.set(t,e)})}(e);const r=new Map;e.forEach(e=>{r.set(e.id,h.get(e.id))});const a=t.getCamera();return await u.executeTask("polySeg","cutSurfacesIntoPlanes",{surfacesInfo:e,planesInfo:n,surfacesAABB:r},{callbacks:[({progress:e})=>{p(o.eventTarget,e)},({sliceIndex:e,polyDataResults:n})=>{n.forEach((n,i)=>{const r=Number(i),o=function(e,t,n){return`${e.id}-${(0,l.l)(t)}-${n}`}(t,a.viewPlaneNormal,e);!function(e,t,n){const{points:i,lines:r,numberOfCells:o}=n;let a=d.get(e);a||(a=new Map,d.set(e,a));a.set(t,{points:i,lines:r,numberOfCells:o})}(r,o,n)})}]}).catch(e=>{console.error(e)}),p(o.eventTarget,100),d}function m(e){const t=new Map;for(const[n,i]of e){const e=Number(n);for(const[n,r]of i)r&&(t.has(e)||t.set(e,[]),t.get(e).push(r))}return t}var g=n(37590),v=n(77840);const y=e=>{const{numberOfCells:t,lines:n}=e,i=[],r=[];for(let e=0;e<n.length;){const o=n[e];if(r.push(o),i.push(n.slice(e+1,e+o+1)),e+=o+1,i.length===t)break}return{lineSegments:i,linesNumberOfPoints:r}};var _=n(33283),w=n(77133);async function E(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,a.O)(e);let r;const l=(0,_.T)(e).representationData;try{l.Surface?r=await async function(e,t={}){if(!t.viewport)throw new Error("Viewport is required to compute contour from surface");const{viewport:n}=t,i=t.segmentIndices?.length?t.segmentIndices:(0,a.O)(e),r=new Map,s=new Map,l=(0,_.T)(e),c=l.representationData.Surface,u=[];c.geometryIds.forEach((e,t)=>{if(i.includes(t)){r.set(t,e);const n=o.cache.getGeometry(e)?.data;n&&u.push({id:e,points:n.points,polys:n.polys,segmentIndex:t})}}),r.forEach((e,t)=>{s.set(e,t)});const d=await f(u,n),h=m(d);return h}(e,{segmentIndices:n,...t}):l.Labelmap&&(r=await async function(e,t={}){if(!t.viewport)throw new Error("Viewport is required to compute contour from labelmap");const n=await(0,s.HE)(e,t);if(!n?.length)return void console.error("Failed to convert labelmap to surface or labelmap is empty");const{viewport:i}=t,r=n.map(e=>({id:e.segmentIndex.toString(),points:e.data.points,polys:e.data.polys,segmentIndex:e.segmentIndex})),o=await f(r,i),a=m(o);return a}(e,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!r)throw new Error("Not enough data to convert to contour, currently only support converting volume labelmap to contour if available");const{viewport:c}=t,u=function(e,t,n){const i=new Map;for(const[r,a]of e)for(const e of a){const{points:a}=e,{lineSegments:s,linesNumberOfPoints:l}=y(e);for(let e=0;e<s.length;e++){const c=s[e],u=[];for(let t=0;t<l[e];t++){const e=c[t];u.push([a[3*e],a[3*e+1],a[3*e+2]])}if(u.length<3)continue;const d={annotationUID:o.utilities.uuidv4(),data:{contour:{closed:!0,polyline:u},segmentation:{segmentationId:n,segmentIndex:r},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:g.A.toolName,...t.getViewReference()}};(0,v.addAnnotation)(d,t.element);const h=i.get(r)||new Set;h.add(d.annotationUID),i.set(r,h)}}return i}(r,c,e);return w.Y.setStyle({segmentationId:e,type:i.SegmentationRepresentations.Contour},{fillAlpha:0}),{annotationUIDsMap:u}}function b(e,t={}){return(0,r.d)(e,i.SegmentationRepresentations.Contour,()=>E(e,t),()=>{})}},4746:(e,t,n)=>{"use strict";n.d(t,{z:()=>E});var i=n(99737),r=n(68997),o=n(15327),a=n(25758),s=n(33283),l=n(3823),c=n(77840);const u=(0,o.getWebWorkerManager)(),d=(e,t)=>{(0,o.triggerEvent)(e,o.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:i.WorkerTypes.POLYSEG_CONTOUR_TO_LABELMAP})};async function h(e,t={}){const n=t.viewport,i=n.getVolumeId();if(!o.utilities.getViewportImageIds(n))throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");const r=o.utilities.uuidv4(),a=o.volumeLoader.createAndCacheDerivedLabelmapVolume(i,{volumeId:r}),{dimensions:s,origin:l,direction:c,spacing:h,voxelManager:p}=a,{segmentIndices:m,annotationUIDsInSegmentMap:g}=f(e,t);d(o.eventTarget,0);const v=await u.executeTask("polySeg","convertContourToVolumeLabelmap",{segmentIndices:m,dimensions:s,scalarData:p.getCompleteScalarDataArray?.(),origin:l,direction:c,spacing:h,annotationUIDsInSegmentMap:g},{callbacks:[e=>{d(o.eventTarget,e)}]});return d(o.eventTarget,100),p.setCompleteScalarDataArray(v),a.modified(),{volumeId:a.volumeId}}async function p(e,t={}){if(!t.viewport)throw new Error("No viewport provided, labelmap computation from contour requires viewports");const n=t.viewport.getImageIds();if(!n)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");n.forEach(e=>{if(!o.cache.getImageLoadObject(e))throw new Error("ImageIds must be cached before converting contour to labelmap")});const i=(await o.imageLoader.createAndCacheDerivedLabelmapImages(n)).map(e=>e.imageId),{segmentIndices:r,annotationUIDsInSegmentMap:a}=f(e,t),s=new Map;i.forEach((e,t)=>{const i=o.cache.getImage(e),r=o.metaData.get(o.Enums.MetadataModules.IMAGE_PLANE,e);let{columnCosines:a,rowCosines:c,rowPixelSpacing:u,columnPixelSpacing:d,imagePositionPatient:h}=r;a=a??[0,1,0],c=c??[1,0,0],u=u??1,d=d??1,h=h??[0,0,0];const p=l.eR.fromValues(c[0],c[1],c[2]),f=l.eR.fromValues(a[0],a[1],a[2]),m=l.eR.create();l.eR.cross(m,p,f);const g=[...p,...f,...m],v=[u,d,1],y=h;s.set(n[t],{direction:g,spacing:v,origin:y,scalarData:i.voxelManager.getScalarData(),imageId:e,dimensions:[i.width,i.height,1]})}),d(o.eventTarget,0);const c=await u.executeTask("polySeg","convertContourToStackLabelmap",{segmentationsInfo:s,annotationUIDsInSegmentMap:a,segmentIndices:r},{callbacks:[e=>{d(o.eventTarget,e)}]});d(o.eventTarget,100);const h=[];return c.forEach(({scalarData:e},t)=>{const n=s.get(t),{imageId:i}=n,r=o.cache.getImage(i);r.voxelManager.getScalarData().set(e),r.imageFrame?.pixelData?.set(e),h.push(i)}),{imageIds:h}}function f(e,t={}){const n=e.annotationUIDsMap,i=t.segmentIndices?.length?t.segmentIndices:Array.from(n.keys()),r=new Map;return i.forEach(e=>{const t=n.get(e);let i=Array.from(t);i=i.filter(e=>!(0,c.getAnnotation)(e).parentAnnotationUID);const o=i.map(e=>{const t=(0,c.getAnnotation)(e),n=t.childAnnotationUIDs?.length;return{polyline:t.data.contour.polyline,referencedImageId:t.metadata.referencedImageId,holesPolyline:n&&t.childAnnotationUIDs.map(e=>(0,c.getAnnotation)(e).data.contour.polyline)}});r.set(e,o)}),{segmentIndices:i,annotationUIDsInSegmentMap:r}}const m=(0,o.getWebWorkerManager)(),g=(e,t)=>{(0,o.triggerEvent)(e,o.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:i.WorkerTypes.POLYSEG_SURFACE_TO_LABELMAP})};var v=n(21);async function y(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,a.O)(e);let i;const r=(0,s.T)(e),l=r.representationData;try{l.Contour?i=await async function(e,t={}){const n=t.viewport instanceof o.VolumeViewport??!0;if(n&&!t.viewport)throw new Error("Cannot compute labelmap from contour segmentation without providing the viewport");const i=t.segmentIndices?.length?t.segmentIndices:(0,a.O)(e),r=(0,s.T)(e),l=r.representationData.Contour,c=n?h:p,u=await c(l,{segmentIndices:i,viewport:t.viewport});return u}(e,{segmentIndices:n,...t}):l.Surface&&(i=await async function(e,t={}){const{viewport:n}=t,i=n instanceof o.VolumeViewport??!0,r=t.segmentIndices?.length?t.segmentIndices:(0,a.O)(e),l=(0,s.T)(e),c=new Map,u=l.representationData.Surface;if(u.geometryIds.forEach((e,t)=>{r.includes(t)&&c.set(t,e)}),i&&!n)throw new Error("Cannot compute labelmap from surface segmentation without providing the viewport");let d;if(i){const e=n.getVolumeId();d=await o.volumeLoader.createAndCacheDerivedLabelmapVolume(e)}else{const e=t.viewport.getImageIds(),n=o.imageLoader.createAndCacheDerivedLabelmapImages(e).map(e=>e.imageId);d=await o.volumeLoader.createAndCacheVolumeFromImages("generatedSegmentationVolumeId",n)}const h=await async function(e,t){const{geometryIds:n}=e;if(!n?.size)throw new Error("No geometry IDs found for surface representation");const i=new Map;n.forEach((e,t)=>{const n=o.cache.getGeometry(e).data,r=n.points,a=n.polys;i.set(t,{points:r,polys:a})});const{dimensions:r,direction:a,origin:s,spacing:l,voxelManager:c}=t;g(o.eventTarget,0);const u=await m.executeTask("polySeg","convertSurfacesToVolumeLabelmap",{segmentsInfo:i,dimensions:r,spacing:l,direction:a,origin:s},{callbacks:[e=>{g(o.eventTarget,e)}]});return g(o.eventTarget,100),c.setCompleteScalarDataArray(u),t.modified(),{volumeId:t.volumeId}}({geometryIds:c},d);if(i)return h;return await(0,v._)({volumeId:d.volumeId})}(r.segmentationId,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!i)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return i}var _=n(63457),w=n(26047);async function E(e,t={}){return(0,r.d)(e,i.SegmentationRepresentations.Labelmap,()=>y(e,t),()=>null,()=>{_._6.processLabelmapRepresentationAddition(t.viewport.id,e),setTimeout(()=>{(0,w.triggerSegmentationDataModified)(e)},0)})}},58062:(e,t,n)=>{"use strict";n.d(t,{o:()=>p});var i=n(99737),r=n(68997),o=n(42867),a=n(15327),s=n(25758),l=n(58859),c=n(33283),u=n(26047),d=n(93210),h=n(85884);function p(e,t={}){return(0,r.d)(e,i.SegmentationRepresentations.Surface,()=>(0,o.HN)(e,t),()=>async function(e){const t=await(0,o.HE)(e);if(!t)return;const n=(0,c.T)(e),r=(0,s.O)(e);if(!r.length)return n.representationData.Surface.geometryIds.forEach(e=>{const t=a.cache.getGeometry(e).data;t.points=[],t.polys=[]}),void(0,u.triggerSegmentationModified)(e);const p=t.map(({data:t,segmentIndex:o})=>{const s=`segmentation_${e}_surface_${o}`,c=a.cache.getGeometry(s);if(!c)return(0,l.P)(e).map(r=>[(0,d.Ut)(r,{segmentationId:e,type:i.SegmentationRepresentations.Surface})].map(i=>(n.representationData.Surface.geometryIds.set(o,s),(0,h.Y)(e,[{segmentIndex:o,data:t}],{segmentationId:i.segmentationId}))));if(r.includes(o)){const e=c.data;e.points=t.points,e.polys=t.polys}else{const e=c.data;e.points=[],e.polys=[]}});await Promise.all(p),(0,u.triggerSegmentationModified)(e)}(e))}},85884:(e,t,n)=>{"use strict";n.d(t,{Y:()=>a});var i=n(15327),r=n(93733),o=n(33283);async function a(e,t,n={}){const a=(0,o.T)(e),s=new Map,l=Object.keys(t).map(async e=>{const o=t[e],l=o.segmentIndex,c=(0,r.getSegmentIndexColor)(n.viewport.id,a.segmentationId,l).slice(0,3);if(!c)throw new Error("No color found for segment index, unable to create surface");const u={id:`segmentation_${a.segmentationId}_surface_${l}`,color:c,frameOfReferenceUID:"test-frameOfReferenceUID",points:o.data.points,polys:o.data.polys,segmentIndex:l},d=u.id;return s.set(l,d),i.geometryLoader.createAndCacheGeometry(d,{type:i.Enums.GeometryType.SURFACE,geometryData:u})});return await Promise.all(l),{geometryIds:s}}},42867:(e,t,n)=>{"use strict";n.d(t,{HN:()=>f,HE:()=>m});var i=n(25758),r=n(33283),o=n(15327),a=n(77840),s=n(99737);const l=(0,o.getWebWorkerManager)(),c=(e,t,n)=>{(0,o.triggerEvent)(e,o.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:s.WorkerTypes.POLYSEG_CONTOUR_TO_SURFACE,id:n})};var u=n(85884),d=n(6994);const h=(0,o.getWebWorkerManager)(),p=(e,t,n)=>{(0,o.triggerEvent)(e,o.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:s.WorkerTypes.POLYSEG_LABELMAP_TO_SURFACE,id:n})};async function f(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,i.O)(e);let s;const d=(0,r.T)(e),h=d.representationData;try{h.Contour?s=await async function(e,t={}){const n=(0,r.T)(e),s=n.representationData.Contour,u=t.segmentIndices||(0,i.O)(e),d=u.map(async e=>{const t=await async function(e,t){const{annotationUIDsMap:n}=e,i=[],r=[],s=n.get(t);for(const e of s){const t=(0,a.getAnnotation)(e),{polyline:n}=t.data.contour;r.push(n.length),n.forEach(e=>i.push(...e))}c(o.eventTarget,0,t);const u=await l.executeTask("polySeg","convertContourToSurface",{polylines:i,numPointsArray:r},{callbacks:[e=>{c(o.eventTarget,e,t)}]});return c(o.eventTarget,100,t),u}(s,e);return{segmentIndex:e,data:t}});return await Promise.all(d)}(e,{segmentIndices:n,...t}):h.Labelmap&&(s=await m(d.segmentationId,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!s)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await(0,u.Y)(e,s,t)}async function m(e,t={}){const n=(0,r.T)(e);if(!n?.representationData?.Labelmap)return void console.warn("Only support surface update from labelmaps");const a=n.representationData.Labelmap,s=t.segmentIndices||(0,i.O)(e),l=s.map(e=>{const t=async function(e,t){let n;if(e.volumeId)n=e.volumeId;else{const{imageIds:t}=e;({volumeId:n}=await(0,d.a)({imageIds:t}))}const i=o.cache.getVolume(n),r=i.voxelManager.getCompleteScalarDataArray(),{dimensions:a,spacing:s,origin:l,direction:c}=i;p(o.eventTarget,0,t);const u=await h.executeTask("polySeg","convertLabelmapToSurface",{scalarData:r,dimensions:a,spacing:s,origin:l,direction:c,segmentIndex:t},{callbacks:[e=>{p(o.eventTarget,e,t)}]});return p(o.eventTarget,100,t),u}(a,e);return t}),c=await Promise.allSettled(l),u=c.filter(e=>"rejected"===e.status);if(u.length>0)throw console.error(u),new Error("Failed to convert labelmap to surface");return c.map((e,t)=>{if("fulfilled"===e.status)return{segmentIndex:s[t],data:e.value}}).filter(Boolean)}},69073:(e,t,n)=>{"use strict";n.d(t,{n:()=>s});var i=n(99737),r=n(33283),o=n(6934);const a=new Map([[i.SegmentationRepresentations.Labelmap,new Set([i.SegmentationRepresentations.Surface,i.SegmentationRepresentations.Contour])],[i.SegmentationRepresentations.Contour,new Set([i.SegmentationRepresentations.Labelmap,i.SegmentationRepresentations.Surface])],[i.SegmentationRepresentations.Surface,new Set([i.SegmentationRepresentations.Labelmap])]]);function s(e,t){const{representationData:n}=(0,r.T)(e),s=function(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];let a;if(n===i.SegmentationRepresentations.Labelmap)a=o.t;if(a)try{a(r),t.push(n)}catch(e){console.warn(`Validation failed for labelmap of type ${n}`)}else t.push(n)}),t}(n);return s.some(e=>async function(e,t){return a.get(e)?.has(t)||!1}(e,t))}},68997:(e,t,n)=>{"use strict";n.d(t,{d:()=>h});var i=n(15327),r=n(99737),o=n(33283),a=n(18682);const s=function({segmentationId:e,type:t,data:n}){const i=(0,o.T)(e);if(!i)throw new Error(`Segmentation ${e} not found`);switch(i.representationData[t]&&console.warn(`Representation data of type ${t} already exists for segmentation ${e}, overwriting it.`),t){case a.A.Labelmap:case a.A.Contour:case a.A.Surface:n&&(i.representationData[t]=n);break;default:throw new Error(`Invalid representation type ${t}`)}};var l=n(26047),c=n(52905),u=n(31199);const d=new Map;async function h(e,t,n,o,a){(0,u.b)();const c=await n();s({segmentationId:e,type:t,data:c}),a?.(),d.has(e)||d.set(e,[]);const h=d.get(e);return h.includes(t)||h.push(t),function(e){const t=t=>{p(t,e)};e._debouncedUpdateFunction=t,i.eventTarget.removeEventListener(r.Events.SEGMENTATION_DATA_MODIFIED,e._debouncedUpdateFunction),i.eventTarget.addEventListener(r.Events.SEGMENTATION_DATA_MODIFIED,e._debouncedUpdateFunction)}(o),(0,l.triggerSegmentationModified)(e),c}const p=(0,c.A)((e,t)=>{const n=e.detail.segmentationId,i=d.get(n);i&&i.length&&(t(n),i.length&&(0,l.triggerSegmentationModified)(n))},300)},31199:(e,t,n)=>{"use strict";n.d(t,{b:()=>o});var i=n(15327);let r=!1;function o(){if(r)return;r=!0;(0,i.getWebWorkerManager)().registerWorker("polySeg",()=>new Worker(new URL(n.p+n.u(572),n.b),{name:"polySeg",type:void 0}),{maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:2e3}})}},63427:(e,t,n)=>{"use strict";n.d(t,{j:()=>s,z:()=>a});var i=n(63457),r=n(26047),o=n(53662);function a(e){const t=i._6;t.getAllViewportSegmentationRepresentations().filter(({representations:t})=>t.some(t=>t.segmentationId===e)).map(({viewportId:e})=>e).forEach(t=>{(0,o.nc)(t,{segmentationId:e})}),t.removeSegmentation(e),(0,r.triggerSegmentationRemoved)(e)}function s(){const e=i._6;e.getState().segmentations.forEach(e=>{a(e.segmentationId)}),e.resetState()}},53662:(e,t,n)=>{"use strict";n.d(t,{us:()=>p,OE:()=>m,kN:()=>f,E8:()=>u,nc:()=>d,JC:()=>g});var i=n(18682),r=n(60284),o=n(92300),a=n(93210),s=n(15327),l=n(63457),c=n(94895);function u(e,t,n){return h(e,t,n)}function d(e,t,n){return h(e,t,n)}function h(e,t,n){const{segmentationId:u,type:d}=t;return function(e,t,n,l){const u=(0,a.r$)(e,{segmentationId:t,type:n});u.forEach(t=>{t.type===i.A.Labelmap?r.Ay.removeRepresentation(e,t.segmentationId,l):t.type===i.A.Contour?o.A.removeRepresentation(e,t.segmentationId,l):t.type===i.A.Surface&&c.Ay.removeRepresentation(e,t.segmentationId,l)});const{viewport:d}=(0,s.getEnabledElementByViewportId)(e)||{};d&&d.render()}(e,u,d,n),l._6.removeSegmentationRepresentations(e,{segmentationId:u,type:d})}function p(){l._6.getAllViewportSegmentationRepresentations().forEach(({viewportId:e,representations:t})=>{t.forEach(({segmentationId:t,type:n})=>{u(e,{segmentationId:t,type:n})})}),l._6.resetState()}function f(e,t,n){u(e,{segmentationId:t,type:i.A.Labelmap},n)}function m(e,t,n){u(e,{segmentationId:t,type:i.A.Contour},n)}function g(e,t,n){u(e,{segmentationId:t,type:i.A.Surface},n)}},70930:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getActiveSegmentIndex:()=>l.Q,setActiveSegmentIndex:()=>u});var i=n(7754),r=n(35706),o=n(33283),a=n(58859),s=n(26047),l=n(60740),c=n(93210);function u(e,t){const n=(0,o.T)(e);"string"==typeof t&&(console.warn("segmentIndex is a string, converting to number"),t=Number(t)),Object.values(n.segments).forEach(e=>{e.active=!1}),n.segments[t]||(n.segments[t]={segmentIndex:t,label:"",locked:!1,cachedStats:{},active:!1}),!0!==n.segments[t].active&&(n.segments[t].active=!0,(0,s.triggerSegmentationModified)(e));const l=(0,a.P)(e);l.forEach(n=>{(0,c.r$)(n,{segmentationId:e}).forEach(e=>{e.segments[t]||(e.segments[t]={visible:!0})})}),l.forEach(e=>{const t=(0,i.getToolGroupForViewport)(e);(0,r.E)(t.id)})}},26795:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getLockedSegmentIndices:()=>s,isSegmentIndexLocked:()=>o,setSegmentIndexLocked:()=>a});var i=n(33283),r=n(26047);function o(e,t){const n=(0,i.T)(e);if(!n)throw new Error(`No segmentation state found for ${e}`);const{segments:r}=n;return r[t].locked}function a(e,t,n=!0){const o=(0,i.T)(e);if(!o)throw new Error(`No segmentation state found for ${e}`);const{segments:a}=o;a[t].locked=n,(0,r.triggerSegmentationModified)(e)}function s(e){const t=(0,i.T)(e);if(!t)throw new Error(`No segmentation state found for ${e}`);const{segments:n}=t;return Object.keys(n).filter(e=>n[e].locked).map(e=>parseInt(e))}},98870:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addColorLUT:()=>l.u,addSegmentations:()=>o.d,destroy:()=>_,getColorLUT:()=>c.B,getCurrentLabelmapImageIdForViewport:()=>m.v,getNextColorLUTIndex:()=>u.u,getSegmentation:()=>i.T,getSegmentationRepresentation:()=>y.Ut,getSegmentationRepresentations:()=>y.r$,getSegmentationRepresentationsBySegmentationId:()=>y.ny,getSegmentations:()=>r.K,getStackSegmentationImageIdsForViewport:()=>v,getViewportIdsWithSegmentation:()=>f.P,getViewportSegmentations:()=>p.a,removeAllSegmentationRepresentations:()=>s.us,removeAllSegmentations:()=>a.j,removeColorLUT:()=>h,removeContourRepresentation:()=>s.OE,removeLabelmapRepresentation:()=>s.kN,removeSegmentation:()=>a.z,removeSegmentationRepresentation:()=>s.E8,removeSurfaceRepresentation:()=>s.JC,updateLabelmapSegmentationImageReferences:()=>g.t});var i=n(33283),r=n(70758),o=n(30935),a=n(63427),s=n(53662),l=n(4714),c=n(50409),u=n(70906),d=n(63457);function h(e){d._6.removeColorLUT(e)}var p=n(42568),f=n(58859),m=n(97577),g=n(78231);function v(e,t){return d._6.getStackSegmentationImageIdsForViewport(e,t)}var y=n(93210);function _(){d._6.resetState()}},26047:(e,t,n)=>{"use strict";n.d(t,{triggerSegmentationDataModified:()=>i.Q,triggerSegmentationModified:()=>a,triggerSegmentationRemoved:()=>s,triggerSegmentationRepresentationModified:()=>l,triggerSegmentationRepresentationRemoved:()=>c});var i=n(98798),r=n(15327),o=n(99737);function a(e){const t={segmentationId:e};(0,r.triggerEvent)(r.eventTarget,o.Events.SEGMENTATION_MODIFIED,t)}function s(e){const t={segmentationId:e};(0,r.triggerEvent)(r.eventTarget,o.Events.SEGMENTATION_REMOVED,t)}function l(e,t,n){const i={segmentationId:t,type:n,viewportId:e};(0,r.triggerEvent)(r.eventTarget,o.Events.SEGMENTATION_REPRESENTATION_ADDED,i)}function c(e,t,n){const i={viewportId:e,segmentationId:t,type:n};(0,r.triggerEvent)(r.eventTarget,o.Events.SEGMENTATION_REPRESENTATION_REMOVED,i)}},78231:(e,t,n)=>{"use strict";n.d(t,{t:()=>r});var i=n(63457);function r(e,t){return i._6.updateLabelmapSegmentationImageReferences(e,t)}},65136:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(15327),r=n(85204);const o=function(e,t){t||(t=(0,i.getRenderingEngines)().find(t=>t.getViewports().find(t=>t.id===e))?.id);const n=r.wk.toolGroups.filter(n=>n.viewportsInfo.some(n=>n.renderingEngineId===t&&(!n.viewportId||n.viewportId===e)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${t} and viewportId: ${e}. You should only\n      have one tool group per viewport in a renderingEngine.`);return n[0]}}},7754:(e,t,n)=>{"use strict";n.d(t,{getToolGroup:()=>o,getToolGroupForViewport:()=>u.A,getToolGroupsWithToolName:()=>h});var i=n(85204),r=n(99737);n(93008),n(15327),n(79475),n(7001);const o=function(e){return i.wk.toolGroups.find(t=>t.id===e)},{Active:a,Passive:s,Enabled:l,Disabled:c}=r.ToolModes;r.MouseBindings.Primary;var u=n(65136);const d=[r.ToolModes.Active,r.ToolModes.Passive,r.ToolModes.Enabled];const h=function(e){return i.wk.toolGroups.filter(({toolOptions:t})=>{const n=Object.keys(t);for(let i=0;i<n.length;i++)if(e===n[i]&&t[e]&&d.includes(t[e].mode))return!0;return!1})}},68040:(e,t,n)=>{"use strict";n.d(t,{Gx:()=>r});var i=n(85204);function r(e){const t=e.toolName;i.wk.tools[t];if(!t)throw new Error(`No Tool Found for the ToolClass ${e.name}`);i.wk.tools[t]={toolClass:e}}},85204:(e,t,n)=>{"use strict";n.d(t,{wk:()=>r});var i=n(48145);i.A;let r={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:i.A,enabledElements:[],handleRadius:6}},48145:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let i={};const r=i},25072:(e,t,n)=>{"use strict";n.d(t,{A:()=>x});var i=n(3823),r=n(15327),o=n(4096),a=n(85817),s=n(27730),l=n(77840),c=n(2076),u=n(29601),d=n(44049),h=n(40203),p=n(85204),f=n(99737),m=n(8056),g=n(93258),v=n(66990),y=n(7001),_=n(58640);const{transformWorldToIndex:w}=r.utilities;class E extends a.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:b}}){super(e,t),this.isPointNearTool=(e,t,n,i)=>{const o=(0,r.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles;let c=a.worldToCanvas(l[0]),u=a.worldToCanvas(l[1]),d={start:{x:c[0],y:c[1]},end:{x:u[0],y:u[1]}},h=g.distanceToPoint([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]]);return h<=i||(c=a.worldToCanvas(l[2]),u=a.worldToCanvas(l[3]),d={start:{x:c[0],y:c[1]},end:{x:u[0],y:u[1]}},h=g.distanceToPoint([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]]),h<=i)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0;const o=(0,m.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(i);const a=(0,r.getEnabledElement)(i),{renderingEngine:s}=a;(0,_.A)(o),(0,y.hideElementCursor)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const i=e.detail,{element:o}=i,a=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());(0,y.hideElementCursor)(o),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o);const u=(0,r.getEnabledElement)(o),{renderingEngine:d}=u;(0,_.A)(c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:s,hasMoved:c}=this.editData,{data:u}=o;if(s&&!c)return;u.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,y.resetElementCursor)(n);const{renderingEngine:h}=(0,r.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=u.handles,t=i.eR.distance(e[0],e[1]);if(i.eR.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],r=[...e[1]],o=i.Zc.create();i.Zc.set(o,t[1][0]-t[0][0],t[1][1]-t[1][0]);const a=i.Zc.create();i.Zc.set(a,-o[1],o[0]);const s=i.Zc.create();let l;i.Zc.set(s,r[0]-n[0],r[1]-n[0]),l=i.Zc.dot(s,a)>0?[n,r]:[r,n],u.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(o.annotationUID),(0,_.A)(a),s&&(0,d.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:o}=t,a=(0,r.getEnabledElement)(o),{renderingEngine:s,viewport:l}=a,{worldToCanvas:c}=l,{annotation:u,viewportIdsToRender:d,handleIndex:h}=this.editData,{data:p}=u,f=n.world;p.handles.points[h]=[...f];const m=p.handles.points.map(c),g={start:{x:m[0][0],y:m[0][1]},end:{x:m[1][0],y:m[1][1]}},v=(m[2][0],m[2][1],m[3][0],m[3][1],i.Zc.distance(m[0],m[1])/3),y=g.start.x-g.end.x,w=g.start.y-g.end.y,E=Math.sqrt(y*y+w*w),b=y/E,x=w/E,C=(g.start.x+g.end.x)/2,I=(g.start.y+g.end.y)/2,S=C+v*x,D=I-v*b,A=C-v*x,T=I+v*b;p.handles.points[2]=l.canvasToWorld([S,D]),p.handles.points[3]=l.canvasToWorld([A,T]),u.invalidated=!0,(0,_.A)(d),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,i=(0,r.getEnabledElement)(n),{renderingEngine:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:l,movingTextBox:c}=this.editData,{data:u}=a;if(c){const{deltaPoints:e}=t,n=e.world,{textBox:i}=u.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===l){const{deltaPoints:e}=t,n=e.world;u.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),a.invalidated=!0}else this._dragModifyHandle(e),a.invalidated=!0;(0,_.A)(s)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=(0,r.getEnabledElement)(o),{viewport:s}=a,{annotation:l,handleIndex:c}=this.editData,{data:u}=l,d=n.world,h=[s.worldToCanvas(u.handles.points[0]),s.worldToCanvas(u.handles.points[1]),s.worldToCanvas(u.handles.points[2]),s.worldToCanvas(u.handles.points[3])],p={start:{x:h[0][0],y:h[0][1]},end:{x:h[1][0],y:h[1][1]}},f={start:{x:h[2][0],y:h[2][1]},end:{x:h[3][0],y:h[3][1]}},m=[...d],v=s.worldToCanvas(m);if(0===c||1===c){const e=h[0===c?1:0],t=i.Zc.set(i.Zc.create(),v[0]-e[0],v[1]-e[1]),n=i.Zc.set(i.Zc.create(),h[c][0]-e[0],h[c][1]-e[1]);i.Zc.normalize(t,t),i.Zc.normalize(n,n);const r={start:{x:e[0],y:e[1]},end:{x:v[0],y:v[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(r,f))return;const o=e,a=this._getSignedAngle(n,t);let l=h[2][0],d=h[2][1],p=h[3][0],g=h[3][1];l-=o[0],d-=o[1],p-=o[0],g-=o[1];const y=l*Math.cos(a)-d*Math.sin(a),_=l*Math.sin(a)+d*Math.cos(a),w=p*Math.cos(a)-g*Math.sin(a),E=p*Math.sin(a)+g*Math.cos(a);l=y+o[0],d=_+o[1],p=w+o[0],g=E+o[1];const b=s.canvasToWorld([l,d]),x=s.canvasToWorld([p,g]);u.handles.points[c]=m,u.handles.points[2]=b,u.handles.points[3]=x}else{const e=2===c?3:2,t={longLineSegment:{start:p.start,end:p.end},shortLineSegment:{start:f.start,end:f.end}},n=i.Zc.subtract(i.Zc.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),r=i.Zc.normalize(i.Zc.create(),n),o=i.Zc.subtract(i.Zc.create(),[v[0],v[1]],[h[c][0],h[c][1]]),a=i.Zc.length(o),l=this._getSignedAngle(r,o),d=Math.cos(l)*a,y=i.Zc.scaleAndAdd(i.Zc.create(),[h[e][0],h[e][1]],r,d);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:v[0],y:v[1]},end:{x:y[0],y:y[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!g.intersectLine([v[0],v[1]],[y[0],y[1]],[p.start.x,p.start.y],[p.end.x,p.end.y]))return;u.handles.points[e]=s.canvasToWorld(y),u.handles.points[c]=m}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,y.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,_.A)(n),i&&(0,d.dZ)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{p.wk.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{p.wk.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{p.wk.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{p.wk.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:i}=e,{element:r}=i;let o=(0,l.getAnnotations)(this.getToolName(),r);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(r,o),!o?.length)return n;const a=this.getTargetId(i),s=i.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<o.length;r++){const l=o[r],{annotationUID:p,data:f}=l,{points:m,activeHandleIndex:g}=f.handles,y=m.map(e=>i.worldToCanvas(e));d.annotationUID=p;const{color:_,lineWidth:w,lineDash:E,shadow:b}=this.getAnnotationStyle({annotation:l,styleSpecifier:d});if(f.cachedStats[a]&&null!=f.cachedStats[a].unit?l.invalidated&&this._throttledCalculateCachedStats(l,s,e):(f.cachedStats[a]={length:null,width:null,unit:null},this._calculateCachedStats(l,s,e)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let x;if(!(0,u.isAnnotationVisible)(p))continue;if((0,c.isAnnotationLocked)(p)||this.editData||null===g||(x=[y[g]]),x){const e="0";(0,h.drawHandles)(t,p,e,x,{color:_})}const C=`${p}-line-1`,I=`${p}-line-2`,S="0";(0,h.drawLine)(t,p,S,y[0],y[1],{color:_,lineDash:E,lineWidth:w,shadow:b},C);const D="1";(0,h.drawLine)(t,p,D,y[2],y[3],{color:_,lineDash:E,lineWidth:w,shadow:b},I),n=!0;const A=this.getLinkedTextBoxStyle(d,l);if(!A.visibility){f.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const T=this.configuration.getTextLines(f,a);if(!T||0===T.length)continue;let N;f.handles.textBox.hasMoved||(N=(0,v.getTextBoxCoordsCanvas)(y),f.handles.textBox.worldPosition=i.canvasToWorld(N));const O=i.worldToCanvas(f.handles.textBox.worldPosition),P="1",M=(0,h.drawLinkedTextBox)(t,p,P,T,O,y,{},A),{x:k,y:R,width:L,height:F}=M;f.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([k,R]),topRight:i.canvasToWorld([k+L,R]),bottomLeft:i.canvasToWorld([k,R+F]),bottomRight:i.canvasToWorld([k+L,R+F])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=i.Zc.create();i.Zc.set(n,t.end.x-t.start.x,t.end.y-t.start.y),i.Zc.normalize(n,n);const r={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!g.intersectLine([r.start.x,r.start.y],[r.end.x,r.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:i}=e,{element:r}=n.viewport,a=i.handles.points[0],s=i.handles.points[1],l=i.handles.points[2],c=i.handles.points[3],{cachedStats:u}=i,h=Object.keys(u);for(let e=0;e<h.length;e++){const t=h[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:i,dimensions:r}=n,d=w(i,a),p=w(i,s),f=w(i,l),m=w(i,c),g=[d,p],v=[f,m],{scale:y,unit:_}=(0,o.Op)(n,g),{scale:E,unit:b}=(0,o.Op)(n,v),x=this._calculateLength(a,s)/y,C=this._calculateLength(l,c)/E,I=x>C?x:C,S=x>C?C:x,D=x>C?_:b,A=x>C?b:_;this._isInsideVolume(d,p,f,m,r)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,u[t]={length:I,width:S,unit:D,widthUnit:A}}return e.invalidated=!1,(0,d.XF)(e,r),u},this._isInsideVolume=(e,t,n,i,o)=>r.utilities.indexWithinDimensions(e,o)&&r.utilities.indexWithinDimensions(t,o)&&r.utilities.indexWithinDimensions(n,o)&&r.utilities.indexWithinDimensions(i,o),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,s.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,a=(0,r.getEnabledElement)(i),{viewport:s,renderingEngine:c}=a;this.isDrawing=!0;const u=s.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(s,o,d,h),f=s.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f,referencedImageId:p,...s.getViewReference({points:[o]})},data:{handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,l.addAnnotation)(g,i);const v=(0,m.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),(0,y.hideElementCursor)(i),e.preventDefault(),(0,_.A)(v),g}_calculateLength(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)}}function b(e,t){const{cachedStats:n,label:i}=e,{length:o,width:a,unit:s}=n[t],l=[];return i&&l.push(i),void 0===o||l.push(`L: ${r.utilities.roundNumber(o)} ${s||s}`,`W: ${r.utilities.roundNumber(a)} ${s}`),l}E.toolName="Bidirectional";const x=E},37590:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(15327),r=n(26047),o=n(26595);class a extends o.A{constructor(e){super(i.utilities.deepMerge({configuration:{calculateStats:!1,allowOpenContours:!1}},e))}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const t=e.annotation,{invalidated:n}=t,i=super.renderAnnotationInstance(e);if(n){const{segmentationId:e}=t.data.segmentation;(0,r.triggerSegmentationDataModified)(e)}return i}}a.toolName="PlanarFreehandContourSegmentationTool";const s=a},26595:(e,t,n)=>{"use strict";n.d(t,{A:()=>Ze});var i=n(15327),r=n(3823),o=n(4096),a=n(51440),s=n(13165),l=n(27730),c=n(8056),u=n(58640),d=n(7001),h=n(99737),p=n(85204),f=n(27062);function m(e,t){if(t?.autoGenerated)return!1;return!0===e?.smoothing?.smoothOnAdd||!0===e?.smoothing?.smoothOnEdit}function g(e,t){return 0===a.point.distanceToPoint(e,t)}function v(e,t,n){return(e+t+n)%t}function y(e,t,n,i){const[,r,o]=e,[,a,s]=t,l=o.length,c=s.length;let u=e[0],d=t[0];if(!(o[u]&&s[d]&&o[r]&&s[a]))return[void 0,void 0];for(;u!==r&&d!==a;){if(n(s[d],o[u]))return[u,d];u=v(u,l,i),d=v(d,c,i)}return[void 0,void 0]}function _(e,t){const[n,i]=function(e,t){for(let n=0;n<e.length;n++)for(let i=0;i<t.length;i++)if(g(e[n],t[i]))return[n,i]}(e,t)||[],r=(e,t)=>!1===function(e,t){return a.point.distanceToPoint(e,t)<.001}(e,t),[o,s]=y([v(n,e.length,1),n,e],[v(i,t.length,1),i,t],r,1),[l]=y([v(o,e.length,-1),o,e],[v(s,t.length,-1),s,t],r,-1);return[o,l]}function w(e,t,n){const{interpolation:i,smoothing:r}=e,o=t;if(i){const{knotsRatioPercentageOnAdd:e,knotsRatioPercentageOnEdit:i,smoothOnAdd:o=!1,smoothOnEdit:a=!1}=r,s=n?i:e;if(n?a:o){const[e,i]=n?_(t,n):[0,t.length-1];return t[e]&&t[i]?(0,f.A)(t,e,i,s):t}}return o}var E=n(76910),b=n(44049);function x(e,t){const n=e[0],i=e[e.length-1],o=r.Zc.create();r.Zc.set(o,i[0]-n[0],i[1]-n[1]),r.Zc.normalize(o,o);const a=r.Zc.create(),s=r.Zc.create();r.Zc.set(a,-o[1],o[0]),r.Zc.set(s,o[1],-o[0]);const l=[(n[0]+i[0])/2,(n[1]+i[1])/2],c={dist:0,index:null};for(let t=0;t<e.length;t++){const n=e[t],i=r.Zc.dist(n,l);i>c.dist&&(c.dist=i,c.index=t)}return[e[c.index],l].map(t.canvasToWorld)}var C=n(77840),I=n(93126);const{addCanvasPointsToArray:S,pointsAreWithinCloseContourProximity:D,getFirstLineSegmentIntersectionIndexes:A,getSubPixelSpacingAndXYDirections:T}=a.polyline;function N(e,t,n){this.isDrawing=!0;const r=e.detail,{currentPoints:o,element:a}=r,s=o.canvas,l=(0,i.getEnabledElement)(a),{viewport:c}=l,u=(0,E.A)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:f,xDir:m,yDir:g}=T(c,this.configuration.subPixelResolution);this.drawData={canvasPoints:[s],polylineIndex:0,contourHoleProcessingEnabled:u},this.commonData={annotation:t,viewportIdsToRender:n,spacing:f,xDir:m,yDir:g,movingTextBox:!1},p.wk.isInteractingWithTool=!0,a.addEventListener(h.Events.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(h.Events.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(h.Events.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(h.Events.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(h.Events.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(h.Events.TOUCH_TAP,this.mouseUpDrawCallback),(0,d.hideElementCursor)(a)}function O(e){p.wk.isInteractingWithTool=!1,e.removeEventListener(h.Events.MOUSE_UP,this.mouseUpDrawCallback),e.removeEventListener(h.Events.MOUSE_DRAG,this.mouseDragDrawCallback),e.removeEventListener(h.Events.MOUSE_CLICK,this.mouseUpDrawCallback),e.removeEventListener(h.Events.TOUCH_END,this.mouseUpDrawCallback),e.removeEventListener(h.Events.TOUCH_DRAG,this.mouseDragDrawCallback),e.removeEventListener(h.Events.TOUCH_TAP,this.mouseUpDrawCallback),(0,d.resetElementCursor)(e)}function P(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=n.canvas,l=(0,i.getEnabledElement)(o),{renderingEngine:c,viewport:d}=l,{annotation:h,viewportIdsToRender:p,xDir:f,yDir:m,spacing:g,movingTextBox:v}=this.commonData,{polylineIndex:y,canvasPoints:_}=this.drawData,w=_[_.length-1],E=d.canvasToWorld(w),b=r.eR.create();r.eR.subtract(b,a,E);const x=Math.abs(r.eR.dot(b,f)),C=Math.abs(r.eR.dot(b,m));if(!(x<=g[0]&&C<=g[1])){if(v){this.isDrawing=!1;const{deltaPoints:e}=t,n=e.world,{textBox:i}=h.data.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else{const t=this.findCrossingIndexDuringCreate(e);if(void 0!==t)this.applyCreateOnCross(e,t);else{const e=S(o,_,s,this.commonData);this.drawData.polylineIndex=y+e}}(0,u.A)(p)}}function M(e){const{allowOpenContours:t}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:i}=this.drawData,r=n[0],o=n[n.length-1],a=e.detail,{element:s}=a;t&&!D(r,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:i}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:i})}function k(e,t){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r,minPointsToSave:o}=t??{};if(o&&n.length<o)return!1;if(this.haltDrawing(e,n))return!1;const{annotation:a,viewportIdsToRender:s}=this.commonData,l=(0,i.getEnabledElement)(e),{viewport:c,renderingEngine:d}=l;S(e,n,n[0],this.commonData),n.pop();const h=m(this.configuration,a)?w(this.configuration,n):n;this.updateContourPolyline(a,{points:h,closed:!0,targetWindingDirection:I.W.Clockwise},c);const{textBox:p}=a.data.handles;return p?.hasMoved||(0,b.PS)(a,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,(0,u.A)(s),this.deactivateDraw(e),!0}function R(){const{canvasPoints:e}=this.drawData,t=e.length,n=[e[0],e[t-1]],i=e.slice(0,-1).slice(1),r=A(i,n[0],n[1],!1);if(r){const t=r[1];this.drawData.canvasPoints=1===t?e.splice(1):e.splice(0,t)}}function L(e,t){const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r}=t??{};if(this.haltDrawing(e,n))return!1;const{annotation:o,viewportIdsToRender:a}=this.commonData,s=(0,i.getEnabledElement)(e),{viewport:l,renderingEngine:c}=s,d=m(this.configuration,o)?w(this.configuration,n):n;this.updateContourPolyline(o,{points:d,closed:!1},l);const{textBox:h}=o.data.handles,p=o.data.contour.polyline;return o.data.handles.points=[p[0],p[p.length-1]],o.data.isOpenUShapeContour&&(o.data.openUShapeContourVectorToPeak=x(n,l)),h.hasMoved||(0,b.PS)(o,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,(0,u.A)(a),this.deactivateDraw(e),!0}function F(e){const t=e.detail,{currentPoints:n,lastPoints:i}=t,r=n.canvas,o=i.canvas,{canvasPoints:a}=this.drawData,s=a.slice(0,-1),l=A(s,r,o,!1);if(void 0===l)return;return l[0]}function U(e,t){const n=e.detail,{element:r}=n,{canvasPoints:o,contourHoleProcessingEnabled:s}=this.drawData,{annotation:l,viewportIdsToRender:c}=this.commonData;S(r,o,o[t],this.commonData),o.pop();const u=o.slice(t),d=a.polyline.getArea(u);if(i.utilities.isEqual(d,0))return void o.splice(t+1);o.splice(0,t);const h={contourHoleProcessingEnabled:s,minPointsToSave:3};this.completeDrawClosedContour(r,h)&&this.activateClosedContourEdit(e,l,c)}function B(e){const{allowOpenContours:t}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:i}=this.drawData,r=n[0],o=n[n.length-1];t&&!D(r,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(e,{contourHoleProcessingEnabled:i}):this.completeDrawClosedContour(e,{contourHoleProcessingEnabled:i})}function V(e,t){const{subPixelResolution:n}=this.configuration;if(function(e,t){const n=Math.max(3*t,3);return e.length<n}(t,n)){const{annotation:t,viewportIdsToRender:n}=this.commonData,r=(0,i.getEnabledElement)(e),{renderingEngine:o}=r;return(0,C.removeAnnotation)(t.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,(0,u.A)(n),this.deactivateDraw(e),!0}return!1}const W=function(e){e.activateDraw=N.bind(e),e.deactivateDraw=O.bind(e),e.applyCreateOnCross=U.bind(e),e.findCrossingIndexDuringCreate=F.bind(e),e.completeDrawOpenContour=L.bind(e),e.removeCrossedLinesOnCompleteDraw=R.bind(e),e.mouseDragDrawCallback=P.bind(e),e.mouseUpDrawCallback=M.bind(e),e.completeDrawClosedContour=k.bind(e),e.cancelDrawing=B.bind(e),e.haltDrawing=V.bind(e)},{addCanvasPointsToArray:j,getFirstLineSegmentIntersectionIndexes:H}=a.polyline;function z(e,t){const n=e.detail,{element:i,currentPoints:o,lastPoints:a}=n,s=o.canvas,l=a.canvas,{editCanvasPoints:c,prevCanvasPoints:u}=this.editData,d=H(u,s,l,t);if(d)this.editData.startCrossingIndex=d[0],this.removePointsUpUntilFirstCrossing(t);else if(u.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const e=c[0],t=[];for(let n=0;n<u.length;n++){const i=u[n],o=r.Zc.distance(i,e);t.push({distance:o,index:n})}t.sort((e,t)=>e.distance-t.distance);const n=[t[0],t[1]],i=Math.min(n[0].index,n[1].index);this.editData.startCrossingIndex=i}else{const e=r.Zc.create();r.Zc.subtract(e,c[1],c[0]),r.Zc.normalize(e,e);const n=6,o=[c[0][0]-e[0]*n,c[0][1]-e[1]*n],a=H(u,o,c[0],t);if(a){const e=[o];j(i,e,c[0],this.commonData),c.unshift(...e),this.removePointsUpUntilFirstCrossing(t),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=a[0]}}}function G(e){const{editCanvasPoints:t,prevCanvasPoints:n}=this.editData;let i=0;for(let r=0;r<t.length-1;r++){const o=[t[r],t[r+1]];if(i++,!!H(n,o[0],o[1],e))break}t.splice(0,i),this.editData.editIndex=t.length-1}function q(e,t){const n=e.detail,{currentPoints:i,lastPoints:r}=n,o=i.canvas,a=r.canvas,{prevCanvasPoints:s}=this.editData;return!!H(s,o,a,t)}function $(e){const{prevCanvasPoints:t,editCanvasPoints:n}=this.editData;for(let i=n.length-1;i>0;i--){const r=[n[i],n[i-1]],o=!!H(t,r[0],r[1],e);if(n.pop(),o)break}}function X(){const{editCanvasPoints:e,prevCanvasPoints:t,startCrossingIndex:n}=this.editData;if(void 0===n)return;const i=e[e.length-1],o=[];for(let e=0;e<t.length;e++){const n=t[e],a=r.Zc.distance(n,i);o.push({distance:a,index:e})}o.sort((e,t)=>e.distance-t.distance);const a=e.slice(0,-1);for(let n=0;n<o.length;n++){const{index:i}=o[n],r=t[i],s=e[e.length-1];if(!H(a,r,s,!1))return i}return-1}function K(e){const t=e.detail,{currentPoints:n,lastPoints:i}=t,r=n.canvas,o=i.canvas,{editCanvasPoints:a}=this.editData,s=a.slice(0,-2),l=H(s,r,o,!1);if(!l)return;const c=l[0],u=a.length-c;for(let e=0;e<u;e++)a.pop()}const Y=function(e){e.checkForFirstCrossing=z.bind(e),e.removePointsUpUntilFirstCrossing=G.bind(e),e.checkForSecondCrossing=q.bind(e),e.findSnapIndex=X.bind(e),e.removePointsAfterSecondCrossing=$.bind(e),e.checkAndRemoveCrossesOnEditLine=K.bind(e)};var J=n(72967);const{getSubPixelSpacingAndXYDirections:Z,addCanvasPointsToArray:Q,getArea:ee}=a.polyline;function te(e,t,n){this.isEditingClosed=!0;const r=e.detail,{currentPoints:o,element:a}=r,s=o.canvas,l=(0,i.getEnabledElement)(a);if(!l)return;const{viewport:c}=l,u=t.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:m,yDir:g}=Z(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:u,editCanvasPoints:[s],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:f,xDir:m,yDir:g,movingTextBox:!1},p.wk.isInteractingWithTool=!0,a.addEventListener(h.Events.MOUSE_UP,this.mouseUpClosedContourEditCallback),a.addEventListener(h.Events.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(h.Events.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),a.addEventListener(h.Events.TOUCH_END,this.mouseUpClosedContourEditCallback),a.addEventListener(h.Events.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(h.Events.TOUCH_TAP,this.mouseUpClosedContourEditCallback),(0,d.hideElementCursor)(a)}function ne(e){p.wk.isInteractingWithTool=!1,e.removeEventListener(h.Events.MOUSE_UP,this.mouseUpClosedContourEditCallback),e.removeEventListener(h.Events.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),e.removeEventListener(h.Events.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),e.removeEventListener(h.Events.TOUCH_END,this.mouseUpClosedContourEditCallback),e.removeEventListener(h.Events.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),e.removeEventListener(h.Events.TOUCH_TAP,this.mouseUpClosedContourEditCallback),(0,d.resetElementCursor)(e)}function ie(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=n.canvas,l=(0,i.getEnabledElement)(o),{renderingEngine:c,viewport:d}=l,{viewportIdsToRender:h,xDir:p,yDir:f,spacing:m}=this.commonData,{editIndex:g,editCanvasPoints:v,startCrossingIndex:y}=this.editData,_=v[v.length-1],w=d.canvasToWorld(_),E=r.eR.create();r.eR.subtract(E,a,w);const b=Math.abs(r.eR.dot(E,p)),x=Math.abs(r.eR.dot(E,f));if(b<=m[0]&&x<=m[1])return;void 0!==y&&this.checkAndRemoveCrossesOnEditLine(e);const C=g+Q(o,v,s,this.commonData);this.editData.editIndex=C,void 0===y&&v.length>1&&this.checkForFirstCrossing(e,!0),this.editData.snapIndex=this.findSnapIndex(),-1!==this.editData.snapIndex?(this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(e),void 0!==y&&this.checkForSecondCrossing(e,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(e)),(0,u.A)(h)):this.finishEditAndStartNewEdit(e)}function re(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o,renderingEngine:a}=r,{annotation:s,viewportIdsToRender:l}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:d}=this.editData;(0,J.A)(s,{points:c,closed:!0,targetWindingDirection:I.W.Clockwise},o),s.autoGenerated&&(s.autoGenerated=!1),(0,b.XF)(s,n);const h=d.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[h],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0},(0,u.A)(l)}function oe(e){const{prevCanvasPoints:t,editCanvasPoints:n,startCrossingIndex:i,snapIndex:o}=this.editData;if(void 0===i||void 0===o)return;const a=e.detail,{element:s}=a,l=[...n];let c,u;Q(s,l,t[o],this.commonData),l.length>n.length&&l.pop(),i>o?(c=o,u=i):(c=i,u=o);const d=r.Zc.distance(t[c],l[0]),h=r.Zc.distance(t[c],l[l.length-1]),p=r.Zc.distance(t[u],l[0]),f=r.Zc.distance(t[u],l[l.length-1]),m=[];for(let e=0;e<c;e++){const n=t[e];m.push([n[0],n[1]])}let g=d+f,v=h+p;if(g<v)for(let e=0;e<l.length;e++){const t=l[e];m.push([t[0],t[1]])}else for(let e=l.length-1;e>=0;e--){const t=l[e];m.push([t[0],t[1]])}for(let e=u;e<t.length;e++){const n=t[e];m.push([n[0],n[1]])}const y=[];for(let e=c;e<u;e++){const n=t[e];y.push([n[0],n[1]])}if(g=p+h,v=f+d,g<v)for(let e=0;e<l.length;e++){const t=l[e];y.push([t[0],t[1]])}else for(let e=l.length-1;e>=0;e--){const t=l[e];y.push([t[0],t[1]])}return ee(m)>ee(y)?m:y}function ae(e){const t=e.detail,{element:n}=t;this.completeClosedContourEdit(n)}function se(e){const t=(0,i.getEnabledElement)(e),{viewport:n,renderingEngine:r}=t,{annotation:o,viewportIdsToRender:a}=this.commonData,{fusedCanvasPoints:s,prevCanvasPoints:l}=this.editData;if(s){const t=m(this.configuration,o)?w(this.configuration,s,l):s,i=this.configuration?.decimate||{};(0,J.A)(o,{points:t,closed:!0,targetWindingDirection:I.W.Clockwise},n,{decimate:{enabled:!!i.enabled,epsilon:i.epsilon}}),o.autoGenerated&&(o.autoGenerated=!1),(0,b.XF)(o,e)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,(0,u.A)(a),this.deactivateClosedContourEdit(e)}function le(e){this.completeClosedContourEdit(e)}const ce=function(e){e.activateClosedContourEdit=te.bind(e),e.deactivateClosedContourEdit=ne.bind(e),e.mouseDragClosedContourEditCallback=ie.bind(e),e.mouseUpClosedContourEditCallback=ae.bind(e),e.finishEditAndStartNewEdit=re.bind(e),e.fuseEditPointsWithClosedContour=oe.bind(e),e.cancelClosedContourEdit=le.bind(e),e.completeClosedContourEdit=se.bind(e)},{addCanvasPointsToArray:ue,getSubPixelSpacingAndXYDirections:de}=a.polyline;function he(e,t,n){this.isEditingOpen=!0;const r=e.detail,{currentPoints:o,element:a}=r,s=o.canvas,l=(0,i.getEnabledElement)(a),{viewport:c}=l,u=t.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:m,yDir:g}=de(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:u,editCanvasPoints:[s],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:f,xDir:m,yDir:g,movingTextBox:!1},p.wk.isInteractingWithTool=!0,a.addEventListener(h.Events.MOUSE_UP,this.mouseUpOpenContourEditCallback),a.addEventListener(h.Events.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(h.Events.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),a.addEventListener(h.Events.TOUCH_END,this.mouseUpOpenContourEditCallback),a.addEventListener(h.Events.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(h.Events.TOUCH_TAP,this.mouseUpOpenContourEditCallback),(0,d.hideElementCursor)(a)}function pe(e){p.wk.isInteractingWithTool=!1,e.removeEventListener(h.Events.MOUSE_UP,this.mouseUpOpenContourEditCallback),e.removeEventListener(h.Events.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),e.removeEventListener(h.Events.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),e.removeEventListener(h.Events.TOUCH_END,this.mouseUpOpenContourEditCallback),e.removeEventListener(h.Events.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),e.removeEventListener(h.Events.TOUCH_TAP,this.mouseUpOpenContourEditCallback),(0,d.resetElementCursor)(e)}function fe(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=n.canvas,l=(0,i.getEnabledElement)(o),{renderingEngine:c,viewport:d}=l,{viewportIdsToRender:h,xDir:p,yDir:f,spacing:m}=this.commonData,{editIndex:g,editCanvasPoints:v,startCrossingIndex:y}=this.editData,_=v[v.length-1],w=d.canvasToWorld(_),E=r.eR.create();r.eR.subtract(E,a,w);const b=Math.abs(r.eR.dot(E,p)),x=Math.abs(r.eR.dot(E,f));if(b<=m[0]&&x<=m[1])return;void 0!==y&&this.checkAndRemoveCrossesOnEditLine(e);const C=g+ue(o,v,s,this.commonData);this.editData.editIndex=C,void 0===y&&v.length>1&&this.checkForFirstCrossing(e,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(e),void 0!==y&&this.checkForSecondCrossing(e,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(e)):this.checkIfShouldOverwriteAnEnd(e)&&this.openContourEditOverwriteEnd(e),(0,u.A)(h)}function me(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o}=r,{annotation:a,viewportIdsToRender:s}=this.commonData,l=this.fuseEditPointsForOpenContourEndEdit();(0,J.A)(a,{points:l,closed:!1},o);const c=a.data.contour.polyline;a.data.handles.points=[c[0],c[c.length-1]],a.data.handles.activeHandleIndex=1,(0,b.XF)(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.deactivateOpenContourEdit(n),this.activateOpenContourEndEdit(e,a,s,null)}function ge(e){const t=e.detail,{currentPoints:n,lastPoints:i}=t,o=n.canvas,a=i.canvas,{snapIndex:s,prevCanvasPoints:l,startCrossingIndex:c}=this.editData;if(void 0===c||void 0===s)return!1;if(-1===s)return!0;if(0!==s&&s!==l.length-1)return!1;const u=o,d=a,h=l[s],p=r.Zc.create(),f=r.Zc.create();r.Zc.set(p,u[0]-d[0],u[1]-d[1]),r.Zc.set(f,u[0]-h[0],u[1]-h[1]);const m=r.Zc.dot(p,f),g=Math.sqrt(p[0]*p[0]+p[1]*p[1]),v=Math.sqrt(f[0]*f[0]+f[1]*f[1]);return Math.acos(m/(g*v))<Math.PI/2}function ve(){const{snapIndex:e,prevCanvasPoints:t,editCanvasPoints:n,startCrossingIndex:i}=this.editData,o=[];if(0===e)for(let e=t.length-1;e>=i;e--){const n=t[e];o.push([n[0],n[1]])}else for(let e=0;e<i;e++){const n=t[e];o.push([n[0],n[1]])}if(r.Zc.distance(t[i],n[0])<r.Zc.distance(t[i],n[n.length-1]))for(let e=0;e<n.length;e++){const t=n[e];o.push([t[0],t[1]])}else for(let e=n.length-1;e>=0;e--){const t=n[e];o.push([t[0],t[1]])}return o}function ye(e){const{prevCanvasPoints:t,editCanvasPoints:n,startCrossingIndex:i,snapIndex:o}=this.editData;if(void 0===i||void 0===o)return;const a=e.detail,{element:s}=a,l=[...n];let c,u;ue(s,l,t[o],this.commonData),l.length>n.length&&l.pop(),i>o?(c=o,u=i):(c=i,u=o);const d=r.Zc.distance(t[c],l[0]),h=r.Zc.distance(t[c],l[l.length-1]),p=r.Zc.distance(t[u],l[0]),f=r.Zc.distance(t[u],l[l.length-1]),m=[];for(let e=0;e<c;e++){const n=t[e];m.push([n[0],n[1]])}if(d+f<h+p)for(let e=0;e<l.length;e++){const t=l[e];m.push([t[0],t[1]])}else for(let e=l.length-1;e>=0;e--){const t=l[e];m.push([t[0],t[1]])}for(let e=u;e<t.length;e++){const n=t[e];m.push([n[0],n[1]])}return m}function _e(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o,renderingEngine:a}=r,{annotation:s,viewportIdsToRender:l}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:d}=this.editData;(0,J.A)(s,{points:c,closed:!1},o);const h=s.data.contour.polyline;s.data.handles.points=[h[0],h[h.length-1]],(0,b.XF)(s,n);const p=d.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[p],startCrossingIndex:void 0,editIndex:0},(0,u.A)(l)}function we(e){const t=e.detail,{element:n}=t;this.completeOpenContourEdit(n)}function Ee(e){const t=(0,i.getEnabledElement)(e),{viewport:n,renderingEngine:r}=t,{annotation:o,viewportIdsToRender:a}=this.commonData,{fusedCanvasPoints:s,prevCanvasPoints:l}=this.editData;if(s){const t=m(this.configuration)?w(this.configuration,s,l):s,i=this.configuration?.decimate||{};(0,J.A)(o,{points:t,closed:!1},n,{decimate:{enabled:!!i.enabled,epsilon:i.epsilon}});const r=o.data.contour.polyline;o.data.handles.points=[r[0],r[r.length-1]],o.data.isOpenUShapeContour&&(o.data.openUShapeContourVectorToPeak=x(s,n)),(0,b.XF)(o,e)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,(0,u.A)(a),this.deactivateOpenContourEdit(e)}function be(e){this.completeOpenContourEdit(e)}const xe=function(e){e.activateOpenContourEdit=he.bind(e),e.deactivateOpenContourEdit=pe.bind(e),e.mouseDragOpenContourEditCallback=fe.bind(e),e.mouseUpOpenContourEditCallback=we.bind(e),e.fuseEditPointsWithOpenContour=ye.bind(e),e.finishEditOpenOnSecondCrossing=_e.bind(e),e.checkIfShouldOverwriteAnEnd=ge.bind(e),e.fuseEditPointsForOpenContourEndEdit=ve.bind(e),e.openContourEditOverwriteEnd=me.bind(e),e.cancelOpenContourEdit=be.bind(e),e.completeOpenContourEdit=Ee.bind(e)},{getSubPixelSpacingAndXYDirections:Ce}=a.polyline;function Ie(e,t,n,r){this.isDrawing=!0;const o=e.detail,{element:a}=o,s=(0,i.getEnabledElement)(a),{viewport:l}=s,{spacing:c,xDir:u,yDir:f}=Ce(l,this.configuration.subPixelResolution),m=t.data.contour.polyline.map(l.worldToCanvas);0===t.data.handles.activeHandleIndex&&m.reverse();let g=!1;r?.worldPosition&&(g=!0),this.drawData={canvasPoints:m,polylineIndex:m.length-1},this.commonData={annotation:t,viewportIdsToRender:n,spacing:c,xDir:u,yDir:f,movingTextBox:g},p.wk.isInteractingWithTool=!0,a.addEventListener(h.Events.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(h.Events.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(h.Events.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(h.Events.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(h.Events.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(h.Events.TOUCH_TAP,this.mouseUpDrawCallback),(0,d.hideElementCursor)(a)}const Se=function(e){e.activateOpenContourEndEdit=Ie.bind(e)};var De=n(40203),Ae=n(15451);const{pointsAreWithinCloseContourProximity:Te}=a.polyline;function Ne(e,t){const n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id,annotationUID:t.annotationUID},{lineWidth:i,lineDash:r,color:o,fillColor:a,fillOpacity:s}=this.getAnnotationStyle({annotation:t,styleSpecifier:n}),{closed:l}=t.data.contour;return{color:o,width:i,lineDash:r,fillColor:a,fillOpacity:s,closePath:l}}function Oe(e,t,n){e?.viewport?.getImageData()&&(n.data.contour.closed?this.renderClosedContour(e,t,n):n.data.isOpenUShapeContour?(!function(e,t){t.data.openUShapeContourVectorToPeak||(t.data.openUShapeContourVectorToPeak=function(e,t){const{viewport:n}=e;return x(t.data.contour.polyline.map(n.worldToCanvas),n)}(e,t))}(e,n),this.renderOpenUShapedContour(e,t,n)):this.renderOpenContour(e,t,n))}function Pe(e,t,n){if(n.parentAnnotationUID)return;const{viewport:i}=e,r=this._getRenderingOptions(e,n),o=[n.data.contour.polyline.map(e=>i.worldToCanvas(e)),...(0,Ae.A)(n,i)];(0,De.drawPath)(t,n.annotationUID,"1",o,r)}function Me(e,t,n){const{viewport:i}=e,r=this._getRenderingOptions(e,n),o=n.data.contour.polyline.map(e=>i.worldToCanvas(e));(0,De.drawPolyline)(t,n.annotationUID,"1",o,r);const a=n.data.handles.activeHandleIndex;if(!0===this.configuration.alwaysRenderOpenContourHandles?.enabled){const e=this.configuration.alwaysRenderOpenContourHandles.radius,i="0",s=[o[0],o[o.length-1]];0===a?s.shift():1===a&&s.pop(),(0,De.drawHandles)(t,n.annotationUID,i,s,{color:r.color,handleRadius:e})}if(null!==a){const e="1",i=o[0===a?0:o.length-1];(0,De.drawHandles)(t,n.annotationUID,e,[i],{color:r.color})}}function ke(e,t,n){const{viewport:i}=e,{openUShapeContourVectorToPeak:r}=n.data,{polyline:o}=n.data.contour;if(this.renderOpenContour(e,t,n),!r)return;const a=i.worldToCanvas(o[0]),s=i.worldToCanvas(o[o.length-1]),l=[i.worldToCanvas(r[0]),i.worldToCanvas(r[1])],c=this._getRenderingOptions(e,n);(0,De.drawPolyline)(t,n.annotationUID,"first-to-last",[a,s],{color:c.color,width:c.width,closePath:!1,lineDash:"2,2"}),(0,De.drawPolyline)(t,n.annotationUID,"midpoint-to-open-contour",[l[0],l[1]],{color:c.color,width:c.width,closePath:!1,lineDash:"2,2"})}function Re(e,t,n){const i=this._getRenderingOptions(e,n),{allowOpenContours:r}=this.configuration,{canvasPoints:o}=this.drawData;if(i.closePath=!1,(0,De.drawPolyline)(t,n.annotationUID,"1",o,i),r){const e=o[0],r=o[o.length-1];if(Te(e,r,this.configuration.closeContourProximity))(0,De.drawPolyline)(t,n.annotationUID,"2",[r,e],i);else{const r="0";(0,De.drawHandles)(t,n.annotationUID,r,[e],{color:i.color,handleRadius:2})}}}function Le(e,t,n){const{viewport:i}=e,{fusedCanvasPoints:r}=this.editData;if(void 0===r)return void this.renderClosedContour(e,t,n);const o=[r,...(0,Ae.A)(n,i)],a=this._getRenderingOptions(e,n);n.parentAnnotationUID&&a.fillOpacity&&(a.fillOpacity=0),(0,De.drawPath)(t,n.annotationUID,"preview-1",o,a)}function Fe(e,t,n){const{fusedCanvasPoints:i}=this.editData;if(void 0===i)return void this.renderOpenContour(e,t,n);const r=this._getRenderingOptions(e,n);(0,De.drawPolyline)(t,n.annotationUID,"preview-1",i,r)}function Ue(e,t,n){if(n.parentAnnotationUID)return;const{viewport:i}=e,r=this._getRenderingOptions(e,n),o=n.data.contour.polyline.map(e=>i.worldToCanvas(e)),a=(0,Ae.A)(n,i),s=o[0],l=[];for(let e=0;e<100;e++){const t=e/100*2*Math.PI,n=s[0]+6*Math.cos(t),i=s[1]+6*Math.sin(t);l.push([n,i])}const c=[[s[0]-12,s[1]],[s[0]+12,s[1]],[s[0],s[1]-12],[s[0],s[1]+12]];(0,De.drawPath)(t,n.annotationUID,"1-crosshair_v",[c[0],c[1]],r),(0,De.drawPath)(t,n.annotationUID,"1-crosshair_h",[c[2],c[3]],r);const u=[l,...a];(0,De.drawPath)(t,n.annotationUID,"1",u,r)}const Be=function(e){e.renderContour=Oe.bind(e),e.renderClosedContour=Pe.bind(e),e.renderOpenContour=Me.bind(e),e.renderPointContourWithMarker=Ue.bind(e),e.renderOpenUShapedContour=ke.bind(e),e.renderContourBeingDrawn=Re.bind(e),e.renderClosedContourBeingEdited=Le.bind(e),e.renderOpenContourBeingEdited=Fe.bind(e),e._getRenderingOptions=Ne.bind(e)};var Ve=n(66990),We=n(92984),je=n(18990),He=n(79362),ze=n(93843),Ge=n(36320),qe=n(40634);const{pointCanProjectOnLine:$e}=a.polyline,{EPSILON:Xe}=i.CONSTANTS,Ke=1-Xe;class Ye extends Ge.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:h.KeyboardBindings.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:Je,statsCalculator:He.BasicStatsCalculator}}){super(e,t),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,i=this.createAnnotation(e);this.addAnnotation(i,n);const r=(0,c.getViewportIdsWithToolToRender)(n,this.getToolName());return this.activateDraw(e,i,r),e.preventDefault(),(0,u.A)(r),i},this.handleSelectedCallback=(e,t,n)=>{const i=e.detail,{element:r}=i,o=(0,c.getViewportIdsWithToolToRender)(r,this.getToolName());this.activateOpenContourEndEdit(e,t,o,n)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n,r=(0,c.getViewportIdsWithToolToRender)(i,this.getToolName());t.data.contour.closed?this.activateClosedContourEdit(e,t,r):this.activateOpenContourEdit(e,t,r),e.preventDefault()},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{polyline:s}=t.data.contour;let l=a.worldToCanvas(s[0]);for(let e=1;e<s.length;e++){const t=l,i=a.worldToCanvas(s[e]);if($e(n,t,i,r))return!0;l=i}if(!t.data.contour.closed)return!1;const c=a.worldToCanvas(s[0]),u=a.worldToCanvas(s[s.length-1]);return $e(n,c,u,r)},this.cancel=e=>{const t=this.isDrawing,n=this.isEditingOpen,i=this.isEditingClosed;t?this.cancelDrawing(e):n?this.cancelOpenContourEdit(e):i&&this.cancelClosedContourEdit(e)},this._calculateCachedStats=(e,t,n,r)=>{const{data:s}=e,{cachedStats:l}=s,{polyline:c,closed:u}=s.contour,d=Object.keys(l);for(let n=0;n<d.length;n++){const r=d[n],h=this.getTargetImageData(r);if(!h)continue;const{imageData:p,metadata:f}=h,m=c.map(e=>t.worldToCanvas(e)),g={isPreScaled:(0,je.u)(t,r),isSuvScaled:this.isSuvScaled(t,r,e.metadata.referencedImageId)},v=(0,qe.j)(f.Modality,e.metadata.referencedImageId,g),y=(0,o.Op)(h,()=>{const e=s.contour.polyline,n=e.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=t.worldToCanvas(e[i]);const{maxX:o,maxY:l,minX:c,minY:u}=a.polyline.getAABB(r),d=t.canvasToWorld([c,u]),h=i.utilities.transformWorldToIndex(p,d),f=t.canvasToWorld([o,l]);return[h,i.utilities.transformWorldToIndex(p,f)]});u?this.updateClosedCachedStats({targetId:r,viewport:t,canvasCoordinates:m,points:c,imageData:p,metadata:f,cachedStats:l,modalityUnit:v,calibratedScale:y}):this.updateOpenCachedStats({metadata:f,canvasCoordinates:m,targetId:r,cachedStats:l,modalityUnit:v,calibratedScale:y})}return(0,b.XF)(e,r.viewport.element,h.ChangeTypes.StatsUpdated),e.invalidated=!1,l},this._renderStats=(e,t,n,i)=>{const{data:r}=e,o=this.getTargetId(t),a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},s=this.getLinkedTextBoxStyle(a,e);if(!s.visibility)return;const l=this.configuration.getTextLines(r,o);if(!l||0===l.length)return;const c=r.contour.polyline.map(e=>t.worldToCanvas(e));if(!r.handles.textBox.hasMoved){const e=(0,Ve.getTextBoxCoordsCanvas)(c);r.handles.textBox.worldPosition=t.canvasToWorld(e)}const u=t.worldToCanvas(r.handles.textBox.worldPosition),d=(0,De.drawLinkedTextBox)(i,e.annotationUID??"","1",l,u,c,{},s),{x:h,y:p,width:f,height:m}=d;r.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([h,p]),topRight:t.canvasToWorld([h+f,p]),bottomLeft:t.canvasToWorld([h,p+m]),bottomRight:t.canvasToWorld([h+f,p+m])}},W(this),Y(this),ce(this),xe(this),Se(this),Be(this),this._throttledCalculateCachedStats=(0,l.A)(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,i.getEnabledElement)(e),{viewport:r}=n;let o;if(r instanceof i.VolumeViewport){const e=r.getCamera(),{spacingInNormalDirection:n}=i.utilities.getTargetVolumeAndSpacingInNormalDir(r,e);o=this.filterAnnotationsWithinSlice(t,e,n)}else o=(0,s.filterAnnotationsForDisplay)(r,t);return o}filterAnnotationsWithinSlice(e,t,n){const{viewPlaneNormal:i}=t,o=e.filter(e=>{const t=e.metadata.viewPlaneNormal,n=Math.abs(r.eR.dot(i,t))>Ke;return t&&n});if(!o.length)return[];const a=n/2,{focalPoint:s}=t,l=[];for(const e of o){const t=e.data.contour.polyline[0];if(!e.isVisible)continue;const n=r.eR.create();r.eR.sub(n,s,t);const o=r.eR.dot(n,i);Math.abs(o)<a&&l.push(e)}return l}isContourSegmentationTool(){return!1}createAnnotation(e){const t=e.detail.currentPoints.world,n=super.createAnnotation(e);return i.utilities.deepMerge(n,{data:{contour:{polyline:[[...t]]},label:"",cachedStats:{}},onInterpolationComplete:e=>{e.data.handles.points.length=0}})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:i}=e,r=e.annotation;let o=!1;const{viewport:a,renderingEngine:s}=t,l=this.isDrawing,c=this.isEditingOpen,u=this.isEditingClosed;if(l||c||u){const e=this.commonData.annotation.annotationUID;if(r.annotationUID===e)if(l)this.renderContourBeingDrawn(t,i,r);else if(u)this.renderClosedContourBeingEdited(t,i,r);else{if(!c)throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);this.renderOpenContourBeingEdited(t,i,r)}else this.configuration.displayOnePointAsCrosshairs&&1===r.data.contour.polyline.length?this.renderPointContourWithMarker(t,i,r):this.renderContour(t,i,r);o=!0}else this.configuration.displayOnePointAsCrosshairs&&1===r.data.contour.polyline.length?this.renderPointContourWithMarker(t,i,r):this.renderContour(t,i,r);if(this.configuration.calculateStats)return this._calculateStatsIfActive(r,n,a,s,t),this._renderStats(r,a,t,i),o}_calculateStatsIfActive(e,t,n,i,r){const o=this.commonData?.annotation.annotationUID;if((e.annotationUID!==o||this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:o}=e;o.cachedStats[t]&&null!=o.cachedStats[t].areaUnit?e.invalidated&&this._throttledCalculateCachedStats(e,n,i,r):(o.cachedStats[t]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,n,i,r))}}updateClosedCachedStats({viewport:e,points:t,imageData:n,metadata:o,cachedStats:s,targetId:l,modalityUnit:c,canvasCoordinates:u,calibratedScale:d}){const{scale:h,areaUnit:p,units:f}=d,{voxelManager:m}=e.getImageData(),g=u[0],v=e.canvasToWorld(g),y=e.canvasToWorld([g[0]+1,g[1]]),_=e.canvasToWorld([g[0],g[1]+1]),w=r.eR.distance(v,y),E=r.eR.distance(v,_),b=i.utilities.transformWorldToIndex(n,t[0]);b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]);let x=b[0],C=b[0],I=b[1],S=b[1],D=b[2],A=b[2];for(let e=1;e<t.length;e++){const r=i.utilities.transformWorldToIndex(n,t[e]);r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r[2]=Math.floor(r[2]),x=Math.min(x,r[0]),C=Math.max(C,r[0]),I=Math.min(I,r[1]),S=Math.max(S,r[1]),D=Math.min(D,r[2]),A=Math.max(A,r[2])}const T=i.utilities.transformWorldToIndex(n,t[1]);T[0]=Math.floor(T[0]),T[1]=Math.floor(T[1]),T[2]=Math.floor(T[2]);let N=a.polyline.getArea(u)/h/h;N*=w*E;const O=.01*(C-x),P=.01*(S-I),M=.01*(A-D);x=Math.floor(x-O),C=Math.ceil(C+O),I=Math.floor(I-P),S=Math.ceil(S+P),D=Math.floor(D-M),A=Math.ceil(A+M);const k=[[x,C],[I,S],[D,A]],R=n.indexToWorld([C,S,A]),L=e.worldToCanvas(R);let F=0,U=[],B=0;const V=m.forEach(this.configuration.statsCalculator.statsCallback,{imageData:n,isInObject:(t,n)=>{let i=!0;const r=e.worldToCanvas(t);return r[1]!=F&&(B=0,F=r[1],U=(0,We.getLineSegmentIntersectionsCoordinates)(u,r,[L[0],r[1]]),U.sort(function(e,t){return e[0]===t[0]?0:e[0]<t[0]?-1:1})),U.length&&r[0]>U[0][0]&&(U.shift(),B++),B%2==0&&(i=!1),i},boundsIJK:k,returnPoints:this.configuration.storePointData}),W=this.configuration.statsCalculator.getStatistics();s[l]={Modality:o.Modality,area:N,perimeter:(0,ze.A)(u,closed)/h,mean:W.mean?.value,max:W.max?.value,stdDev:W.stdDev?.value,statsArray:W.array,pointsInShape:V,areaUnit:p,modalityUnit:c,unit:f}}updateOpenCachedStats({targetId:e,metadata:t,canvasCoordinates:n,cachedStats:i,modalityUnit:r,calibratedScale:o}){const{scale:a,units:s}=o;i[e]={Modality:t.Modality,length:(0,ze.A)(n,!1)/a,modalityUnit:r,getPixelValueUnitunit:s}}}function Je(e,t){const n=e.cachedStats[t],{area:r,mean:o,stdDev:a,length:s,perimeter:l,max:c,isEmptyArea:u,unit:d,areaUnit:h,modalityUnit:p}=n||{},f=[];if(r){const e=u?"Area: Oblique not supported":`Area: ${i.utilities.roundNumber(r)} ${h}`;f.push(e)}return o&&f.push(`Mean: ${i.utilities.roundNumber(o)} ${p}`),Number.isFinite(c)&&f.push(`Max: ${i.utilities.roundNumber(c)} ${p}`),a&&f.push(`Std Dev: ${i.utilities.roundNumber(a)} ${p}`),l&&f.push(`Perimeter: ${i.utilities.roundNumber(l)} ${d}`),s&&f.push(`${i.utilities.roundNumber(s)} ${d}`),f}Ye.toolName="PlanarFreehandROI";const Ze=Ye},4010:(e,t,n)=>{"use strict";n.d(t,{A:()=>S});var i=n(85817),r=n(15327),o=n(4096),a=n(27730),s=n(6802),l=n(2076),c=n(29601),u=n(44049),d=n(40203),h=n(85204),p=n(99737),f=n(8056),m=n(92282),g=n(66990),v=n(35489),y=n(7001),_=n(58640),w=n(40634),E=n(18990),b=n(79362);const{transformWorldToIndex:x}=r.utilities;class C extends i.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,getTextLines:I,statsCalculator:b.BasicStatsCalculator}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,a=(0,r.getEnabledElement)(i),{viewport:l,renderingEngine:c}=a;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,p=this.getReferencedImageId(l,o,d,h),m=l.getFrameOfReferenceUID(),g={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:m,referencedImageId:p,...l.getViewReference({points:[o]})},data:{label:"",handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};(0,s.lC)(g,i);const v=(0,f.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:v,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),(0,y.hideElementCursor)(i),e.preventDefault(),(0,_.A)(v),g},this.isPointNearTool=(e,t,n,i)=>{const o=(0,r.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=a.worldToCanvas(l[0]),u=a.worldToCanvas(l[3]),d=this._getRectangleImageCoordinates([c,u]),h=[n[0],n[1]],{left:p,top:f,width:g,height:v}=d;return m.distanceToPoint([p,f,g,v],h)<=i},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0;const o=(0,f.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(i),(0,y.hideElementCursor)(i);const a=(0,r.getEnabledElement)(i),{renderingEngine:s}=a;(0,_.A)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const i=e.detail,{element:o}=i,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,f.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,y.hideElementCursor)(o);const u=(0,r.getEnabledElement)(o),{renderingEngine:d}=u;(0,_.A)(c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:o,newAnnotation:a,hasMoved:l}=this.editData,{data:c}=i;if(a&&!l)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,y.resetElementCursor)(n);const{renderingEngine:d}=(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.O8)(i.annotationUID),(0,_.A)(o),a&&(0,u.dZ)(i)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=i;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:r}=i;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world,{points:r}=l.handles;r.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),i.invalidated=!0}else{const{currentPoints:e}=t,o=(0,r.getEnabledElement)(n),{worldToCanvas:s,canvasToWorld:c}=o.viewport,u=e.world,{points:d}=l.handles;let h,p,f,m,g,v,y,_;switch(d[a]=[...u],a){case 0:case 3:h=s(d[0]),m=s(d[3]),p=[m[0],h[1]],f=[h[0],m[1]],v=c(p),y=c(f),d[1]=v,d[2]=y;break;case 1:case 2:p=s(d[1]),f=s(d[2]),h=[f[0],p[1]],m=[p[0],f[1]],g=c(h),_=c(m),d[0]=g,d[3]=_}i.invalidated=!0}this.editData.hasMoved=!0;const c=(0,r.getEnabledElement)(n),{renderingEngine:u}=c;(0,_.A)(o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,y.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:r}=t;return t.highlighted=!1,r.handles.activeHandleIndex=null,(0,_.A)(n),i&&(0,u.dZ)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{h.wk.isInteractingWithTool=!0,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(p.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{h.wk.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(p.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._activateModify=e=>{h.wk.isInteractingWithTool=!0,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{h.wk.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:o}=i;let a=(0,s.Rh)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const u=this.getTargetId(i),h=i.getRenderingEngine(),p={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let o=0;o<a.length;o++){const s=a[o],{annotationUID:f,data:m}=s,{points:v,activeHandleIndex:y}=m.handles,_=v.map(e=>i.worldToCanvas(e));p.annotationUID=f;const{color:w,lineWidth:E,lineDash:b}=this.getAnnotationStyle({annotation:s,styleSpecifier:p}),{viewPlaneNormal:x,viewUp:C}=i.getCamera();if(m.cachedStats[u]&&null!=m.cachedStats[u].areaUnit){if(s.invalidated&&(this._throttledCalculateCachedStats(s,x,C,h,e),i instanceof r.VolumeViewport)){const{referencedImageId:e}=s.metadata;for(const t in m.cachedStats)if(t.startsWith("imageId")){h.getStackViewports().find(t=>{const n=r.utilities.imageIdToURI(e),i=t.hasImageURI(n),o=r.utilities.imageIdToURI(t.getCurrentImageId());return i&&o!==n})&&delete m.cachedStats[t]}}}else m.cachedStats[u]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(s,x,C,h,e);if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if(!(0,c.isAnnotationVisible)(f))continue;if((0,l.isAnnotationLocked)(f)||this.editData||null===y||(I=[_[y]]),I){const e="0";(0,d.drawHandles)(t,f,e,I,{color:w})}const S=`${f}-rect`,D="0";(0,d.drawRectByCoordinates)(t,f,D,_,{color:w,lineDash:b,lineWidth:E},S),n=!0;const A=this.getLinkedTextBoxStyle(p,s);if(!A.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const T=this.configuration.getTextLines(m,u);if(!T||0===T.length)continue;if(!m.handles.textBox.hasMoved){const e=(0,g.getTextBoxCoordsCanvas)(_);m.handles.textBox.worldPosition=i.canvasToWorld(e)}const N=i.worldToCanvas(m.handles.textBox.worldPosition),O="1",P=(0,d.drawLinkedTextBox)(t,f,O,T,N,_,{},A),{x:M,y:k,width:R,height:L}=P;m.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([M,k]),topRight:i.canvasToWorld([M+R,k]),bottomLeft:i.canvasToWorld([M,k+L]),bottomRight:i.canvasToWorld([M+R,k+L])}}return n},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._calculateCachedStats=(e,t,n,i,r)=>{const{data:a}=e,{viewport:s}=r,{element:l}=s,c=a.handles.points[0],d=a.handles.points[3],{cachedStats:h}=a,p=Object.keys(h);for(let i=0;i<p.length;i++){const r=p[i],a=this.getTargetImageData(r);if(!a)continue;const{dimensions:l,imageData:u,metadata:f,voxelManager:m}=a,g=x(u,c);g[0]=Math.floor(g[0]),g[1]=Math.floor(g[1]),g[2]=Math.floor(g[2]);const y=x(u,d);if(y[0]=Math.floor(y[0]),y[1]=Math.floor(y[1]),y[2]=Math.floor(y[2]),this._isInsideVolume(g,y,l)){this.isHandleOutsideImage=!1;const i=[[Math.min(g[0],y[0]),Math.max(g[0],y[0])],[Math.min(g[1],y[1]),Math.max(g[1],y[1])],[Math.min(g[2],y[2]),Math.max(g[2],y[2])]],{worldWidth:l,worldHeight:p}=(0,v.A)(t,n,c,d),_=[g,y],{scale:b,areaUnit:x}=(0,o.Op)(a,_),C=Math.abs(l*p)/(b*b),I={isPreScaled:(0,E.u)(s,r),isSuvScaled:this.isSuvScaled(s,r,e.metadata.referencedImageId)},S=(0,w.j)(f.Modality,e.metadata.referencedImageId,I),D=m.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:i,imageData:u,returnPoints:this.configuration.storePointData}),A=this.configuration.statsCalculator.getStatistics();h[r]={Modality:f.Modality,area:C,mean:A.mean?.value,stdDev:A.stdDev?.value,max:A.max?.value,statsArray:A.array,pointsInShape:D,areaUnit:x,modalityUnit:S}}else this.isHandleOutsideImage=!0,h[r]={Modality:f.Modality}}return e.invalidated=!1,(0,u.XF)(e,l),h},this._isInsideVolume=(e,t,n)=>r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,a.A)(this._calculateCachedStats,100,{trailing:!0})}static{this.hydrate=(e,t,n)=>{const i=(0,r.getEnabledElementByViewportId)(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:l,viewUp:c}=o.getCamera(),u=new this,d=u.getReferencedImageId(o,t[0],l,c),h={annotationUID:n?.annotationUID||r.utilities.uuidv4(),data:{handles:{points:t,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:u.getToolName(),viewPlaneNormal:l,FrameOfReferenceUID:a,referencedImageId:d,...n}};(0,s.lC)(h,o.element),(0,_.A)([o.id])}}}function I(e,t){const n=e.cachedStats[t],{area:i,mean:o,max:a,stdDev:s,areaUnit:l,modalityUnit:c}=n;if(void 0===o)return;const u=[];return u.push(`Area: ${r.utilities.roundNumber(i)} ${l}`),u.push(`Mean: ${r.utilities.roundNumber(o)} ${c}`),u.push(`Max: ${r.utilities.roundNumber(a)} ${c}`),u.push(`Std Dev: ${r.utilities.roundNumber(s)} ${c}`),u}C.toolName="RectangleROI";const S=C},6030:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var i=n(15327),r=n(37234),o=n(77840),a=n(56069),s=n(94418),l=n(76712),c=n(49310);class u extends r.A{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:t,imageId:n}=e.detail,r=i.utilities.imageIdToURI(n),s=(0,o.getAnnotationManager)();s.getFramesOfReference().forEach(e=>{const n=s.getAnnotations(e)[this.getToolName()];n&&n.length&&(n.forEach(e=>{if(!e.metadata?.referencedImageId)return;i.utilities.imageIdToURI(e.metadata.referencedImageId)===r&&(e.invalidated=!0,e.data.cachedStats={})}),(0,a.A)(t))})}}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,i.getEnabledElement)(e),{viewport:r}=n;return(0,s.A)(r,t)}getReferencedImageIds(e){const t=this.getTargetId(e);let n;if(e instanceof i.StackViewport)n=[t.split("imageId:")[1]];else if(e instanceof i.VideoViewport)n=[t.split("videoId:")[1]];else{const e=i.utilities.getVolumeId(t);n=i.cache.getVolume(e).imageIds}return n}getReferencedImageId(e,t,n,r){const o=this.getTargetId(e);let a=o.split(/^[a-zA-Z]+:/)[1];if(e instanceof i.BaseVolumeViewport){const e=i.utilities.getVolumeId(o),r=i.cache.getVolume(e);a=i.utilities.getClosestImageId(r,t,n)}return a}getStyle(e,t,n){return(0,l.h)(e,t,(0,c.getState)(n),this.mode)}}u.toolName="AnnotationDisplayTool";const d=u},91350:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var i=n(15327),r=n(3823),o=n(6030),a=n(2076),s=n(29601),l=n(77840),c=n(44049);class u extends o.A{static createAnnotation(...e){let t={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const n of e)t=i.utilities.deepMerge(t,n);return t}static createAnnotationForViewport(e,...t){return this.createAnnotation({metadata:e.getViewReference()},...t)}static createAndAddAnnotation(e,...t){const n=this.createAnnotationForViewport(e,...t);(0,l.addAnnotation)(n,e.element),(0,c.XF)(n,e.element)}constructor(e,t){super(e,t),this.mouseMoveCallback=(e,t)=>{if(!t)return!1;const{element:n,currentPoints:i}=e.detail,r=i.canvas;let o=!1;for(const e of t){if((0,a.isAnnotationLocked)(e.annotationUID)||!(0,s.isAnnotationVisible)(e.annotationUID))continue;const{data:t}=e,i=t.handles?t.handles.activeHandleIndex:void 0,l=this._imagePointNearToolOrHandle(n,e,r,6),c=l&&!e.highlighted,u=!l&&e.highlighted;c||u?(e.highlighted=!e.highlighted,o=!0):t.handles&&t.handles.activeHandleIndex!==i&&(o=!0)}return o},e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,t,n,o){const a=(0,i.getEnabledElement)(e),{viewport:s}=a,{data:l}=t,{isCanvasAnnotation:c}=l,{points:u,textBox:d}=l.handles;if(d){const{worldBoundingBox:e}=d;if(e){const t={topLeft:s.worldToCanvas(e.topLeft),topRight:s.worldToCanvas(e.topRight),bottomLeft:s.worldToCanvas(e.bottomLeft),bottomRight:s.worldToCanvas(e.bottomRight)};if(n[0]>=t.topLeft[0]&&n[0]<=t.bottomRight[0]&&n[1]>=t.topLeft[1]&&n[1]<=t.bottomRight[1])return l.handles.activeHandleIndex=null,d}}for(let e=0;e<u?.length;e++){const t=u[e],i=c?t.slice(0,2):s.worldToCanvas(t);if(!0===r.Zc.distance(n,i)<o)return l.handles.activeHandleIndex=e,t}l.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,t){return{visibility:this.getStyle("textBoxVisibility",e,t),fontFamily:this.getStyle("textBoxFontFamily",e,t),fontSize:this.getStyle("textBoxFontSize",e,t),color:this.getStyle("textBoxColor",e,t),shadow:this.getStyle("textBoxShadow",e,t),background:this.getStyle("textBoxBackground",e,t),lineWidth:this.getStyle("textBoxLinkLineWidth",e,t),lineDash:this.getStyle("textBoxLinkLineDash",e,t)}}isSuvScaled(e,t,n){if(e instanceof i.BaseVolumeViewport){const e=i.utilities.getVolumeId(t),n=i.cache.getVolume(e);return void 0!==n?.scaling?.PT}const r=n&&i.metaData.get("scalingModule",n);return"number"==typeof r?.suvbw}getAnnotationStyle(e){const{annotation:t,styleSpecifier:n}=e,i=e=>this.getStyle(e,n,t),{annotationUID:r}=t,o=(0,s.isAnnotationVisible)(r),l=(0,a.isAnnotationLocked)(r),c=i("lineWidth"),u=i("lineDash"),d=i("color");return{visibility:o,locked:l,color:d,lineWidth:c,lineDash:u,lineOpacity:1,fillColor:d,fillOpacity:0,shadow:i("shadow"),textbox:this.getLinkedTextBoxStyle(n,t)}}_imagePointNearToolOrHandle(e,t,n,i){if(this.getHandleNearImagePoint(e,t,n,i))return!0;return!!this.isPointNearTool(e,t,n,i,"mouse")||void 0}}u.toolName="AnnotationTool";const d=u},37234:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(15327),r=n(49892);class o{constructor(e,t){const n=i.utilities.deepMerge(t,e),{configuration:o={},supportedInteractionTypes:a,toolGroupId:s}=n;o.strategies||(o.strategies={},o.defaultStrategy=void 0,o.activeStrategy=void 0,o.strategyOptions={}),this.toolGroupId=s,this.supportedInteractionTypes=a||[],this.configuration=Object.assign({},o),this.mode=r.A.Disabled}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,t){const{strategies:n,activeStrategy:i}=this.configuration;return n[i]?.call(this,e,t)}applyActiveStrategyCallback(e,t,n){const{strategies:i,activeStrategy:r}=this.configuration;if(!i[r])throw new Error(`applyActiveStrategyCallback: active strategy ${r} not found, check tool configuration or spellings`);return i[r][n]?.call(this,e,t)}setConfiguration(e){this.configuration=i.utilities.deepMerge(this.configuration,e),e.strategySpecificConfiguration?.THRESHOLD_INSIDE_CIRCLE&&(this.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold=e.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const t=e.split("imageId:")[1],n=i.utilities.imageIdToURI(t);let r=i.utilities.getViewportsWithImageURI(n);if(!r||!r.length)return;if(r=r.filter(e=>e.getCurrentImageId()===t),!r||!r.length)return;return r[0].getImageData()}if(e.startsWith("volumeId:")){const t=i.utilities.getVolumeId(e),n=i.utilities.getViewportsWithVolumeId(t);if(!n||!n.length)return;return n[0].getImageData()}if(e.startsWith("videoId:")){const t=i.utilities.imageIdToURI(e),n=i.utilities.getViewportsWithImageURI(t);if(!n||!n.length)return;return n[0].getImageData()}throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const t=e.getViewReferenceId?.();if(t)return t;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}}o.toolName="BaseTool";const a=o},36320:(e,t,n)=>{"use strict";n.d(t,{A:()=>I});var i=n(15327),r=(n(33283),n(99737)),o=n(77840),a=n(40203),s=n(91350),l=n(72967),c=n(15451);class u extends s.A{constructor(e,t){super(e,t)}renderAnnotation(e,t){let n=!1;const{viewport:i}=e,{element:r}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let a=(0,o.getAnnotations)(this.getToolName(),r);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(r,a),!a?.length)return n;const s=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const r=a[i];l.annotationUID=r.annotationUID;const o=this.getAnnotationStyle({annotation:r,styleSpecifier:l});if(!o.visibility)continue;const c=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:r,annotationStyle:o,svgDrawingHelper:t});n||=c,r.invalidated=!1}return n}createAnnotation(e){const t=e.detail,{currentPoints:n,element:r}=t,{world:o}=n,a=(0,i.getEnabledElement)(r),{viewport:s}=a,l=s.getCamera(),{viewPlaneNormal:c,viewUp:u,position:d}=l,h=this.getReferencedImageId(s,o,c,u),p=s.getViewReference({points:[o]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...p,referencedImageId:h,viewUp:u,cameraPosition:d},data:{handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{polyline:[],closed:!1}},interpolationUID:"",autoGenerated:!1}}addAnnotation(e,t){return(0,o.addAnnotation)(e,t)}cancelAnnotation(e){}moveAnnotation(e,t){const{points:n}=e.data.handles;for(let e=0,i=n.length;e<i;e++){const i=n[e];i[0]+=t[0],i[1]+=t[1],i[2]+=t[2]}e.invalidated=!0,(0,o.getChildAnnotations)(e).forEach(e=>this.moveAnnotation(e,t))}updateContourPolyline(e,t,n,i){const r=this.configuration?.decimate||{};(0,l.A)(e,t,n,{decimate:{enabled:!!r.enabled,epsilon:r.epsilon},updateWindingDirection:i?.updateWindingDirection})}getPolylinePoints(e){return e.data.contour?.polyline??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:t,annotationStyle:n,svgDrawingHelper:i}=e,r=e.annotation;if(r.parentAnnotationUID)return;const{annotationUID:o}=r,{viewport:s}=t,{worldToCanvas:l}=s,u=this.getPolylinePoints(r).map(e=>l(e)),{lineWidth:d,lineDash:h,color:p,fillColor:f,fillOpacity:m}=n,g=[u,...(0,c.A)(r,s)];return(0,a.drawPath)(i,o,"contourPolyline",g,{color:p,lineDash:h,lineWidth:Math.max(.1,d),fillColor:f,fillOpacity:m}),!0}}var d=n(26047),h=n(15773),p=n(66403),f=n(94779),m=n(7754),g=n(93733),v=n(93210),y=n(67165),_=n(33658),w=n(58859),E=n(60740),b=n(26795),x=n(77133),C=n(47098);class I extends u{constructor(e,t){super(e,t),this.configuration.interpolation?.enabled&&h.A.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n);if(!r)return;const{viewport:o}=r,a=super.createAnnotation(e);if(!this.isContourSegmentationTool())return a;const s=(0,y.T)(o.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:l}=s,c=(0,E.Q)(l);return i.utilities.deepMerge(a,{data:{segmentation:{segmentationId:l,segmentIndex:c}}})}addAnnotation(e,t){const n=super.addAnnotation(e,t);if(this.isContourSegmentationTool()){const t=e;(0,p.addContourSegmentationAnnotation)(t)}return n}cancelAnnotation(e){this.isContourSegmentationTool()&&(0,p.removeContourSegmentationAnnotation)(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const t=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return t;const n=this._getContourSegmentationStyle(e);return i.utilities.deepMerge(t,n)}renderAnnotationInstance(e){const{annotation:t}=e,{invalidated:n}=t,i=super.renderAnnotationInstance(e);if(n&&this.isContourSegmentationTool()){const{segmentationId:e}=t.data.segmentation;(0,d.triggerSegmentationDataModified)(e);const n=(0,w.P)(e).map(e=>(0,m.getToolGroupForViewport)(e).id);(0,f._)(n)}return i}_getContourSegmentationStyle(e){const t=e.annotation,{segmentationId:n,segmentIndex:i}=t.data.segmentation,{viewportId:o}=e.styleSpecifier,a=(0,v.r$)(o,{segmentationId:n});if(!a?.length)return{};let s;s=a.length>1?a.find(e=>e.segmentationId===n&&e.type===r.SegmentationRepresentations.Contour):a[0];const{autoGenerated:l}=t,c=(0,b.getLockedSegmentIndices)(n).includes(i),u=(0,g.getSegmentIndexColor)(e.styleSpecifier.viewportId,n,i),d=(0,_.I)(o,{segmentationId:n,type:r.SegmentationRepresentations.Contour}),h=(0,y.T)(o),p=h?.segmentationId===n,f=x.Y.getStyle({viewportId:o,segmentationId:n,type:r.SegmentationRepresentations.Contour,segmentIndex:i});let m,w=1,I=1,S=0;l?(w=f.outlineWidthAutoGenerated??w,m=f.outlineDashAutoGenerated??m,I=f.outlineOpacity??I,S=f.fillAlphaAutoGenerated??S):p?(w=f.outlineWidth??w,m=f.outlineDash??m,I=f.outlineOpacity??I,S=f.fillAlpha??S):(w=f.outlineWidthInactive??w,m=f.outlineDashInactive??m,I=f.outlineOpacityInactive??I,S=f.fillAlphaInactive??S),(0,E.Q)(n)===i&&(w+=f.activeSegmentOutlineWidthDelta),w=f.renderOutline?w:0,S=f.renderFill?S:0;const D=`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${I})`,A=`rgb(${u[0]}, ${u[1]}, ${u[2]})`,T=!(0,C.s)(o,{segmentationId:n,type:r.SegmentationRepresentations.Contour}).has(i);return{color:D,fillColor:A,lineWidth:w,fillOpacity:S,lineDash:m,textbox:{color:D},visibility:d&&T,locked:c}}}},85817:(e,t,n)=>{"use strict";n.d(t,{EC:()=>r.A,oS:()=>i.A});var i=n(37234),r=n(91350);n(6030)},92300:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var i=n(15327),r=n(18682),o=n(77840),a=n(64485),s=n(66403);n(35056),n(74966),n(87275);var l=n(99737),c=n(77133);function u(e,t,n,r){n.size?e.render():function(e,t,n){const{segmentationId:r}=n,u=new Map;t.forEach(t=>{const n=i.cache.getGeometry(t);if(!n)return void console.warn(`No geometry found for geometryId ${t}. Skipping render.`);const d=n.data.segmentIndex;!function(e){if(!e)throw new Error(`No contours found for geometryId ${e.id}`);const t=e.id;if(e.type!==i.Enums.GeometryType.CONTOUR)throw new Error(`Geometry type ${e.type} not supported for rendering.`);e.data||console.warn(`No contours found for geometryId ${t}. Skipping render.`)}(n);const h=c.Y.getStyle({viewportId:e.id,segmentationId:r,type:l.SegmentationRepresentations.Contour,segmentIndex:d}),p=n.data,f=e.getCamera().viewPlaneNormal;p.contours.forEach(t=>{const{points:n,color:l,id:c}=t,u=(0,a.x)(e,n[0],f),h={annotationUID:i.utilities.uuidv4(),data:{contour:{closed:!0,polyline:n},segmentation:{segmentationId:r,segmentIndex:d,color:l,id:c},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:u,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:e.getFrameOfReferenceUID(),viewPlaneNormal:e.getCamera().viewPlaneNormal}},p=e.element;(0,o.addAnnotation)(h,p),(0,s.addContourSegmentationAnnotation)(h)}),h&&u.set(d,h)}),e.resetCamera(),e.render()}(e,t,r)}var d=n(33283),h=n(69073),p=n(99945),f=n(6802);const m=function(e,t,n=!1){const i=(0,d.T)(t),{annotationUIDsMap:r}=i.representationData.Contour;r.forEach(e=>{e.forEach(e=>{(0,f.O8)(e)})})};let g=!1;new Map;const v={render:async function(e,t){const{segmentationId:n}=t,i=(0,d.T)(n);if(!i)return;let o=i.representationData[r.A.Contour];o||!(0,h.n)(n,r.A.Contour)||g||(g=!0,o=await(0,p.D)(n,{viewport:e}),g=!1),o&&o.geometryIds?.length&&u(e,o.geometryIds,o.annotationUIDsMap,t)},removeRepresentation:function(e,t,n=!1){const r=(0,i.getEnabledElementByViewportId)(e);if(!r)return;const{viewport:o}=r;n&&(m(e,t),o.render())}}},60284:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>S});var i=n(15327),r=n(97577),o=n(33283),a=n(26047),s=n(99737);const{uuidv4:l}=i.utilities;const c=async function(e,t,n){const c=(0,i.getEnabledElement)(e),{renderingEngine:u,viewport:d}=c,{id:h}=d;if(d instanceof i.BaseVolumeViewport){const e=function(e,t){let{volumeId:n}=e;if(!n){n=l();const i=(0,o.T)(t);i.representationData.Labelmap={...i.representationData.Labelmap,volumeId:n},e.volumeId=n,(0,a.triggerSegmentationModified)(t)}return n}(t,n);i.cache.getVolume(e)||await async function(e){const t=e;if(!(t.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");const n=await i.volumeLoader.createAndCacheVolumeFromImages(e.volumeId||l(),t.imageIds);return n}(t);const r=[{volumeId:e,visibility:true,blendMode:i.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND,representationUID:`${n}-${s.SegmentationRepresentations.Labelmap}`}];await(0,i.addVolumesToViewports)(u,r,[h],false,true)}else{const e=[{imageId:(0,r.v)(d.id,n),representationUID:`${n}-${s.SegmentationRepresentations.Labelmap}`}];await(0,i.addImageSlicesToViewports)(u,e,[h])}(0,a.triggerSegmentationDataModified)(n)};var u=n(59452);const d=function(e,t){const n=(0,i.getEnabledElement)(e),{viewport:r}=n;r.removeActors([(0,u.Qe)(r.id,t)])};var h=n(26228),p=n(50409),f=n(69073),m=n(4746),g=n(77133),v=n(18682),y=n(47098),_=n(60740);const w=255,E=new Map;let b=!1;function x(e,t,n){const i={...e,...n||{}};return{fillAlpha:t?i.fillAlpha:i.fillAlphaInactive,outlineWidth:t?i.outlineWidth:i.outlineWidthInactive,renderFill:t?i.renderFill:i.renderFillInactive,renderOutline:t?i.renderOutline:i.renderOutlineInactive,outlineOpacity:t?i.outlineOpacity:i.outlineOpacityInactive,activeSegmentOutlineWidthDelta:i.activeSegmentOutlineWidthDelta}}function C(e,t,n,{fillAlpha:i,renderFill:r,renderOutline:o,segmentColor:a,outlineWidth:s,segmentsHidden:l,cfun:c,ofun:u}){const d=`${e}-${t}-${n}`,h=E.get(d);if(!h)return E.set(d,{fillAlpha:i,renderFill:r,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(l),cfunMTime:c.getMTime(),ofunMTime:u.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:p,renderFill:f,renderOutline:m,outlineWidth:g,segmentColor:v,segmentsHidden:y,cfunMTime:_,ofunMTime:w}=h,b=v[0]!==a[0]||v[1]!==a[1]||v[2]!==a[2],x=v[3]!==a[3]||p!==i||f!==r||m!==o||g!==s||y!==l;return(x||b)&&E.set(d,{fillAlpha:i,renderFill:r,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(l),cfunMTime:c.getMTime(),ofunMTime:u.getMTime()}),{forceOpacityUpdate:x,forceColorUpdate:b}}async function I(e,t,n){await c(e.element,t,n)}const S={render:async function(e,t){const{segmentationId:n}=t,a=(0,o.T)(n);if(!a)return void console.warn("No segmentation found for segmentationId: ",n);let s=a.representationData[v.A.Labelmap],l=(0,u.wV)(e.id,n);if(!s&&(0,f.n)(n,v.A.Labelmap)&&!b){if(b=!0,s=await(0,m.z)(n,{viewport:e}),!s)throw new Error(`No labelmap data found for segmentationId ${n}.`);b=!1}if(s){if(e instanceof i.VolumeViewport)l||await I(e,s,n),l=(0,u.wV)(e.id,n);else{if(!(0,r.v)(e.id,n))return;l||await I(e,s,n),l=(0,u.wV)(e.id,n)}l&&function(e,t,n){const{segmentationId:i}=n,{cfun:r,ofun:o}=n.config,{colorLUTIndex:a}=n,s=(0,h.getActiveSegmentation)(e),l=s?.segmentationId===i,c=g.Y.getStyle({viewportId:e,type:v.A.Labelmap,segmentationId:i}),u=g.Y.getRenderInactiveSegmentations(e),d=(0,p.B)(a),f=Math.min(256,d.length),{outlineWidth:m,renderOutline:E,outlineOpacity:b,activeSegmentOutlineWidthDelta:I}=x(c,l),S=(0,y.s)(e,{segmentationId:i,type:v.A.Labelmap});for(let t=0;t<f;t++){const n=t,a=d[n],s=g.Y.getStyle({viewportId:e,type:v.A.Labelmap,segmentationId:i,segmentIndex:n}),{fillAlpha:u,outlineWidth:h,renderFill:p,renderOutline:f}=x(c,l,s),{forceOpacityUpdate:m,forceColorUpdate:y}=C(e,i,n,{fillAlpha:u,renderFill:p,renderOutline:f,segmentColor:a,outlineWidth:h,segmentsHidden:S,cfun:r,ofun:o});if(y&&r.addRGBPoint(n,a[0]/w,a[1]/w,a[2]/w),m)if(p){const e=S.has(n)?0:a[3]/255*u;o.removePoint(n),o.addPointLong(n,e,.5,1)}else o.addPointLong(n,.01,.5,1)}const D=t.actor;if(D.getProperty().setRGBTransferFunction(0,r),o.setClamping(!1),D.getProperty().setScalarOpacity(0,o),D.getProperty().setInterpolationTypeToNearest(),E){D.getProperty().setUseLabelOutline(E),D.getProperty().setLabelOutlineOpacity(b);const e=(0,_.Q)(n.segmentationId),t=new Array(f-1);for(let n=1;n<f;n++){S.has(n)?t[n-1]=0:t[n-1]=n===e?m+I:m}D.getProperty().setLabelOutlineThickness(t)}else D.getProperty().setLabelOutlineThickness(new Array(f-1).fill(0));const A=l||u;D.setVisibility(A)}(e.id,l,t)}},removeRepresentation:function(e,t,n=!1){const r=(0,i.getEnabledElementByViewportId)(e);if(E.forEach((e,n)=>{n.includes(t)&&E.delete(n)}),!r)return;const{viewport:o}=r;d(o.element,t),n&&o.render()}}},6934:(e,t,n)=>{"use strict";n.d(t,{t:()=>o});var i=n(15327);function r(e){if("volumeId"in e){if(!i.cache.getVolume(e.volumeId))throw new Error(`volumeId of ${e.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else{if(!("imageIds"in e))throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData");if(!e.imageIds)throw new Error("The segmentationInput.representationData.imageIds is undefined, please provide a valid representationData.imageIds for stack data")}}function o(e){r(e)}},94895:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>v});var i=n(15327),r=n(18682),o=n(59452);const a=function(e,t){const n=(0,i.getEnabledElement)(e),{viewport:r}=n,a=r.getActors().filter(e=>e.uid.startsWith((0,o.jU)(r.id,t,"")));r.removeActors(a.map(e=>e.uid))};var s=n(82409),l=n(7019),c=n(87275),u=n(35056);const d=function(e,t,n){const r=(0,i.getEnabledElement)(e),{viewport:a}=r,d=(0,o.jU)(a.id,n,t.segmentIndex),h=(0,o.Th)(a.id,n,t.segmentIndex),p=h?.actor;if(p){const e=p.getMapper(),n=e.getInputData(),i=t.points,r=t.polys,o=n.getPoints().getData(),s=n.getPolys().getData();if(i.length===o.length&&r.length===s.length)return;const l=c.Ay.newInstance();l.getPoints().setData(i,3);const d=u.Ay.newInstance({values:Float32Array.from(r)});return l.setPolys(d),e.setInputData(l),e.modified(),void a.getRenderer().resetCameraClippingRange()}const f=t.points,m=t.polys,g=t.color,v=c.Ay.newInstance();v.getPoints().setData(f,3);const y=u.Ay.newInstance({values:Float32Array.from(m)});v.setPolys(y);const _=s.Ay.newInstance({});_.setInputData(v);const w=l.Ay.newInstance();w.setMapper(_),w.getProperty().setColor(g[0]/255,g[1]/255,g[2]/255),w.getProperty().setLineWidth(2),a.addActor({uid:i.utilities.uuidv4(),actor:w,clippingFilter:undefined,representationUID:d}),a.resetCamera(),a.getRenderer().resetCameraClippingRange(),a.render()};var h=n(33283),p=n(50409),f=n(69073),m=n(58062);const{ViewportType:g}=i.Enums;const v={render:async function(e,t){const{segmentationId:n}=t,o=(0,h.T)(n);if(!o)return;let a=o.representationData[r.A.Surface];if(!a&&(0,f.n)(n,r.A.Surface)&&(a=await(0,m.o)(n,{viewport:e}),!a))throw new Error(`No Surface data found for segmentationId ${n}.`);const{geometryIds:s}=a;s?.size||console.warn(`No Surfaces found for segmentationId ${n}. Skipping render.`);const{colorLUTIndex:l}=t,c=(0,p.B)(l),u=[];s.forEach(t=>{const r=i.cache.getGeometry(t);if(!r?.data)return void console.warn(`No Surfaces found for geometryId ${t}. Skipping render.`);const o=r.data.segmentIndex,a=r.data,s=c[o];a.color=s.slice(0,3),u.push(a),d(e.element,a,n)}),e.render()},removeRepresentation:function(e,t,n=!1){const r=(0,i.getEnabledElementByViewportId)(e);if(!r)return;const{viewport:o}=r;a(o.element,t),n&&o.render()}}},48736:(e,t,n)=>{"use strict";n.d(t,{A:()=>w});var i=n(15327),r=n(3823),o=n(85817),a=n(17492),s=n(1989),l=n(56789),c=n(33852),u=n(99737),d=n(40203),h=n(7001),p=n(58640),f=n(98870),m=n(26795),g=n(60740),v=n(93733),y=n(67165);class _ extends o.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:l.kr,FILL_INSIDE_SPHERE:a.Jq,THRESHOLD_INSIDE_CIRCLE:l.q,THRESHOLD_INSIDE_SPHERE:a.rd,ERASE_INSIDE_CIRCLE:c.r,ERASE_INSIDE_SPHERE:s._,REPLACE_INSIDE_CIRCLE:l.TQ,REPLACE_INSIDE_SPHERE:a.SX},strategySpecificConfiguration:{THRESHOLD:{threshold:[-1e3,3095]},REPLACE:{targetSegmentIndex:0}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",thresholdVolumeId:null,brushSize:10,eraseFocusIndex:0,preview:{enabled:!1,previewColors:{},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[u.StrategyCallbacks.AcceptPreview]:{method:u.StrategyCallbacks.AcceptPreview,bindings:[{key:"Enter"}]},[u.StrategyCallbacks.RejectPreview]:{method:u.StrategyCallbacks.RejectPreview,bindings:[{key:"Escape"}]}}}}){super(e,t),this._previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1},this.onSetToolPassive=e=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=e=>{this.disableCursor()},this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n);this._editData=this.createEditData(n),this._activateDraw(n),(0,h.hideElementCursor)(n),e.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const o=this._hoverData||this.createHoverData(n);(0,p.A)(o.viewportIdsToRender);const a=this.getOperationData(n);return this.applyActiveStrategyCallback(r,a,u.StrategyCallbacks.OnInteractionStart),!0},this.mouseMoveCallback=e=>{if(this.mode===u.ToolModes.Active){if(this.updateCursor(e),!this.configuration.preview.enabled)return;const{previewTimeMs:t,previewMoveDistance:n,dragMoveDistance:i}=this.configuration.preview,{currentPoints:o,element:a}=e.detail,{canvas:s}=o,{preview:l,startPoint:c,timer:u,timerStart:d,isDrag:h}=this._previewData,p=r.Zc.distance(s,c),f=Date.now()-d;if((p>n||f>t&&p>i)&&(u&&(window.clearTimeout(u),this._previewData.timer=null),l&&!h&&this.rejectPreview(a)),!this._previewData.timer){const e=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:e,startPoint:s,element:a})}}},this.previewCallback=()=>{this._previewData.timer=null,this._previewData.preview||(this._previewData.preview=this.applyActiveStrategyCallback((0,i.getEnabledElement)(this._previewData.element),this.getOperationData(this._previewData.element),u.StrategyCallbacks.Preview))},this._dragCallback=e=>{const t=e.detail,{element:n,currentPoints:o}=t,a=(0,i.getEnabledElement)(n);this.updateCursor(e);const{viewportIdsToRender:s}=this._hoverData;(0,p.A)(s);const l=r.Zc.distance(o.canvas,this._previewData.startPoint),{dragTimeMs:c,dragMoveDistance:u}=this.configuration.preview;!this._previewData.isDrag&&this._previewData.preview&&Date.now()-this._previewData.timerStart<c&&l<u||(this._previewData.preview=this.applyActiveStrategy(a,this.getOperationData(n)),this._previewData.element=n,this._previewData.timerStart=Date.now()+c,this._previewData.isDrag=!0,this._previewData.startPoint=o.canvas)},this._endCallback=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),o=this.getOperationData(n);this._previewData.preview||this._previewData.isDrag||this.applyActiveStrategy(r,o),this._deactivateDraw(n),(0,h.resetElementCursor)(n),this.updateCursor(e),this._editData=null,this.applyActiveStrategyCallback(r,o,u.StrategyCallbacks.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(n)},this._activateDraw=e=>{e.addEventListener(u.Events.MOUSE_UP,this._endCallback),e.addEventListener(u.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(u.Events.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(u.Events.MOUSE_UP,this._endCallback),e.removeEventListener(u.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(u.Events.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}createEditData(e){const t=(0,i.getEnabledElement)(e),{viewport:n}=t,r=(0,y.T)(n.id);if(!r){const e=new CustomEvent(i.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"No active segmentation detected, create a segmentation representation before using the brush tool"},cancelable:!0});return i.eventTarget.dispatchEvent(e),null}const{segmentationId:o}=r,a=(0,m.getLockedSegmentIndices)(o),{representationData:s}=(0,f.getSegmentation)(o);if(n instanceof i.BaseVolumeViewport){const{volumeId:e}=s[u.SegmentationRepresentations.Labelmap],t=n.getActors();if(n instanceof i.StackViewport){const e=new CustomEvent(i.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return i.eventTarget.dispatchEvent(e),null}const r=t.map(e=>i.cache.getVolume(e.referencedId)),o=i.cache.getVolume(e),l=r.find(e=>i.utilities.isEqual(e.dimensions,o.dimensions))?.volumeId||r[0]?.volumeId;return{volumeId:e,referencedVolumeId:this.configuration.thresholdVolumeId??l,segmentsLocked:a}}{const e=(0,f.getCurrentLabelmapImageIdForViewport)(n.id,o);if(!e)return;if(this.configuration.activeStrategy.includes("SPHERE")){const t=n.getImageIds();if(!i.utilities.isValidVolume(t))throw new Error("Volume is not reconstructable for sphere manipulation");const r=`${o}_${n.id}`,s=i.cache.getVolume(r);if(s)return{imageId:e,segmentsLocked:a,override:{voxelManager:s.voxelManager,imageData:s.imageData}};{const t=(0,f.getStackSegmentationImageIdsForViewport)(n.id,o);if(!t||1===t.length)return{imageId:e,segmentsLocked:a};const s=i.volumeLoader.createAndCacheVolumeFromImagesSync(r,t);return{imageId:e,segmentsLocked:a,override:{voxelManager:s.voxelManager,imageData:s.imageData}}}}return{imageId:e,segmentsLocked:a}}}createHoverData(e,t){const n=(0,i.getEnabledElement)(e),{viewport:r}=n,o=r.getCamera(),{viewPlaneNormal:a,viewUp:s}=o,l=[r.id],{segmentIndex:c,segmentationId:u,segmentColor:d}=this.getActiveSegmentationData(r)||{};return{brushCursor:{metadata:{viewPlaneNormal:[...a],viewUp:[...s],FrameOfReferenceUID:r.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:d},data:{}},centerCursorInWorld:t,segmentIndex:c,viewport:r,segmentationId:u,segmentColor:d,viewportIdsToRender:l}}getActiveSegmentationData(e){const t=e.id,n=(0,y.T)(t);if(!n)return;const{segmentationId:i}=n,r=(0,g.Q)(i);if(!r)return;return{segmentIndex:r,segmentationId:i,segmentColor:(0,v.getSegmentIndexColor)(t,i,r)}}updateCursor(e){const t=e.detail,{element:n}=t,{currentPoints:i}=t,r=i.world;this._hoverData=this.createHoverData(n,r),this._calculateCursor(n,r),this._hoverData&&(0,p.A)(this._hoverData.viewportIdsToRender)}getOperationData(e){const t=this._editData||this.createEditData(e),{segmentIndex:n,segmentationId:i,brushCursor:r}=this._hoverData||this.createHoverData(e),{data:o,metadata:a={}}=r||{},{viewPlaneNormal:s,viewUp:l}=a;return{...t,points:o?.handles?.points,segmentIndex:n,previewColors:this.configuration.preview.enabled?this.configuration.preview.previewColors:null,viewPlaneNormal:s,toolGroupId:this.toolGroupId,segmentationId:i,viewUp:l,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration,eraseFocusIndex:this.configuration.eraseFocusIndex,preview:this._previewData?.preview}}_calculateCursor(e,t){const n=(0,i.getEnabledElement)(e),{viewport:o}=n,a=o.getCamera(),{brushSize:s}=this.configuration,l=r.eR.fromValues(a.viewUp[0],a.viewUp[1],a.viewUp[2]),c=r.eR.fromValues(a.viewPlaneNormal[0],a.viewPlaneNormal[1],a.viewPlaneNormal[2]),u=r.eR.create();r.eR.cross(u,l,c);const d=r.eR.create(),h=r.eR.create(),p=r.eR.create(),f=r.eR.create();for(let e=0;e<=2;e++)d[e]=t[e]-l[e]*s,h[e]=t[e]+l[e]*s,p[e]=t[e]-u[e]*s,f[e]=t[e]+u[e]*s;if(!this._hoverData)return;const{brushCursor:m}=this._hoverData,{data:g}=m;void 0===g.handles&&(g.handles={}),g.handles.points=[d,h,p,f];const v=this.configuration.activeStrategy,y=this.configuration.strategies[v];"function"==typeof y.computeInnerCircleRadius&&y.computeInnerCircleRadius({configuration:this.configuration,viewport:o}),g.invalidated=!1}rejectPreview(e=this._previewData.element){if(!e||!this._previewData.preview)return;const t=(0,i.getEnabledElement)(e);this.applyActiveStrategyCallback(t,this.getOperationData(e),u.StrategyCallbacks.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(e=this._previewData.element){if(!e)return;const t=(0,i.getEnabledElement)(e);this.applyActiveStrategyCallback(t,this.getOperationData(e),u.StrategyCallbacks.AcceptPreview),this._previewData.isDrag=!1,this._previewData.preview=null}invalidateBrushCursor(){if(void 0===this._hoverData)return;const{data:e}=this._hoverData.brushCursor,{viewport:t}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(t)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,t){if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const i=this._hoverData.brushCursor;if(!0===i.data.invalidated){const{centerCursorInWorld:e}=this._hoverData,{element:t}=n;this._calculateCursor(t,e)}const r=i.metadata;if(!r)return;const o=r.brushCursorUID,a=i.data,{points:s}=a.handles,l=s.map(e=>n.worldToCanvas(e)),c=l[0],u=l[1],h=[Math.floor((c[0]+u[0])/2),Math.floor((c[1]+u[1])/2)],p=Math.abs(c[1]-Math.floor((c[1]+u[1])/2)),f=`rgb(${r.segmentColor?.slice(0,3)||[0,0,0]})`;if(!n.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");(0,d.drawCircle)(t,o,"0",h,p,{color:f});const m=this.configuration.activeStrategy,{dynamicRadiusInCanvas:g}=this.configuration.strategySpecificConfiguration[m]||{dynamicRadiusInCanvas:0};if(g){const e="1";(0,d.drawCircle)(t,o,e,h,g,{color:f})}}}_.toolName="Brush";const w=_},67847:(e,t,n)=>{"use strict";n.d(t,{A:()=>I});var i=n(15327),r=n(4096),o=n(3823),a=n(6802),s=n(2076),l=n(40203),c=n(8056),u=n(27730),d=n(66990),h=n(35489),p=n(29601),f=n(7001),m=n(58640),g=n(44049),v=n(4010),y=n(18990),_=n(79362),w=n(13165),E=n(40634);const{transformWorldToIndex:b}=i.utilities;class x extends v.A{constructor(e={},t={configuration:{storePointData:!1,numSlicesToPropagate:10,computePointsInsideVolume:!1,getTextLines:C,statsCalculator:_.BasicStatsCalculator,showTextBox:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,s=(0,i.getEnabledElement)(r),{viewport:l,renderingEngine:u}=s;this.isDrawing=!0;const d=l.getCamera(),{viewPlaneNormal:h,viewUp:p}=d;let g,v,y;if(l instanceof i.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(l);y=i.utilities.getVolumeId(e),v=i.cache.getVolume(y),g=i.utilities.getClosestImageId(v,o,h)}const _=i.utilities.getSpacingInNormalDirection(v,h),w=this._getStartCoordinate(o,h),E=this._getEndCoordinate(o,_,h),b=l.getFrameOfReferenceUID(),x={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...h],enabledElement:s,viewUp:[...p],FrameOfReferenceUID:b,referencedImageId:g,toolName:this.getToolName(),volumeId:y,spacingInNormal:_},data:{label:"",startCoordinate:w,endCoordinate:E,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[g],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(x,v),(0,a.lC)(x,r);const C=(0,c.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:x,viewportIdsToRender:C,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),(0,f.hideElementCursor)(r),e.preventDefault(),(0,m.A)(C),x},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=r;if(s&&!l)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,f.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,a.O8)(r.annotationUID);const d=this.getTargetId(u.viewport),h=i.cache.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(r,d,h,u),(0,m.A)(o),s&&(0,g.dZ)(r)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e;let o=(0,a.Rh)(this.getToolName(),r.element);if(!o?.length)return n;o=(0,w.filterAnnotationsWithinSamePlane)(o,r.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let a=0;a<o.length;a++){const u=o[a],{annotationUID:h,data:f}=u,{startCoordinate:m,endCoordinate:g}=f,{points:v,activeHandleIndex:y}=f.handles,_=v.map(e=>r.worldToCanvas(e));c.annotationUID=h;const w=this.getStyle("lineWidth",c,u),E=this.getStyle("lineDash",c,u),b="rgb(255, 255, 255)",x=r.getCamera().focalPoint,C=r.getCamera().viewPlaneNormal;let I=m,S=g;Array.isArray(m)&&(I=this._getCoordinateForViewplaneNormal(I,C),f.startCoordinate=I,f.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(C)]=I,f.startCoordinate=I,f.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(C)]=I),Array.isArray(g)&&(S=this._getCoordinateForViewplaneNormal(S,C),f.endCoordinate=S,f.endCoordinate=S);const D=i.utilities.roundToPrecision(I),A=i.utilities.roundToPrecision(S),T=this._getCoordinateForViewplaneNormal(x,C),N=i.utilities.roundToPrecision(T);if(N<Math.min(D,A)||N>Math.max(D,A))continue;u.invalidated&&this._throttledCalculateCachedStats(u,e);let O,P=!1;if(N!==D&&N!==A||(P=!0),!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,p.isAnnotationVisible)(h))continue;if((0,s.isAnnotationLocked)(h)||this.editData||null===y||!P||(O=[_[y]]),O){const e="0";(0,l.drawHandles)(t,h,e,O,{color:b})}let M=E;P||(M=2);const k="0";if((0,l.drawRect)(t,h,k,_[0],_[3],{color:b,lineDash:M,lineWidth:w}),n=!0,this.configuration.showTextBox&&this.configuration.calculatePointsInsideVolume){const e=this.getLinkedTextBoxStyle(c,u);if(!e.visibility){f.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const n=this.configuration.getTextLines(f);if(!n||0===n.length)continue;if(!f.handles.textBox.hasMoved){const e=(0,d.getTextBoxCoordsCanvas)(_);f.handles.textBox.worldPosition=r.canvasToWorld(e)}const i=r.worldToCanvas(f.handles.textBox.worldPosition),o="1",a=(0,l.drawLinkedTextBox)(t,h,o,n,i,_,{},e),{x:s,y:p,width:m,height:g}=a;f.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([s,p]),topRight:r.canvasToWorld([s+m,p]),bottomLeft:r.canvasToWorld([s,p+g]),bottomRight:r.canvasToWorld([s+m,p+g])}}}return n},this._throttledCalculateCachedStats=(0,u.A)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:i}=e,{viewPlaneNormal:r,spacingInNormal:a}=i,{imageData:s}=t,{startCoordinate:l,endCoordinate:c}=n,{points:u}=n.handles,d=b(s,u[0]),h=b(s,u[0]),p=o.eR.create();s.indexToWorldVec3(d,p);const f=o.eR.create();s.indexToWorldVec3(h,f),2==this._getIndexOfCoordinatesForViewplaneNormal(r)?(p[2]=l,f[2]=c):0==this._getIndexOfCoordinatesForViewplaneNormal(r)?(p[0]=l,f[0]=c):1==this._getIndexOfCoordinatesForViewplaneNormal(r)&&(p[1]=l,f[1]=c);const m=o.eR.distance(p,f),g=[];for(let e=0;e<m;e+=a)g.push(u.map(t=>{const n=o.eR.create();return o.eR.scaleAndAdd(n,t,r,e),Array.from(n)}));n.cachedStats.projectionPoints=g}_computePointsInsideVolume(e,t,n,i){const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:l}=a,{viewport:c}=i,u=o.cachedStats.projectionPoints,d=[[]],p=this.getTargetImageData(t),f=o.handles.points[0],m=o.handles.points[3],{worldWidth:g,worldHeight:v}=(0,h.A)(s,l,f,m),_=(0,r.Op)(p,o.habdles),w=Math.abs(g*v)/(_.scale*_.scale),x={isPreScaled:(0,y.u)(c,t),isSuvScaled:this.isSuvScaled(c,t,e.metadata.referencedImageId)},C=(0,E.j)(a.Modality,e.metadata.referencedImageId,x);for(let e=0;e<u.length;e++){if(!n)continue;const t=u[e][0],{dimensions:i,imageData:r,voxelManager:o}=n,a=b(r,f),l=b(r,t),c=this._getIndexOfCoordinatesForViewplaneNormal(s);a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.floor(a[2]),a[c]=l[c];const h=b(r,m);if(h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]),h[2]=Math.floor(h[2]),h[c]=l[c],this._isInsideVolume(a,h,i)){this.isHandleOutsideImage=!1;const e=[[Math.min(a[0],h[0]),Math.max(a[0],h[0])],[Math.min(a[1],h[1]),Math.max(a[1],h[1])],[Math.min(a[2],h[2]),Math.max(a[2],h[2])]],t=o.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:e,imageData:r,returnPoints:this.configuration.storePointData});d.push(t)}}const I=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=d,o.cachedStats.statistics={Modality:a.Modality,area:w,mean:I.mean?.value,stdDev:I.stdDev?.value,max:I.max?.value,statsArray:I.array,areaUnit:_.areaUnit,modalityUnit:C}}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:r}=t,{cachedStats:o}=n,a=this.getTargetId(r),s=i.cache.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,a,s,t),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,a,s,t),e.invalidated=!1,(0,g.XF)(e,r.element),o}_getStartCoordinate(e,t){const n=e;return this._getCoordinateForViewplaneNormal(n,t)}_getEndCoordinate(e,t,n){const i=this.configuration.numSlicesToPropagate,r=o.eR.create();o.eR.scaleAndAdd(r,e,n,i*t);return this._getCoordinateForViewplaneNormal(r,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t.indexOf(Math.max(...t))}_getCoordinateForViewplaneNormal(e,t){return e[this._getIndexOfCoordinatesForViewplaneNormal(t)]}}function C(e){const t=e.cachedStats.statistics,{area:n,mean:r,max:o,stdDev:a,areaUnit:s,modalityUnit:l}=t;if(void 0===r)return;const c=[];return c.push(`Area: ${i.utilities.roundNumber(n)} ${s}`),c.push(`Mean: ${i.utilities.roundNumber(r)} ${l}`),c.push(`Max: ${i.utilities.roundNumber(o)} ${l}`),c.push(`Std Dev: ${i.utilities.roundNumber(a)} ${l}`),c}x.toolName="RectangleROIStartEndThreshold";const I=x},40336:(e,t,n)=>{"use strict";n.d(t,{A:()=>f});var i=n(15327),r=n(6802),o=n(2076),a=n(40203),s=n(8056),l=n(7001),c=n(58640),u=n(29601),d=n(44049),h=n(4010);class p extends h.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,u=(0,i.getEnabledElement)(o),{viewport:d,renderingEngine:h}=u;this.isDrawing=!0;const p=d.getCamera(),{viewPlaneNormal:f,viewUp:m}=p,g=this.getTargetId(d);let v,y;if(d instanceof i.StackViewport)v=g.split("imageId:")[1];else{y=i.utilities.getVolumeId(g);const e=i.cache.getVolume(y);v=i.utilities.getClosestImageId(e,a,f)}const _=d.getFrameOfReferenceUID(),w={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...f],enabledElement:u,viewUp:[...m],FrameOfReferenceUID:_,referencedImageId:v,toolName:this.getToolName(),volumeId:y},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...a],[...a],[...a],[...a]],activeHandleIndex:null},segmentationId:null}};(0,r.lC)(w,o);const E=(0,s.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:w,viewportIdsToRender:E,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,l.hideElementCursor)(o),e.preventDefault(),(0,c.A)(E),w},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e,{element:s}=i;let l=(0,r.Rh)(this.getToolName(),s);if(!l?.length)return n;if(l=this.filterInteractableAnnotationsForElement(s,l),!l?.length)return n;const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<l.length;e++){const r=l[e],{annotationUID:h,data:p}=r,{points:f,activeHandleIndex:m}=p.handles,g=f.map(e=>i.worldToCanvas(e));c.annotationUID=h;const v=this.getStyle("lineWidth",c,r),y=this.getStyle("lineDash",c,r),_="rgb(255, 255, 255)";if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let w;if((0,d.XF)(r,s),!(0,u.isAnnotationVisible)(h))continue;if((0,o.isAnnotationLocked)(h)||this.editData||null===m||(w=[g[m]]),w){const e="0";(0,a.drawHandles)(t,h,e,w,{color:_})}const E="0";(0,a.drawRect)(t,h,E,g[0],g[3],{color:_,lineDash:y,lineWidth:v}),n=!0}return n}}}p.toolName="RectangleROIThreshold";const f=p},55887:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var i=n(15327),r=n(26047),o=n(31685),a=n(40905),s=n(99737);const{VoxelManager:l}=i.utilities;class c{static{this.COMPOSITIONS=o.A}static{this.childFunctions={[s.StrategyCallbacks.OnInteractionStart]:u(s.StrategyCallbacks.OnInteractionStart,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.OnInteractionEnd]:u(s.StrategyCallbacks.OnInteractionEnd,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.Fill]:u(s.StrategyCallbacks.Fill),[s.StrategyCallbacks.Initialize]:u(s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.CreateIsInThreshold]:d(s.StrategyCallbacks.CreateIsInThreshold),[s.StrategyCallbacks.CreateIsTargetSegment]:d(s.StrategyCallbacks.CreateIsTargetSegment),[s.StrategyCallbacks.AcceptPreview]:u(s.StrategyCallbacks.AcceptPreview,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.RejectPreview]:u(s.StrategyCallbacks.RejectPreview,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.INTERNAL_setValue]:d(s.StrategyCallbacks.INTERNAL_setValue),[s.StrategyCallbacks.Preview]:d(s.StrategyCallbacks.Preview,!1),[s.StrategyCallbacks.ComputeInnerCircleRadius]:u(s.StrategyCallbacks.ComputeInnerCircleRadius),compositions:null}}constructor(e,...t){this._initialize=[],this._fill=[],this._onInteractionStart=[],this.fill=(e,t)=>{const n=this.initialize(e,t,s.StrategyCallbacks.Fill);if(!n)return;const{strategySpecificConfiguration:o={},centerIJK:a}=n;if(i.utilities.isEqual(a,o.centerIJK))return t.preview;o.centerIJK=a,this._fill.forEach(e=>e(n));const{segmentationVoxelManager:l,previewVoxelManager:c,previewSegmentIndex:u}=n;return(0,r.triggerSegmentationDataModified)(n.segmentationId,l.getArrayOfModifiedSlices()),u&&c.modifiedSlices.size?n.preview||n:(l.resetModifiedSlices(),null)},this.onInteractionStart=(e,t)=>{const{preview:n}=t;if(n?.isPreviewFromHover)return void(n.isPreviewFromHover=!1);const i=this.initialize(e,t);i&&this._onInteractionStart.forEach(e=>e.call(this,i))},this.configurationName=e,this.compositions=t,t.forEach(e=>{const t="function"==typeof e?e():e;if(t)for(const e in t){if(!c.childFunctions[e])throw new Error(`Didn't find ${e} as a brush strategy`);c.childFunctions[e](this,t[e])}}),this.strategyFunction=(e,t)=>this.fill(e,t);for(const e of Object.keys(c.childFunctions))this.strategyFunction[e]=this[e]}initialize(e,t,n){const{viewport:i}=e,r=(0,a.S)({operationData:t,viewport:i});if(!r)return console.warn("No data found for BrushStrategy"),t.preview;const{imageVoxelManager:o,segmentationVoxelManager:s,segmentationImageData:c}=r,u=t.override?.voxelManager||s,d=t.override?.imageData||c,h=t.preview?.previewVoxelManager||l.createHistoryVoxelManager({sourceVoxelManager:u}),p={operationName:n,previewSegmentIndex:!!t.previewColors?255:void 0,...t,enabledElement:e,imageVoxelManager:o,segmentationVoxelManager:u,segmentationImageData:d,previewVoxelManager:h,viewport:i,centerWorld:null,isInObject:null,isInObjectBoundsIJK:null,brushStrategy:this};return this._initialize.forEach(e=>e(p)),p}}function u(e,t){const n=`_${e}`;return(i,r)=>{i[n]||=[],i[n].push(r),i[e]||=t?(r,o)=>{const a=i[t](r,o,e);i[n].forEach(e=>e.call(i,a))}:e=>{i[n].forEach(t=>t.call(i,e))}}}function d(e,t=!0){return(n,i)=>{if(n[e])throw new Error(`The singleton method ${e} already exists`);n[e]=t?i:(e,t)=>(t.enabledElement=e,i.call(n,t))}}},31685:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var i=n(84093);const r={[i.A.Initialize]:e=>{const{strategySpecificConfiguration:t}=e;if(!t)return;const{centerSegmentIndex:n}=t;n&&(e.segmentIndex=n.segmentIndex)},[i.A.OnInteractionStart]:e=>{const{segmentIndex:t,previewSegmentIndex:n,segmentationVoxelManager:i,centerIJK:r,strategySpecificConfiguration:o,imageVoxelManager:a,segmentationImageData:s,preview:l}=e;if(!o?.useCenterSegmentIndex)return;delete o.centerSegmentIndex;let c=!1,u=!1;if(a.forEach(({value:e})=>{c||=e===t,u||=e===n},{imageData:s,isInObject:e.isInObject}),!c&&!u)return;let d=i.getAtIJKPoint(r);if(d===n){if(!l)return;d=l.segmentIndex}else u&&(d=null);e.segmentIndex=d,o.centerSegmentIndex={segmentIndex:d}}};var o=n(3823);const a={[i.A.Initialize]:e=>{const{operationName:t,centerIJK:n,strategySpecificConfiguration:r,segmentationVoxelManager:a,imageVoxelManager:s,segmentIndex:l}=e,{THRESHOLD:c}=r;if(!c?.isDynamic||!n||!l)return;if(t===i.A.RejectPreview||t===i.A.OnInteractionEnd)return;const u=a.getBoundsIJK(),{threshold:d,dynamicRadius:h=0}=c,p=d?0:h,f=u.map((e,t)=>{const[i,r]=e;return[Math.max(i,n[t]-p),Math.min(r,n[t]+p)]}),m=d||[1/0,-1/0];s.forEach(({value:e})=>{const t=Array.isArray(e)?o.eR.len(e):e;m[0]=Math.min(t,m[0]),m[1]=Math.max(t,m[1])},{boundsIJK:f}),e.strategySpecificConfiguration.THRESHOLD.threshold=m},[i.A.OnInteractionStart]:e=>{const{strategySpecificConfiguration:t,preview:n}=e;(t?.THRESHOLD?.isDynamic||n)&&(t.THRESHOLD.threshold=null)},[i.A.ComputeInnerCircleRadius]:e=>{const{configuration:t,viewport:n}=e,{THRESHOLD:{dynamicRadius:i=0}={}}=t.strategySpecificConfiguration||{};if(0===i)return;const r=n.getImageData();if(!r)return;const{spacing:o}=r,a=[n.element.clientWidth/2,n.element.clientHeight/2],s=i*o[0],l=n.canvasToWorld(a).map(e=>e+s),c=n.worldToCanvas(l),u=Math.abs(a[0]-c[0]),{strategySpecificConfiguration:d,activeStrategy:h}=t;d[h]||(d[h]={}),d[h].dynamicRadiusInCanvas=u}},s={[i.A.Initialize]:e=>{e.segmentIndex=0}};var l=n(84882),c=n(26047);const u={[i.A.OnInteractionEnd]:e=>{const{previewVoxelManager:t,segmentationVoxelManager:n,strategySpecificConfiguration:i,previewSegmentIndex:r,segmentIndex:o}=e;if(!i.THRESHOLD||null===o)return;const a=t.getPoints();if(!a?.length)return;if(void 0===r)return;const s=t.getBoundsIJK().map((e,t)=>[Math.min(e[0],...a.map(e=>e[t])),Math.max(e[1],...a.map(e=>e[t]))]);if(s.find(e=>e[0]<0||e[1]>65535))return;const u=new Set,d=(e,t,i)=>{if(e<s[0][0]||e>s[0][1]||t<s[1][0]||t>s[1][1]||i<s[2][0]||i>s[2][1])return-1;const a=n.toIndex([e,t,i]);if(u.has(a))return-2;const l=n.getAtIndex(a),c=l===r||l===o?1:0;return c||n.addPoint(a),c};let h=0;const p=(e,i,o)=>{const a=n.toIndex([e,i,o]);u.has(a)||(t.setAtIJK(e,i,o,r),u.add(a),h++)};a.forEach(e=>{1===d(...e)&&(0,l.A)(d,e,{onFlood:p,diagonals:!0})});let f=0,m=0;t.forEach(({index:e,pointIJK:i,value:a})=>{const s=n.getAtIndex(e);if(u.has(e)){m++;const e=a===o?o:r;t.setAtIJKPoint(i,e)}else if(s===r){f++;const e=a??0;t.setAtIJKPoint(i,e)}},{}),h-m!==0&&console.warn("There were flooded=",h,"cleared=",f,"preview count=",m,"not handled",h-m);const g=new Set(n.points||[]);u.clear();for(const e of g.keys()){if(u.has(e))continue;let n=!0;const i=new Set,o=(e,r,o)=>{const a=t.toIndex([e,r,o]);u.add(a),(s[0][0]===s[0][1]||e!==s[0][0]&&e!==s[0][1])&&(s[1][0]===s[1][1]||r!==s[1][0]&&r!==s[1][1])&&(s[2][0]===s[2][1]||o!==s[2][0]&&o!==s[2][1])||(n=!1),n&&i.add(a)},a=t.toIJK(e);if(0===d(...a)&&((0,l.A)(d,a,{onFlood:o,diagonals:!1}),n))for(const e of i)t.setAtIndex(e,r)}(0,c.triggerSegmentationDataModified)(e.segmentationId,t.getArrayOfModifiedSlices())}};var d=n(98798),h=n(93733);const p={[i.A.Preview]:function(e){const{previewColors:t,strategySpecificConfiguration:n,enabledElement:i}=e;if(!t||!n)return;e.preview&&delete e.preview,delete n.centerSegmentIndex,this.onInteractionStart?.(i,e);const r=this.fill(i,e);return r&&(r.isPreviewFromHover=!0,e.preview=r,this.onInteractionEnd?.(i,e)),r},[i.A.Initialize]:e=>{const{segmentIndex:t,previewSegmentIndex:n,previewColors:i,preview:r}=e;if(void 0===i)return;if(r&&(r.previewVoxelManager.sourceVoxelManager=e.segmentationVoxelManager,e.previewVoxelManager=r.previewVoxelManager),null===t||!n)return;const o=i?.[t],a=(0,h.getSegmentIndexColor)(e.viewport.id,e.segmentationId,t);if(!o&&!a)return;const s=o||function(e,t,n,i,r=.4){return[Math.round(e+(255-e)*r),Math.round(t+(255-t)*r),Math.round(n+(255-n)*r),i]}(...a);(0,h.setSegmentIndexColor)(e.viewport.id,e.segmentationId,n,s)},[i.A.AcceptPreview]:e=>{const{segmentationVoxelManager:t,previewVoxelManager:n,previewSegmentIndex:i,preview:r}=e||{};if(void 0===i)return;const o=r?.segmentIndex??e.segmentIndex,a=n;if(!a||0===a.modifiedSlices.size)return;a.forEach(({index:e})=>{t.getAtIndex(e)===i&&t.setAtIndex(e,o)},{}),(0,d.Q)(e.segmentationId,a.getArrayOfModifiedSlices()),a.clear()},[i.A.RejectPreview]:e=>{const{previewVoxelManager:t,segmentationVoxelManager:n}=e;if(0===t.modifiedSlices.size)return;t.forEach(({index:e,value:t})=>{n.setAtIndex(e,t)}),(0,d.Q)(e.segmentationId,t.getArrayOfModifiedSlices()),t.clear()}},f={[i.A.Fill]:e=>{const{segmentsLocked:t,segmentationImageData:n,segmentationVoxelManager:i,previewVoxelManager:r,brushStrategy:o,centerIJK:a}=e,s=o.createIsInThreshold?.(e),l=o.createIsTargetSegment?.(e),{setValue:c}=o,u=s?n=>{const{value:i,index:r}=n;!t.includes(i)&&s(r)&&c(e,n)}:l?n=>{const{value:i,index:r}=n;!t.includes(i)&&l(r)&&c(e,n)}:t=>c(e,t);i.forEach(u,{imageData:n,isInObject:e.isInObject,boundsIJK:e.isInObjectBoundsIJK}),r.addPoint(a)}};n(15327);const m={determineSegmentIndex:r,dynamicThreshold:a,erase:s,islandRemoval:u,preview:p,regionFill:f,setValue:{[i.A.INTERNAL_setValue]:(e,{value:t,index:n})=>{const{segmentsLocked:i,segmentIndex:r,previewVoxelManager:o,previewSegmentIndex:a,segmentationVoxelManager:s}=e,l=s.getAtIndex(n);let c=!1;if(null===r){const e=o.getAtIndex(n);return void(void 0!==e&&(c=o.setAtIndex(n,e)))}if(l===r||i.includes(t))return;if(0===r){const t=e.eraseFocusIndex??0;if(0!==t&&t!==l)return}if(l===a){if(void 0!==o.getAtIndex(n))return;c=s.setAtIndex(n,r)}const u=a??r;c=o.setAtIndex(n,u)}},targetSegment:{[i.A.CreateIsTargetSegment]:e=>{const{segmentationVoxelManager:t,strategySpecificConfiguration:n}=e;if(n)return e=>{const{REPLACE:i,REPLACE_INSIDE_CIRCLE:r}=n,o=t.getScalarData()[e],{targetSegmentIndex:a}=i||r||{};return void 0===a||a===o}}},threshold:{[i.A.CreateIsInThreshold]:e=>{const{imageVoxelManager:t,strategySpecificConfiguration:n,segmentIndex:i}=e;if(n&&i)return e=>{const{THRESHOLD:i,THRESHOLD_INSIDE_CIRCLE:r}=n,a=t.getAtIndex(e),s=Array.isArray(a)?o.eR.length(a):a,{threshold:l}=i||r||{};return!l?.length||l[0]<=s&&s<=l[1]}}}}},33852:(e,t,n)=>{"use strict";n.d(t,{r:()=>a});var i=n(55887),r=n(56789),o=n(31685);const a=new i.A("EraseCircle",o.A.erase,...r.pB.compositions).strategyFunction},1989:(e,t,n)=>{"use strict";n.d(t,{_:()=>a});var i=n(55887),r=n(17492),o=n(31685);const a=new i.A("EraseSphere",o.A.erase,...r.u8.compositions).strategyFunction},56789:(e,t,n)=>{"use strict";n.d(t,{TQ:()=>w,kr:()=>y,mu:()=>f,pB:()=>m,q:()=>_});var i=n(3823),r=n(15327),o=n(87009),a=n(72282),s=n(55887),l=n(99737),c=n(31685),u=n(62783);const{transformWorldToIndex:d,isEqual:h}=r.utilities,p={[l.StrategyCallbacks.Initialize]:e=>{const{points:t,viewport:n,segmentationImageData:r}=e;if(!t)return;const s=i.eR.fromValues(0,0,0);t.forEach(e=>{i.eR.add(s,s,e)}),i.eR.scale(s,s,1/t.length),e.centerWorld=s,e.centerIJK=d(r,s);const l=t.map(e=>n.worldToCanvas(e)),[c,u]=(0,o.getCanvasEllipseCorners)(l),h=n.canvasToWorld(c),p=n.canvasToWorld(u),m=t.map(e=>d(r,e)),g=(0,a.getBoundingBoxAroundShapeIJK)(m,r.getDimensions());e.isInObject=f({topLeftWorld:h,bottomRightWorld:p,center:s}),e.isInObjectBoundsIJK=g}};function f(e){const{topLeftWorld:t,bottomRightWorld:n,center:i}=e,r=Math.abs(t[0]-n[0])/2,a=Math.abs(t[1]-n[1])/2,s=Math.abs(t[2]-n[2])/2,l=Math.max(r,a,s);if(h(r,l)&&h(a,l)&&h(s,l)){const e={center:i,radius:l,radius2:l*l};return t=>(0,u.d)(e,t)}const c={center:i,xRadius:r,yRadius:a,zRadius:s},{precalculated:d}=(0,o.precalculatePointInEllipse)(c,{});return d}const m=new s.A("Circle",c.A.regionFill,c.A.setValue,p,c.A.determineSegmentIndex,c.A.preview),g=new s.A("CircleThreshold",c.A.regionFill,c.A.setValue,p,c.A.determineSegmentIndex,c.A.dynamicThreshold,c.A.threshold,c.A.preview,c.A.islandRemoval),v=new s.A("CircleReplace",...m.compositions,c.A.targetSegment,c.A.islandRemoval),y=m.strategyFunction,_=g.strategyFunction,w=v.strategyFunction},17492:(e,t,n)=>{"use strict";n.d(t,{Jq:()=>p,SX:()=>v,rd:()=>g,u8:()=>h});var i=n(15327),r=n(3823),o=n(55887),a=n(31685),s=n(84093),l=n(56789),c=n(4296);const{transformWorldToIndex:u}=i.utilities,d={[s.A.Initialize]:e=>{const{points:t,viewport:n,segmentationImageData:i}=e;if(!t)return;const o=r.eR.fromValues(0,0,0);t.forEach(e=>{r.eR.add(o,o,e)}),r.eR.scale(o,o,1/t.length),e.centerWorld=o,e.centerIJK=u(i,o);const{boundsIJK:a,topLeftWorld:s,bottomRightWorld:d}=(0,c.R)(t.slice(0,2),i,n);e.isInObjectBoundsIJK=a,e.isInObject=(0,l.mu)({topLeftWorld:s,bottomRightWorld:d,center:o})}},h=new o.A("Sphere",a.A.regionFill,a.A.setValue,d,a.A.determineSegmentIndex,a.A.preview),p=h.strategyFunction,f=new o.A("SphereThreshold",...h.compositions,a.A.dynamicThreshold,a.A.threshold,a.A.islandRemoval),m=new o.A("SphereReplace",...h.compositions,a.A.targetSegment,a.A.islandRemoval),g=f.strategyFunction,v=m.strategyFunction},40905:(e,t,n)=>{"use strict";n.d(t,{S:()=>a});var i=n(15327),r=n(98870),o=n(27108);function a({operationData:e,viewport:t}){let n,a,s,l,c;if(t instanceof i.BaseVolumeViewport){const{volumeId:t,referencedVolumeId:r}=e;if(!t){const e=new CustomEvent(i.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"No volume id found for the segmentation"},cancelable:!0});return i.eventTarget.dispatchEvent(e),null}const o=i.cache.getVolume(t);if(!o)return;if(c=o.voxelManager,r){l=i.cache.getVolume(r).voxelManager}({imageData:n}=o)}else{const{segmentationId:u}=e,d=(0,r.getCurrentLabelmapImageIdForViewport)(t.id,u);if(!d)return;const h=t.getCurrentImageId();if(!h)return;const p=(0,o.wV)(t.id,u);if(!p)return;const f=i.cache.getImage(d);n=p.actor.getMapper().getInputData(),c=f.voxelManager;const m=e.imageId,g=i.cache.getImage(m);if(!g)return;a=g.getPixelData?.();const v=i.cache.getImage(h),y=v?null:t.getImageData();s=v?.getPixelData()||y.getScalarData(),l=v?.voxelManager}return{segmentationImageData:n,segmentationScalarData:a,imageScalarData:s,segmentationVoxelManager:c,imageVoxelManager:l}}},93126:(e,t,n)=>{"use strict";var i;n.d(t,{W:()=>i}),function(e){e[e.CounterClockwise=-1]="CounterClockwise",e[e.Unknown=0]="Unknown",e[e.Clockwise=1]="Clockwise"}(i||(i={}))},13369:()=>{},64485:(e,t,n)=>{"use strict";n.d(t,{i:()=>a,x:()=>l});var i=n(15327),r=n(77840),o=n(3823);function a(e,t,n,o){const a=e.getViewReference(),{viewPlaneNormal:l,FrameOfReferenceUID:c}=a,u={annotationUID:o?.annotationUID||i.utilities.uuidv4(),data:{handles:{points:n}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:t,viewPlaneNormal:l,FrameOfReferenceUID:c,referencedImageId:s(e,n[0],l),...o}};return(0,r.addAnnotation)(u,e.element),u}function s(e,t,n){let r;if(e instanceof i.StackViewport)r=l(e,t,n);else{if(!(e instanceof i.BaseVolumeViewport))throw new Error("getReferencedImageId: viewport must be a StackViewport or BaseVolumeViewport");{const o=function(e){const t=e.getViewReferenceId?.();if(t)return t;if(e instanceof i.BaseVolumeViewport)return`volumeId:${function(e){const t=e.getActors();if(!t)return;return t.find(e=>"vtkVolume"===e.actor.getClassName())?.uid}(e)}`;throw new Error("getTargetId: viewport must have a getTargetId method")}(e),a=i.utilities.getVolumeId(o),s=i.cache.getVolume(a);r=i.utilities.getClosestImageId(s,t,n)}}return r}function l(e,t,n){const r=e.getImageIds();if(!r||!r.length)return;const a=r.map(e=>{const{imagePositionPatient:r}=i.metaData.get("imagePlaneModule",e),a=function(e,t,n){const i=o.eR.create();o.eR.sub(i,e,t);const r=o.eR.dot(i,n);return Math.abs(r)}(t,r,n);return{imageId:e,distance:a}});return a.sort((e,t)=>e.distance-t.distance),a[0].imageId}},76802:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=function(e,t){const n=e.findIndex(([e,t])=>e===t);if(-1===n)throw new Error("3D bounding boxes not supported in an oblique plane");return e[n][0]-=t,e[n][1]+=t,e}},87063:(e,t,n)=>{"use strict";n.d(t,{C:()=>s,g:()=>a});var i=n(15327);const{EPSILON:r}=i.CONSTANTS;function o(e,t,n=!1){let i=1/0,o=n?-1/0:0,a=1/0,s=n?-1/0:0,l=1/0,c=n?-1/0:0;const u=3===e[0]?.length;for(let t=0;t<e.length;t++){const n=e[t];i=Math.min(n[0],i),o=Math.max(n[0],o),a=Math.min(n[1],a),s=Math.max(n[1],s),u&&(l=Math.min(n[2]??l,l),c=Math.max(n[2]??c,c))}return t?(i=Math.max(n?t[0]+r:0,i),o=Math.min(n?t[0]-r:t[0]-1,o),a=Math.max(n?t[1]+r:0,a),s=Math.min(n?t[1]-r:t[1]-1,s),u&&3===t.length&&(l=Math.max(n?t[2]+r:0,l),c=Math.min(n?t[2]-r:t[2]-1,c))):n||(i=Math.max(0,i),o=Math.min(1/0,o),a=Math.max(0,a),s=Math.min(1/0,s),u&&(l=Math.max(0,l),c=Math.min(1/0,c))),u?[[i,o],[a,s],[l,c]]:[[i,o],[a,s],null]}function a(e,t){return o(e,t,!1)}function s(e,t){return o(e,t,!0)}},72282:(e,t,n)=>{"use strict";n.r(t),n.d(t,{extend2DBoundingBoxInViewAxis:()=>i.A,getBoundingBoxAroundShape:()=>r.g,getBoundingBoxAroundShapeIJK:()=>r.g,getBoundingBoxAroundShapeWorld:()=>r.C});var i=n(76802),r=n(87063)},85263:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var i=n(33283);function r(e){if(e.parentAnnotationUID)return;if(!e.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,r=(0,i.T)(t);r.representationData.Contour||(r.representationData.Contour={annotationUIDsMap:new Map});const{annotationUIDsMap:o}=r.representationData.Contour;let a=o.get(n);a||(a=new Set,o.set(n,a)),o.set(n,a.add(e.annotationUID))}},66403:(e,t,n)=>{"use strict";function i(e,t){const{segmentation:n}=e.data,{segmentation:i}=t.data;return n.segmentationId===i.segmentationId&&n.segmentIndex===i.segmentIndex}function r(e){return!!e.data?.segmentation}n.r(t),n.d(t,{addContourSegmentationAnnotation:()=>o.V,areSameSegment:()=>i,isContourSegmentationAnnotation:()=>r,removeContourSegmentationAnnotation:()=>s});var o=n(85263),a=n(33283);function s(e){if(!e.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,i=(0,a.T)(t),{annotationUIDsMap:r}=i?.representationData.Contour||{},o=r?.get(n);o&&(o.delete(e.annotationUID),o.size||r.delete(n))}},93843:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=function(e,t){let n=0;for(let t=0;t<e.length-1;t++){const i=e[t],r=e[t+1];n+=Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))}if(t){const t=e[0],i=e[e.length-1];n+=Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2))}return n}},98013:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(15327),r=n(3823);const{isEqual:o}=i.utilities;function a(e,t){const{polyline:n}=e.data.contour,{points:i}=e.data.handles,{length:a}=i;if(t===a)return n.length;if(t<0&&(t=(t+a)%a),0===t)return 0;const s=i[t],l=n.findIndex(e=>o(s,e));if(-1!==l)return l;let c=1/0;return n.reduce((e,t,n)=>{const i=r.eR.squaredDistance(t,s);return i<c?(c=i,n):e},-1)}},15451:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(55659);function r(e,t){const n=(0,i.A)(e),r=[];return n.forEach(e=>{const n=e.length,i=new Array(n);for(let r=0;r<n;r++)i[r]=t.worldToCanvas(e[r]);r.push(i)}),r}},55659:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(77840);function r(e){return(e.childAnnotationUIDs??[]).map(e=>(0,i.getAnnotation)(e).data.contour.polyline)}},54010:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AnnotationToPointData:()=>b,acceptAutogeneratedInterpolations:()=>D,areCoplanarContours:()=>r,calculatePerimeter:()=>T.A,contourFinder:()=>l,detectContourHoles:()=>u,findHandlePolylineIndex:()=>A.A,generateContourSetsFromLabelmap:()=>v,getContourHolesDataCanvas:()=>C.A,getContourHolesDataWorld:()=>x.A,getDeduplicatedVTKPolyDataPoints:()=>c,updateContourPolyline:()=>I.A});var i=n(3823);function r(e,t){const{viewPlaneNormal:n}=e.metadata,{viewPlaneNormal:r}=t.metadata,o=i.eR.dot(n,r);if(!i.Fd.equals(1,Math.abs(o)))return!1;const{polyline:a}=e.data.contour,{polyline:s}=t.data.contour,l=i.eR.dot(n,a[0]),c=i.eR.dot(n,s[0]);return i.Fd.equals(l,c)}function o(e,t,n){let i=-1;if(t.forEach((t,n)=>{i>=0||t.a==e.b&&(i=n)}),i>=0){const e=t[i];return t.splice(i,1),n.push(e.b),n[0]==e.b?{remainingLines:t,contourPoints:n,type:"CLOSED_PLANAR"}:o(e,t,n)}return{remainingLines:t,contourPoints:n,type:"OPEN_PLANAR"}}function a(e){if(0==e.length)return[];const t=[],n=e.shift();t.push(n.a),t.push(n.b);const i=o(n,e,t);if(0==i.remainingLines.length)return[{type:i.type,contourPoints:i.contourPoints}];{const e=a(i.remainingLines);return e.push({type:i.type,contourPoints:i.contourPoints}),e}}function s(e){return a(e)}const l={findContours:a,findContoursFromReducedSet:s};function c(e,t=!1){const n=e.getPoints(),i=e.getLines(),r=new Array(n.getNumberOfPoints()).fill(0).map((e,t)=>n.getPoint(t).slice()),o=new Array(i.getNumberOfCells()).fill(0).map((e,t)=>{const n=i.getCell(3*t).slice();return{a:n[0],b:n[1]}});if(t)return{points:r,lines:o};const a=[];for(const[e,t]of r.entries()){const n=a.findIndex(e=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]);if(n>=0)o.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t));else{const n=a.length;a.push(t),o.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t))}}return{points:a,lines:o.filter(e=>e.a!==e.b)}}const u={processContourHoles:function(e,t,n=!0){const i=e.filter(e=>"CLOSED_PLANAR"!==e.type),r=e.filter(e=>"CLOSED_PLANAR"===e.type),o=[];let a=[];return r.forEach((e,n)=>{const i=[];r.forEach((r,o)=>{n!=o&&function(e,t,n){const i=[];e.contourPoints.forEach(e=>{i.push([n[e][0],n[e][1]])});let r=0;return t.contourPoints.forEach(e=>{const t=((e,t)=>{const n=e[0],i=e[1];let r=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){const a=t[e][0],s=t[e][1],l=t[o][0],c=t[o][1];s>i!=c>i&&n<(l-a)*(i-s)/(c-s)+a&&(r=!r)}return r})([n[e][0],n[e][1]],i);t||r++}),0===r}(e,r,t)&&i.push(o)}),i.length>0?o.push({contour:e,holes:i}):a.push(n)}),n&&(o.forEach(e=>{e.contour.type="CLOSEDPLANAR_XOR",i.push(e.contour),e.holes.forEach(e=>{r[e].type="CLOSEDPLANAR_XOR",i.push(r[e]),a=a.filter(t=>t!==e)})}),a.forEach(e=>{i.push(r[e])})),i}};var d=n(15327),h=n(25616),p=n(42008),f=n(58498),m=n(18682);const{Labelmap:g}=m.A;function v({segmentations:e}){const{representationData:t,segments:n=[0,1]}=e,{volumeId:i}=t[g],r=d.cache.getVolume(i);if(!r)return void console.warn(`No volume found for ${i}`);const o=r.dimensions[2],a=r.voxelManager,l=r.dimensions[0]*r.dimensions[1];for(let e=0;e<o;e++)for(let t=0;t<r.dimensions[1];t++){const n=t*r.dimensions[0]+e*l;a.setAtIndex(n,0),a.setAtIndex(n+r.dimensions[0]-1,0)}const u=[],{FrameOfReferenceUID:m}=r.metadata,v=n.length;for(let e=0;e<v;e++){const t=n[e];if(!t)continue;const i=[],d=p.Ay.newInstance({name:"Scalars",numberOfComponents:1,size:l*o,dataType:"Uint8Array"}),{containedSegmentIndices:g}=t;for(let t=0;t<o;t++){if(y(t,a,l,e))continue;const n=t*l;try{for(let t=0;t<l;t++){const i=a.getAtIndex(t+n);i===e||g?.has(i)?d.setValue(t+n,1):d.setValue(t,0)}const o=h.Ay.newInstance({slice:t}),u=f.Ay.newInstance();u.shallowCopy(r.imageData),u.getPointData().setScalars(d),o.setInputData(u);const p=[1];o.setContourValues(p),o.setMergePoints(!1);const v=c(o.getOutputData());if(v.points?.length){const e=s(v.lines);i.push({contours:e,polyData:v,FrameNumber:t+1,sliceIndex:t,FrameOfReferenceUID:m})}}catch(e){console.warn(t),console.warn(e)}}const v={FrameOfReferenceUID:m},_={label:t.label,color:t.color,metadata:v,sliceContours:i};u.push(_)}return u}function y(e,t,n,i){const r=e*n,o=r+n;for(let e=r;e<o;e++)if(t.getAtIndex(e)===i)return!1;return!0}class _{constructor(){}static getContourSequence(e,t){const{data:n}=e,{projectionPoints:i,projectionPointsImageIds:r}=n.cachedStats;return i.map((e,n)=>{const i=function(e){const t=[...e[0],...e[1],...e[3],...e[2]],n=t.flat().map(e=>e.toFixed(2));return n}(e),o=function(e,t){const n=t.get("sopCommonModule",e);return{ReferencedSOPClassUID:n.sopClassUID,ReferencedSOPInstanceUID:n.sopInstanceUID}}(r[n],t);return{NumberOfContourPoints:i.length/3,ContourImageSequence:o,ContourGeometricType:"CLOSED_PLANAR",ContourData:i}})}}_.toolName="RectangleROIStartEndThreshold";const w=_;class E{static{this.TOOL_NAMES={}}constructor(){}static convert(e,t,n){!function(e){if(!e?.data)throw new Error("Tool data is empty");if(!e.metadata||e.metadata.referencedImageId)throw new Error("Tool data is not associated with any imageId")}(e);const{toolName:i}=e.metadata,r=E.TOOL_NAMES[i];if(!r)throw new Error(`Unknown tool type: ${i}, cannot convert to RTSSReport`);const o=r.getContourSequence(e,n);return{ReferencedROINumber:t+1,ROIDisplayColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],ContourSequence:o}}static register(e){E.TOOL_NAMES[e.toolName]=e}}E.register(w);const b=E;var x=n(55659),C=n(15451),I=n(72967),S=n(15773);function D(e,t){S.A.acceptAutoGenerated(e,t)}var A=n(98013),T=n(93843)},72967:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(15327),r=n(51440),o=n(77840);function a(e,t,n,a){const{canvasToWorld:s,worldToCanvas:l}=n,{data:c}=e,{targetWindingDirection:u}=t;let{points:d}=t,h=r.polyline.getWindingDirection(d);a?.decimate?.enabled&&(d=r.polyline.decimate(t.points,a?.decimate?.epsilon));let{closed:p}=t;const f=d.length,m=new Array(f),g=(r.polyline.getWindingDirection(d),(0,o.getParentAnnotation)(e));if(void 0===p){let e=!1;if(d.length>3){const t=r.point.distanceToPointSquared(d[0],d[f-1]);e=i.utilities.isEqual(0,t)}p=e}if(!1!==a?.updateWindingDirection){let e=g?-1*g.data.contour.windingDirection:u;void 0===e&&(e=h),e!==h&&d.reverse();const t=c.handles.points.map(e=>l(e));if(t.length>2){r.polyline.getWindingDirection(t)!==e&&c.handles.points.reverse()}h=e}for(let e=0;e<f;e++)m[e]=s(d[e]);c.contour.polyline=m,c.contour.closed=p,c.contour.windingDirection=h,(0,o.invalidateAnnotation)(e)}},52905:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(45217);const r=function(e,t,n){let r,o,a,s,l,c,u=0,d=!1,h=!1,p=!0;const f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){const n=r,i=o;return r=o=void 0,u=t,s=e.apply(i,n),s}function g(e,t){return f?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-c;return void 0===c||n>=t||n<0||h&&e-u>=a}function y(){const e=Date.now();if(v(e))return _(e);l=g(y,function(e){const n=e-u,i=t-(e-c);return h?Math.min(i,a-n):i}(e))}function _(e){return l=void 0,p&&r?m(e):(r=o=void 0,s)}function w(...e){const n=Date.now(),i=v(n);if(r=e,o=this,c=n,i){if(void 0===l)return function(e){return u=e,l=g(y,t),d?m(e):s}(c);if(h)return l=g(y,t),m(c)}return void 0===l&&(l=g(y,t)),s}return t=Number(t)||0,(0,i.A)(n)&&(d=Boolean(n.leading),h="maxWait"in n,a=h?Math.max(Number(n.maxWait)||0,t):a,p="trailing"in n?Boolean(n.trailing):p),w.cancel=function(){void 0!==l&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),u=0,r=c=o=l=void 0},w.flush=function(){return void 0===l?s:_(Date.now())},w.pending=function(){return void 0!==l},w}},66990:(e,t,n)=>{"use strict";function i(e){const t=function(e){const t=[e[0],e[1]].sort(a),n=[e[0],e[1]].sort(s),i=t[t.length-1],r=n[0],o=n[n.length-1];return{top:r,bottom:o,right:i};function a(e,t){return e[0]<t[0]?-1:1}function s(e,t){return e[1]<t[1]?-1:1}}(e),n=(t.top[1]+t.bottom[1])/2;return[t.right[0],n]}n.r(t),n.d(t,{getTextBoxCoordsCanvas:()=>i})},4096:(e,t,n)=>{"use strict";n.d(t,{CQ:()=>p,Op:()=>d,Xw:()=>h});var i=n(15327);const{CalibrationTypes:r}=i.Enums,o="px",a=[1],s=["3,3"],l=["4,3"],c={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},u="",d=(e,t)=>{const{calibration:n,hasPixelSpacing:l}=e;let d=l?"mm":o,h=d+u,p=1,f="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:d,areaUnit:h,scale:p};if(n.type===r.UNCALIBRATED)return{unit:o,areaUnit:o+u,scale:p};if(n.sequenceOfUltrasoundRegions){let e,r;if(Array.isArray(t)&&2===t.length)[e,r]=t;else if("function"==typeof t){const n=t();e=n[0],r=n[1]}let l=n.sequenceOfUltrasoundRegions.filter(t=>e[0]>=t.regionLocationMinX0&&e[0]<=t.regionLocationMaxX1&&e[1]>=t.regionLocationMinY0&&e[1]<=t.regionLocationMaxY1&&r[0]>=t.regionLocationMinX0&&r[0]<=t.regionLocationMaxX1&&r[1]>=t.regionLocationMinY0&&r[1]<=t.regionLocationMaxY1);if(!l?.length)return{unit:d,areaUnit:h,scale:p};if(l=l.filter(e=>a.includes(e.regionDataType)&&s.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`)),!l.length)return{unit:o,areaUnit:o+u,scale:p};const m=l[0],g=Math.abs(m.physicalDeltaX),v=Math.abs(m.physicalDeltaY);if(!i.utilities.isEqual(g,v,.001))return{unit:o,areaUnit:o+u,scale:p};p=1/g,f="US Region",d=c[m.physicalUnitsXDirection]||"unknown",h=d+u}else n.scale&&(p=n.scale);return[r.ERMF,r.USER,r.ERROR,r.PROJECTION].includes(n?.type)&&(f=n.type),{unit:d+(f?` ${f}`:""),areaUnit:h+(f?` ${f}`:""),scale:p}},h=(e,t)=>{const[n]=t,{calibration:i}=e;let r=["raw"],o=[null],s="";if(!i||!i.type&&!i.sequenceOfUltrasoundRegions)return{units:r,values:o};if(i.sequenceOfUltrasoundRegions){const e=i.sequenceOfUltrasoundRegions.filter(e=>a.includes(e.regionDataType)&&l.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`));if(!e?.length)return{units:r,values:o};const t=e.find(e=>n[0]>=e.regionLocationMinX0&&n[0]<=e.regionLocationMaxX1&&n[1]>=e.regionLocationMinY0&&n[1]<=e.regionLocationMaxY1);if(!t)return{units:r,values:o};const{referencePixelX0:u=0,referencePixelY0:d=0}=t,{physicalDeltaX:h,physicalDeltaY:p}=t,f=(n[1]-t.regionLocationMinY0-d)*p;s="US Region",o=[(n[0]-t.regionLocationMinX0-u)*h,f],r=[c[t.physicalUnitsXDirection],c[t.physicalUnitsYDirection]]}return{units:r,values:o,calibrationType:s}},p=e=>e.calibration?.aspect||1},40634:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=n(15327);function r(e,t,n){return"CT"===e?"HU":"PT"===e?function(e,t){if(!t.isPreScaled)return"raw";if(t.isSuvScaled)return"SUV";const n=i.metaData.get("generalSeriesModule",e);if("PT"===n?.modality){const t=i.metaData.get("petSeriesModule",e);return t?.units||"unitless"}return"unknown"}(t,n):""}},4296:(e,t,n)=>{"use strict";n.d(t,{R:()=>s});var i=n(15327),r=n(3823),o=n(72282);const{transformWorldToIndex:a}=i.utilities;function s(e,t,n){const[i,s]=e,l=r.eR.fromValues((i[0]+s[0])/2,(i[1]+s[1])/2,(i[2]+s[2])/2),c=r.eR.distance(i,s)/2;if(!n)throw new Error("viewport is required in order to calculate the sphere bounds");const{boundsIJK:u,topLeftWorld:d,bottomRightWorld:h}=function(e,t,n,i,s){const[l,c]=n,u=e.getDimensions(),d=t.getCamera(),h=r.eR.fromValues(d.viewUp[0],d.viewUp[1],d.viewUp[2]),p=r.eR.fromValues(d.viewPlaneNormal[0],d.viewPlaneNormal[1],d.viewPlaneNormal[2]),f=r.eR.create();r.eR.cross(f,h,p);const m=r.eR.create(),g=r.eR.create();r.eR.scaleAndAdd(m,c,p,s),r.eR.scaleAndAdd(g,l,p,-s),r.eR.scaleAndAdd(m,m,f,-s),r.eR.scaleAndAdd(g,g,f,s);const v=a(e,m),y=a(e,g),_=n.map(t=>a(e,t)),w=(0,o.getBoundingBoxAroundShapeIJK)([v,y,..._],u);return{boundsIJK:w,topLeftWorld:m,bottomRightWorld:g}}(t,n,e,0,c);return{boundsIJK:u,centerWorld:l,radiusWorld:c,topLeftWorld:d,bottomRightWorld:h}}},39848:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(15327),r=n(7754);function o(e,t){const n=(0,i.getEnabledElement)(e),{renderingEngineId:o,viewportId:a}=n,s=(0,r.getToolGroupForViewport)(a,o);if(!s)return[];const l=[],c=Object.keys(s.toolOptions);for(let e=0;e<c.length;e++){const n=c[e],i=s.toolOptions[n];if(i&&t.includes(i.mode)){const e=s.getToolInstance(n);l.push(e)}}return l}},62514:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(15295);function r(e){const t=(0,i.A)(e);return t.length?t[0]:void 0}},15295:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(15327);const{isEqual:r}=i.utilities;function o(e){const{metadata:t}=e;return(0,i.getEnabledElements)().filter(e=>{if(e.FrameOfReferenceUID===t.FrameOfReferenceUID){const n=e.viewport,{viewPlaneNormal:i,viewUp:o}=n.getCamera();return r(i,t.viewPlaneNormal)&&(!t.viewUp||r(o,t.viewUp))}}).map(e=>e.viewport)}},52606:(e,t,n)=>{"use strict";n.r(t),n.d(t,{annotationFrameRange:()=>D,annotationHydration:()=>T.i,boundingBox:()=>ee,calibrateImageSpacing:()=>_,cine:()=>r,contourSegmentation:()=>Fe,contours:()=>N,debounce:()=>m.A,drawing:()=>P,dynamicVolume:()=>s,getAnnotationNearPoint:()=>h,getAnnotationNearPointOnEnabledElement:()=>p,getCalibratedAspect:()=>w.CQ,getCalibratedLengthUnitsAndScale:()=>w.Op,getCalibratedProbeUnitsAndValue:()=>w.Xw,getClosestImageIdForStackViewport:()=>T.x,getSphereBoundsInfo:()=>C.R,getViewportForAnnotation:()=>A.A,isObject:()=>v.A,math:()=>M,orientation:()=>i,planar:()=>k,planarFreehandROITool:()=>o,pointInSurroundingSphereCallback:()=>Ve,pointToString:()=>I.l,polyDataUtils:()=>l,rectangleROITool:()=>a,roundNumber:()=>We,segmentation:()=>O,stackContextPrefetch:()=>Ce,stackPrefetch:()=>ye,throttle:()=>g.A,touch:()=>Se,triggerAnnotationRender:()=>x.A,triggerAnnotationRenderForToolGroupIds:()=>b.A,triggerAnnotationRenderForViewportIds:()=>E.A,triggerEvent:()=>c.triggerEvent,viewport:()=>Ie,viewportFilters:()=>R,voi:()=>Le});var i={};n.r(i),n.d(i,{getOrientationStringLPS:()=>L,invertOrientationStringLPS:()=>F});var r={};n.r(r),n.d(r,{Events:()=>V,addToolState:()=>j,getToolState:()=>H,playClip:()=>X,stopClip:()=>K});var o={};n.r(o),n.d(o,{default:()=>re,smoothAnnotation:()=>ie});var a={};n.r(a),n.d(a,{getBoundsIJKFromRectangleAnnotations:()=>oe.A,isAxisAlignedRectangle:()=>ae.l});var s={};n.r(s),n.d(s,{generateImageFromTimeData:()=>Oe,getDataInTime:()=>Ae,updateVolumeFromTimeData:()=>Pe});var l={};n.r(l),n.d(l,{getPoint:()=>Me,getPolyDataPointIndexes:()=>ke,getPolyDataPoints:()=>Re});var c=n(15327),u=n(77840),d=n(7754);function h(e,t,n=5){const i=(0,c.getEnabledElement)(e);if(!i)throw new Error("getAnnotationNearPoint: enabledElement not found");return p(i,t,n)}function p(e,t,n){const{renderingEngineId:i,viewportId:r}=e,o=d.getToolGroupForViewport(r,i);if(!o)return null;const{_toolInstances:a}=o;for(const i in a){const r=f(a[i],e,t,n);if(r)return r}return null}function f(e,t,n,i){const{viewport:r}=t,o=(0,u.getAnnotations)(e.constructor.toolName,r?.element),a=r?.getCurrentImageId?.();if(o?.length){const{element:r}=t.viewport;for(const t of o){const o=t.metadata?.referencedImageId;if(!(a&&o&&a!==o||!e.isPointNearTool)&&(e.isPointNearTool(r,t,n,i,"")||e.getHandleNearImagePoint(r,t,n,i)))return t}}return null}var m=n(52905),g=n(27730),v=n(45217);const{calibratedPixelSpacingMetadataProvider:y}=c.utilities;function _(e,t,n){"number"==typeof n&&(n={type:c.Enums.CalibrationTypes.USER,scale:n}),y.add(e,n);t.getStackViewports().forEach(t=>{t.getImageIds().includes(e)&&t.calibrateSpacing(e)})}var w=n(4096),E=n(58640),b=n(94779),x=n(56069),C=n(4296),I=n(38726),S=n(94021);class D{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static imageIdToFrames(e){const t=e.match(this.frameRangeExtractor);if(!t||!t[2])return null;const n=t[2].split("-").map(e=>Number(e));return 1===n.length?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,t){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const i=this.framesToString(t);return e.replace(this.frameRangeExtractor,`${n[1]}${i}`)}static setFrameRange(e,t,n){const{referencedImageId:i}=e.metadata;e.metadata.referencedImageId=this.framesToImageId(i,t);const r={...n,annotation:e};(0,c.triggerEvent)(c.eventTarget,S.A.ANNOTATION_MODIFIED,r)}static getFrameRange(e){return this.imageIdToFrames(e.metadata.referencedImageId)}}var A=n(62514),T=n(64485),N=n(54010),O=n(74802),P=n(66990),M=n(51440),k=n(13165),R=n(8056);function L(e){let t="";const n=e[0]<0?"R":"L",i=e[1]<0?"A":"P",r=e[2]<0?"F":"H",o=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],a=1e-4;for(let e=0;e<3;e++)if(o[0]>a&&o[0]>o[1]&&o[0]>o[2])t+=n,o[0]=0;else if(o[1]>a&&o[1]>o[0]&&o[1]>o[2])t+=i,o[1]=0;else if(o[2]>a&&o[2]>o[0]&&o[2]>o[1])t+=r,o[2]=0;else if(o[0]>a&&o[1]>a&&o[0]===o[1])t+=n+i,o[0]=0,o[1]=0;else if(o[0]>a&&o[2]>a&&o[0]===o[2])t+=n+r,o[0]=0,o[2]=0;else{if(!(o[1]>a&&o[2]>a&&o[1]===o[2]))break;t+=i+r,o[1]=0,o[2]=0}return t}function F(e){let t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase(),t}var U,B=n(3823);!function(e){e.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",e.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"}(U||(U={}));const V=U,W={};function j(e,t){const n=(0,c.getEnabledElement)(e),{viewportId:i}=n;W[i]=t}function H(e){const t=(0,c.getEnabledElement)(e),{viewportId:n}=t;return W[n]}const{ViewportStatus:z}=c.Enums,{triggerEvent:G}=c.utilities,q=!0,$=new Map;function X(e,t){let n,i;if(void 0===e)throw new Error("playClip: element must not be undefined");const r=(0,c.getEnabledElement)(e);if(!r)throw new Error("playClip: element must be a valid Cornerstone enabled element");t||(t={}),t.dynamicCineEnabled=t.dynamicCineEnabled??!0;const{viewport:o}=r,a=function(e,t){if(e instanceof c.StackViewport)return function(e,t){const n=e.getImageIds();return{get numScrollSteps(){return n.length},get currentStepIndex(){return e.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(n){this.waitForRenderedCount<=t&&e.viewportStatus!==z.RENDERED?this.waitForRenderedCount++:(this.waitForRenderedCount=0,c.utilities.scroll(e,{delta:n,debounceLoading:q}))}}}(e,t.waitForRendered??30);if(e instanceof c.VolumeViewport){const n=Q(e);return t.dynamicCineEnabled&&n?.isDynamicVolume()?function(e){return{get numScrollSteps(){return e.numTimePoints},get currentStepIndex(){return e.timePointIndex},get frameTimeVectorEnabled(){return!1},scroll(t){e.scroll(t)}}}(n):function(e,t){const{volumeId:n}=t,i={viewPlaneNormal:B.eR.create(),scrollInfo:null},r=()=>{const t=e.getCamera();if(!i.scrollInfo||!B.eR.equals(t.viewPlaneNormal,i.viewPlaneNormal)){const r=c.utilities.getVolumeViewportScrollInfo(e,n);i.viewPlaneNormal=t.viewPlaneNormal,i.scrollInfo=r}return i.scrollInfo};return{get numScrollSteps(){return r().numScrollSteps},get currentStepIndex(){return r().currentStepIndex},get frameTimeVectorEnabled(){const n=e.getCamera(),i=t.direction.slice(6,9).map(e=>-e),r=B.eR.dot(i,n.viewPlaneNormal);return B.Fd.equals(r,1)},scroll(t){r().currentStepIndex+=t,c.utilities.scroll(e,{delta:t})}}}(e,n)}if(e instanceof c.VideoViewport)return function(e,t){return{get numScrollSteps(){return e.getNumberOfSlices()},get currentStepIndex(){return e.getSliceIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(n){this.waitForRenderedCount<=t&&e.viewportStatus!==z.RENDERED?this.waitForRenderedCount++:(this.waitForRenderedCount=0,c.utilities.scroll(e,{delta:n,debounceLoading:q}))},play:t=>(t&&e.setPlaybackRate(t/24),e.play(),e.getFrameRate())}}(e,t.waitForRendered??30);throw new Error("Unknown viewport type")}(o,t);let s=H(e);const l=t.dynamicCineEnabled;if(l&&J(e),s?Y(e,{stopDynamicCine:!l,viewportId:o.id}):(s={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:t.frameTimeVector??void 0,speed:t.frameTimeVectorSpeedMultiplier??1,reverse:t.reverse??!1,loop:t.loop??!0},j(e,s)),s.dynamicCineEnabled=t.dynamicCineEnabled,(t.framesPerSecond<0||t.framesPerSecond>0)&&(s.framesPerSecond=Number(t.framesPerSecond),s.reverse=s.framesPerSecond<0,s.ignoreFrameTimeVector=!0),!0!==s.ignoreFrameTimeVector&&s.frameTimeVector&&s.frameTimeVector.length===a.numScrollSteps&&a.frameTimeVectorEnabled){const{timeouts:e,isTimeVarying:t}=function(e,t){let n,i,r,o=0;const a=e.length,s=[];let l=!1;("number"!=typeof t||t<=0)&&(t=1);for(n=1;n<a;n++)r=Number(e[n])/t|0,s.push(r),1===n?i=r:r!==i&&(l=!0),o+=r;s.length>0&&(r=l?o/s.length|0:s[0],s.push(r));return{timeouts:s,isTimeVarying:l}}(s.frameTimeVector,s.speed);n=e,i=t}const u=()=>{const{numScrollSteps:t,currentStepIndex:n}=a;let i=n+(s.reverse?-1:1);const r=i<0||i>=t;if(!s.loop&&r){Y(e,{stopDynamicCine:!l,viewportId:o.id});const t={element:e};return void G(e,V.CLIP_STOPPED,t)}i>=t?i=0:i<0&&(i=t-1);const c=i-n;if(c)try{a.scroll(c)}catch(t){return console.warn("Play clip not scrolling",t),Z(s),void G(e,V.CLIP_STOPPED,d)}};if(l){const t=Q(o);t&&$.set(t.volumeId,e)}a.play?s.framesPerSecond=a.play(t.framesPerSecond):n&&n.length>0&&i?(s.usingFrameTimeVector=!0,s.intervalId=window.setTimeout(function e(){s.intervalId=window.setTimeout(e,n[a.currentStepIndex]),u()},0)):(s.usingFrameTimeVector=!1,s.intervalId=window.setInterval(u,1e3/Math.abs(s.framesPerSecond)));const d={element:e};G(e,V.CLIP_STARTED,d)}function K(e,t={}){Y(e,{stopDynamicCine:!0,...t})}function Y(e,t={stopDynamicCine:!0,viewportId:void 0}){const{stopDynamicCine:n,viewportId:i}=t,r=(0,c.getEnabledElement)(e);let o;const a=r?.viewport;if(r){const{viewport:e}=r;o=H(e.element)}else{if(!i)return;o=function(e){return W[e]}(i)}o&&Z(o),a instanceof c.VideoViewport?a.pause():n&&a instanceof c.BaseVolumeViewport&&J(e)}function J(e){const{viewport:t}=(0,c.getEnabledElement)(e);if(t instanceof c.VolumeViewport){const n=Q(t);if(n?.isDynamicVolume()){const t=$.get(n.volumeId);$.delete(n.volumeId),t&&t!==e&&K(t)}}}function Z(e){const t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function Q(e){if(!(e instanceof c.VolumeViewport))return;const t=e.getAllVolumeIds();if(!t?.length)return;const n=t.find(e=>c.cache.getVolume(e)?.isDynamicVolume()),i=n??t[0];return c.cache.getVolume(i)}var ee=n(72282),te=n(27062);function ne(e,t=Math.floor(Math.random()*(e.length-1))){if(0===t)return 0;const n=[...e],{length:i}=e;for(let r=0;r<i;r++)e[r]=n[(r+t+i)%i];return t}function ie(e,t){if(function(e,t){const n=t?.knotsRatioPercentage||30;return!e?.data?.contour?.polyline?.length||n<=0}(e,t))return!1;const{viewPlaneNormal:n}=e.metadata,{closed:i,polyline:r}=e.data.contour,o=function(e,t){const n=B.pB.create(),i=B.eR.add(B.eR.create(),t,e),r=Math.abs(e[0])>.1?B.eR.fromValues(-e[1],e[0],0):B.eR.fromValues(0,-e[2],e[1]);return B.pB.lookAt(n,t,i,r),n}(n,e.data.contour.polyline[0]),a=e.data.contour.polyline.map(e=>{const t=B.eR.transformMat4(B.eR.create(),e,o);return[t[0],t[1]]});let s=i?ne(a):0,l=(0,te.A)(a,0,a.length,t?.knotsRatioPercentage||30);if(l===a)return!1;ne(l,-s);for(let e=1;e<t?.loop;e++)s=i?ne(l):0,l=(0,te.A)(l,0,a.length,t?.knotsRatioPercentage||30),ne(l,-s);const c=B.pB.invert(B.pB.create(),o);return e.data.contour.polyline=l.map(e=>B.eR.transformMat4([0,0,0],[...e,0],c)),!0}const re={smoothAnnotation:ie};var oe=n(37162),ae=n(26384);const se={};function le(e,t){const n=(0,c.getEnabledElement)(e),{viewportId:i}=n;se[i]=t}function ce(e){const t=(0,c.getEnabledElement)(e),{viewportId:n}=t;return se[n]}const ue=c.Enums.RequestType.Prefetch;function de(e,t){e=Math.round(e)||0;const n=[];let i=(t=Math.round(t)||0)-e+1;if(i<=0)return n;for(;i--;)n[i]=t--;return n}function he(e){const t=(0,c.getEnabledElement)(e);if(!t)return null;const{viewport:n}=t;return n instanceof c.StackViewport?{currentImageIdIndex:n.getCurrentImageIdIndex(),imageIds:n.getImageIds()}:null}function pe(e){return function(t){const n=t.detail;let i;try{i=he(e)}catch(e){return}if(!i||!i.imageIds||0===i.imageIds.length)return;const r=i.imageIds.indexOf(n.imageId);if(r<0)return;const o=ce(e);o&&o.indicesToRequest&&o.indicesToRequest.length&&o.indicesToRequest.push(r)}}let fe,me={maxImagesToPrefetch:1/0,preserveExistingPool:!0};function ge(e){const t=ce(e);if(!t)return;const n=t||{},i=he(e);if(!i?.imageIds?.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const{currentImageIdIndex:r}=i;if(n.enabled=n.enabled&&(n.indicesToRequest?.length??0)>0,!1===n.enabled)return;function o(e){const t=n.indicesToRequest.indexOf(e);t>-1&&n.indicesToRequest.splice(t,1)}t.indicesToRequest.sort((e,t)=>e-t);if(n.indicesToRequest.slice().forEach(function(e){const t=i.imageIds[e];if(!t)return;(Math.abs(r-e)<6?c.cache.getImageLoadObject(t):c.cache.isLoaded(t))&&o(e)}),!n.indicesToRequest.length)return;me.preserveExistingPool||c.imageLoadPoolManager.clearRequestStack(ue);const a=function(e,t){let n=0,i=e.length-1;return e.forEach((e,r)=>{e<t?n=Math.max(r,n):e>t&&(i=Math.min(r,i))}),{low:n,high:i}}(n.indicesToRequest,i.currentImageIdIndex);let s,l;let u=a.low,d=a.high;const h=[];for(;u>=0||d<n.indicesToRequest.length;){const e=i.currentImageIdIndex,t=!(e-n.indicesToRequest[u]>me.maxImagesToPrefetch)&&u>=0,r=!(n.indicesToRequest[d]-e>me.maxImagesToPrefetch)&&d<n.indicesToRequest.length;if(!r&&!t)break;t&&(l=n.indicesToRequest[u--],s=i.imageIds[l],h.push(s)),r&&(l=n.indicesToRequest[d++],s=i.imageIds[l],h.push(s))}const p=(e,t)=>c.imageLoader.loadAndCacheImage(e,t);h.forEach(e=>{const t={requestType:ue};c.imageLoadPoolManager.addRequest(p.bind(null,e,t),ue,{imageId:e},0)})}function ve(e){clearTimeout(fe),fe=setTimeout(function(){const t=e.target;try{ge(t)}catch(e){return}},10)}const ye={enable:function(e){const t=he(e);if(!t||!t.imageIds||0===t.imageIds.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const n={indicesToRequest:de(0,t.imageIds.length-1),enabled:!0,direction:1},i=n.indicesToRequest.indexOf(t.currentImageIdIndex);n.indicesToRequest.splice(i,1),le(e,n),ge(e),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,ve),e.addEventListener(c.Enums.Events.STACK_NEW_IMAGE,ve);const r=pe(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,r),c.eventTarget.addEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,r)},disable:function(e){clearTimeout(fe),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,ve);const t=pe(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,t);const n=ce(e);n&&n.indicesToRequest.length&&(n.enabled=!1,c.imageLoadPoolManager.clearRequestStack(ue))},getConfiguration:function(){return me},setConfiguration:function(e){me=e}};let _e,we={maxImagesToPrefetch:1/0,minBefore:2,maxAfter:2,directionExtraImages:10,preserveExistingPool:!1};function Ee(e){const t=he(e);if(!t)return;if(!t?.imageIds?.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const n=ce(e);if(!n)return;const i=n||{};if(i.enabled=i.enabled&&(i.indicesToRequest?.length??0)>0,!1===i.enabled)return;function r(e){const t=i.indicesToRequest.indexOf(e);t>-1&&i.indicesToRequest.splice(t,1)}const o=i.indicesToRequest.slice(),{currentImageIdIndex:a}=t;if(o.forEach(e=>{const n=t.imageIds[e];if(!n)return;(Math.abs(a-e)<6?c.cache.getImageLoadObject(n):c.cache.isLoaded(n))&&r(e)}),!i.indicesToRequest.length)return;we.preserveExistingPool||c.imageLoadPoolManager.filterRequests((e=>{const t=new Set(e.imageIds);return e=>e.type!==ue||!t.has(e.additionalDetails.imageId)})(t));const s=(n,o)=>c.imageLoader.loadAndCacheImage(n,o).then(()=>function(n){r(t.imageIds.indexOf(n));const o=c.cache.getCachedImageBasedOnImageURI(n),{stats:a}=i,s=o?.image?.decodeTimeInMS||0;if(s){a.imageIds.set(n,s),a.decodeTimeInMS+=s;const e=o?.image?.loadTimeInMS||0;a.loadTimeInMS+=e}if(!i.indicesToRequest.length&&o?.sizeInBytes){const{sizeInBytes:t}=o,n=c.cache.getMaxCacheSize()/4/t;if(i.cacheFill){if(a.imageIds.size){a.fillTime=Date.now()-a.start;const{size:e}=a.imageIds;a.fillSize=e}}else a.initialTime=Date.now()-a.start,a.initialSize=a.imageIds.size,xe(e,n),Ee(e)}}(n));i.indicesToRequest.forEach(e=>{const n=t.imageIds[e],i={requestType:ue};c.imageLoadPoolManager.addRequest(s.bind(null,n,i),ue,{imageId:n},0)})}function be(e){clearTimeout(_e),_e=setTimeout(function(){const t=e.target;try{xe(t),Ee(t)}catch(e){return}},5)}const xe=(e,t)=>{const n=he(e);if(!n)return;if(!n.imageIds?.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const{currentImageIdIndex:i}=n;let{maxAfter:r=2,minBefore:o=2}=we;const{directionExtraImages:a=10}=we,s=ce(e)||{indicesToRequest:[],currentImageIdIndex:i,stackCount:0,enabled:!0,direction:1,stats:{start:Date.now(),imageIds:new Map,decodeTimeInMS:0,loadTimeInMS:0,totalBytes:0}},l=i-s.currentImageIdIndex;if(s.direction=l<0?-1:1,s.currentImageIdIndex=i,s.enabled=!0,s.stackCount<100&&(s.stackCount+=a),Math.abs(l)>r||!l)if(s.stackCount=0,t){const e=i/n.imageIds.length;o=Math.ceil(t*e),r=Math.ceil(t*(1-e)),s.cacheFill=!0}else s.cacheFill=!1;else l<0?(o+=s.stackCount,r=0):(r+=s.stackCount,o=0);const c=Math.max(0,i-o),u=Math.min(n.imageIds.length-1,i+r),d=[];for(let e=i+1;e<=u;e++)d.push(e);for(let e=i-1;e>=c;e--)d.push(e);s.indicesToRequest=d,le(e,s)};const Ce={enable:e=>{const t=he(e);if(!t)return;if(!t.imageIds?.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");xe(e),Ee(e),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,be),e.addEventListener(c.Enums.Events.STACK_NEW_IMAGE,be);const n=pe(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,n),c.eventTarget.addEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,n)},disable:function(e){clearTimeout(_e),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,be);const t=pe(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,t);const n=ce(e);n&&(n.enabled=!1)},getConfiguration:function(){return we},setConfiguration:function(e){we=e}};var Ie=n(19027),Se=n(76260),De=n(64063);const Ae=function(e,t){const n=t.frameNumbers||[...Array(e.numTimePoints).keys()];if(!t.maskVolumeId&&!t.worldCoordinate)throw new Error("You should provide either maskVolumeId or imageCoordinate");if(t.maskVolumeId&&t.worldCoordinate)throw new Error("You can only use one of maskVolumeId or imageCoordinate");if(t.maskVolumeId){const i=c.cache.getVolume(t.maskVolumeId);if(!i)throw new Error("Segmentation volume not found");const[r,o]=function(e,t,n){const{imageData:i}=n,r=n.voxelManager,o=r.getScalarDataLength(),a=[];a.length=o;let s=0;for(let e=0,t=o;e<t;e++)0!==r.getAtIndex(e)&&(a[s++]=e);a.length=s;const l=[],c=t.voxelManager.getScalarDataLength()===o&&JSON.stringify(t.spacing)===JSON.stringify(n.spacing),u=[];if(c){for(let n=0;n<a.length;n++){const i=[],o=a[n];for(let n=0;n<e.length;n++)i.push(t.voxelManager.getAtIndexAndTimePoint(o,e[n]));l.push(i),u.push(r.toIJK(o))}return[l,u]}const d=({pointLPS:n,value:i,pointIJK:r})=>{if(0===i)return;const o=(0,De.Q5)(t.imageData,t.dimensions,t.spacing,n);let a=0;const s=new Map;e.forEach(e=>s.set(e,0));const c=({index:n})=>{for(let i=0;i<e.length;i++){const r=t.voxelManager.getAtIndexAndTimePoint(n,e[i]),o=e[i];s.set(o,s.get(o)+r)}a++};t.voxelManager.forEach(c,{imageData:t.imageData,boundsIJK:o});const d=[];s.forEach(e=>{d.push(e/a)}),u.push(r),l.push(d)};return n.voxelManager.forEach(d,{imageData:i}),[l,u]}(n,e,i);return[r,o]}if(t.worldCoordinate){const i=function(e,t,n){const{dimensions:i,imageData:r}=n,o=r.worldToIndex(t);if(o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.floor(o[2]),!c.utilities.indexWithinDimensions(o,i))throw new Error("outside bounds");const a=i[0],s=i[0]*i[1],l=[];return e.forEach(e=>{const t=o[2]*s+o[1]*a+o[0];l.push(n.voxelManager.getAtIndexAndTimePoint(t,e))}),l}(n,t.worldCoordinate,e);return i}};function Te(e,t){const n=e.getScalarDataLength(),i=new Float32Array(n);for(const r of t){const t=e.getTimePointScalarData(r);for(let e=0;e<n;e++)i[e]+=t[e]}return i}const Ne={[c.Enums.GenerateImageType.SUM]:(e,t,n)=>{const i=Te(e,t);for(let e=0;e<i.length;e++)n(e,i[e])},[c.Enums.GenerateImageType.AVERAGE]:(e,t,n)=>{const i=function(e,t){const n=Te(e,t),i=t.length;for(let e=0;e<n.length;e++)n[e]/=i;return n}(e,t);for(let e=0;e<i.length;e++)n(e,i[e])},[c.Enums.GenerateImageType.SUBTRACT]:(e,t,n)=>{if(2!==t.length)throw new Error("Please provide only 2 time points for subtraction.");const i=e.getScalarDataLength(),r=e.getTimePointScalarData(t[0]),o=e.getTimePointScalarData(t[1]);for(let e=0;e<i;e++){n(e,r[e]-o[e])}}};function Oe(e,t,n){const{frameNumbers:i}=n,r=i||[...Array(e.numTimePoints).keys()];if(r.length<=1)throw new Error("Please provide two or more time points");const o=e.voxelManager,a=o.getScalarDataLength(),s=Ne[t];if(!s)throw new Error(`Unsupported operation: ${t}`);const l=new Float32Array(a);return s(o,r,(e,t)=>{l[e]=t}),l}function Pe(e,t,n){const{frameNumbers:i,targetVolume:r}=n;if(!r)throw new Error("A target volume must be provided");const o=i||[...Array(e.numTimePoints).keys()];if(o.length<=1)throw new Error("Please provide two or more time points");const a=e.voxelManager,s=r.voxelManager,l=Ne[t];if(!l)throw new Error(`Unsupported operation: ${t}`);l(a,o,(e,t)=>{s.setAtIndex(e,t)}),s.resetModifiedSlices();for(let e=0;e<r.dimensions[2];e++)s.modifiedSlices.add(e)}function Me(e,t){const n=3*t;if(n<e.length)return B.eR.fromValues(e[n],e[n+1],e[n+2])}function ke(e){const t=e.getLines().getData();let n=0;const i=new Map;for(;n<t.length;){const e=t[n++],r=[];for(let i=0;i<e;i++)r.push(t[n+i]);i.set(r[0],r),n+=e}const r=[],o=e=>{for(const[t,n]of e.entries())if(void 0!==n)return t;return-1};let a=o(i);for(;-1!==a;){const e=[a];for(;i.has(a);){const t=i.get(a)[1];i.has(t)&&e.push(t),i.delete(a),a=t}r.push(e),a=o(i)}return r.length?r:void 0}function Re(e){const t=ke(e);if(!t)return;const n=e.getPoints().getData();return t.map(e=>e.map(e=>Me(n,e)))}var Le=n(98643),Fe=n(66403),Ue=n(62783);const{transformWorldToIndex:Be}=c.utilities;function Ve(e,t,n,i){const{boundsIJK:r,centerWorld:o,radiusWorld:a}=function(e,t,n){const[i,r]=e,o=B.eR.fromValues((i[0]+r[0])/2,(i[1]+r[1])/2,(i[2]+r[2])/2),a=B.eR.distance(i,r)/2;let s;if(!n){const e=Be(t,o),n=t.getSpacing(),i=Math.min(...n),r=Math.ceil(a/i);return s=[[e[0]-r,e[0]+r],[e[1]-r,e[1]+r],[e[2]-r,e[2]+r]],{boundsIJK:s,centerWorld:o,radiusWorld:a}}return s=function(e,t,n,i,r){const[o,a]=n,s=e.getDimensions(),l=t.getCamera(),c=B.eR.fromValues(l.viewUp[0],l.viewUp[1],l.viewUp[2]),u=B.eR.fromValues(l.viewPlaneNormal[0],l.viewPlaneNormal[1],l.viewPlaneNormal[2]),d=B.eR.create();B.eR.cross(d,c,u);const h=B.eR.create(),p=B.eR.create();B.eR.scaleAndAdd(h,a,u,r),B.eR.scaleAndAdd(p,o,u,-r),B.eR.scaleAndAdd(h,h,d,-r),B.eR.scaleAndAdd(p,p,d,r);const f=[Be(e,h),Be(e,p)],m=(0,ee.getBoundingBoxAroundShape)(f,s);return m}(t,n,e,0,a),{boundsIJK:s,centerWorld:o,radiusWorld:a}}(t,e,i),s={center:o,radius:a},l=e.getDimensions();c.utilities.VoxelManager.createScalarVolumeVoxelManager({dimensions:l,scalarData:e.getPointData().getScalars().getData()}).forEach(n,{boundsIJK:r,isInObject:e=>(0,Ue.d)(s,e),imageData:e})}const We=c.utilities.roundNumber},45217:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=function(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}},79362:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BasicStatsCalculator:()=>a,Calculator:()=>r});var i=n(15327);const r=class{},{PointsManager:o}=i.utilities;class a extends r{static{this.max=[-1/0]}static{this.min=[1/0]}static{this.sum=[0]}static{this.count=0}static{this.runMean=[0]}static{this.m2=[0]}static{this.pointsInShape=o.create3(1024)}static statsInit(e){e.storePointData||(a.pointsInShape=null)}static{this.statsCallback=({value:e,pointLPS:t=null})=>{Array.isArray(e)&&e.length>1&&1===this.max.length&&(this.max.push(this.max[0],this.max[0]),this.min.push(this.min[0],this.min[0]),this.sum.push(this.sum[0],this.sum[0]),this.runMean.push(0,0),this.m2.push(this.m2[0],this.m2[0])),this.pointsInShape?.push(t);const n=Array.isArray(e)?e:[e];this.count+=1,this.max.map((e,t)=>{const i=n[t],r=i-this.runMean[t];this.sum[t]+=i,this.runMean[t]+=r/this.count;const o=i-this.runMean[t];this.m2[t]+=r*o,this.min[t]=Math.min(this.min[t],i),this.max[t]=Math.max(e,i)})}}static{this.getStatistics=e=>{const t=this.sum.map(e=>e/this.count),n=this.m2.map(e=>Math.sqrt(e/this.count)),i=e?.unit||null,r={max:{name:"max",label:"Max Pixel",value:s(this.max),unit:i},min:{name:"min",label:"Min Pixel",value:s(this.min),unit:i},mean:{name:"mean",label:"Mean Pixel",value:s(t),unit:i},stdDev:{name:"stdDev",label:"Standard Deviation",value:s(n),unit:i},count:{name:"count",label:"Pixel Count",value:this.count,unit:null},pointsInShape:this.pointsInShape,array:[]};return r.array.push(r.max,r.mean,r.stdDev,r.stdDev,r.count),this.max=[-1/0],this.min=[1/0],this.sum=[0],this.m2=[0],this.runMean=[0],this.count=0,this.pointsInShape=o.create3(1024),r}}}function s(e){return 1===e.length?e[0]:e}},87009:(e,t,n)=>{"use strict";function i(e,t,n={}){return n.precalculated||r(e,n),n.precalculated(t)}n.r(t),n.d(t,{getCanvasEllipseCorners:()=>o,pointInEllipse:()=>i,precalculatePointInEllipse:()=>r});const r=(e,t={})=>{const{xRadius:n,yRadius:i,zRadius:r}=e;void 0!==t.invXRadiusSq&&void 0!==t.invYRadiusSq&&void 0!==t.invZRadiusSq||(t.invXRadiusSq=0!==n?1/n**2:0,t.invYRadiusSq=0!==i?1/i**2:0,t.invZRadiusSq=0!==r?1/r**2:0);const{invXRadiusSq:o,invYRadiusSq:a,invZRadiusSq:s}=t,{center:l}=e,[c,u,d]=l;return t.precalculated=e=>{const t=e[0]-c;let n=t*t*o;if(n>1)return!1;const i=e[1]-u;if(n+=i*i*a,n>1)return!1;const r=e[2]-d;return n+=r*r*s,n<=1},t};function o(e){const[t,n,i,r]=e;return[[i[0],n[1]],[r[0],t[1]]]}},51440:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BasicStatsCalculator:()=>l,aabb:()=>i,ellipse:()=>c,lineSegment:()=>u,point:()=>d,polyline:()=>h,rectangle:()=>p,vec2:()=>r});var i={};n.r(i),n.d(i,{distanceToPoint:()=>s,distanceToPointSquared:()=>a,intersectAABB:()=>o});var r={};function o(e,t){return e.minX<=t.maxX&&e.maxX>=t.minX&&e.minY<=t.maxY&&e.maxY>=t.minY}function a(e,t){const n=e.maxX-e.minX,i=e.maxY-e.minY,r=[n,i],o=[e.minX+n/2,e.minY+i/2],a=[Math.abs(t[0]-o[0]),Math.abs(t[1]-o[1])],s=a[0]-.5*r[0],l=a[1]-.5*r[1];if(s>0&&l>0)return s*s+l*l;const c=Math.max(s,0)+Math.max(l,0);return c*c}function s(e,t){return Math.sqrt(a(e,t))}n.r(r),n.d(r,{findClosestPoint:()=>f.A,liangBarksyClip:()=>m.A});var l=n(79362),c=n(87009),u=n(93258),d=n(29614),h=n(92984),p=n(92282),f=n(90554),m=n(35381)},86978:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(18989);function r(e,t,n){if(2!==e.length||2!==t.length||2!==n.length)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt((0,i.A)(e,t,n))}},18989:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(73149);function r(e,t,n){return(0,i.A)(e,t,n).distanceSquared}},73149:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(29614);function r(e,t,n){let r;const o=(0,i.distanceToPointSquared)(e,t);if(e[0]===t[0]&&e[1]===t[1]&&(r=e),!r){const i=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/o;r=i<0?e:i>1?t:[e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1])]}return{point:[...r],distanceSquared:(0,i.distanceToPointSquared)(n,r)}}},93258:(e,t,n)=>{"use strict";n.r(t),n.d(t,{distanceToPoint:()=>i.A,distanceToPointSquared:()=>r.A,distanceToPointSquaredInfo:()=>o.A,intersectLine:()=>a.A,isPointOnLineSegment:()=>s.A});var i=n(86978),r=n(18989),o=n(73149),a=n(81205),s=n(91818)},81205:(e,t,n)=>{"use strict";function i(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}function r(e,t,n,r){const[o,a]=e,[s,l]=t,[c,u]=n,[d,h]=r,p=l-a,f=o-s,m=s*a-o*l,g=p*c+f*u+m,v=p*d+f*h+m;if(0!==g&&0!==v&&i(g)===i(v))return;const y=h-u,_=c-d,w=d*u-c*h,E=y*o+_*a+w,b=y*s+_*l+w;if(0!==E&&0!==b&&i(E)===i(b))return;const x=p*_-y*f;let C;C=f*w-_*m;const I=C/x;C=y*m-p*w;return[I,C/x]}n.d(t,{A:()=>r})},91818:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const i=.01;function r(e,t,n){const r=e[0]<=t[0]?e[0]:t[0],o=e[0]>=t[0]?e[0]:t[0],a=e[1]<=t[1]?e[1]:t[1],s=e[1]>=t[1]?e[1]:t[1];if(!(n[0]>=r-i&&n[0]<=o+i&&n[1]>=a-i&&n[1]<=s+i))return!1;const l=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return(l>=0?l:-l)<=i}},56374:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(31489);function r(e,t){return Math.sqrt((0,i.A)(e,t))}},31489:(e,t,n)=>{"use strict";function i(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,i,r=0]=e,[o,a,s=0]=t,l=o-n,c=a-i,u=s-r;return l*l+c*c+u*u}n.d(t,{A:()=>i})},29614:(e,t,n)=>{"use strict";n.r(t),n.d(t,{distanceToPoint:()=>i.A,distanceToPointSquared:()=>r.A,mirror:()=>o.A});var i=n(56374),r=n(31489),o=n(83483)},83483:(e,t,n)=>{"use strict";function i(e,t){const[n,i]=e,[r,o]=t;return[2*r-n,2*o-i]}n.d(t,{A:()=>i})},97792:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(15327),r=n(3823);const o=(e,t,n,o)=>{const{xDir:a,yDir:s,spacing:l}=o,c=(0,i.getEnabledElement)(e),{viewport:u}=c;if(!t.length)return t.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const d=u.canvasToWorld(t[t.length-1]),h=u.canvasToWorld(n),p=r.eR.create();r.eR.subtract(p,h,d);const f=Math.abs(r.eR.dot(p,a)),m=Math.abs(r.eR.dot(p,s)),g=Math.max(Math.floor(f/l[0]),Math.floor(m/l[0]));if(g>1){const e=t[t.length-1],i=r.Zc.dist(e,n),o=r.Zc.create();r.Zc.subtract(o,n,e),r.Zc.set(o,o[0]/i,o[1]/i);const a=i/g;for(let n=1;n<=g;n++)t.push([e[0]+a*o[0]*n,e[1]+a*o[1]*n])}else t.push(n);return g}},56777:(e,t,n)=>{"use strict";function i(e,t,n,i){let a=!1;const s=e[0]<t[0]?e[0]:t[0],l=e[1]<t[1]?e[1]:t[1],c=e[0]>t[0]?e[0]:t[0],u=e[1]>t[1]?e[1]:t[1],d=n[0]<i[0]?n[0]:i[0],h=n[1]<i[1]?n[1]:i[1],p=n[0]>i[0]?n[0]:i[0],f=n[1]>i[1]?n[1]:i[1];if(s>p||c<d||l>f||u<h)return!1;const m=[r(e,t,n),r(e,t,i),r(n,i,e),r(n,i,t)];return m[0]!==m[1]&&m[2]!==m[3]||((0===m[0]&&o(e,n,t)||0===m[1]&&o(e,i,t)||0===m[2]&&o(n,e,i)||0===m[3]&&o(n,t,i))&&(a=!0),a)}function r(e,t,n){const i=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===i?0:i>0?1:2}function o(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}n.d(t,{A:()=>i})},68385:(e,t,n)=>{"use strict";n.d(t,{S:()=>m,Y:()=>g});var i,r,o,a=n(29614),s=n(37135),l=n(46513),c=n(11377),u=n(3823),d=n(10812);function h(e){for(let t=0,n=e.length;t<n;t++){const i=e[t];i.next||(i.next=e[t===n-1?0:t+1])}}function p(e,t){const n=[],c=[],u=new Map;let p=(0,l.A)(t,e[0])?o.Exiting:o.Entering;for(let c=0,h=e.length;c<h;c++){const f=e[c],m=(0,l.A)(t,f),g={type:i.Vertex,coordinates:f,position:m?r.Inside:r.Outside,visited:!1,next:null};n.push(g);const v=e[c===h-1?0:c+1],y=(0,s.A)(t,f,v).map(e=>{const n=e[0],i=t[e[0]],r=t[e[1]],o=(0,d.A)(f,v,i,r);return{sourceLineSegmentId:n,coordinate:o,targetStartPointDistSquared:a.distanceToPointSquared(f,o)}});y.sort((e,t)=>e.targetStartPointDistSquared-t.targetStartPointDistSquared),y.forEach(e=>{const{sourceLineSegmentId:t,coordinate:a}=e,s={type:i.Intersection,coordinates:a,position:r.Edge,direction:p,visited:!1,next:null},l={...s,direction:o.Unknown,cloned:!0};p===o.Entering?s.next=l:l.next=s;let c=u.get(t);c||(c=[],u.set(t,c)),n.push(s),c.push(l),p*=-1})}for(let e=0,n=t.length;e<n;e++){const n=e,r=t[e],o={type:i.Vertex,coordinates:r,visited:!1,next:null};c.push(o);const s=u.get(n);s?.length&&s.map(e=>({intersectionPoint:e,lineSegStartDistSquared:a.distanceToPointSquared(r,e.coordinates)})).sort((e,t)=>e.lineSegStartDistSquared-t.lineSegStartDistSquared).map(({intersectionPoint:e})=>e).forEach(e=>c.push(e))}return h(n),h(c),{targetPolylinePoints:n,sourcePolylinePoints:c}}function f(e){for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===r.Outside)return n}}function m(e,t){const n=(0,c.A)(e),r=(0,c.A)(t),o=u.eR.dot(r,n);u.Fd.equals(1,o)||(t=t.slice().reverse());const{targetPolylinePoints:a}=p(e,t),s=f(a);if(!s)return e.slice();const l=[s.coordinates];let d=s.next;for(;d!==s;)d.type===i.Intersection&&d.cloned||l.push(d.coordinates),d=d.next;return l}function g(e,t){const n=(0,c.A)(e),r=(0,c.A)(t),o=u.eR.dot(r,n);u.Fd.equals(-1,o)||(t=t.slice().reverse());const{targetPolylinePoints:a}=p(e,t);let s=null;const l=[];for(;s=f(a);){const e=[s.coordinates];let t=s.next;for(s.visited=!0;t!==s;)t.visited=!0,t.type===i.Intersection&&t.cloned||e.push(t.coordinates),t=t.next;l.push(e)}return l}!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(i||(i={})),function(e){e[e.Outside=-1]="Outside",e[e.Edge=0]="Edge",e[e.Inside=1]="Inside"}(r||(r={})),function(e){e[e.Exiting=-1]="Exiting",e[e.Unknown=0]="Unknown",e[e.Entering=1]="Entering"}(o||(o={}))},46513:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(19246);function r(e,t,n={closed:void 0}){if(e.length<3)return!1;const o=e.length;let a=0;const{closed:s,holes:l}=n;if(l?.length)for(const e of l)if(r(e,t))return!1;const c=!(void 0===s?(0,i.A)(e):s),u=e.length-(c?1:2);for(let n=0;n<=u;n++){const i=e[n],r=e[n===o-1?0:n+1],s=i[0]>=r[0]?i[0]:r[0],l=i[1]>=r[1]?i[1]:r[1],c=i[1]<=r[1]?i[1]:r[1];if(t[0]<=s&&t[1]>=c&&t[1]<l){let e=i[0]===r[0];if(!e){const n=(t[1]-i[1])*(r[0]-i[0])/(r[1]-i[1])+i[0];e=t[0]<=n}a+=e?1:0}}return!!(a%2)}},42436:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(46513);function r(e,t){for(let n=0,r=t.length;n<r;n++)if(!(0,i.A)(e,t[n]))return!1;return!0}},99944:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(93258);const r=.1;function o(e,t=r){const n=e.length;if(n<3)return e;const o=t*t,a=[[0,n-1]],s=new Array(n).fill(!1);let l=2;for(s[0]=!0,s[n-1]=!0;a.length;){const[t,n]=a.pop();if(n-t===1)continue;const r=e[t],c=e[n];let u=-1/0,d=-1;for(let o=t+1;o<n;o++){const t=e[o],n=i.distanceToPointSquared(r,c,t);n>u&&(u=n,d=o)}u<o||(s[d]=!0,l++,a.push([d,n]),a.push([t,d]))}const c=new Array(l);for(let t=0,i=0;t<n;t++)s[t]&&(c[i++]=e[t]);return c}},86909:(e,t,n)=>{"use strict";function i(e){const t=e.length;let n=0,i=t-1;for(let r=0;r<t;r++)n+=(e[i][0]+e[r][0])*(e[i][1]-e[r][1]),i=r;return Math.abs(n/2)}n.d(t,{A:()=>i})},32979:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(3823),r=n(56777);function o(e,t,n,o=!0){let a,s;o?(s=e.length-1,a=0):(s=0,a=1);const l=[];for(let i=a;i<e.length;i++){const o=e[s],a=e[i];(0,r.A)(t,n,o,a)&&l.push([s,i]),s=i}if(0===l.length)return;const c=[];l.forEach(n=>{const r=[e[n[0]],e[n[1]]],o=[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2];c.push(i.Zc.distance(o,t))});const u=Math.min(...c);return{segment:l[c.indexOf(u)],distance:u}}},4338:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(56777);function r(e,t,n,r=!0){let o,a;r?(a=e.length-1,o=0):(a=0,o=1);for(let r=o;r<e.length;r++){const o=e[a],s=e[r];if((0,i.A)(t,n,o,s))return[a,r];a=r}}},50932:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(37135),r=n(10812);function o(e,t,n,o=!0){const a=[],s=(0,i.A)(e,t,n,o);for(let i=0;i<s.length;i++){const o=e[s[i][0]],l=e[s[i][1]],c=(0,r.A)(t,n,o,l);a.push(c)}return a}},37135:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(56777);function r(e,t,n,r=!0){const o=[],a=e.length,s=a-(r?1:2);for(let r=0;r<=s;r++){const s=e[r],l=r===a-1?0:r+1,c=e[l];(0,i.A)(t,n,s,c)&&o.push([r,l])}return o}},10812:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(93258);const r=.01;function o(e,t,n,o){const a=[t[0]-e[0],t[1]-e[1]],s=[o[0]-n[0],o[1]-n[1]],l=s[1]*a[0]-s[0]*a[1];if((l>=0?l:-l)<r){const r=[e[0]<t[0]?e[0]:t[0],e[0]>t[0]?e[0]:t[0],e[1]<t[1]?e[1]:t[1],e[1]>t[1]?e[1]:t[1]],a=[n[0]<o[0]?n[0]:o[0],n[0]>o[0]?n[0]:o[0],n[1]<o[1]?n[1]:o[1],n[1]>o[1]?n[1]:o[1]];if(!(r[0]<=a[1]&&r[1]>=a[0]&&r[2]<=a[3]&&r[3]>=a[2]))return;if(!(i.isPointOnLineSegment(e,t,n)||i.isPointOnLineSegment(e,t,o)||i.isPointOnLineSegment(n,o,e)))return;return[.5*((r[0]>a[0]?r[0]:a[0])+(r[1]<a[1]?r[1]:a[1])),.5*((r[2]>a[2]?r[2]:a[2])+(r[3]<a[3]?r[3]:a[3]))]}let c=e[1]-n[1],u=e[0]-n[0];const d=a[0]*c-a[1]*u;c=(s[0]*c-s[1]*u)/l,u=d/l;return[e[0]+c*a[0],e[1]+c*a[1]]}},11377:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(63113);function r(e){const t=(0,i.A)(e);return[0,0,t/Math.abs(t)]}},43490:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(3823);function r(e){const t=function(e){const t=i.eR.create(),n=e[0];for(let i=0,r=e.length;i<r;i++){const o=e[i],a=e[i===r-1?0:i+1],s=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2],u=a[0]-n[0],d=a[1]-n[1],h=a[2]-n[2];t[0]+=l*h-c*d,t[1]+=c*u-s*h,t[2]+=s*d-l*u}return i.eR.scale(t,t,.5),t}(e);return i.eR.normalize(t,t)}},63113:(e,t,n)=>{"use strict";function i(e){if(e.length<3)return 0;const t=e[0];let n=0;for(let i=0,r=e.length;i<r;i++){const o=e[i],a=e[i===r-1?0:i+1],s=o[0]-t[0],l=o[1]-t[1],c=a[0]-t[0];n+=s*(a[1]-t[1])-l*c}return n*=.5,n}n.d(t,{A:()=>i})},61785:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(15327),r=n(3823);const o=.001,a=(e,t)=>{let n,a,s;if(e instanceof i.StackViewport){const t=e.getImageData();a=t.direction.slice(0,3),s=t.direction.slice(3,6),n=t.spacing}else{const t=e.getImageData(),{direction:i,spacing:l}=t,{viewPlaneNormal:c,viewUp:u}=e.getCamera(),d=i.slice(0,3),h=i.slice(3,6),p=i.slice(6,9),f=r.eR.create();r.eR.cross(f,u,c);const m=Math.abs(r.eR.dot(f,d)),g=Math.abs(r.eR.dot(f,h)),v=Math.abs(r.eR.dot(f,p));let y;if(Math.abs(1-m)<o)y=l[0],a=d;else if(Math.abs(1-g)<o)y=l[1],a=h;else{if(!(Math.abs(1-v)<o))throw new Error("No support yet for oblique plane planar contours");y=l[2],a=p}const _=Math.abs(r.eR.dot(u,d)),w=Math.abs(r.eR.dot(u,h)),E=Math.abs(r.eR.dot(u,p));let b;if(Math.abs(1-_)<o)b=l[0],s=d;else if(Math.abs(1-w)<o)b=l[1],s=h;else{if(!(Math.abs(1-E)<o))throw new Error("No support yet for oblique plane planar contours");b=l[2],s=p}n=[y,b]}return{spacing:[n[0]/t,n[1]/t],xDir:a,yDir:s}}},4239:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(63113);function r(e){return(0,i.A)(e)>=0?1:-1}},92984:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addCanvasPointsToArray:()=>E.A,containsPoint:()=>r.A,containsPoints:()=>o.A,decimate:()=>f.A,getAABB:()=>a.A,getArea:()=>s.A,getClosestLineSegmentIntersection:()=>y.A,getFirstLineSegmentIntersectionIndexes:()=>m.A,getLineSegmentIntersectionsCoordinates:()=>v.A,getLineSegmentIntersectionsIndexes:()=>g.A,getNormal2:()=>d.A,getNormal3:()=>u.A,getSignedArea:()=>l.A,getSubPixelSpacingAndXYDirections:()=>_.A,getWindingDirection:()=>c.A,intersectPolyline:()=>p.A,isClosed:()=>i.A,isPointInsidePolyline3D:()=>x.i,mergePolylines:()=>h.S,pointCanProjectOnLine:()=>b.A,pointsAreWithinCloseContourProximity:()=>w.A,projectTo2D:()=>C.p,subtractPolylines:()=>h.Y});var i=n(19246),r=n(46513),o=n(42436),a=n(98122),s=n(86909),l=n(63113),c=n(4239),u=n(43490),d=n(11377),h=n(68385),p=n(405),f=n(99944),m=n(4338),g=n(37135),v=n(50932),y=n(32979),_=n(61785),w=n(82265),E=n(97792),b=n(80514),x=n(8361),C=n(28502)},405:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(4338);function r(e,t){for(let n=0,r=e.length;n<r;n++){const o=e[n],a=e[n===r-1?0:n+1],s=(0,i.A)(t,o,a);if(2===s?.length)return!0}return!1}},19246:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(3823),r=n(29614);function o(e){if(e.length<3)return!1;const t=e.length,n=e[0],o=e[t-1],a=(0,r.distanceToPointSquared)(n,o);return i.Fd.equals(0,a)}},8361:(e,t,n)=>{"use strict";n.d(t,{i:()=>o});var i=n(46513),r=n(28502);function o(e,t,n={}){const{sharedDimensionIndex:o,projectedPolyline:a}=(0,r.p)(t),{holes:s}=n,l=[];if(s)for(let e=0;e<s.length;e++){const t=s[e],n=[];for(let e=0;e<t.length;e++)n.push([t[e][(o+1)%3],t[e][(o+2)%3]]);l.push(n)}const c=[e[(o+1)%3],e[(o+2)%3]];return(0,i.A)(a,c,{holes:l})}},80514:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(3823);const r=(e,t,n,r)=>{const o=[e[0]-t[0],e[1]-t[1]],a=[n[0]-t[0],n[1]-t[1]],s=o[0]*a[0]+o[1]*a[1];if(s<0)return!1;const l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===l)return!1;const c=s/l,u=[a[0]/l,a[1]/l],d=[u[0]*c,u[1]*c],h=[t[0]+d[0],t[1]+d[1]];return!(i.Zc.distance(e,h)>r)&&!(i.Zc.distance(t,h)>i.Zc.distance(t,n))}},82265:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(3823);const r=(e,t,n)=>i.Zc.dist(e,t)<n},28502:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var i=n(15327);const r=1e-6;function o(e){let t;const n=i.utilities.getRandomSampleFromArray(e,50);for(let e=0;e<3;e++)if(n.every((t,n,i)=>Math.abs(t[e]-i[0][e])<r)){t=e;break}if(void 0===t)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const o=[],a=(t+1)%3,s=(t+2)%3;for(let t=0;t<e.length;t++)o.push([e[t][a],e[t][s]]);return{sharedDimensionIndex:t,projectedPolyline:o}}},92282:(e,t,n)=>{"use strict";n.r(t),n.d(t,{distanceToPoint:()=>r});var i=n(93258);function r(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[n,r,o,a]=e;let s=655535;const l=function(e,t,n,i){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+i]],bottom:[[e+n,t+i],[e,t+i]],left:[[e,t+i],[e,t]]}}(n,r,o,a);return Object.keys(l).forEach(e=>{const[n,r]=l[e],o=i.distanceToPoint(n,r,t);o<s&&(s=o)}),s}},62783:(e,t,n)=>{"use strict";function i(e,t){const{center:n,radius:i}=e,r=e.radius2||i*i;return(t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1])+(t[2]-n[2])*(t[2]-n[2])<=r}n.d(t,{d:()=>i})},90554:(e,t,n)=>{"use strict";function i(e,t){let n=[0,0],i=Number.MAX_SAFE_INTEGER;return e.forEach(function(e){const r=function(e,t){const[n,i]=e,[r,o]=t;return Math.sqrt(Math.pow(n-r,2)+Math.pow(i-o,2))}(t,e);r<i&&(i=r,n=[...e])}),n}n.d(t,{A:()=>i})},35381:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});const i=1e-6,r=1,o=0;function a(e,t,n){const[r,o]=n;if(Math.abs(t)<i)return e<0;const a=e/t;if(t>0){if(a>o)return 0;a>r&&(n[0]=a)}else{if(a<r)return 0;a<o&&(n[1]=a)}return 1}function s(e,t,n,s,l){const[c,u]=e,[d,h]=t,p=d-c,f=h-u;if(void 0===s||void 0===l?(s=e,l=t):(s[0]=e[0],s[1]=e[1],l[0]=t[0],l[1]=t[1]),Math.abs(p)<i&&Math.abs(f)<i&&c>=n[0]&&c<=n[2]&&u>=n[1]&&u<=n[3])return r;const m=[0,1];if(a(n[0]-c,p,m)&&a(c-n[2],-p,m)&&a(n[1]-u,f,m)&&a(u-n[3],-f,m)){const[e,t]=m;return t<1&&(l[0]=c+t*p,l[1]=u+t*f),e>0&&(s[0]+=e*p,s[1]+=e*f),r}return o}},27062:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(65481),r=n(75210);function o(e,t,n,o){const a=n-t+1,s=Math.floor(o/100*a)??1,l=Math.floor(a/s)??1;if(isNaN(a)||!a||!l)return e;if(a/l<2)return e;const c=Math.max(0,t),u=Math.min(e.length-1,n),d=e.slice(0,c),h=e.slice(u+1,e.length),p=function(e,t){if(!t||0===t.length||t.length===e.length)return e;const n=t[t.length-1]-t[0]+1,o=(0,i.Qm)(t.map(t=>e[t][0])),a=(0,i.Qm)(t.map(t=>e[t][1]));if(s=e,3===s[0]?.length){const s=(0,i.Qm)(t.map(t=>e[t][2]));return(0,r.yU)((0,i.yd)(o,n),(0,i.yd)(a,n),(0,i.yd)(s,n))}return(0,r.yU)((0,i.yd)(o,n),(0,i.yd)(a,n));var s}(e,function(e,t){const n=[],[i,r]=t,o=r-i+1,a=Math.floor(o/e);let s=0,l=Math.round((o-1)/(a-1)*s)+i;for(;l<=r;)n.push(l),s++,l=Math.round((o-1)/(a-1)*s)+i;return n}(l,[c,u]));return[...d,...p,...h]}},13165:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c,filterAnnotationsForDisplay:()=>o.A,filterAnnotationsWithinSamePlane:()=>l.W,filterAnnotationsWithinSlice:()=>i.A,getPointInLineOfSightWithCriteria:()=>a.A,getWorldWidthAndHeightFromCorners:()=>r.A,isPlaneIntersectingAABB:()=>s.Y});var i=n(36374),r=n(35489),o=n(94418),a=n(57063),s=n(30698),l=n(40770);const c={filterAnnotationsWithinSlice:i.A,getWorldWidthAndHeightFromCorners:r.A,filterAnnotationsForDisplay:o.A,getPointInLineOfSightWithCriteria:a.A,isPlaneIntersectingAABB:s.Y,filterAnnotationsWithinSamePlane:l.W}},38726:(e,t,n)=>{"use strict";function i(e,t=5){return parseFloat(e[0]).toFixed(t)+","+parseFloat(e[1]).toFixed(t)+","+parseFloat(e[2]).toFixed(t)+","}n.d(t,{l:()=>i})},37162:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(15327),r=n(87063),o=n(76802);const a=function(e,t,n={}){const a=[];return e.forEach(e=>{const{data:s}=e,{points:l}=s.handles,{imageData:c,dimensions:u}=t;let d=l;if(s.cachedStats?.projectionPoints){const{projectionPoints:e}=s.cachedStats;d=[].concat(...e)}const h=d.map(e=>i.utilities.transformWorldToIndex(c,e));let p=(0,r.g)(h,u);n.numSlicesToProject&&!s.cachedStats?.projectionPoints&&(p=(0,o.A)(p,n.numSlicesToProject)),a.push(p)}),1===a.length?a[0]:a.reduce((e,t)=>({iMin:Math.min(e.iMin,t.iMin),jMin:Math.min(e.jMin,t.jMin),kMin:Math.min(e.kMin,t.kMin),iMax:Math.max(e.iMax,t.iMax),jMax:Math.max(e.jMax,t.jMax),kMax:Math.max(e.kMax,t.kMax)}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})}},26384:(e,t,n)=>{"use strict";n.d(t,{l:()=>s});var i=n(3823),r=n(15327);const{isEqual:o}=r.utilities,a=[i.eR.fromValues(1,0,0),i.eR.fromValues(0,1,0),i.eR.fromValues(0,0,1)];function s(e){const t=i.eR.subtract(i.eR.create(),e[0],e[1]),n=i.eR.subtract(i.eR.create(),e[0],e[2]);return[...l(t,a),...l(n,a)].every(e=>o(e,0)||o(e,90)||o(e,180)||o(e,270))}function l(e,t){return t.map(t=>180*i.eR.angle(e,t)/Math.PI)}},15773:(e,t,n)=>{"use strict";n.d(t,{A:()=>B});var i=n(15327),r=n(47807),o=n(77840);const a="PlanarFreehandContourSegmentationTool";function s(e,t=[]){const{viewport:n,sliceData:i,annotation:r}=e,s=new Map,{toolName:l,originalToolName:c}=r.metadata,u=c||l,d=((0,o.getAnnotations)(u,n.element)||[]).filter(e=>!e.metadata.originalToolName||e.metadata.originalToolName===u);if(u!==a){const e=(0,o.getAnnotations)(a,n.element);e?.length&&e.forEach(e=>{const{metadata:t}=e;t.originalToolName===u&&t.originalToolName!==t.toolName&&d.push(e)})}if(!d?.length)return s;for(let e=0;e<i.numberOfSlices;e++){const n=d.filter(t=>t.metadata.sliceIndex===e);if(!n?.length)continue;const i=n.filter(e=>t.every(t=>{const n=t.parentKey?t.parentKey(e):e,i=n?.[t.key];return Array.isArray(i)?i.every((e,n)=>e===t.value[n]):i===t.value}));i.length&&s.set(e,i)}return s}var l=n(3823);function c(e,t,n){const r=i.utilities.deepMerge({data:{},metadata:{}},n);return Object.assign(r,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(r.data,{handles:{points:t.points||t||[],interpolationSources:t.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...n.data.contour,polyline:e}}),r}function u(e,t){const n=e.get(t);return!n?.length||1===n.length&&n[0].autoGenerated}function d(e,t,n){const[i]=e;t[i]||={pair:e,list:[]},t[i].list.push(n)}function h(e,t,n){const i=[];let r=!0;for(let o=e-1;o>=t[0];o--){const e=n.get(o);if(e?.length){if(e[0].autoGenerated)continue;e.length>1&&(r=!1),i.push(o);break}}if(r&&i.length){for(let o=e+1;o<=t[1];o++){const e=n.get(o);if(e?.length){if(e[0].autoGenerated)continue;e.length>1&&(r=!1),i.push(o);break}}if(r&&!(i.length<2))return i}}const p=function(e,t){const n=s(t,[{key:"interpolationUID",value:t.interpolationUID}]),i=function(e){let t=1/0,n=-1/0,i=!1;for(const[r,o]of e.entries())o.length&&(t=Math.min(r,t),n=Math.max(r,n),i=!0);if(!i)return;return[t,n]}(n);if(!i)return void console.warn("No annotations found to interpolate",n);const r=function(e,t){for(const[n,i]of e)for(let e=0;e<i.length;e++)if(i[e].annotationUID===t)return n;return}(n,e.annotationUID),o=[];for(let e=i[0]+1;e<i[1];e++)if(u(n,e)){const t=h(e,i,n);t?.[0]!==r&&t?.[1]!==r||d(t,o,e)}return{interpolationData:n,interpolationList:o}};var f=n(94021);const{PointsManager:m}=i.utilities;function g(e,t=12){const n=m.create3(t);n.sources=[];const{sources:i}=n,{length:r,sources:o=[]}=e;if(r<15)return e.subselect(t);const a=Math.floor(Math.max(2*r/t,10));o.forEach(()=>i.push(m.create3(t)));const s=function(e,t=6){const{length:n}=e,i=l.eR.create(),r=l.eR.create(),o=new Float32Array(n);for(let a=0;a<n;a++){const s=e.getPoint(a),c=e.getPoint(a-t),u=e.getPoint((a+t)%n);l.eR.sub(i,s,c),l.eR.sub(r,u,s);const d=l.eR.dot(i,r)/(l.eR.len(i)*l.eR.len(r));o[a]=d}return o}(e,5),c=function(e,t){const{max:n,deviation:i}=function(e){const{length:t}=e;let n=0,i=1/0,r=-1/0,o=0;for(let o=0;o<t;o++){const t=e[o];n+=t,i=Math.min(i,t),r=Math.max(r,t)}const a=n/t;for(let n=0;n<t;n++){const t=e[n]-a;o+=t*t}return{mean:a,max:r,min:i,sumSq:o,deviation:Math.sqrt(o/t)}}(e),{length:r}=e;if(i<.01||r<3*t)return[];const o=[];let a,s=null,l=0;for(let t=0;t<r;t++){const r=e[t];r<n-i?s?(s[2]=t,r<a&&(a=r,l=t),s[1]=l):(a=r,l=t,s=[t,t,t]):s&&(o.push(s),s=null)}s&&(0===o[0][0]?o[0][0]=s[0]:(s[1]=l,s[2]=r-1,o.push(s)));return o}(s,t),u=[];if(c?.length>2){let e=-1;const t=a/3;c.forEach(n=>{const[i,,o]=n,s=Math.ceil((i+o)/2);o-e<t||(s-i>2*t?(v(u,e,i,a,r),e=v(u,i,s,a,r)):e=v(u,e,s,a,r),o-e>t&&(e=v(u,e,o,a,r)))});const n=u[0];y(n+r-e,r)>2*t&&v(u,e,n-t,a,r)}else{const e=Math.floor(r/t);v(u,-1,r-e,e,r)}return u.forEach(t=>{const r=e.getPointArray(t);n.push(r),o.forEach((e,n)=>i[n].push(e.getPoint(t)))}),n}function v(e,t,n,i,r){n<t&&(n+=r);const o=n-t,a=Math.ceil(o/i);if(a<=0)return e[e.length-1]!==n&&e.push(y(n,r)),n;for(let n=1;n<=a;n++){const i=y(t+n*o/a,r);e.push(i)}return e[e.length-1]}function y(e,t){return(Math.round(e)+t)%t}var _=n(50986);const{PointsManager:w}=i.utilities,E=.2;function b(e,t,n,i){const o=n.get(t[0])[0],a=n.get(t[1])[0],s=O(o.data.contour.polyline),u=O(a.data.contour.polyline),{c1Interp:d,c2Interp:h}=function(e,t){const n=N(e),i=N(t),r=Math.max(Math.ceil(n[n.length-1]/E),Math.ceil(i[i.length-1]/E)),o=T(n),a=T(i),s=r+t.x.length,l=r+e.x.length,c=A(s,o),u=A(l,a),d=D(s-2,e.x.length),h=D(l-2,t.x.length),p=S(c,d),f=S(u,h),m=I(e,p),g=I(t,f);return function(e,t){const n=e.x.length,i={startingNode:0,totalSquaredXYLengths:1/0};for(let r=0;r<n;r++){let o=r,a=0;for(let i=0;i<n;i++)a+=(e.x[o]-t.x[i])**2+(e.y[o]-t.y[i])**2+(e.z[o]-t.z[i])**2,o++,o===n&&(o=0);a<i.totalSquaredXYLengths&&(i.totalSquaredXYLengths=a,i.startingNode=r)}const r=i.startingNode;C(e.x,r),C(e.y,r),C(e.z,r),C(e.I,r)}(m,g),function(e,t){const n={x:[],y:[],z:[],I:[]},i={x:[],y:[],z:[],I:[]};for(let r=0;r<e.x.length;r++)(e.I[r]||t.I[r])&&(n.x.push(e.x[r]),n.y.push(e.y[r]),n.z.push(e.z[r]),n.I.push(e.I[r]),i.x.push(t.x[r]),i.y.push(t.y[r]),i.z.push(t.z[r]),i.I.push(t.I[r]));return{c1Interp:n,c2Interp:i}}(m,g)}(s,u);d.kIndex=t[0],h.kIndex=t[1],e.forEach(function(e){!function(e,t,n,i,o,a,s){const[u,d]=i,h=(n-u)/(d-u),p=o.get(u)[0],f=o.get(d)[0],m=function(e,t,n,i){const r=i?e.I:t.I,o=w.fromXYZ(e),a=w.fromXYZ(t),{length:s}=o,c=w.create3(s),u=l.eR.create(),d=l.eR.create(),h=w.create3(s);h.kIndex=e.kIndex;const p=w.create3(s);p.kIndex=t.kIndex;for(let t=0;t<e.x.length;t++)if(r[t]){const e=o.getPoint(t),i=a.getPoint(t);h.push(e),p.push(i),l.eR.sub(u,i,e),c.push(l.eR.scaleAndAdd(d,e,u,n))}return c.sources=[h,p],c}(e,t,h,a),v=h>.5?f:p,y=g(m);o.has(n)?function(e,t,n,i,r){const o=x(i,n,r),a=e.points,s=c(a,t,o);Object.assign(o,{metadata:s.metadata,data:s.data})}(m,y,n,v,s):function(e,t,n,i,o){const a=e.points,{viewport:s}=o,l=c(a,t,i),u=s.getViewReference({sliceIndex:n});if(!u)throw new Error(`Can't find slice ${n}`);Object.assign(l.metadata,u),r.state.addAnnotation(l,s.element),i.onInterpolationComplete?.(l,i);const{parentAnnotationUID:d}=i;if(d){const e=x(r.state.getAnnotation(d),n,o);(0,_.r)(s,e,l)}}(m,y,n,v,s)}(d,h,e,t,n,s.x.length>u.x.length,i)})}function x(e,t,n){const{viewport:i}=n,o=r.state.getAnnotations(e.metadata.toolName,i.element);for(let n=0;n<o.length;n++){const i=o[n];if(i.interpolationUID===e.interpolationUID&&i.metadata.sliceIndex===t)return i}}function C(e,t){t-=e.length*Math.floor(t/e.length);const n=e.splice(0,t);return e.push(...n),e}function I(e,t){const n={x:[],y:[],z:[],I:[]};for(let i=0;i<e.x.length-1;i++){n.x.push(e.x[i]),n.y.push(e.y[i]),n.z.push(e.z[i]),n.I.push(!0);const r=(e.x[i+1]-e.x[i])/(t[i]+1),o=(e.y[i+1]-e.y[i])/(t[i]+1),a=(e.z[i+1]-e.z[i])/(t[i]+1);for(let e=0;e<t[i]-1;e++)n.x.push(n.x[n.x.length-1]+r),n.y.push(n.y[n.y.length-1]+o),n.z.push(n.z[n.z.length-1]+a),n.I.push(!1)}return n}function S(e,t){const n=[];for(let t=0;t<e.length;++t)n[t]=t;n.sort(function(t,n){return e[t]<e[n]?-1:1});const i=[];for(let e=0;e<t.length;e++)i.push(t[n[e]]);const r=i.reduce(function(e,t,n){return t&&e.push(n),e},[]),o=[];for(let e=0;e<r.length-1;e++)o.push(r[e+1]-r[e]);return o}function D(e,t){const n=new Array(e+t);return n.fill(!1,0,e),n.fill(!0,e,e+t),n}function A(e,t){const n=1/(e-1),i=[n];for(let t=1;t<e-2;t++)i.push(i[i.length-1]+n);return i.concat(t)}function T(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n]/e[e.length-1]);return t}function N(e){const t=[0];for(let n=1;n<e.x.length;n++){const i=Math.sqrt((e.x[n]-e.x[n-1])**2+(e.y[n]-e.y[n-1])**2+(e.z[n]-e.z[n-1])**2);t.push(t[n-1]+i)}return t}function O(e){const t={x:[],y:[],z:[]};for(let n=0;n<e.length;n++)t.x[n]=e[n][0],t.y[n]=e[n][1],t.z[n]=e[n][2];return t.x.push(t.x[0]),t.y.push(t.y[0]),t.z.push(t.z[0]),t}const P=function(e){if(!e.annotation)return;const{isInterpolationUpdate:t,annotation:n}=e;queueMicrotask(()=>{try{t&&(n.isInterpolationUpdate=!0,n.autoGenerated=!1),function(e){const{annotation:t}=e;!function(e){const{parentAnnotationUID:t,annotationUID:n}=e;if(!t)return e.interpolationUID;const i=r.state.getAnnotation(t),{interpolationUID:o}=i,a=i.childAnnotationUIDs.indexOf(n);e.interpolationUID=`${o}-${a}`,e.interpolationUID}(t);const{interpolationData:n,interpolationList:o}=p(t,e)||{};if(!n||!o)return;const a={toolName:t.metadata.toolName,toolType:t.metadata.toolName,viewport:e.viewport};for(let e=0;e<o.length;e++)o[e]&&b(o[e].list,o[e].pair,n,a);const{id:s,renderingEngineId:l,element:c}=e.viewport,u={annotation:t,element:c,viewportId:s,renderingEngineId:l};o.length&&(0,i.triggerEvent)(e.viewport.element,f.A.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,u)}(e)}finally{t&&(n.autoGenerated=!0)}})};function M(e){const{annotation:t}=e,n=s(e,[{key:"interpolationUID",value:e.interpolationUID}]),o=t.metadata.sliceIndex;let a=-1,l=e.sliceData.numberOfSlices;for(const[e,t]of n.entries()){if(e===o)continue;const n=t.find(e=>!e.autoGenerated);n&&(e<o?a=Math.max(e,a):l=Math.min(e,l))}const c=[];for(const[e,t]of n.entries())e<=a||e>=l||e===o||t.forEach(e=>{e.autoGenerated&&(r.state.removeAnnotation(e.annotationUID),c.push(e))});if(c.length){const t={annotations:c,element:e.viewport.element,viewportId:e.viewport.id,renderingEngineId:e.viewport.getRenderingEngine().id};(0,i.triggerEvent)(e.viewport.element,f.A.INTERPOLATED_ANNOTATIONS_REMOVED,t)}if(a>=0&&l<e.sliceData.numberOfSlices){const t=n.get(l)[0],i={viewport:e.viewport,sliceData:{numberOfSlices:e.sliceData.numberOfSlices,imageIndex:t.metadata.sliceIndex},annotation:t,interpolationUID:t.interpolationUID};P(i)}}var k=n(75183),R=n(62514),L=n(85263);const{uuidv4:F}=i.utilities,U=[k.A.HandlesUpdated,k.A.InterpolationUpdated];class B{static{this.toolNames=[]}static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,t={}){const{toolNames:n,segmentationId:i,segmentIndex:o,sliceIndex:a}=t;for(const t of n||B.toolNames){const n=r.state.getAnnotations(t,e);if(n?.length)for(const e of n){const{interpolationUID:t,data:n,autoGenerated:r,metadata:s}=e;t&&(e.interpolationCompleted=!0),r&&(o&&o!==n.segmentation.segmentIndex||void 0!==a&&s&&a!==s.sliceIndex||i&&i!==n.segmentation.segmentationId||((0,L.V)(e),e.autoGenerated=!1))}}}static{this.handleAnnotationCompleted=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n,originalToolName:i}=t.metadata;if(!this.toolNames.includes(n)&&!this.toolNames.includes(i))return;const r=(0,R.A)(t);if(!r)return void console.warn("Unable to find viewport for",t);const o={viewport:r,sliceData:V(r),annotation:t,interpolationUID:t.interpolationUID},a=!!t.interpolationUID;if(t.autoGenerated=!1,a)return M(o),void P(o);const l=[{key:"segmentIndex",value:t.data.segmentation.segmentIndex,parentKey:e=>e.data.segmentation},{key:"viewPlaneNormal",value:t.metadata.viewPlaneNormal,parentKey:e=>e.metadata},{key:"viewUp",value:t.metadata.viewUp,parentKey:e=>e.metadata}];let c=function(e,t){const n=s(e,t),i=[];if(!n?.size)return i;for(const e of n.values())e.forEach(e=>{i.push(e)});return i}(o,l);const{sliceIndex:u}=t.metadata,d=new Set;c.forEach(e=>{if(e.interpolationCompleted||e.metadata.sliceIndex===u){const{interpolationUID:t}=e;d.add(t)}}),c=c.filter(e=>!d.has(e.interpolationUID)),t.interpolationUID=c[0]?.interpolationUID||F(),o.interpolationUID=t.interpolationUID,P(o)}}static{this.handleAnnotationUpdate=e=>{const t=e.detail.annotation,{changeType:n=k.A.HandlesUpdated}=e.detail;if(!t?.metadata)return;const{toolName:i,originalToolName:r}=t.metadata;if(!this.toolNames.includes(i)&&!this.toolNames.includes(r)||!U.includes(n))return;const o=(0,R.A)(t);if(!o)return void console.warn("Unable to find matching viewport for annotation interpolation",t);t.autoGenerated&&((0,L.V)(t),t.autoGenerated=!1);const a={viewport:o,sliceData:V(o),annotation:t,interpolationUID:t.interpolationUID,isInterpolationUpdate:n===k.A.InterpolationUpdated};P(a)}}static{this.handleAnnotationDelete=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n}=t.metadata;if(!this.toolNames.includes(n)||t.autoGenerated)return;const i=(0,R.A)(t);if(!i)return void console.warn("No viewport, can't delete interpolated results",t);const r={viewport:i,sliceData:V(i),annotation:t,interpolationUID:t.interpolationUID};t.autoGenerated=!1,M(r)}}}function V(e){return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getCurrentImageIdIndex()}}},84882:(e,t,n)=>{"use strict";function i(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}n.d(t,{A:()=>r});const r=function(e,t,n={}){const r=n.onFlood,o=n.onBoundary,a=n.equals,s=n.diagonals||!1,l=m(t),c=function(){const e=function(e){const t=[],n=function(e){return e.split("").map(function(e){return parseInt(e,10)-1})};for(let r=0;r<Math.pow(3,e);r+=1){const o=i(r.toString(3),"0",e);t.push(n(o))}return t}(t.length);return e.filter(function(e){const t=function(e){let t=0;for(let n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}(e);return 0!==t&&(1===t||s)})}(),u=[],d=[],h=new Set,p=new Map;for(u.push({currentArgs:t});u.length>0;)f(u.pop());return{flooded:d,boundaries:function(){const e=Array.from(p.values());return e.reverse(),e}()};function f(e){const t=e.currentArgs,n=e.previousArgs;(function(e){const[t,n,i=0]=e,r=t+32768+65536*(n+32768+65536*(i+32768));return h.has(r)})(t)||(function(e){const[t,n,i=0]=e,r=t+32768+65536*(n+32768+65536*(i+32768));h.add(r)}(t),function(e){const t=m(e);return a?a(t,l):t===l}(t)?(function(e){d.push(e),r&&r(...e)}(t),function(e){for(let t=0;t<c.length;t+=1){const n=c[t],i=e.slice(0);for(let t=0;t<e.length;t+=1)i[t]+=n[t];u.push({currentArgs:i,previousArgs:e})}}(t)):function(e){const[t,n,i=0]=e,r=t+32768+65536*(n+32768+65536*(i+32768));p.set(r,e),o&&o(...e)}(n))}function m(t){return e(...t)}}},14957:(e,t,n)=>{"use strict";n.d(t,{n:()=>o});var i=n(7754),r=n(48736);function o(e,t){const n=(0,i.getToolGroup)(e);if(void 0===n)return;const o=n._toolInstances;if(!Object.keys(o).length)return;if(t&&o[t])return[o[t]];return Object.values(o).filter(e=>e instanceof r.A)}},25758:(e,t,n)=>{"use strict";n.d(t,{O:()=>s});var i=n(15327),r=n(99737),o=n(64063),a=n(33283);function s(e){const t=(0,o.R1)(e);if(t)return t;const n=(0,a.T)(e);if(!n)throw new Error(`No segmentation found for segmentationId ${e}`);let s;if(n.representationData.Labelmap)s=function(e,t){const n=e.representationData[r.SegmentationRepresentations.Labelmap],o=new Set;n.imageIds?function(e,t){t.forEach(t=>{i.cache.getImage(t).voxelManager.getScalarData().forEach(t=>{0!==t&&e.add(t)})})}(o,n.imageIds):function(e,t){const n=i.cache.getVolume(t);n.voxelManager.forEach(({value:t})=>{0!==t&&e.add(t)})}(o,t);return Array.from(o).map(Number).sort((e,t)=>e-t)}(n,e);else if(n.representationData.Contour)s=function(e){const{annotationUIDsMap:t,geometryIds:n}=e.representationData.Contour||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${e.segmentationId}`);const r=new Set([...t.keys()]);return n.forEach(e=>{const t=i.cache.getGeometry(e);r.add(t.data.segmentIndex)}),Array.from(r).sort((e,t)=>e-t)}(n);else{if(!n.representationData.Surface)throw new Error(`Unsupported segmentation type: ${n.representationData}`);s=function(e){const t=e.representationData.Surface?.geometryIds??[];return Array.from(t.keys()).map(Number).sort((e,t)=>e-t)}(n)}return(0,o.Dm)(e,s),s}},74802:(e,t,n)=>{"use strict";n.r(t),n.d(t,{contourAndFindLargestBidirectional:()=>k,createBidirectionalToolData:()=>R,createLabelmapVolumeForViewport:()=>p,createMergedLabelmapForIndex:()=>h,floodFill:()=>m.A,getBrushReplaceForToolGroup:()=>C,getBrushSizeForToolGroup:()=>w,getBrushThresholdForToolGroup:()=>b,getBrushToolInstances:()=>y.n,getHoveredContourSegmentationAnnotation:()=>Z,getSegmentIndexAtLabelmapBorder:()=>Y,getSegmentIndexAtWorldPoint:()=>X,getUniqueSegmentIndices:()=>j.O,invalidateBrushCursor:()=>W.E,rectangleROIThresholdVolumeByRange:()=>u,segmentContourAction:()=>B,setBrushReplaceForToolGroup:()=>x,setBrushSizeForToolGroup:()=>_,setBrushThresholdForToolGroup:()=>E,thresholdSegmentationByRange:()=>I,thresholdVolumeByRange:()=>o,triggerSegmentationRender:()=>f.h6,triggerSegmentationRenderBySegmentationId:()=>f.fy});var i=n(26047),r=n(64063);const o=function(e,t,n){const{imageData:o}=e,{overwrite:a,boundsIJK:s}=n,l=n?.overlapType||0,c=e.voxelManager,u=e.voxelManager.getScalarDataLength();if(a)for(let e=0;e<u;e++)c.setAtIndex(e,0);const{baseVolumeIdx:d,volumeInfoList:h}=(0,r.zf)(e,t);let p,f,m;const g=(e,t,n)=>{const{imageData:i,dimensions:o,lower:a,upper:s}=e,c=(0,r.Q5)(i,o,t,n);f=0,p=0,m={lower:a,upper:s};let u=!1;const{voxelManager:d}=i.get("voxelManager");return d.forEach(({value:e})=>{f+=1,e>=m.lower&&e<=m.upper&&(p+=1)},{imageData:i,boundsIJK:c}),0===l?u=p>0:1==l&&(u=p===f),u},v=(e,t)=>{const{imageData:n,lower:i,upper:r}=e,o=n.get("voxelManager").voxelManager,a=o.toIndex(t),s=o.getAtIndex(a);return!(s<=i||s>=r)};return e.voxelManager.forEach(({index:e,pointIJK:t,pointLPS:i})=>{let r=h.length>0;for(let e=0;e<h.length&&(r=h[e].volumeSize===u?v(h[e],t):g(h[e],h[d].spacing,i),r);e++);r&&c.setAtIndex(e,n.segmentIndex||1)},{imageData:o,boundsIJK:s}),(0,i.triggerSegmentationDataModified)(e.volumeId),e};var a=n(47807),s=n(67847),l=n(40336),c=n(37162);const u=function(e,t,n,i){const r=e.map(e=>a.state.getAnnotation(e));let u;!function(e){const t=[l.A.toolName,s.A.toolName];for(const n of e){const e=n.metadata.toolName;if(!t.includes(e))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}(r);for(let e=0;e<n.length;e++){n[e].volume.voxelManager.getScalarDataLength()!==t.voxelManager.getScalarDataLength()&&0!==e||(u=(0,c.A)(r,n[e].volume,i))}const d=o(t,n,{...i,boundsIJK:u});return d.modified(),d};var d=n(15327);const h=function(e,t=1,n="mergedLabelmap"){e.forEach(({direction:t,dimensions:n,origin:i,spacing:r})=>{if(!(d.utilities.isEqual(n,e[0].dimensions)&&d.utilities.isEqual(t,e[0].direction)&&d.utilities.isEqual(r,e[0].spacing)&&d.utilities.isEqual(i,e[0].origin)))throw new Error("labelmaps must have the same size and shape")});const i=e[0],r=new(i.voxelManager.getConstructor())(i.voxelManager.getScalarDataLength());e.forEach(e=>{const n=e.voxelManager,i=n.getScalarDataLength();for(let e=0;e<i;e++)n.getAtIndex(e)===t&&(r[e]=t)});const o={scalarData:r,metadata:i.metadata,spacing:i.spacing,origin:i.origin,direction:i.direction,dimensions:i.dimensions};return d.volumeLoader.createLocalVolume(n,o)};async function p(e){const{viewportId:t,renderingEngineId:n,options:i}=e;let{segmentationId:r}=e;const o=(0,d.getEnabledElementByIds)(t,n);if(!o)throw new Error("element disabled");const{viewport:a}=o;if(!(a instanceof d.VolumeViewport))throw new Error("Segmentation only supports VolumeViewport");const{uid:s}=a.getDefaultActor();if(void 0===r&&(r=`${s}-based-segmentation-${i?.volumeId??d.utilities.uuidv4().slice(0,8)}`),i){const e=structuredClone(i);await d.volumeLoader.createLocalVolume(r,e)}else{const e=a.getVolumeId();await d.volumeLoader.createAndCacheDerivedLabelmapVolume(e,{volumeId:r})}return r}var f=n(24917),m=n(84882),g=n(7754),v=n(58640),y=n(14957);function _(e,t,n){const i=(0,g.getToolGroup)(e);if(void 0===i)return;(0,y.n)(e,n).forEach(e=>{e.configuration.brushSize=t,e.invalidateBrushCursor()});const r=i.getViewportsInfo(),o=Object.keys(r).map(e=>r[e]);if(!o.length)return;const{renderingEngineId:a}=o[0],s=i.getViewportIds();(0,d.getRenderingEngine)(a);(0,v.A)(s)}function w(e,t){const n=(0,g.getToolGroup)(e);if(void 0===n)return;const i=n._toolInstances;if(!Object.keys(i).length)return;const r=(0,y.n)(e,t)[0];return r?r.configuration.brushSize:void 0}function E(e,t,n={isDynamic:!1}){if(void 0===(0,g.getToolGroup)(e))return;const i=(0,y.n)(e),r={...n,...void 0!==t&&{threshold:t}};i.forEach(e=>{e.configuration.strategySpecificConfiguration.THRESHOLD={...e.configuration.strategySpecificConfiguration.THRESHOLD,...r}})}function b(e){const t=(0,g.getToolGroup)(e);if(void 0===t)return;const n=t._toolInstances;if(!Object.keys(n).length)return;const i=(0,y.n)(e)[0];return i?i.configuration.strategySpecificConfiguration.THRESHOLD.threshold:void 0}function x(e,t){if(void 0===(0,g.getToolGroup)(e))return;(0,y.n)(e).forEach(e=>{e.configuration.strategySpecificConfiguration.REPLACE.targetSegmentIndex=t})}function C(e){const t=(0,g.getToolGroup)(e);if(void 0===t)return;const n=t._toolInstances;if(!Object.keys(n).length)return;const i=(0,y.n)(e)[0];return i?i.configuration.strategySpecificConfiguration.REPLACE.targetSegmentIndex:void 0}const I=function(e,t,n,o){const{baseVolumeIdx:a,volumeInfoList:s}=(0,r.zf)(e,n),{voxelManager:l}=s[a],c=l,u=e.voxelManager.getScalarDataLength(),d=e.voxelManager;return s.forEach(e=>{const{volumeSize:n}=e;n===u?function(e,t,n,i){const{lower:r,upper:o}=i,a=e.getScalarDataLength();for(let i=0;i<a;i++)if(e.getAtIndex[i]===n){const a=t.getAtIndex(i);e.setAtIndex(i,a>=r&&a<=o?n:0)}}(d,c,t,e):function(e,t,n,i,o,a,s){const{imageData:l,lower:c,upper:u,dimensions:d}=i;let h,p,f;const m=e.getScalarDataLength();for(let t=0;t<m;t++)if(m.getAtIndex(t)===n){const i=(0,r.Q5)(l,d,o[a].spacing,o[a].imageData.getPoint(t)),m=({value:e})=>{h+=1,e>=f.lower&&e<=f.upper&&(p+=1)};h=0,p=0,f={lower:c,upper:u};let g=!1;e.forEach(m,{imageData:l,boundsIJK:i}),g=0===s?p>0:p===h,e.setAtIndex(t,g?n:0)}}(d,0,t,e,s,a,o)}),(0,i.triggerSegmentationDataModified)(e.volumeId),e};var S=n(54010),D=n(18682),A=n(3823);function T(e,t,n){const i=n.toIJK(e),r=n.toIJK(t),o=A.eR.create(),{testIJK:a}=n,s=A.eR.sub(A.eR.create(),i,r),l=Math.round(Math.max(...s.map(Math.abs)));if(l<2)return!0;const c=A.eR.scale(A.eR.create(),s,1/l);for(let e=1;e<l;e++)if(A.eR.scaleAndAdd(o,r,c,e),!a(o))return!1;return!0}const N=.01;function O(e,t,n){const{sliceContours:i}=e,{segmentIndex:r,containedSegmentIndices:o}=n;let a;const s=function(e,t,n){const i=d.cache.getVolume(e);if(!i)return void console.warn(`No volume found for ${e}`);const r=i.voxelManager,o=i.dimensions[0],a=o*i.dimensions[1];return{testCenter:(e,s)=>{const l=A.eR.add(A.eR.create(),e,s).map(e=>e/2),c=i.imageData.worldToIndex(l).map(Math.round),[u,d,h]=c,p=u+d*o+h*a,f=r.getAtIndex(p);return f===t||n?.has(f)},toIJK:e=>i.imageData.worldToIndex(e),testIJK:e=>{const[i,s,l]=e,c=Math.round(i)+Math.round(s)*o+Math.round(l)*a,u=r.getAtIndex(c);return u===t||n?.has(u)}}}(t,r,o);for(const e of i){const t=P(e,s,a);t&&(a=t)}return a&&Object.assign(a,n),a}function P(e,t,n={maxMajor:0,maxMinor:0}){const{points:i}=e.polyData,{maxMinor:r,maxMajor:o}=n;let a,s=o*o,l=r*r;for(let e=0;e<i.length;e++)for(let n=e+1;n<i.length;n++){const r=i[e],o=i[n],c=A.eR.sqrDist(r,o);c<s||(c-N<s+N&&a||t.testCenter(r,o)&&T(r,o,t)&&(s=c-N,a=[e,n],l=0))}if(!a)return;s=Math.sqrt(s+N);const c=i[a[0]],u=i[a[1]],d=A.eR.sub(A.eR.create(),c,u);let h;A.eR.scale(d,d,1/s);for(let e=0;e<i.length;e++)for(let n=e+1;n<i.length;n++){const r=i[e],o=i[n],a=A.eR.sqrDist(r,o);if(a<=l)continue;const s=A.eR.sub(A.eR.create(),r,o);Math.abs(A.eR.dot(s,d))/Math.sqrt(a)>N||t.testCenter(r,o)&&T(r,o,t)&&(l=a,h=[e,n])}if(!h)return;l=Math.sqrt(l);return{majorAxis:[c,u],minorAxis:[i[h[0]],i[h[1]]],maxMajor:s,maxMinor:l,...e}}const{Labelmap:M}=D.A;function k(e){const t=(0,S.generateContourSetsFromLabelmap)({segmentations:e});if(!t?.length||!t[0].sliceContours.length)return;const{representationData:n,segments:i=[null,{label:"Unspecified",color:null,containedSegmentIndices:null}]}=e,{volumeId:r}=n[M],o=i.findIndex(e=>!!e);return-1!==o?(i[o].segmentIndex=o,O(t[0],r,i[o])):void 0}function R(e,t){const{majorAxis:n,minorAxis:i,label:r="",sliceIndex:o}=e,[a,s]=n,[l,c]=i,u=[a,s,l,c];return{highlighted:!0,invalidated:!0,metadata:{toolName:"Bidirectional",...t.getViewReference({sliceIndex:o})},data:{handles:{points:u,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:r,cachedStats:{}},isLocked:!1,isVisible:!0}}var L=n(25072),F=n(70758),U=n(60740);function B(e,t){const{data:n}=t,i=(0,d.getEnabledElement)(e),r=(n.getSegment||V)(i,n);if(!r)return;const o=i.viewport.getFrameOfReferenceUID(),s=(0,F.K)(),{segmentIndex:l,segmentationId:c}=r,u=a.state.getAnnotations(this.toolName||L.A.toolName,o);let h=!1;const p=u.filter(e=>{const t=e.data.segment;return!!t&&(t.segmentationId===c&&t.segmentIndex===l&&(h=!0,e.data.segment=t),!0)});let f;if(h||p.push({data:{segment:r}}),p.forEach(e=>{const t=[],n=e.data.segment,{segmentIndex:l,segmentationId:c}=n;t[l]=n,a.state.removeAnnotation(e.annotationUID);const u=k({...s.find(e=>e.segmentationId===c),segments:t});if(!u)return;const d=R(u,i.viewport);d.annotationUID=e.annotationUID,d.data.segment=n;const h=a.state.addAnnotation(d,o);if(n.segmentIndex===r.segmentIndex&&n.segmentationId===r.segmentationId){f=u;const{style:e}=r;e&&a.config.style.setAnnotationStyles(h,e)}}),f){const{sliceIndex:t}=f,n=i.viewport.getImageIds();d.utilities.jumpToSlice(e,{imageIndex:n.length-1-t}),i.viewport.render()}else console.warn("No bidirectional found");return f}function V(e,t){const n=(0,F.K)();if(!n.length)return;const i=t.segmentationId||n[0].segmentationId,r=t.segmentIndex??(0,U.Q)(i);if(!r)return;const o=t.segmentData?.get(r);return{label:`Segment ${r}`,segmentIndex:r,segmentationId:i,...o}}var W=n(35706),j=n(25758),H=n(99737),z=n(98870),G=n(6802),q=n(92984),$=n(59452);function X(e,t,n={}){const i=(0,z.getSegmentation)(e),r=i.representationData,o=n?.representationType??Object.keys(r)[0];if(!o)throw new Error(`Segmentation ${e} does not have any representations`);switch(o){case H.SegmentationRepresentations.Labelmap:return function(e,t,{viewport:n}){const i=e.representationData.Labelmap;if(n instanceof d.BaseVolumeViewport){const{volumeId:e}=i,n=d.cache.getVolume(e);if(!n)return;return n.imageData.getScalarValueFromWorld(t)}const r=(0,z.getCurrentLabelmapImageIdForViewport)(n.id,e.segmentationId);if(!d.cache.getImage(r))return;const o=(0,$.wV)(n.id,e.segmentationId),a=o?.actor.getMapper().getInputData(),s=d.utilities.transformWorldToIndex(a,t),l=a.getDimensions(),c=a.voxelManager||d.utilities.VoxelManager.createScalarVolumeVoxelManager({dimensions:l,scalarData:a.getPointData().getScalars().getData()});return c.getAtIJKPoint(s)}(i,t,n);case H.SegmentationRepresentations.Contour:return function(e,t,{viewport:n}){const i=e.representationData.Contour,r=Array.from(i.annotationUIDsMap.keys()),{viewPlaneNormal:o}=n.getCamera();for(const e of r){const n=i.annotationUIDsMap.get(e);if(n)for(const i of n){const n=(0,G.gw)(i);if(!n)continue;const{polyline:r}=n.data.contour;if(d.utilities.isEqual(o,n.metadata.viewPlaneNormal)&&(0,q.isPointInsidePolyline3D)(t,r))return Number(e)}}}(i,t,n);default:return}}var K=n(27108);function Y(e,t,{viewport:n,searchRadius:i}){const r=(0,z.getSegmentation)(e).representationData.Labelmap;if(n instanceof d.BaseVolumeViewport){const{volumeId:e}=r,o=d.cache.getVolume(e);if(!o)return;const a=o.voxelManager,s=o.imageData,l=d.utilities.transformWorldToIndex(s,t),c=a.getAtIJK(l[0],l[1],l[2]),u=function(e,t,n,i,r){const o=(t,r)=>{const o=[e[0]+t,e[1]+r],a=n.canvasToWorld(o),s=i.get("voxelManager").voxelManager,l=d.utilities.transformWorldToIndex(i,a);return s.getAtIJK(l[0],l[1],l[2])};return J(o,t,r)}(n.worldToCanvas(t),c,n,s,i);return u?c:void 0}const o=(0,z.getCurrentLabelmapImageIdForViewport)(n.id,e);if(!d.cache.getImage(o))return;const a=(0,K.wV)(n.id,e),s=a?.actor.getMapper().getInputData(),l=d.utilities.transformWorldToIndex(s,t),c=s.getDimensions(),u=s.voxelManager||d.utilities.VoxelManager.createScalarVolumeVoxelManager({dimensions:c,scalarData:s.getPointData().getScalars().getData()}),h=u.getAtIJKPoint(l),p=function(e,t,n,i,r){const o=(t,i,r)=>{const o=[e[0]+t,e[1]+i,e[2]+r];return n.getAtIJK(o[0],o[1],o[2])};return J(o,i,r)}(l,0,u,h);return p?h:void 0}function J(e,t,n=1){const i=Array.from({length:2*n+1},(e,t)=>t-n);for(const n of i)for(const r of i)for(const o of i){if(0===n&&0===r&&0===o)continue;const i=e(n,r,o);if(void 0!==i&&t!==i)return!0}return!1}function Z(e){const t=(0,z.getSegmentation)(e),{annotationUIDsMap:n}=t.representationData.Contour;for(const[e,t]of n.entries()){if(Array.from(t).find(e=>(0,G.gw)(e).highlighted))return e}}},35706:(e,t,n)=>{"use strict";n.d(t,{E:()=>a});var i=n(7754),r=n(58640),o=n(14957);function a(e){const t=(0,i.getToolGroup)(e);if(void 0===t)return;(0,o.n)(e).forEach(e=>{e.invalidateBrushCursor()});const n=t.getViewportsInfo();if(!Object.keys(n).map(e=>n[e]).length)return;const a=t.getViewportIds();(0,r.A)(a)}},64063:(e,t,n)=>{"use strict";n.d(t,{Dm:()=>d,HM:()=>c,Q5:()=>a,R1:()=>u,zf:()=>s});var i=n(15327),r=n(87063);const o=(e,t)=>JSON.stringify(e)===JSON.stringify(t);function a(e,t,n,o){const a=n[0]/2,s=n[1]/2,l=n[2]/2,c=new Array(8);c[0]=i.utilities.transformWorldToIndex(e,[o[0]-a,o[1]-s,o[2]-l]);const u=[[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]];for(let t=0;t<7;t++){const[n,r,d]=u[t];c[t+1]=i.utilities.transformWorldToIndex(e,[o[0]+n*a,o[1]+r*s,o[2]+d*l])}return(0,r.g)(c,t)}function s(e,t){const{spacing:n}=e,i=e.voxelManager.getScalarDataLength(),r=[];let a=0;for(let e=0;e<t.length;e++){const{imageData:s,spacing:l,dimensions:c,voxelManager:u}=t[e].volume,d=t[e].volume.voxelManager.getScalarDataLength();d===i&&o(l,n)&&(a=e);const h=t[e].lower,p=t[e].upper;r.push({imageData:s,lower:h,upper:p,spacing:l,dimensions:c,volumeSize:d,voxelManager:u})}return{volumeInfoList:r,baseVolumeIdx:a}}const l=new Map,c=e=>{const t=l.get(e);t&&(t.isDirty=!0)},u=e=>{const t=l.get(e);return t&&!t.isDirty?t.indices:null},d=(e,t)=>{l.set(e,{indices:t,isDirty:!1})}},27730:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(52905),r=n(45217);const o=function(e,t,n){let o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,r.A)(n)&&(o="leading"in n?Boolean(n.leading):o,a="trailing"in n?Boolean(n.trailing):a),(0,i.A)(e,t,{leading:o,trailing:a,maxWait:t})}},76260:(e,t,n)=>{"use strict";function i(e,t){const n=c(e),i=c(t);return{page:d(n.page,i.page),client:d(n.client,i.client),canvas:d(n.canvas,i.canvas),world:(r=n.world,o=i.world,[r[0]-o[0],r[1]-o[1],r[2]-o[2]])};var r,o}function r(e,t){const n=c(e),i=c(t);return{page:p(n.page,i.page),client:p(n.client,i.client),canvas:p(n.canvas,i.canvas),world:f(n.world,i.world)}}function o(e,t){}function a(e,t){const n=h(e),i=h(t);return{page:n.page-i.page,client:n.client-i.client,canvas:n.canvas-i.canvas,world:n.world-i.world}}function s(e){return JSON.parse(JSON.stringify(e))}function l(e){return JSON.parse(JSON.stringify(e))}function c(e){return e.reduce((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function u(e){return e.reduce((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length],touch:{identifier:null,radiusX:t.touch.radiusX+n.touch.radiusX/e.length,radiusY:t.touch.radiusY+n.touch.radiusY/e.length,force:t.touch.force+n.touch.force/e.length,rotationAngle:t.touch.rotationAngle+n.touch.rotationAngle/e.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function d(e,t){return[e[0]-t[0],e[1]-t[1]]}function h(e){const t=[];for(let n=0;n<e.length;n++)for(let i=0;i<e.length;i++)n<i&&t.push({page:p(e[n].page,e[i].page),client:p(e[n].client,e[i].client),canvas:p(e[n].canvas,e[i].canvas),world:f(e[n].world,e[i].world)});return t.reduce((e,n)=>({page:e.page+n.page/t.length,client:e.client+n.client/t.length,canvas:e.canvas+n.canvas/t.length,world:e.world+n.world/t.length}),{page:0,client:0,canvas:0,world:0})}function p(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function f(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}n.r(t),n.d(t,{copyPoints:()=>l,copyPointsList:()=>s,getDeltaDistance:()=>r,getDeltaDistanceBetweenIPoints:()=>a,getDeltaPoints:()=>i,getDeltaRotation:()=>o,getMeanPoints:()=>c,getMeanTouchPoints:()=>u})},56069:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(39011);const r=function(e){i.o.renderViewport(e)}},94779:(e,t,n)=>{"use strict";n.d(t,{A:()=>s,_:()=>a});var i=n(15327),r=n(56069),o=n(7754);function a(e){e.forEach(e=>{const t=(0,o.getToolGroup)(e);if(!t)return void console.warn(`ToolGroup not available for ${e}`);t.getViewportsInfo().forEach(e=>{const{renderingEngineId:t,viewportId:n}=e,o=(0,i.getRenderingEngine)(t);if(!o)return void console.warn(`RenderingEngine not available for ${t}`);const a=o.getViewport(n);(0,r.A)(a.element)})})}const s=a},58640:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,t:()=>o});var i=n(15327),r=n(56069);function o(e){e.length&&e.forEach(e=>{const t=(0,i.getEnabledElementByViewportId)(e);if(!t)return void console.warn(`Viewport not available for ${e}`);const{viewport:n}=t;if(!n)return void console.warn(`Viewport not available for ${e}`);const o=n.element;(0,r.A)(o)})}const a=o},8056:(e,t,n)=>{"use strict";function i(e,t){const n=e.length,i=[];for(let r=0;r<n;r++){const n=e[r];n.getFrameOfReferenceUID()===t&&i.push(n)}return i}n.r(t),n.d(t,{filterViewportsWithFrameOfReferenceUID:()=>i,filterViewportsWithParallelNormals:()=>p,filterViewportsWithToolEnabled:()=>c,getViewportIdsWithToolToRender:()=>f});var r=n(99737),o=n(7754);const{Active:a,Passive:s,Enabled:l}=r.ToolModes;function c(e,t){const n=e.length,i=[];for(let r=0;r<n;r++){const n=e[r],a=(0,o.getToolGroupForViewport)(n.id,n.renderingEngineId);if(!a)continue;u(a,t)&&i.push(n)}return i}function u(e,t){const{toolOptions:n}=e,i=n[t];if(!i)return!1;const r=i.mode;return r===a||r===s||r===l}var d=n(15327),h=n(3823);const p=function(e,t,n=.999){return e.filter(e=>{const i=e.getCamera();return Math.abs(h.eR.dot(i.viewPlaneNormal,t.viewPlaneNormal))>n})};function f(e,t,n=!0){const r=(0,d.getEnabledElement)(e),{renderingEngine:o,FrameOfReferenceUID:a}=r;let s=o.getViewports();s=i(s,a),s=c(s,t);const l=o.getViewport(r.viewportId);n&&(s=p(s,l.getCamera()));return s.map(e=>e.id)}},19027:(e,t,n)=>{"use strict";n.r(t),n.d(t,{isViewportPreScaled:()=>i.u});var i=n(18990)},18990:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var i=n(15327);function r(e,t){if(e instanceof i.BaseVolumeViewport){const e=i.utilities.getVolumeId(t),n=i.cache.getVolume(e);return!!n?.scaling&&Object.keys(n.scaling).length>0}if(e instanceof i.StackViewport){const{preScale:t}=e.getImageData()||{};return!!t?.scaled}return!1}},98643:(e,t,n)=>{"use strict";n.r(t),n.d(t,{colorbar:()=>r,windowLevel:()=>a});var i={};n.r(i),n.d(i,{ColorbarRangeTextPosition:()=>o});var r={};n.r(r),n.d(r,{Colorbar:()=>w,Enums:()=>i,ViewportColorbar:()=>C});var o,a={};n.r(a),n.d(a,{calculateMinMaxMean:()=>S,extractWindowLevelRegionToolData:()=>D,getLuminanceFromRegion:()=>I}),function(e){e.Top="top",e.Left="left",e.Bottom="bottom",e.Right="right"}(o||(o={}));var s=n(3823),l=n(15327);const c=e=>e&&e.upper>e.lower,u=e=>!!e&&e.width>0&&e.height>0,d=(e,t)=>!!e&&!!t&&e.lower===t.lower&&e.upper===t.upper,h=(e,t)=>!!e&&!!t&&e.width===t.width&&e.height===t.height,p=(e,t,n)=>[e[0]*(1-n)+t[0]*n,e[1]*(1-n)+t[1]*n,e[2]*(1-n)+t[2]*n],{clamp:f}=l.utilities;class m{constructor(e){m.validateProps(e);const{colormap:t,size:n={width:20,height:100},imageRange:i={lower:0,upper:1},voiRange:r={lower:0,upper:1},container:o,showFullPixelValueRange:a=!1}=e;this._colormap=t,this._imageRange=i,this._voiRange=r,this._showFullImageRange=a,this._canvas=this._createRootElement(n),o&&this.appendTo(o)}get colormap(){return this._colormap}set colormap(e){this._colormap=e,this.render()}get size(){const{width:e,height:t}=this._canvas;return{width:e,height:t}}set size(e){const{_canvas:t}=this;u(e)&&!h(t,e)&&(this._setCanvasSize(t,e),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){c(e)&&!d(e,this._imageRange)&&(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){c(e)&&!d(e,this._voiRange)&&(this._voiRange=e,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(e){e!==this._showFullImageRange&&(this._showFullImageRange=e,this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}dispose(){const{_canvas:e}=this,{parentElement:t}=e;t?.removeChild(e)}static validateProps(e){const{size:t,imageRange:n,voiRange:i}=e;if(t&&!u(t))throw new Error('Invalid "size"');if(n&&!c(n))throw new Error('Invalid "imageRange"');if(i&&!c(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,t){const{width:n,height:i}=t;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createRootElement(e){const t=document.createElement("canvas");return Object.assign(t.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(t,e),t}render(){if(!this._canvas.isConnected)return;const{_colormap:e}=this,{RGBPoints:t}=e,n=t.length/4,i=e=>{const i=4*e;if(!(e<0||e>=n))return{index:e,position:t[i],color:[t[i+1],t[i+2],t[i+3]]}},{width:r,height:o}=this._canvas,a=this._canvas.getContext("2d");if(!a)return;const s=r>o,c=s?r:o,{_voiRange:u}=this,d=this._showFullImageRange?this._imageRange:{...u},{windowWidth:h}=l.utilities.windowLevel.toWindowLevel(u.lower,u.upper);let m,g=i(0);const v=(d.upper-d.lower)/(c-1);let y=d.lower;for(let e=0;e<c;e++){const t=(y-u.lower)/h;if(g)for(let e=g.index;e<n&&!(t<=g.position);e++)m=g,g=i(e+1);let l;if(m)if(g){const e=(t-m.position)/(g.position-m.position);l=p(m.color,g.color,e)}else l=[...m.color];else l=[...g.color];const c=l.map(e=>f(Math.round(255*e),0,255));a.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`,s?a.fillRect(e,0,1,o):a.fillRect(0,o-e-1,r,1),y+=v}}}const g={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class v{constructor(e){v.validateProps(e);const{top:t=0,left:n=0,size:i={width:20,height:100},imageRange:r={lower:0,upper:1},voiRange:a={lower:0,upper:1},ticks:s,container:l,showFullPixelValueRange:c=!1}=e,{style:u,position:d}=s??{};this._imageRange=r,this._voiRange=a,this._font=u?.font??g.FONT,this._color=u?.color??g.COLOR,this._tickSize=u?.tickSize??g.TICK_SIZE,this._tickWidth=u?.tickWidth??g.TICK_WIDTH,this._labelMargin=u?.labelMargin??g.TICK_LABEL_MARGIN,this._maxNumTicks=u?.maxNumTicks??g.MAX_NUM_TICKS,this._rangeTextPosition=d??o.Right,this._showFullPixelValueRange=c,this._canvas=this._createCanvasElement(i,t,n),l&&this.appendTo(l)}get size(){const{width:e,height:t}=this._canvas;return{width:e,height:t}}set size(e){const{_canvas:t}=this;u(e)&&!h(t,e)&&(this._setCanvasSize(t,e),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(e){const{_canvas:t}=this;e!==this.top&&(t.style.top=`${e}px`,this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(e){const{_canvas:t}=this;e!==this.left&&(t.style.left=`${e}px`,this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){c(e)&&!d(e,this._imageRange)&&(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){c(e)&&!d(e,this._voiRange)&&(this._voiRange=e,this.render())}get tickSize(){return this._tickSize}set tickSize(e){e!==this._tickSize&&(this._tickSize=e,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(e){e!==this._tickWidth&&(this._tickWidth=e,this.render())}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(e){e!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=e,this.render())}get visible(){return"block"===this._canvas.style.display}set visible(e){e!==this.visible&&(this._canvas.style.display=e?"block":"none",e&&this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}static validateProps(e){const{size:t,imageRange:n,voiRange:i}=e;if(t&&!u(t))throw new Error('Invalid "size"');if(n&&!c(n))throw new Error('Invalid "imageRange"');if(i&&!c(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,t){const{width:n,height:i}=t;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createCanvasElement(e,t,n){const i=document.createElement("canvas");return Object.assign(i.style,{display:"none",position:"absolute",boxSizing:"border-box",top:`${t}px`,left:`${n}px`}),this._setCanvasSize(i,e),i}_getTicks(e){const{lower:t,upper:n}=e,i=(n-t)/(this._maxNumTicks-1),r=Math.pow(10,-Math.floor(Math.log10(Math.abs(i)))),o=i*r,a=g.TICKS_STEPS.find(e=>e>=o)/r,s=Math.ceil(n/a)*a,l=Math.floor(t/a)*a,c=Math.round((s-l)/a)+1,u=[];for(let e=0;e<c;e++)u.push(l+e*a);return{scaleMin:l,scaleMax:s,step:a,ticks:u}}_getLeftTickInfo({position:e,labelMeasure:t}){const{width:n}=this._canvas;return{labelPoint:[n-this.tickSize-t.width-this._labelMargin,e],tickPoints:{start:[n-this._tickSize,e],end:[n,e]}}}_getRightTickInfo({position:e}){return{labelPoint:[this._tickSize+this._labelMargin,e],tickPoints:{start:[0,e],end:[this._tickSize,e]}}}_getTopTickInfo({position:e,labelMeasure:t}){throw new Error("Not implemented")}_getBottomTickInfo({position:e,labelMeasure:t}){throw new Error("Not implemented")}render(){const{_canvas:e}=this;if(!e.isConnected||!this.visible)return;const{width:t,height:n}=e,i=t>=n,r=i?t:n,a=e.getContext("2d"),{_voiRange:s}=this,l=this._showFullPixelValueRange?this._imageRange:{...s},c=l.upper-l.lower,{ticks:u}=this._getTicks(l);a.clearRect(0,0,t,n),a.font=this._font,a.textBaseline="middle",a.fillStyle=this._color,a.strokeStyle=this._color,a.lineWidth=this.tickWidth,u.forEach(e=>{let t=Math.round(r*((e-l.lower)/c));if(i||(t=n-t),t<0||t>r)return;const s=e.toString(),u=a.measureText(s);let d;d=i?this._rangeTextPosition===o.Top?this._getTopTickInfo({position:t,labelMeasure:u}):this._getBottomTickInfo({position:t,labelMeasure:u}):this._rangeTextPosition===o.Left?this._getLeftTickInfo({position:t,labelMeasure:u}):this._getRightTickInfo({position:t});const{labelPoint:h,tickPoints:p}=d,{start:f,end:m}=p;return a.beginPath(),a.moveTo(f[0],f[1]),a.lineTo(m[0],m[1]),a.fillText(s,h[0],h[1]),a.stroke(),t})}}class y{constructor({id:e,container:t}){this._containerResizeCallback=e=>{let t,n;const{contentRect:i,contentBoxSize:r}=e[0];i?(t=i.width,n=i.height):r?.length&&(t=r[0].inlineSize,n=r[0].blockSize),this._containerSize={width:t,height:n},this.onContainerResize()},this._id=e,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(e),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),t&&this.appendTo(t)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(e){const{_rootElement:t,_containerResizeObserver:n}=this,{parentElement:i}=t;e&&e!==i&&(i&&n.unobserve(i),e.appendChild(t),n.observe(e))}destroy(){const{_rootElement:e,_containerResizeObserver:t}=this,{parentElement:n}=e;n?.removeChild(e),t.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(e){const t=document.createElement("div");return t.id=e,t.classList.add("widget"),Object.assign(t.style,{width:"100%",height:"100%"}),t}onContainerResize(){}}const _={MULTIPLIER:1,RANGE_TEXT_POSITION:o.Right,TICKS_BAR_SIZE:50};class w extends y{constructor(e){super(e),this._isMouseOver=!1,this._isInteracting=!1,this._mouseOverCallback=e=>{this._isMouseOver=!0,this.showTicks(),e.stopPropagation()},this._mouseOutCallback=e=>{this._isMouseOver=!1,this.hideTicks(),e.stopPropagation()},this._mouseDownCallback=e=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(e),e.stopPropagation()},this._mouseDragCallback=(e,t)=>{const n=this.getVOIMultipliers(),i=this._getPointsFromMouseEvent(e),{points:r,voiRange:o}=t,a=s.Zc.sub(s.Zc.create(),i.local,r.local),c=a[0]*n[0],u=a[1]*n[1];if(!c&&!u)return;const{lower:d,upper:h}=o;let{windowWidth:p,windowCenter:f}=l.utilities.windowLevel.toWindowLevel(d,h);p=Math.max(p+c,1),f+=u;const m=l.utilities.windowLevel.toLowHighRange(p,f);this.voiRange=m,e.stopPropagation(),e.preventDefault()},this._mouseUpCallback=e=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),e.stopPropagation()},this._eventListenersManager=new l.utilities.eventListener.MultiTargetEventListenerManager,this._colormaps=w.getColormapsMap(e),this._activeColormapName=w.getInitialColormapName(e),this._canvas=this._createCanvas(e),this._ticksBar=this._createTicksBar(e),this._rangeTextPosition=e.ticks?.position??_.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(e){if(e===this._activeColormapName)return;const t=this._colormaps.get(e);t?(this._activeColormapName=e,this._canvas.colormap=t):console.warn(`Invalid colormap name (${e})`)}get imageRange(){return this._canvas.imageRange}set imageRange(e){this._canvas.imageRange=e,this._ticksBar.imageRange=e}get voiRange(){return this._canvas.voiRange}set voiRange(e){const{voiRange:t}=this._canvas;c(e)&&!d(e,t)&&(this._canvas.voiRange=e,this._ticksBar.voiRange=e,this.onVoiChange(e))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(e){this._canvas.showFullImageRange=e,this._ticksBar.showFullPixelValueRange=e}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const e=document.createElement("div");return Object.assign(e.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),e}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[_.MULTIPLIER,_.MULTIPLIER]}onVoiChange(e){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(e){const{colormaps:t}=e;return t.reduce((e,t)=>e.set(t.Name,t),new Map)}static getInitialColormapName(e){const{activeColormapName:t,colormaps:n}=e;return!!t&&n.some(e=>e.Name===t)?t:n[0].Name}_createCanvas(e){const{imageRange:t,voiRange:n,showFullPixelValueRange:i}=e,r=this._colormaps.get(this._activeColormapName);return new m({colormap:r,imageRange:t,voiRange:n,showFullPixelValueRange:i})}_createTicksBar(e){const t=e.ticks;return new v({imageRange:e.imageRange,voiRange:e.voiRange,ticks:t,showFullPixelValueRange:e.showFullPixelValueRange})}_getPointsFromMouseEvent(e){const{rootElement:t}=this,n=[e.clientX,e.clientY],i=[e.pageX,e.pageY],r=t.getBoundingClientRect();return{client:n,page:i,local:[i[0]-r.left-window.pageXOffset,i[1]-r.top-window.pageYOffset]}}updateTicksBar(){const{width:e,height:t}=this.containerSize;if(0===e&&0===t)return;const{_ticksBar:n,_rangeTextPosition:i}=this,r=e>=t,a=r?e:_.TICKS_BAR_SIZE,s=r?_.TICKS_BAR_SIZE:t;if(!function(e,t,n){return(e>=t?[o.Top,o.Bottom]:[o.Left,o.Right]).includes(n)}(e,t,i))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let l,c;n.size={width:a,height:s},r?(c=0,l=i===o.Top?-s:t):(l=0,c=i===o.Left?-a:e),n.top=l,n.left=c}_addRootElementEventListeners(){const{_eventListenersManager:e}=this,{rootElement:t}=this;e.addEventListener(t,"mouseover",this._mouseOverCallback),e.addEventListener(t,"mouseout",this._mouseOutCallback),e.addEventListener(t,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(e){const{_eventListenersManager:t}=this,n={points:this._getPointsFromMouseEvent(e),voiRange:{...this._canvas.voiRange}};this._removeVOIEventListeners(),t.addEventListener(document,"voi.mouseup",this._mouseUpCallback),t.addEventListener(document,"voi.mousemove",e=>this._mouseDragCallback(e,n))}_removeVOIEventListeners(){const{_eventListenersManager:e}=this;e.removeEventListener(document,"voi.mouseup"),e.removeEventListener(document,"voi.mousemove")}}var E=n(19027);const{Events:b}=l.Enums,x={lower:-1e3,upper:1e3};class C extends w{constructor(e){const{element:t,volumeId:n}=e,i=C._getImageRange(t,n),r=C._getVOIRange(t,n);super({...e,imageRange:i,voiRange:r}),this.autoHideTicks=()=>{if(this._hideTicksTimeoutId)return;const e=this._hideTicksTime-Date.now();e<=0?this.hideTicks():this._hideTicksTimeoutId=window.setTimeout(()=>{this._hideTicksTimeoutId=0,this.autoHideTicks()},e)},this._stackNewImageCallback=()=>{this.imageRange=C._getImageRange(this._element)},this._imageVolumeModifiedCallback=e=>{const{volumeId:t}=e.detail;if(t!==this._volumeId)return;const{_element:n}=this;this.imageRange=C._getImageRange(n,t)},this._viewportVOIModifiedCallback=e=>{const{viewportId:t,volumeId:n,range:i,colormap:r}=e.detail,{viewport:o}=this.enabledElement;t===o.id&&n===this._volumeId&&(this.voiRange=i,r&&(this.activeColormapName=r.name),this.showAndAutoHideTicks())},this._viewportColormapModifiedCallback=e=>{const{viewportId:t,colormap:n,volumeId:i}=e.detail,{viewport:r}=this.enabledElement;t===r.id&&i===this._volumeId&&(this.activeColormapName=n.name)},this._element=t,this._volumeId=n,this._addCornerstoneEventListener()}get element(){return this._element}get enabledElement(){return(0,l.getEnabledElement)(this._element)}getVOIMultipliers(){const{viewport:e}=this.enabledElement;return function(e,t,n){if("PT"===l.utilities.getViewportModality(e,t)){const{clientWidth:i,clientHeight:r}=e.element,o=5/Math.max(i,r),a=(0,E.isViewportPreScaled)(e,t),{fixedPTWindowWidth:s=!0}=n??{},l=s?0:o;return a?[l,o]:[l,4]}return[4,4]}(e,this._volumeId)}onVoiChange(e){super.onVoiChange(e);const{viewport:t}=this.enabledElement;if(t instanceof l.StackViewport)t.setProperties({voiRange:e}),t.render();else if(t instanceof l.VolumeViewport){const{_volumeId:n}=this,i=l.utilities.getViewportsWithVolumeId(n);t.setProperties({voiRange:e},n),i.forEach(e=>e.render())}}static _getImageRange(e,t){const n=(0,l.getEnabledElement)(e),{viewport:i}=n,r=i.getImageActor(t);if(!r)return x;const o=r.getMapper().getInputData().getPointData().getScalars();let a;if(o)a=o.getRange();else{if(!t)throw new Error("volumeId is required when scalarData is not available");const e=l.cache.getVolume(t),[n,i]=e.voxelManager.getRange();a=[n,i]}return 0===a[0]&&0===a[1]?x:{lower:a[0],upper:a[1]}}static _getVOIRange(e,t){const n=(0,l.getEnabledElement)(e),{viewport:i}=n,r=i.getImageActor(t);if(!r)return x;const o=r.getProperty().getRGBTransferFunction(0).getRange();return 0===o[0]&&0===o[1]?x:{lower:o[0],upper:o[1]}}showAndAutoHideTicks(e=1e3){this._hideTicksTime=Date.now()+e,this.showTicks(),this.autoHideTicks()}_addCornerstoneEventListener(){const{_element:e}=this;l.eventTarget.addEventListener(b.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.addEventListener(b.STACK_NEW_IMAGE,this._stackNewImageCallback),e.addEventListener(b.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.addEventListener(b.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}}function I(e,t,n,i,r){const o=[];let a=0;const s=e.scalarData;let l,c,u;if(e.color)for(c=0;c<r;c++)for(u=0;u<i;u++){l=4*((c+n)*e.columns+(u+t));const i=s[l],r=s[l+1],d=s[l+2];o[a++]=.2126*i+.7152*r+.0722*d}else for(c=0;c<r;c++)for(u=0;u<i;u++)l=(c+n)*e.columns+(u+t),o[a++]=s[l];return o}function S(e,t,n){const i=e.length;let r=n,o=t,a=0;if(i<2)return{min:r,max:o,mean:(t+n)/2};for(let t=0;t<i;t++){const n=e[t];r=Math.min(r,n),o=Math.max(o,n),a+=n}return{min:r,max:o,mean:a/i}}function D(e){if(e instanceof l.VolumeViewport)return function(e){const{scalarData:t,width:n,height:i}=l.utilities.getCurrentVolumeViewportSlice(e),{min:r,max:o}=l.utilities.getMinMax(t);return{scalarData:t,minPixelValue:r,maxPixelValue:o,width:n,height:i,rows:n,columns:i}}(e);if(e instanceof l.StackViewport)return function(e){const t=e.getImageData(),{scalarData:n}=t,{min:i,max:r}=l.utilities.getMinMax(n),o=t.dimensions[0],a=t.dimensions[1],{rows:s,columns:c,color:u}=e.getCornerstoneImage();return{scalarData:n,width:o,height:a,minPixelValue:i,maxPixelValue:r,rows:s,columns:c,color:u}}(e);throw new Error("Viewport not supported")}},35056:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>u});var i=n(28906),r=n(42008),o=n(28914);function a(e){let t=0;return e.filter((e,n)=>n===t&&(t+=e+1,!0))}function s(e){let t=0;for(let n=0;n<e.length;)n+=e[n]+1,t++;return t}const l={extractCellSizes:a,getNumberOfCells:s};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.Ay.extend(e,t,function(e){return{empty:!0,numberOfComponents:1,dataType:o.JA.UNSIGNED_INT,...e}}(n)),function(e,t){t.classHierarchy.push("vtkCellArray");const n={...e};e.getNumberOfCells=n=>void 0===t.numberOfCells||n?(t.cellSizes?t.numberOfCells=t.cellSizes.length:t.numberOfCells=s(e.getData()),t.numberOfCells):t.numberOfCells,e.getCellSizes=n=>void 0===t.cellSizes||n?(t.cellSizes=a(e.getData()),t.cellSizes):t.cellSizes,e.resize=i=>{const r=e.getNumberOfTuples();n.resize(i);const o=e.getNumberOfTuples();o<r&&(0===o?(t.numberOfCells=0,t.cellSizes=[]):(t.numberOfCells=void 0,t.cellSizes=void 0))},e.setData=e=>{n.setData(e,1),t.numberOfCells=void 0,t.cellSizes=void 0},e.getCell=e=>{let n=e;const i=t.values[n++];return t.values.subarray(n,n+i)},e.insertNextCell=n=>{const i=e.getNumberOfCells();return e.insertNextTuples([n.length,...n]),++t.numberOfCells,null!=t.cellSizes&&t.cellSizes.push(n.length),i}}(e,t)}var u={newInstance:i.m.newInstance(c,"vtkCellArray"),extend:c,...l}},28914:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,JA:()=>r,uP:()=>i});const i={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},r={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"};var o={DefaultDataType:r.FLOAT,DataTypeByteSize:i,VtkDataTypes:r}},62612:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>r,kP:()=>i});const i={DEFAULT:0,SINGLE:1,DOUBLE:2};var r={AttributeCopyOperations:{COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},AttributeLimitTypes:{MAX:0,EXACT:1,NOLIMIT:2},AttributeTypes:{SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},CellGhostTypes:{DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},DesiredOutputPrecision:i,PointGhostTypes:{DUPLICATEPOINT:1,HIDDENPOINT:2},ghostArrayName:"vtkGhostType"}},258:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,t){return this.oriented||e<t?e*t*.5*(e*t+1)+t:t*e*.5*(t*e+1)+e}insertUniqueEdge(e,t,n){const i=this.computeEdgeKey(e,t);let r=this.edgeMap.get(i);return r||(r={key:i,edgeId:this.edgeMap.size,value:n},this.edgeMap.set(i,r)),r}insertEdge(e,t,n){const i=this.computeEdgeKey(e,t),r={key:i,edgeId:this.edgeMap.size,value:n};return this.edgeMap.set(i,r),r}isInsertedEdge(e,t){const n=this.computeEdgeKey(e,t);return this.edgeMap.get(n)}static getEdgePointIds(e){const t=.5*(-1+Math.sqrt(8*e.key+1)),n=e.key-.5*(t+1)*t;return[n,t-n]}}var r={newInstance:function(){return new i((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oriented)}}},58498:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>p});var i=n(28906),r=n(16632),o=n(21734),a=n(69147),s=n(24964),l=n(85278),c=n(3823);const{vtkErrorMacro:u}=i.m;const d={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:l.e.EMPTY};function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,d,n),a.Ay.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=c.w0.identity(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),i.m.get(e,t,["indexToWorld","worldToIndex"]),i.m.setGetArray(e,t,["origin","spacing"],3),i.m.setGetArray(e,t,["direction"],9),i.m.getArray(e,t,["extent"],6),function(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return u("instance deleted - cannot call any method"),!1;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];const o=1===i.length?i[0]:i;if(6!==o.length)return!1;const a=t.extent.some((e,t)=>e!==o[t]);return a&&(t.extent=o.slice(),t.dataDescription=s.A.getDataDescriptionFromExtent(t.extent),e.modified()),a},e.setDimensions=function(){let n,i,r;if(t.deleted)u("instance deleted - cannot call any method");else{if(1===arguments.length){const e=arguments.length<=0?void 0:arguments[0];n=e[0],i=e[1],r=e[2]}else{if(3!==arguments.length)return void u("Bad dimension specification");n=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2]}e.setExtent(0,n-1,0,i-1,0,r-1)}},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const t=e.getDimensions();let n=1;for(let e=0;e<3;e++){if(0===t[e])return 0;t[e]>1&&(n*=t[e]-1)}return n},e.getNumberOfPoints=()=>{const t=e.getDimensions();return t[0]*t[1]*t[2]},e.getPoint=n=>{const i=e.getDimensions();if(0===i[0]||0===i[1]||0===i[2])return u("Requesting a point from an empty image."),null;const r=new Float64Array(3);switch(t.dataDescription){case l.e.EMPTY:return null;case l.e.SINGLE_POINT:break;case l.e.X_LINE:r[0]=n;break;case l.e.Y_LINE:r[1]=n;break;case l.e.Z_LINE:r[2]=n;break;case l.e.XY_PLANE:r[0]=n%i[0],r[1]=n/i[0];break;case l.e.YZ_PLANE:r[1]=n%i[1],r[2]=n/i[1];break;case l.e.XZ_PLANE:r[0]=n%i[0],r[2]=n/i[0];break;case l.e.XYZ_GRID:r[0]=n%i[0],r[1]=n/i[0]%i[1],r[2]=n/(i[0]*i[1]);break;default:u("Invalid dataDescription")}const o=[0,0,0];return e.indexToWorld(r,o),o},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=e=>o.Ay.transformBounds(e,t.indexToWorld),e.getSpatialExtent=()=>o.Ay.inflate([...t.extent],.5),e.computeTransforms=()=>{c.pB.fromTranslation(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],c.pB.scale(t.indexToWorld,t.indexToWorld,t.spacing),c.pB.invert(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.indexToWorld),n},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.worldToIndex),n},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return o.Ay.transformBounds(e,t.indexToWorld,n)},e.worldToIndexBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return o.Ay.transformBounds(e,t.worldToIndex,n)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>o.Ay.getCenter(e.getBounds()),e.computeHistogram=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=[0,0,0,0,0,0];e.worldToIndexBounds(t,i);const a=[0,0,0],s=[0,0,0];o.Ay.computeCornerPoints(i,a,s),(0,r.b)(a,a),(0,r.b)(s,s);const l=e.getDimensions();(0,r.c)(a,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],a),(0,r.c)(s,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],s);const c=l[0],u=l[0]*l[1],d=e.getPointData().getScalars().getData();let h=-1/0,p=1/0,f=0,m=0,g=0;for(let e=a[2];e<=s[2];e++)for(let t=a[1];t<=s[1];t++){let r=a[0]+t*c+e*u;for(let o=a[0];o<=s[0];o++){if(!n||n([o,t,e],i)){const e=d[r];e>h&&(h=e),e<p&&(p=e),f+=e*e,m+=e,g+=1}++r}}const v=g>0?m/g:0,y=g?Math.abs(f/g-v*v):0;return{minimum:p,maximum:h,average:v,variance:y,sigma:Math.sqrt(y),count:g}},e.computeIncrements=function(e){const t=[];let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let i=0;i<3;++i)t[i]=n,n*=e[2*i+1]-e[2*i]+1;return t},e.computeOffsetIndex=t=>{let[n,i,r]=t;const o=e.getExtent(),a=e.getPointData().getScalars().getNumberOfComponents(),s=e.computeIncrements(o,a);return Math.floor((Math.round(n)-o[0])*s[0]+(Math.round(i)-o[2])*s[1]+(Math.round(r)-o[4])*s[2])},e.getOffsetIndexFromWorld=t=>{const n=e.getExtent(),i=e.worldToIndex(t);for(let e=0;e<3;++e)if(i[e]<n[2*e]||i[e]>n[2*e+1])return u(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${n}`),NaN;return e.computeOffsetIndex(i)},e.getScalarValueFromWorld=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=i)return u(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const r=e.getOffsetIndexFromWorld(t);return Number.isNaN(r)?r:e.getPointData().getScalars().getComponent(r,n)}}(e,t)}var p={newInstance:i.m.newInstance(h,"vtkImageData"),extend:h}},25616:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>f});var i=n(28906),r=n(87275),o=n(258);const a=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],s=[[0,1],[1,3],[2,3],[0,2]];var l={getCase:function(e){return a[e]},getEdge:function(e){return s[e]}};const{vtkErrorMacro:c,vtkDebugMacro:u}=i.m;function d(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],i=[],a=[],s=o.A.newInstance();e.getPixelScalars=(e,t,r,o,a,s)=>{const[l,c,u]=e;n[0]=u*t[1]*t[0]+c*t[0]+l,n[1]=n[0]+o[a],n[2]=n[0]+o[s],n[3]=n[2]+o[a];for(let e=0;e<4;++e)i[e]=r[n[e]]},e.getPixelPoints=(e,t,n,i,r)=>{const o=e[i],s=e[r];a[0]=t[i]+o*n[i],a[1]=t[r]+s*n[r],a[2]=a[0]+n[i],a[3]=a[1],a[4]=a[0],a[5]=a[1]+n[r],a[6]=a[2],a[7]=a[5]},e.produceLines=(r,o,c,u,d,h,p,f,m,g,v)=>{const y=o[t.slicingMode],_=[1,2,8,4],w=[];let E;e.getPixelScalars(o,c,h,m,g,v);let b=0;for(let e=0;e<4;e++)i[e]>=r&&(b|=_[e]);const x=l.getCase(b);if(x[0]<0)return;e.getPixelPoints(o,u,d,g,v);const C=u[t.slicingMode]+y*d[t.slicingMode];for(let e=0;x[e]>=0;e+=2){f.push(2);for(let o=0;o<2;o++){const c=l.getEdge(x[e+o]);if(E=void 0,t.mergePoints&&(E=s.isInsertedEdge(n[c[0]],n[c[1]])?.value),void 0===E){const e=(r-i[c[0]])/(i[c[1]]-i[c[0]]),o=a.slice(2*c[0],2*(c[0]+1)),l=a.slice(2*c[1],2*(c[1]+1));w[g]=o[0]+e*(l[0]-o[0]),w[v]=o[1]+e*(l[1]-o[1]),w[t.slicingMode]=C,E=p.length/3,p.push(w[0],w[1],w[2]),t.mergePoints&&s.insertEdge(n[c[0]],n[c[1]],E)}f.push(E)}}},e.requestData=(n,i)=>{const o=n[0];if(!o)return void c("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void c("Invalid or missing slicing mode");console.time("msquares");const a=o.getOrigin(),l=o.getSpacing(),d=o.getDimensions(),h=o.getExtent(),p=o.computeIncrements(h),f=o.getPointData().getScalars().getData(),[m,g]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),v=[],y=[];let _=Math.round(t.slice);_>=d[t.slicingMode]&&(_=0);const w=[0,0,0];w[t.slicingMode]=_;for(let n=0;n<t.contourValues.length;++n){for(let i=0;i<d[g]-1;++i){w[g]=i;for(let i=0;i<d[m]-1;++i)w[m]=i,e.produceLines(t.contourValues[n],w,d,a,l,f,v,y,p,m,g)}s.initialize()}const E=r.Ay.newInstance();E.getPoints().setData(new Float32Array(v),3),E.getLines().setData(new Uint32Array(y)),i[0]=E,u("Produced output"),console.timeEnd("msquares")}}const h={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,h,n),i.m.obj(e,t),i.m.algo(e,t,1,1),i.m.setGet(e,t,["slicingMode","slice","mergePoints"]),i.m.algo(e,t,1,1),d(e,t)}var f={newInstance:i.m.newInstance(p,"vtkImageMarchingSquares"),extend:p}},56413:(e,t,n)=>{"use strict";function i(e){return new TextDecoder("latin1").decode(e)}n.d(t,{A:()=>r});var r={arrayBufferToString:i,extractBinary:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=i(e),o=t.exec(r);if(!o)return{text:r};const a=o.index+o[0].length,s=r.substring(0,a);let l=null;const c=n?n.exec(r):null;if(c){l={text:s+r.substr(c.index),binaryBuffer:e.slice(a,c.index)}}else l={text:s,binaryBuffer:e.slice(a)};return l}}},8906:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>a,uE:()=>o,zy:()=>r});const i={};function r(e){return!!i[e]}function o(e,t){i[e]=t}var a={get:function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http"](e)},has:r,registerType:o}},67313:(e,t,n)=>{"use strict";var i=n(28906);function r(){const e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return t[0]=161,t[1]=178,t[2]=195,t[3]=212,3569595041===n[0]?"LittleEndian":2712847316===n[0]?"BigEndian":null}var o={ENDIANNESS:r(),getEndianness:r,swapBytes:function(e,t){if(t<2)return;const n=new Int8Array(e),i=n.length,r=[];for(let e=0;e<i;e+=t){for(let i=0;i<t;i++)r.push(n[e+i]);for(let i=0;i<t;i++)n[e+i]=r.pop()}}},a=n(28914),s=n(8906);const{vtkErrorMacro:l,vtkDebugMacro:c}=i.m,u=()=>(l("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let d=0;function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new XMLHttpRequest;return i.open(e,t,!0),n.headers&&Object.entries(n.headers).forEach(e=>{let[t,n]=e;return i.setRequestHeader(t,n)}),n.progressCallback&&i.addEventListener("progress",n.progressCallback),i}const p={fetchArray:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r&&r.compression?u():n.ref&&!n.ref.pending?new Promise((s,u)=>{const p=h("GET",[t,n.ref.basepath,n.ref.id].join("/"),r);p.onreadystatechange=t=>{1===p.readyState&&(n.ref.pending=!0,1===++d&&e?.invokeBusy&&e.invokeBusy(!0)),4===p.readyState&&(n.ref.pending=!1,200===p.status||0===p.status?(n.buffer=p.response,"JSON"===n.ref.encode?n.values=JSON.parse(n.buffer):(o.ENDIANNESS!==n.ref.encode&&o.ENDIANNESS&&(c(`Swap bytes of ${n.name}`),o.swapBytes(n.buffer,a.uP[n.dataType])),n.values=i.m.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&l(`Error in FetchArray: ${n.name}, does not have the proper array size. Got ${n.values.length}, instead of ${n.size}`),delete n.ref,0===--d&&e?.invokeBusy&&e.invokeBusy(!1),e?.modified&&e.modified(),s(n)):u({xhr:p,e:t}))},p.responseType="string"!==n.dataType?"arraybuffer":"text",p.send()}):Promise.resolve(n)},fetchJSON:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n&&n.compression?u():new Promise((i,r)=>{const o=h("GET",t,n);o.onreadystatechange=t=>{1===o.readyState&&1===++d&&e?.invokeBusy&&e.invokeBusy(!0),4===o.readyState&&(0===--d&&e?.invokeBusy&&e.invokeBusy(!1),200===o.status||0===o.status?i(JSON.parse(o.responseText)):r({xhr:o,e:t}))},o.responseType="text",o.send()})},fetchText:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n&&n.compression?u():new Promise((i,r)=>{const o=h("GET",t,n);o.onreadystatechange=t=>{1===o.readyState&&1===++d&&e?.invokeBusy&&e.invokeBusy(!0),4===o.readyState&&(0===--d&&e?.invokeBusy&&e.invokeBusy(!1),200===o.status||0===o.status?i(o.responseText):r({xhr:o,e:t}))},o.responseType="text",o.send()})},fetchBinary:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((n,i)=>{const r=h("GET",e,t);r.onreadystatechange=e=>{4===r.readyState&&(200===r.status||0===r.status?n(r.response):i({xhr:r,e}))},r.responseType="arraybuffer",r.send()})},fetchImage:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((e,i)=>{const r=new Image;n.crossOrigin&&(r.crossOrigin=n.crossOrigin),r.onload=()=>e(r),r.onerror=i,r.src=t})}};(0,s.zy)("http")||(0,s.uE)("http",e=>p)},50761:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(76725);const r=Object.create(null);i.v.filter(e=>e.RGBPoints).filter(e=>"CIELAB"!==e.ColorSpace).forEach(e=>{r[e.Name]=e});const o=Object.keys(r);o.sort();var a={addPreset:function(e){e.RGBPoints&&"CIELAB"!==e.ColorSpace&&(r[e.Name]||(o.push(e.Name),o.sort()),r[e.Name]=e)},removePresetByName:function(e){const t=o.indexOf(e);t>-1&&o.splice(t,1),delete r[e]},getPresetByName:function(e){return r[e]},rgbPresetNames:o}},93008:(e,t,n)=>{var i="__lodash_hash_undefined__",r="[object Function]",o="[object GeneratorFunction]",a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/,l=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,d=/^\[object .+?Constructor\]$/,h="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,p="object"==typeof self&&self&&self.Object===Object&&self,f=h||p||Function("return this")();var m,g=Array.prototype,v=Function.prototype,y=Object.prototype,_=f["__core-js_shared__"],w=(m=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"",E=v.toString,b=y.hasOwnProperty,x=y.toString,C=RegExp("^"+E.call(b).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),I=f.Symbol,S=g.splice,D=U(f,"Map"),A=U(Object,"create"),T=I?I.prototype:void 0,N=T?T.toString:void 0;function O(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function M(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function k(e,t){for(var n=e.length;n--;)if(j(e[n][0],t))return n;return-1}function R(e,t){var n;t=function(e,t){if(H(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||G(e))return!0;return s.test(e)||!a.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:H(n=t)?n:B(n);for(var i=0,r=t.length;null!=e&&i<r;)e=e[V(t[i++])];return i&&i==r?e:void 0}function L(e){if(!z(e)||(t=e,w&&w in t))return!1;var t,n=function(e){var t=z(e)?x.call(e):"";return t==r||t==o}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?C:d;return n.test(function(e){if(null!=e){try{return E.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function F(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function U(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return L(n)?n:void 0}O.prototype.clear=function(){this.__data__=A?A(null):{}},O.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},O.prototype.get=function(e){var t=this.__data__;if(A){var n=t[e];return n===i?void 0:n}return b.call(t,e)?t[e]:void 0},O.prototype.has=function(e){var t=this.__data__;return A?void 0!==t[e]:b.call(t,e)},O.prototype.set=function(e,t){return this.__data__[e]=A&&void 0===t?i:t,this},P.prototype.clear=function(){this.__data__=[]},P.prototype.delete=function(e){var t=this.__data__,n=k(t,e);return!(n<0)&&(n==t.length-1?t.pop():S.call(t,n,1),!0)},P.prototype.get=function(e){var t=this.__data__,n=k(t,e);return n<0?void 0:t[n][1]},P.prototype.has=function(e){return k(this.__data__,e)>-1},P.prototype.set=function(e,t){var n=this.__data__,i=k(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},M.prototype.clear=function(){this.__data__={hash:new O,map:new(D||P),string:new O}},M.prototype.delete=function(e){return F(this,e).delete(e)},M.prototype.get=function(e){return F(this,e).get(e)},M.prototype.has=function(e){return F(this,e).has(e)},M.prototype.set=function(e,t){return F(this,e).set(e,t),this};var B=W(function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(G(e))return N?N.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return l.test(e)&&n.push(""),e.replace(c,function(e,t,i,r){n.push(i?r.replace(u,"$1"):t||e)}),n});function V(e){if("string"==typeof e||G(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function W(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=e.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(W.Cache||M),n}function j(e,t){return e===t||e!=e&&t!=t}W.Cache=M;var H=Array.isArray;function z(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function G(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==x.call(e)}e.exports=function(e,t,n){var i=null==e?void 0:R(e,t);return void 0===i?n:i}},14235:function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=184)}([function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(240)),i(n(251)),i(n(175)),i(n(107)),i(n(29)),i(n(73)),i(n(106)),i(n(30)),i(n(252)),i(n(52)),i(n(97)),i(n(253)),i(n(37)),i(n(51)),i(n(173)),i(n(176)),i(n(172)),i(n(108)),i(n(254)),i(n(255)),i(n(256)),i(n(72)),i(n(177)),i(n(105)),i(n(17)),i(n(257)),i(n(12)),i(n(174))},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(212);t.FixedSizeSet=r.FixedSizeSet;var o=n(213);t.ObjectCache=o.ObjectCache;var a=n(214);t.CompareCache=a.CompareCache;var s=n(215);t.Lazy=s.Lazy;var l=n(216);function c(e,t,n){if(m(e))e.forEach(function(e,i){return t.call(n,i,e)});else for(var i in e)e.hasOwnProperty(i)&&t.call(n,i,e[i])}function u(e){var t,n;if(d(e))return e;if(p(e)){var r=[];try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value;r.push(u(s))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}if(h(e)){for(var l in r={},e)if(e.hasOwnProperty(l)){var c=e[l];r[l]=u(c)}return r}return e}function d(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)}function h(e){var t=typeof e;return!!e&&("function"===t||"object"===t)}function p(e){return Array.isArray(e)}function f(e){return e instanceof Set}function m(e){return e instanceof Map}function g(e){if(h(e)){var t=Object.getPrototypeOf(e),n=t.constructor;return t&&n&&"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)}return!1}t.StringWalker=l.StringWalker,t.applyMixin=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];Object.getOwnPropertyNames(t.prototype).forEach(function(i){if("constructor"!==i){if(-1!==n.indexOf(i)){var r=Object.getOwnPropertyDescriptor(e.prototype,i);r&&Object.defineProperty(e.prototype,"_"+i,r)}var o=Object.getOwnPropertyDescriptor(t.prototype,i);o&&Object.defineProperty(e.prototype,i,o)}})},t.applyDefaults=function e(t,n,i){void 0===i&&(i=!1);var r=u(t||{});return c(n,function(t,n){g(n)?r[t]=e(r[t],n,i):(i||void 0===r[t])&&(r[t]=n)}),r},t.forEachArray=function(e,t,n){e.forEach(t,n)},t.forEachObject=c,t.arrayLength=function(e){return f(e)?e.size:e.length},t.objectLength=function(e){return m(e)?e.size:Object.keys(e).length},t.getObjectValue=function(e,t){return m(e)?e.get(t):e[t]},t.removeObjectValue=function(e,t){m(e)?e.delete(t):delete e[t]},t.clone=u,t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isFunction=d,t.isObject=h,t.isArray=p,t.isSet=f,t.isMap=m,t.isEmpty=function(e){if(p(e))return!e.length;if(f(e))return!e.size;if(m(e))return!e.size;if(h(e)){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},t.isPlainObject=g,t.isIterable=function(e){return e&&"function"==typeof e[Symbol.iterator]},t.getValue=function(e){return d(e.valueOf)?e.valueOf():e},t.utf8Encode=function(e){for(var t=new Uint8Array(4*e.length),n=0,i=0;i<e.length;i++){var r=e.charCodeAt(i);if(r<128)t[n++]=r;else{if(r<2048)t[n++]=r>>6|192;else{if(r>55295&&r<56320){if(++i>=e.length)throw new Error("Incomplete surrogate pair.");var o=e.charCodeAt(i);if(o<56320||o>57343)throw new Error("Invalid surrogate character.");r=65536+((1023&r)<<10)+(1023&o),t[n++]=r>>18|240,t[n++]=r>>12&63|128}else t[n++]=r>>12|224;t[n++]=r>>6&63|128}t[n++]=63&r|128}}return t.subarray(0,n)},t.utf8Decode=function(e){for(var t="",n=0;n<e.length;){var i=e[n++];if(i>127)if(i>191&&i<224){if(n>=e.length)throw new Error("Incomplete 2-byte sequence.");i=(31&i)<<6|63&e[n++]}else if(i>223&&i<240){if(n+1>=e.length)throw new Error("Incomplete 3-byte sequence.");i=(15&i)<<12|(63&e[n++])<<6|63&e[n++]}else{if(!(i>239&&i<248))throw new Error("Unknown multi-byte start.");if(n+2>=e.length)throw new Error("Incomplete 4-byte sequence.");i=(7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++]}if(i<=65535)t+=String.fromCharCode(i);else{if(!(i<=1114111))throw new Error("Code point exceeds UTF-16 limit.");i-=65536,t+=String.fromCharCode(i>>10|55296),t+=String.fromCharCode(1023&i|56320)}}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Before=0]="Before",e[e.Equal=1]="Equal",e[e.After=2]="After"}(t.BoundaryPosition||(t.BoundaryPosition={})),function(e){e[e.None=0]="None",e[e.Capturing=1]="Capturing",e[e.AtTarget=2]="AtTarget",e[e.Bubbling=3]="Bubbling"}(t.EventPhase||(t.EventPhase={})),function(e){e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CData=4]="CData",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation"}(t.NodeType||(t.NodeType={})),function(e){e[e.Disconnected=1]="Disconnected",e[e.Preceding=2]="Preceding",e[e.Following=4]="Following",e[e.Contains=8]="Contains",e[e.ContainedBy=16]="ContainedBy",e[e.ImplementationSpecific=32]="ImplementationSpecific"}(t.Position||(t.Position={})),function(e){e[e.Accept=1]="Accept",e[e.Reject=2]="Reject",e[e.Skip=3]="Skip"}(t.FilterResult||(t.FilterResult={})),function(e){e[e.All=4294967295]="All",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=4]="Text",e[e.CDataSection=8]="CDataSection",e[e.EntityReference=16]="EntityReference",e[e.Entity=32]="Entity",e[e.ProcessingInstruction=64]="ProcessingInstruction",e[e.Comment=128]="Comment",e[e.Document=256]="Document",e[e.DocumentType=512]="DocumentType",e[e.DocumentFragment=1024]="DocumentFragment",e[e.Notation=2048]="Notation"}(t.WhatToShow||(t.WhatToShow={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToEnd=2]="EndToEnd",e[e.EndToStart=3]="EndToStart"}(t.HowToCompare||(t.HowToCompare={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(241);t.Cast=i.Cast;var r=n(150);t.Guard=r.Guard;var o=n(242);t.EmptySet=o.EmptySet},function(e,t,n){var i=n(11),r=n(55).f,o=n(21),a=n(25),s=n(80),l=n(119),c=n(123);e.exports=function(e,t){var n,u,d,h,p,f=e.target,m=e.global,g=e.stat;if(n=m?i:g?i[f]||s(f,{}):(i[f]||{}).prototype)for(u in t){if(h=t[u],d=e.noTargetGet?(p=r(n,u))&&p.value:n[u],!c(m?u:f+(g?".":"#")+u,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;l(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),a(n,u,h,e)}}},function(e,t,n){var i=n(11),r=n(81),o=n(14),a=n(58),s=n(86),l=n(124),c=r("wks"),u=i.Symbol,d=l?u:u&&u.withoutSetter||a;e.exports=function(e){return o(c,e)||(s&&o(u,e)?c[e]=u[e]:c[e]=d("Symbol."+e)),c[e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(29),o=function(){function e(){this._features={mutationObservers:!0,customElements:!0,slots:!0,steps:!0},this._window=null,this._compareCache=new i.CompareCache,this._rangeList=new i.FixedSizeSet}return e.prototype.setFeatures=function(e){if(void 0===e&&(e=!0),i.isObject(e))for(var t in e)this._features[t]=e[t]||!1;else for(var t in this._features)this._features[t]=e},Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"window",{get:function(){return null===this._window&&(this._window=r.create_window()),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compareCache",{get:function(){return this._compareCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeList",{get:function(){return this._rangeList},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}();t.dom=o.instance},function(e,t,n){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(228));t.base64=r;var o=i(n(146));t.byte=o;var a=i(n(147));t.byteSequence=a;var s=i(n(96));t.codePoint=s;var l=i(n(232));t.json=l;var c=i(n(233));t.list=c;var u=i(n(234));t.map=u;var d=i(n(235));t.namespace=d;var h=i(n(236));t.queue=h;var p=i(n(237));t.set=p;var f=i(n(238));t.stack=f;var m=i(n(239));t.string=m},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){void 0===n&&(n="");var i=e.call(this,n)||this;return i.name=t,i}return r(t,e),t}(Error);t.DOMException=o;var a=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"DOMStringSizeError",t)||this}return r(t,e),t}(o);t.DOMStringSizeError=a;var s=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"WrongDocumentError","The object is in the wrong document. "+t)||this}return r(t,e),t}(o);t.WrongDocumentError=s;var l=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NoDataAllowedError",t)||this}return r(t,e),t}(o);t.NoDataAllowedError=l;var c=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NoModificationAllowedError","The object can not be modified. "+t)||this}return r(t,e),t}(o);t.NoModificationAllowedError=c;var u=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NotSupportedError","The operation is not supported. "+t)||this}return r(t,e),t}(o);t.NotSupportedError=u;var d=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InUseAttributeError",t)||this}return r(t,e),t}(o);t.InUseAttributeError=d;var h=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidStateError","The object is in an invalid state. "+t)||this}return r(t,e),t}(o);t.InvalidStateError=h;var p=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidModificationError","The object can not be modified in this way. "+t)||this}return r(t,e),t}(o);t.InvalidModificationError=p;var f=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NamespaceError","The operation is not allowed by Namespaces in XML. [XMLNS] "+t)||this}return r(t,e),t}(o);t.NamespaceError=f;var m=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidAccessError","The object does not support the operation or argument. "+t)||this}return r(t,e),t}(o);t.InvalidAccessError=m;var g=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"ValidationError",t)||this}return r(t,e),t}(o);t.ValidationError=g;var v=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"TypeMismatchError",t)||this}return r(t,e),t}(o);t.TypeMismatchError=v;var y=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"SecurityError","The operation is insecure. "+t)||this}return r(t,e),t}(o);t.SecurityError=y;var _=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NetworkError","A network error occurred. "+t)||this}return r(t,e),t}(o);t.NetworkError=_;var w=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"AbortError","The operation was aborted. "+t)||this}return r(t,e),t}(o);t.AbortError=w;var E=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"URLMismatchError","The given URL does not match another URL. "+t)||this}return r(t,e),t}(o);t.URLMismatchError=E;var b=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"QuotaExceededError","The quota has been exceeded. "+t)||this}return r(t,e),t}(o);t.QuotaExceededError=b;var x=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"TimeoutError","The operation timed out. "+t)||this}return r(t,e),t}(o);t.TimeoutError=x;var C=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidNodeTypeError","The supplied node is incorrect or has an incorrect ancestor for this operation. "+t)||this}return r(t,e),t}(o);t.InvalidNodeTypeError=C;var I=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"DataCloneError","The object can not be cloned. "+t)||this}return r(t,e),t}(o);t.DataCloneError=I;var S=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NotImplementedError","The DOM method is not implemented by this module. "+t)||this}return r(t,e),t}(o);t.NotImplementedError=S;var D=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"HierarchyRequestError","The operation would yield an incorrect node tree. "+t)||this}return r(t,e),t}(o);t.HierarchyRequestError=D;var A=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NotFoundError","The object can not be found here. "+t)||this}return r(t,e),t}(o);t.NotFoundError=A;var T=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"IndexSizeError","The index is not in the allowed range. "+t)||this}return r(t,e),t}(o);t.IndexSizeError=T;var N=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"SyntaxError","The string did not match the expected pattern. "+t)||this}return r(t,e),t}(o);t.SyntaxError=N;var O=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidCharacterError","The string contains invalid characters. "+t)||this}return r(t,e),t}(o);t.InvalidCharacterError=O},function(e,t,n){"use strict";var i=n(53),r=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],o=["scalar","sequence","mapping"];e.exports=function(e,t){var n,a;if(t=t||{},Object.keys(t).forEach(function(t){if(-1===r.indexOf(t))throw new i('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.defaultStyle=t.defaultStyle||null,this.styleAliases=(n=t.styleAliases||null,a={},null!==n&&Object.keys(n).forEach(function(e){n[e].forEach(function(t){a[String(t)]=e})}),a),-1===o.indexOf(this.kind))throw new i('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}},function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")()}).call(this,n(78))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.idl_defineConst=function(e,t,n){Object.defineProperty(e,t,{writable:!1,enumerable:!0,configurable:!1,value:n})}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var i=n(16),r=n(115),o=n(18),a=n(56),s=Object.defineProperty;t.f=i?s:function(e,t,n){if(o(e),t=a(t,!0),o(n),r)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var i=n(8);e.exports=!i(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(2);function a(e,t,n){if(void 0===n&&(n=!1),n&&r.Guard.isElementNode(t)&&r.Guard.isShadowRoot(t.shadowRoot)&&t.shadowRoot._firstChild)return t.shadowRoot._firstChild;if(t._firstChild)return t._firstChild;if(t===e)return null;if(t._nextSibling)return t._nextSibling;for(var i=t._parent;i&&i!==e;){if(i._nextSibling)return i._nextSibling;i=i._parent}return null}function s(){var e;return(e={})[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:null}}}},e}function l(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1);for(var r=t?e:a(e,e,n);r&&i&&!i(r);)r=a(e,r,n);return r}function c(e,t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var o=a(e,t,i);o&&r&&!r(o);)o=a(e,o,i);return o}function u(e,t,n,i){var r;return void 0===t&&(t=!1),void 0===n&&(n=!1),t||0!==e._children.size?((r={})[Symbol.iterator]=function(){var r=t?e:a(e,e,n);return{next:function(){for(;r&&i&&!i(r);)r=a(e,r,n);if(null===r)return{done:!0,value:null};var t={done:!1,value:r};return r=a(e,r,n),t}}},r):s()}function d(e,t,n){void 0===t&&(t=!1);for(var i=t?e:e._parent;i&&n&&!n(i);)i=i._parent;return i}function h(e,t,n,i){void 0===n&&(n=!1);for(var r=t._parent;r&&i&&!i(r);)r=r._parent;return r}function p(e){return r.Guard.isDocumentTypeNode(e)?0:r.Guard.isCharacterDataNode(e)?e._data.length:e._children.size}function f(e,t){if(void 0===t&&(t=!1),t){var n=f(e,!1);return r.Guard.isShadowRoot(n)?f(n._host,!0):n}return e._parent?f(e._parent):e}function m(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var o=n?e:i&&r.Guard.isShadowRoot(e)?e._host:e._parent;null!==o;){if(o===t)return!0;o=i&&r.Guard.isShadowRoot(o)?o._host:o._parent}return!1}function g(e){for(var t=f(e),n=0,i=l(t);null!==i;){if(n++,i===e)return n;i=c(t,i)}return-1}t.tree_getFirstDescendantNode=l,t.tree_getNextDescendantNode=c,t.tree_getDescendantNodes=u,t.tree_getDescendantElements=function(e,t,n,i){var o;return void 0===t&&(t=!1),void 0===n&&(n=!1),t||0!==e._children.size?((o={})[Symbol.iterator]=function(){var o=u(e,t,n,function(e){return r.Guard.isElementNode(e)})[Symbol.iterator](),a=o.next().value;return{next:function(){for(;a&&i&&!i(a);)a=o.next().value;if(null===a)return{done:!0,value:null};var e={done:!1,value:a};return a=o.next().value,e}}},o):s()},t.tree_getSiblingNodes=function(e,t,n){var i;return void 0===t&&(t=!1),e._parent&&0!==e._parent._children.size?((i={})[Symbol.iterator]=function(){var i=e._parent?e._parent._firstChild:null;return{next:function(){for(;i&&(n&&!n(i)||!t&&i===e);)i=i._nextSibling;if(null===i)return{done:!0,value:null};var r={done:!1,value:i};return i=i._nextSibling,r}}},i):s()},t.tree_getFirstAncestorNode=d,t.tree_getNextAncestorNode=h,t.tree_getAncestorNodes=function(e,t,n){var i;return void 0===t&&(t=!1),t||e._parent?((i={})[Symbol.iterator]=function(){var i=d(e,t,n);return{next:function(){if(null===i)return{done:!0,value:null};var e={done:!1,value:i};return i=h(0,i,t,n),e}}},i):s()},t.tree_getCommonAncestor=function(e,t){if(e===t)return e._parent;for(var n=[],i=[],r=d(e,!0);null!==r;)n.push(r),r=h(0,r,!0);for(var o=d(t,!0);null!==o;)i.push(o),o=h(0,o,!0);for(var a=n.length,s=i.length,l=null,c=Math.min(a,s);c>0;c--){var u=n[--a];if(u!==i[--s])break;l=u}return l},t.tree_getFollowingNode=function(e,t){if(t._firstChild)return t._firstChild;if(t._nextSibling)return t._nextSibling;for(;;){var n=t._parent;if(null===n||n===e)return null;if(n._nextSibling)return n._nextSibling;t=n}},t.tree_getPrecedingNode=function(e,t){return t===e?null:t._previousSibling?(t=t._previousSibling)._lastChild?t._lastChild:t:t._parent},t.tree_isConstrained=function e(t){var n,r,a,s,l,c;switch(t._nodeType){case o.NodeType.Document:var u=!1,d=!1;try{for(var h=i(t._children),p=h.next();!p.done;p=h.next())switch(p.value._nodeType){case o.NodeType.ProcessingInstruction:case o.NodeType.Comment:break;case o.NodeType.DocumentType:if(u||d)return!1;u=!0;break;case o.NodeType.Element:if(d)return!1;d=!0;break;default:return!1}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}break;case o.NodeType.DocumentFragment:case o.NodeType.Element:try{for(var f=i(t._children),m=f.next();!m.done;m=f.next())switch(m.value._nodeType){case o.NodeType.Element:case o.NodeType.Text:case o.NodeType.ProcessingInstruction:case o.NodeType.CData:case o.NodeType.Comment:break;default:return!1}}catch(e){a={error:e}}finally{try{m&&!m.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}break;case o.NodeType.DocumentType:case o.NodeType.Text:case o.NodeType.ProcessingInstruction:case o.NodeType.CData:case o.NodeType.Comment:return!t.hasChildNodes()}try{for(var g=i(t._children),v=g.next();!v.done;v=g.next())if(!e(v.value))return!1}catch(e){l={error:e}}finally{try{v&&!v.done&&(c=g.return)&&c.call(g)}finally{if(l)throw l.error}}return!0},t.tree_nodeLength=p,t.tree_isEmpty=function(e){return 0===p(e)},t.tree_rootNode=f,t.tree_isDescendantOf=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var r=l(e,n,i);null!==r;){if(r===t)return!0;r=c(e,r,n,i)}return!1},t.tree_isAncestorOf=m,t.tree_isHostIncludingAncestorOf=function e(t,n,i){if(void 0===i&&(i=!1),m(t,n,i))return!0;var o=f(t);return!(!r.Guard.isDocumentFragmentNode(o)||null===o._host||!e(o._host,n,i))},t.tree_isSiblingOf=function(e,t,n){return void 0===n&&(n=!1),e!==t?null!==e._parent&&e._parent===t._parent:!!n},t.tree_isPreceding=function(e,t){var n=g(e),i=g(t);return-1!==n&&-1!==i&&f(e)===f(t)&&i<n},t.tree_isFollowing=function(e,t){var n=g(e),i=g(t);return-1!==n&&-1!==i&&f(e)===f(t)&&i>n},t.tree_isParentOf=function(e,t){return e._parent===t},t.tree_isChildOf=function(e,t){return t._parent===e},t.tree_previousSibling=function(e){return e._previousSibling},t.tree_nextSibling=function(e){return e._nextSibling},t.tree_firstChild=function(e){return e._firstChild},t.tree_lastChild=function(e){return e._lastChild},t.tree_treePosition=g,t.tree_index=function(e){for(var t=0;null!==e._previousSibling;)t++,e=e._previousSibling;return t},t.tree_retarget=function(e,t){for(;;){if(!e||!r.Guard.isNode(e))return e;var n=f(e);if(!r.Guard.isShadowRoot(n))return e;if(t&&r.Guard.isNode(t)&&m(n,t,!0,!0))return e;e=n.host}}},function(e,t,n){var i=n(13);e.exports=function(e){if(!i(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,n){"use strict";var i=n(24),r=n(130),o=n(49),a=n(43),s=n(88),l=a.set,c=a.getterFor("Array Iterator");e.exports=s(Array,"Array",function(e,t){l(this,{type:"Array Iterator",target:i(e),index:0,kind:t})},function(){var e=c(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:i,done:!1}:"values"==n?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){var i=n(90),r=n(25),o=n(202);i||r(Object.prototype,"toString",o,{unsafe:!0})},function(e,t,n){var i=n(16),r=n(15),o=n(40);e.exports=i?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";var i=n(137).charAt,r=n(43),o=n(88),a=r.set,s=r.getterFor("String Iterator");o(String,"String",function(e){a(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=s(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=i(n,r),t.index+=e.length,{value:e,done:!1})})},function(e,t,n){var i=n(11),r=n(203),o=n(19),a=n(21),s=n(5),l=s("iterator"),c=s("toStringTag"),u=o.values;for(var d in r){var h=i[d],p=h&&h.prototype;if(p){if(p[l]!==u)try{a(p,l,u)}catch(e){p[l]=u}if(p[c]||a(p,c,d),r[d])for(var f in o)if(p[f]!==o[f])try{a(p,f,o[f])}catch(e){p[f]=o[f]}}}},function(e,t,n){var i=n(41),r=n(35);e.exports=function(e){return i(r(e))}},function(e,t,n){var i=n(11),r=n(21),o=n(14),a=n(80),s=n(117),l=n(43),c=l.get,u=l.enforce,d=String(String).split("String");(e.exports=function(e,t,n,s){var l=!!s&&!!s.unsafe,c=!!s&&!!s.enumerable,h=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof t||o(n,"name")||r(n,"name",t),u(n).source=d.join("string"==typeof t?t:"")),e!==i?(l?!h&&e[t]&&(c=!0):delete e[t],c?e[t]=n:r(e,t,n)):c?e[t]=n:a(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&c(this).source||s(this)})},function(e,t,n){var i=n(47),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},function(e,t,n){var i=n(35);e.exports=function(e){return Object(i(e))}},function(e,t,n){var i=n(16),r=n(8),o=n(14),a=Object.defineProperty,s={},l=function(e){throw e};e.exports=function(e,t){if(o(s,e))return s[e];t||(t={});var n=[][e],c=!!o(t,"ACCESSORS")&&t.ACCESSORS,u=o(t,0)?t[0]:l,d=o(t,1)?t[1]:void 0;return s[e]=!!n&&!r(function(){if(c&&!i)return!0;var e={length:-1};c?a(e,1,{enumerable:!0,get:l}):e[1]=1,n.call(e,u,d)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(148),r=n(149),o=n(151),a=n(98),s=n(153),l=n(154),c=n(155),u=n(99),d=n(100),h=n(156),p=n(157),f=n(101),m=n(158),g=n(159),v=n(160),y=n(161),_=n(162),w=n(163),E=n(164),b=n(165),x=n(166),C=n(167),I=n(168),S=n(169),D=n(170);t.create_domImplementation=function(e){return i.DOMImplementationImpl._create(e)},t.create_window=function(){return r.WindowImpl._create()},t.create_xmlDocument=function(){return new o.XMLDocumentImpl},t.create_document=function(){return new a.DocumentImpl},t.create_abortController=function(){return new s.AbortControllerImpl},t.create_abortSignal=function(){return l.AbortSignalImpl._create()},t.create_documentType=function(e,t,n,i){return c.DocumentTypeImpl._create(e,t,n,i)},t.create_element=function(e,t,n,i){return u.ElementImpl._create(e,t,n,i)},t.create_htmlElement=function(e,t,n,i){return u.ElementImpl._create(e,t,n,i)},t.create_htmlUnknownElement=function(e,t,n,i){return u.ElementImpl._create(e,t,n,i)},t.create_documentFragment=function(e){return d.DocumentFragmentImpl._create(e)},t.create_shadowRoot=function(e,t){return h.ShadowRootImpl._create(e,t)},t.create_attr=function(e,t){return p.AttrImpl._create(e,t)},t.create_text=function(e,t){return f.TextImpl._create(e,t)},t.create_cdataSection=function(e,t){return m.CDATASectionImpl._create(e,t)},t.create_comment=function(e,t){return g.CommentImpl._create(e,t)},t.create_processingInstruction=function(e,t,n){return v.ProcessingInstructionImpl._create(e,t,n)},t.create_htmlCollection=function(e,t){return void 0===t&&(t=function(){return!0}),y.HTMLCollectionImpl._create(e,t)},t.create_nodeList=function(e){return _.NodeListImpl._create(e)},t.create_nodeListStatic=function(e,t){return w.NodeListStaticImpl._create(e,t)},t.create_namedNodeMap=function(e){return E.NamedNodeMapImpl._create(e)},t.create_range=function(e,t){return b.RangeImpl._create(e,t)},t.create_nodeIterator=function(e,t,n){return x.NodeIteratorImpl._create(e,t,n)},t.create_treeWalker=function(e,t){return C.TreeWalkerImpl._create(e,t)},t.create_nodeFilter=function(){return I.NodeFilterImpl._create()},t.create_mutationRecord=function(e,t,n,i,r,o,a,s,l){return S.MutationRecordImpl._create(e,t,n,i,r,o,a,s,l)},t.create_domTokenList=function(e,t){return D.DOMTokenListImpl._create(e,t)}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(17),a=n(3),s=n(72),l=new Map;function c(e,t){if(t!==e._root&&o.tree_isAncestorOf(e._reference,t,!0)){if(e._pointerBeforeReference)for(;;){var n=o.tree_getFollowingNode(e._root,t);if(null!==n&&o.tree_isDescendantOf(e._root,n,!0)&&!o.tree_isDescendantOf(t,n,!0))return void(e._reference=n);if(null===n)return void(e._pointerBeforeReference=!1)}if(null===t._previousSibling)null!==t._parent&&(e._reference=t._parent);else{for(var i=t._previousSibling,r=o.tree_getFirstDescendantNode(t._previousSibling,!0,!1);null!==r;)null!==r&&(i=r),r=o.tree_getNextDescendantNode(t._previousSibling,r,!0,!1);e._reference=i}}}function u(e,t,n,i,r){if(a.Guard.isSlot(e)&&"name"===t&&null===r){if(i===n)return;if(null===i&&""===n)return;if(""===i&&null===n)return;e._name=null===i||""===i?"":i,s.shadowTree_assignSlotablesForATree(o.tree_rootNode(e))}}function d(e,t,n,i,r){if(a.Guard.isSlotable(e)&&"slot"===t&&null===r){if(i===n)return;if(null===i&&""===n)return;if(""===i&&null===n)return;e._name=null===i||""===i?"":i,s.shadowTree_isAssigned(e)&&s.shadowTree_assignSlotables(e._assignedSlot),s.shadowTree_assignASlot(e)}}function h(e,t,n,i){"id"===t&&null===i&&(e._uniqueIdentifier=n||void 0)}t.dom_runRemovingSteps=function(e,t){},t.dom_runCloningSteps=function(e,t,n,i){},t.dom_runAdoptingSteps=function(e,t){},t.dom_runAttributeChangeSteps=function(e,t,n,o,a){var s,l;r.dom.features.slots&&(d.call(e,e,t,n,o,a),u.call(e,e,t,n,o,a)),h.call(e,e,t,o,a);try{for(var c=i(e._attributeChangeSteps),p=c.next();!p.done;p=c.next())p.value.call(e,e,t,n,o,a)}catch(e){s={error:e}}finally{try{p&&!p.done&&(l=c.return)&&l.call(c)}finally{if(s)throw s.error}}},t.dom_runInsertionSteps=function(e){},t.dom_runNodeIteratorPreRemovingSteps=function(e,t){c.call(e,e,t)},t.dom_hasSupportedTokens=function(e){return l.has(e)},t.dom_getSupportedTokens=function(e){return l.get(e)||new Set},t.dom_runEventConstructingSteps=function(e){},t.dom_runChildTextContentChangeSteps=function(e){}},function(e,t,n){"use strict";var i=n(4),r=n(11),o=n(46),a=n(44),s=n(16),l=n(86),c=n(124),u=n(8),d=n(14),h=n(59),p=n(13),f=n(18),m=n(27),g=n(24),v=n(56),y=n(40),_=n(60),w=n(61),E=n(82),b=n(190),x=n(85),C=n(55),I=n(15),S=n(79),D=n(21),A=n(25),T=n(81),N=n(57),O=n(45),P=n(58),M=n(5),k=n(125),R=n(126),L=n(62),F=n(43),U=n(36).forEach,B=N("hidden"),V=M("toPrimitive"),W=F.set,j=F.getterFor("Symbol"),H=Object.prototype,z=r.Symbol,G=o("JSON","stringify"),q=C.f,$=I.f,X=b.f,K=S.f,Y=T("symbols"),J=T("op-symbols"),Z=T("string-to-symbol-registry"),Q=T("symbol-to-string-registry"),ee=T("wks"),te=r.QObject,ne=!te||!te.prototype||!te.prototype.findChild,ie=s&&u(function(){return 7!=_($({},"a",{get:function(){return $(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=q(H,t);i&&delete H[t],$(e,t,n),i&&e!==H&&$(H,t,i)}:$,re=function(e,t){var n=Y[e]=_(z.prototype);return W(n,{type:"Symbol",tag:e,description:t}),s||(n.description=t),n},oe=c?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof z},ae=function(e,t,n){e===H&&ae(J,t,n),f(e);var i=v(t,!0);return f(n),d(Y,i)?(n.enumerable?(d(e,B)&&e[B][i]&&(e[B][i]=!1),n=_(n,{enumerable:y(0,!1)})):(d(e,B)||$(e,B,y(1,{})),e[B][i]=!0),ie(e,i,n)):$(e,i,n)},se=function(e,t){f(e);var n=g(t),i=w(n).concat(de(n));return U(i,function(t){s&&!le.call(n,t)||ae(e,t,n[t])}),e},le=function(e){var t=v(e,!0),n=K.call(this,t);return!(this===H&&d(Y,t)&&!d(J,t))&&(!(n||!d(this,t)||!d(Y,t)||d(this,B)&&this[B][t])||n)},ce=function(e,t){var n=g(e),i=v(t,!0);if(n!==H||!d(Y,i)||d(J,i)){var r=q(n,i);return!r||!d(Y,i)||d(n,B)&&n[B][i]||(r.enumerable=!0),r}},ue=function(e){var t=X(g(e)),n=[];return U(t,function(e){d(Y,e)||d(O,e)||n.push(e)}),n},de=function(e){var t=e===H,n=X(t?J:g(e)),i=[];return U(n,function(e){!d(Y,e)||t&&!d(H,e)||i.push(Y[e])}),i};l||(A((z=function(){if(this instanceof z)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=P(e),n=function(e){this===H&&n.call(J,e),d(this,B)&&d(this[B],t)&&(this[B][t]=!1),ie(this,t,y(1,e))};return s&&ne&&ie(H,t,{configurable:!0,set:n}),re(t,e)}).prototype,"toString",function(){return j(this).tag}),A(z,"withoutSetter",function(e){return re(P(e),e)}),S.f=le,I.f=ae,C.f=ce,E.f=b.f=ue,x.f=de,k.f=function(e){return re(M(e),e)},s&&($(z.prototype,"description",{configurable:!0,get:function(){return j(this).description}}),a||A(H,"propertyIsEnumerable",le,{unsafe:!0}))),i({global:!0,wrap:!0,forced:!l,sham:!l},{Symbol:z}),U(w(ee),function(e){R(e)}),i({target:"Symbol",stat:!0,forced:!l},{for:function(e){var t=String(e);if(d(Z,t))return Z[t];var n=z(t);return Z[t]=n,Q[n]=t,n},keyFor:function(e){if(!oe(e))throw TypeError(e+" is not a symbol");if(d(Q,e))return Q[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),i({target:"Object",stat:!0,forced:!l,sham:!s},{create:function(e,t){return void 0===t?_(e):se(_(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:ce}),i({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:ue,getOwnPropertySymbols:de}),i({target:"Object",stat:!0,forced:u(function(){x.f(1)})},{getOwnPropertySymbols:function(e){return x.f(m(e))}}),G&&i({target:"JSON",stat:!0,forced:!l||u(function(){var e=z();return"[null]"!=G([e])||"{}"!=G({a:e})||"{}"!=G(Object(e))})},{stringify:function(e,t,n){for(var i,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);if(i=t,(p(t)||void 0!==e)&&!oe(e))return h(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!oe(t))return t}),r[1]=t,G.apply(null,r)}}),z.prototype[V]||D(z.prototype,V,z.prototype.valueOf),L(z,"Symbol"),O[B]=!0},function(e,t,n){"use strict";var i=n(4),r=n(16),o=n(11),a=n(14),s=n(13),l=n(15).f,c=n(119),u=o.Symbol;if(r&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var d={},h=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof h?new u(e):void 0===e?u():u(e);return""===e&&(d[t]=!0),t};c(h,u);var p=h.prototype=u.prototype;p.constructor=h;var f=p.toString,m="Symbol(test)"==String(u("test")),g=/^Symbol\((.*)\)[^)]+$/;l(p,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=f.call(e);if(a(d,e))return"";var n=m?t.slice(7,-1):t.replace(g,"$1");return""===n?void 0:n}}),i({global:!0,forced:!0},{Symbol:h})}},function(e,t,n){n(126)("iterator")},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(2),l=n(70),c=n(3),u=n(9),d=n(0),h=n(152),p=n(12),f=function(e){function t(){var t=e.call(this)||this;return t._parent=null,t._firstChild=null,t._lastChild=null,t._previousSibling=null,t._nextSibling=null,t}return r(t,e),Object.defineProperty(t.prototype,"_childNodes",{get:function(){return this.__childNodes||(this.__childNodes=d.create_nodeList(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverride||a.dom.window._associatedDocument},set:function(e){this._nodeDocumentOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_registeredObserverList",{get:function(){return this.__registeredObserverList||(this.__registeredObserverList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeName",{get:function(){return c.Guard.isElementNode(this)?this._htmlUppercasedQualifiedName:c.Guard.isAttrNode(this)?this._qualifiedName:c.Guard.isExclusiveTextNode(this)?"#text":c.Guard.isCDATASectionNode(this)?"#cdata-section":c.Guard.isProcessingInstructionNode(this)?this._target:c.Guard.isCommentNode(this)?"#comment":c.Guard.isDocumentNode(this)?"#document":c.Guard.isDocumentTypeNode(this)?this._name:c.Guard.isDocumentFragmentNode(this)?"#document-fragment":""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseURI",{get:function(){return h.urlSerializer(this._nodeDocument._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isConnected",{get:function(){return c.Guard.isElementNode(this)&&d.shadowTree_isConnected(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ownerDocument",{get:function(){return this._nodeType===s.NodeType.Document?null:this._nodeDocument},enumerable:!0,configurable:!0}),t.prototype.getRootNode=function(e){return d.tree_rootNode(this,!!e&&e.composed)},Object.defineProperty(t.prototype,"parentNode",{get:function(){return this._nodeType===s.NodeType.Attribute?null:this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentElement",{get:function(){return this._parent&&c.Guard.isElementNode(this._parent)?this._parent:null},enumerable:!0,configurable:!0}),t.prototype.hasChildNodes=function(){return null!==this._firstChild},Object.defineProperty(t.prototype,"childNodes",{get:function(){return this._childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return c.Guard.isAttrNode(this)?this._value:c.Guard.isCharacterDataNode(this)?this._data:null},set:function(e){null===e&&(e=""),c.Guard.isAttrNode(this)?d.attr_setAnExistingAttributeValue(this,e):c.Guard.isCharacterDataNode(this)&&d.characterData_replaceData(this,0,this._data.length,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textContent",{get:function(){return c.Guard.isDocumentFragmentNode(this)||c.Guard.isElementNode(this)?d.text_descendantTextContent(this):c.Guard.isAttrNode(this)?this._value:c.Guard.isCharacterDataNode(this)?this._data:null},set:function(e){null===e&&(e=""),c.Guard.isDocumentFragmentNode(this)||c.Guard.isElementNode(this)?d.node_stringReplaceAll(e,this):c.Guard.isAttrNode(this)?d.attr_setAnExistingAttributeValue(this,e):c.Guard.isCharacterDataNode(this)&&d.characterData_replaceData(this,0,d.tree_nodeLength(this),e)},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){for(var e,t,n,i,r=[],s=d.tree_getFirstDescendantNode(this,!1,!1,function(e){return c.Guard.isExclusiveTextNode(e)});null!==s;)r.push(s),s=d.tree_getNextDescendantNode(this,s,!1,!1,function(e){return c.Guard.isExclusiveTextNode(e)});for(var l=0;l<r.length;l++){var u=r[l];if(null!==u._parent){var h=d.tree_nodeLength(u);if(0!==h){var p=[],f="";try{for(var m=(e=void 0,o(d.text_contiguousExclusiveTextNodes(u))),g=m.next();!g.done;g=m.next()){var v=g.value;p.push(v),f+=v._data}}catch(t){e={error:t}}finally{try{g&&!g.done&&(t=m.return)&&t.call(m)}finally{if(e)throw e.error}}if(d.characterData_replaceData(u,h,0,f),0!==a.dom.rangeList.size)for(var y=u._nextSibling;null!==y&&c.Guard.isExclusiveTextNode(y);){var _=y,w=d.tree_index(_);try{for(var E=(n=void 0,o(a.dom.rangeList)),b=E.next();!b.done;b=E.next()){var x=b.value;x._start[0]===_&&(x._start[0]=u,x._start[1]+=h),x._end[0]===_&&(x._end[0]=u,x._end[1]+=h),x._start[0]===_._parent&&x._start[1]===w&&(x._start[0]=u,x._start[1]=h),x._end[0]===_._parent&&x._end[1]===w&&(x._end[0]=u,x._end[1]=h)}}catch(e){n={error:e}}finally{try{b&&!b.done&&(i=E.return)&&i.call(E)}finally{if(n)throw n.error}}h+=d.tree_nodeLength(y),y=y._nextSibling}for(var C=0;C<p.length;C++)null!==(v=p[C])._parent&&d.mutation_remove(v,v._parent)}else d.mutation_remove(u,u._parent)}}},t.prototype.cloneNode=function(e){if(void 0===e&&(e=!1),c.Guard.isShadowRoot(this))throw new u.NotSupportedError;return d.node_clone(this,null,e)},t.prototype.isEqualNode=function(e){return void 0===e&&(e=null),null!==e&&d.node_equals(this,e)},t.prototype.isSameNode=function(e){return void 0===e&&(e=null),this===e},t.prototype.compareDocumentPosition=function(e){if(e===this)return 0;var t=e,n=this,i=null,r=null;if(c.Guard.isAttrNode(t)&&(t=(i=t)._element),c.Guard.isAttrNode(n)&&(n=(r=n)._element,i&&t&&t===n))for(var o=0;o<n._attributeList.length;o++){var l=n._attributeList[o];if(d.node_equals(l,i))return s.Position.ImplementationSpecific|s.Position.Preceding;if(d.node_equals(l,r))return s.Position.ImplementationSpecific|s.Position.Following}return null===t||null===n||d.tree_rootNode(t)!==d.tree_rootNode(n)?s.Position.Disconnected|s.Position.ImplementationSpecific|(a.dom.compareCache.check(this,e)?s.Position.Preceding:s.Position.Following):!i&&d.tree_isAncestorOf(n,t)||r&&t===n?s.Position.Contains|s.Position.Preceding:!r&&d.tree_isDescendantOf(n,t)||i&&t===n?s.Position.ContainedBy|s.Position.Following:d.tree_isPreceding(n,t)?s.Position.Preceding:s.Position.Following},t.prototype.contains=function(e){return null!==e&&d.tree_isDescendantOf(this,e,!0)},t.prototype.lookupPrefix=function(e){return e?c.Guard.isElementNode(this)?d.node_locateANamespacePrefix(this,e):c.Guard.isDocumentNode(this)?null===this.documentElement?null:d.node_locateANamespacePrefix(this.documentElement,e):c.Guard.isDocumentTypeNode(this)||c.Guard.isDocumentFragmentNode(this)?null:c.Guard.isAttrNode(this)?null===this._element?null:d.node_locateANamespacePrefix(this._element,e):null!==this._parent&&c.Guard.isElementNode(this._parent)?d.node_locateANamespacePrefix(this._parent,e):null:null},t.prototype.lookupNamespaceURI=function(e){return d.node_locateANamespace(this,e||null)},t.prototype.isDefaultNamespace=function(e){return e||(e=null),d.node_locateANamespace(this,null)===e},t.prototype.insertBefore=function(e,t){return d.mutation_preInsert(e,this,t)},t.prototype.appendChild=function(e){return d.mutation_append(e,this)},t.prototype.replaceChild=function(e,t){return d.mutation_replace(t,e,this)},t.prototype.removeChild=function(e){return d.mutation_preRemove(e,this)},t.prototype._getTheParent=function(e){return c.Guard.isSlotable(this)&&d.shadowTree_isAssigned(this)?this._assignedSlot:this._parent},t.ELEMENT_NODE=1,t.ATTRIBUTE_NODE=2,t.TEXT_NODE=3,t.CDATA_SECTION_NODE=4,t.ENTITY_REFERENCE_NODE=5,t.ENTITY_NODE=6,t.PROCESSING_INSTRUCTION_NODE=7,t.COMMENT_NODE=8,t.DOCUMENT_NODE=9,t.DOCUMENT_TYPE_NODE=10,t.DOCUMENT_FRAGMENT_NODE=11,t.NOTATION_NODE=12,t.DOCUMENT_POSITION_DISCONNECTED=1,t.DOCUMENT_POSITION_PRECEDING=2,t.DOCUMENT_POSITION_FOLLOWING=4,t.DOCUMENT_POSITION_CONTAINS=8,t.DOCUMENT_POSITION_CONTAINED_BY=16,t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,t}(l.EventTargetImpl);t.NodeImpl=f,f.prototype._children=new c.EmptySet,p.idl_defineConst(f.prototype,"ELEMENT_NODE",1),p.idl_defineConst(f.prototype,"ATTRIBUTE_NODE",2),p.idl_defineConst(f.prototype,"TEXT_NODE",3),p.idl_defineConst(f.prototype,"CDATA_SECTION_NODE",4),p.idl_defineConst(f.prototype,"ENTITY_REFERENCE_NODE",5),p.idl_defineConst(f.prototype,"ENTITY_NODE",6),p.idl_defineConst(f.prototype,"PROCESSING_INSTRUCTION_NODE",7),p.idl_defineConst(f.prototype,"COMMENT_NODE",8),p.idl_defineConst(f.prototype,"DOCUMENT_NODE",9),p.idl_defineConst(f.prototype,"DOCUMENT_TYPE_NODE",10),p.idl_defineConst(f.prototype,"DOCUMENT_FRAGMENT_NODE",11),p.idl_defineConst(f.prototype,"NOTATION_NODE",12),p.idl_defineConst(f.prototype,"DOCUMENT_POSITION_DISCONNECTED",1),p.idl_defineConst(f.prototype,"DOCUMENT_POSITION_PRECEDING",2),p.idl_defineConst(f.prototype,"DOCUMENT_POSITION_FOLLOWING",4),p.idl_defineConst(f.prototype,"DOCUMENT_POSITION_CONTAINS",8),p.idl_defineConst(f.prototype,"DOCUMENT_POSITION_CONTAINED_BY",16),p.idl_defineConst(f.prototype,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32)},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var i=n(87),r=n(41),o=n(27),a=n(26),s=n(128),l=[].push,c=function(e){var t=1==e,n=2==e,c=3==e,u=4==e,d=6==e,h=5==e||d;return function(p,f,m,g){for(var v,y,_=o(p),w=r(_),E=i(f,m,3),b=a(w.length),x=0,C=g||s,I=t?C(p,b):n?C(p,0):void 0;b>x;x++)if((h||x in w)&&(y=E(v=w[x],x,_),e))if(t)I[x]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return x;case 2:l.call(I,v)}else if(u)return!1;return d?-1:c||u?u:I}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6)}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(9),l=n(2),c=n(3),u=n(1),d=n(7),h=n(73),p=n(17),f=n(172),m=n(72),g=n(51),v=n(30),y=n(106);function _(e,t,n){var r,o,a,c,u,d,h,f,m=t._nodeType,g=e._nodeType,v=n?n._nodeType:null;if(m!==l.NodeType.Document&&m!==l.NodeType.DocumentFragment&&m!==l.NodeType.Element)throw new s.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+t.nodeName+".");if(p.tree_isHostIncludingAncestorOf(t,e,!0))throw new s.HierarchyRequestError("The node to be inserted cannot be an inclusive ancestor of parent node. Node is "+e.nodeName+", parent node is "+t.nodeName+".");if(null!==n&&n._parent!==t)throw new s.NotFoundError("The reference child node cannot be found under parent node. Child node is "+n.nodeName+", parent node is "+t.nodeName+".");if(g!==l.NodeType.DocumentFragment&&g!==l.NodeType.DocumentType&&g!==l.NodeType.Element&&g!==l.NodeType.Text&&g!==l.NodeType.ProcessingInstruction&&g!==l.NodeType.CData&&g!==l.NodeType.Comment)throw new s.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+e.nodeName+".");if(g===l.NodeType.Text&&m===l.NodeType.Document)throw new s.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+e.nodeName+".");if(g===l.NodeType.DocumentType&&m!==l.NodeType.Document)throw new s.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+t.nodeName+".");if(m===l.NodeType.Document)if(g===l.NodeType.DocumentFragment){var y=0;try{for(var _=i(e._children),w=_.next();!w.done;w=_.next()){var E=w.value;if(E._nodeType===l.NodeType.Element)y++;else if(E._nodeType===l.NodeType.Text)throw new s.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+E.nodeName+".")}}catch(e){r={error:e}}finally{try{w&&!w.done&&(o=_.return)&&o.call(_)}finally{if(r)throw r.error}}if(y>1)throw new s.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+y+" element nodes.");if(1===y){try{for(var b=i(t._children),x=b.next();!x.done;x=b.next())if(x.value._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("The document node already has a document element node.")}catch(e){a={error:e}}finally{try{x&&!x.done&&(c=b.return)&&c.call(b)}finally{if(a)throw a.error}}if(n){if(v===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node.");for(var C=n._nextSibling;C;){if(C._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node.");C=C._nextSibling}}}}else if(g===l.NodeType.Element){try{for(var I=i(t._children),S=I.next();!S.done;S=I.next())if(S.value._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Document already has a document element node. Node is "+e.nodeName+".")}catch(e){u={error:e}}finally{try{S&&!S.done&&(d=I.return)&&d.call(I)}finally{if(u)throw u.error}}if(n){if(v===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+e.nodeName+".");for(C=n._nextSibling;C;){if(C._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+e.nodeName+".");C=C._nextSibling}}}else if(g===l.NodeType.DocumentType){try{for(var D=i(t._children),A=D.next();!A.done;A=D.next())if(A.value._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Document already has a document type node. Node is "+e.nodeName+".")}catch(e){h={error:e}}finally{try{A&&!A.done&&(f=D.return)&&f.call(D)}finally{if(h)throw h.error}}if(n)for(var T=n._previousSibling;T;){if(T._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+e.nodeName+".");T=T._previousSibling}else for(T=t._firstChild;T;){if(T._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+e.nodeName+".");T=T._nextSibling}}}function w(e,t,n){_(e,t,n);var i=n;return i===e&&(i=e._nextSibling),y.document_adopt(e,t._nodeDocument),E(e,t,i),e}function E(e,t,n,r){var s,f;if(null!==n||e._nodeType===l.NodeType.DocumentFragment){var y=e._nodeType===l.NodeType.DocumentFragment?e._children.size:1;if(null!==n&&0!==a.dom.rangeList.size){var _=p.tree_index(n);try{for(var w=i(a.dom.rangeList),E=w.next();!E.done;E=w.next()){var x=E.value;x._start[0]===t&&x._start[1]>_&&(x._start[1]+=y),x._end[0]===t&&x._end[1]>_&&(x._end[1]+=y)}}catch(e){s={error:e}}finally{try{E&&!E.done&&(f=w.return)&&f.call(w)}finally{if(s)throw s.error}}}var C=e._nodeType===l.NodeType.DocumentFragment?new(Array.bind.apply(Array,o([void 0],e._children))):[e];if(e._nodeType===l.NodeType.DocumentFragment)for(;e._firstChild;)b(e._firstChild,e,!0);a.dom.features.mutationObservers&&e._nodeType===l.NodeType.DocumentFragment&&g.observer_queueTreeMutationRecord(e,[],C,null,null);for(var I=n?n._previousSibling:t._lastChild,S=null===n?-1:p.tree_index(n),D=0;D<C.length;D++){var A=C[D];if(c.Guard.isElementNode(A)&&(c.Guard.isDocumentNode(t)&&(t._documentElement=A),A._nodeDocument._hasNamespaces||null===A._namespace&&null===A._namespacePrefix||(A._nodeDocument._hasNamespaces=!0)),A._parent=t,null===n?d.set.append(t._children,A):(d.set.insert(t._children,A,S),S++),null===t._firstChild)A._previousSibling=null,A._nextSibling=null,t._firstChild=A,t._lastChild=A;else{var T=n?n._previousSibling:t._lastChild,N=n||null;A._previousSibling=T,A._nextSibling=N,T&&(T._nextSibling=A),N&&(N._previousSibling=A),T||(t._firstChild=A),N||(t._lastChild=A)}a.dom.features.slots&&null!==t._shadowRoot&&c.Guard.isSlotable(A)&&m.shadowTree_assignASlot(A),a.dom.features.steps&&c.Guard.isTextNode(A)&&v.dom_runChildTextContentChangeSteps(t),a.dom.features.slots&&c.Guard.isShadowRoot(p.tree_rootNode(t))&&c.Guard.isSlot(t)&&u.isEmpty(t._assignedNodes)&&m.shadowTree_signalASlotChange(t),a.dom.features.slots&&m.shadowTree_assignSlotablesForATree(p.tree_rootNode(A));for(var O=p.tree_getFirstDescendantNode(A,!0,!0);null!==O;)a.dom.features.steps&&v.dom_runInsertionSteps(O),a.dom.features.customElements&&c.Guard.isElementNode(O)&&m.shadowTree_isConnected(O)&&(c.Guard.isCustomElementNode(O)?h.customElement_enqueueACustomElementCallbackReaction(O,"connectedCallback",[]):h.customElement_tryToUpgrade(O)),O=p.tree_getNextDescendantNode(A,O,!0,!0)}a.dom.features.mutationObservers&&(r||g.observer_queueTreeMutationRecord(t,C,[],I,n))}else!function(e,t,n){var i=t._lastChild;if(c.Guard.isElementNode(e)&&(c.Guard.isDocumentNode(t)&&(t._documentElement=e),e._nodeDocument._hasNamespaces||null===e._namespace&&null===e._namespacePrefix||(e._nodeDocument._hasNamespaces=!0)),e._parent=t,t._children.add(e),null===t._firstChild)e._previousSibling=null,e._nextSibling=null,t._firstChild=e,t._lastChild=e;else{var r=t._lastChild;e._previousSibling=r,e._nextSibling=null,r&&(r._nextSibling=e),r||(t._firstChild=e),t._lastChild=e}a.dom.features.slots&&null!==t._shadowRoot&&c.Guard.isSlotable(e)&&m.shadowTree_assignASlot(e),a.dom.features.steps&&c.Guard.isTextNode(e)&&v.dom_runChildTextContentChangeSteps(t),a.dom.features.slots&&c.Guard.isShadowRoot(p.tree_rootNode(t))&&c.Guard.isSlot(t)&&u.isEmpty(t._assignedNodes)&&m.shadowTree_signalASlotChange(t),a.dom.features.slots&&m.shadowTree_assignSlotablesForATree(p.tree_rootNode(e)),a.dom.features.steps&&v.dom_runInsertionSteps(e),a.dom.features.customElements&&c.Guard.isElementNode(e)&&m.shadowTree_isConnected(e)&&(c.Guard.isCustomElementNode(e)?h.customElement_enqueueACustomElementCallbackReaction(e,"connectedCallback",[]):h.customElement_tryToUpgrade(e)),a.dom.features.mutationObservers&&(n||g.observer_queueTreeMutationRecord(t,[e],[],i,null))}(e,t,r)}function b(e,t,n){var r,o,s,l,d,y,_,w;if(0!==a.dom.rangeList.size){var E=p.tree_index(e);try{for(var b=i(a.dom.rangeList),x=b.next();!x.done;x=b.next()){var C=x.value;p.tree_isDescendantOf(e,C._start[0],!0)&&(C._start=[t,E]),p.tree_isDescendantOf(e,C._end[0],!0)&&(C._end=[t,E]),C._start[0]===t&&C._start[1]>E&&C._start[1]--,C._end[0]===t&&C._end[1]>E&&C._end[1]--}}catch(e){r={error:e}}finally{try{x&&!x.done&&(o=b.return)&&o.call(b)}finally{if(r)throw r.error}}try{for(var I=i(a.dom.rangeList),S=I.next();!S.done;S=I.next())(C=S.value)._start[0]===t&&C._start[1]>E&&(C._start[1]-=1),C._end[0]===t&&C._end[1]>E&&(C._end[1]-=1)}catch(e){s={error:e}}finally{try{S&&!S.done&&(l=I.return)&&l.call(I)}finally{if(s)throw s.error}}}if(a.dom.features.steps)try{for(var D=i(f.nodeIterator_iteratorList()),A=D.next();!A.done;A=D.next()){var T=A.value;T._root._nodeDocument===e._nodeDocument&&v.dom_runNodeIteratorPreRemovingSteps(T,e)}}catch(e){d={error:e}}finally{try{A&&!A.done&&(y=D.return)&&y.call(D)}finally{if(d)throw d.error}}var N=e._previousSibling,O=e._nextSibling;c.Guard.isDocumentNode(t)&&c.Guard.isElementNode(e)&&(t._documentElement=null),e._parent=null,t._children.delete(e);var P=e._previousSibling,M=e._nextSibling;e._previousSibling=null,e._nextSibling=null,P&&(P._nextSibling=M),M&&(M._previousSibling=P),P||(t._firstChild=M),M||(t._lastChild=P),a.dom.features.slots&&c.Guard.isSlotable(e)&&null!==e._assignedSlot&&m.shadowTree_isAssigned(e)&&m.shadowTree_assignSlotables(e._assignedSlot),a.dom.features.slots&&c.Guard.isShadowRoot(p.tree_rootNode(t))&&c.Guard.isSlot(t)&&u.isEmpty(t._assignedNodes)&&m.shadowTree_signalASlotChange(t),a.dom.features.slots&&null!==p.tree_getFirstDescendantNode(e,!0,!1,function(e){return c.Guard.isSlot(e)})&&(m.shadowTree_assignSlotablesForATree(p.tree_rootNode(t)),m.shadowTree_assignSlotablesForATree(e)),a.dom.features.steps&&v.dom_runRemovingSteps(e,t),a.dom.features.customElements&&c.Guard.isCustomElementNode(e)&&h.customElement_enqueueACustomElementCallbackReaction(e,"disconnectedCallback",[]);for(var k=p.tree_getFirstDescendantNode(e,!1,!0);null!==k;)a.dom.features.steps&&v.dom_runRemovingSteps(k,e),a.dom.features.customElements&&c.Guard.isCustomElementNode(k)&&h.customElement_enqueueACustomElementCallbackReaction(k,"disconnectedCallback",[]),k=p.tree_getNextDescendantNode(e,k,!1,!0);if(a.dom.features.mutationObservers)for(var R=p.tree_getFirstAncestorNode(t,!0);null!==R;){try{for(var L=(_=void 0,i(R._registeredObserverList)),F=L.next();!F.done;F=L.next()){var U=F.value;U.options.subtree&&e._registeredObserverList.push({observer:U.observer,options:U.options,source:U})}}catch(e){_={error:e}}finally{try{F&&!F.done&&(w=L.return)&&w.call(L)}finally{if(_)throw _.error}}R=p.tree_getNextAncestorNode(t,R,!0)}a.dom.features.mutationObservers&&(n||g.observer_queueTreeMutationRecord(t,[],[e],N,O)),a.dom.features.steps&&c.Guard.isTextNode(e)&&v.dom_runChildTextContentChangeSteps(t)}t.mutation_ensurePreInsertionValidity=_,t.mutation_preInsert=w,t.mutation_insert=E,t.mutation_append=function(e,t){return w(e,t,null)},t.mutation_replace=function(e,t,n){var r,o,c,u,d,h,f,m;if(n._nodeType!==l.NodeType.Document&&n._nodeType!==l.NodeType.DocumentFragment&&n._nodeType!==l.NodeType.Element)throw new s.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+n.nodeName+".");if(p.tree_isHostIncludingAncestorOf(n,t,!0))throw new s.HierarchyRequestError("The node to be inserted cannot be an ancestor of parent node. Node is "+t.nodeName+", parent node is "+n.nodeName+".");if(e._parent!==n)throw new s.NotFoundError("The reference child node cannot be found under parent node. Child node is "+e.nodeName+", parent node is "+n.nodeName+".");if(t._nodeType!==l.NodeType.DocumentFragment&&t._nodeType!==l.NodeType.DocumentType&&t._nodeType!==l.NodeType.Element&&t._nodeType!==l.NodeType.Text&&t._nodeType!==l.NodeType.ProcessingInstruction&&t._nodeType!==l.NodeType.CData&&t._nodeType!==l.NodeType.Comment)throw new s.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+t.nodeName+".");if(t._nodeType===l.NodeType.Text&&n._nodeType===l.NodeType.Document)throw new s.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+t.nodeName+".");if(t._nodeType===l.NodeType.DocumentType&&n._nodeType!==l.NodeType.Document)throw new s.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+n.nodeName+".");if(n._nodeType===l.NodeType.Document)if(t._nodeType===l.NodeType.DocumentFragment){var v=0;try{for(var _=i(t._children),w=_.next();!w.done;w=_.next()){var x=w.value;if(x._nodeType===l.NodeType.Element)v++;else if(x._nodeType===l.NodeType.Text)throw new s.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+x.nodeName+".")}}catch(e){r={error:e}}finally{try{w&&!w.done&&(o=_.return)&&o.call(_)}finally{if(r)throw r.error}}if(v>1)throw new s.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+v+" element nodes.");if(1===v){try{for(var C=i(n._children),I=C.next();!I.done;I=C.next())if((O=I.value)._nodeType===l.NodeType.Element&&O!==e)throw new s.HierarchyRequestError("The document node already has a document element node.")}catch(e){c={error:e}}finally{try{I&&!I.done&&(u=C.return)&&u.call(C)}finally{if(c)throw c.error}}for(var S=e._nextSibling;S;){if(S._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node.");S=S._nextSibling}}}else if(t._nodeType===l.NodeType.Element){try{for(var D=i(n._children),A=D.next();!A.done;A=D.next())if((O=A.value)._nodeType===l.NodeType.Element&&O!==e)throw new s.HierarchyRequestError("Document already has a document element node. Node is "+t.nodeName+".")}catch(e){d={error:e}}finally{try{A&&!A.done&&(h=D.return)&&h.call(D)}finally{if(d)throw d.error}}for(S=e._nextSibling;S;){if(S._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+t.nodeName+".");S=S._nextSibling}}else if(t._nodeType===l.NodeType.DocumentType){try{for(var T=i(n._children),N=T.next();!N.done;N=T.next()){var O;if((O=N.value)._nodeType===l.NodeType.DocumentType&&O!==e)throw new s.HierarchyRequestError("Document already has a document type node. Node is "+t.nodeName+".")}}catch(e){f={error:e}}finally{try{N&&!N.done&&(m=T.return)&&m.call(T)}finally{if(f)throw f.error}}for(var P=e._previousSibling;P;){if(P._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+t.nodeName+".");P=P._previousSibling}}var M=e._nextSibling;M===t&&(M=t._nextSibling);var k=e._previousSibling;y.document_adopt(t,n._nodeDocument);var R=[];null!==e._parent&&(R.push(e),b(e,e._parent,!0));var L=[];return t._nodeType===l.NodeType.DocumentFragment?L=Array.from(t._children):L.push(t),E(t,n,M,!0),a.dom.features.mutationObservers&&g.observer_queueTreeMutationRecord(n,L,R,k,M),e},t.mutation_replaceAll=function(e,t){var n,r;null!==e&&y.document_adopt(e,t._nodeDocument);var o=Array.from(t._children),s=[];e&&e._nodeType===l.NodeType.DocumentFragment?s=Array.from(e._children):null!==e&&s.push(e);try{for(var c=i(o),u=c.next();!u.done;u=c.next())b(u.value,t,!0)}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}null!==e&&E(e,t,null,!0),a.dom.features.mutationObservers&&g.observer_queueTreeMutationRecord(t,s,o,null,null)},t.mutation_preRemove=function(e,t){if(e._parent!==t)throw new s.NotFoundError("The child node cannot be found under parent node. Child node is "+e.nodeName+", parent node is "+t.nodeName+".");return b(e,t),e},t.mutation_remove=b},function(e,t,n){"use strict";function i(e){return null==e}e.exports.isNothing=i,e.exports.isObject=function(e){return"object"==typeof e&&null!==e},e.exports.toArray=function(e){return Array.isArray(e)?e:i(e)?[]:[e]},e.exports.repeat=function(e,t){var n,i="";for(n=0;n<t;n+=1)i+=e;return i},e.exports.isNegativeZero=function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},e.exports.extend=function(e,t){var n,i,r,o;if(t)for(n=0,i=(o=Object.keys(t)).length;n<i;n+=1)e[r=o[n]]=t[r];return e}},function(e,t,n){"use strict";var i=n(38),r=n(53),o=n(10);function a(e,t,n){var i=[];return e.include.forEach(function(e){n=a(e,t,n)}),e[t].forEach(function(e){n.forEach(function(t,n){t.tag===e.tag&&t.kind===e.kind&&i.push(n)}),n.push(e)}),n.filter(function(e,t){return-1===i.indexOf(t)})}function s(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(e){if(e.loadKind&&"scalar"!==e.loadKind)throw new r("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=a(this,"implicit",[]),this.compiledExplicit=a(this,"explicit",[]),this.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{}};function i(e){n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(i);return n}(this.compiledImplicit,this.compiledExplicit)}s.DEFAULT=null,s.create=function(){var e,t;switch(arguments.length){case 1:e=s.DEFAULT,t=arguments[0];break;case 2:e=arguments[0],t=arguments[1];break;default:throw new r("Wrong number of arguments for Schema.create function")}if(e=i.toArray(e),t=i.toArray(t),!e.every(function(e){return e instanceof s}))throw new r("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!t.every(function(e){return e instanceof o}))throw new r("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new s({include:e,explicit:t})},e.exports=s},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var i=n(8),r=n(42),o="".split;e.exports=i(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==r(e)?o.call(e,""):Object(e)}:Object},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i,r,o,a=n(186),s=n(11),l=n(13),c=n(21),u=n(14),d=n(57),h=n(45),p=s.WeakMap;if(a){var f=new p,m=f.get,g=f.has,v=f.set;i=function(e,t){return v.call(f,e,t),t},r=function(e){return m.call(f,e)||{}},o=function(e){return g.call(f,e)}}else{var y=d("state");h[y]=!0,i=function(e,t){return c(e,y,t),t},r=function(e){return u(e,y)?e[y]:{}},o=function(e){return u(e,y)}}e.exports={set:i,get:r,has:o,enforce:function(e){return o(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=r(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t){e.exports=!1},function(e,t){e.exports={}},function(e,t,n){var i=n(120),r=n(11),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(i[e])||o(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,n){"use strict";var i=n(8);e.exports=function(e,t){var n=[][e];return!!n&&i(function(){n.call(null,t||function(){throw 1},1)})}},function(e,t){e.exports={}},function(e,t,n){"use strict";n(31),n(32),n(33),n(220),n(64),n(19),n(65),n(20),n(68),n(66),n(92),n(144),n(22),n(94),n(23);var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(69),l=n(95),c=n(7),u=n(0),d=function(){function e(e){this.level=0,this._builderOptions=e}return e.prototype.declaration=function(e,t,n){},e.prototype.docType=function(e,t,n){},e.prototype.comment=function(e){},e.prototype.text=function(e){},e.prototype.instruction=function(e,t){},e.prototype.cdata=function(e){},e.prototype.openTagBegin=function(e){},e.prototype.openTagEnd=function(e,t,n){},e.prototype.closeTag=function(e){},e.prototype.attributes=function(e){var t,n;try{for(var r=i(e),o=r.next();!o.done;o=r.next()){var a=o.value;this.attribute(null===a[1]?a[2]:a[1]+":"+a[2],a[3])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.attribute=function(e,t){},e.prototype.beginElement=function(e){},e.prototype.endElement=function(e){},e.prototype.serializeNode=function(e,t){var n=void 0!==e._nodeDocument&&e._nodeDocument._hasNamespaces;if(this.level=0,this.currentNode=e,n){var i=new l.NamespacePrefixMap;i.set("xml",c.namespace.XML),this._serializeNodeNS(e,null,i,{value:1},t)}else this._serializeNode(e,t)},e.prototype._serializeNodeNS=function(e,t,n,i,r){switch(this.currentNode=e,e.nodeType){case a.NodeType.Element:this._serializeElementNS(e,t,n,i,r);break;case a.NodeType.Document:this._serializeDocumentNS(e,t,n,i,r);break;case a.NodeType.Comment:this._serializeComment(e,r);break;case a.NodeType.Text:this._serializeText(e,r);break;case a.NodeType.DocumentFragment:this._serializeDocumentFragmentNS(e,t,n,i,r);break;case a.NodeType.DocumentType:this._serializeDocumentType(e,r);break;case a.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(e,r);break;case a.NodeType.CData:this._serializeCData(e,r);break;default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeNode=function(e,t){switch(this.currentNode=e,e.nodeType){case a.NodeType.Element:this._serializeElement(e,t);break;case a.NodeType.Document:this._serializeDocument(e,t);break;case a.NodeType.Comment:this._serializeComment(e,t);break;case a.NodeType.Text:this._serializeText(e,t);break;case a.NodeType.DocumentFragment:this._serializeDocumentFragment(e,t);break;case a.NodeType.DocumentType:this._serializeDocumentType(e,t);break;case a.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(e,t);break;case a.NodeType.CData:this._serializeCData(e,t);break;default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeElementNS=function(t,n,r,a,s){var l,d,h=[];if(s&&(-1!==t.localName.indexOf(":")||!u.xml_isName(t.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var p="",f=!1,m=!1,g=r.copy(),v={},y=this._recordNamespaceInformation(t,g,v),_=n,w=t.namespaceURI;if(_===w)null!==y&&(m=!0),p=w===c.namespace.XML?"xml:"+t.localName:t.localName,this.beginElement(p),this.openTagBegin(p);else{var E=t.prefix,b=null;if(null===E&&w===y||(b=g.get(E,w)),"xmlns"===E){if(s)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");b=E}null!==b?(p=b+":"+t.localName,null!==y&&y!==c.namespace.XML&&(_=y||null),this.beginElement(p),this.openTagBegin(p)):null!==E?(E in v&&(E=this._generatePrefix(w,g,a)),g.set(E,w),p+=E+":"+t.localName,this.beginElement(p),this.openTagBegin(p),h.push([null,"xmlns",E,this._serializeAttributeValue(w,s)]),null!==y&&(_=y||null)):null===y||null!==y&&y!==w?(m=!0,p+=t.localName,_=w,this.beginElement(p),this.openTagBegin(p),h.push([null,null,"xmlns",this._serializeAttributeValue(w,s)])):(p+=t.localName,_=w,this.beginElement(p),this.openTagBegin(p))}h.push.apply(h,o(this._serializeAttributesNS(t,g,a,v,m,s))),this.attributes(h);var x=w===c.namespace.HTML;if(x&&0===t.childNodes.length&&e._VoidElementNames.has(t.localName)?(this.openTagEnd(p,!0,!0),this.endElement(p),f=!0):x||0!==t.childNodes.length?this.openTagEnd(p,!1,!1):(this.openTagEnd(p,!0,!1),this.endElement(p),f=!0),!f){if(x&&"template"===t.localName);else try{for(var C=i(t.childNodes),I=C.next();!I.done;I=C.next()){var S=I.value;this.level++,this._serializeNodeNS(S,_,g,a,s),this.level--}}catch(e){l={error:e}}finally{try{I&&!I.done&&(d=C.return)&&d.call(C)}finally{if(l)throw l.error}}this.closeTag(p),this.endElement(p)}},e.prototype._serializeElement=function(e,t){var n,r;if(t&&(-1!==e.localName.indexOf(":")||!u.xml_isName(e.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var o=!1,a=e.localName;this.beginElement(a),this.openTagBegin(a);var s=this._serializeAttributes(e,t);if(this.attributes(s),e.hasChildNodes()?this.openTagEnd(a,!1,!1):(this.openTagEnd(a,!0,!1),this.endElement(a),o=!0),!o){try{for(var l=i(e._children),c=l.next();!c.done;c=l.next()){var d=c.value;this.level++,this._serializeNode(d,t),this.level--}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}this.closeTag(a),this.endElement(a)}},e.prototype._serializeDocumentNS=function(e,t,n,r,o){var a,s;if(o&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");try{for(var l=i(e.childNodes),c=l.next();!c.done;c=l.next()){var u=c.value;this._serializeNodeNS(u,t,n,r,o)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}},e.prototype._serializeDocument=function(e,t){var n,r;if(t&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");try{for(var o=i(e._children),a=o.next();!a.done;a=o.next()){var s=a.value;this._serializeNode(s,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype._serializeComment=function(e,t){if(t&&(!u.xml_isLegalChar(e.data)||-1!==e.data.indexOf("--")||e.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");this.comment(e.data)},e.prototype._serializeText=function(e,t){if(t&&!u.xml_isLegalChar(e.data))throw new Error("Text data contains invalid characters (well-formed required).");var n=e.data.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.text(n)},e.prototype._serializeDocumentFragmentNS=function(e,t,n,r,o){var a,s;try{for(var l=i(e.childNodes),c=l.next();!c.done;c=l.next()){var u=c.value;this._serializeNodeNS(u,t,n,r,o)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}},e.prototype._serializeDocumentFragment=function(e,t){var n,r;try{for(var o=i(e._children),a=o.next();!a.done;a=o.next()){var s=a.value;this._serializeNode(s,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype._serializeDocumentType=function(e,t){if(t&&!u.xml_isPubidChar(e.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(t&&(!u.xml_isLegalChar(e.systemId)||-1!==e.systemId.indexOf('"')&&-1!==e.systemId.indexOf("'")))throw new Error("DocType system identifier contains invalid characters (well-formed required).");this.docType(e.name,e.publicId,e.systemId)},e.prototype._serializeProcessingInstruction=function(e,t){if(t&&(-1!==e.target.indexOf(":")||/^xml$/i.test(e.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(t&&(!u.xml_isLegalChar(e.data)||-1!==e.data.indexOf("?>")))throw new Error("Processing instruction data contains invalid characters (well-formed required).");this.instruction(e.target,e.data)},e.prototype._serializeCData=function(e,t){if(t&&-1!==e.data.indexOf("]]>"))throw new Error("CDATA contains invalid characters (well-formed required).");this.cdata(e.data)},e.prototype._serializeAttributesNS=function(e,t,n,r,o,a){var l,d,h=[],p=a?new s.LocalNameSet:void 0;try{for(var f=i(e.attributes),m=f.next();!m.done;m=f.next()){var g=m.value;if(a||o||null!==g.namespaceURI){if(a&&p&&p.has(g.namespaceURI,g.localName))throw new Error("Element contains duplicate attributes (well-formed required).");a&&p&&p.set(g.namespaceURI,g.localName);var v=g.namespaceURI,y=null;if(null!==v)if(y=t.get(g.prefix,v),v===c.namespace.XMLNS){if(g.value===c.namespace.XML||null===g.prefix&&o||null!==g.prefix&&(!(g.localName in r)||r[g.localName]!==g.value)&&t.has(g.localName,g.value))continue;if(a&&g.value===c.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(a&&""===g.value)throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");"xmlns"===g.prefix&&(y="xmlns")}else null===y&&(y=null===g.prefix||t.hasPrefix(g.prefix)&&!t.has(g.prefix,v)?this._generatePrefix(v,t,n):g.prefix,h.push([null,"xmlns",y,this._serializeAttributeValue(v,a)]));if(a&&(-1!==g.localName.indexOf(":")||!u.xml_isName(g.localName)||"xmlns"===g.localName&&null===v))throw new Error("Attribute local name contains invalid characters (well-formed required).");h.push([v,y,g.localName,this._serializeAttributeValue(g.value,a)])}else h.push([null,null,g.localName,this._serializeAttributeValue(g.value,a)])}}catch(e){l={error:e}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}return h},e.prototype._serializeAttributes=function(e,t){var n,r,o=[],a=t?{}:void 0;try{for(var s=i(e.attributes),l=s.next();!l.done;l=s.next()){var c=l.value;if(t){if(t&&a&&c.localName in a)throw new Error("Element contains duplicate attributes (well-formed required).");if(t&&a&&(a[c.localName]=!0),t&&(-1!==c.localName.indexOf(":")||!u.xml_isName(c.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");o.push([null,null,c.localName,this._serializeAttributeValue(c.value,t)])}else o.push([null,null,c.localName,this._serializeAttributeValue(c.value,t)])}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o},e.prototype._recordNamespaceInformation=function(e,t,n){var r,o,a=null;try{for(var s=i(e.attributes),l=s.next();!l.done;l=s.next()){var u=l.value,d=u.namespaceURI,h=u.prefix;if(d===c.namespace.XMLNS){if(null===h){a=u.value;continue}var p=u.localName,f=u.value;if(f===c.namespace.XML)continue;if(""===f&&(f=null),t.has(p,f))continue;t.set(p,f),n[p]=f||""}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return a},e.prototype._generatePrefix=function(e,t,n){var i="ns"+n.value.toString();return n.value++,t.set(i,e),i},e.prototype._serializeAttributeValue=function(e,t){if(t&&null!==e&&!u.xml_isLegalChar(e))throw new Error("Invalid characters in attribute value.");return null===e?"":e.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),e}();t.BaseWriter=d},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(3),s=n(7),l=n(29),c=n(17),u=n(97);function d(){var e=o.dom.window;e._mutationObserverMicrotaskQueued||(e._mutationObserverMicrotaskQueued=!0,Promise.resolve().then(function(){h()}))}function h(){var e,t,n,r,l=o.dom.window;l._mutationObserverMicrotaskQueued=!1;var c=s.set.clone(l._mutationObservers),d=s.set.clone(l._signalSlots);s.set.empty(l._signalSlots);var h=function(e){var t=s.list.clone(e._recordQueue);s.list.empty(e._recordQueue);for(var n=0;n<e._nodeList.length;n++){var i=e._nodeList[n];s.list.remove(i._registeredObserverList,function(t){return a.Guard.isTransientRegisteredObserver(t)&&t.observer===e})}if(!s.list.isEmpty(t))try{e._callback.call(e,t,e)}catch(e){}};try{for(var p=i(c),f=p.next();!f.done;f=p.next())h(f.value)}catch(t){e={error:t}}finally{try{f&&!f.done&&(t=p.return)&&t.call(p)}finally{if(e)throw e.error}}if(o.dom.features.slots)try{for(var m=i(d),g=m.next();!g.done;g=m.next()){var v=g.value;u.event_fireAnEvent("slotchange",v,void 0,{bubbles:!0})}}catch(e){n={error:e}}finally{try{g&&!g.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}}function p(e,t,n,o,a,s,u,h,p){for(var f,m,g=new Map,v=c.tree_getFirstAncestorNode(t,!0);null!==v;){for(var y=0;y<v._registeredObserverList.length;y++){var _=v._registeredObserverList[y],w=_.options;if((v===t||w.subtree)&&("attributes"!==e||w.attributes)&&("attributes"!==e||!w.attributeFilter||w.attributeFilter.indexOf(n||"")&&null===o)&&("characterData"!==e||w.characterData)&&("childList"!==e||w.childList)){var E=_.observer;g.has(E)||g.set(E,null),("attributes"===e&&w.attributeOldValue||"characterData"===e&&w.characterDataOldValue)&&g.set(E,a)}}v=c.tree_getNextAncestorNode(t,v,!0)}try{for(var b=i(g),x=b.next();!x.done;x=b.next()){var C=r(x.value,2),I=C[0],S=C[1],D=l.create_mutationRecord(e,t,l.create_nodeListStatic(t,s),l.create_nodeListStatic(t,u),h,p,n,o,S);I._recordQueue.push(D)}}catch(e){f={error:e}}finally{try{x&&!x.done&&(m=b.return)&&m.call(b)}finally{if(f)throw f.error}}d()}t.observer_queueAMutationObserverMicrotask=d,t.observer_notifyMutationObservers=h,t.observer_queueMutationRecord=p,t.observer_queueTreeMutationRecord=function(e,t,n,i,r){p("childList",e,null,null,null,t,n,i,r)},t.observer_queueAttributeMutationRecord=function(e,t,n,i){p("attributes",e,t,n,i,[],[],null,null)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(7),o=n(3),a=n(9),s=n(29),l=n(73),c=n(51),u=n(30),d=n(37),h=n(106);function p(e,t,n){i.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(t,e._localName,e._namespace,e._value),i.dom.features.customElements&&o.Guard.isCustomElementNode(t)&&l.customElement_enqueueACustomElementCallbackReaction(t,"attributeChangedCallback",[e._localName,e._value,n,e._namespace]),i.dom.features.steps&&u.dom_runAttributeChangeSteps(t,e._localName,e._value,n,e._namespace),e._value=n}function f(e,t){i.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(t,e._localName,e._namespace,null),i.dom.features.customElements&&o.Guard.isCustomElementNode(t)&&l.customElement_enqueueACustomElementCallbackReaction(t,"attributeChangedCallback",[e._localName,null,e._value,e._namespace]),i.dom.features.steps&&u.dom_runAttributeChangeSteps(t,e._localName,null,e._value,e._namespace),t._attributeList._asArray().push(e),e._element=t,t._nodeDocument._hasNamespaces||null===e._namespace&&null===e._namespacePrefix&&"xmlns"!==e._localName||(t._nodeDocument._hasNamespaces=!0)}function m(e,t){i.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(t,e._localName,e._namespace,e._value),i.dom.features.customElements&&o.Guard.isCustomElementNode(t)&&l.customElement_enqueueACustomElementCallbackReaction(t,"attributeChangedCallback",[e._localName,e._value,null,e._namespace]),i.dom.features.steps&&u.dom_runAttributeChangeSteps(t,e._localName,e._value,null,e._namespace);var n=t._attributeList._asArray().indexOf(e);t._attributeList._asArray().splice(n,1),e._element=null}function g(e,t,n){i.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(n,e._localName,e._namespace,e._value),i.dom.features.customElements&&o.Guard.isCustomElementNode(n)&&l.customElement_enqueueACustomElementCallbackReaction(n,"attributeChangedCallback",[e._localName,e._value,t._value,e._namespace]),i.dom.features.steps&&u.dom_runAttributeChangeSteps(n,e._localName,e._value,t._value,e._namespace);var r=n._attributeList._asArray().indexOf(e);-1!==r&&(n._attributeList._asArray()[r]=t),e._element=null,t._element=n,n._nodeDocument._hasNamespaces||null===t._namespace&&null===t._namespacePrefix&&"xmlns"!==t._localName||(n._nodeDocument._hasNamespaces=!0)}function v(e,t){return t._namespace===r.namespace.HTML&&"html"===t._nodeDocument._type&&(e=e.toLowerCase()),t._attributeList._asArray().find(function(t){return t._qualifiedName===e})||null}function y(e,t,n){var i=e||null;return n._attributeList._asArray().find(function(e){return e._namespace===i&&e._localName===t})||null}t.element_has=function(e,t){return-1!==t._attributeList._asArray().indexOf(e)},t.element_change=p,t.element_append=f,t.element_remove=m,t.element_replace=g,t.element_getAnAttributeByName=v,t.element_getAnAttributeByNamespaceAndLocalName=y,t.element_getAnAttributeValue=function(e,t,n){void 0===n&&(n="");var i=y(n,t,e);return null===i?"":i._value},t.element_setAnAttribute=function(e,t){if(null!==e._element&&e._element!==t)throw new a.InUseAttributeError("This attribute already exists in the document: "+e._qualifiedName+" as a child of "+e._element._qualifiedName+".");var n=y(e._namespace||"",e._localName,t);return n===e?e:(null!==n?g(n,e,t):f(e,t),n)},t.element_setAnAttributeValue=function(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var o=y(r||"",t,e);if(null===o){var a=s.create_attr(e._nodeDocument,t);return a._namespace=r,a._namespacePrefix=i,a._value=n,void f(a,e)}p(o,e,n)},t.element_removeAnAttributeByName=function(e,t){var n=v(e,t);return null!==n&&m(n,t),n},t.element_removeAnAttributeByNamespaceAndLocalName=function(e,t,n){var i=y(e,t,n);return null!==i&&m(i,n),i},t.element_createAnElement=function(e,t,n,o,c,u){void 0===o&&(o=null),void 0===c&&(c=null),void 0===u&&(u=!1);var d=null;if(!i.dom.features.customElements)return(d=s.create_element(e,t,n,o))._customElementState="uncustomized",d._customElementDefinition=null,d._is=c,d;var p=l.customElement_lookUpACustomElementDefinition(e,n,t,c);if(null!==p&&p.name!==p.localName)(d=new(h.document_elementInterface(t,r.namespace.HTML)))._localName=t,d._namespace=r.namespace.HTML,d._namespacePrefix=o,d._customElementState="undefined",d._customElementDefinition=null,d._is=c,d._nodeDocument=e,u?l.customElement_upgrade(p,d):l.customElement_enqueueACustomElementUpgradeReaction(d,p);else if(null!==p)if(u)try{var f=new(0,p.constructor);if(console.assert(void 0!==f._customElementState),console.assert(void 0!==f._customElementDefinition),console.assert(f._namespace===r.namespace.HTML),0!==f._attributeList.length)throw new a.NotSupportedError("Custom element already has attributes.");if(0!==f._children.size)throw new a.NotSupportedError("Custom element already has child nodes.");if(null!==f._parent)throw new a.NotSupportedError("Custom element already has a parent node.");if(f._nodeDocument!==e)throw new a.NotSupportedError("Custom element is already in a document.");if(f._localName!==t)throw new a.NotSupportedError("Custom element has a different local name.");f._namespacePrefix=o,f._is=null}catch(n){(d=s.create_htmlUnknownElement(e,t,r.namespace.HTML,o))._customElementState="failed",d._customElementDefinition=null,d._is=null}else(d=s.create_htmlElement(e,t,r.namespace.HTML,o))._customElementState="undefined",d._customElementDefinition=null,d._is=null,l.customElement_enqueueACustomElementUpgradeReaction(d,p);else(d=new(h.document_elementInterface(t,n)))._localName=t,d._namespace=n,d._namespacePrefix=o,d._customElementState="uncustomized",d._customElementDefinition=null,d._is=c,d._nodeDocument=e,n!==r.namespace.HTML||null===c&&!l.customElement_isValidCustomElementName(t)||(d._customElementState="undefined");if(null===d)throw new Error("Unable to create element.");return d},t.element_insertAdjacent=function(e,t,n){switch(t.toLowerCase()){case"beforebegin":return null===e._parent?null:d.mutation_preInsert(n,e._parent,e);case"afterbegin":return d.mutation_preInsert(n,e,e._firstChild);case"beforeend":return d.mutation_preInsert(n,e,null);case"afterend":return null===e._parent?null:d.mutation_preInsert(n,e._parent,e._nextSibling);default:throw new a.SyntaxError('Invalid \'where\' argument. "beforebegin", "afterbegin", "beforeend" or "afterend" expected')}}},function(e,t,n){"use strict";function i(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i.prototype.toString=function(e){var t=this.name+": ";return t+=this.reason||"(unknown reason)",!e&&this.mark&&(t+=" "+this.mark.toString()),t},e.exports=i},function(e,t,n){"use strict";var i=n(39);e.exports=new i({include:[n(181)],implicit:[n(293),n(294)],explicit:[n(295),n(296),n(297),n(298)]})},function(e,t,n){var i=n(16),r=n(79),o=n(40),a=n(24),s=n(56),l=n(14),c=n(115),u=Object.getOwnPropertyDescriptor;t.f=i?u:function(e,t){if(e=a(e),t=s(t,!0),c)try{return u(e,t)}catch(e){}if(l(e,t))return o(!r.f.call(e,t),e[t])}},function(e,t,n){var i=n(13);e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var i=n(81),r=n(58),o=i("keys");e.exports=function(e){return o[e]||(o[e]=r(e))}},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+i).toString(36)}},function(e,t,n){var i=n(42);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,n){var i,r=n(18),o=n(188),a=n(84),s=n(45),l=n(189),c=n(116),u=n(57)("IE_PROTO"),d=function(){},h=function(e){return"<script>"+e+"<\/script>"},p=function(){try{i=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;p=i?function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t}(i):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F);for(var n=a.length;n--;)delete p.prototype[a[n]];return p()};s[u]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(d.prototype=r(e),n=new d,d.prototype=null,n[u]=e):n=p(),void 0===t?n:o(n,t)}},function(e,t,n){var i=n(121),r=n(84);e.exports=Object.keys||function(e){return i(e,r)}},function(e,t,n){var i=n(15).f,r=n(14),o=n(5)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,o)&&i(e,o,{configurable:!0,value:t})}},function(e,t,n){var i=n(8),r=n(5),o=n(129),a=r("species");e.exports=function(e){return o>=51||!i(function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},function(e,t,n){"use strict";var i=n(4),r=n(122).indexOf,o=n(48),a=n(28),s=[].indexOf,l=!!s&&1/[1].indexOf(1,-0)<0,c=o("indexOf"),u=a("indexOf",{ACCESSORS:!0,1:0});i({target:"Array",proto:!0,forced:l||!c||!u},{indexOf:function(e){return l?s.apply(this,arguments)||0:r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var i=n(16),r=n(15).f,o=Function.prototype,a=o.toString,s=/^\s*function ([^ (]*)/;i&&!("name"in o)&&r(o,"name",{configurable:!0,get:function(){try{return a.call(this).match(s)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var i=n(25),r=n(18),o=n(8),a=n(136),s=RegExp.prototype,l=s.toString,c=o(function(){return"/a/b"!=l.call({source:"a",flags:"b"})}),u="toString"!=l.name;(c||u)&&i(RegExp.prototype,"toString",function(){var e=r(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in s)?a.call(e):n)},{unsafe:!0})},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(138),n(20),n(66),n(22),n(23);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(2),l=function(e){function t(t,n){var i=e.call(this,t)||this;return i._writerOptions=a.applyDefaults(n,{format:"object",wellFormed:!1,group:!1,verbose:!1}),i}return r(t,e),t.prototype.serialize=function(e){return this._currentList=[],this._currentIndex=0,this._listRegister=[this._currentList],this.serializeNode(e,this._writerOptions.wellFormed),this._process(this._currentList,this._writerOptions)},t.prototype._process=function(e,t){var n,i,r,o,l,c,u;if(0===e.length)return{};for(var d={},h=!1,p=0,f=0,m=0,g=0,v=0;v<e.length;v++){var y=e[v];switch(k=Object.keys(y)[0]){case"@":continue;case"#":p++;break;case"!":f++;break;case"?":m++;break;case"$":g++;break;default:d[k]?h=!0:d[k]=!0}}var _=this._getAttrKey(),w=this._getNodeKey(s.NodeType.Text),E=this._getNodeKey(s.NodeType.Comment),b=this._getNodeKey(s.NodeType.ProcessingInstruction),x=this._getNodeKey(s.NodeType.CData);if(1===p&&1===e.length&&a.isString(e[0]["#"]))return e[0]["#"];if(h){var C={};for(v=0;v<e.length;v++)if(y=e[v],"@"===(k=Object.keys(y)[0])){var I=y["@"];1===(R=Object.keys(I)).length?C[_+R[0]]=I[R[0]]:C[_]=y["@"]}var S=[];for(v=0;v<e.length;v++)switch(y=e[v],k=Object.keys(y)[0]){case"@":break;case"#":S.push(((n={})[w]=y["#"],n));break;case"!":S.push(((i={})[E]=y["!"],i));break;case"?":S.push(((r={})[b]=y["?"],r));break;case"$":S.push(((o={})[x]=y.$,o));break;default:if(0!==(F=y)[k].length&&a.isArray(F[k][0])){for(var D=[],A=F[k],T=0;T<A.length;T++)D.push(this._process(A[T],t));S.push(((l={})[k]=D,l))}else t.verbose?S.push(((c={})[k]=[this._process(F[k],t)],c)):S.push(((u={})[k]=this._process(F[k],t),u))}return C[w]=S,C}var N=1,O=1,P=1,M=1;for(C={},v=0;v<e.length;v++){var k;switch(y=e[v],k=Object.keys(y)[0]){case"@":I=y["@"];var R=Object.keys(I);if(t.group&&1!==R.length)C[_]=I;else for(var L in I)C[_+L]=I[L];break;case"#":N=this._processSpecItem(y["#"],C,t.group,w,p,N);break;case"!":O=this._processSpecItem(y["!"],C,t.group,E,f,O);break;case"?":P=this._processSpecItem(y["?"],C,t.group,b,m,P);break;case"$":M=this._processSpecItem(y.$,C,t.group,x,g,M);break;default:var F;if(0!==(F=y)[k].length&&a.isArray(F[k][0])){D=[],A=F[k];for(var U=0;U<A.length;U++)D.push(this._process(A[U],t));C[k]=D}else t.verbose?C[k]=[this._process(F[k],t)]:C[k]=this._process(F[k],t)}}return C},t.prototype._processSpecItem=function(e,t,n,i,r,s){var l,c;if(!n&&a.isArray(e)&&r+e.length>2)try{for(var u=o(e),d=u.next();!d.done;d=u.next()){var h=d.value;t[i+(s++).toString()]=h}}catch(e){l={error:e}}finally{try{d&&!d.done&&(c=u.return)&&c.call(u)}finally{if(l)throw l.error}}else t[r>1?i+(s++).toString():i]=e;return s},t.prototype.beginElement=function(e){var t,n,i=[];if(0===this._currentList.length)this._currentList.push(((t={})[e]=i,t));else{var r=this._currentList[this._currentList.length-1];this._isElementNode(r,e)?0!==r[e].length&&a.isArray(r[e][0])?r[e].push(i):r[e]=[r[e],i]:this._currentList.push(((n={})[e]=i,n))}this._currentIndex++,this._listRegister.length>this._currentIndex?this._listRegister[this._currentIndex]=i:this._listRegister.push(i),this._currentList=i},t.prototype.endElement=function(){this._currentList=this._listRegister[--this._currentIndex]},t.prototype.attribute=function(e,t){var n,i;if(0===this._currentList.length)this._currentList.push({"@":(n={},n[e]=t,n)});else{var r=this._currentList[this._currentList.length-1];this._isAttrNode(r)?r["@"][e]=t:this._currentList.push({"@":(i={},i[e]=t,i)})}},t.prototype.comment=function(e){if(0===this._currentList.length)this._currentList.push({"!":e});else{var t=this._currentList[this._currentList.length-1];this._isCommentNode(t)?a.isArray(t["!"])?t["!"].push(e):t["!"]=[t["!"],e]:this._currentList.push({"!":e})}},t.prototype.text=function(e){if(0===this._currentList.length)this._currentList.push({"#":e});else{var t=this._currentList[this._currentList.length-1];this._isTextNode(t)?a.isArray(t["#"])?t["#"].push(e):t["#"]=[t["#"],e]:this._currentList.push({"#":e})}},t.prototype.instruction=function(e,t){var n=""===t?e:e+" "+t;if(0===this._currentList.length)this._currentList.push({"?":n});else{var i=this._currentList[this._currentList.length-1];this._isInstructionNode(i)?a.isArray(i["?"])?i["?"].push(n):i["?"]=[i["?"],n]:this._currentList.push({"?":n})}},t.prototype.cdata=function(e){if(0===this._currentList.length)this._currentList.push({$:e});else{var t=this._currentList[this._currentList.length-1];this._isCDATANode(t)?a.isArray(t.$)?t.$.push(e):t.$=[t.$,e]:this._currentList.push({$:e})}},t.prototype._isAttrNode=function(e){return"@"in e},t.prototype._isTextNode=function(e){return"#"in e},t.prototype._isCommentNode=function(e){return"!"in e},t.prototype._isInstructionNode=function(e){return"?"in e},t.prototype._isCDATANode=function(e){return"$"in e},t.prototype._isElementNode=function(e,t){return t in e},t.prototype._getAttrKey=function(){return this._builderOptions.convert.att},t.prototype._getNodeKey=function(e){switch(e){case s.NodeType.Comment:return this._builderOptions.convert.comment;case s.NodeType.Text:return this._builderOptions.convert.text;case s.NodeType.ProcessingInstruction:return this._builderOptions.convert.ins;case s.NodeType.CData:return this._builderOptions.convert.cdata;default:throw new Error("Invalid node type.")}},t}(n(50).BaseWriter);t.ObjectWriter=l},function(e,t,n){"use strict";var i=n(4),r=n(93);i({target:"RegExp",proto:!0,forced:/./.exec!==r},{exec:r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._items={},this._nullItems={}}return e.prototype.set=function(e,t){null===e?this._nullItems[t]=!0:(this._items[e]||(this._items[e]={}),this._items[e][t]=!0)},e.prototype.has=function(e,t){return null===e?!0===this._nullItems[t]:!!this._items[e]&&!0===this._items[e][t]},e}();t.LocalNameSet=i},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=n(3),a=n(0),s=function(){function e(){}return Object.defineProperty(e.prototype,"_eventListenerList",{get:function(){return this.__eventListenerList||(this.__eventListenerList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_eventHandlerMap",{get:function(){return this.__eventHandlerMap||(this.__eventHandlerMap={})},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t,n){void 0===n&&(n={passive:!1,once:!1,capture:!1});var r,s=i(a.eventTarget_flattenMore(n),3),l=s[0],c=s[1],u=s[2];t&&(r=o.Guard.isEventListener(t)?t:{handleEvent:t},a.eventTarget_addEventListener(this,{type:e,callback:r,capture:l,passive:c,once:u,removed:!1}))},e.prototype.removeEventListener=function(e,t,n){void 0===n&&(n={capture:!1});var i=a.eventTarget_flatten(n);if(t)for(var r=0;r<this._eventListenerList.length;r++){var s=this._eventListenerList[r];if(s.type===e&&s.capture===i){if(o.Guard.isEventListener(t)&&s.callback===t){a.eventTarget_removeEventListener(this,s,r);break}if(t&&s.callback.handleEvent===t){a.eventTarget_removeEventListener(this,s,r);break}}}},e.prototype.dispatchEvent=function(e){if(e._dispatchFlag||!e._initializedFlag)throw new r.InvalidStateError;return e._isTrusted=!1,a.event_dispatch(e,this)},e.prototype._getTheParent=function(e){return null},e}();t.EventTargetImpl=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(34),a=n(0),s=function(e){function t(t){var n=e.call(this)||this;return n._data=t,n}return r(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){a.characterData_replaceData(this,0,this._data.length,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),t.prototype.substringData=function(e,t){return a.characterData_substringData(this,e,t)},t.prototype.appendData=function(e){return a.characterData_replaceData(this,this._data.length,0,e)},t.prototype.insertData=function(e,t){a.characterData_replaceData(this,e,0,t)},t.prototype.deleteData=function(e,t){a.characterData_replaceData(this,e,t,"")},t.prototype.replaceData=function(e,t,n){a.characterData_replaceData(this,e,t,n)},Object.defineProperty(t.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},t}(o.NodeImpl);t.CharacterDataImpl=s},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(3),l=n(1),c=n(17),u=n(51);function d(e){a.dom.window._signalSlots.add(e),u.observer_queueAMutationObserverMicrotask()}function h(e,t){void 0===t&&(t=!1);var n=s.Cast.asNode(e)._parent;if(null===n)return null;var i=n._shadowRoot||null;if(null===i)return null;if(t&&"open"!==i._mode)return null;for(var r=c.tree_getFirstDescendantNode(i,!1,!0,function(e){return s.Guard.isSlot(e)});null!==r;){if(r._name===e._name)return r;r=c.tree_getNextDescendantNode(i,r,!1,!0,function(e){return s.Guard.isSlot(e)})}return null}function p(e){var t,n,r=[],o=c.tree_rootNode(e);if(!s.Guard.isShadowRoot(o))return r;var a=o._host;try{for(var l=i(a._children),u=l.next();!u.done;u=l.next()){var d=u.value;s.Guard.isSlotable(d)&&h(d)===e&&r.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return r}function f(e){var t,n,r=p(e);if(r.length===e._assignedNodes.length){for(var o=!0,a=0;a<r.length;a++)if(r[a]!==e._assignedNodes[a]){o=!1;break}o||d(e)}e._assignedNodes=r;try{for(var s=i(r),l=s.next();!l.done;l=s.next())l.value._assignedSlot=e}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}t.shadowTree_signalASlotChange=d,t.shadowTree_isConnected=function(e){return s.Guard.isDocumentNode(c.tree_rootNode(e,!0))},t.shadowTree_isAssigned=function(e){return null!==e._assignedSlot},t.shadowTree_findASlot=h,t.shadowTree_findSlotables=p,t.shadowTree_findFlattenedSlotables=function e(t){var n,r,a,u,d=[],h=c.tree_rootNode(t);if(!s.Guard.isShadowRoot(h))return d;var f=p(t);if(l.isEmpty(f))try{for(var m=i(t._children),g=m.next();!g.done;g=m.next()){var v=g.value;s.Guard.isSlotable(v)&&f.push(v)}}catch(e){n={error:e}}finally{try{g&&!g.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}try{for(var y=i(f),_=y.next();!_.done;_=y.next()){var w=_.value;if(s.Guard.isSlot(w)&&s.Guard.isShadowRoot(c.tree_rootNode(w))){var E=e(w);d.push.apply(d,o(E))}else d.push(w)}}catch(e){a={error:e}}finally{try{_&&!_.done&&(u=y.return)&&u.call(y)}finally{if(a)throw a.error}}return d},t.shadowTree_assignSlotables=f,t.shadowTree_assignSlotablesForATree=function(e){for(var t=c.tree_getFirstDescendantNode(e,!0,!1,function(e){return s.Guard.isSlot(e)});null!==t;)f(t),t=c.tree_getNextDescendantNode(e,t,!0,!1,function(e){return s.Guard.isSlot(e)})},t.shadowTree_assignASlot=function(e){var t=h(e);null!==t&&f(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=/[a-z]([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*/,r=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]),o=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),a=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),s=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);t.customElement_isValidCustomElementName=function(e){return!!i.test(e)&&!r.has(e)},t.customElement_isValidElementName=function(e){return o.has(e)},t.customElement_isVoidElementName=function(e){return a.has(e)},t.customElement_isValidShadowHostName=function(e){return s.has(e)},t.customElement_enqueueACustomElementUpgradeReaction=function(e,t){},t.customElement_enqueueACustomElementCallbackReaction=function(e,t,n){},t.customElement_upgrade=function(e,t){},t.customElement_tryToUpgrade=function(e){},t.customElement_lookUpACustomElementDefinition=function(e,t,n,i){return null}},function(e,t,n){n(4)({target:"String",proto:!0},{repeat:n(259)})},function(e,t,n){"use strict";n(278),n(68),n(179),n(94),Object.defineProperty(t,"__esModule",{value:!0});var i=n(109),r=function(){function e(e){this._builderOptions=e,e.parser&&Object.assign(this,e.parser)}return e.prototype._docType=function(e,t,n,i){return e.dtd({name:t,pubID:n,sysID:i})},e.prototype._comment=function(e,t){return e.com(t)},e.prototype._text=function(e,t){return e.txt(t)},e.prototype._instruction=function(e,t,n){return e.ins(t,n)},e.prototype._cdata=function(e,t){return e.dat(t)},e.prototype._element=function(e,t,n){return void 0===t?e.ele(n):e.ele(t,n)},e.prototype._attribute=function(e,t,n,i){return void 0===t?e.att(n,i):e.att(t,n,i)},e.prototype._sanitize=function(e){return i.sanitizeInput(e,this._builderOptions.invalidCharReplacement)},e.prototype._decodeText=function(t){return null==t?t:t.replace(/&(quot|amp|apos|lt|gt);/g,function(t,n){return e._entityTable[n]}).replace(/&#(?:x([a-fA-F0-9]+)|([0-9]+));/g,function(e,t,n){return String.fromCodePoint(parseInt(t||n,t?16:10))})},e.prototype._decodeAttributeValue=function(e){return this._decodeText(e)},e.prototype.parse=function(e,t){return this._parse(e,t)},e.prototype.docType=function(e,t,n,i){return this._docType(e,t,n,i)},e.prototype.comment=function(e,t){return this._comment(e,t)},e.prototype.text=function(e,t){return this._text(e,t)},e.prototype.instruction=function(e,t,n){return this._instruction(e,t,n)},e.prototype.cdata=function(e,t){return this._cdata(e,t)},e.prototype.element=function(e,t,n){return this._element(e,t,n)},e.prototype.attribute=function(e,t,n,i){return this._attribute(e,t,n,i)},e.prototype.sanitize=function(e){return this._sanitize(e)},e._entityTable={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},e}();t.BaseReader=r},function(e,t,n){"use strict";var i=n(39);e.exports=i.DEFAULT=new i({include:[n(54)],explicit:[n(299),n(300),n(301)]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(185);t.XMLBuilderImpl=i.XMLBuilderImpl;var r=n(304);t.XMLBuilderCBImpl=r.XMLBuilderCBImpl;var o=n(183);t.builder=o.builder,t.create=o.create,t.fragment=o.fragment,t.convert=o.convert;var a=n(309);t.createCB=a.createCB,t.fragmentCB=a.fragmentCB},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,o=r&&!i.call({1:2},1);t.f=o?function(e){var t=r(this,e);return!!t&&t.enumerable}:i},function(e,t,n){var i=n(11),r=n(21);e.exports=function(e,t){try{r(i,e,t)}catch(n){i[e]=t}return t}},function(e,t,n){var i=n(44),r=n(118);(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:i?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var i=n(121),r=n(84).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,r)}},function(e,t,n){var i=n(47),r=Math.max,o=Math.min;e.exports=function(e,t){var n=i(e);return n<0?r(n+t,0):o(n,t)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var i=n(8);e.exports=!!Object.getOwnPropertySymbols&&!i(function(){return!String(Symbol())})},function(e,t,n){var i=n(127);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";var i=n(4),r=n(195),o=n(132),a=n(133),s=n(62),l=n(21),c=n(25),u=n(5),d=n(44),h=n(49),p=n(131),f=p.IteratorPrototype,m=p.BUGGY_SAFARI_ITERATORS,g=u("iterator"),v=function(){return this};e.exports=function(e,t,n,u,p,y,_){r(n,t,u);var w,E,b,x=function(e){if(e===p&&A)return A;if(!m&&e in S)return S[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},C=t+" Iterator",I=!1,S=e.prototype,D=S[g]||S["@@iterator"]||p&&S[p],A=!m&&D||x(p),T="Array"==t&&S.entries||D;if(T&&(w=o(T.call(new e)),f!==Object.prototype&&w.next&&(d||o(w)===f||(a?a(w,f):"function"!=typeof w[g]&&l(w,g,v)),s(w,C,!0,!0),d&&(h[C]=v))),"values"==p&&D&&"values"!==D.name&&(I=!0,A=function(){return D.call(this)}),d&&!_||S[g]===A||l(S,g,A),h[t]=A,p)if(E={values:x("values"),keys:y?A:x("keys"),entries:x("entries")},_)for(b in E)(m||I||!(b in S))&&c(S,b,E[b]);else i({target:t,proto:!0,forced:m||I},E);return E}},function(e,t,n){"use strict";var i=n(4),r=n(13),o=n(59),a=n(83),s=n(26),l=n(24),c=n(134),u=n(5),d=n(63),h=n(28),p=d("slice"),f=h("slice",{ACCESSORS:!0,0:0,1:2}),m=u("species"),g=[].slice,v=Math.max;i({target:"Array",proto:!0,forced:!p||!f},{slice:function(e,t){var n,i,u,d=l(this),h=s(d.length),p=a(e,h),f=a(void 0===t?h:t,h);if(o(d)&&("function"!=typeof(n=d.constructor)||n!==Array&&!o(n.prototype)?r(n)&&null===(n=n[m])&&(n=void 0):n=void 0,n===Array||void 0===n))return g.call(d,p,f);for(i=new(void 0===n?Array:n)(v(f-p,0)),u=0;p<f;p++,u++)p in d&&c(i,u,d[p]);return i.length=u,i}})},function(e,t,n){var i={};i[n(5)("toStringTag")]="z",e.exports="[object z]"===String(i)},function(e,t,n){"use strict";n(19),n(138),n(20),n(92),n(22),n(23),Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultBuilderOptions={version:"1.0",encoding:void 0,standalone:void 0,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},invalidCharReplacement:void 0,parser:void 0},t.XMLBuilderOptionKeys=new Set(Object.keys(t.DefaultBuilderOptions)),t.DefaultXMLBuilderCBOptions={format:"xml",wellFormed:!1,prettyPrint:!1,indent:"  ",newline:"\n",offset:0,width:0,allowEmptyTags:!1,spaceBeforeSlash:!1,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}}},function(e,t,n){"use strict";var i=n(139),r=n(143);e.exports=i("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},r)},function(e,t,n){"use strict";var i,r,o=n(136),a=n(221),s=RegExp.prototype.exec,l=String.prototype.replace,c=s,u=(i=/a/,r=/b*/g,s.call(i,"a"),s.call(r,"a"),0!==i.lastIndex||0!==r.lastIndex),d=a.UNSUPPORTED_Y||a.BROKEN_CARET,h=void 0!==/()??/.exec("")[1];(u||h||d)&&(c=function(e){var t,n,i,r,a=this,c=d&&a.sticky,p=o.call(a),f=a.source,m=0,g=e;return c&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),g=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(f="(?: "+f+")",g=" "+g,m++),n=new RegExp("^(?:"+f+")",p)),h&&(n=new RegExp("^"+f+"$(?!\\s)",p)),u&&(t=a.lastIndex),i=s.call(c?n:a,g),c?i?(i.input=i.input.slice(m),i[0]=i[0].slice(m),i.index=a.lastIndex,a.lastIndex+=i[0].length):a.lastIndex=0:u&&i&&(a.lastIndex=a.global?i.index+i[0].length:t),h&&i&&i.length>1&&l.call(i[0],n,function(){for(r=1;r<arguments.length-2;r++)void 0===arguments[r]&&(i[r]=void 0)}),i}),e.exports=c},function(e,t,n){"use strict";var i=n(225),r=n(18),o=n(27),a=n(26),s=n(47),l=n(35),c=n(226),u=n(227),d=Math.max,h=Math.min,p=Math.floor,f=/\$([$&'`]|\d\d?|<[^>]*>)/g,m=/\$([$&'`]|\d\d?)/g;i("replace",2,function(e,t,n,i){var g=i.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,v=i.REPLACE_KEEPS_$0,y=g?"$":"$0";return[function(n,i){var r=l(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,r,i):t.call(String(r),n,i)},function(e,i){if(!g&&v||"string"==typeof i&&-1===i.indexOf(y)){var o=n(t,e,this,i);if(o.done)return o.value}var l=r(e),p=String(this),f="function"==typeof i;f||(i=String(i));var m=l.global;if(m){var w=l.unicode;l.lastIndex=0}for(var E=[];;){var b=u(l,p);if(null===b)break;if(E.push(b),!m)break;""===String(b[0])&&(l.lastIndex=c(p,a(l.lastIndex),w))}for(var x,C="",I=0,S=0;S<E.length;S++){b=E[S];for(var D=String(b[0]),A=d(h(s(b.index),p.length),0),T=[],N=1;N<b.length;N++)T.push(void 0===(x=b[N])?x:String(x));var O=b.groups;if(f){var P=[D].concat(T,A,p);void 0!==O&&P.push(O);var M=String(i.apply(void 0,P))}else M=_(D,p,A,T,O,i);A>=I&&(C+=p.slice(I,A)+M,I=A+D.length)}return C+p.slice(I)}];function _(e,n,i,r,a,s){var l=i+e.length,c=r.length,u=m;return void 0!==a&&(a=o(a),u=f),t.call(s,u,function(t,o){var s;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,i);case"'":return n.slice(l);case"<":s=a[o.slice(1,-1)];break;default:var u=+o;if(0===u)return t;if(u>c){var d=p(u/10);return 0===d?t:d<=c?void 0===r[d-1]?o.charAt(1):r[d-1]+o.charAt(1):t}s=r[u-1]}return void 0===s?"":s})}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._items={},this._nullItems=[]}return e.prototype.copy=function(){var t=new e;for(var n in this._items)t._items[n]=this._items[n].slice(0);return t._nullItems=this._nullItems.slice(0),t},e.prototype.get=function(e,t){var n=null===t?this._nullItems:this._items[t]||null;if(null===n)return null;for(var i=null,r=0;r<n.length;r++)if((i=n[r])===e)return i;return i},e.prototype.has=function(e,t){var n=null===t?this._nullItems:this._items[t]||null;return null!==n&&-1!==n.indexOf(e)},e.prototype.hasPrefix=function(e){if(-1!==this._nullItems.indexOf(e))return!0;for(var t in this._items)if(-1!==this._items[t].indexOf(e))return!0;return!1},e.prototype.set=function(e,t){var n=null===t?this._nullItems:this._items[t]||null;null!==t&&null===n?this._items[t]=[e]:n.push(e)},e}();t.NamespacePrefixMap=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Surrogate=/[\uD800-\uDFFF]/,t.ScalarValue=/[\uD800-\uDFFF]/,t.NonCharacter=/[\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]/,t.ASCIICodePoint=/[\u0000-\u007F]/,t.ASCIITabOrNewLine=/[\t\n\r]/,t.ASCIIWhiteSpace=/[\t\n\f\r ]/,t.C0Control=/[\u0000-\u001F]/,t.C0ControlOrSpace=/[\u0000-\u001F ]/,t.Control=/[\u0000-\u001F\u007F-\u009F]/,t.ASCIIDigit=/[0-9]/,t.ASCIIUpperHexDigit=/[0-9A-F]/,t.ASCIILowerHexDigit=/[0-9a-f]/,t.ASCIIHexDigit=/[0-9A-Fa-f]/,t.ASCIIUpperAlpha=/[A-Z]/,t.ASCIILowerAlpha=/[a-z]/,t.ASCIIAlpha=/[A-Za-z]/,t.ASCIIAlphanumeric=/[0-9A-Za-z]/},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(2),l=n(3),c=n(171),u=n(104),d=n(9),h=n(17),p=n(72),f=n(30);function m(e,t){void 0===t&&(t=void 0),void 0===t&&(t=null);var n=g(e,t,new Date,{});return n._isTrusted=!0,n}function g(e,t,n,i){var r=new e("");return r._initializedFlag=!0,r._timeStamp=n.getTime(),Object.assign(r,i),a.dom.features.steps&&f.dom_runEventConstructingSteps(r),r}function v(e,t,n,r){var o,a,c,u;void 0===n&&(n=!1),void 0===r&&(r={value:!1});var d=!1;e._dispatchFlag=!0;var f=t;if(n){var m=t._associatedDocument;l.Guard.isDocumentNode(m)&&(f=m)}var g=null,v=h.tree_retarget(e._relatedTarget,t);if(t!==v||t===e._relatedTarget){var w=[];try{for(var E=i(e._touchTargetList),b=E.next();!b.done;b=E.next()){var x=b.value;w.push(h.tree_retarget(x,t))}}catch(e){o={error:e}}finally{try{b&&!b.done&&(a=E.return)&&a.call(E)}finally{if(o)throw o.error}}y(e,t,f,v,w,!1);var C=l.Guard.isMouseEvent(e)&&"click"===e._type;C&&void 0!==t._activationBehavior&&(g=t);for(var I=l.Guard.isSlotable(t)&&p.shadowTree_isAssigned(t)?t:null,S=!1,D=t._getTheParent(e);null!==D&&l.Guard.isNode(D);){if(null!==I){if(!l.Guard.isSlot(D))throw new Error("Parent node of a slotable should be a slot.");I=null;var A=h.tree_rootNode(D,!0);l.Guard.isShadowRoot(A)&&"closed"===A._mode&&(S=!0)}l.Guard.isSlotable(D)&&p.shadowTree_isAssigned(D)&&(I=D),v=h.tree_retarget(e._relatedTarget,D),w=[];try{for(var T=(c=void 0,i(e._touchTargetList)),N=T.next();!N.done;N=T.next())x=N.value,w.push(h.tree_retarget(x,D))}catch(e){c={error:e}}finally{try{N&&!N.done&&(u=T.return)&&u.call(T)}finally{if(c)throw c.error}}l.Guard.isWindow(D)||l.Guard.isNode(D)&&l.Guard.isNode(t)&&h.tree_isAncestorOf(h.tree_rootNode(t,!0),D,!0,!0)?(C&&e._bubbles&&null===g&&D._activationBehavior&&(g=D),y(e,D,null,v,w,S)):D===v?D=null:(t=D,C&&null===g&&t._activationBehavior&&(g=t),y(e,D,t,v,w,S)),null!==D&&(D=D._getTheParent(e)),S=!1}for(var O=null,P=e._path,M=P.length-1;M>=0;M--)if(null!==(R=P[M]).shadowAdjustedTarget){O=R;break}if(null!==O)if(l.Guard.isNode(O.shadowAdjustedTarget)&&l.Guard.isShadowRoot(h.tree_rootNode(O.shadowAdjustedTarget,!0)))d=!0;else if(l.Guard.isNode(O.relatedTarget)&&l.Guard.isShadowRoot(h.tree_rootNode(O.relatedTarget,!0)))d=!0;else for(var k=0;k<O.touchTargetList.length;k++){var R=O.touchTargetList[k];if(l.Guard.isNode(R)&&l.Guard.isShadowRoot(h.tree_rootNode(R,!0))){d=!0;break}}for(null!==g&&void 0!==g._legacyPreActivationBehavior&&g._legacyPreActivationBehavior(e),M=P.length-1;M>=0;M--)null!==(R=P[M]).shadowAdjustedTarget?e._eventPhase=s.EventPhase.AtTarget:e._eventPhase=s.EventPhase.Capturing,_(R,e,"capturing",r);for(M=0;M<P.length;M++){if(null!==(R=P[M]).shadowAdjustedTarget)e._eventPhase=s.EventPhase.AtTarget;else{if(!e._bubbles)continue;e._eventPhase=s.EventPhase.Bubbling}_(R,e,"bubbling",r)}}return e._eventPhase=s.EventPhase.None,e._currentTarget=null,e._path=[],e._dispatchFlag=!1,e._stopPropagationFlag=!1,e._stopImmediatePropagationFlag=!1,d&&(e._target=null,e._relatedTarget=null,e._touchTargetList=[]),null!==g&&(e._canceledFlag||void 0===g._activationBehavior?void 0!==g._legacyCanceledActivationBehavior&&g._legacyCanceledActivationBehavior(e):g._activationBehavior(e)),!e._canceledFlag}function y(e,t,n,i,r,o){var a=!1;l.Guard.isNode(t)&&l.Guard.isShadowRoot(h.tree_rootNode(t))&&(a=!0);var s=!1;l.Guard.isShadowRoot(t)&&"closed"===t._mode&&(s=!0),e._path.push({invocationTarget:t,invocationTargetInShadowTree:a,shadowAdjustedTarget:n,relatedTarget:i,touchTargetList:r,rootOfClosedTree:s,slotInClosedTree:o})}function _(e,t,n,i){void 0===i&&(i={value:!1});for(var r=t._path,a=-1,s=0;s<r.length;s++)if(r[s]===e){a=s;break}if(-1!==a){var l=r[a];(null!==l.shadowAdjustedTarget||a>0&&null!==(l=r[a-1]).shadowAdjustedTarget)&&(t._target=l.shadowAdjustedTarget)}if(t._relatedTarget=e.relatedTarget,t._touchTargetList=e.touchTargetList,!t._stopPropagationFlag){t._currentTarget=e.invocationTarget;var c=t._currentTarget._eventListenerList,u=new(Array.bind.apply(Array,o([void 0],c)));if(!w(t,u,n,e,i)&&t._isTrusted){var d=t._type;"animationend"===d?t._type="webkitAnimationEnd":"animationiteration"===d?t._type="webkitAnimationIteration":"animationstart"===d?t._type="webkitAnimationStart":"transitionend"===d&&(t._type="webkitTransitionEnd"),w(t,u,n,e,i),t._type=d}}}function w(e,t,n,i,r){void 0===r&&(r={value:!1});for(var o=!1,a=0;a<t.length;a++){var s=t[a];if(!s.removed){if(e._type!==s.type)continue;if(o=!0,"capturing"===n&&!s.capture)continue;if("bubbling"===n&&s.capture)continue;if(s.once&&null!==e._currentTarget){for(var c=e._currentTarget,u=-1,d=0;d<c._eventListenerList.length;d++)if(c._eventListenerList[d]===s){u=d;break}-1!==u&&c._eventListenerList.splice(u,1)}var h=void 0,p=void 0;l.Guard.isWindow(h)&&(p=h._currentEvent,!1===i.invocationTargetInShadowTree&&(h._currentEvent=e)),s.passive&&(e._inPassiveListenerFlag=!0);try{s.callback.handleEvent.call(e._currentTarget,e)}catch(e){r.value=!0}if(s.passive&&(e._inPassiveListenerFlag=!1),l.Guard.isWindow(h)&&(h._currentEvent=p),e._stopImmediatePropagationFlag)return o}}return o}function E(e,t){return null}function b(e,t){return null}function x(e,t){}function C(e,t){}t.event_setTheCanceledFlag=function(e){e._cancelable&&!e._inPassiveListenerFlag&&(e._canceledFlag=!0)},t.event_initialize=function(e,t,n,i){e._initializedFlag=!0,e._stopPropagationFlag=!1,e._stopImmediatePropagationFlag=!1,e._canceledFlag=!1,e._isTrusted=!1,e._target=null,e._type=t,e._bubbles=n,e._cancelable=i},t.event_createAnEvent=m,t.event_innerEventCreationSteps=g,t.event_dispatch=v,t.event_appendToAnEventPath=y,t.event_invoke=_,t.event_innerInvoke=w,t.event_fireAnEvent=function(e,t,n,i,r){void 0===n&&(n=u.EventImpl);var o=m(n);if(o._type=e,i)for(var a in i)o[a]=i[a];return v(o,t,r)},t.event_createLegacyEvent=function(e){var t=null;switch(e.toLowerCase()){case"beforeunloadevent":case"compositionevent":case"devicemotionevent":case"deviceorientationevent":case"dragevent":break;case"customevent":t=c.CustomEventImpl;break;case"event":case"events":t=u.EventImpl}if(null===t)throw new d.NotSupportedError("Event constructor not found for interface "+e+".");var n=new t("");return n._type="",n._timeStamp=(new Date).getTime(),n._isTrusted=!1,n._initializedFlag=!1,n},t.event_getterEventHandlerIDLAttribute=function(e,t){return null},t.event_setterEventHandlerIDLAttribute=function(e,t,n){},t.event_determineTheTargetOfAnEventHandler=E,t.event_getTheCurrentValueOfAnEventHandler=b,t.event_activateAnEventHandler=x,t.event_deactivateAnEventHandler=C},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),l=n(2),c=n(9),u=n(34),d=n(3),h=n(1),p=n(7),f=n(152),m=n(0),g=n(12),v=function(e){function t(){var t=e.call(this)||this;return t._children=new Set,t._encoding={name:"UTF-8",labels:["unicode-1-1-utf-8","utf-8","utf8"]},t._contentType="application/xml",t._URL={scheme:"about",username:"",password:"",host:null,port:null,path:["blank"],query:null,fragment:null,_cannotBeABaseURLFlag:!0,_blobURLEntry:null},t._origin=null,t._type="xml",t._mode="no-quirks",t._documentElement=null,t._hasNamespaces=!1,t._nodeDocumentOverwrite=null,t}return r(t,e),Object.defineProperty(t.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverwrite||this},set:function(e){this._nodeDocumentOverwrite=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this._implementation||(this._implementation=m.create_domImplementation(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"URL",{get:function(){return f.urlSerializer(this._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"documentURI",{get:function(){return this.URL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return"null"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"compatMode",{get:function(){return"quirks"===this._mode?"BackCompat":"CSS1Compat"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"characterSet",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"charset",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputEncoding",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"doctype",{get:function(){var e,t;try{for(var n=o(this._children),i=n.next();!i.done;i=n.next()){var r=i.value;if(d.Guard.isDocumentTypeNode(r))return r}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"documentElement",{get:function(){return this._documentElement},enumerable:!0,configurable:!0}),t.prototype.getElementsByTagName=function(e){return m.node_listOfElementsWithQualifiedName(e,this)},t.prototype.getElementsByTagNameNS=function(e,t){return m.node_listOfElementsWithNamespace(e,t,this)},t.prototype.getElementsByClassName=function(e){return m.node_listOfElementsWithClassNames(e,this)},t.prototype.createElement=function(e,t){if(!m.xml_isName(e))throw new c.InvalidCharacterError;"html"===this._type&&(e=e.toLowerCase());var n=null;void 0!==t&&(n=h.isString(t)?t:t.is);var i="html"===this._type||"application/xhtml+xml"===this._contentType?p.namespace.HTML:null;return m.element_createAnElement(this,e,i,null,n,!0)},t.prototype.createElementNS=function(e,t,n){return m.document_internalCreateElementNS(this,e,t,n)},t.prototype.createDocumentFragment=function(){return m.create_documentFragment(this)},t.prototype.createTextNode=function(e){return m.create_text(this,e)},t.prototype.createCDATASection=function(e){if("html"===this._type)throw new c.NotSupportedError;if(-1!==e.indexOf("]]>"))throw new c.InvalidCharacterError;return m.create_cdataSection(this,e)},t.prototype.createComment=function(e){return m.create_comment(this,e)},t.prototype.createProcessingInstruction=function(e,t){if(!m.xml_isName(e))throw new c.InvalidCharacterError;if(-1!==t.indexOf("?>"))throw new c.InvalidCharacterError;return m.create_processingInstruction(this,e,t)},t.prototype.importNode=function(e,t){if(void 0===t&&(t=!1),d.Guard.isDocumentNode(e)||d.Guard.isShadowRoot(e))throw new c.NotSupportedError;return m.node_clone(e,this,t)},t.prototype.adoptNode=function(e){if(d.Guard.isDocumentNode(e))throw new c.NotSupportedError;if(d.Guard.isShadowRoot(e))throw new c.HierarchyRequestError;return m.document_adopt(e,this),e},t.prototype.createAttribute=function(e){if(!m.xml_isName(e))throw new c.InvalidCharacterError;return"html"===this._type&&(e=e.toLowerCase()),m.create_attr(this,e)},t.prototype.createAttributeNS=function(e,t){var n=a(m.namespace_validateAndExtract(e,t),3),i=n[0],r=n[1],o=n[2],s=m.create_attr(this,o);return s._namespace=i,s._namespacePrefix=r,s},t.prototype.createEvent=function(e){return m.event_createLegacyEvent(e)},t.prototype.createRange=function(){var e=m.create_range();return e._start=[this,0],e._end=[this,0],e},t.prototype.createNodeIterator=function(e,t,n){void 0===t&&(t=l.WhatToShow.All),void 0===n&&(n=null);var i=m.create_nodeIterator(e,e,!0);return i._whatToShow=t,i._iteratorCollection=m.create_nodeList(e),h.isFunction(n)?(i._filter=m.create_nodeFilter(),i._filter.acceptNode=n):i._filter=n,i},t.prototype.createTreeWalker=function(e,t,n){void 0===t&&(t=l.WhatToShow.All),void 0===n&&(n=null);var i=m.create_treeWalker(e,e);return i._whatToShow=t,h.isFunction(n)?(i._filter=m.create_nodeFilter(),i._filter.acceptNode=n):i._filter=n,i},t.prototype._getTheParent=function(e){return"load"===e._type?null:s.dom.window},t.prototype.getElementById=function(e){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelector=function(e){throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelectorAll=function(e){throw new Error("Mixin: ParentNode not implemented.")},t}(u.NodeImpl);t.DocumentImpl=v,g.idl_defineConst(v.prototype,"_nodeType",l.NodeType.Document)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),l=n(34),c=n(9),u=n(7),d=n(0),h=n(12),p=function(e){function t(){var t=e.call(this)||this;return t._children=new Set,t._namespace=null,t._namespacePrefix=null,t._localName="",t._customElementState="undefined",t._customElementDefinition=null,t._is=null,t._shadowRoot=null,t._attributeList=d.create_namedNodeMap(t),t._attributeChangeSteps=[],t._name="",t._assignedSlot=null,t}return r(t,e),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tagName",{get:function(){return this._htmlUppercasedQualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return d.element_getAnAttributeValue(this,"id")},set:function(e){d.element_setAnAttributeValue(this,"id",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return d.element_getAnAttributeValue(this,"class")},set:function(e){d.element_setAnAttributeValue(this,"class",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classList",{get:function(){var e=d.element_getAnAttributeByName("class",this);return null===e&&(e=d.create_attr(this._nodeDocument,"class")),d.create_domTokenList(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slot",{get:function(){return d.element_getAnAttributeValue(this,"slot")},set:function(e){d.element_setAnAttributeValue(this,"slot",e)},enumerable:!0,configurable:!0}),t.prototype.hasAttributes=function(){return 0!==this._attributeList.length},Object.defineProperty(t.prototype,"attributes",{get:function(){return this._attributeList},enumerable:!0,configurable:!0}),t.prototype.getAttributeNames=function(){var e,t,n=[];try{for(var i=o(this._attributeList),r=i.next();!r.done;r=i.next()){var a=r.value;n.push(a._qualifiedName)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},t.prototype.getAttribute=function(e){var t=d.element_getAnAttributeByName(e,this);return t?t._value:null},t.prototype.getAttributeNS=function(e,t){var n=d.element_getAnAttributeByNamespaceAndLocalName(e,t,this);return n?n._value:null},t.prototype.setAttribute=function(e,t){if(!d.xml_isName(e))throw new c.InvalidCharacterError;this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toLowerCase());for(var n=null,i=0;i<this._attributeList.length;i++){var r=this._attributeList[i];if(r._qualifiedName===e){n=r;break}}if(null===n)return(n=d.create_attr(this._nodeDocument,e))._value=t,void d.element_append(n,this);d.element_change(n,this,t)},t.prototype.setAttributeNS=function(e,t,n){var i=a(d.namespace_validateAndExtract(e,t),3),r=i[0],o=i[1],s=i[2];d.element_setAnAttributeValue(this,s,n,o,r)},t.prototype.removeAttribute=function(e){d.element_removeAnAttributeByName(e,this)},t.prototype.removeAttributeNS=function(e,t){d.element_removeAnAttributeByNamespaceAndLocalName(e,t,this)},t.prototype.hasAttribute=function(e){this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toLowerCase());for(var t=0;t<this._attributeList.length;t++)if(this._attributeList[t]._qualifiedName===e)return!0;return!1},t.prototype.toggleAttribute=function(e,t){if(!d.xml_isName(e))throw new c.InvalidCharacterError;this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toLowerCase());for(var n=null,i=0;i<this._attributeList.length;i++){var r=this._attributeList[i];if(r._qualifiedName===e){n=r;break}}return null===n?(void 0===t||!0===t)&&((n=d.create_attr(this._nodeDocument,e))._value="",d.element_append(n,this),!0):void 0!==t&&!1!==t||(d.element_removeAnAttributeByName(e,this),!1)},t.prototype.hasAttributeNS=function(e,t){for(var n=e||null,i=0;i<this._attributeList.length;i++){var r=this._attributeList[i];if(r._namespace===n&&r._localName===t)return!0}return!1},t.prototype.getAttributeNode=function(e){return d.element_getAnAttributeByName(e,this)},t.prototype.getAttributeNodeNS=function(e,t){return d.element_getAnAttributeByNamespaceAndLocalName(e,t,this)},t.prototype.setAttributeNode=function(e){return d.element_setAnAttribute(e,this)},t.prototype.setAttributeNodeNS=function(e){return d.element_setAnAttribute(e,this)},t.prototype.removeAttributeNode=function(e){for(var t=!1,n=0;n<this._attributeList.length;n++)if(this._attributeList[n]===e){t=!0;break}if(!t)throw new c.NotFoundError;return d.element_remove(e,this),e},t.prototype.attachShadow=function(e){if(this._namespace!==u.namespace.HTML)throw new c.NotSupportedError;if(!d.customElement_isValidCustomElementName(this._localName)&&!d.customElement_isValidShadowHostName(this._localName))throw new c.NotSupportedError;if(d.customElement_isValidCustomElementName(this._localName)||null!==this._is){var t=d.customElement_lookUpACustomElementDefinition(this._nodeDocument,this._namespace,this._localName,this._is);if(null!==t&&!0===t.disableShadow)throw new c.NotSupportedError}if(null!==this._shadowRoot)throw new c.NotSupportedError;var n=d.create_shadowRoot(this._nodeDocument,this);return n._mode=e.mode,this._shadowRoot=n,n},Object.defineProperty(t.prototype,"shadowRoot",{get:function(){var e=this._shadowRoot;return null===e||"closed"===e.mode?null:e},enumerable:!0,configurable:!0}),t.prototype.closest=function(e){throw new c.NotImplementedError},t.prototype.matches=function(e){throw new c.NotImplementedError},t.prototype.webkitMatchesSelector=function(e){return this.matches(e)},t.prototype.getElementsByTagName=function(e){return d.node_listOfElementsWithQualifiedName(e,this)},t.prototype.getElementsByTagNameNS=function(e,t){return d.node_listOfElementsWithNamespace(e,t,this)},t.prototype.getElementsByClassName=function(e){return d.node_listOfElementsWithClassNames(e,this)},t.prototype.insertAdjacentElement=function(e,t){return d.element_insertAdjacent(this,e,t)},t.prototype.insertAdjacentText=function(e,t){var n=d.create_text(this._nodeDocument,t);d.element_insertAdjacent(this,e,n)},Object.defineProperty(t.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_htmlUppercasedQualifiedName",{get:function(){var e=this._qualifiedName;return this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toUpperCase()),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelector=function(e){throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelectorAll=function(e){throw new Error("Mixin: ParentNode not implemented.")},Object.defineProperty(t.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},Object.defineProperty(t.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),t._create=function(e,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var o=new t;return o._localName=n,o._namespace=i,o._namespacePrefix=r,o._nodeDocument=e,o},t}(l.NodeImpl);t.ElementImpl=p,h.idl_defineConst(p.prototype,"_nodeType",s.NodeType.Element)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(34),s=n(12),l=function(e){function t(t){void 0===t&&(t=null);var n=e.call(this)||this;return n._children=new Set,n._host=t,n}return r(t,e),t.prototype.getElementById=function(e){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelector=function(e){throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelectorAll=function(e){throw new Error("Mixin: ParentNode not implemented.")},t._create=function(e,n){void 0===n&&(n=null);var i=new t(n);return i._nodeDocument=e,i},t}(a.NodeImpl);t.DocumentFragmentImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.DocumentFragment)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(71),l=n(0),c=n(12),u=function(e){function t(t){void 0===t&&(t="");var n=e.call(this,t)||this;return n._name="",n._assignedSlot=null,n}return r(t,e),Object.defineProperty(t.prototype,"wholeText",{get:function(){var e,t,n="";try{for(var i=o(l.text_contiguousTextNodes(this,!0)),r=i.next();!r.done;r=i.next())n+=r.value._data}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),t.prototype.splitText=function(e){return l.text_split(this,e)},Object.defineProperty(t.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),t._create=function(e,n){void 0===n&&(n="");var i=new t(n);return i._nodeDocument=e,i},t}(s.CharacterDataImpl);t.TextImpl=u,c.idl_defineConst(u.prototype,"_nodeType",a.NodeType.Text)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return Object.defineProperty(e.prototype,"_startNode",{get:function(){return this._start[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_startOffset",{get:function(){return this._start[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_endNode",{get:function(){return this._end[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_endOffset",{get:function(){return this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_collapsed",{get:function(){return this._start[0]===this._end[0]&&this._start[1]===this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startContainer",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endContainer",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endOffset",{get:function(){return this._endOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get:function(){return this._collapsed},enumerable:!0,configurable:!0}),e}();t.AbstractRangeImpl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(e){this._activeFlag=!1,this._root=e,this._whatToShow=i.WhatToShow.All,this._filter=null}return Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"whatToShow",{get:function(){return this._whatToShow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),e}();t.TraverserImpl=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0),o=n(12),a=function(){function e(e,t){this._target=null,this._relatedTarget=null,this._touchTargetList=[],this._path=[],this._currentTarget=null,this._eventPhase=i.EventPhase.None,this._stopPropagationFlag=!1,this._stopImmediatePropagationFlag=!1,this._canceledFlag=!1,this._inPassiveListenerFlag=!1,this._composedFlag=!1,this._initializedFlag=!1,this._dispatchFlag=!1,this._isTrusted=!1,this._bubbles=!1,this._cancelable=!1,this._type=e,t&&(this._bubbles=t.bubbles||!1,this._cancelable=t.cancelable||!1,this._composedFlag=t.composed||!1),this._initializedFlag=!0,this._timeStamp=(new Date).getTime()}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"srcElement",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),e.prototype.composedPath=function(){var e=[],t=this._path;if(0===t.length)return e;var n=this._currentTarget;if(null===n)throw new Error("Event currentTarget is null.");e.push(n);for(var i=0,r=0,o=t.length-1;o>=0;){if(t[o].rootOfClosedTree&&r++,t[o].invocationTarget===n){i=o;break}t[o].slotInClosedTree&&r--,o--}var a=r,s=r;for(o=i-1;o>=0;)t[o].rootOfClosedTree&&a++,a<=s&&e.unshift(t[o].invocationTarget),t[o].slotInClosedTree&&--a<s&&(s=a),o--;for(a=r,s=r,o=i+1;o<t.length;)t[o].slotInClosedTree&&a++,a<=s&&e.push(t[o].invocationTarget),t[o].rootOfClosedTree&&--a<s&&(s=a),o++;return e},Object.defineProperty(e.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this._stopPropagationFlag=!0},Object.defineProperty(e.prototype,"cancelBubble",{get:function(){return this._stopPropagationFlag},set:function(e){e&&this.stopPropagation()},enumerable:!0,configurable:!0}),e.prototype.stopImmediatePropagation=function(){this._stopPropagationFlag=!0,this._stopImmediatePropagationFlag=!0},Object.defineProperty(e.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"returnValue",{get:function(){return!this._canceledFlag},set:function(e){e||r.event_setTheCanceledFlag(this)},enumerable:!0,configurable:!0}),e.prototype.preventDefault=function(){r.event_setTheCanceledFlag(this)},Object.defineProperty(e.prototype,"defaultPrevented",{get:function(){return this._canceledFlag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"composed",{get:function(){return this._composedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTrusted",{get:function(){return this._isTrusted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),e.prototype.initEvent=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),this._dispatchFlag||r.event_initialize(this,e,t,n)},e.NONE=0,e.CAPTURING_PHASE=1,e.AT_TARGET=2,e.BUBBLING_PHASE=3,e}();t.EventImpl=a,o.idl_defineConst(a.prototype,"NONE",0),o.idl_defineConst(a.prototype,"CAPTURING_PHASE",1),o.idl_defineConst(a.prototype,"AT_TARGET",2),o.idl_defineConst(a.prototype,"BUBBLING_PHASE",3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(9);t.traversal_filter=function(e,t){if(e._activeFlag)throw new r.InvalidStateError;var n=1<<t._nodeType-1;if(0==(e.whatToShow&n))return i.FilterResult.Skip;if(!e.filter)return i.FilterResult.Accept;e._activeFlag=!0;var o=i.FilterResult.Reject;try{o=e.filter.acceptNode(t)}catch(t){throw e._activeFlag=!1,t}return e._activeFlag=!1,o}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(3),s=n(1),l=n(99),c=n(73),u=n(17),d=n(173),h=n(30),p=n(52),f=n(37);t.document_elementInterface=function(e,t){return l.ElementImpl},t.document_internalCreateElementNS=function(e,t,n,r){var o=i(d.namespace_validateAndExtract(t,n),3),a=o[0],l=o[1],c=o[2],u=null;return void 0!==r&&(u=s.isString(r)?r:r.is),p.element_createAnElement(e,c,a,l,u,!0)},t.document_adopt=function(e,t){var n,i;if(e._nodeDocument!==t||null!==e._parent){var s=e._nodeDocument;if(e._parent&&f.mutation_remove(e,e._parent),t!==s)for(var l=u.tree_getFirstDescendantNode(e,!0,!0);null!==l;){if(l._nodeDocument=t,a.Guard.isElementNode(l))try{for(var d=(n=void 0,r(l._attributeList._asArray())),p=d.next();!p.done;p=d.next())p.value._nodeDocument=t}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}o.dom.features.customElements&&a.Guard.isElementNode(l)&&"custom"===l._customElementState&&c.customElement_enqueueACustomElementCallbackReaction(l,"adoptedCallback",[s,t]),o.dom.features.steps&&h.dom_runAdoptingSteps(l,s),l=u.tree_getNextDescendantNode(e,l,!0,!0)}}}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(3),a=n(9),s=n(17),l=n(51),c=n(30);t.characterData_replaceData=function(e,t,n,u){var d,h,p=s.tree_nodeLength(e);if(t>p)throw new a.IndexSizeError("Offset exceeds character data length. Offset: "+t+", Length: "+p+", Node is "+e.nodeName+".");t+n>p&&(n=p-t),r.dom.features.mutationObservers&&l.observer_queueMutationRecord("characterData",e,null,null,e._data,[],[],null,null);var f=e._data.substring(0,t)+u+e._data.substring(t+n);e._data=f;try{for(var m=i(r.dom.rangeList),g=m.next();!g.done;g=m.next()){var v=g.value;v._start[0]===e&&v._start[1]>t&&v._start[1]<=t+n&&(v._start[1]=t),v._end[0]===e&&v._end[1]>t&&v._end[1]<=t+n&&(v._end[1]=t),v._start[0]===e&&v._start[1]>t+n&&(v._start[1]+=u.length-n),v._end[0]===e&&v._end[1]>t+n&&(v._end[1]+=u.length-n)}}catch(e){d={error:e}}finally{try{g&&!g.done&&(h=m.return)&&h.call(m)}finally{if(d)throw d.error}}r.dom.features.steps&&o.Guard.isTextNode(e)&&null!==e._parent&&c.dom_runChildTextContentChangeSteps(e._parent)},t.characterData_substringData=function(e,t,n){var i=s.tree_nodeLength(e);if(t>i)throw new a.IndexSizeError("Offset exceeds character data length. Offset: "+t+", Length: "+i+", Node is "+e.nodeName+".");return t+n>i?e._data.substr(t):e._data.substr(t,n)}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(7);function s(e){var t=a.string.splitAStringOnASCIIWhitespace(e);return new Set(t)}function l(e){return r(e).join(" ")}t.orderedSet_parse=s,t.orderedSet_serialize=l,t.orderedSet_sanitize=function(e){return l(s(e))},t.orderedSet_contains=function(e,t,n){var i,r,a,s;try{for(var l=o(t),c=l.next();!c.done;c=l.next()){var u=c.value,d=!1;try{for(var h=(a=void 0,o(e)),p=h.next();!p.done;p=h.next()){var f=p.value;if(n){if(f===u){d=!0;break}}else if(f.toUpperCase()===u.toUpperCase()){d=!0;break}}}catch(e){a={error:e}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}if(!d)return!1}}catch(e){i={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(i)throw i.error}}return!0}},function(e,t,n){"use strict";n(179),Object.defineProperty(t,"__esModule",{value:!0});var i=n(262),r=n(110),o=n(1);r.dom.setFeatures(!1),t.createDocument=function(){var e=(new i.DOMImplementation).createDocument(null,"root",null);return e.documentElement&&e.removeChild(e.documentElement),e},t.sanitizeInput=function(e,t){if(null==e)return e;if(void 0===t)return e+"";var n="";e+="";for(var i=0;i<e.length;i++){var r=e.charCodeAt(i);if(9===r||10===r||13===r||r>=32&&r<=55295||r>=57344&&r<=65533)n+=e.charAt(i);else if(r>=55296&&r<=56319&&i<e.length-1){var a=e.charCodeAt(i+1);a>=56320&&a<=57343?(r=1024*(r-55296)+a-56320+65536,n+=String.fromCodePoint(r),i++):n+=o.isString(t)?t:t(e.charAt(i),i,e)}else n+=o.isString(t)?t:t(e.charAt(i),i,e)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(153);t.AbortController=r.AbortControllerImpl;var o=n(154);t.AbortSignal=o.AbortSignalImpl;var a=n(102);t.AbstractRange=a.AbstractRangeImpl;var s=n(157);t.Attr=s.AttrImpl;var l=n(158);t.CDATASection=l.CDATASectionImpl;var c=n(71);t.CharacterData=c.CharacterDataImpl;var u=n(263),d=n(159);t.Comment=d.CommentImpl;var h=n(171);t.CustomEvent=h.CustomEventImpl;var p=n(100);t.DocumentFragment=p.DocumentFragmentImpl;var f=n(98);t.Document=f.DocumentImpl;var m=n(264),g=n(155);t.DocumentType=g.DocumentTypeImpl;var v=n(6);t.dom=v.dom;var y=n(148);t.DOMImplementation=y.DOMImplementationImpl;var _=n(170);t.DOMTokenList=_.DOMTokenListImpl;var w=n(99);t.Element=w.ElementImpl;var E=n(104);t.Event=E.EventImpl;var b=n(70);t.EventTarget=b.EventTargetImpl;var x=n(161);t.HTMLCollection=x.HTMLCollectionImpl;var C=n(265);t.MutationObserver=C.MutationObserverImpl;var I=n(169);t.MutationRecord=I.MutationRecordImpl;var S=n(164);t.NamedNodeMap=S.NamedNodeMapImpl;var D=n(168);t.NodeFilter=D.NodeFilterImpl;var A=n(34);t.Node=A.NodeImpl;var T=n(166);t.NodeIterator=T.NodeIteratorImpl;var N=n(162);t.NodeList=N.NodeListImpl;var O=n(163);t.NodeListStatic=O.NodeListStaticImpl;var P=n(266),M=n(267),k=n(268),R=n(160);t.ProcessingInstruction=R.ProcessingInstructionImpl;var L=n(165);t.Range=L.RangeImpl;var F=n(156);t.ShadowRoot=F.ShadowRootImpl;var U=n(269),B=n(270);t.StaticRange=B.StaticRangeImpl;var V=n(101);t.Text=V.TextImpl;var W=n(103);t.Traverser=W.TraverserImpl;var j=n(167);t.TreeWalker=j.TreeWalkerImpl;var H=n(149);t.Window=H.WindowImpl;var z=n(151);t.XMLDocument=z.XMLDocumentImpl,i.applyMixin(w.ElementImpl,u.ChildNodeImpl),i.applyMixin(c.CharacterDataImpl,u.ChildNodeImpl),i.applyMixin(g.DocumentTypeImpl,u.ChildNodeImpl),i.applyMixin(f.DocumentImpl,m.DocumentOrShadowRootImpl),i.applyMixin(F.ShadowRootImpl,m.DocumentOrShadowRootImpl),i.applyMixin(w.ElementImpl,P.NonDocumentTypeChildNodeImpl),i.applyMixin(c.CharacterDataImpl,P.NonDocumentTypeChildNodeImpl),i.applyMixin(f.DocumentImpl,M.NonElementParentNodeImpl),i.applyMixin(p.DocumentFragmentImpl,M.NonElementParentNodeImpl),i.applyMixin(f.DocumentImpl,k.ParentNodeImpl),i.applyMixin(p.DocumentFragmentImpl,k.ParentNodeImpl),i.applyMixin(w.ElementImpl,k.ParentNodeImpl),i.applyMixin(V.TextImpl,U.SlotableImpl),i.applyMixin(w.ElementImpl,U.SlotableImpl)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.EOF=0]="EOF",e[e.Declaration=1]="Declaration",e[e.DocType=2]="DocType",e[e.Element=3]="Element",e[e.Text=4]="Text",e[e.CDATA=5]="CDATA",e[e.PI=6]="PI",e[e.Comment=7]="Comment",e[e.ClosingTag=8]="ClosingTag"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";n(64),n(20),n(66);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._parse=function(e,t){var n=this,i=this._builderOptions,r=null;return o.isFunction(t)?r=this.parse(e,t.apply(this)):o.isArray(t)||o.isSet(t)?o.forEachArray(t,function(t){return r=n.parse(e,t)},this):o.isMap(t)||o.isObject(t)?o.forEachObject(t,function(t,a){if(o.isFunction(a)&&(a=a.apply(n)),i.ignoreConverters||0!==t.indexOf(i.convert.att))if(i.ignoreConverters||0!==t.indexOf(i.convert.text))if(i.ignoreConverters||0!==t.indexOf(i.convert.cdata))if(i.ignoreConverters||0!==t.indexOf(i.convert.comment))if(i.ignoreConverters||0!==t.indexOf(i.convert.ins)){if((o.isArray(a)||o.isSet(a))&&o.isEmpty(a));else if((o.isMap(a)||o.isObject(a))&&o.isEmpty(a))r=n.element(e,void 0,n.sanitize(t))||r;else if(i.keepNullNodes||null!=a)if(o.isArray(a)||o.isSet(a))o.forEachArray(a,function(i){var o={};o[t]=i,r=n.parse(e,o)},n);else if(o.isMap(a)||o.isObject(a))(s=n.element(e,void 0,n.sanitize(t)))&&(r=s,n.parse(s,a));else if(null!=a&&""!==a){var s;(s=n.element(e,void 0,n.sanitize(t)))&&(r=s,n.text(s,n._decodeText(n.sanitize(a))))}else r=n.element(e,void 0,n.sanitize(t))||r}else if(o.isString(a)){var l=a.indexOf(" "),c=-1===l?a:a.substr(0,l),u=-1===l?"":a.substr(l+1);r=n.instruction(e,n.sanitize(c),n.sanitize(u))||r}else o.isArray(a)||o.isSet(a)?o.forEachArray(a,function(t){var i=t.indexOf(" "),o=-1===i?t:t.substr(0,i),a=-1===i?"":t.substr(i+1);r=n.instruction(e,n.sanitize(o),n.sanitize(a))||r},n):o.forEachObject(a,function(t,i){return r=n.instruction(e,n.sanitize(t),n.sanitize(i))||r},n);else o.isArray(a)||o.isSet(a)?o.forEachArray(a,function(t){return r=n.comment(e,n.sanitize(t))||r},n):r=n.comment(e,n.sanitize(a))||r;else o.isArray(a)||o.isSet(a)?o.forEachArray(a,function(t){return r=n.cdata(e,n.sanitize(t))||r},n):r=n.cdata(e,n.sanitize(a))||r;else r=o.isMap(a)||o.isObject(a)?n.parse(e,a):n.text(e,n._decodeText(n.sanitize(a)))||r;else if(t===i.convert.att){if(o.isArray(a)||o.isSet(a))throw new Error("Invalid attribute: "+a.toString()+". "+e._debugInfo());o.forEachObject(a,function(t,i){r=n.attribute(e,void 0,n.sanitize(t),n._decodeAttributeValue(n.sanitize(i)))||r})}else r=n.attribute(e,void 0,n.sanitize(t.substr(i.convert.att.length)),n._decodeAttributeValue(n.sanitize(a)))||r},this):(i.keepNullNodes||null!=t)&&(r=this.text(e,this._decodeText(this.sanitize(t)))||r),r||e},t}(n(75).BaseReader);t.ObjectReader=a},function(e,t,n){"use strict";var i=n(39);e.exports=new i({explicit:[n(286),n(287),n(288)]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){this.level=0,this._builderOptions=e,this._writerOptions=e};t.BaseCBWriter=i},function(e,t,n){var i=n(16),r=n(8),o=n(116);e.exports=!i&&!r(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(11),r=n(13),o=i.document,a=r(o)&&r(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,n){var i=n(118),r=Function.toString;"function"!=typeof i.inspectSource&&(i.inspectSource=function(e){return r.call(e)}),e.exports=i.inspectSource},function(e,t,n){var i=n(11),r=n(80),o=i["__core-js_shared__"]||r("__core-js_shared__",{});e.exports=o},function(e,t,n){var i=n(14),r=n(187),o=n(55),a=n(15);e.exports=function(e,t){for(var n=r(t),s=a.f,l=o.f,c=0;c<n.length;c++){var u=n[c];i(e,u)||s(e,u,l(t,u))}}},function(e,t,n){var i=n(11);e.exports=i},function(e,t,n){var i=n(14),r=n(24),o=n(122).indexOf,a=n(45);e.exports=function(e,t){var n,s=r(e),l=0,c=[];for(n in s)!i(a,n)&&i(s,n)&&c.push(n);for(;t.length>l;)i(s,n=t[l++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){var i=n(24),r=n(26),o=n(83),a=function(e){return function(t,n,a){var s,l=i(t),c=r(l.length),u=o(a,c);if(e&&n!=n){for(;c>u;)if((s=l[u++])!=s)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,n){var i=n(8),r=/#|\.prototype\./,o=function(e,t){var n=s[a(e)];return n==c||n!=l&&("function"==typeof t?i(t):!!t)},a=o.normalize=function(e){return String(e).replace(r,".").toLowerCase()},s=o.data={},l=o.NATIVE="N",c=o.POLYFILL="P";e.exports=o},function(e,t,n){var i=n(86);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var i=n(5);t.f=i},function(e,t,n){var i=n(120),r=n(14),o=n(125),a=n(15).f;e.exports=function(e){var t=i.Symbol||(i.Symbol={});r(t,e)||a(t,e,{value:o.f(e)})}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,n){var i=n(13),r=n(59),o=n(5)("species");e.exports=function(e,t){var n;return r(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!r(n.prototype)?i(n)&&null===(n=n[o])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},function(e,t,n){var i,r,o=n(11),a=n(193),s=o.process,l=s&&s.versions,c=l&&l.v8;c?r=(i=c.split("."))[0]+i[1]:a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(r=i[1]),e.exports=r&&+r},function(e,t,n){var i=n(5),r=n(60),o=n(15),a=i("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:r(null)}),e.exports=function(e){s[a][e]=!0}},function(e,t,n){"use strict";var i,r,o,a=n(132),s=n(21),l=n(14),c=n(5),u=n(44),d=c("iterator"),h=!1;[].keys&&("next"in(o=[].keys())?(r=a(a(o)))!==Object.prototype&&(i=r):h=!0),null==i&&(i={}),u||l(i,d)||s(i,d,function(){return this}),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:h}},function(e,t,n){var i=n(14),r=n(27),o=n(57),a=n(196),s=o("IE_PROTO"),l=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=r(e),i(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?l:null}},function(e,t,n){var i=n(18),r=n(197);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,o){return i(n),r(o),t?e.call(n,o):n.__proto__=o,n}}():void 0)},function(e,t,n){"use strict";var i=n(56),r=n(15),o=n(40);e.exports=function(e,t,n){var a=i(t);a in e?r.f(e,a,o(0,n)):e[a]=n}},function(e,t,n){var i=n(90),r=n(42),o=n(5)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=i?r:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:a?r(t):"Object"==(i=r(t))&&"function"==typeof t.callee?"Arguments":i}},function(e,t,n){"use strict";var i=n(18);e.exports=function(){var e=i(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var i=n(47),r=n(35),o=function(e){return function(t,n){var o,a,s=String(r(t)),l=i(n),c=s.length;return l<0||l>=c?e?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===c||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):o:e?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,n){var i=n(4),r=n(27),o=n(61);i({target:"Object",stat:!0,forced:n(8)(function(){o(1)})},{keys:function(e){return o(r(e))}})},function(e,t,n){"use strict";var i=n(4),r=n(11),o=n(123),a=n(25),s=n(140),l=n(141),c=n(142),u=n(13),d=n(8),h=n(208),p=n(62),f=n(209);e.exports=function(e,t,n){var m=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),v=m?"set":"add",y=r[e],_=y&&y.prototype,w=y,E={},b=function(e){var t=_[e];a(_,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!u(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(o(e,"function"!=typeof y||!(g||_.forEach&&!d(function(){(new y).entries().next()}))))w=n.getConstructor(t,e,m,v),s.REQUIRED=!0;else if(o(e,!0)){var x=new w,C=x[v](g?{}:-0,1)!=x,I=d(function(){x.has(1)}),S=h(function(e){new y(e)}),D=!g&&d(function(){for(var e=new y,t=5;t--;)e[v](t,t);return!e.has(-0)});S||((w=t(function(t,n){c(t,w,e);var i=f(new y,t,w);return null!=n&&l(n,i[v],i,m),i})).prototype=_,_.constructor=w),(I||D)&&(b("delete"),b("has"),m&&b("get")),(D||C)&&b(v),g&&_.clear&&delete _.clear}return E[e]=w,i({global:!0,forced:w!=y},E),p(w,e),g||n.setStrong(w,e,m),w}},function(e,t,n){var i=n(45),r=n(13),o=n(14),a=n(15).f,s=n(58),l=n(204),c=s("meta"),u=0,d=Object.isExtensible||function(){return!0},h=function(e){a(e,c,{value:{objectID:"O"+ ++u,weakData:{}}})},p=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,c)){if(!d(e))return"F";if(!t)return"E";h(e)}return e[c].objectID},getWeakData:function(e,t){if(!o(e,c)){if(!d(e))return!0;if(!t)return!1;h(e)}return e[c].weakData},onFreeze:function(e){return l&&p.REQUIRED&&d(e)&&!o(e,c)&&h(e),e}};i[c]=!0},function(e,t,n){var i=n(18),r=n(205),o=n(26),a=n(87),s=n(206),l=n(207),c=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,t,n,u,d){var h,p,f,m,g,v,y,_=a(t,n,u?2:1);if(d)h=e;else{if("function"!=typeof(p=s(e)))throw TypeError("Target is not iterable");if(r(p)){for(f=0,m=o(e.length);m>f;f++)if((g=u?_(i(y=e[f])[0],y[1]):_(e[f]))&&g instanceof c)return g;return new c(!1)}h=p.call(e)}for(v=h.next;!(y=v.call(h)).done;)if("object"==typeof(g=l(h,_,y.value,u))&&g&&g instanceof c)return g;return new c(!1)}).stop=function(e){return new c(!0,e)}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){"use strict";var i=n(15).f,r=n(60),o=n(210),a=n(87),s=n(142),l=n(141),c=n(88),u=n(211),d=n(16),h=n(140).fastKey,p=n(43),f=p.set,m=p.getterFor;e.exports={getConstructor:function(e,t,n,c){var u=e(function(e,i){s(e,u,t),f(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=i&&l(i,e[c],e,n)}),p=m(t),g=function(e,t,n){var i,r,o=p(e),a=v(e,t);return a?a.value=n:(o.last=a={index:r=h(t,!0),key:t,value:n,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=a),i&&(i.next=a),d?o.size++:e.size++,"F"!==r&&(o.index[r]=a)),e},v=function(e,t){var n,i=p(e),r=h(t);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key==t)return n};return o(u.prototype,{clear:function(){for(var e=p(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=p(this),n=v(this,e);if(n){var i=n.next,r=n.previous;delete t.index[n.index],n.removed=!0,r&&(r.next=i),i&&(i.previous=r),t.first==n&&(t.first=i),t.last==n&&(t.last=r),d?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=p(this),i=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!v(this,e)}}),o(u.prototype,n?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&i(u.prototype,"size",{get:function(){return p(this).size}}),u},setStrong:function(e,t,n){var i=t+" Iterator",r=m(t),o=m(i);c(e,t,function(e,t){f(this,{type:i,target:e,state:r(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),u(t)}}},function(e,t,n){"use strict";var i,r=n(4),o=n(55).f,a=n(26),s=n(222),l=n(35),c=n(224),u=n(44),d="".endsWith,h=Math.min,p=c("endsWith");r({target:"String",proto:!0,forced:!(!u&&!p&&(i=o(String.prototype,"endsWith"),i&&!i.writable)||p)},{endsWith:function(e){var t=String(l(this));s(e);var n=arguments.length>1?arguments[1]:void 0,i=a(t.length),r=void 0===n?i:h(a(n),i),o=String(e);return d?d.call(t,o,r):t.slice(r-o.length,r)===o}})},function(e,t,n){"use strict";(function(e){var i=n(229),r=n(230),o=n(231);function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),r=(e=s(e,i)).write(t,n);return r!==i&&(e=e.slice(0,r)),e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?s(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=s(e,t<0?0:0|p(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function f(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(i)return V(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return D(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function v(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var o,a=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var d=!0,h=0;h<l;h++)if(c(e,o+h)!==c(t,h)){d=!1;break}if(d)return o}return-1}function _(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function w(e,t,n,i){return j(V(t,e.length-n),e,n,i)}function E(e,t,n,i){return j(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function b(e,t,n,i){return E(e,t,n,i)}function x(e,t,n,i){return j(W(t),e,n,i)}function C(e,t,n,i){return j(function(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(n=e.charCodeAt(a))>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function I(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,l,c=e[r],u=null,d=c>239?4:c>223?3:c>191?2:1;if(r+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&(l=(15&c)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return n}(i)}function D(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function A(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function T(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=B(e[o]);return r}function N(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,i,r,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function M(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function k(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function R(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,i,o){return o||R(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function F(e,t,n,i,o){return o||R(e,0,n,8),r.write(e,t,n,i,52,8),n+8}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return c(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,i){return u(t),t<=0?s(e,t):void 0!==n?"string"==typeof i?s(e,t).fill(n,i):s(e,t).fill(n):s(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,i,r){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(i,r),u=e.slice(t,n),d=0;d<s;++d)if(c[d]!==u[d]){o=c[d],a=u[d];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},l.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var r=t-e;n=new l(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||P(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||P(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):k(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):k(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=l.isBuffer(e)?e:V(new l(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function W(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(78))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isASCIIByte=function(e){return e>=0&&e<=127}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.length=function(e){return e.length},t.byteLowercase=function(e){for(var t=0;t<e.length;t++){var n=e[t];n>=65&&n<=90&&(e[t]=n+32)}},t.byteUppercase=function(e){for(var t=0;t<e.length;t++){var n=e[t];n>=97&&n<=122&&(e[t]=n-32)}},t.byteCaseInsensitiveMatch=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(i>=65&&i<=90&&(i+=32),r>=65&&r<=90&&(r+=32),i!==r)return!1}return!0},t.startsWith=function(e,t){for(var n=0;;){if(n>=e.length)return!1;if(n>=t.length)return!0;if(e[n]!==t[n])return!1;n++}},t.byteLessThan=function(e,t){for(var n=0;;){if(n>=e.length)return!1;if(n>=t.length)return!0;var i=e[n],r=t[n];if(i<r)return!0;if(i>r)return!1;n++}},t.isomorphicDecode=function(e){return String.fromCodePoint.apply(String,r(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(7),o=n(0),a=n(12),s=function(){function e(e){this._associatedDocument=e||i.dom.window.document}return e.prototype.createDocumentType=function(e,t,n){return o.namespace_validate(e),o.create_documentType(this._associatedDocument,e,t,n)},e.prototype.createDocument=function(e,t,n){void 0===n&&(n=null);var i=o.create_xmlDocument(),a=null;return t&&(a=o.document_internalCreateElementNS(i,e,t)),n&&i.appendChild(n),a&&i.appendChild(a),i._origin=this._associatedDocument._origin,e===r.namespace.HTML?i._contentType="application/xhtml+xml":e===r.namespace.SVG?i._contentType="image/svg+xml":i._contentType="application/xml",i},e.prototype.createHTMLDocument=function(e){var t=o.create_document();t._type="html",t._contentType="text/html",t.appendChild(o.create_documentType(t,"html","",""));var n=o.element_createAnElement(t,"html",r.namespace.HTML);t.appendChild(n);var i=o.element_createAnElement(t,"head",r.namespace.HTML);if(n.appendChild(i),void 0!==e){var a=o.element_createAnElement(t,"title",r.namespace.HTML);i.appendChild(a);var s=o.create_text(t,e);a.appendChild(s)}var l=o.element_createAnElement(t,"body",r.namespace.HTML);return n.appendChild(l),t._origin=this._associatedDocument._origin,t},e.prototype.hasFeature=function(){return!0},e._create=function(t){return new e(t)},e}();t.DOMImplementationImpl=s,a.idl_defineConst(s.prototype,"_ID","@oozcitak/dom")},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(70),a=n(1),s=n(0),l=function(e){function t(){var t=e.call(this)||this;return t._signalSlots=new Set,t._mutationObserverMicrotaskQueued=!1,t._mutationObservers=new Set,t._iteratorList=new a.FixedSizeSet,t._associatedDocument=s.create_document(),t}return r(t,e),Object.defineProperty(t.prototype,"document",{get:function(){return this._associatedDocument},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"event",{get:function(){return this._currentEvent},enumerable:!0,configurable:!0}),t._create=function(){return new t},t}(o.EventTargetImpl);t.WindowImpl=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){}return e.isNode=function(e){return!!e&&void 0!==e._nodeType},e.isDocumentNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.Document},e.isDocumentTypeNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.DocumentType},e.isDocumentFragmentNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.DocumentFragment},e.isAttrNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.Attribute},e.isCharacterDataNode=function(t){if(!e.isNode(t))return!1;var n=t._nodeType;return n===i.NodeType.Text||n===i.NodeType.ProcessingInstruction||n===i.NodeType.Comment||n===i.NodeType.CData},e.isTextNode=function(t){return e.isNode(t)&&(t._nodeType===i.NodeType.Text||t._nodeType===i.NodeType.CData)},e.isExclusiveTextNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.Text},e.isCDATASectionNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.CData},e.isCommentNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.Comment},e.isProcessingInstructionNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.ProcessingInstruction},e.isElementNode=function(t){return e.isNode(t)&&t._nodeType===i.NodeType.Element},e.isCustomElementNode=function(t){return e.isElementNode(t)&&"custom"===t._customElementState},e.isShadowRoot=function(e){return!!e&&void 0!==e.host},e.isMouseEvent=function(e){return!!e&&void 0!==e.screenX&&null!=e.screenY},e.isSlotable=function(t){return!!t&&void 0!==t._name&&void 0!==t._assignedSlot&&(e.isTextNode(t)||e.isElementNode(t))},e.isSlot=function(t){return!!t&&void 0!==t._name&&void 0!==t._assignedNodes&&e.isElementNode(t)},e.isWindow=function(e){return!!e&&void 0!==e.navigator},e.isEventListener=function(e){return!!e&&void 0!==e.handleEvent},e.isRegisteredObserver=function(e){return!!e&&void 0!==e.observer&&void 0!==e.options},e.isTransientRegisteredObserver=function(t){return!!t&&void 0!==t.source&&e.isRegisteredObserver(t)},e}();t.Guard=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return r(t,e),t}(n(98).DocumentImpl);t.XMLDocumentImpl=o},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(1),s=n(243),l=n(7),c=n(244),u={ftp:21,file:null,http:80,https:443,ws:80,wss:443},d=/[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,h=/[ "<>`]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,p=/[ "<>`#?{}]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,f=/[ "<>`#?{}/:;=@\[\]\\\^\|]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,m=/[0-9A-Za-z!\$&-\/:;=\?@_~\xA0-\uD7FF\uE000-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uD83E\uD840-\uD87E\uD880-\uD8BE\uD8C0-\uD8FE\uD900-\uD93E\uD940-\uD97E\uD980-\uD9BE\uD9C0-\uD9FE\uDA00-\uDA3E\uDA40-\uDA7E\uDA80-\uDABE\uDAC0-\uDAFE\uDB00-\uDB3E\uDB40-\uDB7E\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDC00-\uDFFD]/,g=/[\0\t\f\r #%/:?@\[\\\]]/;function v(e){void 0!==o&&o.call(null,"Validation Error: "+e)}function y(){return{scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null}}function _(e){return e in u}function w(e){return _(e.scheme)}function E(e){return u[e]||null}function b(e){return""!==e.username||""!==e.password}function x(e,t){var n,r;void 0===t&&(t=!1);var o=e.scheme+":";if(null!==e.host?(o+="//",b(e)&&(o+=e.username,""!==e.password&&(o+=":"+e.password),o+="@"),o+=C(e.host),null!==e.port&&(o+=":"+e.port)):null===e.host&&"file"===e.scheme&&(o+="//"),e._cannotBeABaseURLFlag)o+=e.path[0];else try{for(var a=i(e.path),s=a.next();!s.done;s=a.next())o+="/"+s.value}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null!==e.query&&(o+="?"+e.query),t||null===e.fragment||(o+="#"+e.fragment),o}function C(e){return a.isNumber(e)?I(e):a.isArray(e)?"["+S(e)+"]":e}function I(e){for(var t="",n=e,i=1;i<=4;i++)t=(n%256).toString()+t,4!==i&&(t="."+t),n=Math.floor(n/256);return t}function S(e){for(var t="",n=null,i=-1,r=0,o=0,a=0;a<8;a++)if(0===e[a]){r=1;for(var s=a+1;s<8&&0===e[s];s++)r++;r>o&&(o=r,i=a)}o>1&&(n=i);for(var l=!1,c=0;c<8;c++)l&&0===e[c]||(l&&(l=!1),n!==c?(t+=e[c].toString(16),7!==c&&(t+=":")):(t+=0===c?"::":":",l=!0));return t}function D(e,t,n,r,o){var c,u,g,y;if(void 0===r){r={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null};var x=/^[\u0000-\u001F\u0020]+/,C=/[\u0000-\u001F\u0020]+$/;(x.test(e)||C.test(e))&&v("Input string contains leading or trailing control characters or space."),e=(e=e.replace(x,"")).replace(C,"")}var I=/[\u0009\u000A\u000D]/g;I.test(e)&&v("Input string contains tab or newline characters."),e=e.replace(I,"");var S=void 0===o?s.ParserState.SchemeStart:o;void 0===t&&(t=null);for(var D=void 0===n||"replacement"===n||"UTF-16BE"===n||"UTF-16LE"===n?"UTF-8":n,R="",L=!1,F=!1,U=!1,B=new a.StringWalker(e);;){switch(S){case s.ParserState.SchemeStart:if(l.codePoint.ASCIIAlpha.test(B.c()))R+=B.c().toLowerCase(),S=s.ParserState.Scheme;else{if(void 0!==o)return v("Invalid scheme start character."),null;S=s.ParserState.NoScheme,B.pointer--}break;case s.ParserState.Scheme:if(l.codePoint.ASCIIAlphanumeric.test(B.c())||"+"===B.c()||"-"===B.c()||"."===B.c())R+=B.c().toLowerCase();else{if(":"!==B.c()){if(void 0===o){R="",S=s.ParserState.NoScheme,B.pointer=0;continue}return v("Invalid input string."),null}if(void 0!==o){if(_(r.scheme)&&!_(R))return r;if(!_(r.scheme)&&_(R))return r;if((b(r)||null!==r.port)&&"file"===R)return r;if("file"===r.scheme&&(""===r.host||null===r.host))return r}if(r.scheme=R,void 0!==o)return r.port===E(r.scheme)&&(r.port=null),r;R="","file"===r.scheme?(B.remaining().startsWith("//")||v("Invalid file URL scheme, '//' expected."),S=s.ParserState.File):w(r)&&null!==t&&t.scheme===r.scheme?S=s.ParserState.SpecialRelativeOrAuthority:w(r)?S=s.ParserState.SpecialAuthoritySlashes:B.remaining().startsWith("/")?(S=s.ParserState.PathOrAuthority,B.pointer++):(r._cannotBeABaseURLFlag=!0,r.path.push(""),S=s.ParserState.CannotBeABaseURLPath)}break;case s.ParserState.NoScheme:if(null===t||t._cannotBeABaseURLFlag&&"#"!==B.c())return v("Invalid input string."),null;t._cannotBeABaseURLFlag&&"#"===B.c()?(r.scheme=t.scheme,r.path=l.list.clone(t.path),r.query=t.query,r.fragment="",r._cannotBeABaseURLFlag=!0,S=s.ParserState.Fragment):"file"!==t.scheme?(S=s.ParserState.Relative,B.pointer--):(S=s.ParserState.File,B.pointer--);break;case s.ParserState.SpecialRelativeOrAuthority:"/"===B.c()&&B.remaining().startsWith("/")?(S=s.ParserState.SpecialAuthorityIgnoreSlashes,B.pointer++):(v("Invalid input string."),S=s.ParserState.Relative,B.pointer--);break;case s.ParserState.PathOrAuthority:"/"===B.c()?S=s.ParserState.Authority:(S=s.ParserState.Path,B.pointer--);break;case s.ParserState.Relative:if(null===t)throw new Error("Invalid parser state. Base URL is null.");switch(r.scheme=t.scheme,B.c()){case"":r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=l.list.clone(t.path),r.query=t.query;break;case"/":S=s.ParserState.RelativeSlash;break;case"?":r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=l.list.clone(t.path),r.query="",S=s.ParserState.Query;break;case"#":r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=l.list.clone(t.path),r.query=t.query,r.fragment="",S=s.ParserState.Fragment;break;default:w(r)&&"\\"===B.c()?(v("Invalid input string."),S=s.ParserState.RelativeSlash):(r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=l.list.clone(t.path),0!==r.path.length&&r.path.splice(r.path.length-1,1),S=s.ParserState.Path,B.pointer--)}break;case s.ParserState.RelativeSlash:if(!w(r)||"/"!==B.c()&&"\\"!==B.c())if("/"===B.c())S=s.ParserState.Authority;else{if(null===t)throw new Error("Invalid parser state. Base URL is null.");r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,S=s.ParserState.Path,B.pointer--}else"\\"===B.c()&&v("Invalid input string."),S=s.ParserState.SpecialAuthorityIgnoreSlashes;break;case s.ParserState.SpecialAuthoritySlashes:"/"===B.c()&&B.remaining().startsWith("/")?(S=s.ParserState.SpecialAuthorityIgnoreSlashes,B.pointer++):(v("Expected '//'."),S=s.ParserState.SpecialAuthorityIgnoreSlashes,B.pointer--);break;case s.ParserState.SpecialAuthorityIgnoreSlashes:"/"!==B.c()&&"\\"!==B.c()?(S=s.ParserState.Authority,B.pointer--):v("Unexpected '/' or '\\'.");break;case s.ParserState.Authority:if("@"===B.c()){v("Unexpected '@'."),L&&(R="%40"+R),L=!0;try{for(var W=(c=void 0,i(R)),j=W.next();!j.done;j=W.next()){var z=j.value;if(":"!==z||U){var G=H(z,f);U?r.password+=G:r.username+=G}else U=!0}}catch(e){c={error:e}}finally{try{j&&!j.done&&(u=W.return)&&u.call(W)}finally{if(c)throw c.error}}R=""}else if(""===B.c()||"/"===B.c()||"?"===B.c()||"#"===B.c()||w(r)&&"\\"===B.c()){if(L&&""===R)return v("Invalid input string."),null;B.pointer-=R.length+1,R="",S=s.ParserState.Host}else R+=B.c();break;case s.ParserState.Host:case s.ParserState.Hostname:if(void 0!==o&&"file"===r.scheme)B.pointer--,S=s.ParserState.FileHost;else if(":"!==B.c()||F)if(""===B.c()||"/"===B.c()||"?"===B.c()||"#"===B.c()||w(r)&&"\\"===B.c()){if(B.pointer--,w(r)&&""===R)return v("Invalid input string."),null;if(void 0!==o&&""===R&&(b(r)||null!==r.port))return v("Invalid input string."),r;if(null===($=k(R,!w(r))))return null;if(r.host=$,R="",S=s.ParserState.PathStart,void 0!==o)return r}else"["===B.c()&&(F=!0),"]"===B.c()&&(F=!1),R+=B.c();else{if(""===R)return v("Invalid input string."),null;if(null===($=k(R,!w(r))))return null;if(r.host=$,R="",S=s.ParserState.Port,o===s.ParserState.Hostname)return r}break;case s.ParserState.Port:if(l.codePoint.ASCIIDigit.test(B.c()))R+=B.c();else{if(!(""===B.c()||"/"===B.c()||"?"===B.c()||"#"===B.c()||w(r)&&"\\"===B.c()||o))return v("Invalid input string."),null;if(""!==R&&""!==R){var q=parseInt(R,10);if(q>Math.pow(2,16)-1)return v("Invalid port number."),null;r.port=q===E(r.scheme)?null:q,R=""}if(void 0!==o)return r;S=s.ParserState.PathStart,B.pointer--}break;case s.ParserState.File:if(r.scheme="file","/"===B.c()||"\\"===B.c())"\\"===B.c()&&v("Invalid input string."),S=s.ParserState.FileSlash;else if(null!==t&&"file"===t.scheme)switch(B.c()){case"":r.host=t.host,r.path=l.list.clone(t.path),r.query=t.query;break;case"?":r.host=t.host,r.path=l.list.clone(t.path),r.query="",S=s.ParserState.Query;break;case"#":r.host=t.host,r.path=l.list.clone(t.path),r.query=t.query,r.fragment="",S=s.ParserState.Fragment;break;default:M(B.substring())?v("Unexpected windows drive letter in input string."):(r.host=t.host,r.path=l.list.clone(t.path),N(r)),S=s.ParserState.Path,B.pointer--}else S=s.ParserState.Path,B.pointer--;break;case s.ParserState.FileSlash:"/"===B.c()||"\\"===B.c()?("\\"===B.c()&&v("Invalid input string."),S=s.ParserState.FileHost):(null===t||"file"!==t.scheme||M(B.substring())||(O(t.path[0])?r.path.push(t.path[0]):r.host=t.host),S=s.ParserState.Path,B.pointer--);break;case s.ParserState.FileHost:if(""===B.c()||"/"===B.c()||"\\"===B.c()||"?"===B.c()||"#"===B.c())if(B.pointer--,void 0===o&&P(R))v("Unexpected windows drive letter in input string."),S=s.ParserState.Path;else if(""===R){if(r.host="",void 0!==o)return r;S=s.ParserState.PathStart}else{var $;if(null===($=k(R,!w(r))))return null;if("localhost"===$&&($=""),r.host=$,void 0!==o)return r;R="",S=s.ParserState.PathStart}else R+=B.c();break;case s.ParserState.PathStart:w(r)?("\\"===B.c()&&v("Invalid input string."),S=s.ParserState.Path,"/"!==B.c()&&"\\"!==B.c()&&B.pointer--):void 0===o&&"?"===B.c()?(r.query="",S=s.ParserState.Query):void 0===o&&"#"===B.c()?(r.fragment="",S=s.ParserState.Fragment):""!==B.c()&&(S=s.ParserState.Path,"/"!==B.c()&&B.pointer--);break;case s.ParserState.Path:if(""===B.c()||"/"===B.c()||w(r)&&"\\"===B.c()||void 0===o&&("?"===B.c()||"#"===B.c())){if(w(r)&&"\\"===B.c()&&v("Invalid input string."),T(R))N(r),"/"===B.c()||w(r)&&"\\"===B.c()||r.path.push("");else if(!A(R)||"/"===B.c()||w(r)&&"\\"===B.c()){if(!A(R)){if("file"===r.scheme&&0===r.path.length&&P(R)){null!==r.host&&""!==r.host&&(v("Invalid input string."),r.host="");var X=Array.from(R);R=X.slice(0,1)+":"+X.slice(2)}r.path.push(R)}}else r.path.push("");if(R="","file"===r.scheme&&(""===B.c()||"?"===B.c()||"#"===B.c()))for(;r.path.length>1&&""===r.path[0];)v("Invalid input string."),r.path.splice(0,1);"?"===B.c()&&(r.query="",S=s.ParserState.Query),"#"===B.c()&&(r.fragment="",S=s.ParserState.Fragment)}else m.test(B.c())||"%"===B.c()||v("Character is not a URL code point or a percent encoded character."),"%"!==B.c()||/^[0-9a-fA-F][0-9a-fA-F]/.test(B.remaining())||v("Percent encoded character must be followed by two hex digits."),R+=H(B.c(),p);break;case s.ParserState.CannotBeABaseURLPath:"?"===B.c()?(r.query="",S=s.ParserState.Query):"#"===B.c()?(r.fragment="",S=s.ParserState.Fragment):(""===B.c()||m.test(B.c())||"%"===B.c()||v("Character is not a URL code point or a percent encoded character."),"%"!==B.c()||/^[0-9a-fA-F][0-9a-fA-F]/.test(B.remaining())||v("Percent encoded character must be followed by two hex digits."),""!==B.c()&&(r.path[0]+=H(B.c(),d)));break;case s.ParserState.Query:if("UTF-8"===D||w(r)&&"ws"!==r.scheme&&"wss"!==r.scheme||(D="UTF-8"),void 0===o&&"#"===B.c())r.fragment="",S=s.ParserState.Fragment;else if(""!==B.c()){if(m.test(B.c())||"%"===B.c()||v("Character is not a URL code point or a percent encoded character."),"%"!==B.c()||/^[0-9a-fA-F][0-9a-fA-F]/.test(B.remaining())||v("Percent encoded character must be followed by two hex digits."),"UTF-8"!==D.toUpperCase())throw new Error("Only UTF-8 encoding is supported.");var K=a.utf8Encode(B.c());if(K.length>=3&&38===K[0]&&35===K[1]&&59===K[K.length-1])K=K.subarray(2,K.length-1),r.query+="%26%23"+l.byteSequence.isomorphicDecode(K)+"%3B";else try{for(var Y=(g=void 0,i(K)),J=Y.next();!J.done;J=Y.next()){var Z=J.value;Z<33||Z>126||34===Z||35===Z||60===Z||62===Z||39===Z&&w(r)?r.query+=V(Z):r.query+=String.fromCharCode(Z)}}catch(e){g={error:e}}finally{try{J&&!J.done&&(y=Y.return)&&y.call(Y)}finally{if(g)throw g.error}}}break;case s.ParserState.Fragment:""===B.c()||("\0"===B.c()?v("NULL character in input string."):(m.test(B.c())||"%"===B.c()||v("Unexpected character in fragment string."),"%"!==B.c()||/^[A-Za-z0-9][A-Za-z0-9]/.test(B.remaining())||v("Unexpected character in fragment string."),r.fragment+=H(B.c(),h)))}if(B.eof)break;B.pointer++}return r}function A(e){return"."===e||"%2e"===e.toLowerCase()}function T(e){var t=e.toLowerCase();return".."===t||".%2e"===t||"%2e."===t||"%2e%2e"===t}function N(e){var t=e.path;0!==t.length&&("file"===e.scheme&&1===t.length&&O(t[0])||e.path.splice(e.path.length-1,1))}function O(e){return e.length>=2&&l.codePoint.ASCIIAlpha.test(e[0])&&":"===e[1]}function P(e){return e.length>=2&&l.codePoint.ASCIIAlpha.test(e[0])&&(":"===e[1]||"|"===e[1])}function M(e){return e.length>=2&&P(e)&&(2===e.length||"/"===e[2]||"\\"===e[2]||"?"===e[2]||"#"===e[2])}function k(e,t){if(void 0===t&&(t=!1),e.startsWith("["))return e.endsWith("]")?F(e.substring(1,e.length-1)):(v("Expected ']' after '['."),null);if(t)return U(e);var n=q(a.utf8Decode(j(e)));if(null===n)return v("Invalid domain."),null;if(g.test(n))return v("Invalid domain."),null;var i=L(n);return null===i||a.isNumber(i)?i:n}function R(e,t){void 0===t&&(t={value:!1});var n=10;return e.startsWith("0x")||e.startsWith("0X")?(t.value=!0,e=e.substr(2),n=16):e.length>=2&&"0"===e[0]&&(t.value=!0,e=e.substr(1),n=8),""===e?0:(10===n?/^[0-9]+$/:16===n?/^[0-9A-Fa-f]+$/:/^[0-7]+$/).test(e)?parseInt(e,n):null}function L(e){var t,n,r,o,a={value:!1},s=e.split(".");if(""===s[s.length-1]&&(a.value=!0,s.length>1&&s.pop()),s.length>4)return e;var l=[];try{for(var c=i(s),u=c.next();!u.done;u=c.next()){var d=u.value;if(""===d)return e;if(null===(y=R(d,a)))return e;l.push(y)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}a.value&&v("Invalid IP v4 address.");for(var h=0;h<l.length;h++)if(l[h]>255&&(v("Invalid IP v4 address."),h<l.length-1))return null;if(l[l.length-1]>=Math.pow(256,5-l.length))return v("Invalid IP v4 address."),null;var p=l[l.length-1];l.pop();var f=0;try{for(var m=i(l),g=m.next();!g.done;g=m.next()){var y;p+=(y=g.value)*Math.pow(256,3-f),f++}}catch(e){r={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}return p}function F(e){var t,n=[0,0,0,0,0,0,0,0],i=0,o=null,s=new a.StringWalker(e);if(":"===s.c()){if(!s.remaining().startsWith(":"))return v("Invalid IP v6 address."),null;s.pointer+=2,o=i+=1}for(;""!==s.c();){if(8===i)return v("Invalid IP v6 address."),null;if(":"!==s.c()){for(var c=0,u=0;u<4&&l.codePoint.ASCIIHexDigit.test(s.c());)c=16*c+parseInt(s.c(),16),s.pointer++,u++;if("."===s.c()){if(0===u)return v("Invalid IP v6 address."),null;if(s.pointer-=u,i>6)return v("Invalid IP v6 address."),null;for(var d=0;""!==s.c();){var h=null;if(d>0){if(!("."===s.c()&&d<4))return v("Invalid IP v6 address."),null;s.pointer++}if(!l.codePoint.ASCIIDigit.test(s.c()))return v("Invalid IP v6 address."),null;for(;l.codePoint.ASCIIDigit.test(s.c());){var p=parseInt(s.c(),10);if(null===h)h=p;else{if(0===h)return v("Invalid IP v6 address."),null;h=10*h+p}if(h>255)return v("Invalid IP v6 address."),null;s.pointer++}if(null===h)return v("Invalid IP v6 address."),null;n[i]=256*n[i]+h,2!==++d&&4!==d||i++}if(4!==d)return v("Invalid IP v6 address."),null;break}if(":"===s.c()){if(s.pointer++,""===s.c())return v("Invalid IP v6 address."),null}else if(""!==s.c())return v("Invalid IP v6 address."),null;n[i]=c,i++}else{if(null!==o)return v("Invalid IP v6 address."),null;s.pointer++,o=++i}}if(null!==o){var f=i-o;for(i=7;0!==i&&f>0;)t=r([n[o+f-1],n[i]],2),n[i]=t[0],n[o+f-1]=t[1],i--,f--}else if(null===o&&8!==i)return v("Invalid IP v6 address."),null;return n}function U(e){var t,n;if(/[\x00\t\f\r #/:?@\[\\\]]/.test(e))return v("Invalid host string."),null;var r="";try{for(var o=i(e),a=o.next();!a.done;a=o.next())r+=H(a.value,d)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function B(e){return null}function V(e){return"%"+("00"+e.toString(16).toUpperCase()).slice(-2)}function W(e){for(var t=function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},n=new Uint8Array(e.length),i=0,r=0;r<e.length;r++){var o=e[r];if(37!==o)n[i]=o,i++;else if(37===o&&r>=e.length-2)n[i]=o,i++;else if(37!==o||t(e[r+1])&&t(e[r+2])){var s=parseInt(a.utf8Decode(Uint8Array.of(e[r+1],e[r+2])),16);n[i]=s,i++,r+=2}else n[i]=o,i++}return n.subarray(0,i)}function j(e){return W(a.utf8Encode(e))}function H(e,t){var n,r;if(!t.test(e))return e;var o=a.utf8Encode(e),s="";try{for(var l=i(o),c=l.next();!c.done;c=l.next())s+=V(c.value)}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return s}function z(e){var t,n,r,o,s=[],l=[];try{for(var c=i(e),u=c.next();!u.done;u=c.next()){var d=u.value;38===d?(s.push(Uint8Array.from(l)),l=[]):l.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}0!==l.length&&s.push(Uint8Array.from(l));var h=[];try{for(var p=i(s),f=p.next();!f.done;f=p.next()){var m=f.value;if(0!==m.length){for(var g=m.indexOf(61),v=-1!==g?m.slice(0,g):m,y=-1!==g?m.slice(g+1):new Uint8Array,_=0;_<v.length;_++)43===v[_]&&(v[_]=32);for(_=0;_<y.length;_++)43===y[_]&&(y[_]=32);var w=a.utf8Decode(v),E=a.utf8Decode(y);h.push([w,E])}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}return h}function G(e){var t,n,r="";try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value;r+=32===s?"+":42===s||45===s||46===s||s>=48&&s<=57||s>=65&&s<=90||95===s||s>=97&&s<=122?String.fromCodePoint(s):V(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function q(e,t){void 0===t&&(t=!1);var n=c.domainToASCII(e);return""===n?(v("Invalid domain name."),null):n}t.setValidationErrorCallback=function(e){o=e},t.newURL=y,t.isSpecialScheme=_,t.isSpecial=w,t.defaultPort=E,t.includesCredentials=b,t.cannotHaveAUsernamePasswordPort=function(e){return null===e.host||""===e.host||e._cannotBeABaseURLFlag||"file"===e.scheme},t.urlSerializer=x,t.hostSerializer=C,t.iPv4Serializer=I,t.iPv6Serializer=S,t.urlParser=function(e,t,n){var i=D(e,t,n);return null===i?null:("blob"!==i.scheme||(i._blobURLEntry=null),i)},t.basicURLParser=D,t.setTheUsername=function(e,t){var n,r,o="";try{for(var a=i(t),s=a.next();!s.done;s=a.next())o+=H(s.value,f)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}e.username=o},t.setThePassword=function(e,t){var n,r,o="";try{for(var a=i(t),s=a.next();!s.done;s=a.next())o+=H(s.value,f)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}e.password=o},t.isSingleDotPathSegment=A,t.isDoubleDotPathSegment=T,t.shorten=N,t.isNormalizedWindowsDriveLetter=O,t.isWindowsDriveLetter=P,t.startsWithAWindowsDriveLetter=M,t.hostParser=k,t.iPv4NumberParser=R,t.iPv4Parser=L,t.iPv6Parser=F,t.opaqueHostParser=U,t.resolveABlobURL=B,t.percentEncode=V,t.percentDecode=W,t.stringPercentDecode=j,t.utf8PercentEncode=H,t.hostEquals=function(e,t){return e===t},t.urlEquals=function(e,t,n){return void 0===n&&(n=!1),x(e,n)===x(t,n)},t.urlEncodedStringParser=function(e){return z(a.utf8Encode(e))},t.urlEncodedParser=z,t.urlEncodedByteSerializer=G,t.urlEncodedSerializer=function(e,t){var n,r;if("UTF-8"!==(void 0===t||"replacement"===t||"UTF-16BE"===t||"UTF-16LE"===t?"UTF-8":t).toUpperCase())throw new Error("Only UTF-8 encoding is supported.");var o="";try{for(var s=i(e),l=s.next();!l.done;l=s.next()){var c=l.value,u=G(a.utf8Encode(c[0])),d=c[1];d=G(a.utf8Encode(d)),""!==o&&(o+="&"),o+=u+"="+d}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o},t.origin=function e(t){switch(t.scheme){case"blob":t._blobURLEntry;var n=D(t.path[0]);return null===n?s.OpaqueOrigin:e(n);case"ftp":case"http":case"https":case"ws":case"wss":return[t.scheme,null===t.host?"":t.host,t.port,null];default:return s.OpaqueOrigin}},t.domainToASCII=q,t.domainToUnicode=function(e,t){void 0===t&&(t=!1);var n=c.domainToUnicode(e);return""===n&&v("Invalid domain name."),n},t.asciiSerializationOfAnOrigin=function(e){if(""===e[0]&&""===e[1]&&null===e[2]&&null===e[3])return"null";var t=e[0]+"://"+C(e[1]);return null!==e[2]&&(t+=":"+e[2].toString()),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){this._signal=i.create_abortSignal()}return Object.defineProperty(e.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),e.prototype.abort=function(){i.abort_signalAbort(this._signal)},e}();t.AbortControllerImpl=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(70),a=n(0),s=function(e){function t(){var t=e.call(this)||this;return t._abortedFlag=!1,t._abortAlgorithms=new Set,t}return r(t,e),Object.defineProperty(t.prototype,"aborted",{get:function(){return this._abortedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onabort",{get:function(){return a.event_getterEventHandlerIDLAttribute(this,"onabort")},set:function(e){a.event_setterEventHandlerIDLAttribute(this,"onabort",e)},enumerable:!0,configurable:!0}),t._create=function(){return new t},t}(o.EventTargetImpl);t.AbortSignalImpl=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(34),s=n(12),l=function(e){function t(t,n,i){var r=e.call(this)||this;return r._name="",r._publicId="",r._systemId="",r._name=t,r._publicId=n,r._systemId=i,r}return r(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"publicId",{get:function(){return this._publicId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this._systemId},enumerable:!0,configurable:!0}),t.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},t._create=function(e,n,i,r){void 0===i&&(i=""),void 0===r&&(r="");var o=new t(n,i,r);return o._nodeDocument=e,o},t}(a.NodeImpl);t.DocumentTypeImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.DocumentType)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(100),a=n(1),s=n(0),l=function(e){function t(t,n){var i=e.call(this)||this;return i._host=t,i._mode=n,i}return r(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),t.prototype._getTheParent=function(e){return e._composedFlag||a.isEmpty(e._path)||s.tree_rootNode(e._path[0].invocationTarget)!==this?this._host:null},t._create=function(e,n){return new t(n,"closed")},t}(o.DocumentFragmentImpl);t.ShadowRootImpl=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(34),s=n(0),l=n(12),c=function(e){function t(t){var n=e.call(this)||this;return n._namespace=null,n._namespacePrefix=null,n._element=null,n._value="",n._localName=t,n}return r(t,e),Object.defineProperty(t.prototype,"ownerElement",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._qualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){s.attr_setAnExistingAttributeValue(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_qualifiedName",{get:function(){return null!==this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),t._create=function(e,n){var i=new t(n);return i._nodeDocument=e,i},t}(a.NodeImpl);t.AttrImpl=c,l.idl_defineConst(c.prototype,"_nodeType",o.NodeType.Attribute),l.idl_defineConst(c.prototype,"specified",!0)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(101),a=n(2),s=n(12),l=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t._create=function(e,n){void 0===n&&(n="");var i=new t(n);return i._nodeDocument=e,i},t}(o.TextImpl);t.CDATASectionImpl=l,s.idl_defineConst(l.prototype,"_nodeType",a.NodeType.CData)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(71),s=n(12),l=function(e){function t(t){return void 0===t&&(t=""),e.call(this,t)||this}return r(t,e),t._create=function(e,n){void 0===n&&(n="");var i=new t(n);return i._nodeDocument=e,i},t}(a.CharacterDataImpl);t.CommentImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.Comment)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(71),s=n(12),l=function(e){function t(t,n){var i=e.call(this,n)||this;return i._target=t,i}return r(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),t._create=function(e,n,i){var r=new t(n,i);return r._nodeDocument=e,r},t}(a.CharacterDataImpl);t.ProcessingInstructionImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.ProcessingInstruction)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=n(0),o=n(3),a=n(1),s=function(){function e(e,t){return this._live=!0,this._root=e,this._filter=t,new Proxy(this,this)}return Object.defineProperty(e.prototype,"length",{get:function(){for(var e=this,t=0,n=r.tree_getFirstDescendantNode(this._root,!1,!1,function(t){return o.Guard.isElementNode(t)&&e._filter(t)});null!==n;)t++,n=r.tree_getNextDescendantNode(this._root,n,!1,!1,function(t){return o.Guard.isElementNode(t)&&e._filter(t)});return t},enumerable:!0,configurable:!0}),e.prototype.item=function(e){for(var t=this,n=0,i=r.tree_getFirstDescendantNode(this._root,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)});null!==i;){if(n===e)return i;n++,i=r.tree_getNextDescendantNode(this._root,i,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)})}return null},e.prototype.namedItem=function(e){var t=this;if(""===e)return null;for(var n=r.tree_getFirstDescendantNode(this._root,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)});null!=n;){if(n._uniqueIdentifier===e)return n;if(n._namespace===i.namespace.HTML)for(var a=0;a<n._attributeList.length;a++){var s=n._attributeList[a];if("name"===s._localName&&null===s._namespace&&null===s._namespacePrefix&&s._value===e)return n}n=r.tree_getNextDescendantNode(this._root,n,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)})}return null},e.prototype[Symbol.iterator]=function(){var e=this._root,t=this._filter,n=r.tree_getFirstDescendantNode(e,!1,!1,function(e){return o.Guard.isElementNode(e)&&t(e)});return{next:function(){if(null===n)return{done:!0,value:null};var i={done:!1,value:n};return n=r.tree_getNextDescendantNode(e,n,!1,!1,function(e){return o.Guard.isElementNode(e)&&t(e)}),i}}},e.prototype.get=function(t,n,i){if(!a.isString(n)||-1!==e.reservedNames.indexOf(n))return Reflect.get(t,n,i);var r=Number(n);return isNaN(r)?t.namedItem(n)||void 0:t.item(r)||void 0},e.prototype.set=function(t,n,i,o){if(!a.isString(n)||-1!==e.reservedNames.indexOf(n))return Reflect.set(t,n,i,o);var s=Number(n),l=isNaN(s)?t.namedItem(n)||void 0:t.item(s)||void 0;return!(!l||!l._parent||(r.mutation_replace(l,i,l._parent),0))},e._create=function(t,n){return void 0===n&&(n=function(){return!0}),new e(t,n)},e.reservedNames=["_root","_live","_filter","length","item","namedItem","get","set"],e}();t.HTMLCollectionImpl=s},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(1),a=n(0),s=function(){function e(e){return this._live=!0,this._filter=null,this._length=0,this._root=e,new Proxy(this,this)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._root._children.size},enumerable:!0,configurable:!0}),e.prototype.item=function(e){if(e<0||e>this.length-1)return null;if(e<this.length/2){for(var t=0,n=this._root._firstChild;null!==n&&t!==e;)n=n._nextSibling,t++;return n}for(t=this.length-1,n=this._root._lastChild;null!==n&&t!==e;)n=n._previousSibling,t--;return n},e.prototype.keys=function(){var e;return(e={})[Symbol.iterator]=function(){var e=0;return{next:function(){return e===this.length?{done:!0,value:null}:{done:!1,value:e++}}.bind(this)}}.bind(this),e},e.prototype.values=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator]();return{next:function(){return e.next()}}}.bind(this),e},e.prototype.entries=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator](),t=0;return{next:function(){var n=e.next();return n.done?{done:!0,value:null}:{done:!1,value:[t++,n.value]}}}}.bind(this),e},e.prototype[Symbol.iterator]=function(){return this._root._children[Symbol.iterator]()},e.prototype.forEach=function(e,t){var n,o;void 0===t&&(t=r.dom.window);var a=0;try{for(var s=i(this._root._children),l=s.next();!l.done;l=s.next()){var c=l.value;e.call(t,c,a++,this)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},e.prototype.get=function(e,t,n){if(!o.isString(t))return Reflect.get(e,t,n);var i=Number(t);return isNaN(i)?Reflect.get(e,t,n):e.item(i)||void 0},e.prototype.set=function(e,t,n,i){if(!o.isString(t))return Reflect.set(e,t,n,i);var r=Number(t);if(isNaN(r))return Reflect.set(e,t,n,i);var s=e.item(r)||void 0;return!!s&&!!s._parent&&(a.mutation_replace(s,n,s._parent),!0)},e._create=function(t){return new e(t)},e}();t.NodeListImpl=s},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(1),a=function(){function e(e){return this._live=!1,this._items=[],this._length=0,this._root=e,this._items=[],this._filter=function(e){return!0},new Proxy(this,this)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype.item=function(e){return e<0||e>this.length-1?null:this._items[e]},e.prototype.keys=function(){var e;return(e={})[Symbol.iterator]=function(){var e=0;return{next:function(){return e===this.length?{done:!0,value:null}:{done:!1,value:e++}}.bind(this)}}.bind(this),e},e.prototype.values=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator]();return{next:function(){return e.next()}}}.bind(this),e},e.prototype.entries=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator](),t=0;return{next:function(){var n=e.next();return n.done?{done:!0,value:null}:{done:!1,value:[t++,n.value]}}}}.bind(this),e},e.prototype[Symbol.iterator]=function(){var e=this._items[Symbol.iterator]();return{next:function(){return e.next()}}},e.prototype.forEach=function(e,t){var n,o;void 0===t&&(t=r.dom.window);var a=0;try{for(var s=i(this._items),l=s.next();!l.done;l=s.next()){var c=l.value;e.call(t,c,a++,this)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},e.prototype.get=function(e,t,n){if(!o.isString(t))return Reflect.get(e,t,n);var i=Number(t);return isNaN(i)?Reflect.get(e,t,n):e._items[i]||void 0},e.prototype.set=function(e,t,n,i){if(!o.isString(t))return Reflect.set(e,t,n,i);var r=Number(t);return isNaN(r)?Reflect.set(e,t,n,i):r>=0&&r<e._items.length&&(e._items[r]=n,!0)},e._create=function(t,n){var i=new e(t);return i._items=n,i},e}();t.NodeListStaticImpl=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(0),s=function(e){function t(n){var i=e.call(this)||this;return i._element=n,Object.setPrototypeOf(i,t.prototype),i}return r(t,e),t.prototype._asArray=function(){return this},t.prototype.item=function(e){return this[e]||null},t.prototype.getNamedItem=function(e){return a.element_getAnAttributeByName(e,this._element)},t.prototype.getNamedItemNS=function(e,t){return a.element_getAnAttributeByNamespaceAndLocalName(e||"",t,this._element)},t.prototype.setNamedItem=function(e){return a.element_setAnAttribute(e,this._element)},t.prototype.setNamedItemNS=function(e){return a.element_setAnAttribute(e,this._element)},t.prototype.removeNamedItem=function(e){var t=a.element_removeAnAttributeByName(e,this._element);if(null===t)throw new o.NotFoundError;return t},t.prototype.removeNamedItemNS=function(e,t){var n=a.element_removeAnAttributeByNamespaceAndLocalName(e||"",t,this._element);if(null===n)throw new o.NotFoundError;return n},t._create=function(e){return new t(e)},t}(Array);t.NamedNodeMapImpl=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(2),l=n(102),c=n(9),u=n(0),d=n(12),h=n(3),p=function(e){function t(){var t=e.call(this)||this,n=a.dom.window._associatedDocument;return t._start=[n,0],t._end=[n,0],a.dom.rangeList.add(t),t}return r(t,e),Object.defineProperty(t.prototype,"commonAncestorContainer",{get:function(){for(var e=this._start[0];!u.tree_isAncestorOf(this._end[0],e,!0);){if(null===e._parent)throw new Error("Parent node  is null.");e=e._parent}return e},enumerable:!0,configurable:!0}),t.prototype.setStart=function(e,t){u.range_setTheStart(this,e,t)},t.prototype.setEnd=function(e,t){u.range_setTheEnd(this,e,t)},t.prototype.setStartBefore=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheStart(this,t,u.tree_index(e))},t.prototype.setStartAfter=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheStart(this,t,u.tree_index(e)+1)},t.prototype.setEndBefore=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheEnd(this,t,u.tree_index(e))},t.prototype.setEndAfter=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheEnd(this,t,u.tree_index(e)+1)},t.prototype.collapse=function(e){e?this._end=this._start:this._start=this._end},t.prototype.selectNode=function(e){u.range_select(e,this)},t.prototype.selectNodeContents=function(e){if(h.Guard.isDocumentTypeNode(e))throw new c.InvalidNodeTypeError;var t=u.tree_nodeLength(e);this._start=[e,0],this._end=[e,t]},t.prototype.compareBoundaryPoints=function(e,t){if(e!==s.HowToCompare.StartToStart&&e!==s.HowToCompare.StartToEnd&&e!==s.HowToCompare.EndToEnd&&e!==s.HowToCompare.EndToStart)throw new c.NotSupportedError;if(u.range_root(this)!==u.range_root(t))throw new c.WrongDocumentError;var n,i;switch(e){case s.HowToCompare.StartToStart:n=this._start,i=t._start;break;case s.HowToCompare.StartToEnd:n=this._end,i=t._start;break;case s.HowToCompare.EndToEnd:n=this._end,i=t._end;break;case s.HowToCompare.EndToStart:n=this._start,i=t._end;break;default:throw new c.NotSupportedError}var r=u.boundaryPoint_position(n,i);return r===s.BoundaryPosition.Before?-1:r===s.BoundaryPosition.After?1:0},t.prototype.deleteContents=function(){var e,t,n,i;if(!u.range_collapsed(this)){var r=this._startNode,a=this._startOffset,s=this._endNode,l=this._endOffset;if(r===s&&h.Guard.isCharacterDataNode(r))u.characterData_replaceData(r,a,l-a,"");else{var c,d,p=[];try{for(var f=o(u.range_getContainedNodes(this)),m=f.next();!m.done;m=f.next()){var g=(w=m.value)._parent;null!==g&&u.range_isContained(g,this)||p.push(w)}}catch(t){e={error:t}}finally{try{m&&!m.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(u.tree_isAncestorOf(s,r,!0))c=r,d=a;else{for(var v=r;null!==v._parent&&!u.tree_isAncestorOf(s,v._parent,!0);)v=v._parent;if(null===v._parent)throw new Error("Parent node is null.");c=v._parent,d=u.tree_index(v)+1}h.Guard.isCharacterDataNode(r)&&u.characterData_replaceData(r,a,u.tree_nodeLength(r)-a,"");try{for(var y=o(p),_=y.next();!_.done;_=y.next()){var w;(w=_.value)._parent&&u.mutation_remove(w,w._parent)}}catch(e){n={error:e}}finally{try{_&&!_.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}h.Guard.isCharacterDataNode(s)&&u.characterData_replaceData(s,0,l,""),this._start=[c,d],this._end=[c,d]}}},t.prototype.extractContents=function(){return u.range_extract(this)},t.prototype.cloneContents=function(){return u.range_cloneTheContents(this)},t.prototype.insertNode=function(e){return u.range_insert(e,this)},t.prototype.surroundContents=function(e){var t,n;try{for(var i=o(u.range_getPartiallyContainedNodes(this)),r=i.next();!r.done;r=i.next()){var a=r.value;if(!h.Guard.isTextNode(a))throw new c.InvalidStateError}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(h.Guard.isDocumentNode(e)||h.Guard.isDocumentTypeNode(e)||h.Guard.isDocumentFragmentNode(e))throw new c.InvalidNodeTypeError;var s=u.range_extract(this);0!==e._children.size&&u.mutation_replaceAll(null,e),u.range_insert(e,this),u.mutation_append(s,e),u.range_select(e,this)},t.prototype.cloneRange=function(){return u.create_range(this._start,this._end)},t.prototype.detach=function(){a.dom.rangeList.delete(this)},t.prototype.isPointInRange=function(e,t){if(u.tree_rootNode(e)!==u.range_root(this))return!1;if(h.Guard.isDocumentTypeNode(e))throw new c.InvalidNodeTypeError;if(t>u.tree_nodeLength(e))throw new c.IndexSizeError;var n=[e,t];return u.boundaryPoint_position(n,this._start)!==s.BoundaryPosition.Before&&u.boundaryPoint_position(n,this._end)!==s.BoundaryPosition.After},t.prototype.comparePoint=function(e,t){if(u.tree_rootNode(e)!==u.range_root(this))throw new c.WrongDocumentError;if(h.Guard.isDocumentTypeNode(e))throw new c.InvalidNodeTypeError;if(t>u.tree_nodeLength(e))throw new c.IndexSizeError;var n=[e,t];return u.boundaryPoint_position(n,this._start)===s.BoundaryPosition.Before?-1:u.boundaryPoint_position(n,this._end)===s.BoundaryPosition.After?1:0},t.prototype.intersectsNode=function(e){if(u.tree_rootNode(e)!==u.range_root(this))return!1;var t=e._parent;if(null===t)return!0;var n=u.tree_index(e);return u.boundaryPoint_position([t,n],this._end)===s.BoundaryPosition.Before&&u.boundaryPoint_position([t,n+1],this._start)===s.BoundaryPosition.After},t.prototype.toString=function(){var e,t,n="";if(this._startNode===this._endNode&&h.Guard.isTextNode(this._startNode))return this._startNode._data.substring(this._startOffset,this._endOffset);h.Guard.isTextNode(this._startNode)&&(n+=this._startNode._data.substring(this._startOffset));try{for(var i=o(u.range_getContainedNodes(this)),r=i.next();!r.done;r=i.next()){var a=r.value;h.Guard.isTextNode(a)&&(n+=a._data)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return h.Guard.isTextNode(this._endNode)&&(n+=this._endNode._data.substring(0,this._endOffset)),n},t._create=function(e,n){var i=new t;return e&&(i._start=e),n&&(i._end=n),i},t.START_TO_START=0,t.START_TO_END=1,t.END_TO_END=2,t.END_TO_START=3,t}(l.AbstractRangeImpl);t.RangeImpl=p,d.idl_defineConst(p.prototype,"START_TO_START",0),d.idl_defineConst(p.prototype,"START_TO_END",1),d.idl_defineConst(p.prototype,"END_TO_END",2),d.idl_defineConst(p.prototype,"END_TO_START",3)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(103),a=n(0),s=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r._iteratorCollection=void 0,r._reference=n,r._pointerBeforeReference=i,a.nodeIterator_iteratorList().add(r),r}return r(t,e),Object.defineProperty(t.prototype,"referenceNode",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerBeforeReferenceNode",{get:function(){return this._pointerBeforeReference},enumerable:!0,configurable:!0}),t.prototype.nextNode=function(){return a.nodeIterator_traverse(this,!0)},t.prototype.previousNode=function(){return a.nodeIterator_traverse(this,!1)},t.prototype.detach=function(){a.nodeIterator_iteratorList().delete(this)},t._create=function(e,n,i){return new t(e,n,i)},t}(o.TraverserImpl);t.NodeIteratorImpl=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(103),s=n(0),l=function(e){function t(t,n){var i=e.call(this,t)||this;return i._current=n,i}return r(t,e),Object.defineProperty(t.prototype,"currentNode",{get:function(){return this._current},set:function(e){this._current=e},enumerable:!0,configurable:!0}),t.prototype.parentNode=function(){for(var e=this._current;null!==e&&e!==this._root;)if(null!==(e=e._parent)&&s.traversal_filter(this,e)===o.FilterResult.Accept)return this._current=e,e;return null},t.prototype.firstChild=function(){return s.treeWalker_traverseChildren(this,!0)},t.prototype.lastChild=function(){return s.treeWalker_traverseChildren(this,!1)},t.prototype.nextSibling=function(){return s.treeWalker_traverseSiblings(this,!0)},t.prototype.previousNode=function(){for(var e=this._current;e!==this._root;){for(var t=e._previousSibling;t;){e=t;for(var n=s.traversal_filter(this,e);n!==o.FilterResult.Reject&&e._lastChild;)e=e._lastChild,n=s.traversal_filter(this,e);if(n===o.FilterResult.Accept)return this._current=e,e;t=e._previousSibling}if(e===this._root||null===e._parent)return null;if(e=e._parent,s.traversal_filter(this,e)===o.FilterResult.Accept)return this._current=e,e}return null},t.prototype.previousSibling=function(){return s.treeWalker_traverseSiblings(this,!1)},t.prototype.nextNode=function(){for(var e=this._current,t=o.FilterResult.Accept;;){for(;t!==o.FilterResult.Reject&&e._firstChild;)if(e=e._firstChild,(t=s.traversal_filter(this,e))===o.FilterResult.Accept)return this._current=e,e;for(var n=null,i=e;null!==i;){if(i===this._root)return null;if(null!==(n=i._nextSibling)){e=n;break}i=i._parent}if((t=s.traversal_filter(this,e))===o.FilterResult.Accept)return this._current=e,e}},t._create=function(e,n){return new t(e,n)},t}(a.TraverserImpl);t.TreeWalkerImpl=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(12),o=function(){function e(){}return e.prototype.acceptNode=function(e){return i.FilterResult.Accept},e._create=function(){return new e},e.FILTER_ACCEPT=1,e.FILTER_REJECT=2,e.FILTER_SKIP=3,e.SHOW_ALL=4294967295,e.SHOW_ELEMENT=1,e.SHOW_ATTRIBUTE=2,e.SHOW_TEXT=4,e.SHOW_CDATA_SECTION=8,e.SHOW_ENTITY_REFERENCE=16,e.SHOW_ENTITY=32,e.SHOW_PROCESSING_INSTRUCTION=64,e.SHOW_COMMENT=128,e.SHOW_DOCUMENT=256,e.SHOW_DOCUMENT_TYPE=512,e.SHOW_DOCUMENT_FRAGMENT=1024,e.SHOW_NOTATION=2048,e}();t.NodeFilterImpl=o,r.idl_defineConst(o.prototype,"FILTER_ACCEPT",1),r.idl_defineConst(o.prototype,"FILTER_REJECT",2),r.idl_defineConst(o.prototype,"FILTER_SKIP",3),r.idl_defineConst(o.prototype,"SHOW_ALL",4294967295),r.idl_defineConst(o.prototype,"SHOW_ELEMENT",1),r.idl_defineConst(o.prototype,"SHOW_ATTRIBUTE",2),r.idl_defineConst(o.prototype,"SHOW_TEXT",4),r.idl_defineConst(o.prototype,"SHOW_CDATA_SECTION",8),r.idl_defineConst(o.prototype,"SHOW_ENTITY_REFERENCE",16),r.idl_defineConst(o.prototype,"SHOW_ENTITY",32),r.idl_defineConst(o.prototype,"SHOW_PROCESSING_INSTRUCTION",64),r.idl_defineConst(o.prototype,"SHOW_COMMENT",128),r.idl_defineConst(o.prototype,"SHOW_DOCUMENT",256),r.idl_defineConst(o.prototype,"SHOW_DOCUMENT_TYPE",512),r.idl_defineConst(o.prototype,"SHOW_DOCUMENT_FRAGMENT",1024),r.idl_defineConst(o.prototype,"SHOW_NOTATION",2048)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i,r,o,a,s,l){this._type=e,this._target=t,this._addedNodes=n,this._removedNodes=i,this._previousSibling=r,this._nextSibling=o,this._attributeName=a,this._attributeNamespace=s,this._oldValue=l}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addedNodes",{get:function(){return this._addedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"removedNodes",{get:function(){return this._removedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributeName",{get:function(){return this._attributeName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributeNamespace",{get:function(){return this._attributeNamespace},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),e._create=function(t,n,i,r,o,a,s,l,c){return new e(t,n,i,r,o,a,s,l,c)},e}();t.MutationRecordImpl=i},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(9),a=n(7),s=n(0),l=function(){function e(e,t){this._element=e,this._attribute=t,this._tokenSet=new Set;var n=t._localName,i=s.element_getAnAttributeValue(e,n),o=this;this._element._attributeChangeSteps.push(function(e,t,n,i,r){t===o._attribute._localName&&null===r&&(i?o._tokenSet=s.orderedSet_parse(i):o._tokenSet.clear())}),r.dom.features.steps&&s.dom_runAttributeChangeSteps(e,n,i,i,null)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tokenSet.size},enumerable:!0,configurable:!0}),e.prototype.item=function(e){var t,n,r=0;try{for(var o=i(this._tokenSet),a=o.next();!a.done;a=o.next()){var s=a.value;if(r===e)return s;r++}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return null},e.prototype.contains=function(e){return this._tokenSet.has(e)},e.prototype.add=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var l=i(n),c=l.next();!c.done;c=l.next()){var u=c.value;if(""===u)throw new o.SyntaxError("Cannot add an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(u))throw new o.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.add(u)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}s.tokenList_updateSteps(this)},e.prototype.remove=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var l=i(n),c=l.next();!c.done;c=l.next()){var u=c.value;if(""===u)throw new o.SyntaxError("Cannot remove an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(u))throw new o.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.delete(u)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}s.tokenList_updateSteps(this)},e.prototype.toggle=function(e,t){if(void 0===t&&(t=void 0),""===e)throw new o.SyntaxError("Cannot toggle an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(e))throw new o.InvalidCharacterError("Token cannot contain whitespace.");return this._tokenSet.has(e)?void 0!==t&&!1!==t||(this._tokenSet.delete(e),s.tokenList_updateSteps(this),!1):(void 0===t||!0===t)&&(this._tokenSet.add(e),s.tokenList_updateSteps(this),!0)},e.prototype.replace=function(e,t){if(""===e||""===t)throw new o.SyntaxError("Cannot replace an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(e)||a.codePoint.ASCIIWhiteSpace.test(t))throw new o.InvalidCharacterError("Token cannot contain whitespace.");return!!this._tokenSet.has(e)&&(a.set.replace(this._tokenSet,e,t),s.tokenList_updateSteps(this),!0)},e.prototype.supports=function(e){return s.tokenList_validationSteps(this,e)},Object.defineProperty(e.prototype,"value",{get:function(){return s.tokenList_serializeSteps(this)},set:function(e){s.element_setAnAttributeValue(this._element,this._attribute._localName,e)},enumerable:!0,configurable:!0}),e.prototype[Symbol.iterator]=function(){var e=this._tokenSet[Symbol.iterator]();return{next:function(){return e.next()}}},e._create=function(t,n){return new e(t,n)},e}();t.DOMTokenListImpl=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(104),a=n(0),s=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._detail=null,i._detail=n&&n.detail||null,i}return r(t,e),Object.defineProperty(t.prototype,"detail",{get:function(){return this._detail},enumerable:!0,configurable:!0}),t.prototype.initCustomEvent=function(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i=null),this._dispatchFlag||(a.event_initialize(this,e,t,n),this._detail=i)},t}(o.EventImpl);t.CustomEventImpl=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(105),a=n(17);t.nodeIterator_traverse=function(e,t){for(var n=e._reference,i=e._pointerBeforeReference;;){if(t)if(i)i=!1;else{var s=a.tree_getFollowingNode(e._root,n);if(!s)return null;n=s}else if(i){var l=a.tree_getPrecedingNode(e.root,n);if(!l)return null;n=l}else i=!0;if(o.traversal_filter(e,n)===r.FilterResult.Accept)break}return e._reference=n,e._pointerBeforeReference=i,n},t.nodeIterator_iteratorList=function(){return i.dom.window._iteratorList}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(7),o=n(174);function a(e){if(!o.xml_isName(e))throw new i.InvalidCharacterError("Invalid XML name: "+e);if(!o.xml_isQName(e))throw new i.InvalidCharacterError("Invalid XML qualified name: "+e+".")}t.namespace_validate=a,t.namespace_validateAndExtract=function(e,t){e||(e=null),a(t);var n=t.split(":"),o=2===n.length?n[0]:null,s=2===n.length?n[1]:t;if(o&&null===e)throw new i.NamespaceError("Qualified name includes a prefix but the namespace is null.");if("xml"===o&&e!==r.namespace.XML)throw new i.NamespaceError('Qualified name includes the "xml" prefix but the namespace is not the XML namespace.');if(e!==r.namespace.XMLNS&&("xmlns"===o||"xmlns"===t))throw new i.NamespaceError('Qualified name includes the "xmlns" prefix but the namespace is not the XMLNS namespace.');if(e===r.namespace.XMLNS&&"xmlns"!==o&&"xmlns"!==t)throw new i.NamespaceError('Qualified name does not include the "xmlns" prefix but the namespace is the XMLNS namespace.');return[e,o,s]},t.namespace_extractQName=function(e){a(e);var t=e.split(":");return[2===t.length?t[0]:null,2===t.length?t[1]:e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xml_isName=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(!(n>=97&&n<=122||n>=65&&n<=90||58===n||95===n||n>=192&&n<=214||n>=216&&n<=246||n>=248&&n<=767||n>=880&&n<=893||n>=895&&n<=8191||n>=8204&&n<=8205||n>=8304&&n<=8591||n>=11264&&n<=12271||n>=12289&&n<=55295||n>=63744&&n<=64975||n>=65008&&n<=65533||0!==t&&(45===n||46===n||n>=48&&n<=57||183===n||n>=768&&n<=879||n>=8255&&n<=8256))){if(n>=55296&&n<=56319&&t<e.length-1){var i=e.charCodeAt(t+1);if(i>=56320&&i<=57343&&(t++,(n=1024*(n-55296)+i-56320+65536)>=65536&&n<=983039))continue}return!1}}return!0},t.xml_isQName=function(e){for(var t=!1,n=0;n<e.length;n++){var i=e.charCodeAt(n);if(!(i>=97&&i<=122||i>=65&&i<=90||95===i||i>=192&&i<=214||i>=216&&i<=246||i>=248&&i<=767||i>=880&&i<=893||i>=895&&i<=8191||i>=8204&&i<=8205||i>=8304&&i<=8591||i>=11264&&i<=12271||i>=12289&&i<=55295||i>=63744&&i<=64975||i>=65008&&i<=65533||0!==n&&(45===i||46===i||i>=48&&i<=57||183===i||i>=768&&i<=879||i>=8255&&i<=8256))){if(0===n||58!==i){if(i>=55296&&i<=56319&&n<e.length-1){var r=e.charCodeAt(n+1);if(r>=56320&&r<=57343&&(n++,(i=1024*(i-55296)+r-56320+65536)>=65536&&i<=983039))continue}return!1}if(t)return!1;if(n===e.length-1)return!1;t=!0}}return!0},t.xml_isLegalChar=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(!(9===n||10===n||13===n||n>=32&&n<=55295||n>=57344&&n<=65533)){if(n>=55296&&n<=56319&&t<e.length-1){var i=e.charCodeAt(t+1);if(i>=56320&&i<=57343&&(t++,(n=1024*(n-55296)+i-56320+65536)>=65536&&n<=1114111))continue}return!1}}return!0},t.xml_isPubidChar=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(!(n>=97&&n<=122||n>=65&&n<=90||n>=39&&n<=59||32===n||13===n||10===n||n>=35&&n<=37||33===n||61===n||63===n||64===n||95===n))return!1}return!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(17);t.boundaryPoint_position=function e(t,n){var o=t[0],a=t[1],s=n[0],l=n[1];if(console.assert(r.tree_rootNode(o)===r.tree_rootNode(s),"Boundary points must share the same root node."),o===s)return a===l?i.BoundaryPosition.Equal:a<l?i.BoundaryPosition.Before:i.BoundaryPosition.After;if(r.tree_isFollowing(s,o)){var c=e([s,l],[o,a]);if(c===i.BoundaryPosition.Before)return i.BoundaryPosition.After;if(c===i.BoundaryPosition.After)return i.BoundaryPosition.Before}if(r.tree_isAncestorOf(s,o)){for(var u=s;!r.tree_isChildOf(o,u);)null!==u._parent&&(u=u._parent);if(r.tree_index(u)<a)return i.BoundaryPosition.After}return i.BoundaryPosition.Before}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(3),a=n(7),s=n(29),l=n(108),c=n(30),u=n(37),d=n(52);t.node_stringReplaceAll=function(e,t){var n=null;""!==e&&(n=s.create_text(t._nodeDocument,e)),u.mutation_replaceAll(n,t)},t.node_clone=function e(t,n,a){var l,h,p,f,m;if(void 0===n&&(n=null),void 0===a&&(a=!1),null===n&&(n=t._nodeDocument),o.Guard.isElementNode(t)){m=d.element_createAnElement(n,t._localName,t._namespace,t._namespacePrefix,t._is,!1);try{for(var g=i(t._attributeList),v=g.next();!v.done;v=g.next()){var y=e(v.value,n);d.element_append(y,m)}}catch(e){l={error:e}}finally{try{v&&!v.done&&(h=g.return)&&h.call(g)}finally{if(l)throw l.error}}}else if(o.Guard.isDocumentNode(t)){var _=s.create_document();_._encoding=t._encoding,_._contentType=t._contentType,_._URL=t._URL,_._origin=t._origin,_._type=t._type,_._mode=t._mode,m=_}else if(o.Guard.isDocumentTypeNode(t))m=s.create_documentType(n,t._name,t._publicId,t._systemId);else if(o.Guard.isAttrNode(t)){var w=s.create_attr(n,t.localName);w._namespace=t._namespace,w._namespacePrefix=t._namespacePrefix,w._value=t._value,m=w}else m=o.Guard.isExclusiveTextNode(t)?s.create_text(n,t._data):o.Guard.isCDATASectionNode(t)?s.create_cdataSection(n,t._data):o.Guard.isCommentNode(t)?s.create_comment(n,t._data):o.Guard.isProcessingInstructionNode(t)?s.create_processingInstruction(n,t._target,t._data):o.Guard.isDocumentFragmentNode(t)?s.create_documentFragment(n):Object.create(t);if(o.Guard.isDocumentNode(m)?(m._nodeDocument=m,n=m):m._nodeDocument=n,r.dom.features.steps&&c.dom_runCloningSteps(m,t,n,a),a)try{for(var E=i(t._children),b=E.next();!b.done;b=E.next()){var x=e(b.value,n,!0);u.mutation_append(x,m)}}catch(e){p={error:e}}finally{try{b&&!b.done&&(f=E.return)&&f.call(E)}finally{if(p)throw p.error}}return m},t.node_equals=function e(t,n){var r,a,s,l;if(t._nodeType!==n._nodeType)return!1;if(o.Guard.isDocumentTypeNode(t)&&o.Guard.isDocumentTypeNode(n)){if(t._name!==n._name||t._publicId!==n._publicId||t._systemId!==n._systemId)return!1}else if(o.Guard.isElementNode(t)&&o.Guard.isElementNode(n)){if(t._namespace!==n._namespace||t._namespacePrefix!==n._namespacePrefix||t._localName!==n._localName||t._attributeList.length!==n._attributeList.length)return!1}else if(o.Guard.isAttrNode(t)&&o.Guard.isAttrNode(n)){if(t._namespace!==n._namespace||t._localName!==n._localName||t._value!==n._value)return!1}else if(o.Guard.isProcessingInstructionNode(t)&&o.Guard.isProcessingInstructionNode(n)){if(t._target!==n._target||t._data!==n._data)return!1}else if(o.Guard.isCharacterDataNode(t)&&o.Guard.isCharacterDataNode(n)&&t._data!==n._data)return!1;if(o.Guard.isElementNode(t)&&o.Guard.isElementNode(n)){var c={};try{for(var u=i(t._attributeList),d=u.next();!d.done;d=u.next())c[(f=d.value)._localName]=f}catch(e){r={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}try{for(var h=i(n._attributeList),p=h.next();!p.done;p=h.next()){var f,m=p.value;if(!(f=c[m._localName]))return!1;if(!e(f,m))return!1}}catch(e){s={error:e}}finally{try{p&&!p.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}}if(t._children.size!==n._children.size)return!1;for(var g=t._children[Symbol.iterator](),v=n._children[Symbol.iterator](),y=g.next(),_=v.next();!y.done&&!_.done;){if(!e(y.value,_.value))return!1;y=g.next(),_=v.next()}return!0},t.node_listOfElementsWithQualifiedName=function(e,t){return"*"===e?s.create_htmlCollection(t):"html"===t._nodeDocument._type?s.create_htmlCollection(t,function(t){return t._namespace===a.namespace.HTML&&t._qualifiedName===e.toLowerCase()||t._namespace!==a.namespace.HTML&&t._qualifiedName===e}):s.create_htmlCollection(t,function(t){return t._qualifiedName===e})},t.node_listOfElementsWithNamespace=function(e,t,n){return""===e&&(e=null),"*"===e&&"*"===t?s.create_htmlCollection(n):"*"===e?s.create_htmlCollection(n,function(e){return e._localName===t}):"*"===t?s.create_htmlCollection(n,function(t){return t._namespace===e}):s.create_htmlCollection(n,function(n){return n._localName===t&&n._namespace===e})},t.node_listOfElementsWithClassNames=function(e,t){var n=l.orderedSet_parse(e);if(0===n.size)return s.create_htmlCollection(t,function(){return!1});var i="quirks"!==t._nodeDocument._mode;return s.create_htmlCollection(t,function(e){var t=e.classList;return l.orderedSet_contains(t._tokenSet,n,i)})},t.node_locateANamespacePrefix=function e(t,n){if(t._namespace===n&&null!==t._namespacePrefix)return t._namespacePrefix;for(var i=0;i<t._attributeList.length;i++){var r=t._attributeList[i];if("xmlns"===r._namespacePrefix&&r._value===n)return r._localName}return t._parent&&o.Guard.isElementNode(t._parent)?e(t._parent,n):null},t.node_locateANamespace=function e(t,n){if(o.Guard.isElementNode(t)){if(null!==t._namespace&&t._namespacePrefix===n)return t._namespace;for(var i=0;i<t._attributeList.length;i++){var r=t._attributeList[i];if(r._namespace===a.namespace.XMLNS&&"xmlns"===r._namespacePrefix&&r._localName===n)return r._value||null;if(null===n&&r._namespace===a.namespace.XMLNS&&null===r._namespacePrefix&&"xmlns"===r._localName)return r._value||null}return null===t.parentElement?null:e(t.parentElement,n)}return o.Guard.isDocumentNode(t)?null===t.documentElement?null:e(t.documentElement,n):o.Guard.isDocumentTypeNode(t)||o.Guard.isDocumentFragmentNode(t)?null:o.Guard.isAttrNode(t)?null===t._element?null:e(t._element,n):t._parent&&o.Guard.isElementNode(t._parent)?e(t._parent,n):null}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(3),a=n(9),s=n(29),l=n(17),c=n(107),u=n(37);t.text_contiguousTextNodes=function(e,t){var n;return void 0===t&&(t=!1),(n={})[Symbol.iterator]=function(){for(var n=e;n&&o.Guard.isTextNode(n._previousSibling);)n=n._previousSibling;return{next:function(){if(n&&!t&&n===e&&(n=o.Guard.isTextNode(n._nextSibling)?n._nextSibling:null),null===n)return{done:!0,value:null};var i={done:!1,value:n};return n=o.Guard.isTextNode(n._nextSibling)?n._nextSibling:null,i}}},n},t.text_contiguousExclusiveTextNodes=function(e,t){var n;return void 0===t&&(t=!1),(n={})[Symbol.iterator]=function(){for(var n=e;n&&o.Guard.isExclusiveTextNode(n._previousSibling);)n=n._previousSibling;return{next:function(){if(n&&!t&&n===e&&(n=o.Guard.isExclusiveTextNode(n._nextSibling)?n._nextSibling:null),null===n)return{done:!0,value:null};var i={done:!1,value:n};return n=o.Guard.isExclusiveTextNode(n._nextSibling)?n._nextSibling:null,i}}},n},t.text_descendantTextContent=function(e){for(var t="",n=l.tree_getFirstDescendantNode(e,!1,!1,function(e){return o.Guard.isTextNode(e)});null!==n;)t+=n._data,n=l.tree_getNextDescendantNode(e,n,!1,!1,function(e){return o.Guard.isTextNode(e)});return t},t.text_split=function(e,t){var n,o,d=e._data.length;if(t>d)throw new a.IndexSizeError;var h=d-t,p=c.characterData_substringData(e,t,h),f=s.create_text(e._nodeDocument,p),m=e._parent;if(null!==m){u.mutation_insert(f,m,e._nextSibling);try{for(var g=i(r.dom.rangeList),v=g.next();!v.done;v=g.next()){var y=v.value;y._start[0]===e&&y._start[1]>t&&(y._start[0]=f,y._start[1]-=t),y._end[0]===e&&y._end[1]>t&&(y._end[0]=f,y._end[1]-=t);var _=l.tree_index(e);y._start[0]===m&&y._start[1]===_+1&&y._start[1]++,y._end[0]===m&&y._end[1]===_+1&&y._end[1]++}}catch(e){n={error:e}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}}return c.characterData_replaceData(e,t,h,""),f}},function(e,t,n){"use strict";var i=n(4),r=n(41),o=n(24),a=n(48),s=[].join,l=r!=Object,c=a("join",",");i({target:"Array",proto:!0,forced:l||!c},{join:function(e){return s.call(o(this),void 0===e?",":e)}})},function(e,t,n){var i=n(4),r=n(83),o=String.fromCharCode,a=String.fromCodePoint;i({target:"String",stat:!0,forced:!!a&&1!=a.length},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,a=0;i>a;){if(t=+arguments[a++],r(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var r=n(111),o=function(){function e(e,t){this._options={skipWhitespaceOnlyText:!1},this.err={line:-1,col:-1,index:-1,str:""},this._str=e,this._index=0,this._length=e.length,t&&(this._options.skipWhitespaceOnlyText=t.skipWhitespaceOnlyText||!1)}return e.prototype.nextToken=function(){if(this.eof())return{type:r.TokenType.EOF};var t=this.skipIfStartsWith("<")?this.openBracket():this.text();return this._options.skipWhitespaceOnlyText&&t.type===r.TokenType.Text&&e.isWhiteSpaceToken(t)&&(t=this.nextToken()),t},e.prototype.openBracket=function(){return this.skipIfStartsWith("?")?this.skipIfStartsWith("xml")?e.isSpace(this._str[this._index])?this.declaration():(this.seek(-3),this.pi()):this.pi():this.skipIfStartsWith("!")?this.skipIfStartsWith("--")?this.comment():this.skipIfStartsWith("[CDATA[")?this.cdata():this.skipIfStartsWith("DOCTYPE")?this.doctype():void this.throwError("Invalid '!' in opening tag."):this.skipIfStartsWith("/")?this.closeTag():this.openTag()},e.prototype.declaration=function(){for(var e="",t="",n="";!this.eof();){if(this.skipSpace(),this.skipIfStartsWith("?>"))return{type:r.TokenType.Declaration,version:e,encoding:t,standalone:n};var o=i(this.attribute(),2),a=o[0],s=o[1];"version"===a?e=s:"encoding"===a?t=s:"standalone"===a?n=s:this.throwError("Invalid attribute name: "+a)}this.throwError("Missing declaration end symbol `?>`")},e.prototype.doctype=function(){var e="",t="";this.skipSpace();var n=this.takeUntil2("[",">",!0);return this.skipSpace(),this.skipIfStartsWith("PUBLIC")?(e=this.quotedString(),t=this.quotedString()):this.skipIfStartsWith("SYSTEM")&&(t=this.quotedString()),this.skipSpace(),this.skipIfStartsWith("[")&&(this.skipUntil("]"),this.skipIfStartsWith("]")||this.throwError("Missing end bracket of DTD internal subset")),this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing doctype end symbol `>`"),{type:r.TokenType.DocType,name:n,pubId:e,sysId:t}},e.prototype.pi=function(){var e=this.takeUntilStartsWith("?>",!0);if(this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.skipSpace(),this.skipIfStartsWith("?>"))return{type:r.TokenType.PI,target:e,data:""};var t=this.takeUntilStartsWith("?>");return this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.seek(2),{type:r.TokenType.PI,target:e,data:t}},e.prototype.text=function(){var e=this.takeUntil("<");return{type:r.TokenType.Text,data:e}},e.prototype.comment=function(){var e=this.takeUntilStartsWith("--\x3e");return this.eof()&&this.throwError("Missing comment end symbol `--\x3e`"),this.seek(3),{type:r.TokenType.Comment,data:e}},e.prototype.cdata=function(){var e=this.takeUntilStartsWith("]]>");return this.eof()&&this.throwError("Missing CDATA end symbol `]>`"),this.seek(3),{type:r.TokenType.CDATA,data:e}},e.prototype.openTag=function(){this.skipSpace();var e=this.takeUntil2(">","/",!0);if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:r.TokenType.Element,name:e,attributes:[],selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:r.TokenType.Element,name:e,attributes:[],selfClosing:!0};for(var t=[];!this.eof();){if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:r.TokenType.Element,name:e,attributes:t,selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:r.TokenType.Element,name:e,attributes:t,selfClosing:!0};var n=this.attribute();t.push(n)}this.throwError("Missing opening element tag end symbol `>`")},e.prototype.closeTag=function(){this.skipSpace();var e=this.takeUntil(">",!0);return this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing closing element tag end symbol `>`"),{type:r.TokenType.ClosingTag,name:e}},e.prototype.attribute=function(){this.skipSpace();var e=this.takeUntil("=",!0);return this.skipSpace(),this.skipIfStartsWith("=")||this.throwError("Missing equals sign before attribute value"),[e,this.quotedString()]},e.prototype.quotedString=function(){this.skipSpace();var t=this.take(1);e.isQuote(t)||this.throwError("Missing start quote character before quoted value");var n=this.takeUntil(t);return this.skipIfStartsWith(t)||this.throwError("Missing end quote character after quoted value"),n},e.prototype.eof=function(){return this._index>=this._length},e.prototype.skipIfStartsWith=function(e){var t=e.length;if(1===t)return this._str[this._index]===e&&(this._index++,!0);for(var n=0;n<t;n++)if(this._str[this._index+n]!==e[n])return!1;return this._index+=t,!0},e.prototype.seek=function(e){this._index+=e,this._index<0&&(this._index=0),this._index>this._length&&(this._index=this._length)},e.prototype.skipSpace=function(){for(;!this.eof()&&e.isSpace(this._str[this._index]);)this._index++},e.prototype.take=function(e){if(1===e)return this._str[this._index++];var t=this._index;return this.seek(e),this._str.slice(t,this._index)},e.prototype.takeUntil=function(t,n){void 0===n&&(n=!1);for(var i=this._index;this._index<this._length;){var r=this._str[this._index];if(r===t||n&&e.isSpace(r))break;this._index++}return this._str.slice(i,this._index)},e.prototype.takeUntil2=function(t,n,i){void 0===i&&(i=!1);for(var r=this._index;this._index<this._length;){var o=this._str[this._index];if(o===t||o===n||i&&e.isSpace(o))break;this._index++}return this._str.slice(r,this._index)},e.prototype.takeUntilStartsWith=function(t,n){void 0===n&&(n=!1);for(var i=this._index,r=t.length;this._index<this._length;){for(var o=!0,a=0;a<r;a++){var s=this._str[this._index+a],l=t[a];if(n&&e.isSpace(s))return this._str.slice(i,this._index);if(s!==l){this._index++,o=!1;break}}if(o)return this._str.slice(i,this._index)}return this._index=this._length,this._str.slice(i)},e.prototype.skipUntil=function(e){for(;this._index<this._length&&this._str[this._index]!==e;)this._index++},e.isWhiteSpaceToken=function(e){for(var t=e.data,n=0;n<t.length;n++){var i=t[n];if(" "!==i&&"\n"!==i&&"\r"!==i&&"\t"!==i&&"\f"!==i)return!1}return!0},e.isSpace=function(e){return" "===e||"\n"===e||"\r"===e||"\t"===e},e.isQuote=function(e){return'"'===e||"'"===e},e.prototype.throwError=function(e){for(var t=/\r\n|\r|\n/g,n=null,i=0,r=0,o=this._str.length;null!==(n=t.exec(this._str))&&null!==n;)if(i++,n.index<this._index&&(r=t.lastIndex),n.index>this._index){o=n.index;break}throw this.err={line:i,col:this._index-r,index:this._index,str:this._str.substring(r,o)},new Error(e+"\nIndex: "+this.err.index+"\nLn: "+this.err.line+", Col: "+this.err.col+"\nInput: "+this.err.str)},e.prototype[Symbol.iterator]=function(){return this._index=0,{next:function(){var e=this.nextToken();return e.type===r.TokenType.EOF?{done:!0,value:null}:{done:!1,value:e}}.bind(this)}},e}();t.XMLStringLexer=o},function(e,t,n){"use strict";var i=n(39);e.exports=new i({include:[n(182)]})},function(e,t,n){"use strict";var i=n(39);e.exports=new i({include:[n(113)],implicit:[n(289),n(290),n(291),n(292)]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(91),r=n(1),o=n(3),a=n(77),s=n(109);function l(e,t){var n=u(void 0===e||c(e)?e:i.DefaultBuilderOptions),r=c(e)?t:e,o=s.createDocument();d(o,n);var l=new a.XMLBuilderImpl(o);return void 0!==r&&l.ele(r),l}function c(e){if(!r.isPlainObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t)&&!i.XMLBuilderOptionKeys.has(t))return!1;return!0}function u(e){void 0===e&&(e={});var t=r.applyDefaults(e,i.DefaultBuilderOptions);if(0===t.convert.att.length||0===t.convert.ins.length||0===t.convert.text.length||0===t.convert.cdata.length||0===t.convert.comment.length)throw new Error("JS object converter strings cannot be zero length.");return t}function d(e,t,n){var i=e;i._xmlBuilderOptions=t,i._isFragment=n}t.builder=function(e,t){var n=u(c(e)?e:i.DefaultBuilderOptions),s=o.Guard.isNode(e)||r.isArray(e)?e:t;if(void 0===s)throw new Error("Invalid arguments.");if(r.isArray(s)){for(var l=[],d=0;d<s.length;d++){var h=new a.XMLBuilderImpl(s[d]);h.set(n),l.push(h)}return l}var p=new a.XMLBuilderImpl(s);return p.set(n),p},t.create=l,t.fragment=function(e,t){var n=u(void 0===e||c(e)?e:i.DefaultBuilderOptions),r=c(e)?t:e,o=s.createDocument();d(o,n,!0);var l=new a.XMLBuilderImpl(o.createDocumentFragment());return void 0!==r&&l.ele(r),l},t.convert=function(e,t,n){var r,o,a;return c(e)&&void 0!==t?(r=e,o=t,a=n):(r=i.DefaultBuilderOptions,o=e,a=t||void 0),l(r,o).end(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(77);t.builder=i.builder,t.create=i.create,t.fragment=i.fragment,t.convert=i.convert,t.createCB=i.createCB,t.fragmentCB=i.fragmentCB},function(e,t,n){"use strict";n(31),n(32),n(33),n(191),n(192),n(194),n(64),n(19),n(198),n(199),n(89),n(201),n(65),n(20),n(66),n(22),n(23);var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(91),a=n(1),s=n(217),l=n(2),c=n(3),u=n(0),d=n(109),h=n(7),p=n(276),f=function(){function e(e){this._domNode=e}return Object.defineProperty(e.prototype,"node",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),e.prototype.set=function(e){return this._options=a.applyDefaults(a.applyDefaults(this._options,e,!0),o.DefaultBuilderOptions),this},e.prototype.ele=function(t,n,r){var o,s,l,c,h,f;if(a.isObject(t))return new p.ObjectReader(this._options).parse(this,t);if(null!==t&&/^\s*</.test(t))return new p.XMLReader(this._options).parse(this,t);if(null!==t&&/^\s*[\{\[]/.test(t))return new p.JSONReader(this._options).parse(this,t);if(null!==t&&/^(\s*|(#.*)|(%.*))*---/.test(t))return new p.YAMLReader(this._options).parse(this,t);if((null===t||a.isString(t))&&a.isString(n))c=(o=i([t,n,r],3))[0],h=o[1],f=o[2];else{if(null===t)throw new Error("Element name cannot be null. "+this._debugInfo());c=(s=i([void 0,t,a.isObject(n)?n:void 0],3))[0],h=s[1],f=s[2]}if(f&&(f=a.getValue(f)),c=(l=i(this._extractNamespace(d.sanitizeInput(c,this._options.invalidCharReplacement),d.sanitizeInput(h,this._options.invalidCharReplacement),!0),2))[0],h=l[1],void 0===c){var m=i(u.namespace_extractQName(h),1)[0];c=this.node.lookupNamespaceURI(m)}var g=null!=c?this._doc.createElementNS(c,h):this._doc.createElement(h);this.node.appendChild(g);var v=new e(g),y=this._doc.doctype;if(g===this._doc.documentElement&&null!==y){var _=this._doc.implementation.createDocumentType(this._doc.documentElement.tagName,y.publicId,y.systemId);this._doc.replaceChild(_,y)}return f&&!a.isEmpty(f)&&v.att(f),v},e.prototype.remove=function(){var e=this.up();return e.node.removeChild(this.node),e},e.prototype.att=function(e,t,n){var r,o,s,l,p,f,m=this;if(a.isMap(e)||a.isObject(e))return a.forEachObject(e,function(e,t){return m.att(e,t)},this),this;if(null!=e&&(e=a.getValue(e+"")),null!=t&&(t=a.getValue(t+"")),null!=n&&(n=a.getValue(n+"")),null!==e&&!a.isString(e)||!a.isString(t)||null!==n&&!a.isString(n)){if(!a.isString(e)||null!=t&&!a.isString(t))throw new Error("Attribute name and value not specified. "+this._debugInfo());l=(o=i([void 0,e,t],3))[0],p=o[1],f=o[2]}else l=(r=i([e,t,n],3))[0],p=r[1],f=r[2];if(this._options.keepNullAttributes&&null==f)f="";else if(null==f)return this;if(!c.Guard.isElementNode(this.node))throw new Error("An attribute can only be assigned to an element node.");var g=this.node;l=(s=i(this._extractNamespace(l,p,!1),2))[0],p=s[1],p=d.sanitizeInput(p,this._options.invalidCharReplacement),l=d.sanitizeInput(l,this._options.invalidCharReplacement),f=d.sanitizeInput(f,this._options.invalidCharReplacement);var v=i(u.namespace_extractQName(p),2),y=v[0],_=v[1],w=i(u.namespace_extractQName(g.prefix?g.prefix+":"+g.localName:g.localName),1)[0],E=null;return"xmlns"===y?(l=h.namespace.XMLNS,null===g.namespaceURI&&w===_&&(E=f)):null===y&&"xmlns"===_&&null===w&&(l=h.namespace.XMLNS,E=f),null!==E&&(this._updateNamespace(E),g=this.node),void 0!==l?g.setAttributeNS(l,p,f):g.setAttribute(p,f),this},e.prototype.removeAtt=function(e,t){var n,i,r=this;if(!c.Guard.isElementNode(this.node))throw new Error("An attribute can only be removed from an element node.");if(e=a.getValue(e),void 0!==t&&(t=a.getValue(t)),null!==e&&void 0===t)i=e;else{if(null!==e&&!a.isString(e)||void 0===t)throw new Error("Attribute namespace must be a string. "+this._debugInfo());n=e,i=t}return a.isArray(i)||a.isSet(i)?a.forEachArray(i,function(e){return void 0===n?r.removeAtt(e):r.removeAtt(n,e)},this):void 0!==n?(i=d.sanitizeInput(i,this._options.invalidCharReplacement),n=d.sanitizeInput(n,this._options.invalidCharReplacement),this.node.removeAttributeNS(n,i)):(i=d.sanitizeInput(i,this._options.invalidCharReplacement),this.node.removeAttribute(i)),this},e.prototype.txt=function(e){if(null==e){if(!this._options.keepNullNodes)return this;e=""}var t=this._doc.createTextNode(d.sanitizeInput(e,this._options.invalidCharReplacement));return this.node.appendChild(t),this},e.prototype.com=function(e){if(null==e){if(!this._options.keepNullNodes)return this;e=""}var t=this._doc.createComment(d.sanitizeInput(e,this._options.invalidCharReplacement));return this.node.appendChild(t),this},e.prototype.dat=function(e){if(null==e){if(!this._options.keepNullNodes)return this;e=""}var t=this._doc.createCDATASection(d.sanitizeInput(e,this._options.invalidCharReplacement));return this.node.appendChild(t),this},e.prototype.ins=function(e,t){var n=this;if(void 0===t&&(t=""),null==t){if(!this._options.keepNullNodes)return this;t=""}if(a.isArray(e)||a.isSet(e))a.forEachArray(e,function(e){var t=(e+="").indexOf(" "),i=-1===t?e:e.substr(0,t),r=-1===t?"":e.substr(t+1);n.ins(i,r)},this);else if(a.isMap(e)||a.isObject(e))a.forEachObject(e,function(e,t){return n.ins(e,t)},this);else{var i=this._doc.createProcessingInstruction(d.sanitizeInput(e,this._options.invalidCharReplacement),d.sanitizeInput(t,this._options.invalidCharReplacement));this.node.appendChild(i)}return this},e.prototype.dec=function(e){return this._options.version=e.version||"1.0",this._options.encoding=e.encoding,this._options.standalone=e.standalone,this},e.prototype.dtd=function(e){var t=d.sanitizeInput(e&&e.name||(this._doc.documentElement?this._doc.documentElement.tagName:"ROOT"),this._options.invalidCharReplacement),n=d.sanitizeInput(e&&e.pubID||"",this._options.invalidCharReplacement),i=d.sanitizeInput(e&&e.sysID||"",this._options.invalidCharReplacement);if(null!==this._doc.documentElement&&t!==this._doc.documentElement.tagName)throw new Error("DocType name does not match document element name.");var r=this._doc.implementation.createDocumentType(t,n,i);return null!==this._doc.doctype?this._doc.replaceChild(r,this._doc.doctype):this._doc.insertBefore(r,this._doc.documentElement),this},e.prototype.import=function(t){var n,o,a=this._domNode,s=this._doc,l=t.node;if(c.Guard.isDocumentNode(l)){var d=l.documentElement;if(null===d)throw new Error("Imported document has no document element node. "+this._debugInfo());var h=s.importNode(d,!0);a.appendChild(h);var p=i(u.namespace_extractQName(h.prefix?h.prefix+":"+h.localName:h.localName),1)[0],f=a.lookupNamespaceURI(p);new e(h)._updateNamespace(f)}else if(c.Guard.isDocumentFragmentNode(l))try{for(var m=r(l.childNodes),g=m.next();!g.done;g=m.next()){var v=g.value;h=s.importNode(v,!0),a.appendChild(h),c.Guard.isElementNode(h)&&(p=i(u.namespace_extractQName(h.prefix?h.prefix+":"+h.localName:h.localName),1)[0],f=a.lookupNamespaceURI(p),new e(h)._updateNamespace(f))}}catch(e){n={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(n)throw n.error}}else h=s.importNode(l,!0),a.appendChild(h),c.Guard.isElementNode(h)&&(p=i(u.namespace_extractQName(h.prefix?h.prefix+":"+h.localName:h.localName),1)[0],f=a.lookupNamespaceURI(p),new e(h)._updateNamespace(f));return this},e.prototype.doc=function(){if(this._doc._isFragment){for(var t=this.node;t&&t.nodeType!==l.NodeType.DocumentFragment;)t=t.parentNode;if(null===t)throw new Error("Node has no parent node while searching for document fragment ancestor. "+this._debugInfo());return new e(t)}return new e(this._doc)},e.prototype.root=function(){var t=this._doc.documentElement;if(!t)throw new Error("Document root element is null. "+this._debugInfo());return new e(t)},e.prototype.up=function(){var t=this._domNode.parentNode;if(!t)throw new Error("Parent node is null. "+this._debugInfo());return new e(t)},e.prototype.prev=function(){var t=this._domNode.previousSibling;if(!t)throw new Error("Previous sibling node is null. "+this._debugInfo());return new e(t)},e.prototype.next=function(){var t=this._domNode.nextSibling;if(!t)throw new Error("Next sibling node is null. "+this._debugInfo());return new e(t)},e.prototype.first=function(){var t=this._domNode.firstChild;if(!t)throw new Error("First child node is null. "+this._debugInfo());return new e(t)},e.prototype.last=function(){var t=this._domNode.lastChild;if(!t)throw new Error("Last child node is null. "+this._debugInfo());return new e(t)},e.prototype.each=function(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,i);o[0];){var a=this._getNextDescendantNode(this._domNode,o[0],i,o[1],o[2]);t.call(r,new e(o[0]),o[1],o[2]),o=a}return this},e.prototype.map=function(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=[];return this.each(function(t,n,o){return r.push(e.call(i,t,n,o))},t,n),r},e.prototype.reduce=function(e,t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1);var o=t;return this.each(function(t,n,i){return o=e.call(r,o,t,n,i)},n,i),o},e.prototype.find=function(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,i);o[0];){var a=new e(o[0]);if(t.call(r,a,o[1],o[2]))return a;o=this._getNextDescendantNode(this._domNode,o[0],i,o[1],o[2])}},e.prototype.filter=function(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=[];return this.each(function(t,n,o){e.call(i,t,n,o)&&r.push(t)},t,n),r},e.prototype.every=function(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,i);o[0];){var a=new e(o[0]);if(!t.call(r,a,o[1],o[2]))return!1;o=this._getNextDescendantNode(this._domNode,o[0],i,o[1],o[2])}return!0},e.prototype.some=function(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,i);o[0];){var a=new e(o[0]);if(t.call(r,a,o[1],o[2]))return!0;o=this._getNextDescendantNode(this._domNode,o[0],i,o[1],o[2])}return!1},e.prototype.toArray=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=[];return this.each(function(e){return n.push(e)},e,t),n},e.prototype.toString=function(e){return void 0===(e=e||{}).format&&(e.format="xml"),this._serialize(e)},e.prototype.toObject=function(e){return void 0===(e=e||{}).format&&(e.format="object"),this._serialize(e)},e.prototype.end=function(e){return void 0===(e=e||{}).format&&(e.format="xml"),this.doc()._serialize(e)},e.prototype._getFirstDescendantNode=function(e,t,n){return t?[this._domNode,0,0]:n?this._getNextDescendantNode(e,e,n,0,0):[this._domNode.firstChild,0,1]},e.prototype._getNextDescendantNode=function(e,t,n,i,r){if(!n)return e===t?[t.firstChild,0,r+1]:[t.nextSibling,i+1,r];if(t.firstChild)return[t.firstChild,0,r+1];if(t===e)return[null,-1,-1];if(t.nextSibling)return[t.nextSibling,i+1,r];for(var o=t.parentNode;o&&o!==e;){if(o.nextSibling)return[o.nextSibling,u.tree_index(o.nextSibling),r-1];o=o.parentNode,r--}return[null,-1,-1]},e.prototype._serialize=function(e){if("xml"===e.format)return new s.XMLWriter(this._options,e).serialize(this.node);if("map"===e.format)return new s.MapWriter(this._options,e).serialize(this.node);if("object"===e.format)return new s.ObjectWriter(this._options,e).serialize(this.node);if("json"===e.format)return new s.JSONWriter(this._options,e).serialize(this.node);if("yaml"===e.format)return new s.YAMLWriter(this._options,e).serialize(this.node);throw new Error("Invalid writer format: "+e.format+". "+this._debugInfo())},e.prototype._extractNamespace=function(e,t,n){var i=t.indexOf("@");if(i>0&&(void 0===e&&(e=t.slice(i+1)),t=t.slice(0,i)),void 0===e)e=n?this._options.defaultNamespace.ele:this._options.defaultNamespace.att;else if(null!==e&&"@"===e[0]){var r=e.slice(1);if(void 0===(e=this._options.namespaceAlias[r]))throw new Error("Namespace alias `"+r+"` is not defined. "+this._debugInfo())}return[e,t]},e.prototype._updateNamespace=function(t){var n,o,a,s,l=this._domNode;if(c.Guard.isElementNode(l)&&null!==t&&l.namespaceURI!==t){var d=i(u.namespace_extractQName(l.prefix?l.prefix+":"+l.localName:l.localName),2),h=d[0],p=d[1],f=u.create_element(this._doc,p,t,h);try{for(var m=r(l.attributes),g=m.next();!g.done;g=m.next()){var v=g.value,y=v.prefix?v.prefix+":"+v.localName:v.localName,_=i(u.namespace_extractQName(y),1)[0],w=v.namespaceURI;null===w&&null!==_&&(w=l.lookupNamespaceURI(_)),null===w?f.setAttribute(y,v.value):f.setAttributeNS(w,y,v.value)}}catch(e){n={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(n)throw n.error}}var E=l.parentNode;if(null===E)throw new Error("Parent node is null."+this._debugInfo());E.replaceChild(f,l),this._domNode=f;try{for(var b=r(l.childNodes),x=b.next();!x.done;x=b.next()){var C=x.value.cloneNode(!0);if(f.appendChild(C),c.Guard.isElementNode(C)){var I=i(u.namespace_extractQName(C.prefix?C.prefix+":"+C.localName:C.localName),1)[0],S=f.lookupNamespaceURI(I);new e(C)._updateNamespace(S)}}}catch(e){a={error:e}}finally{try{x&&!x.done&&(s=b.return)&&s.call(b)}finally{if(a)throw a.error}}}},Object.defineProperty(e.prototype,"_doc",{get:function(){var e=this.node;if(c.Guard.isDocumentNode(e))return e;var t=e.ownerDocument;if(!t)throw new Error("Owner document is null. "+this._debugInfo());return t},enumerable:!0,configurable:!0}),e.prototype._debugInfo=function(e){var t=this.node,n=t.parentNode;e=e||t.nodeName;var i=n?n.nodeName:"";return i?"node: <"+e+">, parent: <"+i+">":"node: <"+e+">"},Object.defineProperty(e.prototype,"_options",{get:function(){var e=this._doc;if(void 0===e._xmlBuilderOptions)throw new Error("Builder options is not set.");return e._xmlBuilderOptions},set:function(e){this._doc._xmlBuilderOptions=e},enumerable:!0,configurable:!0}),e}();t.XMLBuilderImpl=f},function(e,t,n){var i=n(11),r=n(117),o=i.WeakMap;e.exports="function"==typeof o&&/native code/.test(r(o))},function(e,t,n){var i=n(46),r=n(82),o=n(85),a=n(18);e.exports=i("Reflect","ownKeys")||function(e){var t=r.f(a(e)),n=o.f;return n?t.concat(n(e)):t}},function(e,t,n){var i=n(16),r=n(15),o=n(18),a=n(61);e.exports=i?Object.defineProperties:function(e,t){o(e);for(var n,i=a(t),s=i.length,l=0;s>l;)r.f(e,n=i[l++],t[n]);return e}},function(e,t,n){var i=n(46);e.exports=i("document","documentElement")},function(e,t,n){var i=n(24),r=n(82).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return r(e)}catch(e){return a.slice()}}(e):r(i(e))}},function(e,t,n){"use strict";var i=n(4),r=n(36).every,o=n(48),a=n(28),s=o("every"),l=a("every");i({target:"Array",proto:!0,forced:!s||!l},{every:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var i=n(4),r=n(36).filter,o=n(63),a=n(28),s=o("filter"),l=a("filter");i({target:"Array",proto:!0,forced:!s||!l},{filter:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var i=n(46);e.exports=i("navigator","userAgent")||""},function(e,t,n){"use strict";var i=n(4),r=n(36).find,o=n(130),a=n(28),s=!0,l=a("find");"find"in[]&&Array(1).find(function(){s=!1}),i({target:"Array",proto:!0,forced:s||!l},{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),o("find")},function(e,t,n){"use strict";var i=n(131).IteratorPrototype,r=n(60),o=n(40),a=n(62),s=n(49),l=function(){return this};e.exports=function(e,t,n){var c=t+" Iterator";return e.prototype=r(i,{next:o(1,n)}),a(e,c,!1,!0),s[c]=l,e}},function(e,t,n){var i=n(8);e.exports=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},function(e,t,n){var i=n(13);e.exports=function(e){if(!i(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){"use strict";var i=n(4),r=n(36).map,o=n(63),a=n(28),s=o("map"),l=a("map");i({target:"Array",proto:!0,forced:!s||!l},{map:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var i=n(4),r=n(200).left,o=n(48),a=n(28),s=o("reduce"),l=a("reduce",{1:0});i({target:"Array",proto:!0,forced:!s||!l},{reduce:function(e){return r(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var i=n(127),r=n(27),o=n(41),a=n(26),s=function(e){return function(t,n,s,l){i(n);var c=r(t),u=o(c),d=a(c.length),h=e?d-1:0,p=e?-1:1;if(s<2)for(;;){if(h in u){l=u[h],h+=p;break}if(h+=p,e?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:d>h;h+=p)h in u&&(l=n(l,u[h],h,c));return l}};e.exports={left:s(!1),right:s(!0)}},function(e,t,n){"use strict";var i=n(4),r=n(36).some,o=n(48),a=n(28),s=o("some"),l=a("some");i({target:"Array",proto:!0,forced:!s||!l},{some:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var i=n(90),r=n(135);e.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){var i=n(8);e.exports=!i(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(e,t,n){var i=n(5),r=n(49),o=i("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[o]===e)}},function(e,t,n){var i=n(135),r=n(49),o=n(5)("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||r[i(e)]}},function(e,t,n){var i=n(18);e.exports=function(e,t,n,r){try{return r?t(i(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&i(o.call(e)),t}}},function(e,t,n){var i=n(5)("iterator"),r=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){r=!0}};a[i]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var o={};o[i]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(e){}return n}},function(e,t,n){var i=n(13),r=n(133);e.exports=function(e,t,n){var o,a;return r&&"function"==typeof(o=t.constructor)&&o!==n&&i(a=o.prototype)&&a!==n.prototype&&r(e,a),e}},function(e,t,n){var i=n(25);e.exports=function(e,t,n){for(var r in t)i(e,r,t[r],n);return e}},function(e,t,n){"use strict";var i=n(46),r=n(15),o=n(5),a=n(16),s=o("species");e.exports=function(e){var t=i(e),n=r.f;a&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var i=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e=1e3),this._items=new Set,this._limit=e}return e.prototype.add=function(e){if(this._items.add(e),this._items.size>this._limit){var t=this._items.values().next();t.done||this._items.delete(t.value)}return this},e.prototype.delete=function(e){return this._items.delete(e)},e.prototype.has=function(e){return this._items.has(e)},e.prototype.clear=function(){this._items.clear()},Object.defineProperty(e.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,t){var n=this;this._items.forEach(function(i){return e.call(t,i,i,n)})},e.prototype.keys=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items.keys())];case 1:return e.sent(),[2]}})},e.prototype.values=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items.values())];case 1:return e.sent(),[2]}})},e.prototype.entries=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items.entries())];case 1:return e.sent(),[2]}})},e.prototype[Symbol.iterator]=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items)];case 1:return e.sent(),[2]}})},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"FixedSizeSet"},enumerable:!0,configurable:!0}),e}();t.FixedSizeSet=o},function(e,t,n){"use strict";var i=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e=1e3),this._items=new Map,this._limit=e}return e.prototype.get=function(e){return this._items.get(e)},e.prototype.set=function(e,t){if(this._items.set(e,t),this._items.size>this._limit){var n=this._items.keys().next();n.done||this._items.delete(n.value)}},e.prototype.delete=function(e){return this._items.delete(e)},e.prototype.has=function(e){return this._items.has(e)},e.prototype.clear=function(){this._items.clear()},Object.defineProperty(e.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,t){this._items.forEach(function(n,i){return e.call(t,i,n)})},e.prototype.keys=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items.keys())];case 1:return e.sent(),[2]}})},e.prototype.values=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items.values())];case 1:return e.sent(),[2]}})},e.prototype.entries=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items.entries())];case 1:return e.sent(),[2]}})},e.prototype[Symbol.iterator]=function(){return i(this,function(e){switch(e.label){case 0:return[5,r(this._items)];case 1:return e.sent(),[2]}})},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"ObjectCache"},enumerable:!0,configurable:!0}),e}();t.ObjectCache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=1e3),this._items=new Map,this._limit=e}return e.prototype.check=function(e,t){if(this._items.get(e)===t)return!0;if(this._items.get(t)===e)return!1;var n=Math.random()<.5;if(n?this._items.set(e,t):this._items.set(t,e),this._items.size>this._limit){var i=this._items.keys().next();i.done||this._items.delete(i.value)}return n},e}();t.CompareCache=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._initialized=!1,this._value=void 0,this._initFunc=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._initialized||(this._value=this._initFunc(),this._initialized=!0),this._value},enumerable:!0,configurable:!0}),e}();t.Lazy=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._pointer=0,this._chars=Array.from(e),this._length=this._chars.length}return Object.defineProperty(e.prototype,"eof",{get:function(){return this._pointer>=this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.codePoint=function(){if(void 0===this._codePoint)if(this.eof)this._codePoint=-1;else{var e=this._chars[this._pointer].codePointAt(0);this._codePoint=void 0!==e?e:-1}return this._codePoint},e.prototype.c=function(){return void 0===this._c&&(this._c=this.eof?"":this._chars[this._pointer]),this._c},e.prototype.remaining=function(){return void 0===this._remaining&&(this._remaining=this.eof?"":this._chars.slice(this._pointer+1).join("")),this._remaining},e.prototype.substring=function(){return void 0===this._substring&&(this._substring=this.eof?"":this._chars.slice(this._pointer).join("")),this._substring},Object.defineProperty(e.prototype,"pointer",{get:function(){return this._pointer},set:function(e){e!==this._pointer&&(this._pointer=e,this._codePoint=void 0,this._c=void 0,this._remaining=void 0,this._substring=void 0)},enumerable:!0,configurable:!0}),e}();t.StringWalker=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(218);t.MapWriter=i.MapWriter;var r=n(258);t.XMLWriter=r.XMLWriter;var o=n(67);t.ObjectWriter=o.ObjectWriter;var a=n(260);t.JSONWriter=a.JSONWriter;var s=n(261);t.YAMLWriter=s.YAMLWriter},function(e,t,n){"use strict";n(19),n(219),n(20),n(22),n(23);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(67),s=function(e){function t(t,n){var i=e.call(this,t)||this;return i._writerOptions=o.applyDefaults(n,{format:"map",wellFormed:!1,group:!1,verbose:!1}),i}return r(t,e),t.prototype.serialize=function(e){var t=o.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1,verbose:!1}),n=new a.ObjectWriter(this._builderOptions,t).serialize(e);return this._convertObject(n)},t.prototype._convertObject=function(e){if(o.isArray(e)){for(var t=0;t<e.length;t++)e[t]=this._convertObject(e[t]);return e}if(o.isObject(e)){var n=new Map;for(var i in e)n.set(i,this._convertObject(e[i]));return n}return e},t}(n(50).BaseWriter);t.MapWriter=s},function(e,t,n){"use strict";var i=n(139),r=n(143);e.exports=i("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},r)},function(e,t,n){"use strict";var i=n(4),r=n(8),o=n(59),a=n(13),s=n(27),l=n(26),c=n(134),u=n(128),d=n(63),h=n(5),p=n(129),f=h("isConcatSpreadable"),m=p>=51||!r(function(){var e=[];return e[f]=!1,e.concat()[0]!==e}),g=d("concat"),v=function(e){if(!a(e))return!1;var t=e[f];return void 0!==t?!!t:o(e)};i({target:"Array",proto:!0,forced:!m||!g},{concat:function(e){var t,n,i,r,o,a=s(this),d=u(a,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(v(o=-1===t?a:arguments[t])){if(h+(r=l(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<r;n++,h++)n in o&&c(d,h,o[n])}else{if(h>=9007199254740991)throw TypeError("Maximum allowed index exceeded");c(d,h++,o)}return d.length=h,d}})},function(e,t,n){"use strict";var i=n(8);function r(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=i(function(){var e=r("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),t.BROKEN_CARET=i(function(){var e=r("^r","gy");return e.lastIndex=2,null!=e.exec("str")})},function(e,t,n){var i=n(223);e.exports=function(e){if(i(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,n){var i=n(13),r=n(42),o=n(5)("match");e.exports=function(e){var t;return i(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==r(e))}},function(e,t,n){var i=n(5)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[i]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,n){"use strict";n(68);var i=n(25),r=n(8),o=n(5),a=n(93),s=n(21),l=o("species"),c=!r(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),u="$0"==="a".replace(/./,"$0"),d=o("replace"),h=!!/./[d]&&""===/./[d]("a","$0"),p=!r(function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]});e.exports=function(e,t,n,d){var f=o(e),m=!r(function(){var t={};return t[f]=function(){return 7},7!=""[e](t)}),g=m&&!r(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[l]=function(){return n},n.flags="",n[f]=/./[f]),n.exec=function(){return t=!0,null},n[f](""),!t});if(!m||!g||"replace"===e&&(!c||!u||h)||"split"===e&&!p){var v=/./[f],y=n(f,""[e],function(e,t,n,i,r){return t.exec===a?m&&!r?{done:!0,value:v.call(t,n,i)}:{done:!0,value:e.call(n,t,i)}:{done:!1}},{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:h}),_=y[0],w=y[1];i(String.prototype,e,_),i(RegExp.prototype,f,2==t?function(e,t){return w.call(e,this,t)}:function(e){return w.call(e,this)})}d&&s(RegExp.prototype[f],"sham",!0)}},function(e,t,n){"use strict";var i=n(137).charAt;e.exports=function(e,t,n){return t+(n?i(e,t).length:1)}},function(e,t,n){var i=n(42),r=n(93);e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==i(e))throw TypeError("RegExp#exec called on incompatible receiver");return r.call(e,t)}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(96);t.forgivingBase64Encode=function(t){return e.from(t).toString("base64")},t.forgivingBase64Decode=function(t){return""===t?"":((t=t.replace(i.ASCIIWhiteSpace,"")).length%4==0&&(t.endsWith("==")?t=t.substr(0,t.length-2):t.endsWith("=")&&(t=t.substr(0,t.length-1))),t.length%4==1?null:/[0-9A-Za-z+/]/.test(t)?e.from(t,"base64").toString("utf8"):null)}}).call(this,n(145).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=c(e),a=i[0],s=i[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),u=0,d=s>0?a-4:a;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[u++]=255&t),1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],a=0,s=n-r;a<s;a+=16383)o.push(u(e,a,a+16383>s?s:a+16383));return 1===r?(t=e[n-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),o.join("")};for(var i=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=a.length;s<l;++s)i[s]=a[s],r[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var r,o,a=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(i[(o=r)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?r-1:0,h=n?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+d],d+=h,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=i;u>0;a=256*a+e[t+d],d+=h,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=c}return(p?-1:1)*a*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var a,s,l,c=8*o-r-1,u=(1<<c)-1,d=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(a++,l/=2),a+d>=u?(s=0,a=u):a+d>=1?(s=(t*l-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;e[n+p]=255&a,p+=f,a/=256,c-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function o(e){var t,n;if(null===e||r.isString(e)||r.isNumber(e))return e;if(r.isArray(e)){var a=new Array;try{for(var s=i(e),l=s.next();!l.done;l=s.next()){var c=l.value;a.push(o(c))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}if(r.isObject(e)){for(var u in a=new Map,e)if(e.hasOwnProperty(u)){var d=e[u];a.set(u,o(d))}return a}return e}t.parseJSONFromBytes=function(e){var t=r.utf8Decode(e);return JSON.parse.call(void 0,t)},t.serializeJSONToBytes=function(e){var t=JSON.stringify.call(void 0,e);return r.utf8Encode(t)},t.parseJSONIntoInfraValues=function(e){return o(JSON.parse.call(void 0,e))},t.convertAJSONDerivedJavaScriptValueToAnInfraValue=o},function(e,t,n){"use strict";var i=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);t.append=function(e,t){e.push(t)},t.extend=function(e,t){e.push.apply(e,o(t))},t.prepend=function(e,t){e.unshift(t)},t.replace=function(e,t,n){var i,r,o=0;try{for(var l=a(e),c=l.next();!c.done;c=l.next()){var u=c.value;if(s.isFunction(t))t.call(null,u)&&(e[o]=n);else if(u===t)return void(e[o]=n);o++}}catch(e){i={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(i)throw i.error}}},t.insert=function(e,t,n){e.splice(n,0,t)},t.remove=function(e,t){for(var n=e.length;n--;){var i=e[n];if(s.isFunction(t))t.call(null,i)&&e.splice(n,1);else if(i===t)return void e.splice(n,1)}},t.empty=function(e){e.length=0},t.contains=function(e,t){var n,i;try{for(var r=a(e),o=r.next();!o.done;o=r.next()){var l=o.value;if(s.isFunction(t)){if(t.call(null,l))return!0}else if(l===t)return!0}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return!1},t.size=function(e,t){var n,i;if(void 0===t)return e.length;var r=0;try{for(var o=a(e),s=o.next();!s.done;s=o.next()){var l=s.value;t.call(null,l)&&r++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r},t.isEmpty=function(e){return 0===e.length},t.forEach=function(e,t){var n,r,o,s,l,c;return i(this,function(i){switch(i.label){case 0:return void 0!==t?[3,2]:[5,a(e)];case 1:return i.sent(),[3,9];case 2:i.trys.push([2,7,8,9]),n=a(e),r=n.next(),i.label=3;case 3:return r.done?[3,6]:(o=r.value,t.call(null,o)?[4,o]:[3,5]);case 4:i.sent(),i.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=i.sent(),l={error:s},[3,9];case 8:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 9:return[2]}})},t.clone=function(e){return new(Array.bind.apply(Array,o([void 0],e)))},t.sortInAscendingOrder=function(e,t){return e.sort(function(e,n){return t.call(null,e,n)?-1:1})},t.sortInDescendingOrder=function(e,t){return e.sort(function(e,n){return t.call(null,e,n)?1:-1})}},function(e,t,n){"use strict";var i=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);t.get=function(e,t){return e.get(t)},t.set=function(e,t,n){e.set(t,n)},t.remove=function(e,t){var n,i,o,a;if(s.isFunction(t)){var l=[];try{for(var c=r(e),u=c.next();!u.done;u=c.next()){var d=u.value;t.call(null,d)&&l.push(d[0])}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}try{for(var h=r(l),p=h.next();!p.done;p=h.next()){var f=p.value;e.delete(f)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}}else e.delete(t)},t.contains=function(e,t){var n,i;if(s.isFunction(t)){try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var l=a.value;if(t.call(null,l))return!0}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return!1}return e.has(t)},t.keys=function(e){return new Set(e.keys())},t.values=function(e){return a(e.values())},t.size=function(e,t){var n,i;if(void 0===t)return e.size;var o=0;try{for(var a=r(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.call(null,l)&&o++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},t.isEmpty=function(e){return 0===e.size},t.forEach=function(e,t){var n,o,a,s,l,c;return i(this,function(i){switch(i.label){case 0:return void 0!==t?[3,2]:[5,r(e)];case 1:return i.sent(),[3,9];case 2:i.trys.push([2,7,8,9]),n=r(e),o=n.next(),i.label=3;case 3:return o.done?[3,6]:(a=o.value,t.call(null,a)?[4,a]:[3,5]);case 4:i.sent(),i.label=5;case 5:return o=n.next(),[3,3];case 6:return[3,9];case 7:return s=i.sent(),l={error:s},[3,9];case 8:try{o&&!o.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 9:return[2]}})},t.clone=function(e){return new Map(e)},t.sortInAscendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?-1:1}),new Map(n)},t.sortInDescendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?1:-1}),new Map(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTML="http://www.w3.org/1999/xhtml",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/",t.MathML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLink="http://www.w3.org/1999/xlink"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enqueue=function(e,t){e.push(t)},t.dequeue=function(e){return e.shift()||null}},function(e,t,n){"use strict";var i=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);function l(e,t){var n,i;try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(!t.has(s))return!1}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return!0}t.append=function(e,t){e.add(t)},t.extend=function(e,t){t.forEach(e.add,e)},t.prepend=function(e,t){var n=new Set(e);e.clear(),e.add(t),n.forEach(e.add,e)},t.replace=function(e,t,n){var i,o,a=new Set;try{for(var l=r(e),c=l.next();!c.done;c=l.next()){var u=c.value;s.isFunction(t)?t.call(null,u)?a.add(n):a.add(u):u===t?a.add(n):a.add(u)}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}e.clear(),a.forEach(e.add,e)},t.insert=function(e,t,n){var i,o,a=new Set,s=0;try{for(var l=r(e),c=l.next();!c.done;c=l.next()){var u=c.value;s===n&&a.add(t),a.add(u),s++}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}e.clear(),a.forEach(e.add,e)},t.remove=function(e,t){var n,i,o,a;if(s.isFunction(t)){var l=[];try{for(var c=r(e),u=c.next();!u.done;u=c.next()){var d=u.value;t.call(null,d)&&l.push(d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}try{for(var h=r(l),p=h.next();!p.done;p=h.next()){var f=p.value;e.delete(f)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}}else e.delete(t)},t.empty=function(e){e.clear()},t.contains=function(e,t){var n,i;if(!s.isFunction(t))return e.has(t);try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var l=a.value;if(t.call(null,l))return!0}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return!1},t.size=function(e,t){var n,i;if(void 0===t)return e.size;var o=0;try{for(var a=r(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.call(null,l)&&o++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},t.isEmpty=function(e){return 0===e.size},t.forEach=function(e,t){var n,o,a,s,l,c;return i(this,function(i){switch(i.label){case 0:return void 0!==t?[3,2]:[5,r(e)];case 1:return i.sent(),[3,9];case 2:i.trys.push([2,7,8,9]),n=r(e),o=n.next(),i.label=3;case 3:return o.done?[3,6]:(a=o.value,t.call(null,a)?[4,a]:[3,5]);case 4:i.sent(),i.label=5;case 5:return o=n.next(),[3,3];case 6:return[3,9];case 7:return s=i.sent(),l={error:s},[3,9];case 8:try{o&&!o.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 9:return[2]}})},t.clone=function(e){return new Set(e)},t.sortInAscendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?-1:1}),new Set(n)},t.sortInDescendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?1:-1}),new Set(n)},t.isSubsetOf=l,t.isSupersetOf=function(e,t){return l(t,e)},t.intersection=function(e,t){var n,i,o=new Set;try{for(var a=r(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.has(l)&&o.add(l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},t.union=function(e,t){var n=new Set(e);return t.forEach(n.add,n),n},t.range=function(e,t){for(var n=new Set,i=e;i<=t;i++)n.add(i);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.push=function(e,t){e.push(t)},t.pop=function(e){return e.pop()||null}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(96),o=n(147),a=n(146),s=n(1);function l(e,t){for(var n=0;;){var i=n<e.length?e.charCodeAt(n):null,r=n<t.length?t.charCodeAt(n):null;if(null===i)return!0;if(i!==r)return!1;n++}}function c(e){var t,n,r=Array.from(e),o=new Uint8Array(r.length),a=0;try{for(var s=i(e),l=s.next();!l.done;l=s.next()){var c=l.value.codePointAt(0);console.assert(void 0!==c&&c<=255,"isomorphicEncode requires string bytes to be less than or equal to 0x00FF."),void 0!==c&&c<=255&&(o[a++]=c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o}function u(e){return/^[\u0000-\u007F]*$/.test(e)}function d(e){var t,n,r="";try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.codePointAt(0);r+=void 0!==l&&l>=65&&l<=90?String.fromCodePoint(l+32):s}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function h(e){return e.replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,"")}function p(e,t,n){if(!s.isArray(t))return p(e,Array.from(t),n);for(var i="";n.position<t.length&&e.call(null,t[n.position]);)i+=t[n.position],n.position++;return i}function f(e,t){p(function(e){return r.ASCIIWhiteSpace.test(e)},e,t)}t.isCodeUnitPrefix=l,t.isCodeUnitLessThan=function(e,t){if(l(t,e))return!1;if(l(e,t))return!0;for(var n=0;n<Math.min(e.length,t.length);n++){var i=e.charCodeAt(n),r=t.charCodeAt(n);if(i!==r)return i<r}return!1},t.isomorphicEncode=c,t.isASCIIString=u,t.asciiLowercase=d,t.asciiUppercase=function(e){var t,n,r="";try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.codePointAt(0);r+=void 0!==l&&l>=97&&l<=122?String.fromCodePoint(l-32):s}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},t.asciiCaseInsensitiveMatch=function(e,t){return d(e)===d(t)},t.asciiEncode=function(e){return console.assert(u(e),"asciiEncode requires an ASCII string."),c(e)},t.asciiDecode=function(e){var t,n;try{for(var r=i(e),s=r.next();!s.done;s=r.next()){var l=s.value;console.assert(a.isASCIIByte(l),"asciiDecode requires an ASCII byte sequence.")}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return o.isomorphicDecode(e)},t.stripNewlines=function(e){return e.replace(/[\n\r]/g,"")},t.normalizeNewlines=function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")},t.stripLeadingAndTrailingASCIIWhitespace=h,t.stripAndCollapseASCIIWhitespace=function(e){return h(e.replace(/[\t\n\f\r ]{2,}/g," "))},t.collectASequenceOfCodePoints=p,t.skipASCIIWhitespace=f,t.strictlySplit=function e(t,n){if(!s.isArray(t))return e(Array.from(t),n);var i={position:0},r=[],o=p(function(e){return n!==e},t,i);for(r.push(o);i.position<t.length;)console.assert(t[i.position]===n,"strictlySplit found no delimiter in input string."),i.position++,o=p(function(e){return n!==e},t,i),r.push(o);return r},t.splitAStringOnASCIIWhitespace=function e(t){if(!s.isArray(t))return e(Array.from(t));var n={position:0},i=[];for(f(t,n);n.position<t.length;){var o=p(function(e){return!r.ASCIIWhiteSpace.test(e)},t,n);i.push(o),f(t,n)}return i},t.splitAStringOnCommas=function e(t){if(!s.isArray(t))return e(Array.from(t));for(var n={position:0},i=[];n.position<t.length;){var r=p(function(e){return","!==e},t,n);i.push(h(r)),n.position<t.length&&(console.assert(","===t[n.position],"splitAStringOnCommas found no delimiter in input string."),n.position++)}return i},t.concatenate=function(e,t){return void 0===t&&(t=""),0===e.length?"":e.join(t)}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(97);t.abort_add=function(e,t){t._abortedFlag||t._abortAlgorithms.add(e)},t.abort_remove=function(e,t){t._abortAlgorithms.delete(e)},t.abort_signalAbort=function(e){var t,n;if(!e._abortedFlag){e._abortedFlag=!0;try{for(var o=i(e._abortAlgorithms),a=o.next();!a.done;a=o.next())a.value.call(e)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}e._abortAlgorithms.clear(),r.event_fireAnEvent("abort",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(150),r=function(){function e(){}return e.asNode=function(e){if(i.Guard.isNode(e))return e;throw new Error("Invalid object. Node expected.")},e}();t.Cast=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return Object.defineProperty(e.prototype,"size",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.add=function(e){throw new Error("Cannot add to an empty set.")},e.prototype.clear=function(){},e.prototype.delete=function(e){return!1},e.prototype.forEach=function(e,t){},e.prototype.has=function(e){return!1},e.prototype[Symbol.iterator]=function(){return new r},e.prototype.entries=function(){return new r},e.prototype.keys=function(){return new r},e.prototype.values=function(){return new r},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"EmptySet"},enumerable:!0,configurable:!0}),e}();t.EmptySet=i;var r=function(){function e(){}return e.prototype[Symbol.iterator]=function(){return this},e.prototype.next=function(){return{done:!0,value:null}},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SchemeStart=0]="SchemeStart",e[e.Scheme=1]="Scheme",e[e.NoScheme=2]="NoScheme",e[e.SpecialRelativeOrAuthority=3]="SpecialRelativeOrAuthority",e[e.PathOrAuthority=4]="PathOrAuthority",e[e.Relative=5]="Relative",e[e.RelativeSlash=6]="RelativeSlash",e[e.SpecialAuthoritySlashes=7]="SpecialAuthoritySlashes",e[e.SpecialAuthorityIgnoreSlashes=8]="SpecialAuthorityIgnoreSlashes",e[e.Authority=9]="Authority",e[e.Host=10]="Host",e[e.Hostname=11]="Hostname",e[e.Port=12]="Port",e[e.File=13]="File",e[e.FileSlash=14]="FileSlash",e[e.FileHost=15]="FileHost",e[e.PathStart=16]="PathStart",e[e.Path=17]="Path",e[e.CannotBeABaseURLPath=18]="CannotBeABaseURLPath",e[e.Query=19]="Query",e[e.Fragment=20]="Fragment"}(t.ParserState||(t.ParserState={})),t.OpaqueOrigin=["","",null,null]},function(e,t,n){"use strict";var i=n(245),r=n(247);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=_,t.resolve=function(e,t){return _(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},t.format=function(e){return r.isString(e)&&(e=_(e)),e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),h=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(248);function _(e,t,n){if(e&&r.isObject(e)&&e instanceof o)return e;var i=new o;return i.parse(e,t,n),i}o.prototype.parse=function(e,t,n){if(!r.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var _=e=c.join(s);if(_=_.trim(),!n&&1===e.split("#").length){var w=l.exec(_);if(w)return this.path=_,this.href=_,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var E=a.exec(_);if(E){var b=(E=E[0]).toLowerCase();this.protocol=b,_=_.substr(E.length)}if(n||E||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var x="//"===_.substr(0,2);!x||E&&g[E]||(_=_.substr(2),this.slashes=!0)}if(!g[E]&&(x||E&&!v[E])){for(var C,I,S=-1,D=0;D<h.length;D++)-1!==(A=_.indexOf(h[D]))&&(-1===S||A<S)&&(S=A);for(-1!==(I=-1===S?_.lastIndexOf("@"):_.lastIndexOf("@",S))&&(C=_.slice(0,I),_=_.slice(I+1),this.auth=decodeURIComponent(C)),S=-1,D=0;D<d.length;D++){var A;-1!==(A=_.indexOf(d[D]))&&(-1===S||A<S)&&(S=A)}-1===S&&(S=_.length),this.host=_.slice(0,S),_=_.slice(S),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var N=this.hostname.split(/\./),O=(D=0,N.length);D<O;D++){var P=N[D];if(P&&!P.match(p)){for(var M="",k=0,R=P.length;k<R;k++)P.charCodeAt(k)>127?M+="x":M+=P[k];if(!M.match(p)){var L=N.slice(0,D),F=N.slice(D+1),U=P.match(f);U&&(L.push(U[1]),F.unshift(U[2])),F.length&&(_="/"+F.join(".")+_),this.hostname=L.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=i.toASCII(this.hostname));var B=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+B,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!m[b])for(D=0,O=u.length;D<O;D++){var W=u[D];if(-1!==_.indexOf(W)){var j=encodeURIComponent(W);j===W&&(j=escape(W)),_=_.split(W).join(j)}}var H=_.indexOf("#");-1!==H&&(this.hash=_.substr(H),_=_.slice(0,H));var z=_.indexOf("?");if(-1!==z?(this.search=_.substr(z),this.query=_.substr(z+1),t&&(this.query=y.parse(this.query)),_=_.slice(0,z)):t&&(this.search="",this.query={}),_&&(this.pathname=_),v[b]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var G=this.search||"";this.path=B+G}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(a=y.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+i},o.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(r.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,i=Object.keys(this),a=0;a<i.length;a++){var s=i[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(n[u]=e[u])}return v[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!v[e.protocol]){for(var d=Object.keys(e),h=0;h<d.length;h++){var p=d[h];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",y=n.search||"";n.path=m+y}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var _=n.pathname&&"/"===n.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),E=w||_||n.host&&e.pathname,b=E,x=n.pathname&&n.pathname.split("/")||[],C=(f=e.pathname&&e.pathname.split("/")||[],n.protocol&&!v[n.protocol]);if(C&&(n.hostname="",n.port=null,n.host&&(""===x[0]?x[0]=n.host:x.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),E=E&&(""===f[0]||""===x[0])),w)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,x=f;else if(f.length)x||(x=[]),x.pop(),x=x.concat(f),n.search=e.search,n.query=e.query;else if(!r.isNullOrUndefined(e.search))return C&&(n.hostname=n.host=x.shift(),(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.host=n.hostname=T.shift())),n.search=e.search,n.query=e.query,r.isNull(n.pathname)&&r.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!x.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var I=x.slice(-1)[0],S=(n.host||e.host||x.length>1)&&("."===I||".."===I)||""===I,D=0,A=x.length;A>=0;A--)"."===(I=x[A])?x.splice(A,1):".."===I?(x.splice(A,1),D++):D&&(x.splice(A,1),D--);if(!E&&!b)for(;D--;D)x.unshift("..");!E||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),S&&"/"!==x.join("/").substr(-1)&&x.push("");var T,N=""===x[0]||x[0]&&"/"===x[0].charAt(0);return C&&(n.hostname=n.host=N?"":x.length?x.shift():"",(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.host=n.hostname=T.shift())),(E=E||n.host&&x.length)&&!N&&x.unshift(""),x.length?n.pathname=x.join("/"):(n.pathname=null,n.path=null),r.isNull(n.pathname)&&r.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,i){var r;!function(){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof i&&i;o.global!==o&&o.window!==o&&o.self;var a,s=2147483647,l=/^xn--/,c=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},h=Math.floor,p=String.fromCharCode;function f(e){throw new RangeError(d[e])}function m(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function g(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+m((e=e.replace(u,".")).split("."),t).join(".")}function v(e){for(var t,n,i=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function y(e){return m(e,function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+p(e)}).join("")}function _(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,n){var i=0;for(e=n?h(e/700):e>>1,e+=h(e/t);e>455;i+=36)e=h(e/35);return h(i+36*e/(e+38))}function E(e){var t,n,i,r,o,a,l,c,u,d,p,m=[],g=e.length,v=0,_=128,E=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&f("not-basic"),m.push(e.charCodeAt(i));for(r=n>0?n+1:0;r<g;){for(o=v,a=1,l=36;r>=g&&f("invalid-input"),((c=(p=e.charCodeAt(r++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:36)>=36||c>h((s-v)/a))&&f("overflow"),v+=c*a,!(c<(u=l<=E?1:l>=E+26?26:l-E));l+=36)a>h(s/(d=36-u))&&f("overflow"),a*=d;E=w(v-o,t=m.length+1,0==o),h(v/t)>s-_&&f("overflow"),_+=h(v/t),v%=t,m.splice(v++,0,_)}return y(m)}function b(e){var t,n,i,r,o,a,l,c,u,d,m,g,y,E,b,x=[];for(g=(e=v(e)).length,t=128,n=0,o=72,a=0;a<g;++a)(m=e[a])<128&&x.push(p(m));for(i=r=x.length,r&&x.push("-");i<g;){for(l=s,a=0;a<g;++a)(m=e[a])>=t&&m<l&&(l=m);for(l-t>h((s-n)/(y=i+1))&&f("overflow"),n+=(l-t)*y,t=l,a=0;a<g;++a)if((m=e[a])<t&&++n>s&&f("overflow"),m==t){for(c=n,u=36;!(c<(d=u<=o?1:u>=o+26?26:u-o));u+=36)b=c-d,E=36-d,x.push(p(_(d+b%E,0))),c=h(b/E);x.push(p(_(c,0))),o=w(n,y,i==r),n=0,++i}++n,++t}return x.join("")}a={version:"1.4.1",ucs2:{decode:v,encode:y},decode:E,encode:b,toASCII:function(e){return g(e,function(e){return c.test(e)?"xn--"+b(e):e})},toUnicode:function(e){return g(e,function(e){return l.test(e)?E(e.slice(4).toLowerCase()):e})}},void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(246)(e),n(78))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(249),t.encode=t.stringify=n(250)},function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var d,h,p,f,m=e[u].replace(s,"%20"),g=m.indexOf(n);g>=0?(d=m.substr(0,g),h=m.substr(g+1)):(d=m,h=""),p=decodeURIComponent(d),f=decodeURIComponent(h),i(a,p)?r(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(a(e),function(a){var s=encodeURIComponent(i(a))+n;return r(e[a])?o(e[a],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[a]))}).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(52);t.attr_setAnExistingAttributeValue=function(e,t){null===e._element?e._value=t:i.element_change(e,e._element,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(108),r=n(30),o=n(52);t.tokenList_validationSteps=function(e,t){if(!r.dom_hasSupportedTokens(e._attribute._localName))throw new TypeError("There are no supported tokens defined for attribute name: '"+e._attribute._localName+"'.");return r.dom_getSupportedTokens(e._attribute._localName).has(t.toLowerCase())},t.tokenList_updateSteps=function(e){(e._element.hasAttribute(e._attribute._localName)||0!==e._tokenSet.size)&&o.element_setAnAttributeValue(e._element,e._attribute._localName,i.orderedSet_serialize(e._tokenSet))},t.tokenList_serializeSteps=function(e){return o.element_getAnAttributeValue(e._element,e._attribute._localName)}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function o(e){return r.isBoolean(e)?e:e.capture||!1}t.eventTarget_flatten=o,t.eventTarget_flattenMore=function(e){var t=o(e),n=!1,i=!1;return r.isBoolean(e)||(n=e.once||!1,i=e.passive||!1),[t,i,n]},t.eventTarget_addEventListener=function(e,t){if(null!==t.callback){for(var n=0;n<e._eventListenerList.length;n++){var i=e._eventListenerList[n];if(i.type===t.type&&i.callback.handleEvent===t.callback.handleEvent&&i.capture===t.capture)return}e._eventListenerList.push(t)}},t.eventTarget_removeEventListener=function(e,t,n){t.removed=!0,e._eventListenerList.splice(n,1)},t.eventTarget_removeAllEventListeners=function(e){var t,n;try{for(var r=i(e._eventListenerList),o=r.next();!o.done;o=r.next())o.value.removed=!0}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}e._eventListenerList.length=0}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(29);t.parentNode_convertNodesIntoANode=function(e,t){for(var n,a,s=null,l=0;l<e.length;l++){var c=e[l];if(r.isString(c)){var u=o.create_text(t,c);e[l]=u}}if(1===e.length)s=e[0];else{var d=s=o.create_documentFragment(t);try{for(var h=i(e),p=h.next();!p.done;p=h.next())c=p.value,d.appendChild(c)}catch(e){n={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return s}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(9),l=n(3),c=n(29),u=n(17),d=n(175),h=n(107),p=n(176),f=n(37),m=n(177);function g(e){return e._startNode===e._endNode&&e._startOffset===e._endOffset}function v(e){return u.tree_rootNode(e._startNode)}function y(e,t){return u.tree_rootNode(e)===v(t)&&d.boundaryPoint_position([e,0],t._start)===a.BoundaryPosition.After&&d.boundaryPoint_position([e,u.tree_nodeLength(e)],t._end)===a.BoundaryPosition.Before}function _(e,t){var n=u.tree_isAncestorOf(t._startNode,e,!0),i=u.tree_isAncestorOf(t._endNode,e,!0);return n&&!i||!n&&i}function w(e){var t,n,r,a,d,m,v=c.create_documentFragment(e._startNode._nodeDocument);if(g(e))return v;var E=e._startNode,b=e._startOffset,x=e._endNode,C=e._endOffset;if(E===x&&l.Guard.isCharacterDataNode(E))return(B=p.node_clone(E))._data=h.characterData_substringData(E,b,C-b),f.mutation_append(B,v),h.characterData_replaceData(E,b,C-b,""),v;for(var I=E;!u.tree_isAncestorOf(x,I,!0);){if(null===I._parent)throw new Error("Parent node  is null.");I=I._parent}var S=null;if(!u.tree_isAncestorOf(x,E,!0))try{for(var D=i(I._children),A=D.next();!A.done;A=D.next())if(_(P=A.value,e)){S=P;break}}catch(e){t={error:e}}finally{try{A&&!A.done&&(n=D.return)&&n.call(D)}finally{if(t)throw t.error}}var T=null;if(!u.tree_isAncestorOf(E,x,!0))for(var N=o(I._children),O=N.length-1;O>0;O--){var P;if(_(P=N[O],e)){T=P;break}}var M,k,R=[];try{for(var L=i(I._children),F=L.next();!F.done;F=L.next())if(y(H=F.value,e)){if(l.Guard.isDocumentTypeNode(H))throw new s.HierarchyRequestError;R.push(H)}}catch(e){r={error:e}}finally{try{F&&!F.done&&(a=L.return)&&a.call(L)}finally{if(r)throw r.error}}if(u.tree_isAncestorOf(x,E,!0))M=E,k=b;else{for(var U=E;null!==U._parent&&!u.tree_isAncestorOf(x,U._parent);)U=U._parent;if(null===U._parent)throw new Error("Parent node is null.");M=U._parent,k=1+u.tree_index(U)}if(l.Guard.isCharacterDataNode(S))(B=p.node_clone(E))._data=h.characterData_substringData(E,b,u.tree_nodeLength(E)-b),f.mutation_append(B,v),h.characterData_replaceData(E,b,u.tree_nodeLength(E)-b,"");else if(null!==S){var B=p.node_clone(S);f.mutation_append(B,v);var V=w(c.create_range([E,b],[S,u.tree_nodeLength(S)]));f.mutation_append(V,B)}try{for(var W=i(R),j=W.next();!j.done;j=W.next()){var H=j.value;f.mutation_append(H,v)}}catch(e){d={error:e}}finally{try{j&&!j.done&&(m=W.return)&&m.call(W)}finally{if(d)throw d.error}}return l.Guard.isCharacterDataNode(T)?((B=p.node_clone(x))._data=h.characterData_substringData(x,0,C),f.mutation_append(B,v),h.characterData_replaceData(x,0,C,"")):null!==T&&(B=p.node_clone(T),f.mutation_append(B,v),V=w(c.create_range([T,0],[x,C])),f.mutation_append(V,B)),e._start=[M,k],e._end=[M,k],v}t.range_collapsed=g,t.range_root=v,t.range_isContained=y,t.range_isPartiallyContained=_,t.range_setTheStart=function(e,t,n){if(l.Guard.isDocumentTypeNode(t))throw new s.InvalidNodeTypeError;if(n>u.tree_nodeLength(t))throw new s.IndexSizeError;var i=[t,n];v(e)===u.tree_rootNode(t)&&d.boundaryPoint_position(i,e._end)!==a.BoundaryPosition.After||(e._end=i),e._start=i},t.range_setTheEnd=function(e,t,n){if(l.Guard.isDocumentTypeNode(t))throw new s.InvalidNodeTypeError;if(n>u.tree_nodeLength(t))throw new s.IndexSizeError;var i=[t,n];v(e)===u.tree_rootNode(t)&&d.boundaryPoint_position(i,e._start)!==a.BoundaryPosition.Before||(e._start=i),e._end=i},t.range_select=function(e,t){var n=e._parent;if(null===n)throw new s.InvalidNodeTypeError;var i=u.tree_index(e);t._start=[n,i],t._end=[n,i+1]},t.range_extract=w,t.range_cloneTheContents=function e(t){var n,r,a,d,m,v,E=c.create_documentFragment(t._startNode._nodeDocument);if(g(t))return E;var b=t._startNode,x=t._startOffset,C=t._endNode,I=t._endOffset;b===C&&l.Guard.isCharacterDataNode(b)&&((F=p.node_clone(b))._data=h.characterData_substringData(b,x,I-x),f.mutation_append(F,E));for(var S=b;!u.tree_isAncestorOf(C,S,!0);){if(null===S._parent)throw new Error("Parent node  is null.");S=S._parent}var D=null;if(!u.tree_isAncestorOf(C,b,!0))try{for(var A=i(S._children),T=A.next();!T.done;T=A.next())if(_(M=T.value,t)){D=M;break}}catch(e){n={error:e}}finally{try{T&&!T.done&&(r=A.return)&&r.call(A)}finally{if(n)throw n.error}}var N=null;if(!u.tree_isAncestorOf(b,C,!0))for(var O=o(S._children),P=O.length-1;P>0;P--){var M;if(_(M=O[P],t)){N=M;break}}var k=[];try{for(var R=i(S._children),L=R.next();!L.done;L=R.next())if(y(W=L.value,t)){if(l.Guard.isDocumentTypeNode(W))throw new s.HierarchyRequestError;k.push(W)}}catch(e){a={error:e}}finally{try{L&&!L.done&&(d=R.return)&&d.call(R)}finally{if(a)throw a.error}}if(l.Guard.isCharacterDataNode(D))(F=p.node_clone(b))._data=h.characterData_substringData(b,x,u.tree_nodeLength(b)-x),f.mutation_append(F,E);else if(null!==D){var F=p.node_clone(D);f.mutation_append(F,E);var U=e(c.create_range([b,x],[D,u.tree_nodeLength(D)]));f.mutation_append(U,F)}try{for(var B=i(k),V=B.next();!V.done;V=B.next()){var W=V.value;F=p.node_clone(W),f.mutation_append(F,E)}}catch(e){m={error:e}}finally{try{V&&!V.done&&(v=B.return)&&v.call(B)}finally{if(m)throw m.error}}return l.Guard.isCharacterDataNode(N)?((F=p.node_clone(C))._data=h.characterData_substringData(C,0,I),f.mutation_append(F,E)):null!==N&&(F=p.node_clone(N),E.append(F),U=w(c.create_range([N,0],[C,I])),f.mutation_append(U,F)),E},t.range_insert=function(e,t){var n,r;if(l.Guard.isProcessingInstructionNode(t._startNode)||l.Guard.isCommentNode(t._startNode)||l.Guard.isTextNode(t._startNode)&&null===t._startNode._parent||t._startNode===e)throw new s.HierarchyRequestError;var o,a=null;if(l.Guard.isTextNode(t._startNode))a=t._startNode;else{var c=0;try{for(var d=i(t._startNode._children),h=d.next();!h.done;h=d.next()){var p=h.value;if(c===t._startOffset){a=p;break}c++}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}if(null===a)o=t._startNode;else{if(null===a._parent)throw new Error("Parent node is null.");o=a._parent}f.mutation_ensurePreInsertionValidity(e,o,a),l.Guard.isTextNode(t._startNode)&&(a=m.text_split(t._startNode,t._startOffset)),e===a&&(a=e._nextSibling),null!==e._parent&&f.mutation_remove(e,e._parent);var v=null===a?u.tree_nodeLength(o):u.tree_index(a);l.Guard.isDocumentFragmentNode(e)?v+=u.tree_nodeLength(e):v++,f.mutation_preInsert(e,o,a),g(t)&&(t._end=[o,v])},t.range_getContainedNodes=function(e){var t;return(t={})[Symbol.iterator]=function(){var t=e.commonAncestorContainer,n=u.tree_getFirstDescendantNode(t);return{next:function(){for(;n&&!y(n,e);)n=u.tree_getNextDescendantNode(t,n);if(null===n)return{done:!0,value:null};var i={done:!1,value:n};return n=u.tree_getNextDescendantNode(t,n),i}}},t},t.range_getPartiallyContainedNodes=function(e){var t;return(t={})[Symbol.iterator]=function(){var t=e.commonAncestorContainer,n=u.tree_getFirstDescendantNode(t);return{next:function(){for(;n&&!_(n,e);)n=u.tree_getNextDescendantNode(t,n);if(null===n)return{done:!0,value:null};var i={done:!1,value:n};return n=u.tree_getNextDescendantNode(t,n),i}}},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9);t.selectors_scopeMatchASelectorsString=function(e,t){throw new i.NotSupportedError}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(105);t.treeWalker_traverseChildren=function(e,t){for(var n=t?e._current._firstChild:e._current._lastChild;null!==n;){var o=r.traversal_filter(e,n);if(o===i.FilterResult.Accept)return e._current=n,n;if(o===i.FilterResult.Skip){var a=t?n._firstChild:n._lastChild;if(null!==a){n=a;continue}}for(;null!==n;){var s=t?n._nextSibling:n._previousSibling;if(null!==s){n=s;break}var l=n._parent;if(null===l||l===e._root||l===e._current)return null;n=l}}return null},t.treeWalker_traverseSiblings=function(e,t){var n=e._current;if(n===e._root)return null;for(;;){for(var o=t?n._nextSibling:n._previousSibling;null!==o;){n=o;var a=r.traversal_filter(e,n);if(a===i.FilterResult.Accept)return e._current=n,n;o=t?n._firstChild:n._lastChild,a!==i.FilterResult.Reject&&null!==o||(o=t?n._nextSibling:n._previousSibling)}if(null===(n=n._parent)||n===e._root)return null;if(r.traversal_filter(e,n)===i.FilterResult.Accept)return null}}},function(e,t,n){"use strict";n(89),n(74);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),s=n(50),l=n(3),c=function(e){function t(t,n){var i=e.call(this,t)||this;return i._indentation={},i._lengthToLastNewline=0,i._writerOptions=o.applyDefaults(n,{wellFormed:!1,headless:!1,prettyPrint:!1,indent:"  ",newline:"\n",offset:0,width:0,allowEmptyTags:!1,indentTextOnlyNodes:!1,spaceBeforeSlash:!1}),i}return r(t,e),t.prototype.serialize=function(e){return this._refs={suppressPretty:!1,emptyNode:!1,markup:""},e.nodeType!==a.NodeType.Document||this._writerOptions.headless||this.declaration(this._builderOptions.version,this._builderOptions.encoding,this._builderOptions.standalone),this.serializeNode(e,this._writerOptions.wellFormed),this._writerOptions.prettyPrint&&this._refs.markup.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(this._refs.markup=this._refs.markup.slice(0,-this._writerOptions.newline.length)),this._refs.markup},t.prototype.declaration=function(e,t,n){this._beginLine(),this._refs.markup+='<?xml version="'+e+'"',void 0!==t&&(this._refs.markup+=' encoding="'+t+'"'),void 0!==n&&(this._refs.markup+=' standalone="'+(n?"yes":"no")+'"'),this._refs.markup+="?>",this._endLine()},t.prototype.docType=function(e,t,n){this._beginLine(),this._refs.markup+=t&&n?"<!DOCTYPE "+e+' PUBLIC "'+t+'" "'+n+'">':t?"<!DOCTYPE "+e+' PUBLIC "'+t+'">':n?"<!DOCTYPE "+e+' SYSTEM "'+n+'">':"<!DOCTYPE "+e+">",this._endLine()},t.prototype.openTagBegin=function(e){this._beginLine(),this._refs.markup+="<"+e},t.prototype.openTagEnd=function(e,t,n){if(this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._writerOptions.prettyPrint&&!t&&!n){for(var i=!0,r=!0,o=this.currentNode.firstChild,a=0,s=0;o;){if(l.Guard.isExclusiveTextNode(o))s++;else{if(!l.Guard.isCDATASectionNode(o)){i=!1,r=!1;break}a++}""!==o.data&&(r=!1),o=o.nextSibling}this._refs.suppressPretty=!this._writerOptions.indentTextOnlyNodes&&i&&(a<=1&&0===s||0===a),this._refs.emptyNode=r}(n||t||this._refs.emptyNode)&&this._writerOptions.allowEmptyTags?this._refs.markup+="></"+e+">":this._refs.markup+=n?" />":t||this._refs.emptyNode?this._writerOptions.spaceBeforeSlash?" />":"/>":">",this._endLine()},t.prototype.closeTag=function(e){this._refs.emptyNode||(this._beginLine(),this._refs.markup+="</"+e+">"),this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._endLine()},t.prototype.attribute=function(e,t){var n=e+'="'+t+'"';this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._refs.markup.length-this._lengthToLastNewline+1+n.length>this._writerOptions.width?(this._endLine(),this._beginLine(),this._refs.markup+=this._indent(1)+n):this._refs.markup+=" "+n},t.prototype.text=function(e){""!==e&&(this._beginLine(),this._refs.markup+=e,this._endLine())},t.prototype.cdata=function(e){""!==e&&(this._beginLine(),this._refs.markup+="<![CDATA["+e+"]]>",this._endLine())},t.prototype.comment=function(e){this._beginLine(),this._refs.markup+="\x3c!--"+e+"--\x3e",this._endLine()},t.prototype.instruction=function(e,t){this._beginLine(),this._refs.markup+="<?"+(""===t?e:e+" "+t)+"?>",this._endLine()},t.prototype._beginLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._indent(this._writerOptions.offset+this.level))},t.prototype._endLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._writerOptions.newline,this._lengthToLastNewline=this._refs.markup.length)},t.prototype._indent=function(e){if(e<=0)return"";if(void 0!==this._indentation[e])return this._indentation[e];var t=this._writerOptions.indent.repeat(e);return this._indentation[e]=t,t},t}(s.BaseWriter);t.XMLWriter=c},function(e,t,n){"use strict";var i=n(47),r=n(35);e.exports="".repeat||function(e){var t=String(r(this)),n="",o=i(e);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(178),n(20),n(22),n(23);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(67),s=n(1),l=function(e){function t(t,n){var i=e.call(this,t)||this;return i._writerOptions=s.applyDefaults(n,{wellFormed:!1,prettyPrint:!1,indent:"  ",newline:"\n",offset:0,group:!1,verbose:!1}),i}return r(t,e),t.prototype.serialize=function(e){var t=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),n=new a.ObjectWriter(this._builderOptions,t).serialize(e);return this._beginLine(this._writerOptions,0)+this._convertObject(n,this._writerOptions)},t.prototype._convertObject=function(e,t,n){var i,r,a=this;void 0===n&&(n=0);var l="",c=this._isLeafNode(e);if(s.isArray(e)){l+="[";var u=e.length,d=0;try{for(var h=o(e),p=h.next();!p.done;p=h.next()){var f=p.value;l+=this._endLine(t,n+1)+this._beginLine(t,n+1)+this._convertObject(f,t,n+1),d<u-1&&(l+=","),d++}}catch(e){i={error:e}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}l+=this._endLine(t,n)+this._beginLine(t,n),l+="]"}else if(s.isObject(e)){l+="{";var m=s.objectLength(e),g=0;s.forEachObject(e,function(e,i){c&&t.prettyPrint?l+=" ":l+=a._endLine(t,n+1)+a._beginLine(t,n+1),l+=a._key(e),t.prettyPrint&&(l+=" "),l+=a._convertObject(i,t,n+1),g<m-1&&(l+=","),g++},this),c&&t.prettyPrint?l+=" ":l+=this._endLine(t,n)+this._beginLine(t,n),l+="}"}else l+=this._val(e);return l},t.prototype._beginLine=function(e,t){if(!e.prettyPrint)return"";var n=e.offset+t+1;return n>0?new Array(n).join(e.indent):""},t.prototype._endLine=function(e,t){return e.prettyPrint?e.newline:""},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t.prototype._isLeafNode=function(e){return this._descendantCount(e)<=1},t.prototype._descendantCount=function(e,t){var n=this;return void 0===t&&(t=0),s.isArray(e)?s.forEachArray(e,function(e){return t+=n._descendantCount(e,t)},this):s.isObject(e)?s.forEachObject(e,function(e,i){return t+=n._descendantCount(i,t)},this):t++,t},t}(n(50).BaseWriter);t.JSONWriter=l},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(178),n(89),n(20),n(22),n(23);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(67),s=n(1),l=function(e){function t(t,n){var i=e.call(this,t)||this;if(i._writerOptions=s.applyDefaults(n,{wellFormed:!1,indent:"  ",newline:"\n",offset:0,group:!1,verbose:!1}),i._writerOptions.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(i._writerOptions.offset<0)throw new Error("YAML offset should be zero or a positive number.");return i}return r(t,e),t.prototype.serialize=function(e){var t=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),n=new a.ObjectWriter(this._builderOptions,t).serialize(e),i=this._beginLine(this._writerOptions,0)+"---"+this._endLine(this._writerOptions)+this._convertObject(n,this._writerOptions,0);return i.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(i=i.slice(0,-this._writerOptions.newline.length)),i},t.prototype._convertObject=function(e,t,n,i){var r,a,l=this;void 0===i&&(i=!1);var c="";if(s.isArray(e))try{for(var u=o(e),d=u.next();!d.done;d=u.next()){var h=d.value;c+=this._beginLine(t,n,!0),s.isObject(h)?s.isEmpty(h)?c+='""'+this._endLine(t):c+=this._convertObject(h,t,n,!0):c+=this._val(h)+this._endLine(t)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}else s.forEachObject(e,function(e,r){i?(c+=l._key(e),i=!1):c+=l._beginLine(t,n)+l._key(e),s.isObject(r)?s.isEmpty(r)?c+=' ""'+l._endLine(t):c+=l._endLine(t)+l._convertObject(r,t,n+1):c+=" "+l._val(r)+l._endLine(t)},this);return c},t.prototype._beginLine=function(e,t,n){void 0===n&&(n=!1);var i=e.offset+t+1,r=new Array(i).join(e.indent);return n?r.substr(0,r.length-2)+"-"+r.substr(-1,1):r},t.prototype._endLine=function(e){return e.newline},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t}(n(50).BaseWriter);t.YAMLWriter=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(110).dom.setFeatures(!0);var i=n(110);t.DOMImplementation=i.DOMImplementation;var r=n(271);t.DOMParser=r.DOMParser;var o=n(274);t.XMLSerializer=o.XMLSerializer},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(){}return e.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i.Cast.asNode(this),o=n._parent;if(null!==o){for(var a=n._previousSibling,s=!0;s&&a;){s=!1;for(var l=0;l<e.length;l++)if(e[l]===a){a=a._previousSibling,s=!0;break}}var c=r.parentNode_convertNodesIntoANode(e,n._nodeDocument);a=null===a?o._firstChild:a._nextSibling,r.mutation_preInsert(c,o,a)}},e.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i.Cast.asNode(this),o=n._parent;if(o){for(var a=n._nextSibling,s=!0;s&&a;){s=!1;for(var l=0;l<e.length;l++)if(e[l]===a){a=a._nextSibling,s=!0;break}}var c=r.parentNode_convertNodesIntoANode(e,n._nodeDocument);r.mutation_preInsert(c,o,a)}},e.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i.Cast.asNode(this),o=n._parent;if(o){for(var a=n._nextSibling,s=!0;s&&a;){s=!1;for(var l=0;l<e.length;l++)if(e[l]===a){a=a._nextSibling,s=!0;break}}var c=r.parentNode_convertNodesIntoANode(e,n._nodeDocument);n._parent===o?r.mutation_replace(n,c,o):r.mutation_preInsert(c,o,a)}},e.prototype.remove=function(){var e=i.Cast.asNode(this),t=e._parent;t&&r.mutation_remove(e,t)},e}();t.ChildNodeImpl=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.DocumentOrShadowRootImpl=i},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(3),a=n(7),s=function(){function e(e){this._nodeList=[],this._recordQueue=[],this._callback=e;var t=r.dom.window;a.set.append(t._mutationObservers,this)}return e.prototype.observe=function(e,t){var n,r;if(void 0===(t=t||{childList:!1,subtree:!1}).attributeOldValue&&void 0===t.attributeFilter||void 0!==t.attributes||(t.attributes=!0),void 0!==t.characterDataOldValue&&void 0===t.characterData&&(t.characterData=!0),!t.childList&&!t.attributes&&!t.characterData)throw new TypeError;if(t.attributeOldValue&&!t.attributes)throw new TypeError;if(void 0!==t.attributeFilter&&!t.attributes)throw new TypeError;if(t.characterDataOldValue&&!t.characterData)throw new TypeError;var s=!1,l=t,c=function(e){var t,n;if(e.observer===u){s=!0;try{for(var r=(t=void 0,i(u._nodeList)),c=r.next();!c.done;c=r.next()){var d=c.value;a.list.remove(d._registeredObserverList,function(t){return o.Guard.isTransientRegisteredObserver(t)&&t.source===e})}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}e.options=l}},u=this;try{for(var d=i(e._registeredObserverList),h=d.next();!h.done;h=d.next())c(h.value)}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}s||(e._registeredObserverList.push({observer:this,options:t}),this._nodeList.push(e))},e.prototype.disconnect=function(){var e,t,n=this;try{for(var r=i(this._nodeList),o=r.next();!o.done;o=r.next()){var s=o.value;a.list.remove(s._registeredObserverList,function(e){return e.observer===n})}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this._recordQueue=[]},e.prototype.takeRecords=function(){var e=this._recordQueue;return this._recordQueue=[],e},e}();t.MutationObserverImpl=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=function(){function e(){}return Object.defineProperty(e.prototype,"previousElementSibling",{get:function(){for(var e=i.Cast.asNode(this)._previousSibling;e;){if(i.Guard.isElementNode(e))return e;e=e._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextElementSibling",{get:function(){for(var e=i.Cast.asNode(this)._nextSibling;e;){if(i.Guard.isElementNode(e))return e;e=e._nextSibling}return null},enumerable:!0,configurable:!0}),e}();t.NonDocumentTypeChildNodeImpl=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(){}return e.prototype.getElementById=function(e){for(var t=r.tree_getFirstDescendantNode(i.Cast.asNode(this),!1,!1,function(e){return i.Guard.isElementNode(e)});null!==t;){if(t._uniqueIdentifier===e)return t;t=r.tree_getNextDescendantNode(i.Cast.asNode(this),t,!1,!1,function(e){return i.Guard.isElementNode(e)})}return null},e}();t.NonElementParentNodeImpl=o},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(0),a=function(){function e(){}return Object.defineProperty(e.prototype,"children",{get:function(){return o.create_htmlCollection(r.Cast.asNode(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){for(var e=r.Cast.asNode(this)._firstChild;e;){if(r.Guard.isElementNode(e))return e;e=e._nextSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){for(var e=r.Cast.asNode(this)._lastChild;e;){if(r.Guard.isElementNode(e))return e;e=e._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){var e,t,n=0;try{for(var o=i(r.Cast.asNode(this)._children),a=o.next();!a.done;a=o.next()){var s=a.value;r.Guard.isElementNode(s)&&n++}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),e.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.Cast.asNode(this),i=o.parentNode_convertNodesIntoANode(e,n._nodeDocument);o.mutation_preInsert(i,n,n._firstChild)},e.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.Cast.asNode(this),i=o.parentNode_convertNodesIntoANode(e,n._nodeDocument);o.mutation_append(i,n)},e.prototype.querySelector=function(e){var t=r.Cast.asNode(this),n=o.selectors_scopeMatchASelectorsString(e,t);return 0===n.length?null:n[0]},e.prototype.querySelectorAll=function(e){var t=r.Cast.asNode(this),n=o.selectors_scopeMatchASelectorsString(e,t);return o.create_nodeListStatic(t,n)},e}();t.ParentNodeImpl=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return Object.defineProperty(e.prototype,"_name",{get:function(){return this.__name||""},set:function(e){this.__name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_assignedSlot",{get:function(){return this.__assignedSlot||null},set:function(e){this.__assignedSlot=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assignedSlot",{get:function(){return i.shadowTree_findASlot(this,!0)},enumerable:!0,configurable:!0}),e}();t.SlotableImpl=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(102),a=n(9),s=n(3),l=function(e){function t(t){var n=e.call(this)||this;if(s.Guard.isDocumentTypeNode(t.startContainer)||s.Guard.isAttrNode(t.startContainer)||s.Guard.isDocumentTypeNode(t.endContainer)||s.Guard.isAttrNode(t.endContainer))throw new a.InvalidNodeTypeError;return n._start=[t.startContainer,t.startOffset],n._end=[t.endContainer,t.endOffset],n}return r(t,e),t}(o.AbstractRangeImpl);t.StaticRangeImpl=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(272);t.DOMParser=i.DOMParserImpl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(273),o=function(){function e(){}return e.prototype.parseFromString=function(e,t){if("text/html"===t)throw new Error("HTML parser not implemented.");try{return(n=(new r.XMLParserImpl).parse(e))._contentType=t,n}catch(e){var n,o="http://www.mozilla.org/newlayout/xml/parsererror.xml",a=(n=i.create_xmlDocument()).createElementNS(o,"parsererror"),s=n.createElementNS(o,"error");return s.setAttribute("message",e.message),a.appendChild(s),n.appendChild(a),n}},e}();t.DOMParserImpl=o},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(180),a=n(111),s=n(7),l=n(0),c=n(69),u=function(){function e(){}return e.prototype.parse=function(e){for(var t,n,u,d,h=new o.XMLStringLexer(e,{skipWhitespaceOnlyText:!0}),p=l.create_document(),f=p,m=h.nextToken();m.type!==a.TokenType.EOF;){switch(m.type){case a.TokenType.Declaration:var g=m;if("1.0"!==g.version)throw new Error("Invalid xml version: "+g.version);break;case a.TokenType.DocType:var v=m;if(!l.xml_isPubidChar(v.pubId))throw new Error("DocType public identifier does not match PubidChar construct.");if(!l.xml_isLegalChar(v.sysId)||-1!==v.sysId.indexOf('"')&&-1!==v.sysId.indexOf("'"))throw new Error("DocType system identifier contains invalid characters.");f.appendChild(p.implementation.createDocumentType(v.name,v.pubId,v.sysId));break;case a.TokenType.CDATA:var y=m;if(!l.xml_isLegalChar(y.data)||-1!==y.data.indexOf("]]>"))throw new Error("CDATA contains invalid characters.");f.appendChild(p.createCDATASection(y.data));break;case a.TokenType.Comment:var _=m;if(!l.xml_isLegalChar(_.data)||-1!==_.data.indexOf("--")||_.data.endsWith("-"))throw new Error("Comment data contains invalid characters.");f.appendChild(p.createComment(_.data));break;case a.TokenType.PI:var w=m;if(-1!==w.target.indexOf(":")||/^xml$/i.test(w.target))throw new Error("Processing instruction target contains invalid characters.");if(!l.xml_isLegalChar(w.data)||-1!==w.data.indexOf("?>"))throw new Error("Processing instruction data contains invalid characters.");f.appendChild(p.createProcessingInstruction(w.target,w.data));break;case a.TokenType.Text:var E=m;if(!l.xml_isLegalChar(E.data))throw new Error("Text data contains invalid characters.");f.appendChild(p.createTextNode(this._decodeText(E.data)));break;case a.TokenType.Element:var b=m,x=i(l.namespace_extractQName(b.name),2),C=x[0],I=x[1];if(-1!==I.indexOf(":")||!l.xml_isName(I))throw new Error("Node local name contains invalid characters.");if("xmlns"===C)throw new Error("An element cannot have the 'xmlns' prefix.");var S=f.lookupNamespaceURI(C),D={};try{for(var A=(t=void 0,r(b.attributes)),T=A.next();!T.done;T=A.next()){var N=i(T.value,2),O=N[0],P=N[1];if("xmlns"===O)S=P;else{var M=i(l.namespace_extractQName(O),2),k=M[0],R=M[1];"xmlns"===k&&(R===C&&(S=P),D[R]=P)}}}catch(e){t={error:e}}finally{try{T&&!T.done&&(n=A.return)&&n.call(A)}finally{if(t)throw t.error}}var L=null!==S?p.createElementNS(S,b.name):p.createElement(b.name);f.appendChild(L);var F=new c.LocalNameSet;try{for(var U=(u=void 0,r(b.attributes)),B=U.next();!B.done;B=U.next()){var V=i(B.value,2),W=(O=V[0],P=V[1],i(l.namespace_extractQName(O),2)),j=(k=W[0],R=W[1],null);if("xmlns"===k||null===k&&"xmlns"===R?j=s.namespace.XMLNS:null!==(j=L.lookupNamespaceURI(k))&&L.isDefaultNamespace(j)?j=null:null===j&&null!==k&&(j=D[k]||null),F.has(j,R))throw new Error("Element contains duplicate attributes.");if(F.set(j,R),j===s.namespace.XMLNS&&P===s.namespace.XMLNS)throw new Error("XMLNS namespace is reserved.");if(-1!==R.indexOf(":")||!l.xml_isName(R))throw new Error("Attribute local name contains invalid characters.");if("xmlns"===k&&""===P)throw new Error("Empty XML namespace is not allowed.");null!==j?L.setAttributeNS(j,O,this._decodeAttributeValue(P)):L.setAttribute(O,this._decodeAttributeValue(P))}}catch(e){u={error:e}}finally{try{B&&!B.done&&(d=U.return)&&d.call(U)}finally{if(u)throw u.error}}b.selfClosing||(f=L);break;case a.TokenType.ClosingTag:if(m.name!==f.nodeName)throw new Error("Closing tag name does not match opening tag name.");f._parent&&(f=f._parent)}m=h.nextToken()}return p},e.prototype._decodeText=function(e){return null==e?e:e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e.prototype._decodeAttributeValue=function(e){return null==e?e:e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e}();t.XMLParserImpl=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(275);t.XMLSerializer=i.XMLSerializerImpl},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),a=n(95),s=n(9),l=n(7),c=n(0),u=function(){function e(){}return e.prototype.serializeToString=function(e){return this._xmlSerialization(e,!1)},e.prototype._xmlSerialization=function(e,t){if(void 0===e._nodeDocument||e._nodeDocument._hasNamespaces){var n=new a.NamespacePrefixMap;n.set("xml",l.namespace.XML);try{return this._serializeNodeNS(e,null,n,{value:1},t)}catch(e){throw new s.InvalidStateError}}else try{return this._serializeNode(e,t)}catch(e){throw new s.InvalidStateError}},e.prototype._serializeNodeNS=function(e,t,n,i,o){switch(e.nodeType){case r.NodeType.Element:return this._serializeElementNS(e,t,n,i,o);case r.NodeType.Document:return this._serializeDocumentNS(e,t,n,i,o);case r.NodeType.Comment:return this._serializeComment(e,o);case r.NodeType.Text:return this._serializeText(e,o);case r.NodeType.DocumentFragment:return this._serializeDocumentFragmentNS(e,t,n,i,o);case r.NodeType.DocumentType:return this._serializeDocumentType(e,o);case r.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(e,o);case r.NodeType.CData:return this._serializeCData(e,o);default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeNode=function(e,t){switch(e.nodeType){case r.NodeType.Element:return this._serializeElement(e,t);case r.NodeType.Document:return this._serializeDocument(e,t);case r.NodeType.Comment:return this._serializeComment(e,t);case r.NodeType.Text:return this._serializeText(e,t);case r.NodeType.DocumentFragment:return this._serializeDocumentFragment(e,t);case r.NodeType.DocumentType:return this._serializeDocumentType(e,t);case r.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(e,t);case r.NodeType.CData:return this._serializeCData(e,t);default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeElementNS=function(t,n,r,o,a){var s,u;if(a&&(-1!==t.localName.indexOf(":")||!c.xml_isName(t.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var d="<",h="",p=!1,f=!1,m=r.copy(),g={},v=this._recordNamespaceInformation(t,m,g),y=n,_=t.namespaceURI;if(y===_)null!==v&&(f=!0),d+=h=_===l.namespace.XML?"xml:"+t.localName:t.localName;else{var w=t.prefix,E=null;if(null===w&&_===v||(E=m.get(w,_)),"xmlns"===w){if(a)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");E=w}null!==E?(h=E+":"+t.localName,null!==v&&v!==l.namespace.XML&&(y=v||null),d+=h):null!==w?(w in g&&(w=this._generatePrefix(_,m,o)),m.set(w,_),d+=h+=w+":"+t.localName,d+=" xmlns:"+w+'="'+this._serializeAttributeValue(_,a)+'"',null!==v&&(y=v||null)):null===v||null!==v&&v!==_?(f=!0,y=_,d+=h+=t.localName,d+=' xmlns="'+this._serializeAttributeValue(_,a)+'"'):(y=_,d+=h+=t.localName)}d+=this._serializeAttributesNS(t,m,o,g,f,a);var b=_===l.namespace.HTML;if(b&&0===t.childNodes.length&&e._VoidElementNames.has(t.localName)?(d+=" /",p=!0):b||0!==t.childNodes.length||(d+="/",p=!0),d+=">",p)return d;if(b&&"template"===t.localName);else try{for(var x=i(t._children||t.childNodes),C=x.next();!C.done;C=x.next()){var I=C.value;d+=this._serializeNodeNS(I,y,m,o,a)}}catch(e){s={error:e}}finally{try{C&&!C.done&&(u=x.return)&&u.call(x)}finally{if(s)throw s.error}}return d+"</"+h+">"},e.prototype._serializeDocumentNS=function(e,t,n,r,o){var a,s;if(o&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");var l="";try{for(var c=i(e._children||e.childNodes),u=c.next();!u.done;u=c.next()){var d=u.value;l+=this._serializeNodeNS(d,t,n,r,o)}}catch(e){a={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}return l},e.prototype._serializeComment=function(e,t){if(t&&(!c.xml_isLegalChar(e.data)||-1!==e.data.indexOf("--")||e.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");return"\x3c!--"+e.data+"--\x3e"},e.prototype._serializeText=function(e,t){if(t&&!c.xml_isLegalChar(e.data))throw new Error("Text data contains invalid characters (well-formed required).");for(var n="",i=0;i<e.data.length;i++){var r=e.data[i];n+="&"===r?"&amp;":"<"===r?"&lt;":">"===r?"&gt;":r}return n},e.prototype._serializeDocumentFragmentNS=function(e,t,n,r,o){var a,s,l="";try{for(var c=i(e._children||e.childNodes),u=c.next();!u.done;u=c.next()){var d=u.value;l+=this._serializeNodeNS(d,t,n,r,o)}}catch(e){a={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}return l},e.prototype._serializeDocumentType=function(e,t){if(t&&!c.xml_isPubidChar(e.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(t&&(!c.xml_isLegalChar(e.systemId)||-1!==e.systemId.indexOf('"')&&-1!==e.systemId.indexOf("'")))throw new Error("DocType system identifier contains invalid characters (well-formed required).");return e.publicId&&e.systemId?"<!DOCTYPE "+e.name+' PUBLIC "'+e.publicId+'" "'+e.systemId+'">':e.publicId?"<!DOCTYPE "+e.name+' PUBLIC "'+e.publicId+'">':e.systemId?"<!DOCTYPE "+e.name+' SYSTEM "'+e.systemId+'">':"<!DOCTYPE "+e.name+">"},e.prototype._serializeProcessingInstruction=function(e,t){if(t&&(-1!==e.target.indexOf(":")||/^xml$/i.test(e.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(t&&(!c.xml_isLegalChar(e.data)||-1!==e.data.indexOf("?>")))throw new Error("Processing instruction data contains invalid characters (well-formed required).");return"<?"+(""===e.data?e.target:e.target+" "+e.data)+"?>"},e.prototype._serializeCData=function(e,t){if(t&&-1!==e.data.indexOf("]]>"))throw new Error("CDATA contains invalid characters (well-formed required).");return"<![CDATA["+e.data+"]]>"},e.prototype._serializeAttributesNS=function(e,t,n,r,a,s){var u,d,h="",p=s?new o.LocalNameSet:void 0;try{for(var f=i(e.attributes),m=f.next();!m.done;m=f.next()){var g=m.value;if(a||s||null!==g.namespaceURI){if(s&&p&&p.has(g.namespaceURI,g.localName))throw new Error("Element contains duplicate attributes (well-formed required).");s&&p&&p.set(g.namespaceURI,g.localName);var v=g.namespaceURI,y=null;if(null!==v)if(y=t.get(g.prefix,v),v===l.namespace.XMLNS){if(g.value===l.namespace.XML||null===g.prefix&&a||null!==g.prefix&&(!(g.localName in r)||r[g.localName]!==g.value)&&t.has(g.localName,g.value))continue;if(s&&g.value===l.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(s&&""===g.value)throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");"xmlns"===g.prefix&&(y="xmlns")}else null===y&&(h+=" xmlns:"+(y=null===g.prefix||t.hasPrefix(g.prefix)&&!t.has(g.prefix,v)?this._generatePrefix(v,t,n):g.prefix)+'="'+this._serializeAttributeValue(v,s)+'"');if(h+=" ",null!==y&&(h+=y+":"),s&&(-1!==g.localName.indexOf(":")||!c.xml_isName(g.localName)||"xmlns"===g.localName&&null===v))throw new Error("Attribute local name contains invalid characters (well-formed required).");h+=g.localName+'="'+this._serializeAttributeValue(g.value,s)+'"'}else h+=" "+g.localName+'="'+this._serializeAttributeValue(g.value,s)+'"'}}catch(e){u={error:e}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(u)throw u.error}}return h},e.prototype._recordNamespaceInformation=function(e,t,n){var r,o,a=null;try{for(var s=i(e.attributes),c=s.next();!c.done;c=s.next()){var u=c.value,d=u.namespaceURI,h=u.prefix;if(d===l.namespace.XMLNS){if(null===h){a=u.value;continue}var p=u.localName,f=u.value;if(f===l.namespace.XML)continue;if(""===f&&(f=null),t.has(p,f))continue;t.set(p,f),n[p]=f||""}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return a},e.prototype._generatePrefix=function(e,t,n){var i="ns"+n.value;return n.value++,t.set(i,e),i},e.prototype._serializeAttributeValue=function(e,t){if(t&&null!==e&&!c.xml_isLegalChar(e))throw new Error("Invalid characters in attribute value.");if(null===e)return"";for(var n="",i=0;i<e.length;i++){var r=e[i];n+='"'===r?"&quot;":"&"===r?"&amp;":"<"===r?"&lt;":">"===r?"&gt;":r}return n},e.prototype._serializeElement=function(e,t){var n,r;if(t&&(-1!==e.localName.indexOf(":")||!c.xml_isName(e.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var o=!1,a=e.localName,s="<"+a;if(s+=this._serializeAttributes(e,t),0===e._children.size&&(s+="/",o=!0),s+=">",o)return s;try{for(var l=i(e._children),u=l.next();!u.done;u=l.next()){var d=u.value;s+=this._serializeNode(d,t)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return s+"</"+a+">"},e.prototype._serializeDocument=function(e,t){var n,r;if(t&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");var o="";try{for(var a=i(e._children),s=a.next();!s.done;s=a.next()){var l=s.value;o+=this._serializeNode(l,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},e.prototype._serializeDocumentFragment=function(e,t){var n,r,o="";try{for(var a=i(e._children),s=a.next();!s.done;s=a.next()){var l=s.value;o+=this._serializeNode(l,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},e.prototype._serializeAttributes=function(e,t){var n,r,o="",a=t?{}:void 0;try{for(var s=i(e.attributes),l=s.next();!l.done;l=s.next()){var u=l.value;if(t&&a&&u.localName in a)throw new Error("Element contains duplicate attributes (well-formed required).");if(t&&a&&(a[u.localName]=!0),t&&(-1!==u.localName.indexOf(":")||!c.xml_isName(u.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");o+=" "+u.localName+'="'+this._serializeAttributeValue(u.value,t)+'"'}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o},e._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),e}();t.XMLSerializerImpl=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(277);t.XMLReader=i.XMLReader;var r=n(112);t.ObjectReader=r.ObjectReader;var o=n(280);t.JSONReader=o.JSONReader;var a=n(281);t.YAMLReader=a.YAMLReader},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(65),n(20),n(22),n(23);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(180),l=n(111),c=n(7),u=n(0),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._parse=function(e,t){for(var n,i,r,d,h=new s.XMLStringLexer(t,{skipWhitespaceOnlyText:!0}),p=e,f=e,m=h.nextToken();m.type!==l.TokenType.EOF;){switch(m.type){case l.TokenType.Declaration:var g=m,v=this.sanitize(g.version);if("1.0"!==v)throw new Error("Invalid xml version: "+v);var y={version:v};g.encoding&&(y.encoding=this.sanitize(g.encoding)),g.standalone&&(y.standalone="yes"===this.sanitize(g.standalone)),f.set(y);break;case l.TokenType.DocType:var _=m;f=this.docType(f,this.sanitize(_.name),this.sanitize(_.pubId),this.sanitize(_.sysId))||f;break;case l.TokenType.CDATA:var w=m;f=this.cdata(f,this.sanitize(w.data))||f;break;case l.TokenType.Comment:var E=m;f=this.comment(f,this.sanitize(E.data))||f;break;case l.TokenType.PI:var b=m;f=this.instruction(f,this.sanitize(b.target),this.sanitize(b.data))||f;break;case l.TokenType.Text:var x=m;f=this.text(f,this._decodeText(this.sanitize(x.data)))||f;break;case l.TokenType.Element:var C=m,I=this.sanitize(C.name),S=o(u.namespace_extractQName(I),1)[0],D=f.node.lookupNamespaceURI(S),A={};try{for(var T=(n=void 0,a(C.attributes)),N=T.next();!N.done;N=T.next()){var O=o(N.value,2),P=O[0],M=O[1];if(P=this.sanitize(P),M=this.sanitize(M),"xmlns"===P)D=M;else{var k=o(u.namespace_extractQName(P),2),R=k[0],L=k[1];"xmlns"===R&&(L===S&&(D=M),A[L]=M)}}}catch(e){n={error:e}}finally{try{N&&!N.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}var F=null!==D?this.element(f,D,I):this.element(f,void 0,I);if(void 0===F)break;f.node===e.node&&(p=F);try{for(var U=(r=void 0,a(C.attributes)),B=U.next();!B.done;B=U.next()){var V=o(B.value,2);P=V[0],M=V[1],P=this.sanitize(P),M=this.sanitize(M);var W=o(u.namespace_extractQName(P),2),j=(R=W[0],L=W[1],null);"xmlns"===R||null===R&&"xmlns"===L?j=c.namespace.XMLNS:null!==(j=F.node.lookupNamespaceURI(R))&&F.node.isDefaultNamespace(j)?j=null:null===j&&null!==R&&(j=A[R]||null),null!==j?this.attribute(F,j,P,this._decodeAttributeValue(M)):this.attribute(F,void 0,P,this._decodeAttributeValue(M))}}catch(e){r={error:e}}finally{try{B&&!B.done&&(d=U.return)&&d.call(U)}finally{if(r)throw r.error}}C.selfClosing||(f=F);break;case l.TokenType.ClosingTag:f.node.parentNode&&(f=f.up())}m=h.nextToken()}return p},t}(n(75).BaseReader);t.XMLReader=d},function(e,t,n){var i=n(4),r=n(279);i({target:"Object",stat:!0,forced:Object.assign!==r},{assign:r})},function(e,t,n){"use strict";var i=n(16),r=n(8),o=n(61),a=n(85),s=n(79),l=n(27),c=n(41),u=Object.assign,d=Object.defineProperty;e.exports=!u||r(function(){if(i&&1!==u({b:1},u(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||"abcdefghijklmnopqrst"!=o(u({},t)).join("")})?function(e,t){for(var n=l(e),r=arguments.length,u=1,d=a.f,h=s.f;r>u;)for(var p,f=c(arguments[u++]),m=d?o(f).concat(d(f)):o(f),g=m.length,v=0;g>v;)p=m[v++],i&&!h.call(f,p)||(n[p]=f[p]);return n}:u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(112),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._parse=function(e,t){return new o.ObjectReader(this._builderOptions).parse(e,JSON.parse(t))},t}(n(75).BaseReader);t.JSONReader=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(112),a=n(75),s=n(282),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._parse=function(e,t){var n=s.safeLoad(t);if(void 0===n)throw new Error("Unable to parse YAML document.");return new o.ObjectReader(this._builderOptions).parse(e,n)},t}(a.BaseReader);t.YAMLReader=l},function(e,t,n){"use strict";var i=n(283);e.exports=i},function(e,t,n){"use strict";var i=n(284),r=n(303);function o(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}e.exports.Type=n(10),e.exports.Schema=n(39),e.exports.FAILSAFE_SCHEMA=n(113),e.exports.JSON_SCHEMA=n(182),e.exports.CORE_SCHEMA=n(181),e.exports.DEFAULT_SAFE_SCHEMA=n(54),e.exports.DEFAULT_FULL_SCHEMA=n(76),e.exports.load=i.load,e.exports.loadAll=i.loadAll,e.exports.safeLoad=i.safeLoad,e.exports.safeLoadAll=i.safeLoadAll,e.exports.dump=r.dump,e.exports.safeDump=r.safeDump,e.exports.YAMLException=n(53),e.exports.MINIMAL_SCHEMA=n(113),e.exports.SAFE_SCHEMA=n(54),e.exports.DEFAULT_SCHEMA=n(76),e.exports.scan=o("scan"),e.exports.parse=o("parse"),e.exports.compose=o("compose"),e.exports.addConstructor=o("addConstructor")},function(e,t,n){"use strict";var i=n(38),r=n(53),o=n(285),a=n(54),s=n(76),l=Object.prototype.hasOwnProperty,c=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,u=/[\x85\u2028\u2029]/,d=/[,\[\]\{\}]/,h=/^(?:!|!!|![a-z\-]+!)$/i,p=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function f(e){return Object.prototype.toString.call(e)}function m(e){return 10===e||13===e}function g(e){return 9===e||32===e}function v(e){return 9===e||32===e||10===e||13===e}function y(e){return 44===e||91===e||93===e||123===e||125===e}function _(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function w(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?"":76===e?"\u2028":80===e?"\u2029":""}function E(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var b=new Array(256),x=new Array(256),C=0;C<256;C++)b[C]=w(C)?1:0,x[C]=w(C);function I(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||s,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function S(e,t){return new r(t,new o(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function D(e,t){throw S(e,t)}function A(e,t){e.onWarning&&e.onWarning.call(null,S(e,t))}var T={YAML:function(e,t,n){var i,r,o;null!==e.version&&D(e,"duplication of %YAML directive"),1!==n.length&&D(e,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&D(e,"ill-formed argument of the YAML directive"),r=parseInt(i[1],10),o=parseInt(i[2],10),1!==r&&D(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&A(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var i,r;2!==n.length&&D(e,"TAG directive accepts exactly two arguments"),i=n[0],r=n[1],h.test(i)||D(e,"ill-formed tag handle (first argument) of the TAG directive"),l.call(e.tagMap,i)&&D(e,'there is a previously declared suffix for "'+i+'" tag handle'),p.test(r)||D(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[i]=r}};function N(e,t,n,i){var r,o,a,s;if(t<n){if(s=e.input.slice(t,n),i)for(r=0,o=s.length;r<o;r+=1)9===(a=s.charCodeAt(r))||32<=a&&a<=1114111||D(e,"expected valid JSON character");else c.test(s)&&D(e,"the stream contains non-printable characters");e.result+=s}}function O(e,t,n,r){var o,a,s,c;for(i.isObject(n)||D(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,c=(o=Object.keys(n)).length;s<c;s+=1)a=o[s],l.call(t,a)||(t[a]=n[a],r[a]=!0)}function P(e,t,n,i,r,o,a,s){var c,u;if(Array.isArray(r))for(c=0,u=(r=Array.prototype.slice.call(r)).length;c<u;c+=1)Array.isArray(r[c])&&D(e,"nested arrays are not supported inside keys"),"object"==typeof r&&"[object Object]"===f(r[c])&&(r[c]="[object Object]");if("object"==typeof r&&"[object Object]"===f(r)&&(r="[object Object]"),r=String(r),null===t&&(t={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(o))for(c=0,u=o.length;c<u;c+=1)O(e,t,o[c],n);else O(e,t,o,n);else e.json||l.call(n,r)||!l.call(t,r)||(e.line=a||e.line,e.position=s||e.position,D(e,"duplicated mapping key")),t[r]=o,delete n[r];return t}function M(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):D(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function k(e,t,n){for(var i=0,r=e.input.charCodeAt(e.position);0!==r;){for(;g(r);)r=e.input.charCodeAt(++e.position);if(t&&35===r)do{r=e.input.charCodeAt(++e.position)}while(10!==r&&13!==r&&0!==r);if(!m(r))break;for(M(e),r=e.input.charCodeAt(e.position),i++,e.lineIndent=0;32===r;)e.lineIndent++,r=e.input.charCodeAt(++e.position)}return-1!==n&&0!==i&&e.lineIndent<n&&A(e,"deficient indentation"),i}function R(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!v(t)))}function L(e,t){1===t?e.result+=" ":t>1&&(e.result+=i.repeat("\n",t-1))}function F(e,t){var n,i,r=e.tag,o=e.anchor,a=[],s=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=a),i=e.input.charCodeAt(e.position);0!==i&&45===i&&v(e.input.charCodeAt(e.position+1));)if(s=!0,e.position++,k(e,!0,-1)&&e.lineIndent<=t)a.push(null),i=e.input.charCodeAt(e.position);else if(n=e.line,V(e,t,3,!1,!0),a.push(e.result),k(e,!0,-1),i=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==i)D(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!s&&(e.tag=r,e.anchor=o,e.kind="sequence",e.result=a,!0)}function U(e){var t,n,i,r,o=!1,a=!1;if(33!==(r=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&D(e,"duplication of a tag property"),60===(r=e.input.charCodeAt(++e.position))?(o=!0,r=e.input.charCodeAt(++e.position)):33===r?(a=!0,n="!!",r=e.input.charCodeAt(++e.position)):n="!",t=e.position,o){do{r=e.input.charCodeAt(++e.position)}while(0!==r&&62!==r);e.position<e.length?(i=e.input.slice(t,e.position),r=e.input.charCodeAt(++e.position)):D(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==r&&!v(r);)33===r&&(a?D(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),h.test(n)||D(e,"named tag handle cannot contain such characters"),a=!0,t=e.position+1)),r=e.input.charCodeAt(++e.position);i=e.input.slice(t,e.position),d.test(i)&&D(e,"tag suffix cannot contain flow indicator characters")}return i&&!p.test(i)&&D(e,"tag name cannot contain such characters: "+i),o?e.tag=i:l.call(e.tagMap,n)?e.tag=e.tagMap[n]+i:"!"===n?e.tag="!"+i:"!!"===n?e.tag="tag:yaml.org,2002:"+i:D(e,'undeclared tag handle "'+n+'"'),!0}function B(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&D(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!v(n)&&!y(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&D(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function V(e,t,n,r,o){var a,s,c,u,d,h,p,f,w=1,C=!1,I=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=s=c=4===n||3===n,r&&k(e,!0,-1)&&(C=!0,e.lineIndent>t?w=1:e.lineIndent===t?w=0:e.lineIndent<t&&(w=-1)),1===w)for(;U(e)||B(e);)k(e,!0,-1)?(C=!0,c=a,e.lineIndent>t?w=1:e.lineIndent===t?w=0:e.lineIndent<t&&(w=-1)):c=!1;if(c&&(c=C||o),1!==w&&4!==n||(p=1===n||2===n?t:t+1,f=e.position-e.lineStart,1===w?c&&(F(e,f)||function(e,t,n){var i,r,o,a,s,l=e.tag,c=e.anchor,u={},d={},h=null,p=null,f=null,m=!1,y=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=u),s=e.input.charCodeAt(e.position);0!==s;){if(i=e.input.charCodeAt(e.position+1),o=e.line,a=e.position,63!==s&&58!==s||!v(i)){if(!V(e,n,2,!1,!0))break;if(e.line===o){for(s=e.input.charCodeAt(e.position);g(s);)s=e.input.charCodeAt(++e.position);if(58===s)v(s=e.input.charCodeAt(++e.position))||D(e,"a whitespace character is expected after the key-value separator within a block mapping"),m&&(P(e,u,d,h,p,null),h=p=f=null),y=!0,m=!1,r=!1,h=e.tag,p=e.result;else{if(!y)return e.tag=l,e.anchor=c,!0;D(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return e.tag=l,e.anchor=c,!0;D(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(m&&(P(e,u,d,h,p,null),h=p=f=null),y=!0,m=!0,r=!0):m?(m=!1,r=!0):D(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,s=i;if((e.line===o||e.lineIndent>t)&&(V(e,t,4,!0,r)&&(m?p=e.result:f=e.result),m||(P(e,u,d,h,p,f,o,a),h=p=f=null),k(e,!0,-1),s=e.input.charCodeAt(e.position)),e.lineIndent>t&&0!==s)D(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return m&&P(e,u,d,h,p,null),y&&(e.tag=l,e.anchor=c,e.kind="mapping",e.result=u),y}(e,f,p))||function(e,t){var n,i,r,o,a,s,l,c,u,d,h=!0,p=e.tag,f=e.anchor,m={};if(91===(d=e.input.charCodeAt(e.position)))r=93,s=!1,i=[];else{if(123!==d)return!1;r=125,s=!0,i={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=i),d=e.input.charCodeAt(++e.position);0!==d;){if(k(e,!0,t),(d=e.input.charCodeAt(e.position))===r)return e.position++,e.tag=p,e.anchor=f,e.kind=s?"mapping":"sequence",e.result=i,!0;h||D(e,"missed comma between flow collection entries"),u=null,o=a=!1,63===d&&v(e.input.charCodeAt(e.position+1))&&(o=a=!0,e.position++,k(e,!0,t)),n=e.line,V(e,t,1,!1,!0),c=e.tag,l=e.result,k(e,!0,t),d=e.input.charCodeAt(e.position),!a&&e.line!==n||58!==d||(o=!0,d=e.input.charCodeAt(++e.position),k(e,!0,t),V(e,t,1,!1,!0),u=e.result),s?P(e,i,m,c,l,u):o?i.push(P(e,null,m,c,l,u)):i.push(l),k(e,!0,t),44===(d=e.input.charCodeAt(e.position))?(h=!0,d=e.input.charCodeAt(++e.position)):h=!1}D(e,"unexpected end of the stream within a flow collection")}(e,p)?I=!0:(s&&function(e,t){var n,r,o,a,s,l=1,c=!1,u=!1,d=t,h=0,p=!1;if(124===(a=e.input.charCodeAt(e.position)))r=!1;else{if(62!==a)return!1;r=!0}for(e.kind="scalar",e.result="";0!==a;)if(43===(a=e.input.charCodeAt(++e.position))||45===a)1===l?l=43===a?3:2:D(e,"repeat of a chomping mode identifier");else{if(!((o=48<=(s=a)&&s<=57?s-48:-1)>=0))break;0===o?D(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?D(e,"repeat of an indentation width identifier"):(d=t+o-1,u=!0)}if(g(a)){do{a=e.input.charCodeAt(++e.position)}while(g(a));if(35===a)do{a=e.input.charCodeAt(++e.position)}while(!m(a)&&0!==a)}for(;0!==a;){for(M(e),e.lineIndent=0,a=e.input.charCodeAt(e.position);(!u||e.lineIndent<d)&&32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>d&&(d=e.lineIndent),m(a))h++;else{if(e.lineIndent<d){3===l?e.result+=i.repeat("\n",c?1+h:h):1===l&&c&&(e.result+="\n");break}for(r?g(a)?(p=!0,e.result+=i.repeat("\n",c?1+h:h)):p?(p=!1,e.result+=i.repeat("\n",h+1)):0===h?c&&(e.result+=" "):e.result+=i.repeat("\n",h):e.result+=i.repeat("\n",c?1+h:h),c=!0,u=!0,h=0,n=e.position;!m(a)&&0!==a;)a=e.input.charCodeAt(++e.position);N(e,n,e.position,!1)}}return!0}(e,p)||function(e,t){var n,i,r;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,i=r=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(N(e,i,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;i=e.position,e.position++,r=e.position}else m(n)?(N(e,i,r,!0),L(e,k(e,!1,t)),i=r=e.position):e.position===e.lineStart&&R(e)?D(e,"unexpected end of the document within a single quoted scalar"):(e.position++,r=e.position);D(e,"unexpected end of the stream within a single quoted scalar")}(e,p)||function(e,t){var n,i,r,o,a,s,l;if(34!==(s=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;0!==(s=e.input.charCodeAt(e.position));){if(34===s)return N(e,n,e.position,!0),e.position++,!0;if(92===s){if(N(e,n,e.position,!0),m(s=e.input.charCodeAt(++e.position)))k(e,!1,t);else if(s<256&&b[s])e.result+=x[s],e.position++;else if((a=120===(l=s)?2:117===l?4:85===l?8:0)>0){for(r=a,o=0;r>0;r--)(a=_(s=e.input.charCodeAt(++e.position)))>=0?o=(o<<4)+a:D(e,"expected hexadecimal character");e.result+=E(o),e.position++}else D(e,"unknown escape sequence");n=i=e.position}else m(s)?(N(e,n,i,!0),L(e,k(e,!1,t)),n=i=e.position):e.position===e.lineStart&&R(e)?D(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}D(e,"unexpected end of the stream within a double quoted scalar")}(e,p)?I=!0:function(e){var t,n,i;if(42!==(i=e.input.charCodeAt(e.position)))return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!v(i)&&!y(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&D(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),e.anchorMap.hasOwnProperty(n)||D(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],k(e,!0,-1),!0}(e)?(I=!0,null===e.tag&&null===e.anchor||D(e,"alias node should not have any properties")):function(e,t,n){var i,r,o,a,s,l,c,u,d=e.kind,h=e.result;if(v(u=e.input.charCodeAt(e.position))||y(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(v(i=e.input.charCodeAt(e.position+1))||n&&y(i)))return!1;for(e.kind="scalar",e.result="",r=o=e.position,a=!1;0!==u;){if(58===u){if(v(i=e.input.charCodeAt(e.position+1))||n&&y(i))break}else if(35===u){if(v(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&R(e)||n&&y(u))break;if(m(u)){if(s=e.line,l=e.lineStart,c=e.lineIndent,k(e,!1,-1),e.lineIndent>=t){a=!0,u=e.input.charCodeAt(e.position);continue}e.position=o,e.line=s,e.lineStart=l,e.lineIndent=c;break}}a&&(N(e,r,o,!1),L(e,e.line-s),r=o=e.position,a=!1),g(u)||(o=e.position+1),u=e.input.charCodeAt(++e.position)}return N(e,r,o,!1),!!e.result||(e.kind=d,e.result=h,!1)}(e,p,1===n)&&(I=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===w&&(I=c&&F(e,f))),null!==e.tag&&"!"!==e.tag)if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&D(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,d=e.implicitTypes.length;u<d;u+=1)if((h=e.implicitTypes[u]).resolve(e.result)){e.result=h.construct(e.result),e.tag=h.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else l.call(e.typeMap[e.kind||"fallback"],e.tag)?(h=e.typeMap[e.kind||"fallback"][e.tag],null!==e.result&&h.kind!==e.kind&&D(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+h.kind+'", not "'+e.kind+'"'),h.resolve(e.result)?(e.result=h.construct(e.result),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):D(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):D(e,"unknown tag !<"+e.tag+">");return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||I}function W(e){var t,n,i,r,o=e.position,a=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};0!==(r=e.input.charCodeAt(e.position))&&(k(e,!0,-1),r=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==r));){for(a=!0,r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!v(r);)r=e.input.charCodeAt(++e.position);for(i=[],(n=e.input.slice(t,e.position)).length<1&&D(e,"directive name must not be less than one character in length");0!==r;){for(;g(r);)r=e.input.charCodeAt(++e.position);if(35===r){do{r=e.input.charCodeAt(++e.position)}while(0!==r&&!m(r));break}if(m(r))break;for(t=e.position;0!==r&&!v(r);)r=e.input.charCodeAt(++e.position);i.push(e.input.slice(t,e.position))}0!==r&&M(e),l.call(T,n)?T[n](e,n,i):A(e,'unknown document directive "'+n+'"')}k(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,k(e,!0,-1)):a&&D(e,"directives end mark is expected"),V(e,e.lineIndent-1,4,!1,!0),k(e,!0,-1),e.checkLineBreaks&&u.test(e.input.slice(o,e.position))&&A(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&R(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,k(e,!0,-1)):e.position<e.length-1&&D(e,"end of the stream or a document separator is expected")}function j(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new I(e,t),i=e.indexOf("\0");for(-1!==i&&(n.position=i,D(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)W(n);return n.documents}function H(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var i=j(e,n);if("function"!=typeof t)return i;for(var r=0,o=i.length;r<o;r+=1)t(i[r])}function z(e,t){var n=j(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new r("expected a single document in the stream, but found more")}}e.exports.loadAll=H,e.exports.load=z,e.exports.safeLoadAll=function(e,t,n){return"object"==typeof t&&null!==t&&void 0===n&&(n=t,t=null),H(e,t,i.extend({schema:a},n))},e.exports.safeLoad=function(e,t){return z(e,i.extend({schema:a},t))}},function(e,t,n){"use strict";var i=n(38);function r(e,t,n,i,r){this.name=e,this.buffer=t,this.position=n,this.line=i,this.column=r}r.prototype.getSnippet=function(e,t){var n,r,o,a,s;if(!this.buffer)return null;for(e=e||4,t=t||75,n="",r=this.position;r>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(r-=1,this.position-r>t/2-1){n=" ... ",r+=5;break}for(o="",a=this.position;a<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(a));)if((a+=1)-this.position>t/2-1){o=" ... ",a-=5;break}return s=this.buffer.slice(r,a),i.repeat(" ",e)+n+s+o+"\n"+i.repeat(" ",e+this.position-r+n.length)+"^"},r.prototype.toString=function(e){var t,n="";return this.name&&(n+='in "'+this.name+'" '),n+="at line "+(this.line+1)+", column "+(this.column+1),e||(t=this.getSnippet())&&(n+=":\n"+t),n},e.exports=r},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var i=n(38),r=n(10);function o(e){return 48<=e&&e<=55}function a(e){return 48<=e&&e<=57}e.exports=new r("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,i=e.length,r=0,s=!1;if(!i)return!1;if("-"!==(t=e[r])&&"+"!==t||(t=e[++r]),"0"===t){if(r+1===i)return!0;if("b"===(t=e[++r])){for(r++;r<i;r++)if("_"!==(t=e[r])){if("0"!==t&&"1"!==t)return!1;s=!0}return s&&"_"!==t}if("x"===t){for(r++;r<i;r++)if("_"!==(t=e[r])){if(!(48<=(n=e.charCodeAt(r))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;s=!0}return s&&"_"!==t}for(;r<i;r++)if("_"!==(t=e[r])){if(!o(e.charCodeAt(r)))return!1;s=!0}return s&&"_"!==t}if("_"===t)return!1;for(;r<i;r++)if("_"!==(t=e[r])){if(":"===t)break;if(!a(e.charCodeAt(r)))return!1;s=!0}return!(!s||"_"===t)&&(":"!==t||/^(:[0-5]?[0-9])+$/.test(e.slice(r)))},construct:function(e){var t,n,i=e,r=1,o=[];return-1!==i.indexOf("_")&&(i=i.replace(/_/g,"")),"-"!==(t=i[0])&&"+"!==t||("-"===t&&(r=-1),t=(i=i.slice(1))[0]),"0"===i?0:"0"===t?"b"===i[1]?r*parseInt(i.slice(2),2):"x"===i[1]?r*parseInt(i,16):r*parseInt(i,8):-1!==i.indexOf(":")?(i.split(":").forEach(function(e){o.unshift(parseInt(e,10))}),i=0,n=1,o.forEach(function(e){i+=e*n,n*=60}),r*i):r*parseInt(i,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!i.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0"+e.toString(8):"-0"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(e,t,n){"use strict";var i=n(38),r=n(10),o=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),a=/^[-+]?[0-9]+e/;e.exports=new r("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!o.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n,i,r;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,r=[],"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:t.indexOf(":")>=0?(t.split(":").forEach(function(e){r.unshift(parseFloat(e,10))}),t=0,i=1,r.forEach(function(e){t+=e*i,i*=60}),n*t):n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||i.isNegativeZero(e))},represent:function(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(i.isNegativeZero(e))return"-0.0";return n=e.toString(10),a.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var i=n(10),r=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),o=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");e.exports=new i("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==r.exec(e)||null!==o.exec(e))},construct:function(e){var t,n,i,a,s,l,c,u,d=0,h=null;if(null===(t=r.exec(e))&&(t=o.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,a=+t[3],!t[4])return new Date(Date.UTC(n,i,a));if(s=+t[4],l=+t[5],c=+t[6],t[7]){for(d=t[7].slice(0,3);d.length<3;)d+="0";d=+d}return t[9]&&(h=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(h=-h)),u=new Date(Date.UTC(n,i,a,s,l,c,d)),h&&u.setTime(u.getTime()-h),u},instanceOf:Date,represent:function(e){return e.toISOString()}})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}})},function(e,t,n){"use strict";var i;try{i=n(145).Buffer}catch(e){}var r=n(10),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";e.exports=new r("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,i=0,r=e.length,a=o;for(n=0;n<r;n++)if(!((t=a.indexOf(e.charAt(n)))>64)){if(t<0)return!1;i+=6}return i%8==0},construct:function(e){var t,n,r=e.replace(/[\r\n=]/g,""),a=r.length,s=o,l=0,c=[];for(t=0;t<a;t++)t%4==0&&t&&(c.push(l>>16&255),c.push(l>>8&255),c.push(255&l)),l=l<<6|s.indexOf(r.charAt(t));return 0==(n=a%4*6)?(c.push(l>>16&255),c.push(l>>8&255),c.push(255&l)):18===n?(c.push(l>>10&255),c.push(l>>2&255)):12===n&&c.push(l>>4&255),i?i.from?i.from(c):new i(c):c},predicate:function(e){return i&&i.isBuffer(e)},represent:function(e){var t,n,i="",r=0,a=e.length,s=o;for(t=0;t<a;t++)t%3==0&&t&&(i+=s[r>>18&63],i+=s[r>>12&63],i+=s[r>>6&63],i+=s[63&r]),r=(r<<8)+e[t];return 0==(n=a%3)?(i+=s[r>>18&63],i+=s[r>>12&63],i+=s[r>>6&63],i+=s[63&r]):2===n?(i+=s[r>>10&63],i+=s[r>>4&63],i+=s[r<<2&63],i+=s[64]):1===n&&(i+=s[r>>2&63],i+=s[r<<4&63],i+=s[64],i+=s[64]),i}})},function(e,t,n){"use strict";var i=n(10),r=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=new i("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,i,a,s,l=[],c=e;for(t=0,n=c.length;t<n;t+=1){if(i=c[t],s=!1,"[object Object]"!==o.call(i))return!1;for(a in i)if(r.call(i,a)){if(s)return!1;s=!0}if(!s)return!1;if(-1!==l.indexOf(a))return!1;l.push(a)}return!0},construct:function(e){return null!==e?e:[]}})},function(e,t,n){"use strict";var i=n(10),r=Object.prototype.toString;e.exports=new i("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,i,o,a,s=e;for(a=new Array(s.length),t=0,n=s.length;t<n;t+=1){if(i=s[t],"[object Object]"!==r.call(i))return!1;if(1!==(o=Object.keys(i)).length)return!1;a[t]=[o[0],i[o[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,i,r,o,a=e;for(o=new Array(a.length),t=0,n=a.length;t<n;t+=1)i=a[t],r=Object.keys(i),o[t]=[r[0],i[r[0]]];return o}})},function(e,t,n){"use strict";var i=n(10),r=Object.prototype.hasOwnProperty;e.exports=new i("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(r.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(e){return void 0===e},represent:function(){return""}})},function(e,t,n){"use strict";var i=n(10);e.exports=new i("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(e){if(null===e)return!1;if(0===e.length)return!1;var t=e,n=/\/([gim]*)$/.exec(e),i="";if("/"===t[0]){if(n&&(i=n[1]),i.length>3)return!1;if("/"!==t[t.length-i.length-1])return!1}return!0},construct:function(e){var t=e,n=/\/([gim]*)$/.exec(e),i="";return"/"===t[0]&&(n&&(i=n[1]),t=t.slice(1,t.length-i.length-1)),new RegExp(t,i)},predicate:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},represent:function(e){var t="/"+e.source+"/";return e.global&&(t+="g"),e.multiline&&(t+="m"),e.ignoreCase&&(t+="i"),t}})},function(e,t,n){"use strict";var i;try{i=n(302)}catch(e){"undefined"!=typeof window&&(i=window.esprima)}var r=n(10);e.exports=new r("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(e){if(null===e)return!1;try{var t="("+e+")",n=i.parse(t,{range:!0});return"Program"===n.type&&1===n.body.length&&"ExpressionStatement"===n.body[0].type&&("ArrowFunctionExpression"===n.body[0].expression.type||"FunctionExpression"===n.body[0].expression.type)}catch(e){return!1}},construct:function(e){var t,n="("+e+")",r=i.parse(n,{range:!0}),o=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"ArrowFunctionExpression"!==r.body[0].expression.type&&"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach(function(e){o.push(e.name)}),t=r.body[0].expression.body.range,"BlockStatement"===r.body[0].expression.body.type?new Function(o,n.slice(t[0]+1,t[1]-1)):new Function(o,"return "+n.slice(t[0],t[1]))},predicate:function(e){return"[object Function]"===Object.prototype.toString.call(e)},represent:function(e){return e.toString()}})},function(e,t,n){var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(3),o=n(8),a=n(15);function s(e,t,n){var a=null,s=function(e,t){n&&n(e,t),a&&a.visit(e,t)},l="function"==typeof n?s:null,c=!1;if(t){c="boolean"==typeof t.comment&&t.comment;var u="boolean"==typeof t.attachComment&&t.attachComment;(c||u)&&((a=new i.CommentHandler).attach=u,t.comment=!0,l=s)}var d,h=!1;t&&"string"==typeof t.sourceType&&(h="module"===t.sourceType),d=t&&"boolean"==typeof t.jsx&&t.jsx?new r.JSXParser(e,t,l):new o.Parser(e,t,l);var p=h?d.parseModule():d.parseScript();return c&&a&&(p.comments=a.comments),d.config.tokens&&(p.tokens=d.tokens),d.config.tolerant&&(p.errors=d.errorHandler.errors),p}t.parse=s,t.parseModule=function(e,t,n){var i=t||{};return i.sourceType="module",s(e,i,n)},t.parseScript=function(e,t,n){var i=t||{};return i.sourceType="script",s(e,i,n)},t.tokenize=function(e,t,n){var i,r=new a.Tokenizer(e,t);i=[];try{for(;;){var o=r.getNextToken();if(!o)break;n&&(o=n(o)),i.push(o)}}catch(e){r.errorHandler.tolerate(e)}return r.errorHandler.tolerant&&(i.errors=r.errors()),i};var l=n(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===i.Syntax.BlockStatement&&0===e.body.length){for(var n=[],r=this.leading.length-1;r>=0;--r){var o=this.leading[r];t.end.offset>=o.start&&(n.unshift(o.comment),this.leading.splice(r,1),this.trailing.splice(r,1))}n.length&&(e.innerComments=n)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var n=this.trailing.length-1;n>=0;--n){var i=this.trailing[n];i.start>=e.end.offset&&t.unshift(i.comment)}return this.trailing.length=0,t}var r=this.stack[this.stack.length-1];if(r&&r.node.trailingComments){var o=r.node.trailingComments[0];o&&o.range[0]>=e.end.offset&&(t=r.node.trailingComments,delete r.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,n=[];this.stack.length>0&&(o=this.stack[this.stack.length-1])&&o.start>=e.start.offset;)t=o.node,this.stack.pop();if(t){for(var i=(t.leadingComments?t.leadingComments.length:0)-1;i>=0;--i){var r=t.leadingComments[i];r.range[1]<=e.start.offset&&(n.unshift(r),t.leadingComments.splice(i,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,n}for(i=this.leading.length-1;i>=0;--i){var o;(o=this.leading[i]).start<=e.start.offset&&(n.unshift(o.comment),this.leading.splice(i,1))}return n},e.prototype.visitNode=function(e,t){if(!(e.type===i.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var n=this.findTrailingComments(t),r=this.findLeadingComments(t);r.length>0&&(e.leadingComments=r),n.length>0&&(e.trailingComments=n),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var n="L"===e.type[0]?"Line":"Block",i={type:n,value:e.value};if(e.range&&(i.range=e.range),e.loc&&(i.loc=e.loc),this.comments.push(i),this.attach){var r={comment:{type:n,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(r.comment.loc=e.loc),e.type=n,this.leading.push(r),this.trailing.push(r)}},e.prototype.visit=function(e,t){"LineComment"===e.type||"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=r},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(5),s=n(6),l=n(7),c=n(8),u=n(13),d=n(14);function h(e){var t;switch(e.type){case s.JSXSyntax.JSXIdentifier:t=e.name;break;case s.JSXSyntax.JSXNamespacedName:var n=e;t=h(n.namespace)+":"+h(n.name);break;case s.JSXSyntax.JSXMemberExpression:var i=e;t=h(i.object)+"."+h(i.property)}return t}u.TokenName[100]="JSXIdentifier",u.TokenName[101]="JSXText";var p=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return r(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",n=!0,i=!1,r=!1,a=!1;!this.scanner.eof()&&n&&!i;){var s=this.scanner.source[this.scanner.index];if(s===e)break;if(i=";"===s,t+=s,++this.scanner.index,!i)switch(t.length){case 2:r="#"===s;break;case 3:r&&(n=(a="x"===s)||o.Character.isDecimalDigit(s.charCodeAt(0)),r=r&&!a);break;default:n=(n=n&&!(r&&!o.Character.isDecimalDigit(s.charCodeAt(0))))&&!(a&&!o.Character.isHexDigit(s.charCodeAt(0)))}}if(n&&i&&t.length>2){var l=t.substr(1,t.length-2);r&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):a&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):r||a||!d.XHTMLEntities[l]||(t=d.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:s=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,n=this.scanner.source[this.scanner.index++],i="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==n;)i+="&"===l?this.scanXHTMLEntity(n):l;return{type:8,value:i,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var r=this.scanner.source.charCodeAt(this.scanner.index+1),a=this.scanner.source.charCodeAt(this.scanner.index+2),s=46===r&&46===a?"...":".";return t=this.scanner.index,this.scanner.index+=s.length,{type:7,value:s,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(o.Character.isIdentifierStart(e)&&92!==e){for(t=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(o.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var n=this.scanner.source[this.scanner.index];if("{"===n||"<"===n)break;++this.scanner.index,t+=n,o.Character.isLineTerminator(n.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===n&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var i={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(i)),i},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new a.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var n=t;this.expectJSX(":");var i=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXNamespacedName(n,i))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var r=t;this.expectJSX(".");var o=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXMemberExpression(r,o))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),n=this.parseJSXIdentifier();if(this.matchJSX(":")){var i=n;this.expectJSX(":");var r=this.parseJSXIdentifier();e=this.finalize(t,new a.JSXNamespacedName(i,r))}else e=n;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var n=this.getTokenRaw(t);return this.finalize(e,new l.Literal(t.value,n))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),n=null;return this.matchJSX("=")&&(this.expectJSX("="),n=this.parseJSXAttributeValue()),this.finalize(e,new a.JSXAttribute(t,n))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),n=this.parseJSXAttributes(),i=this.matchJSX("/");return i&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(t,i,n))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new a.JSXClosingElement(t))}var n=this.parseJSXElementName(),i=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(n,r,i))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new a.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new a.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),n=this.nextJSXText();if(n.start<n.end){var i=this.getTokenRaw(n),r=this.finalize(t,new a.JSXText(n.value,i));e.push(r)}if("{"!==this.scanner.source[this.scanner.index])break;var o=this.parseJSXExpressionContainer();e.push(o)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var n=this.createJSXChildNode(),i=this.parseJSXBoundaryElement();if(i.type===s.JSXSyntax.JSXOpeningElement){var r=i;if(r.selfClosing){var o=this.finalize(n,new a.JSXElement(r,[],null));e.children.push(o)}else t.push(e),e={node:n,opening:r,closing:null,children:[]}}if(i.type===s.JSXSyntax.JSXClosingElement){e.closing=i;var l=h(e.opening.name);if(l!==h(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;o=this.finalize(e.node,new a.JSXElement(e.opening,e.children,e.closing)),(e=t[t.length-1]).children.push(o),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),n=[],i=null;if(!t.selfClosing){var r=this.parseComplexJSXElement({node:e,opening:t,closing:i,children:n});n=r.children,i=r.closing}return this.finalize(e,new a.JSXElement(t,n,i))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(c.Parser);t.JSXParser=p},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&n.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&n.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=function(e){this.type=i.JSXSyntax.JSXClosingElement,this.name=e};t.JSXClosingElement=r;var o=function(e,t,n){this.type=i.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=n};t.JSXElement=o;var a=function(){this.type=i.JSXSyntax.JSXEmptyExpression};t.JSXEmptyExpression=a;var s=function(e){this.type=i.JSXSyntax.JSXExpressionContainer,this.expression=e};t.JSXExpressionContainer=s;var l=function(e){this.type=i.JSXSyntax.JSXIdentifier,this.name=e};t.JSXIdentifier=l;var c=function(e,t){this.type=i.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t};t.JSXMemberExpression=c;var u=function(e,t){this.type=i.JSXSyntax.JSXAttribute,this.name=e,this.value=t};t.JSXAttribute=u;var d=function(e,t){this.type=i.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t};t.JSXNamespacedName=d;var h=function(e,t,n){this.type=i.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=n};t.JSXOpeningElement=h;var p=function(e){this.type=i.JSXSyntax.JSXSpreadAttribute,this.argument=e};t.JSXSpreadAttribute=p;var f=function(e,t){this.type=i.JSXSyntax.JSXText,this.value=e,this.raw=t};t.JSXText=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(e){this.type=i.Syntax.ArrayExpression,this.elements=e};t.ArrayExpression=r;var o=function(e){this.type=i.Syntax.ArrayPattern,this.elements=e};t.ArrayPattern=o;var a=function(e,t,n){this.type=i.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!1};t.ArrowFunctionExpression=a;var s=function(e,t,n){this.type=i.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=n};t.AssignmentExpression=s;var l=function(e,t){this.type=i.Syntax.AssignmentPattern,this.left=e,this.right=t};t.AssignmentPattern=l;var c=function(e,t,n){this.type=i.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!0};t.AsyncArrowFunctionExpression=c;var u=function(e,t,n){this.type=i.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionDeclaration=u;var d=function(e,t,n){this.type=i.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionExpression=d;var h=function(e){this.type=i.Syntax.AwaitExpression,this.argument=e};t.AwaitExpression=h;var p=function(e,t,n){var r="||"===e||"&&"===e;this.type=r?i.Syntax.LogicalExpression:i.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=n};t.BinaryExpression=p;var f=function(e){this.type=i.Syntax.BlockStatement,this.body=e};t.BlockStatement=f;var m=function(e){this.type=i.Syntax.BreakStatement,this.label=e};t.BreakStatement=m;var g=function(e,t){this.type=i.Syntax.CallExpression,this.callee=e,this.arguments=t};t.CallExpression=g;var v=function(e,t){this.type=i.Syntax.CatchClause,this.param=e,this.body=t};t.CatchClause=v;var y=function(e){this.type=i.Syntax.ClassBody,this.body=e};t.ClassBody=y;var _=function(e,t,n){this.type=i.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=n};t.ClassDeclaration=_;var w=function(e,t,n){this.type=i.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=n};t.ClassExpression=w;var E=function(e,t){this.type=i.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t};t.ComputedMemberExpression=E;var b=function(e,t,n){this.type=i.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n};t.ConditionalExpression=b;var x=function(e){this.type=i.Syntax.ContinueStatement,this.label=e};t.ContinueStatement=x;var C=function(){this.type=i.Syntax.DebuggerStatement};t.DebuggerStatement=C;var I=function(e,t){this.type=i.Syntax.ExpressionStatement,this.expression=e,this.directive=t};t.Directive=I;var S=function(e,t){this.type=i.Syntax.DoWhileStatement,this.body=e,this.test=t};t.DoWhileStatement=S;var D=function(){this.type=i.Syntax.EmptyStatement};t.EmptyStatement=D;var A=function(e){this.type=i.Syntax.ExportAllDeclaration,this.source=e};t.ExportAllDeclaration=A;var T=function(e){this.type=i.Syntax.ExportDefaultDeclaration,this.declaration=e};t.ExportDefaultDeclaration=T;var N=function(e,t,n){this.type=i.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=n};t.ExportNamedDeclaration=N;var O=function(e,t){this.type=i.Syntax.ExportSpecifier,this.exported=t,this.local=e};t.ExportSpecifier=O;var P=function(e){this.type=i.Syntax.ExpressionStatement,this.expression=e};t.ExpressionStatement=P;var M=function(e,t,n){this.type=i.Syntax.ForInStatement,this.left=e,this.right=t,this.body=n,this.each=!1};t.ForInStatement=M;var k=function(e,t,n){this.type=i.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=n};t.ForOfStatement=k;var R=function(e,t,n,r){this.type=i.Syntax.ForStatement,this.init=e,this.test=t,this.update=n,this.body=r};t.ForStatement=R;var L=function(e,t,n,r){this.type=i.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=r,this.expression=!1,this.async=!1};t.FunctionDeclaration=L;var F=function(e,t,n,r){this.type=i.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=r,this.expression=!1,this.async=!1};t.FunctionExpression=F;var U=function(e){this.type=i.Syntax.Identifier,this.name=e};t.Identifier=U;var B=function(e,t,n){this.type=i.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=n};t.IfStatement=B;var V=function(e,t){this.type=i.Syntax.ImportDeclaration,this.specifiers=e,this.source=t};t.ImportDeclaration=V;var W=function(e){this.type=i.Syntax.ImportDefaultSpecifier,this.local=e};t.ImportDefaultSpecifier=W;var j=function(e){this.type=i.Syntax.ImportNamespaceSpecifier,this.local=e};t.ImportNamespaceSpecifier=j;var H=function(e,t){this.type=i.Syntax.ImportSpecifier,this.local=e,this.imported=t};t.ImportSpecifier=H;var z=function(e,t){this.type=i.Syntax.LabeledStatement,this.label=e,this.body=t};t.LabeledStatement=z;var G=function(e,t){this.type=i.Syntax.Literal,this.value=e,this.raw=t};t.Literal=G;var q=function(e,t){this.type=i.Syntax.MetaProperty,this.meta=e,this.property=t};t.MetaProperty=q;var $=function(e,t,n,r,o){this.type=i.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=n,this.kind=r,this.static=o};t.MethodDefinition=$;var X=function(e){this.type=i.Syntax.Program,this.body=e,this.sourceType="module"};t.Module=X;var K=function(e,t){this.type=i.Syntax.NewExpression,this.callee=e,this.arguments=t};t.NewExpression=K;var Y=function(e){this.type=i.Syntax.ObjectExpression,this.properties=e};t.ObjectExpression=Y;var J=function(e){this.type=i.Syntax.ObjectPattern,this.properties=e};t.ObjectPattern=J;var Z=function(e,t,n,r,o,a){this.type=i.Syntax.Property,this.key=t,this.computed=n,this.value=r,this.kind=e,this.method=o,this.shorthand=a};t.Property=Z;var Q=function(e,t,n,r){this.type=i.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:n,flags:r}};t.RegexLiteral=Q;var ee=function(e){this.type=i.Syntax.RestElement,this.argument=e};t.RestElement=ee;var te=function(e){this.type=i.Syntax.ReturnStatement,this.argument=e};t.ReturnStatement=te;var ne=function(e){this.type=i.Syntax.Program,this.body=e,this.sourceType="script"};t.Script=ne;var ie=function(e){this.type=i.Syntax.SequenceExpression,this.expressions=e};t.SequenceExpression=ie;var re=function(e){this.type=i.Syntax.SpreadElement,this.argument=e};t.SpreadElement=re;var oe=function(e,t){this.type=i.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t};t.StaticMemberExpression=oe;var ae=function(){this.type=i.Syntax.Super};t.Super=ae;var se=function(e,t){this.type=i.Syntax.SwitchCase,this.test=e,this.consequent=t};t.SwitchCase=se;var le=function(e,t){this.type=i.Syntax.SwitchStatement,this.discriminant=e,this.cases=t};t.SwitchStatement=le;var ce=function(e,t){this.type=i.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t};t.TaggedTemplateExpression=ce;var ue=function(e,t){this.type=i.Syntax.TemplateElement,this.value=e,this.tail=t};t.TemplateElement=ue;var de=function(e,t){this.type=i.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t};t.TemplateLiteral=de;var he=function(){this.type=i.Syntax.ThisExpression};t.ThisExpression=he;var pe=function(e){this.type=i.Syntax.ThrowStatement,this.argument=e};t.ThrowStatement=pe;var fe=function(e,t,n){this.type=i.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=n};t.TryStatement=fe;var me=function(e,t){this.type=i.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0};t.UnaryExpression=me;var ge=function(e,t,n){this.type=i.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=n};t.UpdateExpression=ge;var ve=function(e,t){this.type=i.Syntax.VariableDeclaration,this.declarations=e,this.kind=t};t.VariableDeclaration=ve;var ye=function(e,t){this.type=i.Syntax.VariableDeclarator,this.id=e,this.init=t};t.VariableDeclarator=ye;var _e=function(e,t){this.type=i.Syntax.WhileStatement,this.test=e,this.body=t};t.WhileStatement=_e;var we=function(e,t){this.type=i.Syntax.WithStatement,this.object=e,this.body=t};t.WithStatement=we;var Ee=function(e,t){this.type=i.Syntax.YieldExpression,this.argument=e,this.delegate=t};t.YieldExpression=Ee},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(10),o=n(11),a=n(7),s=n(12),l=n(2),c=n(13),u=function(){function e(e,t,n){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=n,this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new s.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,function(e,t){return i.assert(t<r.length,"Message reference must be in range"),r[t]}),a=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1;throw this.errorHandler.createError(a,s,l,o)},e.prototype.tolerateError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,function(e,t){return i.assert(t<r.length,"Message reference must be in range"),r[t]}),a=this.lastMarker.index,s=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(a,s,l,o)},e.prototype.unexpectedTokenError=function(e,t){var n,i=t||o.Messages.UnexpectedToken;if(e?(t||(i=2===e.type?o.Messages.UnexpectedEOS:3===e.type?o.Messages.UnexpectedIdentifier:6===e.type?o.Messages.UnexpectedNumber:8===e.type?o.Messages.UnexpectedString:10===e.type?o.Messages.UnexpectedTemplate:o.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?i=o.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(i=o.Messages.StrictReservedWord))),n=e.value):n="ILLEGAL",i=i.replace("%0",n),e&&"number"==typeof e.lineNumber){var r=e.start,a=e.lineNumber,s=this.lastMarker.index-this.lastMarker.column,l=e.start-s+1;return this.errorHandler.createError(r,a,l,i)}return r=this.lastMarker.index,a=this.lastMarker.line,l=this.lastMarker.column+1,this.errorHandler.createError(r,a,l,i)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var n=e[t],i=void 0;i={type:n.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(n.slice[0],n.slice[1])},this.config.range&&(i.range=n.range),this.config.loc&&(i.loc=n.loc);var r={start:{line:n.loc.start.line,column:n.loc.start.column,offset:n.range[0]},end:{line:n.loc.end.line,column:n.loc.end.column,offset:n.range[1]}};this.delegate(i,r)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:c.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var n=e.pattern,i=e.flags;t.regex={pattern:n,flags:i}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var n=e.start-e.lineStart,i=e.lineNumber;return n<0&&(n+=t,i--),{index:e.start,line:i,column:n}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var n={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,n)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,o.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var r=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=n,this.context.firstCoverInitializedNameError=i,r},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var r=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&n,this.context.firstCoverInitializedNameError=i||this.context.firstCoverInitializedNameError,r},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,n,i=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(i,new a.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,o.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.Literal(t.value,n));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.Literal("true"===t.value,n));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.Literal(null,n));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.RegexLiteral(t.regex,n,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(i,new a.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(i,new a.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new a.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var n=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(n)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new a.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,n=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var i=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=n,i},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters(),i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,n=this.context.await;this.context.allowYield=!1,this.context.await=!0;var i=this.parseFormalParameters(),r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.context.await=n,this.finalize(e,new a.AsyncFunctionExpression(null,i.params,r))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),n=this.nextToken();switch(n.type){case 8:case 6:this.context.strict&&n.octal&&this.tolerateUnexpectedToken(n,o.Messages.StrictOctalLiteral);var i=this.getTokenRaw(n);e=this.finalize(t,new a.Literal(n.value,i));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new a.Identifier(n.value));break;case 7:"["===n.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(n);break;default:e=this.throwUnexpectedToken(n)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,n=this.createNode(),i=this.lookahead,r=null,s=null,l=!1,c=!1,u=!1,d=!1;if(3===i.type){var h=i.value;this.nextToken(),l=this.match("["),r=(d=!(this.hasLineTerminator||"async"!==h||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(n,new a.Identifier(h))}else this.match("*")?this.nextToken():(l=this.match("["),r=this.parseObjectPropertyKey());var p=this.qualifiedPropertyName(this.lookahead);if(3===i.type&&!d&&"get"===i.value&&p)t="get",l=this.match("["),r=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod();else if(3===i.type&&!d&&"set"===i.value&&p)t="set",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseSetterMethod();else if(7===i.type&&"*"===i.value&&p)t="init",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),c=!0;else if(r||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!d)!l&&this.isPropertyKey(r,"__proto__")&&(e.value&&this.tolerateError(o.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),s=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))s=d?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0;else if(3===i.type)if(h=this.finalize(n,new a.Identifier(i.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),u=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);s=this.finalize(n,new a.AssignmentPattern(h,f))}else u=!0,s=h;else this.throwUnexpectedToken(this.nextToken());return this.finalize(n,new a.Property(t,r,l,s,c,u))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],n={value:!1};!this.match("}");)t.push(this.parseObjectProperty(n)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new a.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){i.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),n=t.value,r=t.cooked;return this.finalize(e,new a.TemplateElement({raw:n,cooked:r},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),n=t.value,i=t.cooked;return this.finalize(e,new a.TemplateElement({raw:n,cooked:i},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],n=[],i=this.parseTemplateHead();for(n.push(i);!i.tail;)t.push(this.parseExpression()),i=this.parseTemplateElement(),n.push(i);return this.finalize(e,new a.TemplateLiteral(n,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:for(e.type=l.Syntax.ObjectPattern,t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var t=this.lookahead,n=[];if(this.match("..."))e=this.parseRestElement(n),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[e],async:!1};else{var i=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var r=[];for(this.context.isAssignmentTarget=!1,r.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var o=0;o<r.length;o++)this.reinterpretExpressionAsPattern(r[o]);i=!0,e={type:"ArrowParameterPlaceHolder",params:r,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),r.push(this.parseRestElement(n)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,o=0;o<r.length;o++)this.reinterpretExpressionAsPattern(r[o]);i=!0,e={type:"ArrowParameterPlaceHolder",params:r,async:!1}}else r.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(i)break}i||(e=this.finalize(this.startNode(t),new a.SequenceExpression(r)))}if(!i){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(i=!0,e={type:"ArrowParameterPlaceHolder",params:[e],async:!1}),!i)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(o=0;o<e.expressions.length;o++)this.reinterpretExpressionAsPattern(e.expressions[o]);else this.reinterpretExpressionAsPattern(e);e={type:"ArrowParameterPlaceHolder",params:e.type===l.Syntax.SequenceExpression?e.expressions:[e],async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new a.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),n=this.parseIdentifierName();if(i.assert("new"===n.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var r=this.parseIdentifierName();e=new a.MetaProperty(n,r)}else this.throwUnexpectedToken(this.lookahead);else{var o=this.isolateCoverGrammar(this.parseLeftHandSideExpression),s=this.match("(")?this.parseArguments():[];e=new a.NewExpression(o,s),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,n=this.matchContextualKeyword("async"),i=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),this.nextToken(),e=this.finalize(e,new a.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var r=this.parseIdentifierName();e=this.finalize(this.startNode(t),new a.StaticMemberExpression(e,r))}else if(this.match("(")){var o=n&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var s=o?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new a.CallExpression(e,s)),o&&this.match("=>")){for(var l=0;l<s.length;++l)this.reinterpretExpressionAsPattern(s[l]);e={type:"ArrowParameterPlaceHolder",params:s,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),r=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),e=this.finalize(this.startNode(t),new a.ComputedMemberExpression(e,r));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var c=this.parseTemplateLiteral();e=this.finalize(this.startNode(t),new a.TaggedTemplateExpression(e,c))}return this.context.allowIn=i,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new a.Super)},e.prototype.parseLeftHandSideExpression=function(){i.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var n=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new a.ComputedMemberExpression(t,n))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),n=this.parseIdentifierName(),t=this.finalize(e,new a.StaticMemberExpression(t,n));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var r=this.parseTemplateLiteral();t=this.finalize(e,new a.TaggedTemplateExpression(t,r))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var n=this.startNode(t),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment);var r=!0;e=this.finalize(n,new a.UpdateExpression(i.value,e,r)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var s=this.nextToken().value;r=!1,e=this.finalize(this.startNode(t),new a.UpdateExpression(s,e,r))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new a.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new a.UnaryExpression(n.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(o.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var n=t,i=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new a.BinaryExpression("**",n,i))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),n=this.lookahead,i=this.binaryPrecedence(n);if(i>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var r=[e,this.lookahead],o=t,s=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[o,n.value,s],c=[i];!((i=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&i<=c[c.length-1];){s=l.pop();var u=l.pop();c.pop(),o=l.pop(),r.pop();var d=this.startNode(r[r.length-1]);l.push(this.finalize(d,new a.BinaryExpression(u,o,s)))}l.push(this.nextToken().value),c.push(i),r.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var h=l.length-1;t=l[h];for(var p=r.pop();h>1;){var f=r.pop(),m=p&&p.lineStart;d=this.startNode(f,m),u=l[h-1],t=this.finalize(d,new a.BinaryExpression(u,l[h-2],t)),h-=2,p=f}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var n=this.context.allowIn;this.context.allowIn=!0;var i=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=n,this.expect(":");var r=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new a.ConditionalExpression(t,i,r)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var n=0;n<t.elements.length;n++)null!==t.elements[n]&&this.checkPatternParam(e,t.elements[n]);break;case l.Syntax.ObjectPattern:for(n=0;n<t.properties.length;n++)this.checkPatternParam(e,t.properties[n].value)}e.simple=e.simple&&t instanceof a.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,n=[e],i=!1;switch(e.type){case l.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":n=e.params,i=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(var r=0;r<n.length;++r)(a=n[r]).type===l.Syntax.AssignmentPattern?a.right.type===l.Syntax.YieldExpression&&(a.right.argument&&this.throwUnexpectedToken(this.lookahead),a.right.type=l.Syntax.Identifier,a.right.name="yield",delete a.right.argument,delete a.right.delegate):i&&a.type===l.Syntax.Identifier&&"await"===a.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,a),n[r]=a;if(this.context.strict||!this.context.allowYield)for(r=0;r<n.length;++r){var a;(a=n[r]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===o.Messages.StrictParamDupe){var s=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(s,t.message)}return{simple:t.simple,params:n,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,n=t;if(e=this.parseConditionalExpression(),3===n.type&&n.lineNumber===this.lookahead.lineNumber&&"async"===n.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var i=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(i),e={type:"ArrowParameterPlaceHolder",params:[i],async:!0}}if("ArrowParameterPlaceHolder"===e.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var r=e.async,s=this.reinterpretAsCoverFormalsList(e);if(s){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var c=this.context.strict,u=this.context.allowStrictDirective;this.context.allowStrictDirective=s.simple;var d=this.context.allowYield,h=this.context.await;this.context.allowYield=!0,this.context.await=r;var p=this.startNode(t);this.expect("=>");var f=void 0;if(this.match("{")){var m=this.context.allowIn;this.context.allowIn=!0,f=this.parseFunctionSourceElements(),this.context.allowIn=m}else f=this.isolateCoverGrammar(this.parseAssignmentExpression);var g=f.type!==l.Syntax.BlockStatement;this.context.strict&&s.firstRestricted&&this.throwUnexpectedToken(s.firstRestricted,s.message),this.context.strict&&s.stricted&&this.tolerateUnexpectedToken(s.stricted,s.message),e=r?this.finalize(p,new a.AsyncArrowFunctionExpression(s.params,f,g)):this.finalize(p,new a.ArrowFunctionExpression(s.params,f,g)),this.context.strict=c,this.context.allowStrictDirective=u,this.context.allowYield=d,this.context.await=h}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(n=this.nextToken()).value,_=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new a.AssignmentExpression(y,e,_)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var n=[];for(n.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),n.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new a.SequenceExpression(n))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new a.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var n=this.createNode(),i=this.parsePattern([],e);this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictVarName);var r=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),r=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(o.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&i.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),r=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(n,new a.VariableDeclarator(i,r))},e.prototype.parseBindingList=function(e,t){for(var n=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),n.push(this.parseLexicalBinding(e,t));return n},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),n=this.nextToken().value;i.assert("let"===n||"const"===n,"Lexical declaration must be either let or const");var r=this.parseBindingList(n,e);return this.consumeSemicolon(),this.finalize(t,new a.VariableDeclaration(r,n))},e.prototype.parseBindingRestElement=function(e,t){var n=this.createNode();this.expect("...");var i=this.parsePattern(e,t);return this.finalize(n,new a.RestElement(i))},e.prototype.parseArrayPattern=function(e,t){var n=this.createNode();this.expect("[");for(var i=[];!this.match("]");)if(this.match(","))this.nextToken(),i.push(null);else{if(this.match("...")){i.push(this.parseBindingRestElement(e,t));break}i.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(n,new a.ArrayPattern(i))},e.prototype.parsePropertyPattern=function(e,t){var n,i,r=this.createNode(),o=!1,s=!1;if(3===this.lookahead.type){var l=this.lookahead;n=this.parseVariableIdentifier();var c=this.finalize(r,new a.Identifier(l.value));if(this.match("=")){e.push(l),s=!0,this.nextToken();var u=this.parseAssignmentExpression();i=this.finalize(this.startNode(l),new a.AssignmentPattern(c,u))}else this.match(":")?(this.expect(":"),i=this.parsePatternWithDefault(e,t)):(e.push(l),s=!0,i=c)}else o=this.match("["),n=this.parseObjectPropertyKey(),this.expect(":"),i=this.parsePatternWithDefault(e,t);return this.finalize(r,new a.Property("init",n,o,i,!1,s))},e.prototype.parseObjectPattern=function(e,t){var n=this.createNode(),i=[];for(this.expect("{");!this.match("}");)i.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(n,new a.ObjectPattern(i))},e.prototype.parsePattern=function(e,t){var n;return this.match("[")?n=this.parseArrayPattern(e,t):this.match("{")?n=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,o.Messages.LetInLexicalBinding),e.push(this.lookahead),n=this.parseVariableIdentifier(t)),n},e.prototype.parsePatternWithDefault=function(e,t){var n=this.lookahead,i=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var r=this.context.allowYield;this.context.allowYield=!0;var o=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=r,i=this.finalize(this.startNode(n),new a.AssignmentPattern(i,o))}return i},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),n=this.nextToken();return 4===n.type&&"yield"===n.value?this.context.strict?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(n):3!==n.type?this.context.strict&&4===n.type&&this.scanner.isStrictModeReservedWord(n.value)?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):(this.context.strict||"let"!==n.value||"var"!==e)&&this.throwUnexpectedToken(n):(this.context.isModule||this.context.await)&&3===n.type&&"await"===n.value&&this.tolerateUnexpectedToken(n),this.finalize(t,new a.Identifier(n.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),n=this.parsePattern([],"var");this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictVarName);var i=null;return this.match("=")?(this.nextToken(),i=this.isolateCoverGrammar(this.parseAssignmentExpression)):n.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new a.VariableDeclarator(n,i))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},n=[];for(n.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),n.push(this.parseVariableDeclaration(t));return n},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new a.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new a.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(o.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),n=null;this.expectKeyword("if"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),n=this.parseIfClause())),this.finalize(t,new a.IfStatement(i,e,n))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var n=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new a.DoWhileStatement(n,i))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var n=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var i=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=i}return this.finalize(t,new a.WhileStatement(n,e))},e.prototype.parseForStatement=function(){var e,t,n,i=null,r=null,s=null,c=!0,u=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){i=this.createNode(),this.nextToken();var d=this.context.allowIn;this.context.allowIn=!1;var h=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=d,1===h.length&&this.matchKeyword("in")){var p=h[0];p.init&&(p.id.type===l.Syntax.ArrayPattern||p.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(o.Messages.ForInOfLoopInitializer,"for-in"),i=this.finalize(i,new a.VariableDeclaration(h,"var")),this.nextToken(),e=i,t=this.parseExpression(),i=null}else 1===h.length&&null===h[0].init&&this.matchContextualKeyword("of")?(i=this.finalize(i,new a.VariableDeclaration(h,"var")),this.nextToken(),e=i,t=this.parseAssignmentExpression(),i=null,c=!1):(i=this.finalize(i,new a.VariableDeclaration(h,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){i=this.createNode();var f=this.nextToken().value;this.context.strict||"in"!==this.lookahead.value?(d=this.context.allowIn,this.context.allowIn=!1,h=this.parseBindingList(f,{inFor:!0}),this.context.allowIn=d,1===h.length&&null===h[0].init&&this.matchKeyword("in")?(i=this.finalize(i,new a.VariableDeclaration(h,f)),this.nextToken(),e=i,t=this.parseExpression(),i=null):1===h.length&&null===h[0].init&&this.matchContextualKeyword("of")?(i=this.finalize(i,new a.VariableDeclaration(h,f)),this.nextToken(),e=i,t=this.parseAssignmentExpression(),i=null,c=!1):(this.consumeSemicolon(),i=this.finalize(i,new a.VariableDeclaration(h,f)))):(i=this.finalize(i,new a.Identifier(f)),this.nextToken(),e=i,t=this.parseExpression(),i=null)}else{var m=this.lookahead;if(d=this.context.allowIn,this.context.allowIn=!1,i=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=d,this.matchKeyword("in"))this.context.isAssignmentTarget&&i.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(i),e=i,t=this.parseExpression(),i=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&i.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(i),e=i,t=this.parseAssignmentExpression(),i=null,c=!1;else{if(this.match(",")){for(var g=[i];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression));i=this.finalize(this.startNode(m),new a.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(r=this.parseExpression()),this.expect(";"),this.match(")")||(s=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),n=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,n=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=v}return void 0===e?this.finalize(u,new a.ForStatement(i,r,s,n)):c?this.finalize(u,new a.ForInStatement(e,t,n)):this.finalize(u,new a.ForOfStatement(e,t,n))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier();t=n;var i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)||this.throwError(o.Messages.UnknownLabel,n.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(o.Messages.IllegalContinue),this.finalize(e,new a.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier(),i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)||this.throwError(o.Messages.UnknownLabel,n.name),t=n}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(o.Messages.IllegalBreak),this.finalize(e,new a.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(o.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=(this.match(";")||this.match("}")||this.hasLineTerminator||2===this.lookahead.type)&&8!==this.lookahead.type&&10!==this.lookahead.type?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(o.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new a.WithStatement(n,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var n=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)n.push(this.parseStatementListItem());return this.finalize(t,new a.SwitchCase(e,n))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var n=this.context.inSwitch;this.context.inSwitch=!0;var i=[],r=!1;for(this.expect("{");!this.match("}");){var s=this.parseSwitchCase();null===s.test&&(r&&this.throwError(o.Messages.MultipleDefaultsInSwitch),r=!0),i.push(s)}return this.expect("}"),this.context.inSwitch=n,this.finalize(e,new a.SwitchStatement(t,i))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),n=this.parseExpression();if(n.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var i=n,r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)&&this.throwError(o.Messages.Redeclaration,"Label",i.name),this.context.labelSet[r]=!0;var s=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),s=this.parseClassDeclaration();else if(this.matchKeyword("function")){var c=this.lookahead,u=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(c,o.Messages.StrictFunction):u.generator&&this.tolerateUnexpectedToken(c,o.Messages.GeneratorInLegacyContext),s=u}else s=this.parseStatement();delete this.context.labelSet[r],e=new a.LabeledStatement(i,s)}else this.consumeSemicolon(),e=new a.ExpressionStatement(n);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(o.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],n=this.parsePattern(t),i={},r=0;r<t.length;r++){var s="$"+t[r].value;Object.prototype.hasOwnProperty.call(i,s)&&this.tolerateError(o.Messages.DuplicateBinding,t[r].value),i[s]=!0}this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictCatchVariable),this.expect(")");var c=this.parseBlock();return this.finalize(e,new a.CatchClause(n,c))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),n=this.matchKeyword("catch")?this.parseCatchClause():null,i=this.matchKeyword("finally")?this.parseFinallyClause():null;return n||i||this.throwError(o.Messages.NoCatchOrFinally),this.finalize(e,new a.TryStatement(t,n,i))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new a.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),n=this.context.labelSet,i=this.context.inIteration,r=this.context.inSwitch,o=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=n,this.context.inIteration=i,this.context.inSwitch=r,this.context.inFunctionBody=o,this.finalize(e,new a.BlockStatement(t))},e.prototype.validateParam=function(e,t,n){var i="$"+n;this.context.strict?(this.scanner.isRestrictedWord(n)&&(e.stricted=t,e.message=o.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,i)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,i)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,i,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[i]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var n=this.parsePattern(e);return this.match("=")&&this.throwError(o.Messages.DefaultRestParameter),this.match(")")||this.throwError(o.Messages.ParameterAfterRestParameter),this.finalize(t,new a.RestElement(n))},e.prototype.parseFormalParameter=function(e){for(var t=[],n=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),i=0;i<t.length;i++)this.validateParam(e,t[i],t[i].value);e.simple=e.simple&&n instanceof a.Identifier,e.params.push(n)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var n=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===n.lineNumber&&4===n.type&&"function"===n.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),n=this.matchContextualKeyword("async");n&&this.nextToken(),this.expectKeyword("function");var i,r=!n&&this.match("*");r&&this.nextToken();var s=null,l=null;if(!e||!this.match("(")){var c=this.lookahead;s=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(l=c,i=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(l=c,i=o.Messages.StrictReservedWord)}var u=this.context.await,d=this.context.allowYield;this.context.await=n,this.context.allowYield=!r;var h=this.parseFormalParameters(l),p=h.params,f=h.stricted;l=h.firstRestricted,h.message&&(i=h.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var v=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,i),this.context.strict&&f&&this.tolerateUnexpectedToken(f,i),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=u,this.context.allowYield=d,n?this.finalize(t,new a.AsyncFunctionDeclaration(s,p,v)):this.finalize(t,new a.FunctionDeclaration(s,p,v,r))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var n,i=!t&&this.match("*");i&&this.nextToken();var r,s=null,l=this.context.await,c=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!i,!this.match("(")){var u=this.lookahead;s=this.context.strict||i||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(r=u,n=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(r=u,n=o.Messages.StrictReservedWord)}var d=this.parseFormalParameters(r),h=d.params,p=d.stricted;r=d.firstRestricted,d.message&&(n=d.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=d.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&r&&this.throwUnexpectedToken(r,n),this.context.strict&&p&&this.tolerateUnexpectedToken(p,n),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=c,t?this.finalize(e,new a.AsyncFunctionExpression(s,h,g)):this.finalize(e,new a.FunctionExpression(s,h,g,i))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),n=this.parseExpression(),i=n.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,i?new a.Directive(n,i):new a.ExpressionStatement(n))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var n=this.lookahead;if(8!==n.type)break;var i=this.parseDirective();t.push(i);var r=i.directive;if("string"!=typeof r)break;"use strict"===r?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,o.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(n,o.Messages.IllegalLanguageModeDirective)):!e&&n.octal&&(e=n)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();n.params.length>0&&this.tolerateError(o.Messages.BadGetterArity);var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!1))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();1!==n.params.length?this.tolerateError(o.Messages.BadSetterArity):n.params[0]instanceof a.RestElement&&this.tolerateError(o.Messages.BadSetterRestParameter);var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();this.context.allowYield=!1;var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,n=!1;if(!this.hasLineTerminator){var i=this.context.allowYield;this.context.allowYield=!1,(n=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=i}return this.finalize(e,new a.YieldExpression(t,n))},e.prototype.parseClassElement=function(e){var t=this.lookahead,n=this.createNode(),i="",r=null,s=null,l=!1,c=!1,u=!1,d=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(r=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,u=!0,l=this.match("["),this.match("*")?this.nextToken():r=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var h=this.lookahead.value;":"!==h&&"("!==h&&"*"!==h&&(d=!0,t=this.lookahead,r=this.parseObjectPropertyKey(),3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,o.Messages.ConstructorIsAsync))}var p=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&p?(i="get",l=this.match("["),r=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod()):"set"===t.value&&p&&(i="set",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseSetterMethod()):7===t.type&&"*"===t.value&&p&&(i="init",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),c=!0),!i&&r&&this.match("(")&&(i="init",s=d?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0),i||this.throwUnexpectedToken(this.lookahead),"init"===i&&(i="method"),l||(u&&this.isPropertyKey(r,"prototype")&&this.throwUnexpectedToken(t,o.Messages.StaticPrototype),!u&&this.isPropertyKey(r,"constructor")&&(("method"!==i||!c||s&&s.generator)&&this.throwUnexpectedToken(t,o.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,o.Messages.DuplicateConstructor):e.value=!0,i="constructor")),this.finalize(n,new a.MethodDefinition(r,l,s,i,u))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new a.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),n=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var i=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var o=this.parseClassBody();return this.context.strict=n,this.finalize(t,new a.ClassDeclaration(i,r,o))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var n=3===this.lookahead.type?this.parseVariableIdentifier():null,i=null;this.matchKeyword("extends")&&(this.nextToken(),i=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var r=this.parseClassBody();return this.context.strict=t,this.finalize(e,new a.ClassExpression(n,i,r))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(o.Messages.InvalidModuleSpecifier);var t=this.nextToken(),n=this.getTokenRaw(t);return this.finalize(e,new a.Literal(t.value,n))},e.prototype.parseImportSpecifier=function(){var e,t,n=this.createNode();return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(n,new a.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new a.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(o.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new a.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import");var n=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{if(this.match("{")?n=n.concat(this.parseNamedImports()):this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(n.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.match("{")?n=n.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(i,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(t,new a.ImportDeclaration(n,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),n=t;return this.matchContextualKeyword("as")&&(this.nextToken(),n=this.parseIdentifierName()),this.finalize(e,new a.ExportSpecifier(t,n))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var n=this.parseFunctionDeclaration(!0);e=this.finalize(t,new a.ExportDefaultDeclaration(n))}else this.matchKeyword("class")?(n=this.parseClassDeclaration(!0),e=this.finalize(t,new a.ExportDefaultDeclaration(n))):this.matchContextualKeyword("async")?(n=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),e=this.finalize(t,new a.ExportDefaultDeclaration(n))):(this.matchContextualKeyword("from")&&this.throwError(o.Messages.UnexpectedToken,this.lookahead.value),n=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),e=this.finalize(t,new a.ExportDefaultDeclaration(n)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(i,this.lookahead.value)}this.nextToken();var r=this.parseModuleSpecifier();this.consumeSemicolon(),e=this.finalize(t,new a.ExportAllDeclaration(r))}else if(4===this.lookahead.type){switch(n=void 0,this.lookahead.value){case"let":case"const":n=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":n=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new a.ExportNamedDeclaration(n,[],null))}else if(this.matchAsyncFunction())n=this.parseFunctionDeclaration(),e=this.finalize(t,new a.ExportNamedDeclaration(n,[],null));else{var s=[],l=null,c=!1;for(this.expect("{");!this.match("}");)c=c||this.matchKeyword("default"),s.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon()):c?(i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause,this.throwError(i,this.lookahead.value)):this.consumeSemicolon(),e=this.finalize(t,new a.ExportNamedDeclaration(null,s,l))}return e},e}();t.Parser=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var n=new Error(e);try{throw n}catch(e){Object.create&&Object.defineProperty&&(n=Object.create(e),Object.defineProperty(n,"column",{value:t}))}return n},e.prototype.createError=function(e,t,n,i){var r="Line "+t+": "+i,o=this.constructError(r,n);return o.index=e,o.lineNumber=t,o.description=i,o},e.prototype.throwError=function(e,t,n,i){throw this.createError(e,t,n,i)},e.prototype.tolerateError=function(e,t,n,i){var r=this.createError(e,t,n,i);if(!this.tolerant)throw r;this.recordError(r)},e}();t.ErrorHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(4),o=n(11);function a(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function s(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,n,i=[];for(this.trackComment&&(i=[],t=this.index-e,n={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var o=this.source.charCodeAt(this.index);if(++this.index,r.Character.isLineTerminator(o)){if(this.trackComment){n.end={line:this.lineNumber,column:this.index-this.lineStart-1};var a={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:n};i.push(a)}return 13===o&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,i}}return this.trackComment&&(n.end={line:this.lineNumber,column:this.index-this.lineStart},a={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:n},i.push(a)),i},e.prototype.skipMultiLineComment=function(){var e,t,n=[];for(this.trackComment&&(n=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var i=this.source.charCodeAt(this.index);if(r.Character.isLineTerminator(i))13===i&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===i){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var o={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};n.push(o)}return n}++this.index}else++this.index}return this.trackComment&&(t.end={line:this.lineNumber,column:this.index-this.lineStart},o={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t},n.push(o)),this.tolerateUnexpectedToken(),n},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var n=this.source.charCodeAt(this.index);if(r.Character.isWhiteSpace(n))++this.index;else if(r.Character.isLineTerminator(n))++this.index,13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===n)if(47===(n=this.source.charCodeAt(this.index+1))){this.index+=2;var i=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(i)),t=!0}else{if(42!==n)break;this.index+=2,i=this.skipMultiLineComment(),this.trackComment&&(e=e.concat(i))}else if(t&&45===n){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3,i=this.skipSingleLineComment(3),this.trackComment&&(e=e.concat(i))}else{if(60!==n||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4,i=this.skipSingleLineComment(4),this.trackComment&&(e=e.concat(i))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var n=this.source.charCodeAt(e+1);n>=56320&&n<=57343&&(t=1024*(t-55296)+n-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,n=0,i=0;i<t;++i){if(this.eof()||!r.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;n=16*n+a(this.source[this.index++])}return String.fromCharCode(n)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],r.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+a(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),r.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!r.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),n=r.Character.fromCodePoint(t);for(this.index+=n.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&r.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),n=e);!this.eof()&&(t=this.codePointAt(this.index),r.Character.isIdentifierPart(t));)n+=e=r.Character.fromCodePoint(t),this.index+=e.length,92===t&&(n=n.substr(0,n.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&r.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),n+=e);return n},e.prototype.octalToDecimal=function(e){var t="0"!==e,n=s(e);return!this.eof()&&r.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,n=8*n+s(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&r.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(n=8*n+s(this.source[this.index++]))),{code:n,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,n=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===n.length?3:this.isKeyword(n)?4:"null"===n?5:"true"===n||"false"===n?1:3)&&t+n.length!==this.index){var i=this.index;this.index=t,this.tolerateUnexpectedToken(o.Messages.InvalidEscapedReservedWord),this.index=i}return{type:e,value:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&r.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),r.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,n="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)n+=this.source[this.index++];return 0===n.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(r.Character.isIdentifierStart(t)||r.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(n,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var n="",i=!1;for(r.Character.isOctalDigit(e.charCodeAt(0))?(i=!0,n="0"+this.source[this.index++]):++this.index;!this.eof()&&r.Character.isOctalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];return i||0!==n.length||this.throwUnexpectedToken(),(r.Character.isIdentifierStart(this.source.charCodeAt(this.index))||r.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(n,8),octal:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!r.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];i.assert(r.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var n="";if("."!==t){if(n=this.source[this.index++],t=this.source[this.index],"0"===n){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&r.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;r.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(n+=this.source[this.index++];r.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(n+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(n+=this.source[this.index++]),r.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;r.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];else this.throwUnexpectedToken();return r.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];i.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var n=!1,a="";!this.eof();){var s=this.source[this.index++];if(s===t){t="";break}if("\\"===s)if((s=this.source[this.index++])&&r.Character.isLineTerminator(s.charCodeAt(0)))++this.lineNumber,"\r"===s&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(s){case"u":if("{"===this.source[this.index])++this.index,a+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(s);null===l&&this.throwUnexpectedToken(),a+=l}break;case"x":var c=this.scanHexEscape(s);null===c&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),a+=c;break;case"n":a+="\n";break;case"r":a+="\r";break;case"t":a+="\t";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;case"8":case"9":a+=s,this.tolerateUnexpectedToken();break;default:if(s&&r.Character.isOctalDigit(s.charCodeAt(0))){var u=this.octalToDecimal(s);n=u.octal||n,a+=String.fromCharCode(u.code)}else a+=s}else{if(r.Character.isLineTerminator(s.charCodeAt(0)))break;a+=s}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:a,octal:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,n=this.index,i="`"===this.source[n],a=!1,s=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){s=1,a=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],r.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var c=this.index,u=this.scanHexEscape(l);null!==u?e+=u:(this.index=c,e+=l)}break;case"x":var d=this.scanHexEscape(l);null===d&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),e+=d;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(r.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral),e+="\0"):r.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral):e+=l}else r.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),i||this.curlyStack.pop(),{type:10,value:this.source.slice(n+1,this.index-s),cooked:e,head:i,tail:a,lineNumber:this.lineNumber,lineStart:this.lineStart,start:n,end:this.index}},e.prototype.testRegExp=function(e,t){var n=e,i=this;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function(e,t,n){var r=parseInt(t||n,16);return r>1114111&&i.throwUnexpectedToken(o.Messages.InvalidRegExp),r<=65535?String.fromCharCode(r):""}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(n)}catch(e){this.throwUnexpectedToken(o.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];i.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],n=!1,a=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],r.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t+=e;else if(r.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(o.Messages.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){a=!0;break}"["===e&&(n=!0)}return a||this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!r.Character.isIdentifierPart(t.charCodeAt(0)))break;if(++this.index,"\\"!==t||this.eof())e+=t;else if("u"===(t=this.source[this.index])){++this.index;var n=this.index,i=this.scanHexEscape("u");if(null!==i)for(e+=i;n<this.index;++n)this.source[n];else this.index=n,e+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),n=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:n,regex:this.testRegExp(t,n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return r.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?r.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():r.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&r.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(12),o=n(13),a=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var n=this.values[this.paren-1];t="if"===n||"while"===n||"for"===n||"with"===n;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(i=this.values[this.curly-4])&&!this.beforeFunctionExpression(i);else if("function"===this.values[this.curly-4]){var i;t=!(i=this.values[this.curly-5])||!this.beforeFunctionExpression(i)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),s=function(){function e(e,t){this.errorHandler=new i.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new r.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new a}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var n=e[t],i=this.scanner.source.slice(n.slice[0],n.slice[1]),r={type:n.multiLine?"BlockComment":"LineComment",value:i};this.trackRange&&(r.range=n.range),this.trackLoc&&(r.loc=n.loc),this.buffer.push(r)}if(!this.scanner.eof()){var a=void 0;this.trackLoc&&(a={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var s="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(s);var l={type:o.TokenName[s.type],value:this.scanner.source.slice(s.start,s.end)};if(this.trackRange&&(l.range=[s.start,s.end]),this.trackLoc&&(a.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=a),9===s.type){var c=s.pattern,u=s.flags;l.regex={pattern:c,flags:u}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=s}])},e.exports=i()},function(e,t,n){"use strict";var i=n(38),r=n(53),o=n(76),a=n(54),s=Object.prototype.toString,l=Object.prototype.hasOwnProperty,c={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},u=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function d(e){var t,n,o;if(t=e.toString(16).toUpperCase(),e<=255)n="x",o=2;else if(e<=65535)n="u",o=4;else{if(!(e<=4294967295))throw new r("code point within a string may not be greater than 0xFFFFFFFF");n="U",o=8}return"\\"+n+i.repeat("0",o-t.length)+t}function h(e){this.schema=e.schema||o,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=i.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,i,r,o,a,s,c;if(null===t)return{};for(n={},r=0,o=(i=Object.keys(t)).length;r<o;r+=1)a=i[r],s=String(t[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(c=e.compiledTypeMap.fallback[a])&&l.call(c.styleAliases,s)&&(s=c.styleAliases[s]),n[a]=s;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function p(e,t){for(var n,r=i.repeat(" ",t),o=0,a=-1,s="",l=e.length;o<l;)-1===(a=e.indexOf("\n",o))?(n=e.slice(o),o=l):(n=e.slice(o,a+1),o=a+1),n.length&&"\n"!==n&&(s+=r),s+=n;return s}function f(e,t){return"\n"+i.repeat(" ",e.indent*t)}function m(e){return 32===e||9===e}function g(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&65279!==e||65536<=e&&e<=1114111}function v(e,t){return g(e)&&65279!==e&&44!==e&&91!==e&&93!==e&&123!==e&&125!==e&&58!==e&&(35!==e||t&&function(e){return g(e)&&!m(e)&&65279!==e&&13!==e&&10!==e}(t))}function y(e){return/^\n* /.test(e)}function _(e,t,n,i,r){var o,a,s,l,c=!1,u=!1,d=-1!==i,h=-1,p=g(l=e.charCodeAt(0))&&65279!==l&&!m(l)&&45!==l&&63!==l&&58!==l&&44!==l&&91!==l&&93!==l&&123!==l&&125!==l&&35!==l&&38!==l&&42!==l&&33!==l&&124!==l&&61!==l&&62!==l&&39!==l&&34!==l&&37!==l&&64!==l&&96!==l&&!m(e.charCodeAt(e.length-1));if(t)for(o=0;o<e.length;o++){if(!g(a=e.charCodeAt(o)))return 5;s=o>0?e.charCodeAt(o-1):null,p=p&&v(a,s)}else{for(o=0;o<e.length;o++){if(10===(a=e.charCodeAt(o)))c=!0,d&&(u=u||o-h-1>i&&" "!==e[h+1],h=o);else if(!g(a))return 5;s=o>0?e.charCodeAt(o-1):null,p=p&&v(a,s)}u=u||d&&o-h-1>i&&" "!==e[h+1]}return c||u?n>9&&y(e)?5:u?4:3:p&&!r(e)?1:2}function w(e,t,n,i){e.dump=function(){if(0===t.length)return"''";if(!e.noCompatMode&&-1!==u.indexOf(t))return"'"+t+"'";var o=e.indent*Math.max(1,n),a=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-o),s=i||e.flowLevel>-1&&n>=e.flowLevel;switch(_(t,s,e.indent,a,function(t){return function(e,t){var n,i;for(n=0,i=e.implicitTypes.length;n<i;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)})){case 1:return t;case 2:return"'"+t.replace(/'/g,"''")+"'";case 3:return"|"+E(t,e.indent)+b(p(t,o));case 4:return">"+E(t,e.indent)+b(p(function(e,t){for(var n,i,r,o=/(\n+)([^\n]*)/g,a=(r=-1!==(r=e.indexOf("\n"))?r:e.length,o.lastIndex=r,x(e.slice(0,r),t)),s="\n"===e[0]||" "===e[0];i=o.exec(e);){var l=i[1],c=i[2];n=" "===c[0],a+=l+(s||n||""===c?"":"\n")+x(c,t),s=n}return a}(t,a),o));case 5:return'"'+function(e){for(var t,n,i,r="",o=0;o<e.length;o++)(t=e.charCodeAt(o))>=55296&&t<=56319&&(n=e.charCodeAt(o+1))>=56320&&n<=57343?(r+=d(1024*(t-55296)+n-56320+65536),o++):r+=!(i=c[t])&&g(t)?e[o]:i||d(t);return r}(t)+'"';default:throw new r("impossible error: invalid scalar style")}}()}function E(e,t){var n=y(e)?String(t):"",i="\n"===e[e.length-1];return n+(!i||"\n"!==e[e.length-2]&&"\n"!==e?i?"":"-":"+")+"\n"}function b(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function x(e,t){if(""===e||" "===e[0])return e;for(var n,i,r=/ [^ ]/g,o=0,a=0,s=0,l="";n=r.exec(e);)(s=n.index)-o>t&&(i=a>o?a:s,l+="\n"+e.slice(o,i),o=i+1),a=s;return l+="\n",e.length-o>t&&a>o?l+=e.slice(o,a)+"\n"+e.slice(a+1):l+=e.slice(o),l.slice(1)}function C(e,t,n){var i,o,a,c,u,d;for(a=0,c=(o=n?e.explicitTypes:e.implicitTypes).length;a<c;a+=1)if(((u=o[a]).instanceOf||u.predicate)&&(!u.instanceOf||"object"==typeof t&&t instanceof u.instanceOf)&&(!u.predicate||u.predicate(t))){if(e.tag=n?u.tag:"?",u.represent){if(d=e.styleMap[u.tag]||u.defaultStyle,"[object Function]"===s.call(u.represent))i=u.represent(t,d);else{if(!l.call(u.represent,d))throw new r("!<"+u.tag+'> tag resolver accepts not "'+d+'" style');i=u.represent[d](t,d)}e.dump=i}return!0}return!1}function I(e,t,n,i,o,a){e.tag=null,e.dump=n,C(e,n,!1)||C(e,n,!0);var l=s.call(e.dump);i&&(i=e.flowLevel<0||e.flowLevel>t);var c,u,d="[object Object]"===l||"[object Array]"===l;if(d&&(u=-1!==(c=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||u||2!==e.indent&&t>0)&&(o=!1),u&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(d&&u&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),"[object Object]"===l)i&&0!==Object.keys(e.dump).length?(function(e,t,n,i){var o,a,s,l,c,u,d="",h=e.tag,p=Object.keys(n);if(!0===e.sortKeys)p.sort();else if("function"==typeof e.sortKeys)p.sort(e.sortKeys);else if(e.sortKeys)throw new r("sortKeys must be a boolean or a function");for(o=0,a=p.length;o<a;o+=1)u="",i&&0===o||(u+=f(e,t)),l=n[s=p[o]],I(e,t+1,s,!0,!0,!0)&&((c=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&10===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,c&&(u+=f(e,t)),I(e,t+1,l,!0,c)&&(e.dump&&10===e.dump.charCodeAt(0)?u+=":":u+=": ",d+=u+=e.dump));e.tag=h,e.dump=d||"{}"}(e,t,e.dump,o),u&&(e.dump="&ref_"+c+e.dump)):(function(e,t,n){var i,r,o,a,s,l="",c=e.tag,u=Object.keys(n);for(i=0,r=u.length;i<r;i+=1)s="",0!==i&&(s+=", "),e.condenseFlow&&(s+='"'),a=n[o=u[i]],I(e,t,o,!1,!1)&&(e.dump.length>1024&&(s+="? "),s+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),I(e,t,a,!1,!1)&&(l+=s+=e.dump));e.tag=c,e.dump="{"+l+"}"}(e,t,e.dump),u&&(e.dump="&ref_"+c+" "+e.dump));else if("[object Array]"===l){var h=e.noArrayIndent&&t>0?t-1:t;i&&0!==e.dump.length?(function(e,t,n,i){var r,o,a="",s=e.tag;for(r=0,o=n.length;r<o;r+=1)I(e,t+1,n[r],!0,!0)&&(i&&0===r||(a+=f(e,t)),e.dump&&10===e.dump.charCodeAt(0)?a+="-":a+="- ",a+=e.dump);e.tag=s,e.dump=a||"[]"}(e,h,e.dump,o),u&&(e.dump="&ref_"+c+e.dump)):(function(e,t,n){var i,r,o="",a=e.tag;for(i=0,r=n.length;i<r;i+=1)I(e,t,n[i],!1,!1)&&(0!==i&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=a,e.dump="["+o+"]"}(e,h,e.dump),u&&(e.dump="&ref_"+c+" "+e.dump))}else{if("[object String]"!==l){if(e.skipInvalid)return!1;throw new r("unacceptable kind of an object to dump "+l)}"?"!==e.tag&&w(e,e.dump,t,a)}null!==e.tag&&"?"!==e.tag&&(e.dump="!<"+e.tag+"> "+e.dump)}return!0}function S(e,t){var n,i,r=[],o=[];for(function e(t,n,i){var r,o,a;if(null!==t&&"object"==typeof t)if(-1!==(o=n.indexOf(t)))-1===i.indexOf(o)&&i.push(o);else if(n.push(t),Array.isArray(t))for(o=0,a=t.length;o<a;o+=1)e(t[o],n,i);else for(o=0,a=(r=Object.keys(t)).length;o<a;o+=1)e(t[r[o]],n,i)}(e,r,o),n=0,i=o.length;n<i;n+=1)t.duplicates.push(r[o[n]]);t.usedDuplicates=new Array(i)}function D(e,t){var n=new h(t=t||{});return n.noRefs||S(e,n),I(n,0,e,!0,!0)?n.dump+"\n":""}e.exports.dump=D,e.exports.safeDump=function(e,t){return D(e,i.extend({schema:a},t))}},function(e,t,n){"use strict";n(31),n(32),n(33),n(64),n(19),n(65),n(20),n(68),n(92),n(144),n(22),n(94),n(23);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(91),l=n(1),c=n(183),u=n(0),d=n(7),h=n(95),p=n(69),f=n(3),m=n(305),g=n(306),v=n(307),y=function(e){function t(t,n){void 0===n&&(n=!1);var i=e.call(this)||this;return i._hasDeclaration=!1,i._docTypeName="",i._hasDocumentElement=!1,i._currentElementSerialized=!1,i._openTags=[],i._ended=!1,i._fragment=n,i._options=l.applyDefaults(t||{},s.DefaultXMLBuilderCBOptions),i._builderOptions={defaultNamespace:i._options.defaultNamespace,namespaceAlias:i._options.namespaceAlias},"json"===i._options.format?i._writer=new g.JSONCBWriter(i._options):"yaml"===i._options.format?i._writer=new v.YAMLCBWriter(i._options):i._writer=new m.XMLCBWriter(i._options),void 0!==i._options.data&&i.on("data",i._options.data),void 0!==i._options.end&&i.on("end",i._options.end),void 0!==i._options.error&&i.on("error",i._options.error),i._prefixMap=new h.NamespacePrefixMap,i._prefixMap.set("xml",d.namespace.XML),i._prefixIndex={value:1},i._push(i._writer.frontMatter()),i}return r(t,e),t.prototype.ele=function(e,t,n){var i,r;if(l.isObject(e)||l.isString(e)&&(/^\s*</.test(e)||/^\s*[\{\[]/.test(e)||/^(\s*|(#.*)|(%.*))*---/.test(e))){var a=c.fragment().set(this._options);try{a.ele(e)}catch(e){return this.emit("error",e),this}try{for(var s=o(a.node.childNodes),u=s.next();!u.done;u=s.next()){var d=u.value;this._fromNode(d)}}catch(e){i={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return this}if(this._serializeOpenTag(!0),!this._fragment&&this._hasDocumentElement&&0===this._writer.level)return this.emit("error",new Error("Document cannot have multiple document element nodes.")),this;try{this._currentElement=c.fragment(this._builderOptions).ele(e,t,n)}catch(e){return this.emit("error",e),this}return this._fragment||this._hasDocumentElement||""===this._docTypeName||this._currentElement.node._qualifiedName===this._docTypeName?(this._currentElementSerialized=!1,this._fragment||(this._hasDocumentElement=!0),this):(this.emit("error",new Error("Document element name does not match DocType declaration name.")),this)},t.prototype.att=function(e,t,n){if(void 0===this._currentElement)return this.emit("error",new Error("Cannot insert an attribute node as child of a document node.")),this;try{this._currentElement.att(e,t,n)}catch(e){return this.emit("error",e),this}return this},t.prototype.com=function(e){var t;this._serializeOpenTag(!0);try{t=c.fragment(this._builderOptions).com(e).first().node}catch(e){return this.emit("error",e),this}return!this._options.wellFormed||u.xml_isLegalChar(t.data)&&-1===t.data.indexOf("--")&&!t.data.endsWith("-")?(this._push(this._writer.comment(t.data)),this):(this.emit("error",new Error("Comment data contains invalid characters (well-formed required).")),this)},t.prototype.txt=function(e){if(!this._fragment&&void 0===this._currentElement)return this.emit("error",new Error("Cannot insert a text node as child of a document node.")),this;var t;this._serializeOpenTag(!0);try{t=c.fragment(this._builderOptions).txt(e).first().node}catch(e){return this.emit("error",e),this}if(this._options.wellFormed&&!u.xml_isLegalChar(t.data))return this.emit("error",new Error("Text data contains invalid characters (well-formed required).")),this;var n=t.data.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this._push(this._writer.text(n)),this},t.prototype.ins=function(e,t){var n;void 0===t&&(t=""),this._serializeOpenTag(!0);try{n=c.fragment(this._builderOptions).ins(e,t).first().node}catch(e){return this.emit("error",e),this}return this._options.wellFormed&&(-1!==n.target.indexOf(":")||/^xml$/i.test(n.target))?(this.emit("error",new Error("Processing instruction target contains invalid characters (well-formed required).")),this):this._options.wellFormed&&!u.xml_isLegalChar(n.data)?(this.emit("error",Error("Processing instruction data contains invalid characters (well-formed required).")),this):(this._push(this._writer.instruction(n.target,n.data)),this)},t.prototype.dat=function(e){var t;this._serializeOpenTag(!0);try{t=c.fragment(this._builderOptions).dat(e).first().node}catch(e){return this.emit("error",e),this}return this._push(this._writer.cdata(t.data)),this},t.prototype.dec=function(e){return void 0===e&&(e={version:"1.0"}),this._fragment?(this.emit("error",Error("Cannot insert an XML declaration into a document fragment.")),this):this._hasDeclaration?(this.emit("error",Error("XML declaration is already inserted.")),this):(this._push(this._writer.declaration(e.version||"1.0",e.encoding,e.standalone)),this._hasDeclaration=!0,this)},t.prototype.dtd=function(e){if(this._fragment)return this.emit("error",Error("Cannot insert a DocType declaration into a document fragment.")),this;if(""!==this._docTypeName)return this.emit("error",new Error("DocType declaration is already inserted.")),this;if(this._hasDocumentElement)return this.emit("error",new Error("Cannot insert DocType declaration after document element.")),this;var t;try{t=c.create().dtd(e).first().node}catch(e){return this.emit("error",e),this}return this._options.wellFormed&&!u.xml_isPubidChar(t.publicId)?(this.emit("error",new Error("DocType public identifier does not match PubidChar construct (well-formed required).")),this):this._options.wellFormed&&(!u.xml_isLegalChar(t.systemId)||-1!==t.systemId.indexOf('"')&&-1!==t.systemId.indexOf("'"))?(this.emit("error",new Error("DocType system identifier contains invalid characters (well-formed required).")),this):(this._docTypeName=e.name,this._push(this._writer.docType(e.name,t.publicId,t.systemId)),this)},t.prototype.import=function(e){var t,n,i=c.fragment().set(this._options);try{i.import(e)}catch(e){return this.emit("error",e),this}try{for(var r=o(i.node.childNodes),a=r.next();!a.done;a=r.next()){var s=a.value;this._fromNode(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return this},t.prototype.up=function(){return this._serializeOpenTag(!1),this._serializeCloseTag(),this},t.prototype.end=function(){for(this._serializeOpenTag(!1);this._openTags.length>0;)this._serializeCloseTag();return this._push(null),this},t.prototype._serializeOpenTag=function(e){if(!this._currentElementSerialized&&void 0!==this._currentElement){var n=this._currentElement.node;if(!this._options.wellFormed||-1===n.localName.indexOf(":")&&u.xml_isName(n.localName)){var i="",r=!1,o=this._prefixMap.copy(),a={},s=this._recordNamespaceInformation(n,o,a),l=0===this._openTags.length?null:this._openTags[this._openTags.length-1][1],c=n.namespaceURI;if(null===c&&(c=l),l===c)null!==s&&(r=!0),i=c===d.namespace.XML?"xml:"+n.localName:n.localName,this._writer.beginElement(i),this._push(this._writer.openTagBegin(i));else{var h=n.prefix,p=null;if(null===h&&c===s||(p=o.get(h,c)),"xmlns"===h){if(this._options.wellFormed)return void this.emit("error",new Error("An element cannot have the 'xmlns' prefix (well-formed required)."));p=h}null!==p?(i=p+":"+n.localName,null!==s&&s!==d.namespace.XML&&(l=s||null),this._writer.beginElement(i),this._push(this._writer.openTagBegin(i))):null!==h?(h in a&&(h=this._generatePrefix(c,o,this._prefixIndex)),o.set(h,c),i+=h+":"+n.localName,this._writer.beginElement(i),this._push(this._writer.openTagBegin(i)),this._push(this._writer.attribute("xmlns:"+h,this._serializeAttributeValue(c,this._options.wellFormed))),null!==s&&(l=s||null)):null===s||null!==s&&s!==c?(r=!0,i+=n.localName,l=c,this._writer.beginElement(i),this._push(this._writer.openTagBegin(i)),this._push(this._writer.attribute("xmlns",this._serializeAttributeValue(c,this._options.wellFormed)))):(i+=n.localName,l=c,this._writer.beginElement(i),this._push(this._writer.openTagBegin(i)))}this._serializeAttributes(n,o,this._prefixIndex,a,r,this._options.wellFormed);var f=c===d.namespace.HTML;f&&!e&&t._VoidElementNames.has(n.localName)?(this._push(this._writer.openTagEnd(i,!0,!0)),this._writer.endElement(i)):f||e?this._push(this._writer.openTagEnd(i,!1,!1)):(this._push(this._writer.openTagEnd(i,!0,!1)),this._writer.endElement(i)),this._currentElementSerialized=!0,this._openTags.push([i,l,this._prefixMap,e]),this._isPrefixMapModified(this._prefixMap,o)&&(this._prefixMap=o),this._writer.level++}else this.emit("error",new Error("Node local name contains invalid characters (well-formed required)."))}},t.prototype._serializeCloseTag=function(){this._writer.level--;var e=this._openTags.pop();if(void 0!==e){var t=a(e,4),n=t[0],i=(t[1],t[2]),r=t[3];this._prefixMap=i,r&&(this._push(this._writer.closeTag(n)),this._writer.endElement(n))}else this.emit("error",new Error("Last element is undefined."))},t.prototype._push=function(e){null===e?(this._ended=!0,this.emit("end")):this._ended?this.emit("error",new Error("Cannot push to ended stream.")):0!==e.length&&(this._writer.hasData=!0,this.emit("data",e,this._writer.level))},t.prototype._fromNode=function(e){var t,n,i,r;if(f.Guard.isElementNode(e)){var a=e.prefix?e.prefix+":"+e.localName:e.localName;null!==e.namespaceURI?this.ele(e.namespaceURI,a):this.ele(a);try{for(var s=o(e.attributes),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.prefix?c.prefix+":"+c.localName:c.localName;null!==c.namespaceURI?this.att(c.namespaceURI,u,c.value):this.att(u,c.value)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var d=o(e.childNodes),h=d.next();!h.done;h=d.next()){var p=h.value;this._fromNode(p)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(i)throw i.error}}this.up()}else f.Guard.isExclusiveTextNode(e)&&e.data?this.txt(e.data):f.Guard.isCommentNode(e)?this.com(e.data):f.Guard.isCDATASectionNode(e)?this.dat(e.data):f.Guard.isProcessingInstructionNode(e)&&this.ins(e.target,e.data)},t.prototype._serializeAttributes=function(e,t,n,i,r,a){var s,l,c=a?new p.LocalNameSet:void 0;try{for(var h=o(e.attributes),f=h.next();!f.done;f=h.next()){var m=f.value;if(a||r||null!==m.namespaceURI){if(a&&c&&c.has(m.namespaceURI,m.localName))return void this.emit("error",new Error("Element contains duplicate attributes (well-formed required)."));a&&c&&c.set(m.namespaceURI,m.localName);var g=m.namespaceURI,v=null;if(null!==g)if(v=t.get(m.prefix,g),g===d.namespace.XMLNS){if(m.value===d.namespace.XML||null===m.prefix&&r||null!==m.prefix&&(!(m.localName in i)||i[m.localName]!==m.value)&&t.has(m.localName,m.value))continue;if(a&&m.value===d.namespace.XMLNS)return void this.emit("error",new Error("XMLNS namespace is reserved (well-formed required)."));if(a&&""===m.value)return void this.emit("error",new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required)."));"xmlns"===m.prefix&&(v="xmlns")}else null===v&&(v=null===m.prefix||t.hasPrefix(m.prefix)&&!t.has(m.prefix,g)?this._generatePrefix(g,t,n):m.prefix,this._push(this._writer.attribute("xmlns:"+v,this._serializeAttributeValue(g,this._options.wellFormed))));if(a&&(-1!==m.localName.indexOf(":")||!u.xml_isName(m.localName)||"xmlns"===m.localName&&null===g))return void this.emit("error",new Error("Attribute local name contains invalid characters (well-formed required)."));this._push(this._writer.attribute((null!==v?v+":":"")+m.localName,this._serializeAttributeValue(m.value,this._options.wellFormed)))}else this._push(this._writer.attribute(m.localName,this._serializeAttributeValue(m.value,this._options.wellFormed)))}}catch(e){s={error:e}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}},t.prototype._serializeAttributeValue=function(e,t){return t&&null!==e&&!u.xml_isLegalChar(e)?(this.emit("error",new Error("Invalid characters in attribute value.")),""):null===e?"":e.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.prototype._recordNamespaceInformation=function(e,t,n){var i,r,a=null;try{for(var s=o(e.attributes),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.namespaceURI,h=c.prefix;if(u===d.namespace.XMLNS){if(null===h){a=c.value;continue}var p=c.localName,f=c.value;if(f===d.namespace.XML)continue;if(""===f&&(f=null),t.has(p,f))continue;t.set(p,f),n[p]=f||""}}}catch(e){i={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return a},t.prototype._generatePrefix=function(e,t,n){var i="ns"+n.value;return n.value++,t.set(i,e),i},t.prototype._isPrefixMapModified=function(e,t){var n=e._items,i=t._items,r=e._nullItems,o=t._nullItems;for(var a in i){var s=n[a];if(void 0===s)return!0;var l=i[a];if(s.length!==l.length)return!0;for(var c=0;c<s.length;c++)if(s[c]!==l[c])return!0}if(r.length!==o.length)return!0;for(c=0;c<r.length;c++)if(r[c]!==o[c])return!0;return!1},t._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),t}(n(308).EventEmitter);t.XMLBuilderCBImpl=y},function(e,t,n){"use strict";n(74);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;return n._lineLength=0,n}return r(t,e),t.prototype.frontMatter=function(){return""},t.prototype.declaration=function(e,t,n){var i=this._beginLine()+"<?xml";return i+=' version="'+e+'"',void 0!==t&&(i+=' encoding="'+t+'"'),void 0!==n&&(i+=' standalone="'+(n?"yes":"no")+'"'),i+"?>"},t.prototype.docType=function(e,t,n){return this._beginLine()+(t&&n?"<!DOCTYPE "+e+' PUBLIC "'+t+'" "'+n+'">':t?"<!DOCTYPE "+e+' PUBLIC "'+t+'">':n?"<!DOCTYPE "+e+' SYSTEM "'+n+'">':"<!DOCTYPE "+e+">")},t.prototype.comment=function(e){return this._beginLine()+"\x3c!--"+e+"--\x3e"},t.prototype.text=function(e){return this._beginLine()+e},t.prototype.instruction=function(e,t){return t?this._beginLine()+"<?"+e+" "+t+"?>":this._beginLine()+"<?"+e+"?>"},t.prototype.cdata=function(e){return this._beginLine()+"<![CDATA["+e+"]]>"},t.prototype.openTagBegin=function(e){return this._lineLength+=1+e.length,this._beginLine()+"<"+e},t.prototype.openTagEnd=function(e,t,n){return n?" />":t?this._writerOptions.allowEmptyTags?"></"+e+">":this._writerOptions.spaceBeforeSlash?" />":"/>":">"},t.prototype.closeTag=function(e){return this._beginLine()+"</"+e+">"},t.prototype.attribute=function(e,t){var n=e+'="'+t+'"';return this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._lineLength+1+n.length>this._writerOptions.width?(n=this._beginLine()+this._indent(1)+n,this._lineLength=n.length,n):(this._lineLength+=1+n.length," "+n)},t.prototype.beginElement=function(e){},t.prototype.endElement=function(e){},t.prototype._beginLine=function(){if(this._writerOptions.prettyPrint){var e=(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level);return this._lineLength=e.length,e}return""},t.prototype._indent=function(e){return e<=0?"":this._writerOptions.indent.repeat(e)},t}(n(114).BaseCBWriter);t.XMLCBWriter=o},function(e,t,n){"use strict";n(74);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;return n._hasChildren=[],n._additionalLevel=0,n}return r(t,e),t.prototype.frontMatter=function(){return""},t.prototype.declaration=function(e,t,n){return""},t.prototype.docType=function(e,t,n){return""},t.prototype.comment=function(e){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.comment)+this._sep()+this._val(e)+this._sep()+"}"},t.prototype.text=function(e){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.text)+this._sep()+this._val(e)+this._sep()+"}"},t.prototype.instruction=function(e,t){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.ins)+this._sep()+this._val(t?e+" "+t:e)+this._sep()+"}"},t.prototype.cdata=function(e){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.cdata)+this._sep()+this._val(e)+this._sep()+"}"},t.prototype.attribute=function(e,t){return this._comma()+this._beginLine(1)+"{"+this._sep()+this._key(this._builderOptions.convert.att+e)+this._sep()+this._val(t)+this._sep()+"}"},t.prototype.openTagBegin=function(e){var t=this._comma()+this._beginLine()+"{"+this._sep()+this._key(e)+this._sep()+"{";return this._additionalLevel++,this.hasData=!0,t+=this._beginLine()+this._key(this._builderOptions.convert.text)+this._sep()+"[",this._hasChildren.push(!1),t},t.prototype.openTagEnd=function(e,t,n){if(t){var i=this._sep()+"]";return this._additionalLevel--,i+(this._beginLine()+"}")+this._sep()+"}"}return""},t.prototype.closeTag=function(e){var t=this._beginLine()+"]";return this._additionalLevel--,t+(this._beginLine()+"}")+this._sep()+"}"},t.prototype.beginElement=function(e){},t.prototype.endElement=function(e){this._hasChildren.pop()},t.prototype._beginLine=function(e){return void 0===e&&(e=0),this._writerOptions.prettyPrint?(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level+e):""},t.prototype._indent=function(e){return e+this._additionalLevel<=0?"":this._writerOptions.indent.repeat(e+this._additionalLevel)},t.prototype._comma=function(){var e=this._hasChildren[this._hasChildren.length-1]?",":"";return this._hasChildren.length>0&&(this._hasChildren[this._hasChildren.length-1]=!0),e},t.prototype._sep=function(){return this._writerOptions.prettyPrint?" ":""},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t}(n(114).BaseCBWriter);t.JSONCBWriter=o},function(e,t,n){"use strict";n(74);var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;if(n._rootWritten=!1,n._additionalLevel=0,t.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(t.offset<0)throw new Error("YAML offset should be zero or a positive number.");return n}return r(t,e),t.prototype.frontMatter=function(){return this._beginLine()+"---"},t.prototype.declaration=function(e,t,n){return""},t.prototype.docType=function(e,t,n){return""},t.prototype.comment=function(e){return this._beginLine()+this._key(this._builderOptions.convert.comment)+" "+this._val(e)},t.prototype.text=function(e){return this._beginLine()+this._key(this._builderOptions.convert.text)+" "+this._val(e)},t.prototype.instruction=function(e,t){return this._beginLine()+this._key(this._builderOptions.convert.ins)+" "+this._val(t?e+" "+t:e)},t.prototype.cdata=function(e){return this._beginLine()+this._key(this._builderOptions.convert.cdata)+" "+this._val(e)},t.prototype.attribute=function(e,t){this._additionalLevel++;var n=this._beginLine()+this._key(this._builderOptions.convert.att+e)+" "+this._val(t);return this._additionalLevel--,n},t.prototype.openTagBegin=function(e){var t=this._beginLine()+this._key(e);return this._rootWritten||(this._rootWritten=!0),this.hasData=!0,this._additionalLevel++,t+(this._beginLine(!0)+this._key(this._builderOptions.convert.text))},t.prototype.openTagEnd=function(e,t,n){return t?" "+this._val(""):""},t.prototype.closeTag=function(e){return this._additionalLevel--,""},t.prototype.beginElement=function(e){},t.prototype.endElement=function(e){},t.prototype._beginLine=function(e){return void 0===e&&(e=!1),(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level,e)},t.prototype._indent=function(e,t){if(e+this._additionalLevel<=0)return"";var n=this._writerOptions.indent.repeat(e+this._additionalLevel);return!t&&this._rootWritten?n.substr(0,n.length-2)+"-"+n.substr(-1,1):n},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t}(n(114).BaseCBWriter);t.YAMLCBWriter=o},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var r,o,a,s;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=u(e))>0&&a.length>r&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,console&&console.warn&&console.warn(s)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=h.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):g(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var c=l.length,u=g(l,c);for(n=0;n<c;++n)o(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,o,a;if(c(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(77);t.createCB=function(e){return new i.XMLBuilderCBImpl(e)},t.fragmentCB=function(e){return new i.XMLBuilderCBImpl(e,!0)}}])},99178:(e,t,n)=>{"use strict";n.d(t,{A2:()=>o,BX:()=>w,LV:()=>h,p:()=>u});const i=Symbol("Comlink.proxy"),r=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>l(e)&&e[i],serialize(e){const{port1:t,port2:n}=new MessageChannel;return u(e,t),[n,[n]]},deserialize:e=>(e.start(),h(e))}],["throw",{canHandle:e=>l(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function u(e,t=globalThis,n=["*"]){t.addEventListener("message",function i(r){if(!r||!r.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,r.origin))return void console.warn(`Invalid origin '${r.origin}' for comlink proxy`);const{id:o,type:l,path:c}=Object.assign({path:[]},r.data),h=(r.data.argumentList||[]).map(b);let p;try{const t=c.slice(0,-1).reduce((e,t)=>e[t],e),n=c.reduce((e,t)=>e[t],e);switch(l){case"GET":p=n;break;case"SET":t[c.slice(-1)[0]]=b(r.data.value),p=!0;break;case"APPLY":p=n.apply(t,h);break;case"CONSTRUCT":p=w(new n(...h));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;u(e,n),p=function(e,t){return _.set(e,t),e}(t,[t])}break;case"RELEASE":p=void 0;break;default:return}}catch(e){p={value:e,[s]:0}}Promise.resolve(p).catch(e=>({value:e,[s]:0})).then(n=>{const[r,s]=E(n);t.postMessage(Object.assign(Object.assign({},r),{id:o}),s),"RELEASE"===l&&(t.removeEventListener("message",i),d(t),a in e&&"function"==typeof e[a]&&e[a]())}).catch(e=>{const[n,i]=E({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},n),{id:o}),i)})}),t.start&&t.start()}function d(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function h(e,t){const n=new Map;return e.addEventListener("message",function(e){const{data:t}=e;if(!t||!t.id)return;const i=n.get(t.id);if(i)try{i(t)}finally{n.delete(t.id)}}),v(e,n,[],t)}function p(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e){return x(e,new Map,{type:"RELEASE"}).then(()=>{d(e)})}const m=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(m.get(e)||0)-1;m.set(e,t),0===t&&f(e)});function v(e,t,n=[],i=function(){}){let a=!1;const s=new Proxy(i,{get(i,r){if(p(a),r===o)return()=>{!function(e){g&&g.unregister(e)}(s),f(e),t.clear(),a=!0};if("then"===r){if(0===n.length)return{then:()=>s};const i=x(e,t,{type:"GET",path:n.map(e=>e.toString())}).then(b);return i.then.bind(i)}return v(e,t,[...n,r])},set(i,r,o){p(a);const[s,l]=E(o);return x(e,t,{type:"SET",path:[...n,r].map(e=>e.toString()),value:s},l).then(b)},apply(i,o,s){p(a);const l=n[n.length-1];if(l===r)return x(e,t,{type:"ENDPOINT"}).then(b);if("bind"===l)return v(e,t,n.slice(0,-1));const[c,u]=y(s);return x(e,t,{type:"APPLY",path:n.map(e=>e.toString()),argumentList:c},u).then(b)},construct(i,r){p(a);const[o,s]=y(r);return x(e,t,{type:"CONSTRUCT",path:n.map(e=>e.toString()),argumentList:o},s).then(b)}});return function(e,t){const n=(m.get(t)||0)+1;m.set(t,n),g&&g.register(e,t,e)}(s,e),s}function y(e){const t=e.map(E);return[t.map(e=>e[0]),(n=t.map(e=>e[1]),Array.prototype.concat.apply([],n))];var n}const _=new WeakMap;function w(e){return Object.assign(e,{[i]:!0})}function E(e){for(const[t,n]of c)if(n.canHandle(e)){const[i,r]=n.serialize(e);return[{type:"HANDLER",name:t,value:i},r]}return[{type:"RAW",value:e},_.get(e)||[]]}function b(e){switch(e.type){case"HANDLER":return c.get(e.name).deserialize(e.value);case"RAW":return e.value}}function x(e,t,n,i){return new Promise(r=>{const o=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(o,r),e.start&&e.start(),e.postMessage(Object.assign({id:o},n),i)})}},75210:(e,t,n)=>{"use strict";n.d(t,{h1:()=>i.Ay,yl:()=>r.A,lq:()=>a.lq,sG:()=>a.sG,Zc:()=>a.Ay,yU:()=>l});var i=n(81068),r=(n(18642),n(38153)),o=(n(19743),n(5739),n(67800),n(11472),n(33760),n(47803),n(80130),n(52827),n(13723),n(22543),n(97315),n(48210),n(95211),n(67049),n(36426),n(64196),n(61515),n(26892),n(37412),n(57623)),a=(n(97982),n(3581),n(51963),n(35457),n(83254),n(49115),n(43523),n(14029),n(36820),n(84201),n(55973),n(40049),n(82061),n(65591),n(96945),n(66871),n(47598));function s(e){return e.length}n(77097);function l(){return function(e){if(!(r=e.length))return[];for(var t=-1,n=(0,o.A)(e,s),i=new Array(n);++t<n;)for(var r,a=-1,l=i[t]=new Array(r);++a<r;)l[a]=e[a][t];return i}(arguments)}n(25475),n(39034),n(95388),n(69010),n(91804),n(23526),n(60786),n(18949),n(77050),n(29351),n(59128),n(47051),n(78603),n(59043)},57623:(e,t,n)=>{"use strict";function i(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}n.d(t,{A:()=>i})},65481:(e,t,n)=>{"use strict";n.d(t,{GW:()=>i.A,Qm:()=>r.A,Dj:()=>o.A,sH:()=>a.A,yd:()=>s});var i=n(1283),r=(n(82043),n(43724)),o=(n(96184),n(2728),n(61847),n(73524),n(20825)),a=(n(32204),n(34107),n(66822));n(33637),n(62911),n(85351),n(83441),n(26093),n(86617),n(69277),n(34121),n(84444);function s(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}}}]);
//# sourceMappingURL=665.bundle.9e3df225d3467deced0a.js.map