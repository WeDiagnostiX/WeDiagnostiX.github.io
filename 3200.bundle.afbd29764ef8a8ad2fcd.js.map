{"version":3,"file":"3200.bundle.afbd29764ef8a8ad2fcd.js","mappings":"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","sources":["webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/measurementTrackingMachine.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptHydrateStructuredReport.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/hydrateStructuredReport.tsx","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/TrackedMeasurementsContext.tsx","webpack:///../../../extensions/measurement-tracking/src/getContextModule.tsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/constants/actionIcons.ts","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/constants/viewPresets.ts","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/PanelStudyBrowserTracking.tsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/getImageSrcFromImageId.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/requestDisplaySetCreationForStudy.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/index.tsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelMeasurementTableTracking.tsx","webpack:///../../../extensions/measurement-tracking/src/getPanelModule.tsx","webpack:///../../../extensions/measurement-tracking/src/getViewportModule.tsx","webpack:///../../../extensions/measurement-tracking/src/index.tsx","webpack:///../../../extensions/measurement-tracking/src/id.js"],"sourcesContent":["import { assign } from 'xstate';\r\n\r\nconst RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n  HYDRATE_REPORT: 5,\r\n};\r\n\r\nconst machineConfiguration = {\r\n  id: 'measurementTracking',\r\n  initial: 'idle',\r\n  context: {\r\n    activeViewportId: null,\r\n    trackedStudy: '',\r\n    trackedSeries: [],\r\n    ignoredSeries: [],\r\n    //\r\n    prevTrackedStudy: '',\r\n    prevTrackedSeries: [],\r\n    prevIgnoredSeries: [],\r\n    //\r\n    ignoredSRSeriesForHydration: [],\r\n    isDirty: false,\r\n  },\r\n  states: {\r\n    off: {\r\n      type: 'final',\r\n    },\r\n    labellingOnly: {\r\n      on: {\r\n        TRACK_SERIES: [\r\n          {\r\n            target: 'promptLabelAnnotation',\r\n            actions: ['setPreviousState'],\r\n          },\r\n          {\r\n            target: 'off',\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    idle: {\r\n      entry: 'clearContext',\r\n      on: {\r\n        TRACK_SERIES: [\r\n          {\r\n            target: 'promptLabelAnnotation',\r\n            cond: 'isLabelOnMeasure',\r\n            actions: ['setPreviousState'],\r\n          },\r\n          {\r\n            target: 'promptBeginTracking',\r\n            actions: ['setPreviousState'],\r\n          },\r\n        ],\r\n        // Unused? We may only do PROMPT_HYDRATE_SR now?\r\n        SET_TRACKED_SERIES: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setTrackedStudyAndMultipleSeries', 'setIsDirtyToClean'],\r\n          },\r\n        ],\r\n        PROMPT_HYDRATE_SR: {\r\n          target: 'promptHydrateStructuredReport',\r\n          cond: 'hasNotIgnoredSRSeriesForHydration',\r\n        },\r\n        RESTORE_PROMPT_HYDRATE_SR: 'promptHydrateStructuredReport',\r\n        HYDRATE_SR: 'hydrateStructuredReport',\r\n        UPDATE_ACTIVE_VIEWPORT_ID: {\r\n          actions: assign({\r\n            activeViewportId: (_, event) => event.activeViewportId,\r\n          }),\r\n        },\r\n      },\r\n    },\r\n    promptBeginTracking: {\r\n      invoke: {\r\n        src: 'promptBeginTracking',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setTrackedStudyAndSeries', 'setIsDirty'],\r\n            cond: 'shouldSetStudyAndSeries',\r\n          },\r\n          {\r\n            target: 'labellingOnly',\r\n            cond: 'isLabelOnMeasureAndShouldKillMachine',\r\n          },\r\n          {\r\n            target: 'off',\r\n            cond: 'shouldKillMachine',\r\n          },\r\n          {\r\n            target: 'idle',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    tracking: {\r\n      on: {\r\n        TRACK_SERIES: [\r\n          {\r\n            target: 'promptLabelAnnotation',\r\n            cond: 'isLabelOnMeasure',\r\n            actions: ['setPreviousState'],\r\n          },\r\n          {\r\n            target: 'promptTrackNewStudy',\r\n            cond: 'isNewStudy',\r\n          },\r\n          {\r\n            target: 'promptTrackNewSeries',\r\n            cond: 'isNewSeries',\r\n          },\r\n        ],\r\n        UNTRACK_SERIES: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['removeTrackedSeries', 'setIsDirty'],\r\n            cond: 'hasRemainingTrackedSeries',\r\n          },\r\n          {\r\n            target: 'idle',\r\n          },\r\n        ],\r\n        SET_TRACKED_SERIES: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setTrackedStudyAndMultipleSeries'],\r\n          },\r\n        ],\r\n        SAVE_REPORT: 'promptSaveReport',\r\n        SET_DIRTY: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setIsDirty'],\r\n            cond: 'shouldSetDirty',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    promptTrackNewSeries: {\r\n      invoke: {\r\n        src: 'promptTrackNewSeries',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['addTrackedSeries', 'setIsDirty'],\r\n            cond: 'shouldAddSeries',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'discardPreviouslyTrackedMeasurements',\r\n              'setTrackedStudyAndSeries',\r\n              'setIsDirty',\r\n            ],\r\n            cond: 'shouldSetStudyAndSeries',\r\n          },\r\n          {\r\n            target: 'promptSaveReport',\r\n            cond: 'shouldPromptSaveReport',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptTrackNewStudy: {\r\n      invoke: {\r\n        src: 'promptTrackNewStudy',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'discardPreviouslyTrackedMeasurements',\r\n              'setTrackedStudyAndSeries',\r\n              'setIsDirty',\r\n            ],\r\n            cond: 'shouldSetStudyAndSeries',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n            actions: ['ignoreSeries'],\r\n            cond: 'shouldAddIgnoredSeries',\r\n          },\r\n          {\r\n            target: 'promptSaveReport',\r\n            cond: 'shouldPromptSaveReport',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptSaveReport: {\r\n      invoke: {\r\n        src: 'promptSaveReport',\r\n        onDone: [\r\n          // \"clicked the save button\"\r\n          // - should clear all measurements\r\n          // - show DICOM SR\r\n          {\r\n            target: 'idle',\r\n            actions: ['clearAllMeasurements', 'showStructuredReportDisplaySetInActiveViewport'],\r\n            cond: 'shouldSaveAndContinueWithSameReport',\r\n          },\r\n          // \"starting a new report\"\r\n          // - remove \"just saved\" measurements\r\n          // - start tracking a new study + report\r\n          {\r\n            target: 'tracking',\r\n            actions: ['discardPreviouslyTrackedMeasurements', 'setTrackedStudyAndSeries'],\r\n            cond: 'shouldSaveAndStartNewReport',\r\n          },\r\n          // Cancel, back to tracking\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptHydrateStructuredReport: {\r\n      invoke: {\r\n        src: 'promptHydrateStructuredReport',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'setTrackedStudyAndMultipleSeries',\r\n              'jumpToSameImageInActiveViewport',\r\n              'setIsDirtyToClean',\r\n            ],\r\n            cond: 'shouldHydrateStructuredReport',\r\n          },\r\n          {\r\n            target: 'idle',\r\n            actions: ['ignoreHydrationForSRSeries'],\r\n            cond: 'shouldIgnoreHydrationForSR',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    hydrateStructuredReport: {\r\n      invoke: {\r\n        src: 'hydrateStructuredReport',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'setTrackedStudyAndMultipleSeries',\r\n              'jumpToSameImageInActiveViewport',\r\n              'setIsDirtyToClean',\r\n            ],\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptLabelAnnotation: {\r\n      invoke: {\r\n        src: 'promptLabelAnnotation',\r\n        onDone: [\r\n          {\r\n            target: 'labellingOnly',\r\n            cond: 'wasLabellingOnly',\r\n          },\r\n          {\r\n            target: 'promptBeginTracking',\r\n            cond: 'wasIdle',\r\n          },\r\n          {\r\n            target: 'promptTrackNewStudy',\r\n            cond: 'wasTrackingAndIsNewStudy',\r\n          },\r\n          {\r\n            target: 'promptTrackNewSeries',\r\n            cond: 'wasTrackingAndIsNewSeries',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n            cond: 'wasTracking',\r\n          },\r\n          {\r\n            target: 'off',\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  },\r\n  strict: true,\r\n};\r\n\r\nconst defaultOptions = {\r\n  services: {\r\n    // Disabled for now\r\n    /*promptBeginTracking: (ctx, evt) => {\r\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\r\n    },\r\n    promptTrackNewStudy: (ctx, evt) => {\r\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\r\n    },\r\n    promptTrackNewSeries: (ctx, evt) => {\r\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\r\n    },*/\r\n  },\r\n  actions: {\r\n    discardPreviouslyTrackedMeasurements: (ctx, evt) => {\r\n      console.log('discardPreviouslyTrackedMeasurements: not implemented');\r\n    },\r\n    clearAllMeasurements: (ctx, evt) => {\r\n      console.log('clearAllMeasurements: not implemented');\r\n    },\r\n    jumpToFirstMeasurementInActiveViewport: (ctx, evt) => {\r\n      console.warn('jumpToFirstMeasurementInActiveViewport: not implemented');\r\n    },\r\n    showStructuredReportDisplaySetInActiveViewport: (ctx, evt) => {\r\n      console.warn('showStructuredReportDisplaySetInActiveViewport: not implemented');\r\n    },\r\n    clearContext: assign({\r\n      trackedStudy: '',\r\n      trackedSeries: [],\r\n      ignoredSeries: [],\r\n      prevTrackedStudy: '',\r\n      prevTrackedSeries: [],\r\n      prevIgnoredSeries: [],\r\n    }),\r\n    // Promise resolves w/ `evt.data.*`\r\n    setTrackedStudyAndSeries: assign((ctx, evt) => ({\r\n      prevTrackedStudy: ctx.trackedStudy,\r\n      prevTrackedSeries: ctx.trackedSeries.slice(),\r\n      prevIgnoredSeries: ctx.ignoredSeries.slice(),\r\n      //\r\n      trackedStudy: evt.data.StudyInstanceUID,\r\n      trackedSeries: [evt.data.SeriesInstanceUID],\r\n      ignoredSeries: [],\r\n    })),\r\n    setTrackedStudyAndMultipleSeries: assign((ctx, evt) => {\r\n      const studyInstanceUID = evt.StudyInstanceUID || evt.data.StudyInstanceUID;\r\n      const seriesInstanceUIDs = evt.SeriesInstanceUIDs || evt.data.SeriesInstanceUIDs;\r\n\r\n      return {\r\n        prevTrackedStudy: ctx.trackedStudy,\r\n        prevTrackedSeries: ctx.trackedSeries.slice(),\r\n        prevIgnoredSeries: ctx.ignoredSeries.slice(),\r\n        //\r\n        trackedStudy: studyInstanceUID,\r\n        trackedSeries: [...ctx.trackedSeries, ...seriesInstanceUIDs],\r\n        ignoredSeries: [],\r\n      };\r\n    }),\r\n    setIsDirtyToClean: assign((ctx, evt) => ({\r\n      isDirty: false,\r\n    })),\r\n    setIsDirty: assign((ctx, evt) => ({\r\n      isDirty: true,\r\n    })),\r\n    ignoreSeries: assign((ctx, evt) => ({\r\n      prevIgnoredSeries: [...ctx.ignoredSeries],\r\n      ignoredSeries: [...ctx.ignoredSeries, evt.data.SeriesInstanceUID],\r\n    })),\r\n    ignoreHydrationForSRSeries: assign((ctx, evt) => ({\r\n      ignoredSRSeriesForHydration: [\r\n        ...ctx.ignoredSRSeriesForHydration,\r\n        evt.data.srSeriesInstanceUID,\r\n      ],\r\n    })),\r\n    addTrackedSeries: assign((ctx, evt) => ({\r\n      prevTrackedSeries: [...ctx.trackedSeries],\r\n      trackedSeries: [...ctx.trackedSeries, evt.data.SeriesInstanceUID],\r\n    })),\r\n    removeTrackedSeries: assign((ctx, evt) => ({\r\n      prevTrackedSeries: ctx.trackedSeries.slice().filter(ser => ser !== evt.SeriesInstanceUID),\r\n      trackedSeries: ctx.trackedSeries.slice().filter(ser => ser !== evt.SeriesInstanceUID),\r\n    })),\r\n    setPreviousState: assign((ctx, evt, meta) => {\r\n      return {\r\n        prevState: meta.state.value,\r\n      };\r\n    }),\r\n  },\r\n  guards: {\r\n    // We set dirty any time we performan an action that:\r\n    // - Tracks a new study\r\n    // - Tracks a new series\r\n    // - Adds a measurement to an already tracked study/series\r\n    //\r\n    // We set clean any time we restore from an SR\r\n    //\r\n    // This guard/condition is specific to \"new measurements\"\r\n    // to make sure we only track dirty when the new measurement is specific\r\n    // to a series we're already tracking\r\n    //\r\n    // tl;dr\r\n    // Any report change, that is not a hydration of an existing report, should\r\n    // result in a \"dirty\" report\r\n    //\r\n    // Where dirty means there would be \"loss of data\" if we blew away measurements\r\n    // without creating a new SR.\r\n    shouldSetDirty: (ctx, evt) => {\r\n      return (\r\n        // When would this happen?\r\n        evt.SeriesInstanceUID === undefined || ctx.trackedSeries.includes(evt.SeriesInstanceUID)\r\n      );\r\n    },\r\n    wasLabellingOnly: (ctx, evt, condMeta) => {\r\n      return ctx.prevState === 'labellingOnly';\r\n    },\r\n    wasIdle: (ctx, evt, condMeta) => {\r\n      return ctx.prevState === 'idle';\r\n    },\r\n    wasTracking: (ctx, evt, condMeta) => {\r\n      return ctx.prevState === 'tracking';\r\n    },\r\n    wasTrackingAndIsNewStudy: (ctx, evt, condMeta) => {\r\n      return (\r\n        ctx.prevState === 'tracking' &&\r\n        !ctx.ignoredSeries.includes(evt.data.SeriesInstanceUID) &&\r\n        ctx.trackedStudy !== evt.data.StudyInstanceUID\r\n      );\r\n    },\r\n    wasTrackingAndIsNewSeries: (ctx, evt, condMeta) => {\r\n      return (\r\n        ctx.prevState === 'tracking' &&\r\n        !ctx.ignoredSeries.includes(evt.data.SeriesInstanceUID) &&\r\n        !ctx.trackedSeries.includes(evt.data.SeriesInstanceUID)\r\n      );\r\n    },\r\n\r\n    shouldKillMachine: (ctx, evt) => evt.data && evt.data.userResponse === RESPONSE.NO_NEVER,\r\n    shouldAddSeries: (ctx, evt) => evt.data && evt.data.userResponse === RESPONSE.ADD_SERIES,\r\n    shouldSetStudyAndSeries: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.SET_STUDY_AND_SERIES,\r\n    shouldAddIgnoredSeries: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.NO_NOT_FOR_SERIES,\r\n    shouldPromptSaveReport: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.CREATE_REPORT,\r\n    shouldIgnoreHydrationForSR: (ctx, evt) => evt.data && evt.data.userResponse === RESPONSE.CANCEL,\r\n    shouldSaveAndContinueWithSameReport: (ctx, evt) =>\r\n      evt.data &&\r\n      evt.data.userResponse === RESPONSE.CREATE_REPORT &&\r\n      evt.data.isBackupSave === true,\r\n    shouldSaveAndStartNewReport: (ctx, evt) =>\r\n      evt.data &&\r\n      evt.data.userResponse === RESPONSE.CREATE_REPORT &&\r\n      evt.data.isBackupSave === false,\r\n    shouldHydrateStructuredReport: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.HYDRATE_REPORT,\r\n    // Has more than 1, or SeriesInstanceUID is not in list\r\n    // --> Post removal would have non-empty trackedSeries array\r\n    hasRemainingTrackedSeries: (ctx, evt) =>\r\n      ctx.trackedSeries.length > 1 || !ctx.trackedSeries.includes(evt.SeriesInstanceUID),\r\n    hasNotIgnoredSRSeriesForHydration: (ctx, evt) => {\r\n      return !ctx.ignoredSRSeriesForHydration.includes(evt.SeriesInstanceUID);\r\n    },\r\n    isNewStudy: (ctx, evt) =>\r\n      !ctx.ignoredSeries.includes(evt.SeriesInstanceUID) &&\r\n      ctx.trackedStudy !== evt.StudyInstanceUID,\r\n    isNewSeries: (ctx, evt) =>\r\n      !ctx.ignoredSeries.includes(evt.SeriesInstanceUID) &&\r\n      !ctx.trackedSeries.includes(evt.SeriesInstanceUID),\r\n  },\r\n};\r\n\r\nexport { defaultOptions, machineConfiguration, RESPONSE };\r\n","import { hydrateStructuredReport } from '@ohif/extension-cornerstone-dicom-sr';\r\nimport { ButtonEnums } from '@ohif/ui';\r\n\r\nconst RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n  HYDRATE_REPORT: 5,\r\n};\r\n\r\nfunction promptHydrateStructuredReport({ servicesManager, extensionManager, appConfig }, ctx, evt) {\r\n  const { uiViewportDialogService, displaySetService } = servicesManager.services;\r\n  const { viewportId, displaySetInstanceUID } = evt;\r\n  const srDisplaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n  return new Promise(async function (resolve, reject) {\r\n    const promptResult = appConfig?.disableConfirmationPrompts\r\n      ? RESPONSE.HYDRATE_REPORT\r\n      : await _askTrackMeasurements(uiViewportDialogService, viewportId);\r\n\r\n    // Need to do action here... So we can set state...\r\n    let StudyInstanceUID, SeriesInstanceUIDs;\r\n\r\n    if (promptResult === RESPONSE.HYDRATE_REPORT) {\r\n      console.warn('!! HYDRATING STRUCTURED REPORT');\r\n      const hydrationResult = hydrateStructuredReport(\r\n        { servicesManager, extensionManager, appConfig },\r\n        displaySetInstanceUID\r\n      );\r\n\r\n      StudyInstanceUID = hydrationResult.StudyInstanceUID;\r\n      SeriesInstanceUIDs = hydrationResult.SeriesInstanceUIDs;\r\n    }\r\n\r\n    resolve({\r\n      userResponse: promptResult,\r\n      displaySetInstanceUID: evt.displaySetInstanceUID,\r\n      srSeriesInstanceUID: srDisplaySet.SeriesInstanceUID,\r\n      viewportId,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUIDs,\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askTrackMeasurements(uiViewportDialogService, viewportId) {\r\n  return new Promise(function (resolve, reject) {\r\n    const message = 'Do you want to continue tracking measurements for this study?';\r\n    const actions = [\r\n      {\r\n        id: 'no-hydrate',\r\n        type: ButtonEnums.type.secondary,\r\n        text: 'No',\r\n        value: RESPONSE.CANCEL,\r\n      },\r\n      {\r\n        id: 'yes-hydrate',\r\n        type: ButtonEnums.type.primary,\r\n        text: 'Yes',\r\n        value: RESPONSE.HYDRATE_REPORT,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      uiViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    uiViewportDialogService.show({\r\n      viewportId,\r\n      type: 'info',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        uiViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n      onKeyPress: event => {\r\n        if (event.key === 'Enter') {\r\n          const action = actions.find(action => action.value === RESPONSE.HYDRATE_REPORT);\r\n          onSubmit(action.value);\r\n        }\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptHydrateStructuredReport;\r\n","import { hydrateStructuredReport as baseHydrateStructuredReport } from '@ohif/extension-cornerstone-dicom-sr';\r\n\r\nfunction hydrateStructuredReport(\r\n  { servicesManager, extensionManager, appConfig }: withAppTypes,\r\n  ctx,\r\n  evt\r\n) {\r\n  const { displaySetService } = servicesManager.services;\r\n  const { viewportId, displaySetInstanceUID } = evt;\r\n  const srDisplaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const hydrationResult = baseHydrateStructuredReport(\r\n      { servicesManager, extensionManager, appConfig },\r\n      displaySetInstanceUID\r\n    );\r\n\r\n    const StudyInstanceUID = hydrationResult.StudyInstanceUID;\r\n    const SeriesInstanceUIDs = hydrationResult.SeriesInstanceUIDs;\r\n\r\n    resolve({\r\n      displaySetInstanceUID: evt.displaySetInstanceUID,\r\n      srSeriesInstanceUID: srDisplaySet.SeriesInstanceUID,\r\n      viewportId,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUIDs,\r\n    });\r\n  });\r\n}\r\n\r\nexport default hydrateStructuredReport;\r\n","import React, { useContext, useEffect, useMemo } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Machine } from 'xstate';\r\nimport { useMachine } from '@xstate/react';\r\nimport { useViewportGrid } from '@ohif/ui';\r\nimport { promptLabelAnnotation, promptSaveReport } from '@ohif/extension-default';\r\nimport { machineConfiguration, defaultOptions, RESPONSE } from './measurementTrackingMachine';\r\nimport promptBeginTracking from './promptBeginTracking';\r\nimport promptTrackNewSeries from './promptTrackNewSeries';\r\nimport promptTrackNewStudy from './promptTrackNewStudy';\r\nimport promptHydrateStructuredReport from './promptHydrateStructuredReport';\r\nimport hydrateStructuredReport from './hydrateStructuredReport';\r\nimport { useAppConfig } from '@state';\r\n\r\nconst TrackedMeasurementsContext = React.createContext();\r\nTrackedMeasurementsContext.displayName = 'TrackedMeasurementsContext';\r\nconst useTrackedMeasurements = () => useContext(TrackedMeasurementsContext);\r\n\r\nconst SR_SOPCLASSHANDLERID = '@ohif/extension-cornerstone-dicom-sr.sopClassHandlerModule.dicom-sr';\r\n\r\n/**\r\n *\r\n * @param {*} param0\r\n */\r\nfunction TrackedMeasurementsContextProvider(\r\n  { servicesManager, commandsManager, extensionManager }: withAppTypes, // Bound by consumer\r\n  { children } // Component props\r\n) {\r\n  const [appConfig] = useAppConfig();\r\n\r\n  const [viewportGrid, viewportGridService] = useViewportGrid();\r\n  const { activeViewportId, viewports } = viewportGrid;\r\n  const { measurementService, displaySetService, customizationService } = servicesManager.services;\r\n\r\n  const machineOptions = Object.assign({}, defaultOptions);\r\n  machineOptions.actions = Object.assign({}, machineOptions.actions, {\r\n    jumpToFirstMeasurementInActiveViewport: (ctx, evt) => {\r\n      const { trackedStudy, trackedSeries, activeViewportId } = ctx;\r\n      const measurements = measurementService.getMeasurements();\r\n      const trackedMeasurements = measurements.filter(\r\n        m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\r\n      );\r\n\r\n      console.log(\r\n        'jumping to measurement reset viewport',\r\n        activeViewportId,\r\n        trackedMeasurements[0]\r\n      );\r\n\r\n      const referencedDisplaySetUID = trackedMeasurements[0].displaySetInstanceUID;\r\n      const referencedDisplaySet = displaySetService.getDisplaySetByUID(referencedDisplaySetUID);\r\n\r\n      const referencedImages = referencedDisplaySet.images;\r\n      const isVolumeIdReferenced = referencedImages[0].imageId.startsWith('volumeId');\r\n\r\n      const measurementData = trackedMeasurements[0].data;\r\n\r\n      let imageIndex = 0;\r\n      if (!isVolumeIdReferenced && measurementData) {\r\n        // if it is imageId referenced find the index of the imageId, we don't have\r\n        // support for volumeId referenced images yet\r\n        imageIndex = referencedImages.findIndex(image => {\r\n          const imageIdToUse = Object.keys(measurementData)[0].substring(8);\r\n          return image.imageId === imageIdToUse;\r\n        });\r\n\r\n        if (imageIndex === -1) {\r\n          console.warn('Could not find image index for tracked measurement, using 0');\r\n          imageIndex = 0;\r\n        }\r\n      }\r\n\r\n      viewportGridService.setDisplaySetsForViewport({\r\n        viewportId: activeViewportId,\r\n        displaySetInstanceUIDs: [referencedDisplaySetUID],\r\n        viewportOptions: {\r\n          initialImageOptions: {\r\n            index: imageIndex,\r\n          },\r\n        },\r\n      });\r\n    },\r\n\r\n    jumpToSameImageInActiveViewport: (ctx, evt) => {\r\n      const { trackedStudy, trackedSeries, activeViewportId } = ctx;\r\n      const measurements = measurementService.getMeasurements();\r\n      const trackedMeasurements = measurements.filter(\r\n        m => trackedStudy === m.referenceStudyUID && trackedSeries.includes(m.referenceSeriesUID)\r\n      );\r\n\r\n      const trackedMeasurement = trackedMeasurements[0];\r\n      const referencedDisplaySetUID = trackedMeasurement.displaySetInstanceUID;\r\n\r\n      // update the previously stored positionPresentation with the new viewportId\r\n      // presentation so that when we put the referencedDisplaySet back in the viewport\r\n      // it will be in the correct position zoom and pan\r\n      commandsManager.runCommand('updateStoredPositionPresentation', {\r\n        viewportId: activeViewportId,\r\n        displaySetInstanceUID: referencedDisplaySetUID,\r\n      });\r\n\r\n      viewportGridService.setDisplaySetsForViewport({\r\n        viewportId: activeViewportId,\r\n        displaySetInstanceUIDs: [referencedDisplaySetUID],\r\n      });\r\n    },\r\n    showStructuredReportDisplaySetInActiveViewport: (ctx, evt) => {\r\n      if (evt.data.createdDisplaySetInstanceUIDs.length > 0) {\r\n        const StructuredReportDisplaySetInstanceUID = evt.data.createdDisplaySetInstanceUIDs[0];\r\n\r\n        viewportGridService.setDisplaySetsForViewport({\r\n          viewportId: evt.data.viewportId,\r\n          displaySetInstanceUIDs: [StructuredReportDisplaySetInstanceUID],\r\n        });\r\n      }\r\n    },\r\n    discardPreviouslyTrackedMeasurements: (ctx, evt) => {\r\n      const measurements = measurementService.getMeasurements();\r\n      const filteredMeasurements = measurements.filter(ms =>\r\n        ctx.prevTrackedSeries.includes(ms.referenceSeriesUID)\r\n      );\r\n      const measurementIds = filteredMeasurements.map(fm => fm.id);\r\n\r\n      for (let i = 0; i < measurementIds.length; i++) {\r\n        measurementService.remove(measurementIds[i]);\r\n      }\r\n    },\r\n    clearAllMeasurements: (ctx, evt) => {\r\n      const measurements = measurementService.getMeasurements();\r\n      const measurementIds = measurements.map(fm => fm.uid);\r\n\r\n      for (let i = 0; i < measurementIds.length; i++) {\r\n        measurementService.remove(measurementIds[i]);\r\n      }\r\n    },\r\n  });\r\n  machineOptions.services = Object.assign({}, machineOptions.services, {\r\n    // Disabled for now\r\n    /*promptBeginTracking: promptBeginTracking.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n      appConfig,\r\n    }),\r\n    promptTrackNewSeries: promptTrackNewSeries.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n      appConfig,\r\n    }),\r\n    promptTrackNewStudy: promptTrackNewStudy.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n      appConfig,\r\n    }),*/\r\n    promptSaveReport: promptSaveReport.bind(null, {\r\n      servicesManager,\r\n      commandsManager,\r\n      extensionManager,\r\n      appConfig,\r\n    }),\r\n    promptHydrateStructuredReport: promptHydrateStructuredReport.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n      appConfig,\r\n    }),\r\n    hydrateStructuredReport: hydrateStructuredReport.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n      appConfig,\r\n    }),\r\n    promptLabelAnnotation: promptLabelAnnotation.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n    }),\r\n  });\r\n  machineOptions.guards = Object.assign({}, machineOptions.guards, {\r\n    isLabelOnMeasure: (ctx, evt, condMeta) => {\r\n      const labelConfig = customizationService.get('measurementLabels');\r\n      return labelConfig?.labelOnMeasure;\r\n    },\r\n    isLabelOnMeasureAndShouldKillMachine: (ctx, evt, condMeta) => {\r\n      const labelConfig = customizationService.get('measurementLabels');\r\n      return evt.data && evt.data.userResponse === RESPONSE.NO_NEVER && labelConfig?.labelOnMeasure;\r\n    },\r\n  });\r\n\r\n  // TODO: IMPROVE\r\n  // - Add measurement_updated to cornerstone; debounced? (ext side, or consumption?)\r\n  // - Friendlier transition/api in front of measurementTracking machine?\r\n  // - Blocked: viewport overlay shouldn't clip when resized\r\n  // TODO: PRIORITY\r\n  // - Fix \"ellipses\" series description dynamic truncate length\r\n  // - Fix viewport border resize\r\n  // - created/destroyed hooks for extensions (cornerstone measurement subscriptions in it's `init`)\r\n\r\n  const measurementTrackingMachine = useMemo(() => {\r\n    return Machine(machineConfiguration, machineOptions);\r\n  }, []); // Empty dependency array ensures this is only created once\r\n\r\n  const [trackedMeasurements, sendTrackedMeasurementsEvent] = useMachine(\r\n    measurementTrackingMachine\r\n  );\r\n\r\n  useEffect(() => {\r\n    // Update the state machine with the active viewport ID\r\n    sendTrackedMeasurementsEvent('UPDATE_ACTIVE_VIEWPORT_ID', {\r\n      activeViewportId,\r\n    });\r\n  }, [activeViewportId, sendTrackedMeasurementsEvent]);\r\n\r\n  // ~~ Listen for changes to ViewportGrid for potential SRs hung in panes when idle\r\n  useEffect(() => {\r\n    const triggerPromptHydrateFlow = async () => {\r\n      if (viewports.size > 0) {\r\n        const activeViewport = viewports.get(activeViewportId);\r\n\r\n        if (!activeViewport || !activeViewport?.displaySetInstanceUIDs?.length) {\r\n          return;\r\n        }\r\n\r\n        // Todo: Getting the first displaySetInstanceUID is wrong, but we don't have\r\n        // tracking fusion viewports yet. This should change when we do.\r\n        const { displaySetService } = servicesManager.services;\r\n        const displaySet = displaySetService.getDisplaySetByUID(\r\n          activeViewport.displaySetInstanceUIDs[0]\r\n        );\r\n\r\n        if (!displaySet) {\r\n          return;\r\n        }\r\n\r\n        // If this is an SR produced by our SR SOPClassHandler,\r\n        // and it hasn't been loaded yet, do that now so we\r\n        // can check if it can be rehydrated or not.\r\n        //\r\n        // Note: This happens:\r\n        // - If the viewport is not currently an OHIFCornerstoneSRViewport\r\n        // - If the displaySet has never been hung\r\n        //\r\n        // Otherwise, the displaySet will be loaded by the useEffect handler\r\n        // listening to displaySet changes inside OHIFCornerstoneSRViewport.\r\n        // The issue here is that this handler in TrackedMeasurementsContext\r\n        // ends up occurring before the Viewport is created, so the displaySet\r\n        // is not loaded yet, and isRehydratable is undefined unless we call load().\r\n        if (\r\n          displaySet.SOPClassHandlerId === SR_SOPCLASSHANDLERID &&\r\n          !displaySet.isLoaded &&\r\n          displaySet.load\r\n        ) {\r\n          await displaySet.load();\r\n        }\r\n\r\n        // Magic string\r\n        // load function added by our sopClassHandler module\r\n        if (\r\n          displaySet.SOPClassHandlerId === SR_SOPCLASSHANDLERID &&\r\n          displaySet.isRehydratable === true\r\n        ) {\r\n          console.log('sending event...', trackedMeasurements);\r\n          sendTrackedMeasurementsEvent('PROMPT_HYDRATE_SR', {\r\n            displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n            SeriesInstanceUID: displaySet.SeriesInstanceUID,\r\n            viewportId: activeViewportId,\r\n          });\r\n        }\r\n      }\r\n    };\r\n    triggerPromptHydrateFlow();\r\n  }, [\r\n    trackedMeasurements,\r\n    activeViewportId,\r\n    sendTrackedMeasurementsEvent,\r\n    servicesManager.services,\r\n    viewports,\r\n  ]);\r\n\r\n  return (\r\n    <TrackedMeasurementsContext.Provider\r\n      value={[trackedMeasurements, sendTrackedMeasurementsEvent]}\r\n    >\r\n      {children}\r\n    </TrackedMeasurementsContext.Provider>\r\n  );\r\n}\r\n\r\nTrackedMeasurementsContextProvider.propTypes = {\r\n  children: PropTypes.oneOf([PropTypes.func, PropTypes.node]),\r\n  servicesManager: PropTypes.object.isRequired,\r\n  commandsManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.object.isRequired,\r\n  appConfig: PropTypes.object,\r\n};\r\n\r\nexport { TrackedMeasurementsContext, TrackedMeasurementsContextProvider, useTrackedMeasurements };\r\n","import {\r\n  TrackedMeasurementsContext,\r\n  TrackedMeasurementsContextProvider,\r\n  useTrackedMeasurements,\r\n} from './contexts';\r\n\r\nfunction getContextModule({ servicesManager, extensionManager, commandsManager }) {\r\n  const BoundTrackedMeasurementsContextProvider = TrackedMeasurementsContextProvider.bind(null, {\r\n    servicesManager,\r\n    extensionManager,\r\n    commandsManager,\r\n  });\r\n\r\n  return [\r\n    {\r\n      name: 'TrackedMeasurementsContext',\r\n      context: TrackedMeasurementsContext,\r\n      provider: BoundTrackedMeasurementsContextProvider,\r\n    },\r\n  ];\r\n}\r\n\r\nexport { useTrackedMeasurements };\r\nexport default getContextModule;\r\n","import type { actionIcon } from '../PanelStudyBrowserTracking/types/actionsIcon';\r\n\r\nconst defaultActionIcons = [\r\n  {\r\n    id: 'settings',\r\n    iconName: 'Settings',\r\n    value: false,\r\n  },\r\n] as actionIcon[];\r\n\r\nexport { defaultActionIcons };\r\n","import type { viewPreset } from '../PanelStudyBrowserTracking/types/viewPreset';\r\n\r\nconst defaultViewPresets = [\r\n  {\r\n    id: 'list',\r\n    iconName: 'ListView',\r\n    selected: false,\r\n  },\r\n  {\r\n    id: 'thumbnails',\r\n    iconName: 'ThumbnailView',\r\n    selected: true,\r\n  },\r\n] as viewPreset[];\r\n\r\nexport { defaultViewPresets };\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport PropTypes from 'prop-types';\r\nimport { utils } from '@ohif/core';\r\nimport { useImageViewer, useViewportGrid, Dialog, ButtonEnums } from '@ohif/ui';\r\nimport { StudyBrowser } from '@ohif/ui-next';\r\n\r\nimport { useTrackedMeasurements } from '../../getContextModule';\r\nimport { Separator } from '@ohif/ui-next';\r\nimport { PanelStudyBrowserHeader } from '@ohif/extension-default';\r\nimport { useAppConfig } from '@state';\r\nimport { defaultActionIcons, defaultViewPresets } from './constants';\r\n\r\nconst { formatDate, createStudyBrowserTabs } = utils;\r\nconst thumbnailNoImageModalities = [\r\n  'SR',\r\n  'SEG',\r\n  'SM',\r\n  'RTSTRUCT',\r\n  'RTPLAN',\r\n  'RTDOSE',\r\n  'DOC',\r\n  'OT',\r\n  'PMAP',\r\n];\r\n/**\r\n *\r\n * @param {*} param0\r\n */\r\nexport default function PanelStudyBrowserTracking({\r\n  servicesManager,\r\n  getImageSrc,\r\n  getStudiesForPatientByMRN,\r\n  requestDisplaySetCreationForStudy,\r\n  dataSource,\r\n  commandsManager,\r\n}: withAppTypes) {\r\n  const {\r\n    displaySetService,\r\n    uiDialogService,\r\n    hangingProtocolService,\r\n    uiNotificationService,\r\n    measurementService,\r\n    studyPrefetcherService,\r\n    customizationService,\r\n  } = servicesManager.services;\r\n  const navigate = useNavigate();\r\n  const { mode: studyMode } = customizationService.getCustomization('PanelStudyBrowser.studyMode', {\r\n    id: 'default',\r\n    mode: 'all',\r\n  });\r\n\r\n  const { t } = useTranslation('Common');\r\n\r\n  // Normally you nest the components so the tree isn't so deep, and the data\r\n  // doesn't have to have such an intense shape. This works well enough for now.\r\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\r\n  const { StudyInstanceUIDs } = useImageViewer();\r\n  const [{ activeViewportId, viewports, isHangingProtocolLayout }, viewportGridService] =\r\n    useViewportGrid();\r\n  const [trackedMeasurements, sendTrackedMeasurementsEvent] = useTrackedMeasurements();\r\n\r\n  const [activeTabName, setActiveTabName] = useState(studyMode);\r\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\r\n    ...StudyInstanceUIDs,\r\n  ]);\r\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\r\n  const [hasLoadedViewports, setHasLoadedViewports] = useState(false);\r\n  const [displaySets, setDisplaySets] = useState([]);\r\n  const [displaySetsLoadingState, setDisplaySetsLoadingState] = useState({});\r\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\r\n  const [jumpToDisplaySet, setJumpToDisplaySet] = useState(null);\r\n\r\n  const [viewPresets, setViewPresets] = useState(\r\n    customizationService.getCustomization('studyBrowser.viewPresets')?.value || defaultViewPresets\r\n  );\r\n\r\n  const [actionIcons, setActionIcons] = useState(defaultActionIcons);\r\n\r\n  const updateActionIconValue = actionIcon => {\r\n    actionIcon.value = !actionIcon.value;\r\n    const newActionIcons = [...actionIcons];\r\n    setActionIcons(newActionIcons);\r\n  };\r\n\r\n  const updateViewPresetValue = viewPreset => {\r\n    if (!viewPreset) {\r\n      return;\r\n    }\r\n    const newViewPresets = viewPresets.map(preset => {\r\n      preset.selected = preset.id === viewPreset.id;\r\n      return preset;\r\n    });\r\n    setViewPresets(newViewPresets);\r\n  };\r\n\r\n  const onDoubleClickThumbnailHandler = displaySetInstanceUID => {\r\n    let updatedViewports = [];\r\n    const viewportId = activeViewportId;\r\n    try {\r\n      updatedViewports = hangingProtocolService.getViewportsRequireUpdate(\r\n        viewportId,\r\n        displaySetInstanceUID,\r\n        isHangingProtocolLayout\r\n      );\r\n    } catch (error) {\r\n      console.warn(error);\r\n      uiNotificationService.show({\r\n        title: 'Thumbnail Double Click',\r\n        message:\r\n          'The selected display sets could not be added to the viewport due to a mismatch in the Hanging Protocol rules.',\r\n        type: 'error',\r\n        duration: 3000,\r\n      });\r\n    }\r\n\r\n    viewportGridService.setDisplaySetsForViewports(updatedViewports);\r\n  };\r\n\r\n  const activeViewportDisplaySetInstanceUIDs =\r\n    viewports.get(activeViewportId)?.displaySetInstanceUIDs;\r\n\r\n  const { trackedSeries } = trackedMeasurements.context;\r\n\r\n  useEffect(() => {\r\n    setActiveTabName(studyMode);\r\n  }, [studyMode]);\r\n\r\n  // ~~ studyDisplayList\r\n  useEffect(() => {\r\n    // Fetch all studies for the patient in each primary study\r\n    async function fetchStudiesForPatient(StudyInstanceUID) {\r\n      // current study qido\r\n      const qidoForStudyUID = await dataSource.query.studies.search({\r\n        studyInstanceUid: StudyInstanceUID,\r\n      });\r\n\r\n      if (!qidoForStudyUID?.length) {\r\n        navigate('/notfoundstudy', '_self');\r\n        throw new Error('Invalid study URL');\r\n      }\r\n\r\n      let qidoStudiesForPatient = qidoForStudyUID;\r\n\r\n      // try to fetch the prior studies based on the patientID if the\r\n      // server can respond.\r\n      try {\r\n        qidoStudiesForPatient = await getStudiesForPatientByMRN(qidoForStudyUID);\r\n      } catch (error) {\r\n        console.warn(error);\r\n      }\r\n\r\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\r\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\r\n        return {\r\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\r\n          date: formatDate(qidoStudy.StudyDate) || t('NoStudyDate'),\r\n          description: qidoStudy.StudyDescription,\r\n          modalities: qidoStudy.ModalitiesInStudy,\r\n          numInstances: qidoStudy.NumInstances,\r\n        };\r\n      });\r\n\r\n      setStudyDisplayList(prevArray => {\r\n        const ret = [...prevArray];\r\n        for (const study of actuallyMappedStudies) {\r\n          if (!prevArray.find(it => it.studyInstanceUid === study.studyInstanceUid)) {\r\n            ret.push(study);\r\n          }\r\n        }\r\n        return ret;\r\n      });\r\n    }\r\n\r\n    StudyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [StudyInstanceUIDs, getStudiesForPatientByMRN]);\r\n\r\n  // ~~ Initial Thumbnails\r\n  useEffect(() => {\r\n    if (!hasLoadedViewports) {\r\n      if (activeViewportId) {\r\n        // Once there is an active viewport id, it means the layout is ready\r\n        // so wait a bit of time to allow the viewports preferential loading\r\n        // which improves user experience of responsiveness significantly on slower\r\n        // systems.\r\n        window.setTimeout(() => setHasLoadedViewports(true), 250);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    let currentDisplaySets = displaySetService.activeDisplaySets;\r\n    // filter non based on the list of modalities that are supported by cornerstone\r\n    currentDisplaySets = currentDisplaySets.filter(\r\n      ds => !thumbnailNoImageModalities.includes(ds.Modality)\r\n    );\r\n\r\n    if (!currentDisplaySets.length) {\r\n      return;\r\n    }\r\n\r\n    currentDisplaySets.forEach(async dSet => {\r\n      const newImageSrcEntry = {};\r\n      const displaySet = displaySetService.getDisplaySetByUID(dSet.displaySetInstanceUID);\r\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n\r\n      const imageId = getImageIdForThumbnail(displaySet, imageIds);\r\n\r\n      // TODO: Is it okay that imageIds are not returned here for SR displaySets?\r\n      if (!imageId || displaySet?.unsupported) {\r\n        return;\r\n      }\r\n      // When the image arrives, render it and store the result in the thumbnailImgSrcMap\r\n      newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(imageId);\r\n\r\n      setThumbnailImageSrcMap(prevState => {\r\n        return { ...prevState, ...newImageSrcEntry };\r\n      });\r\n    });\r\n  }, [displaySetService, dataSource, getImageSrc, activeViewportId, hasLoadedViewports]);\r\n\r\n  // ~~ displaySets\r\n  useEffect(() => {\r\n    const currentDisplaySets = displaySetService.activeDisplaySets;\r\n\r\n    if (!currentDisplaySets.length) {\r\n      return;\r\n    }\r\n\r\n    const mappedDisplaySets = _mapDisplaySets(\r\n      currentDisplaySets,\r\n      displaySetsLoadingState,\r\n      thumbnailImageSrcMap,\r\n      trackedSeries,\r\n      viewports,\r\n      viewportGridService,\r\n      dataSource,\r\n      displaySetService,\r\n      uiDialogService,\r\n      uiNotificationService\r\n    );\r\n\r\n    setDisplaySets(mappedDisplaySets);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    displaySetService.activeDisplaySets,\r\n    displaySetsLoadingState,\r\n    trackedSeries,\r\n    viewports,\r\n    dataSource,\r\n    thumbnailImageSrcMap,\r\n  ]);\r\n\r\n  // -- displaySetsLoadingState\r\n  useEffect(() => {\r\n    const { unsubscribe } = studyPrefetcherService.subscribe(\r\n      studyPrefetcherService.EVENTS.DISPLAYSET_LOAD_PROGRESS,\r\n      updatedDisplaySetLoadingState => {\r\n        const { displaySetInstanceUID, loadingProgress } = updatedDisplaySetLoadingState;\r\n\r\n        setDisplaySetsLoadingState(prevState => ({\r\n          ...prevState,\r\n          [displaySetInstanceUID]: loadingProgress,\r\n        }));\r\n      }\r\n    );\r\n\r\n    return () => unsubscribe();\r\n  }, [studyPrefetcherService]);\r\n\r\n  // ~~ subscriptions --> displaySets\r\n  useEffect(() => {\r\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\r\n    const SubscriptionDisplaySetsAdded = displaySetService.subscribe(\r\n      displaySetService.EVENTS.DISPLAY_SETS_ADDED,\r\n      data => {\r\n        if (!hasLoadedViewports) {\r\n          return;\r\n        }\r\n        const { displaySetsAdded, options } = data;\r\n        displaySetsAdded.forEach(async dSet => {\r\n          const displaySetInstanceUID = dSet.displaySetInstanceUID;\r\n\r\n          const newImageSrcEntry = {};\r\n          const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n          if (displaySet?.unsupported) {\r\n            return;\r\n          }\r\n\r\n          if (options.madeInClient) {\r\n            setJumpToDisplaySet(displaySetInstanceUID);\r\n          }\r\n\r\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n          const imageId = getImageIdForThumbnail(displaySet, imageIds);\r\n\r\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\r\n          if (!imageId) {\r\n            return;\r\n          }\r\n\r\n          // When the image arrives, render it and store the result in the thumbnailImgSrcMap\r\n          newImageSrcEntry[displaySetInstanceUID] = await getImageSrc(imageId);\r\n          setThumbnailImageSrcMap(prevState => {\r\n            return { ...prevState, ...newImageSrcEntry };\r\n          });\r\n        });\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      SubscriptionDisplaySetsAdded.unsubscribe();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [displaySetService, dataSource, getImageSrc, thumbnailImageSrcMap, trackedSeries, viewports]);\r\n\r\n  useEffect(() => {\r\n    // TODO: Will this always hold _all_ the displaySets we care about?\r\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\r\n    const SubscriptionDisplaySetsChanged = displaySetService.subscribe(\r\n      displaySetService.EVENTS.DISPLAY_SETS_CHANGED,\r\n      changedDisplaySets => {\r\n        const mappedDisplaySets = _mapDisplaySets(\r\n          changedDisplaySets,\r\n          displaySetsLoadingState,\r\n          thumbnailImageSrcMap,\r\n          trackedSeries,\r\n          viewports,\r\n          viewportGridService,\r\n          dataSource,\r\n          displaySetService,\r\n          uiDialogService,\r\n          uiNotificationService\r\n        );\r\n\r\n        setDisplaySets(mappedDisplaySets);\r\n      }\r\n    );\r\n\r\n    const SubscriptionDisplaySetMetaDataInvalidated = displaySetService.subscribe(\r\n      displaySetService.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,\r\n      () => {\r\n        const mappedDisplaySets = _mapDisplaySets(\r\n          displaySetService.getActiveDisplaySets(),\r\n          displaySetsLoadingState,\r\n          thumbnailImageSrcMap,\r\n          trackedSeries,\r\n          viewports,\r\n          viewportGridService,\r\n          dataSource,\r\n          displaySetService,\r\n          uiDialogService,\r\n          uiNotificationService\r\n        );\r\n\r\n        setDisplaySets(mappedDisplaySets);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      SubscriptionDisplaySetsChanged.unsubscribe();\r\n      SubscriptionDisplaySetMetaDataInvalidated.unsubscribe();\r\n    };\r\n  }, [\r\n    displaySetsLoadingState,\r\n    thumbnailImageSrcMap,\r\n    trackedSeries,\r\n    viewports,\r\n    dataSource,\r\n    displaySetService,\r\n  ]);\r\n\r\n  const tabs = createStudyBrowserTabs(StudyInstanceUIDs, studyDisplayList, displaySets);\r\n\r\n  // TODO: Should not fire this on \"close\"\r\n  function _handleStudyClick(StudyInstanceUID) {\r\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\r\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\r\n      ? [...expandedStudyInstanceUIDs.filter(stdyUid => stdyUid !== StudyInstanceUID)]\r\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\r\n\r\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\r\n\r\n    if (!shouldCollapseStudy) {\r\n      const madeInClient = true;\r\n      requestDisplaySetCreationForStudy(displaySetService, StudyInstanceUID, madeInClient);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (jumpToDisplaySet) {\r\n      // Get element by displaySetInstanceUID\r\n      const displaySetInstanceUID = jumpToDisplaySet;\r\n      const element = document.getElementById(`thumbnail-${displaySetInstanceUID}`);\r\n\r\n      if (element && typeof element.scrollIntoView === 'function') {\r\n        // TODO: Any way to support IE here?\r\n        element.scrollIntoView({ behavior: 'smooth' });\r\n\r\n        setJumpToDisplaySet(null);\r\n      }\r\n    }\r\n  }, [jumpToDisplaySet, expandedStudyInstanceUIDs, activeTabName]);\r\n\r\n  useEffect(() => {\r\n    if (!jumpToDisplaySet) {\r\n      return;\r\n    }\r\n\r\n    const displaySetInstanceUID = jumpToDisplaySet;\r\n    // Set the activeTabName and expand the study\r\n    const thumbnailLocation = _findTabAndStudyOfDisplaySet(displaySetInstanceUID, tabs);\r\n    if (!thumbnailLocation) {\r\n      console.warn('jumpToThumbnail: displaySet thumbnail not found.');\r\n\r\n      return;\r\n    }\r\n    const { tabName, StudyInstanceUID } = thumbnailLocation;\r\n    setActiveTabName(tabName);\r\n    const studyExpanded = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\r\n    if (!studyExpanded) {\r\n      const updatedExpandedStudyInstanceUIDs = [...expandedStudyInstanceUIDs, StudyInstanceUID];\r\n      setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\r\n    }\r\n  }, [expandedStudyInstanceUIDs, jumpToDisplaySet, tabs]);\r\n\r\n  const onClickUntrack = displaySetInstanceUID => {\r\n    const onConfirm = () => {\r\n      const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n      sendTrackedMeasurementsEvent('UNTRACK_SERIES', {\r\n        SeriesInstanceUID: displaySet.SeriesInstanceUID,\r\n      });\r\n      const measurements = measurementService.getMeasurements();\r\n      measurements.forEach(m => {\r\n        if (m.referenceSeriesUID === displaySet.SeriesInstanceUID) {\r\n          measurementService.remove(m.uid);\r\n        }\r\n      });\r\n    };\r\n\r\n    uiDialogService.create({\r\n      id: 'untrack-series',\r\n      centralize: true,\r\n      isDraggable: false,\r\n      showOverlay: true,\r\n      content: Dialog,\r\n      contentProps: {\r\n        title: 'Untrack Series',\r\n        body: () => (\r\n          <div className=\"bg-primary-dark p-4 text-white\">\r\n            <p>Are you sure you want to untrack this series?</p>\r\n            <p className=\"mt-2\">\r\n              This action cannot be undone and will delete all your existing measurements.\r\n            </p>\r\n          </div>\r\n        ),\r\n        actions: [\r\n          {\r\n            id: 'cancel',\r\n            text: 'Cancel',\r\n            type: ButtonEnums.type.secondary,\r\n          },\r\n          {\r\n            id: 'yes',\r\n            text: 'Yes',\r\n            type: ButtonEnums.type.primary,\r\n            classes: ['untrack-yes-button'],\r\n          },\r\n        ],\r\n        onClose: () => uiDialogService.dismiss({ id: 'untrack-series' }),\r\n        onSubmit: async ({ action }) => {\r\n          switch (action.id) {\r\n            case 'yes':\r\n              onConfirm();\r\n              uiDialogService.dismiss({ id: 'untrack-series' });\r\n              break;\r\n            case 'cancel':\r\n              uiDialogService.dismiss({ id: 'untrack-series' });\r\n              break;\r\n          }\r\n        },\r\n      },\r\n    });\r\n  };\r\n\r\n  const onThumbnailContextMenu = (commandName, options) => {\r\n    commandsManager.runCommand(commandName, options);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <>\r\n        <PanelStudyBrowserHeader\r\n          viewPresets={viewPresets}\r\n          updateViewPresetValue={updateViewPresetValue}\r\n          actionIcons={actionIcons}\r\n          updateActionIconValue={updateActionIconValue}\r\n        />\r\n        <Separator\r\n          orientation=\"horizontal\"\r\n          className=\"bg-black\"\r\n          thickness=\"2px\"\r\n        />\r\n      </>\r\n\r\n      <StudyBrowser\r\n        tabs={tabs}\r\n        servicesManager={servicesManager}\r\n        activeTabName={activeTabName}\r\n        expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\r\n        onClickStudy={_handleStudyClick}\r\n        onClickTab={clickedTabName => {\r\n          setActiveTabName(clickedTabName);\r\n        }}\r\n        onClickUntrack={displaySetInstanceUID => {\r\n          onClickUntrack(displaySetInstanceUID);\r\n        }}\r\n        onClickThumbnail={() => {}}\r\n        onDoubleClickThumbnail={onDoubleClickThumbnailHandler}\r\n        activeDisplaySetInstanceUIDs={activeViewportDisplaySetInstanceUIDs}\r\n        showSettings={actionIcons.find(icon => icon.id === 'settings').value}\r\n        viewPresets={viewPresets}\r\n        onThumbnailContextMenu={onThumbnailContextMenu}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nPanelStudyBrowserTracking.propTypes = {\r\n  servicesManager: PropTypes.object.isRequired,\r\n  dataSource: PropTypes.shape({\r\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  getImageSrc: PropTypes.func.isRequired,\r\n  getStudiesForPatientByMRN: PropTypes.func.isRequired,\r\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\r\n};\r\n\r\nfunction getImageIdForThumbnail(displaySet: any, imageIds: any) {\r\n  let imageId;\r\n  if (displaySet.isDynamicVolume) {\r\n    const timePoints = displaySet.dynamicVolumeInfo.timePoints;\r\n    const middleIndex = Math.floor(timePoints.length / 2);\r\n    const middleTimePointImageIds = timePoints[middleIndex];\r\n    imageId = middleTimePointImageIds[Math.floor(middleTimePointImageIds.length / 2)];\r\n  } else {\r\n    imageId = imageIds[Math.floor(imageIds.length / 2)];\r\n  }\r\n  return imageId;\r\n}\r\n\r\n/**\r\n * Maps from the DataSource's format to a naturalized object\r\n *\r\n * @param {*} studies\r\n */\r\nfunction _mapDataSourceStudies(studies) {\r\n  return studies.map(study => {\r\n    // TODO: Why does the data source return in this format?\r\n    return {\r\n      AccessionNumber: study.accession,\r\n      StudyDate: study.date,\r\n      StudyDescription: study.description,\r\n      NumInstances: study.instances,\r\n      ModalitiesInStudy: study.modalities,\r\n      PatientID: study.mrn,\r\n      PatientName: study.patientName,\r\n      StudyInstanceUID: study.studyInstanceUid,\r\n      StudyTime: study.time,\r\n    };\r\n  });\r\n}\r\n\r\nfunction _mapDisplaySets(\r\n  displaySets,\r\n  displaySetLoadingState,\r\n  thumbnailImageSrcMap,\r\n  trackedSeriesInstanceUIDs,\r\n  viewports, // TODO: make array of `displaySetInstanceUIDs`?\r\n  viewportGridService,\r\n  dataSource,\r\n  displaySetService,\r\n  uiDialogService,\r\n  uiNotificationService\r\n) {\r\n  const thumbnailDisplaySets = [];\r\n  const thumbnailNoImageDisplaySets = [];\r\n  displaySets\r\n    .filter(ds => !ds.excludeFromThumbnailBrowser)\r\n    .forEach(ds => {\r\n      const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\r\n      const componentType = _getComponentType(ds);\r\n      const numPanes = viewportGridService.getNumViewportPanes();\r\n\r\n      const array =\r\n        componentType === 'thumbnailTracked' ? thumbnailDisplaySets : thumbnailNoImageDisplaySets;\r\n\r\n      const { displaySetInstanceUID } = ds;\r\n      const loadingProgress = displaySetLoadingState?.[displaySetInstanceUID];\r\n\r\n      const thumbnailProps = {\r\n        displaySetInstanceUID,\r\n        description: ds.SeriesDescription,\r\n        seriesNumber: ds.SeriesNumber,\r\n        modality: ds.Modality,\r\n        seriesDate: formatDate(ds.SeriesDate),\r\n        numInstances: ds.numImageFrames,\r\n        loadingProgress,\r\n        countIcon: ds.countIcon,\r\n        messages: ds.messages,\r\n        StudyInstanceUID: ds.StudyInstanceUID,\r\n        componentType,\r\n        imageSrc,\r\n        dragData: {\r\n          type: 'displayset',\r\n          displaySetInstanceUID,\r\n          // .. Any other data to pass\r\n        },\r\n        isTracked: trackedSeriesInstanceUIDs.includes(ds.SeriesInstanceUID),\r\n        isHydratedForDerivedDisplaySet: ds.isHydrated,\r\n      };\r\n\r\n      if (componentType === 'thumbnailNoImage') {\r\n        if (dataSource.reject && dataSource.reject.series) {\r\n          thumbnailProps.canReject = !ds?.unsupported;\r\n          thumbnailProps.onReject = () => {\r\n            uiDialogService.create({\r\n              id: 'ds-reject-sr',\r\n              centralize: true,\r\n              isDraggable: false,\r\n              showOverlay: true,\r\n              content: Dialog,\r\n              contentProps: {\r\n                title: 'Delete Report',\r\n                body: () => (\r\n                  <div className=\"bg-primary-dark p-4 text-white\">\r\n                    <p>Are you sure you want to delete this report?</p>\r\n                    <p className=\"mt-2\">This action cannot be undone.</p>\r\n                  </div>\r\n                ),\r\n                actions: [\r\n                  {\r\n                    id: 'cancel',\r\n                    text: 'Cancel',\r\n                    type: ButtonEnums.type.secondary,\r\n                  },\r\n                  {\r\n                    id: 'yes',\r\n                    text: 'Yes',\r\n                    type: ButtonEnums.type.primary,\r\n                    classes: ['reject-yes-button'],\r\n                  },\r\n                ],\r\n                onClose: () => uiDialogService.dismiss({ id: 'ds-reject-sr' }),\r\n                onShow: () => {\r\n                  const yesButton = document.querySelector('.reject-yes-button');\r\n\r\n                  yesButton.focus();\r\n                },\r\n                onSubmit: async ({ action }) => {\r\n                  switch (action.id) {\r\n                    case 'yes':\r\n                      try {\r\n                        await dataSource.reject.series(ds.StudyInstanceUID, ds.SeriesInstanceUID);\r\n                        displaySetService.deleteDisplaySet(displaySetInstanceUID);\r\n                        uiDialogService.dismiss({ id: 'ds-reject-sr' });\r\n                        uiNotificationService.show({\r\n                          title: 'Delete Report',\r\n                          message: 'Report deleted successfully',\r\n                          type: 'success',\r\n                        });\r\n                      } catch (error) {\r\n                        uiDialogService.dismiss({ id: 'ds-reject-sr' });\r\n                        uiNotificationService.show({\r\n                          title: 'Delete Report',\r\n                          message: 'Failed to delete report',\r\n                          type: 'error',\r\n                        });\r\n                      }\r\n                      break;\r\n                    case 'cancel':\r\n                      uiDialogService.dismiss({ id: 'ds-reject-sr' });\r\n                      break;\r\n                  }\r\n                },\r\n              },\r\n            });\r\n          };\r\n        } else {\r\n          thumbnailProps.canReject = false;\r\n        }\r\n      }\r\n\r\n      array.push(thumbnailProps);\r\n    });\r\n\r\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\r\n}\r\n\r\nfunction _getComponentType(ds) {\r\n  if (thumbnailNoImageModalities.includes(ds.Modality) || ds?.unsupported) {\r\n    return 'thumbnailNoImage';\r\n  }\r\n\r\n  return 'thumbnailTracked';\r\n}\r\n\r\nfunction _findTabAndStudyOfDisplaySet(displaySetInstanceUID, tabs) {\r\n  for (let t = 0; t < tabs.length; t++) {\r\n    const { studies } = tabs[t];\r\n\r\n    for (let s = 0; s < studies.length; s++) {\r\n      const { displaySets } = studies[s];\r\n\r\n      for (let d = 0; d < displaySets.length; d++) {\r\n        const displaySet = displaySets[d];\r\n\r\n        if (displaySet.displaySetInstanceUID === displaySetInstanceUID) {\r\n          return {\r\n            tabName: tabs[t].name,\r\n            StudyInstanceUID: studies[s].studyInstanceUid,\r\n          };\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @param {*} cornerstone\r\n * @param {*} imageId\r\n */\r\nfunction getImageSrcFromImageId(cornerstone, imageId) {\r\n  return new Promise((resolve, reject) => {\r\n    const canvas = document.createElement('canvas');\r\n    cornerstone.utilities\r\n      .loadImageToCanvas({ canvas, imageId, thumbnail: true })\r\n      .then(imageId => {\r\n        resolve(canvas.toDataURL());\r\n      })\r\n      .catch(reject);\r\n  });\r\n}\r\n\r\nexport default getImageSrcFromImageId;\r\n","function requestDisplaySetCreationForStudy(\r\n  dataSource,\r\n  displaySetService,\r\n  StudyInstanceUID,\r\n  madeInClient\r\n) {\r\n  if (\r\n    displaySetService.activeDisplaySets.some(\r\n      displaySet => displaySet.StudyInstanceUID === StudyInstanceUID\r\n    )\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  dataSource.retrieve.series.metadata({ StudyInstanceUID, madeInClient });\r\n}\r\n\r\nexport default requestDisplaySetCreationForStudy;\r\n","import React, { useCallback, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\n//\r\nimport PanelStudyBrowserTracking from './PanelStudyBrowserTracking';\r\nimport getImageSrcFromImageId from './getImageSrcFromImageId';\r\nimport requestDisplaySetCreationForStudy from './requestDisplaySetCreationForStudy';\r\n\r\nfunction _getStudyForPatientUtility(extensionManager) {\r\n  const utilityModule = extensionManager.getModuleEntry(\r\n    '@ohif/extension-default.utilityModule.common'\r\n  );\r\n\r\n  const { getStudiesForPatientByMRN } = utilityModule.exports;\r\n  return getStudiesForPatientByMRN;\r\n}\r\n\r\n/**\r\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\r\n *\r\n * @param {object} params\r\n * @param {object} commandsManager\r\n * @param {object} extensionManager\r\n */\r\nfunction WrappedPanelStudyBrowserTracking({\r\n  commandsManager,\r\n  extensionManager,\r\n  servicesManager,\r\n}: withAppTypes) {\r\n  const dataSource = extensionManager.getActiveDataSource()[0];\r\n\r\n  const getStudiesForPatientByMRN = _getStudyForPatientUtility(extensionManager);\r\n  const _getStudiesForPatientByMRN = getStudiesForPatientByMRN.bind(null, dataSource);\r\n  const _getImageSrcFromImageId = useCallback(\r\n    _createGetImageSrcFromImageIdFn(extensionManager),\r\n    []\r\n  );\r\n  const _requestDisplaySetCreationForStudy = requestDisplaySetCreationForStudy.bind(\r\n    null,\r\n    dataSource\r\n  );\r\n\r\n  return (\r\n    <PanelStudyBrowserTracking\r\n      servicesManager={servicesManager}\r\n      commandsManager={commandsManager}\r\n      dataSource={dataSource}\r\n      getImageSrc={_getImageSrcFromImageId}\r\n      getStudiesForPatientByMRN={_getStudiesForPatientByMRN}\r\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Grabs cornerstone library reference using a dependent command from\r\n * the @ohif/extension-cornerstone extension. Then creates a helper function\r\n * that can take an imageId and return an image src.\r\n *\r\n * @param {func} getCommand - CommandManager's getCommand method\r\n * @returns {func} getImageSrcFromImageId - A utility function powered by\r\n * cornerstone\r\n */\r\nfunction _createGetImageSrcFromImageIdFn(extensionManager) {\r\n  const utilities = extensionManager.getModuleEntry(\r\n    '@ohif/extension-cornerstone.utilityModule.common'\r\n  );\r\n\r\n  try {\r\n    const { cornerstone } = utilities.exports.getCornerstoneLibraries();\r\n    return getImageSrcFromImageId.bind(null, cornerstone);\r\n  } catch (ex) {\r\n    throw new Error('Required command not found');\r\n  }\r\n}\r\n\r\nWrappedPanelStudyBrowserTracking.propTypes = {\r\n  commandsManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.object.isRequired,\r\n  servicesManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default WrappedPanelStudyBrowserTracking;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { PanelMeasurement } from '@ohif/extension-cornerstone';\r\nimport { useViewportGrid, ButtonEnums, Dialog } from '@ohif/ui';\r\nimport { StudySummary } from '@ohif/ui-next';\r\nimport { Button, Icons } from '@ohif/ui-next';\r\nimport { DicomMetadataStore, utils } from '@ohif/core';\r\nimport { useTrackedMeasurements } from '../getContextModule';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst { downloadCSVReport, formatDate } = utils;\r\n\r\nconst DISPLAY_STUDY_SUMMARY_INITIAL_VALUE = {\r\n  key: undefined, //\r\n  date: '', // '07-Sep-2010',\r\n  modality: '', // 'CT',\r\n  description: '', // 'CHEST/ABD/PELVIS W CONTRAST',\r\n};\r\n\r\nfunction PanelMeasurementTableTracking({\r\n  servicesManager,\r\n  extensionManager,\r\n  commandsManager,\r\n}: withAppTypes) {\r\n  const [viewportGrid] = useViewportGrid();\r\n  const { t } = useTranslation('MeasurementTable');\r\n  const { measurementService, customizationService, uiDialogService } = servicesManager.services;\r\n  const [trackedMeasurements, sendTrackedMeasurementsEvent] = useTrackedMeasurements();\r\n  const { trackedStudy, trackedSeries } = trackedMeasurements.context;\r\n  const [displayStudySummary, setDisplayStudySummary] = useState(\r\n    DISPLAY_STUDY_SUMMARY_INITIAL_VALUE\r\n  );\r\n\r\n  useEffect(() => {\r\n    const updateDisplayStudySummary = async () => {\r\n      if (trackedMeasurements.matches('tracking') && trackedStudy) {\r\n        const studyMeta = DicomMetadataStore.getStudy(trackedStudy);\r\n        if (!studyMeta || !studyMeta.series || studyMeta.series.length === 0) {\r\n          console.debug('Study metadata not available');\r\n          return;\r\n        }\r\n\r\n        const instanceMeta = studyMeta.series[0].instances[0];\r\n        const { StudyDate, StudyDescription } = instanceMeta;\r\n\r\n        const modalities = new Set();\r\n        studyMeta.series.forEach(series => {\r\n          if (trackedSeries.includes(series.SeriesInstanceUID)) {\r\n            modalities.add(series.instances[0].Modality);\r\n          }\r\n        });\r\n        const modality = Array.from(modalities).join('/');\r\n\r\n        setDisplayStudySummary(prevSummary => {\r\n          if (prevSummary.key !== trackedStudy) {\r\n            return {\r\n              key: trackedStudy,\r\n              date: StudyDate,\r\n              modality,\r\n              description: StudyDescription,\r\n            };\r\n          }\r\n          return prevSummary;\r\n        });\r\n      } else if (!trackedStudy) {\r\n        setDisplayStudySummary(DISPLAY_STUDY_SUMMARY_INITIAL_VALUE);\r\n      }\r\n    };\r\n\r\n    updateDisplayStudySummary();\r\n  }, [trackedMeasurements, trackedStudy, trackedSeries]);\r\n\r\n  const { disableEditing } = customizationService.getCustomization(\r\n    'PanelMeasurement.disableEditing',\r\n    {\r\n      id: 'default.disableEditing',\r\n      disableEditing: false,\r\n    }\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {displayStudySummary.key && (\r\n        <StudySummary\r\n          date={formatDate(displayStudySummary.date)}\r\n          description={displayStudySummary.description}\r\n        />\r\n      )}\r\n      <PanelMeasurement\r\n        servicesManager={servicesManager}\r\n        extensionManager={extensionManager}\r\n        commandsManager={commandsManager}\r\n        measurementFilter={measurement =>\r\n          trackedStudy === measurement.referenceStudyUID &&\r\n          trackedSeries.includes(measurement.referenceSeriesUID)\r\n        }\r\n        customHeader={({ additionalFindings, measurements }) => {\r\n          const disabled = additionalFindings.length === 0 && measurements.length === 0;\r\n\r\n          if (disableEditing || disabled) {\r\n            return null;\r\n          }\r\n\r\n          return (\r\n            <div className=\"bg-background flex h-9 w-full items-center rounded pr-0.5\">\r\n              <div className=\"flex space-x-1\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"pl-1.5\"\r\n                  onClick={() => {\r\n                    const measurements = measurementService.getMeasurements();\r\n                    const trackedMeasurements = measurements.filter(\r\n                      m =>\r\n                        trackedStudy === m.referenceStudyUID &&\r\n                        trackedSeries.includes(m.referenceSeriesUID)\r\n                    );\r\n\r\n                    downloadCSVReport(trackedMeasurements);\r\n                  }}\r\n                >\r\n                  <Icons.Download className=\"h-5 w-5\" />\r\n                  <span className=\"pl-1\">CSV</span>\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"pl-0.5\"\r\n                  onClick={() => {\r\n                    sendTrackedMeasurementsEvent('SAVE_REPORT', {\r\n                      viewportId: viewportGrid.activeViewportId,\r\n                      isBackupSave: true,\r\n                    });\r\n                  }}\r\n                >\r\n                  <Icons.Add />\r\n                  Create SR\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"pl-0.5\"\r\n                  onClick={() => {\r\n                    uiDialogService.create({\r\n                      id: 'delete-all-measurements',\r\n                      centralize: true,\r\n                      isDraggable: false,\r\n                      showOverlay: true,\r\n                      content: Dialog,\r\n                      contentProps: {\r\n                        title: 'Delete All Measurements',\r\n                        body: () => (\r\n                          <div className=\"bg-primary-dark text-white\">\r\n                            <p>Are you sure you want to delete all measurements?</p>\r\n                            <p className=\"mt-2\">This action cannot be undone.</p>\r\n                          </div>\r\n                        ),\r\n                        actions: [\r\n                          {\r\n                            id: 'cancel',\r\n                            text: 'Cancel',\r\n                            type: ButtonEnums.type.secondary,\r\n                          },\r\n                          {\r\n                            id: 'yes',\r\n                            text: 'Delete All',\r\n                            type: ButtonEnums.type.primary,\r\n                            classes: ['delete-all-yes-button'],\r\n                          },\r\n                        ],\r\n                        onClose: () => uiDialogService.dismiss({ id: 'delete-all-measurements' }),\r\n                        onSubmit: async ({ action }) => {\r\n                          switch (action.id) {\r\n                            case 'yes':\r\n                              measurementService.clearMeasurements();\r\n                              uiDialogService.dismiss({ id: 'delete-all-measurements' });\r\n                              break;\r\n                            case 'cancel':\r\n                              uiDialogService.dismiss({ id: 'delete-all-measurements' });\r\n                              break;\r\n                          }\r\n                        },\r\n                      },\r\n                    });\r\n                  }}\r\n                >\r\n                  <Icons.Delete />\r\n                  Delete All\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          );\r\n        }}\r\n      ></PanelMeasurement>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default PanelMeasurementTableTracking;\r\n","import { Types } from '@ohif/core';\r\nimport { PanelMeasurementTableTracking, PanelStudyBrowserTracking } from './panels';\r\nimport i18n from 'i18next';\r\nimport React from 'react';\r\n\r\n// TODO:\r\n// - No loading UI exists yet\r\n// - cancel promises when component is destroyed\r\n// - show errors in UI for thumbnails if promise fails\r\n\r\nfunction getPanelModule({ commandsManager, extensionManager, servicesManager }): Types.Panel[] {\r\n  return [\r\n    {\r\n      name: 'seriesList',\r\n      iconName: 'tab-studies',\r\n      iconLabel: 'Studies',\r\n      label: i18n.t('SidePanel:Studies'),\r\n      component: props => (\r\n        <PanelStudyBrowserTracking\r\n          {...props}\r\n          commandsManager={commandsManager}\r\n          extensionManager={extensionManager}\r\n          servicesManager={servicesManager}\r\n        />\r\n      ),\r\n    },\r\n    {\r\n      name: 'trackedMeasurements',\r\n      iconName: 'tab-linear',\r\n      iconLabel: 'Measure',\r\n      label: i18n.t('SidePanel:Measurements'),\r\n      component: props => (\r\n        <PanelMeasurementTableTracking\r\n          {...props}\r\n          commandsManager={commandsManager}\r\n          extensionManager={extensionManager}\r\n          servicesManager={servicesManager}\r\n        />\r\n      ),\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getPanelModule;\r\n","import React from 'react';\r\n\r\nconst Component = React.lazy(() => {\r\n  return import(/* webpackPrefetch: true */ './viewports/TrackedCornerstoneViewport');\r\n});\r\n\r\nconst OHIFCornerstoneViewport = props => {\r\n  return (\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      <Component {...props} />\r\n    </React.Suspense>\r\n  );\r\n};\r\n\r\nfunction getViewportModule({ servicesManager, commandsManager, extensionManager }) {\r\n  const ExtendedOHIFCornerstoneTrackingViewport = props => {\r\n    return (\r\n      <OHIFCornerstoneViewport\r\n        servicesManager={servicesManager}\r\n        commandsManager={commandsManager}\r\n        extensionManager={extensionManager}\r\n        {...props}\r\n      />\r\n    );\r\n  };\r\n\r\n  return [\r\n    {\r\n      name: 'cornerstone-tracked',\r\n      component: ExtendedOHIFCornerstoneTrackingViewport,\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getViewportModule;\r\n","import getContextModule from './getContextModule';\r\nimport getPanelModule from './getPanelModule';\r\nimport getViewportModule from './getViewportModule';\r\nimport { id } from './id.js';\r\n\r\nconst measurementTrackingExtension = {\r\n  /**\r\n   * Only required property. Should be a unique value across all extensions.\r\n   */\r\n  id,\r\n\r\n  getContextModule,\r\n  getPanelModule,\r\n  getViewportModule,\r\n};\r\n\r\nexport default measurementTrackingExtension;\r\n","import packageJson from '../package.json';\r\n\r\nconst id = packageJson.name;\r\n\r\nexport { id };\r\n"],"names":["RESPONSE","machineConfiguration","id","initial","context","activeViewportId","trackedStudy","trackedSeries","ignoredSeries","prevTrackedStudy","prevTrackedSeries","prevIgnoredSeries","ignoredSRSeriesForHydration","isDirty","states","off","type","labellingOnly","on","TRACK_SERIES","target","actions","idle","entry","cond","SET_TRACKED_SERIES","PROMPT_HYDRATE_SR","RESTORE_PROMPT_HYDRATE_SR","HYDRATE_SR","UPDATE_ACTIVE_VIEWPORT_ID","assign","_","event","promptBeginTracking","invoke","src","onDone","onError","tracking","UNTRACK_SERIES","SAVE_REPORT","SET_DIRTY","promptTrackNewSeries","promptTrackNewStudy","promptSaveReport","promptHydrateStructuredReport","hydrateStructuredReport","promptLabelAnnotation","strict","defaultOptions","services","discardPreviouslyTrackedMeasurements","ctx","evt","console","log","clearAllMeasurements","jumpToFirstMeasurementInActiveViewport","warn","showStructuredReportDisplaySetInActiveViewport","clearContext","setTrackedStudyAndSeries","slice","data","StudyInstanceUID","SeriesInstanceUID","setTrackedStudyAndMultipleSeries","studyInstanceUID","seriesInstanceUIDs","SeriesInstanceUIDs","setIsDirtyToClean","setIsDirty","ignoreSeries","ignoreHydrationForSRSeries","srSeriesInstanceUID","addTrackedSeries","removeTrackedSeries","filter","ser","setPreviousState","meta","prevState","state","value","guards","shouldSetDirty","undefined","includes","wasLabellingOnly","condMeta","wasIdle","wasTracking","wasTrackingAndIsNewStudy","wasTrackingAndIsNewSeries","shouldKillMachine","userResponse","shouldAddSeries","shouldSetStudyAndSeries","shouldAddIgnoredSeries","shouldPromptSaveReport","shouldIgnoreHydrationForSR","shouldSaveAndContinueWithSameReport","isBackupSave","shouldSaveAndStartNewReport","shouldHydrateStructuredReport","hasRemainingTrackedSeries","length","hasNotIgnoredSRSeriesForHydration","isNewStudy","isNewSeries","servicesManager","extensionManager","appConfig","uiViewportDialogService","displaySetService","viewportId","displaySetInstanceUID","srDisplaySet","getDisplaySetByUID","Promise","async","resolve","reject","promptResult","disableConfirmationPrompts","message","ButtonEnums","secondary","text","primary","onSubmit","result","hide","show","onOutsideClick","onKeyPress","key","action","find","_askTrackMeasurements","hydrationResult","baseHydrateStructuredReport","TrackedMeasurementsContext","React","displayName","useTrackedMeasurements","useContext","SR_SOPCLASSHANDLERID","TrackedMeasurementsContextProvider","commandsManager","children","useAppConfig","viewportGrid","viewportGridService","useViewportGrid","viewports","measurementService","customizationService","machineOptions","Object","trackedMeasurements","getMeasurements","m","referenceStudyUID","referenceSeriesUID","referencedDisplaySetUID","referencedImages","images","isVolumeIdReferenced","imageId","startsWith","measurementData","imageIndex","findIndex","image","imageIdToUse","keys","substring","setDisplaySetsForViewport","displaySetInstanceUIDs","viewportOptions","initialImageOptions","index","jumpToSameImageInActiveViewport","runCommand","createdDisplaySetInstanceUIDs","StructuredReportDisplaySetInstanceUID","measurementIds","ms","map","fm","i","remove","uid","bind","isLabelOnMeasure","labelConfig","get","labelOnMeasure","isLabelOnMeasureAndShouldKillMachine","measurementTrackingMachine","useMemo","Machine","sendTrackedMeasurementsEvent","useMachine","useEffect","size","activeViewport","displaySet","SOPClassHandlerId","isLoaded","load","isRehydratable","triggerPromptHydrateFlow","Provider","propTypes","PropTypes","isRequired","BoundTrackedMeasurementsContextProvider","name","provider","defaultActionIcons","iconName","defaultViewPresets","selected","formatDate","createStudyBrowserTabs","utils","thumbnailNoImageModalities","PanelStudyBrowserTracking","getImageSrc","getStudiesForPatientByMRN","requestDisplaySetCreationForStudy","dataSource","uiDialogService","hangingProtocolService","uiNotificationService","studyPrefetcherService","navigate","useNavigate","mode","studyMode","getCustomization","t","useTranslation","StudyInstanceUIDs","useImageViewer","isHangingProtocolLayout","activeTabName","setActiveTabName","useState","expandedStudyInstanceUIDs","setExpandedStudyInstanceUIDs","studyDisplayList","setStudyDisplayList","hasLoadedViewports","setHasLoadedViewports","displaySets","setDisplaySets","displaySetsLoadingState","setDisplaySetsLoadingState","thumbnailImageSrcMap","setThumbnailImageSrcMap","jumpToDisplaySet","setJumpToDisplaySet","viewPresets","setViewPresets","actionIcons","setActionIcons","activeViewportDisplaySetInstanceUIDs","forEach","sid","qidoForStudyUID","query","studies","search","studyInstanceUid","Error","qidoStudiesForPatient","error","actuallyMappedStudies","study","AccessionNumber","accession","StudyDate","date","StudyDescription","description","NumInstances","instances","ModalitiesInStudy","modalities","PatientID","mrn","PatientName","patientName","StudyTime","time","qidoStudy","numInstances","prevArray","ret","it","push","fetchStudiesForPatient","window","setTimeout","currentDisplaySets","activeDisplaySets","ds","Modality","newImageSrcEntry","dSet","getImageIdForThumbnail","getImageIdsForDisplaySet","unsupported","mappedDisplaySets","_mapDisplaySets","unsubscribe","subscribe","EVENTS","DISPLAYSET_LOAD_PROGRESS","updatedDisplaySetLoadingState","loadingProgress","SubscriptionDisplaySetsAdded","DISPLAY_SETS_ADDED","displaySetsAdded","options","madeInClient","SubscriptionDisplaySetsChanged","DISPLAY_SETS_CHANGED","changedDisplaySets","SubscriptionDisplaySetMetaDataInvalidated","DISPLAY_SET_SERIES_METADATA_INVALIDATED","getActiveDisplaySets","tabs","element","document","getElementById","scrollIntoView","behavior","thumbnailLocation","s","d","tabName","_findTabAndStudyOfDisplaySet","updatedExpandedStudyInstanceUIDs","onClickUntrack","create","centralize","isDraggable","showOverlay","content","Dialog","contentProps","title","body","className","classes","onClose","dismiss","onConfirm","PanelStudyBrowserHeader","updateViewPresetValue","viewPreset","newViewPresets","preset","updateActionIconValue","actionIcon","newActionIcons","Separator","orientation","thickness","StudyBrowser","onClickStudy","shouldCollapseStudy","stdyUid","onClickTab","clickedTabName","onClickThumbnail","onDoubleClickThumbnail","updatedViewports","getViewportsRequireUpdate","duration","setDisplaySetsForViewports","activeDisplaySetInstanceUIDs","showSettings","icon","onThumbnailContextMenu","commandName","imageIds","isDynamicVolume","timePoints","dynamicVolumeInfo","middleTimePointImageIds","Math","floor","displaySetLoadingState","trackedSeriesInstanceUIDs","thumbnailDisplaySets","thumbnailNoImageDisplaySets","excludeFromThumbnailBrowser","imageSrc","componentType","_getComponentType","array","getNumViewportPanes","thumbnailProps","SeriesDescription","seriesNumber","SeriesNumber","modality","seriesDate","SeriesDate","numImageFrames","countIcon","messages","dragData","isTracked","isHydratedForDerivedDisplaySet","isHydrated","series","canReject","onReject","onShow","querySelector","focus","deleteDisplaySet","cornerstone","canvas","createElement","utilities","loadImageToCanvas","thumbnail","then","toDataURL","catch","some","retrieve","metadata","WrappedPanelStudyBrowserTracking","getActiveDataSource","utilityModule","getModuleEntry","exports","_getStudyForPatientUtility","_getStudiesForPatientByMRN","_getImageSrcFromImageId","useCallback","getCornerstoneLibraries","getImageSrcFromImageId","ex","_createGetImageSrcFromImageIdFn","_requestDisplaySetCreationForStudy","downloadCSVReport","DISPLAY_STUDY_SUMMARY_INITIAL_VALUE","displayStudySummary","setDisplayStudySummary","matches","studyMeta","DicomMetadataStore","getStudy","debug","instanceMeta","Set","add","Array","from","join","prevSummary","updateDisplayStudySummary","disableEditing","StudySummary","PanelMeasurement","measurementFilter","measurement","customHeader","additionalFindings","measurements","disabled","Button","variant","onClick","Icons","Download","Add","clearMeasurements","Delete","iconLabel","label","i18n","component","props","_extends","PanelMeasurementTableTracking","Component","OHIFCornerstoneViewport","fallback","packageJson","getContextModule","getPanelModule","getViewportModule"],"sourceRoot":""}