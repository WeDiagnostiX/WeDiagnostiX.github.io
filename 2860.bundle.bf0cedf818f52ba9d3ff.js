"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[2860],{5791:(e,t,n)=>{n.d(t,{JX:()=>y,Ay:()=>E});var o=n(86326),i=n(3823),a=n(97598),r=n.n(a),s=n(15327),l=n(93213),c=n(14867),d=n.n(c);function m(e,t=0){if(null!==e)return parseFloat(e).toFixed(t)}function p(e,t="MMM D, YYYY"){return d()(e,"YYYYMMDD").format(t)}function u(e,t="HH:mm:ss"){return d()(e,"HH:mm:ss").format(t)}var g=n(80818);const h=1e-4,{formatPN:I}=g.Wp,S={"ohif.overlayItem":function(e){const{instance:t,customization:n={}}=e,{color:i,attribute:a,title:r,label:s,background:l}=n,c=n.contentF?.(e,n)??t?.[a];if(null==c)return null;return o.createElement("div",{className:"overlay-item flex flex-row",style:{color:i,background:l},title:r},s?o.createElement("span",{className:"mr-1 shrink-0"},s):null,o.createElement("span",{className:"ml-1 mr-2 shrink-0"},c))},"ohif.overlayItem.windowLevel":function({voi:e,customization:t}){const{windowWidth:n,windowCenter:i}=e;if("number"!=typeof i||"number"!=typeof n)return null;return o.createElement("div",{className:"overlay-item flex flex-row",style:{color:t?.color}},o.createElement("span",{className:"mr-1 shrink-0"},"W:"),o.createElement("span",{className:"ml-1 mr-2 shrink-0"},n.toFixed(0)),o.createElement("span",{className:"mr-1 shrink-0"},"L:"),o.createElement("span",{className:"ml-1 shrink-0"},i.toFixed(0)))},"ohif.overlayItem.zoomLevel":function({scale:e,customization:t}){return o.createElement("div",{className:"overlay-item flex flex-row",style:{color:t&&t.color||void 0}},o.createElement("span",{className:"mr-1 shrink-0"},"Zoom:"),o.createElement("span",null,e.toFixed(2),"x"))},"ohif.overlayItem.instanceNumber":function({instanceNumber:e,imageSliceData:t,customization:n}){const{imageIndex:i,numberOfSlices:a}=t;return o.createElement("div",{className:"overlay-item flex flex-row",style:{color:n&&n.color||void 0}},o.createElement("span",null,`${i+1}/${a}`))}},v={id:"cornerstoneOverlayTopRight",items:[{id:"PatientNameOverlay",customizationType:"ohif.overlayItem",attribute:"PatientName",label:"PN:",title:"Patient Name",color:"yellow",condition:({instance:e})=>e?.PatientName,contentF:({instance:e,formatters:{formatPN:t}})=>t(e.PatientName)+(e.PatientSex?" ("+e.PatientSex+")":"")}]},y={id:"@ohif/cornerstoneOverlay",topLeftItems:{id:"cornerstoneOverlayTopLeft",items:[{id:"StudyDate",customizationType:"ohif.overlayItem",label:"",title:"Study date",condition:({referenceInstance:e})=>e?.StudyDate,contentF:({referenceInstance:e,formatters:{formatDate:t}})=>t(e.StudyDate)},{id:"SeriesDescription",customizationType:"ohif.overlayItem",label:"",title:"Series description",condition:({referenceInstance:e})=>e&&e.SeriesDescription,contentF:({referenceInstance:e})=>e.SeriesDescription}]},topRightItems:v,bottomLeftItems:{id:"cornerstoneOverlayBottomLeft",items:[{id:"WindowLevel",customizationType:"ohif.overlayItem.windowLevel"},{id:"ZoomLevel",customizationType:"ohif.overlayItem.zoomLevel",condition:e=>"Zoom"===e.toolGroupService.getActiveToolForViewport(e.viewportId)}]},bottomRightItems:{id:"cornerstoneOverlayBottomRight",items:[{id:"InstanceNumber",customizationType:"ohif.overlayItem.instanceNumber"}]}};function f({element:e,viewportData:t,imageSliceData:n,viewportId:i,servicesManager:a}){const{cornerstoneViewportService:r,customizationService:c,toolGroupService:d,displaySetService:g}=a.services,[h,v]=(0,o.useState)({windowCenter:null,windowWidth:null}),[y,f]=(0,o.useState)(1),{imageIndex:E}=n,T=c.getCustomization("@ohif/cornerstoneOverlay"),D=c.getCustomization("cornerstoneOverlayTopLeft")||T?.topLeftItems,b=c.getCustomization("cornerstoneOverlayTopRight")||T?.topRightItems,O=c.getCustomization("cornerstoneOverlayBottomLeft")||T?.bottomLeftItems,C=c.getCustomization("cornerstoneOverlayBottomRight")||T?.bottomRightItems,A=(0,o.useMemo)(()=>t?w(t,i,E,r):null,[t,i,E,r]),M=(0,o.useMemo)(()=>{const e=function(e,t){if(!e?.data?.length)return null;const n=e.data.map(e=>t.getDisplaySetByUID(e.displaySetInstanceUID)).filter(e=>!!e);if(!n.length)return null;return n}(t,g);if(!e)return null;const[n]=e,{instances:o,instance:i}=n;return{displaySets:e,displaySet:n,instance:o?.[E],instances:o,referenceInstance:i}},[t,i,A,r]);(0,o.useEffect)(()=>{const t=e=>{const{range:t}=e.detail;if(!t)return;const{lower:n,upper:o}=t,{windowWidth:i,windowCenter:a}=s.utilities.windowLevel.toWindowLevel(n,o);v({windowCenter:a,windowWidth:i})};return e.addEventListener(s.Enums.Events.VOI_MODIFIED,t),()=>{e.removeEventListener(s.Enums.Events.VOI_MODIFIED,t)}},[i,t,h,e]),(0,o.useEffect)(()=>{const t=e=>{const{previousCamera:t,camera:n}=e.detail;if(t.parallelScale!==n.parallelScale||t.scale!==n.scale){const e=r.getCornerstoneViewport(i);if(!e)return;const t=e.getZoom();f(t)}};return e.addEventListener(s.Enums.Events.CAMERA_MODIFIED,t),()=>{e.removeEventListener(s.Enums.Events.CAMERA_MODIFIED,t)}},[i,t,r,e]);const R=(0,o.useCallback)((r,s)=>{const l={...s,element:e,viewportData:t,imageSliceData:n,viewportId:i,servicesManager:a,customization:r,formatters:{formatPN:I,formatDate:p,formatTime:u,formatNumberPrecision:m}};if(!r)return null;const{customizationType:d}=r,g=S[d];if(g)return o.createElement(g,l);{const e=c.transform(r);if("function"==typeof e.contentF)return e.contentF(l)}},[e,t,n,i,a,c,M,h,y,A]),N=(0,o.useCallback)((e,t)=>{if(!e?.items)return null;const{items:n}=e,a={...M,formatters:{formatDate:p},voi:h,scale:y,instanceNumber:A,viewportId:i,toolGroupService:d};return o.createElement(o.Fragment,null,n.map((e,n)=>o.createElement("div",{key:`${t}_${n}`},(!e?.condition||e.condition(a))&&R(e,a)||null)))},[R]);return o.createElement(l.pU,{topLeft:N(D,"topLeftOverlayItem"),topRight:N(b,"topRightOverlayItem"),bottomLeft:N(O,"bottomLeftOverlayItem"),bottomRight:N(C,"bottomRightOverlayItem")})}const w=(e,t,n,o)=>{let a;switch(e.viewportType){case s.Enums.ViewportType.STACK:a=function(e,t){const n=e.data[0].imageIds,o=n[t];if(!o)return;const i=s.metaData.get("generalImageModule",o)||{},{instanceNumber:a}=i;if(n.length<=1)return;return parseInt(a)}(e,n);break;case s.Enums.ViewportType.ORTHOGRAPHIC:a=function(e,t,n,o){const a=e.data;if(!a)return;const{volume:r}=a[0];if(!r)return;const{direction:l,imageIds:c}=r,d=n.getCornerstoneViewport(t);if(!d)return;const m=d.getCamera(),{viewPlaneNormal:p}=m,u=l.slice(6,9),g=i.eR.cross(i.eR.create(),p,u);if(i.eR.length(g)<h){const e=c[o];if(!e)return{};const{instanceNumber:t}=s.metaData.get("generalImageModule",e)||{};return parseInt(t)}}(e,t,o,n)}return Number.isNaN(a)?null:a??null};f.propTypes={viewportData:r().object,imageIndex:r().number,viewportId:r().string};const E=f},76255:(e,t,n)=>{n.d(t,{It:()=>d,R4:()=>m});var o=n(86326),i=n(97598),a=n.n(i),r=n(93213),s=n(77954);const l={default:{[r.ld.topLeft]:[],[r.ld.topRight]:[],[r.ld.bottomLeft]:[],[r.ld.bottomRight]:[]}},c=(0,o.createContext)(l);function d({children:e,service:t}){const[n,i]=(0,o.useReducer)((e,t)=>{switch(t.type){case"ADD_ACTION_COMPONENT":{const{viewportId:n,id:o,component:i,location:a,indexPriority:s}=t.payload;let l=e?.[n]?.[a]?[...e[n][a]]:[];const c=l.findIndex(e=>e.id===o);if(-1!==c&&(l=[...l.slice(0,c),...l.slice(c+1)]),i){let e;const t=a===r.ld.topRight||a===r.ld.bottomRight;void 0===s?e=t?0:l.length:(e=t?l.findIndex(e=>s>e.indexPriority):l.findIndex(e=>s<=e.indexPriority),-1===e&&(e=t?0:l.length));const n=t?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER;l=[...l.slice(0,e),{id:o,component:i,indexPriority:s??n},...l.slice(e)]}return{...e,[n]:{...e[n],[a]:l}}}case"CLEAR_ACTION_COMPONENTS":{const n=t.payload,o={...e};return delete o[n],o}default:return{...e}}},l),a=(0,o.useCallback)(()=>n,[n]),s=(0,o.useCallback)(e=>{i({type:"ADD_ACTION_COMPONENT",payload:e})},[i]),d=(0,o.useCallback)(e=>{e.forEach(e=>i({type:"ADD_ACTION_COMPONENT",payload:e}))},[i]),m=(0,o.useCallback)(e=>i({type:"CLEAR_ACTION_COMPONENTS",payload:e}),[i]);(0,o.useEffect)(()=>{t&&t.setServiceImplementation({getState:a,addComponent:s,addComponents:d,clear:m})},[a,t,s,d,m]);const p={getState:a,addComponent:e=>t.addComponent(e),addComponents:e=>t.addComponents(e),clear:e=>t.clear(e)},u=(0,o.useMemo)(()=>[n,p],[n,p]);return o.createElement(c.Provider,{value:u},e)}d.propTypes={children:a().node,service:a().instanceOf(s.A).isRequired};const m=()=>(0,o.useContext)(c)},73421:(e,t,n)=>{n.d(t,{j:()=>l});var o=n(86326),i=n(62051),a=n.n(i),r=n(5971);function s(e,t){const{label:n,segments:o}=e,{readableText:i}=t.getCustomization("PanelSegmentation.readableText",{});function a(e,t=0){const n=[],o="  ".repeat(t);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const l=e[s],c=i?.[s];if(!c)continue;"object"!=typeof l||null===l||Array.isArray(l)?n.push(`${o}${c}: ${(0,r.Wf)(l,2)}`):(n.length>0&&n.push(""),n.push(`${o}${c}`),n.push(...a(l,t+1)))}return n}const s=e=>{const t={primary:[],secondary:[]};if(e.cachedStats){const n=a(e.cachedStats);t.primary=n}return t},l={};return Object.entries(o).forEach(([e,t])=>{l[e]={...t,displayText:s(t)}}),{...e,label:n,segments:l}}function l({servicesManager:e,subscribeToDataModified:t=!1,debounceTime:n=0}){const{segmentationService:i,customizationService:r}=e.services,[l,c]=(0,o.useState)([]);return(0,o.useEffect)(()=>{const e=()=>{const e=i.getSegmentations();if(!e?.length)return void c([]);const t=e.map(e=>s(e,r));c(t)},o=n>0?a()(e,n,{leading:!0,trailing:!0}):e;e();const l=[i.subscribe(i.EVENTS.SEGMENTATION_MODIFIED,o),i.subscribe(i.EVENTS.SEGMENTATION_REMOVED,o)];return t&&l.push(i.subscribe(i.EVENTS.SEGMENTATION_DATA_MODIFIED,o)),()=>{l.forEach(e=>e.unsubscribe()),n>0&&o.cancel()}},[i,r,n,t]),l}},92860:(e,t,n)=>{n.r(t),n.d(t,{DicomUpload:()=>pi,Enums:()=>m,ImageOverlayViewerTool:()=>M,PanelMeasurement:()=>jo,PanelSegmentation:()=>Vo,Types:()=>a,default:()=>fi,dicomLoaderService:()=>to,findNearbyToolData:()=>Be,getActiveViewportEnabledElement:()=>y,getEnabledElement:()=>v.kJ,getSOPInstanceAttributes:()=>Q,measurementMappingUtils:()=>i,setEnabledElement:()=>v.ye,toolNames:()=>Y,useActiveViewportSegmentationRepresentations:()=>Eo,useLutPresentationStore:()=>Qe.I,useMeasurements:()=>To,usePositionPresentationStore:()=>et.q,useSegmentationPresentationStore:()=>tt.v,useSegmentations:()=>ui.j,useSynchronizersStore:()=>Et.U});var o={};n.r(o),n.d(o,{rM:()=>c,yK:()=>d,Ay:()=>m});var i={};n.r(i),n.d(i,{getDisplayUnit:()=>ae,getFirstAnnotationSelected:()=>ie,getHandlesFromPoints:()=>te,getSOPInstanceAttributes:()=>Q,isAnnotationSelected:()=>ne,setAnnotationSelected:()=>oe});var a={};n.r(a);var r=n(86326),s=n(15327),l=n(90665);const c="Cornerstone3DTools",d="0.1",m={CORNERSTONE_3D_TOOLS_SOURCE_NAME:c,CORNERSTONE_3D_TOOLS_SOURCE_VERSION:d};var p=n(80818),u=n(19742),g=n(43213),h=n(88003);const{registerVolumeLoader:I}=s.volumeLoader;var S=n(85286),v=n(71353);function y(e){const{activeViewportId:t}=e.getState(),{element:n}=(0,v.kJ)(t)||{};return(0,s.getEnabledElement)(n)}const{calibrateImageSpacing:f}=l.utilities;class w extends l.LengthTool{constructor(...e){super(...e),this._renderingViewport=void 0,this._lengthToolRenderAnnotation=this.renderAnnotation,this.renderAnnotation=(e,t)=>{const{viewport:n}=e;return this._renderingViewport=n,this._lengthToolRenderAnnotation(e,t)}}_getTextLines(e,t){const[n,o]=e.handles.points.map(e=>this._renderingViewport.worldToCanvas(e));return[`${Math.round(100*function(e,t){const n=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(n*n+o*o)}(n,o))/100}px`]}}w.toolName="CalibrationLine";const E=w;function T(e,t){const{uiDialogService:n,viewportGridService:o}=e.services,i=t.detail,{annotation:{metadata:a,data:r}}=i,{referencedImageId:s}=a,l=y(o),{viewport:c}=l,d=Math.round(100*function(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}(r.handles.points[0],r.handles.points[1]))/100;return new Promise((e,t)=>{n?(0,S.callInputDialog)(n,{text:"",label:`${d}`},(n,o)=>{"save"===o?((e=>{const t=e/d;f(s,c.getRenderingEngine(),{type:"User",scale:1/t})})(Number.parseFloat(n)),e(!0)):t("cancel")},!1,{dialogTitle:"Calibration",inputLabel:"Actual Physical distance (mm)",validateFunc:e=>{try{const t=Number.parseFloat(e);return!isNaN(t)&&0!==t}catch{return!1}}}):t("UIDialogService is not initiated")})}var D=n(5971);const b=new Map,O={add:(e,t)=>{b.get(e)!==t&&b.set(e,t)},get:(e,t)=>{if(!Array.isArray(t)&&"overlayPlaneModule"===e)return b.get(t)}};s.metaData.addProvider(O.get,1e4);const C=O;class A extends l.AnnotationDisplayTool{constructor(e={},t={supportedInteractionTypes:[],configuration:{fillColor:[255,127,127,255]}}){super(e,t),this.onSetToolDisabled=()=>{},this.renderAnnotation=(e,t)=>{const{viewport:n}=e,o=this.getReferencedImageId(n);if(!o)return;const i=s.metaData.get("overlayPlaneModule",o),a=i?.overlays;return a?.length?(a.forEach(e=>{e.x||=0,e.y||=0}),A.addOverlayPlaneModule(o,i),this._getCachedStat(o,i,this.configuration.fillColor).then(n=>{n.overlays.forEach(n=>{this._renderOverlay(e,t,n)})}),!0):void 0}}getReferencedImageId(e){if(e instanceof s.VolumeViewport)return;return this.getTargetId(e).split("imageId:")[1]}_renderOverlay(e,t,n){const{viewport:o}=e,i=this.getReferencedImageId(o);if(!i)return;const{_id:a,columns:r,rows:c,x:d,y:m}=n,p=s.utilities.imageToWorldCoords(i,[d-1,m-1]),u=o.worldToCanvas(p),g=s.utilities.imageToWorldCoords(i,[r,c]),h=o.worldToCanvas(g),I=`image-overlay-${a}`,S=t.getSvgNode(I),v={"data-id":I,width:h[0]-u[0],height:h[1]-u[1],x:u[0],y:u[1],href:n.dataUrl};if(isNaN(v.x)||isNaN(v.y)||isNaN(v.width)||isNaN(v.height))return console.warn("Invalid rendering attribute for image overlay",v["data-id"]),!1;if(S)l.drawing.setAttributesIfNecessary(v,S),t.setNodeTouched(I);else{const e=document.createElementNS("http://www.w3.org/2000/svg","image");l.drawing.setNewAttributesIfValid(v,e),t.appendNode(e,I)}return!0}async _getCachedStat(e,t,n){if(0===t.overlays.filter(e=>e.pixelData&&!e.dataUrl).length)return t;const o=await Promise.all(t.overlays.filter(e=>e.pixelData).map(async(e,t)=>{let o=null;if(e.pixelData.Value)o=e.pixelData.Value;else if(e.pixelData instanceof Array)o=e.pixelData[0];else if(e.pixelData.retrieveBulkData)o=await e.pixelData.retrieveBulkData();else if(e.pixelData.InlineBinary){const t=(0,D.Vk)(e.pixelData.InlineBinary);o=await t.arrayBuffer()}if(!o)return;const i=this._renderOverlayToDataUrl({width:e.columns,height:e.rows},e.color||n,o);return{...e,_id:(0,D.Os)(),dataUrl:i,color:n}}));return t.overlays=o,t}_isSameColor(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}_renderOverlayToDataUrl({width:e,height:t},n,o){const i=new DataView(o),a=e*t,r=document.createElement("canvas");r.width=e,r.height=t;const s=r.getContext("2d");s.clearRect(0,0,e,t),s.globalCompositeOperation="copy";const l=s.getImageData(0,0,e,t),c=l.data;for(let e=0,t=0,o=0;e<a;e++)i.getUint8(o)&1<<t&&(c[4*e]=n[0],c[4*e+1]=n[1],c[4*e+2]=n[2],c[4*e+3]=n[3]),t>=7?(t=0,o++):t++;return s.putImageData(l,0,0),r.toDataURL()}}A.toolName="ImageOverlayViewer",A.addOverlayPlaneModule=C.add;const M=A;var R=n(60326);const N="1",V="10",P="16",U="20",x="25",_="30",L="45",F="55",G="80",k="89",B="110",z="200",$={[N]:"hsl(51, 100%, 50%)",[V]:"hsl(4, 81%, 75%)",[P]:"hsl(311, 100%, 26%)",[U]:"hsl(180, 100%, 20%)",[x]:"hsl(293, 94%, 58%)",[_]:"hsl(173, 68%, 78%)",[L]:"hsl(112, 94%, 58%)",[F]:"hsl(175, 94%, 58%)",[G]:"hsl(259, 94%, 58%)",[k]:"hsl(330, 100%, 84%)",[B]:"hsl(261, 78%, 34%)",[z]:"hsl(230, 100%, 61%)",others:"hsl(180, 72%, 38%)"};class W extends l.AnnotationTool{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,statsCalculator:l.utilities.math.BasicStatsCalculator}}){super(e,t),this._selectedAnnotationUID=null,this._renderingViewport=void 0,this.editData=void 0,this.isDrawing=void 0,this.isHandleOutsideImage=void 0,this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e;this._renderingViewport=o;const{element:i}=o;let a=l.annotation.state.getAnnotations(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;for(let e=0;e<a.length;e++){const i=a[e],{annotationUID:r,data:s}=i,{points:c,activeHandleIndex:d}=s.handles,m=c.map(e=>o.worldToCanvas(e)),p=i.highlighted||this._selectedAnnotationUID===r,u=this._selectedAnnotationUID===r?"red":$[s.subtype]||$.others,g=2,h="0";if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if(!l.annotation.visibility.isAnnotationVisible(r))continue;if(l.annotation.locking.isAnnotationLocked(r)||this.editData||null===d||(I=[m[d]]),I){const e="0";l.drawing.drawHandles(t,r,e,I,{color:"transparent"})}H(t,r,"0",m,{color:u,lineDash:h,lineWidth:g,cornerRadius:10},`${r}-disease`),n=!0;const S={background:"",color:u,fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif",fontSize:"15px",lineDash:0,lineWidth:0,shadow:!0,visibility:p,padding:10};if(!S.visibility){s.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const v=[`${s.label}`];if(!s.handles.textBox.hasMoved){const e=o.canvas.getContext("2d");e.font=`${S.fontSize} ${S.fontFamily}`;const t=e.measureText(v[0]).width,n=parseInt(S.fontSize,10)+3*S.padding,i=Math.min(...m.map(e=>e[1])),a=i+(Math.max(...m.map(e=>e[1]))-i)/2-n/2;let r=l.utilities.drawing.getTextBoxCoordsCanvas(m);const c=t+2*S.padding,d=o.element.clientWidth;if(r[0]+c>d){r=[Math.min(...m.map(e=>e[0]))-c,a]}else r=[r[0],a];s.handles.textBox.worldPosition=o.canvasToWorld(r)}const y=j(t,r,"1",v,o.worldToCanvas(s.handles.textBox.worldPosition),m,{},S),{x:f,y:w,width:E,height:T}=y;s.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([f,w]),topRight:o.canvasToWorld([f+E,w]),bottomLeft:o.canvasToWorld([f,w+T]),bottomRight:o.canvasToWorld([f+E,w+T])}}return n},this.moveDentascanIndex=(e,t)=>{const{cornerstoneViewportService:n,panoramicService:o,viewportGridService:i}=R.M9.services,a=e.detail,{element:r}=a;if(l.cursors.elementCursor.resetElementCursor(r),o.isDisplayed()){const{points:e}=t.data.handles,{imageData:a}=n.getCornerstoneViewport("panoramic").getImageData(),r=(e[0][0]+e[3][0])/2,s=Math.round(a.worldToIndex([r,0,0])[0]),l=i.getDisplaySetsUIDsForViewport("default")[0];o.setDentascanIndex(l,s)}},this.mouseClickCallback=e=>{const t=e.detail,{element:n,currentPoints:o}=t,i=o.canvas,a=l.annotation.state.getAnnotations(this.getToolName(),n);let r;if(a?.length)for(let e=0;e<a.length;e++){const t=a[e];if(this.isPointNearTool(n,t,i,this.configuration.proximity)){r=t;break}}if(r)this._selectedAnnotationUID=r.annotationUID,this.toolSelectedCallback(e,r);else if(null!==this._selectedAnnotationUID){this._selectedAnnotationUID=null;const e=(0,s.getEnabledElement)(n),{renderingEngine:t}=e,o=l.utilities.viewportFilters.getViewportIdsWithToolToRender(n,this.getToolName());l.utilities.triggerAnnotationRenderForViewportIds(t,o)}},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0,this._selectedAnnotationUID=t.annotationUID;const i=l.utilities.viewportFilters.getViewportIdsWithToolToRender(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(o),l.cursors.elementCursor.hideElementCursor(o);const a=(0,s.getEnabledElement)(o),{renderingEngine:r}=a;l.utilities.triggerAnnotationRenderForViewportIds(r,i),e.preventDefault(),this.moveDentascanIndex(e,t)},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,{data:a}=t;this._selectedAnnotationUID=t.annotationUID,t.highlighted=!0;let r,c=!1;n.worldPosition?c=!0:r=a.handles.points.findIndex(e=>e===n);const d=l.utilities.viewportFilters.getViewportIdsWithToolToRender(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:r,movingTextBox:c},this._activateModify(i),l.cursors.elementCursor.hideElementCursor(i);const m=(0,s.getEnabledElement)(i),{renderingEngine:p}=m;l.utilities.triggerAnnotationRenderForViewportIds(p,d),e.preventDefault(),this.moveDentascanIndex(e,t)},this.addNewAnnotation=()=>null,this.cancel=()=>null,this.isPointNearTool=(e,t,n,o)=>{const i=(0,s.getEnabledElement)(e),{viewport:a}=i,{data:r}=t,{points:c}=r.handles,d=a.worldToCanvas(c[0]),m=a.worldToCanvas(c[3]),p=this._getRectangleImageCoordinates([d,m]),u=[n[0],n[1]],{left:g,top:h,width:I,height:S}=p;return l.utilities.math.rectangle.distanceToPoint([g,h,I,S],u)<=o},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,hasMoved:a}=this.editData,{data:r}=o;if(!a)return;r.handles.activeHandleIndex=null,this._deactivateModify(n),l.cursors.elementCursor.resetElementCursor(n);const{renderingEngine:c}=(0,s.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&l.annotation.state.removeAnnotation(o.annotationUID),l.utilities.triggerAnnotationRenderForViewportIds(c,i)},this._activateModify=e=>{l.state.isInteractingWithTool=!0,e.addEventListener(l.Enums.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Enums.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Enums.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Enums.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{l.state.isInteractingWithTool=!1,e.removeEventListener(l.Enums.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Enums.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Enums.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Enums.Events.TOUCH_TAP,this._endCallback)},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this.removeDiseaseAnnotation=e=>{l.annotation.state.removeAnnotation(e)}}}function H(e,t,n,o,i={},a=""){const{color:r,width:s,lineWidth:c,lineDash:d,cornerRadius:m}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,cornerRadius:0},i),p=c||s,u=function(e,t,n){return`${e}::${t}::${n}`}(t,"rect",n),g=e.getSvgNode(u),[h,I,S,v]=o,y=Math.hypot(h[0]-I[0],h[1]-I[1]),f=Math.hypot(h[0]-S[0],h[1]-S[1]),w=[(v[0]+h[0])/2,(v[1]+h[1])/2],E=[(S[0]+h[0])/2,(S[1]+h[1])/2],T=180*Math.atan2(w[1]-E[1],w[0]-E[0])/Math.PI,D={x:""+(w[0]-y/2),y:""+(w[1]-f/2),width:`${y}`,height:`${f}`,stroke:r,fill:"transparent",transform:`rotate(${T} ${w[0]} ${w[1]})`,"stroke-width":p,"stroke-dasharray":d,rx:`${m}`,ry:`${m}`};if(g)l.drawing.setAttributesIfNecessary(D,g),e.setNodeTouched(u);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");""!==a&&t.setAttribute("data-id",a),l.drawing.setNewAttributesIfValid(D,t),e.appendNode(t,u)}}function j(e,t,n,o,i,a,r,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s);return l.drawing.drawTextBox(e,t,n,o,i,c)}W.toolName="Disease";const q=W;const Y={Pan:l.PanTool.toolName,ArrowAnnotate:l.ArrowAnnotateTool.toolName,WindowLevel:l.WindowLevelTool.toolName,StackScroll:l.StackScrollTool.toolName,Zoom:l.ZoomTool.toolName,VolumeRotate:l.VolumeRotateTool.toolName,MipJumpToClick:l.MIPJumpToClickTool.toolName,Length:l.LengthTool.toolName,DragProbe:l.DragProbeTool.toolName,Probe:l.ProbeTool.toolName,RectangleROI:l.RectangleROITool.toolName,RectangleROIThreshold:l.RectangleROIThresholdTool.toolName,RectangleROIStartEndThreshold:l.RectangleROIStartEndThresholdTool.toolName,EllipticalROI:l.EllipticalROITool.toolName,CircleROI:l.CircleROITool.toolName,Bidirectional:l.BidirectionalTool.toolName,Angle:l.AngleTool.toolName,CobbAngle:l.CobbAngleTool.toolName,Magnify:l.MagnifyTool.toolName,Crosshairs:l.CrosshairsTool.toolName,Brush:l.BrushTool.toolName,PaintFill:l.PaintFillTool.toolName,ReferenceLines:l.ReferenceLinesTool.toolName,CalibrationLine:E.toolName,TrackballRotateTool:l.TrackballRotateTool.toolName,CircleScissors:l.CircleScissorsTool.toolName,RectangleScissors:l.RectangleScissorsTool.toolName,SphereScissors:l.SphereScissorsTool.toolName,ImageOverlayViewer:M.toolName,AdvancedMagnify:l.AdvancedMagnifyTool.toolName,UltrasoundDirectional:l.UltrasoundDirectionalTool.toolName,SplineROI:l.SplineROITool.toolName,LivewireContour:l.LivewireContourTool.toolName,PlanarFreehandROI:l.PlanarFreehandROITool.toolName,OrientationMarker:l.OrientationMarkerTool.toolName,WindowLevelRegion:l.WindowLevelRegionTool.toolName,PlanarFreehandContourSegmentation:l.PlanarFreehandContourSegmentationTool.toolName,Disease:q.toolName},K=["Length","EllipticalROI","CircleROI","Bidirectional","ArrowAnnotate","Angle","CobbAngle","Probe","RectangleROI","PlanarFreehandROI","SplineROI","LivewireContour","UltrasoundDirectionalTool","SCOORD3DPoint"];var Z=n(47807);const X=e=>Z.locking.isAnnotationLocked(e),J=e=>Z.visibility.isAnnotationVisible(e);function Q(e,t,n){if(e)return function(e){const t=s.metaData.get("instance",e);return{SOPInstanceUID:t.SOPInstanceUID,SeriesInstanceUID:t.SeriesInstanceUID,StudyInstanceUID:t.StudyInstanceUID,frameNumber:t.frameNumber||1}}(e);const{metadata:o}=n,{volumeId:i}=o,a=t.getDisplaySetsBy(e=>i.includes(e.uid))[0],{StudyInstanceUID:r,SeriesInstanceUID:l}=a;return{SOPInstanceUID:void 0,SeriesInstanceUID:l,StudyInstanceUID:r}}const ee={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);Z.config.style.getStyleProperty("color",{annotationUID:l});if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return[];const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{length:p,unit:u="mm"}=o;r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,length:p})}),r}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{length:o,SeriesNumber:i,SOPInstanceUID:a,frameNumber:r,unit:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===a);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${r}`:"";if(null==o)return n;const u=p.Wp.roundNumber(o,2);return n.primary.push(`${u} ${s}`),n.secondary.push(`S: ${i}${d}${m}`),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,isLocked:c,isVisible:d,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:Length"),e.forEach(e=>{const{length:t,unit:n}=e;o.push("Length"),i.push(t),o.push("Unit"),i.push(n)}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g)}}};function te(e){if(e.longAxis&&e.shortAxis){const t={};return t.start=e.longAxis[0],t.end=e.longAxis[1],t.perpendicularStart=e.longAxis[0],t.perpendicularEnd=e.longAxis[1],t}return e.map((e,t)=>t%10==0?{start:e}:{end:e}).reduce((e,t)=>Object.assign(e,{...t}),{})}function ne(e){return l.annotation.selection.isAnnotationSelected(e)}function oe(e,t){ne(e)!==t&&l.annotation.selection.setAnnotationSelected(e,t)}function ie(e){const[t]=l.annotation.selection.getAnnotationsSelected()||[];if(t)return l.annotation.state.getAnnotation(t)}const ae=e=>null==e?"":e;const re={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a,referencedSeriesInstanceUID:r}=n;if(!Object.keys(i).length)return[];const s=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:r,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{length:p,width:u,unit:g}=o;s.push({SeriesInstanceUID:l,SOPInstanceUID:r,SeriesNumber:m,frameNumber:c,unit:g,length:p,width:u})}),s}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{length:o,width:i,unit:a,SeriesNumber:r,SOPInstanceUID:s,frameNumber:l}=e[0],c=p.Wp.roundNumber(o,2),d=p.Wp.roundNumber(i,2),m=t.instances.find(e=>e.SOPInstanceUID===s);let u;m&&(u=m.InstanceNumber);const g=u?` I: ${u}`:"",h=t.isMultiFrame?` F: ${l}`:"";return n.primary.push(`L: ${c} ${ae(a)}`),n.primary.push(`W: ${d} ${ae(a)}`),n.secondary.push(`S: ${r}${g}${h}`),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,isLocked:c,isVisible:d,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:Bidirectional"),e.forEach(e=>{const{length:t,width:n,unit:a}=e;o.push("Length","Width","Unit"),i.push(t,n,a)}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g)}}},se=(e,t,n)=>{if(Array.isArray(e)&&e.length>0){const o=e.map(e=>p.Wp.roundNumber(e,2));return`${n.charAt(0).toUpperCase()+n.slice(1)}: ${o.join(", ")} ${ae(t)}`}const o=p.Wp.roundNumber(e,2);return`${n.charAt(0).toUpperCase()+n.slice(1)}: ${o} ${ae(t)}`};const le={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return[];const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{mean:p,stdDev:u,max:g,area:h,Modality:I,areaUnit:S,modalityUnit:v}=o;r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,Modality:I,unit:v,areaUnit:S,mean:p,stdDev:u,max:g,area:h})}),r}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:i,frameNumber:a,areaUnit:r}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===i);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${a}`:"",m=p.Wp.roundNumber(o,2);return n.primary.push(`${m} ${ae(r)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:i}=e,a=se(o,t,"max");n.primary.push(a),n.secondary.push(`S: ${i}${c}${d}`)}),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,metadata:r,isLocked:c,isVisible:d,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:EllipticalROI"),e.forEach(e=>{const{mean:t,stdDev:n,max:a,area:r,unit:s,areaUnit:l}=e;t&&s&&a&&r&&(o.push(`max (${s})`,`mean (${s})`,`std (${s})`,"Area","Unit"),i.push(a,t,n,r,l))}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g)}}};const ce={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return[];const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{mean:p,stdDev:u,max:g,area:h,Modality:I,areaUnit:S,modalityUnit:v}=o;r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,Modality:I,unit:v,mean:p,stdDev:u,max:g,area:h,areaUnit:S})}),r}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:i,frameNumber:a,areaUnit:r}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===i);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${a}`:"",m=p.Wp.roundNumber(o||0,2);return n.primary.push(`${m} ${ae(r)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:i}=e,a=se(o,t,"max");n.primary.push(a),n.secondary.push(`S: ${i}${c}${d}`)}),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,isLocked:c,isVisible:d,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:CircleROI"),e.forEach(e=>{const{mean:t,stdDev:n,max:a,area:r,unit:s,areaUnit:l}=e;t&&s&&a&&r&&(o.push(`max (${s})`,`mean (${s})`,`std (${s})`,"Area","Unit"),i.push(a,t,n,r,l))}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g)}}};const de={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:p,FrameOfReferenceUID:u}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:g,SeriesInstanceUID:h,StudyInstanceUID:I}=Q(p,t,a);let S;S=g?t.getDisplaySetForSOPInstanceUID(g,h):t.getDisplaySetsForSeries(h)[0];const{points:v,textBox:y}=s.handles,f=function(e,t){const{metadata:n,data:o}=e,{text:i}=o,{referencedImageId:a}=n,r=[],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d;return r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,text:i}),r}(a,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{SeriesNumber:o,SOPInstanceUID:i,frameNumber:a,text:r}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===i);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${a}`:"";r&&n.primary.push(r);return n.secondary.push(`S: ${o}${c}${d}`),n}(f,S);return{uid:l,SOPInstanceUID:g,FrameOfReferenceUID:u,points:v,textBox:y,isLocked:c,isVisible:d,metadata:r,referenceSeriesUID:h,referenceStudyUID:I,referencedImageId:p,frameNumber:f[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:S.displaySetInstanceUID,label:s.text,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>{throw new Error("Not implemented")}}}};const me={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Cobb Angle tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return;const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{angle:p}=o,u="°";r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,angle:p})}),r}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{angle:o,unit:i,SeriesNumber:a,SOPInstanceUID:r,frameNumber:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===r);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${s}`:"";if(void 0===o)return n;const u=p.Wp.roundNumber(o,2);return n.primary.push(`${u} ${ae(i)}`),n.secondary.push(`S: ${a}${d}${m}`),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,isLocked:c,isVisible:d,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:w?.[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:CobbAngle"),e.forEach(e=>{const{angle:t,unit:n}=e;o.push(`Angle (${n})`),i.push(t)}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g)}}};const pe={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return;const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{angle:p}=o,u="°";r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,angle:p})}),r}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{angle:o,unit:i,SeriesNumber:a,SOPInstanceUID:r,frameNumber:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===r);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${s}`:"";if(void 0===o)return n;const u=p.Wp.roundNumber(o,2);return n.primary.push(`${u} ${ae(i)}`),n.secondary.push(`S: ${a}${d}${m}`),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,isLocked:c,isVisible:d,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,frameNumber:w?.[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:Angle"),e.forEach(e=>{const{angle:t,unit:n}=e;o.push(`Angle (${n})`),i.push(t)}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g),referencedImageId:u}}};const ue={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.debug("PlanarFreehandROI tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error(`Tool ${m} not supported`);const{SOPInstanceUID:h,SeriesInstanceUID:I,frameNumber:S,StudyInstanceUID:v}=Q(u,t,a);let y;y=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const f=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return[];const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{mean:p,stdDev:u,max:g,area:h,Modality:I,areaUnit:S,modalityUnit:v}=o;r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,Modality:I,unit:v,mean:p,stdDev:u,max:g,area:h,areaUnit:S})}),r}(a,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:i,frameNumber:a,areaUnit:r}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===i);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${a}`:"",m=p.Wp.roundNumber(o||0,2);return n.primary.push(`${m} ${ae(r)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:i}=e,a=se(o,t,"max");n.primary.push(a),n.secondary.push(`S: ${i}${c}${d}`)}),n}(f,y);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:s.contour.polyline,textBox:s.handles.textBox,metadata:r,frameNumber:S,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,toolName:r.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t){const{PlanarFreehandROI:n}=t.get("cornerstone.measurements"),{report:o}=n,i=[],a=[];i.push("AnnotationType"),a.push("Cornerstone:PlanarFreehandROI");const{metadata:r,data:s}=e,l=s.cachedStats[`imageId:${r.referencedImageId}`];o.forEach(({name:e,value:t})=>{i.push(e),l[t]?a.push(l[t]):a.push("not available")}),r.FrameOfReferenceUID&&(i.push("FrameOfReferenceUID"),a.push(r.FrameOfReferenceUID));s.contour.polyline&&(i.push("points"),a.push(s.contour.polyline.map(e=>e.join(" ")).join(";")));return{columns:i,values:a}}(a,i),isLocked:c,isVisible:d}}};const ge={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Rectangle ROI tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y,textBox:f}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return[];const r=[];return Object.keys(i).forEach(o=>{const s=i[o],{SOPInstanceUID:l,SeriesInstanceUID:c,frameNumber:d}=Q(a,t,e),m=t.getDisplaySetsForSeries(c)[0],{SeriesNumber:p}=m,{mean:u,stdDev:g,max:h,area:I,Modality:S,modalityUnit:v,areaUnit:y}=s;r.push({SeriesInstanceUID:c,SOPInstanceUID:l,SeriesNumber:p,frameNumber:d,Modality:S,unit:v,mean:u,stdDev:g,metadata:n,max:h,area:I,areaUnit:y})}),r}(a,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:i,frameNumber:a,areaUnit:r}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===i);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${a}`:"",m=p.Wp.roundNumber(o||0,2);return n.primary.push(`${m} ${ae(r)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:i}=e,a=se(o,t,"max");n.primary.push(a),n.secondary.push(`S: ${i}${c}${d}`)}),n}(w,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,textBox:f,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:RectangleROI"),e.forEach(e=>{const{mean:t,stdDev:n,max:a,area:r,unit:s,areaUnit:l}=e;t&&s&&a&&r&&(o.push("Maximum","Mean","Std Dev","Pixel Unit","Area","Unit"),i.push(a,t,n,s,r,l))}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(w,y,g),isLocked:c,isVisible:d}}};const he={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("SplineROI tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error(`Tool ${m} not supported`);const{SOPInstanceUID:h,SeriesInstanceUID:I,frameNumber:S,StudyInstanceUID:v}=Q(u,t,a);let y;y=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const f=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return[];const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{mean:p,stdDev:u,max:g,area:h,Modality:I,areaUnit:S,modalityUnit:v}=o;r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,Modality:I,unit:v,mean:p,stdDev:u,max:g,area:h,areaUnit:S})}),r}(a,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:i,frameNumber:a,areaUnit:r}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===i);let l;s&&(l=s.InstanceNumber);t.isMultiFrame;const c=p.Wp.roundNumber(o||0,2);return n.primary.push(`${c} ${ae(r)}`),n}(f,y);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:s.contour.polyline,textBox:s.handles.textBox,metadata:r,frameNumber:S,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,toolName:r.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t){const{SplineROI:n}=t.get("cornerstone.measurements"),{report:o}=n,i=[],a=[];i.push("AnnotationType"),a.push("Cornerstone:SplineROI");const{metadata:r,data:s}=e,l=s.cachedStats[`imageId:${r.referencedImageId}`];o.forEach(({name:e,value:t})=>{i.push(e),l[t]?a.push(l[t]):a.push("not available")}),r.FrameOfReferenceUID&&(i.push("FrameOfReferenceUID"),a.push(r.FrameOfReferenceUID));s.contour.polyline&&(i.push("points"),a.push(s.contour.polyline.map(e=>e.join(" ")).join(";")));return{columns:i,values:a}}(a,i),isLocked:c,isVisible:d}}};function Ie(e,t){const{metadata:n,data:o}=e;if(!o.cachedStats||!o.cachedStats[`imageId:${n.referencedImageId}`])return[];const{area:i,areaUnit:a}=o.cachedStats[`imageId:${n.referencedImageId}`],{SOPInstanceUID:r,frameNumber:s}=Q(n.referencedImageId),l={primary:[],secondary:[]},c=t.instances.find(e=>e.SOPInstanceUID===r);let d;c&&(d=c.InstanceNumber);const m=d?` I: ${d}`:"",u=t.isMultiFrame?` F: ${s}`:"",{SeriesNumber:g}=t;let h=null;void 0!==g&&(h=`S: ${g}${m}${u}`);const I=[];if(i){const e=p.Wp.roundNumber(i||0,2);I.push(`${e} ${ae(a)}`)}return h&&I.push(h),l.primary.push({text:I,series:h}),l}const Se={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Livewire tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:p,FrameOfReferenceUID:u}=r;if(!K.includes(m))throw new Error(`Tool ${m} not supported`);const{SOPInstanceUID:g,SeriesInstanceUID:h,frameNumber:I,StudyInstanceUID:S}=Q(p);let v;return v=g?t.getDisplaySetForSOPInstanceUID(g,h):t.getDisplaySetsForSeries(h),{uid:l,SOPInstanceUID:g,FrameOfReferenceUID:u,points:s.contour.polyline,textBox:s.handles.textBox,metadata:r,frameNumber:I,referenceSeriesUID:h,referenceStudyUID:S,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,isLocked:c,isVisible:d,displayText:Ie(a,v),data:s.cachedStats,type:o(m),getReport:()=>function(e){const t=[],n=[];t.push("AnnotationType"),n.push("Cornerstone:Livewire");const{metadata:o,data:i}=e;o.FrameOfReferenceUID&&(t.push("FrameOfReferenceUID"),n.push(o.FrameOfReferenceUID));i.contour.polyline&&(t.push("points"),n.push(i.contour.polyline.map(e=>e.join(" ")).join(";")));return{columns:t,values:n}}(a)}}};const ve={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Probe tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u,t,a);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I)[0];const{points:y}=s.handles,f=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return;const r=[];return Object.keys(i).forEach(n=>{const o=i[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=Q(a,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{value:p}=o,u="HU";r.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,value:p})}),r}(a,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{value:o,unit:i,SeriesNumber:a,SOPInstanceUID:r,frameNumber:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===r);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${s}`:"";if(void 0!==o){const e=p.Wp.roundNumber(o,2);n.primary.push(`${e} ${ae(i)}`),n.secondary.push(`S: ${a}${d}${m}`)}return n}(f,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,metadata:r,isLocked:c,isVisible:d,referenceSeriesUID:I,referenceStudyUID:S,referencedImageId:u,frameNumber:f?.[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:Probe"),e.forEach(e=>{const{value:t,unit:n}=e;o.push(`Probe (${n})`),i.push(t)}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(f,y,g)}}};const ye={toAnnotation:e=>{},toMeasurement:(e,t,n,o,i)=>{const{annotation:a}=e,{metadata:r,data:s,annotationUID:l}=a,c=X(l),d=J(l);if(!r||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=r;if(!K.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:h,SeriesInstanceUID:I,StudyInstanceUID:S}=Q(u);let v;v=h?t.getDisplaySetForSOPInstanceUID(h,I):t.getDisplaySetsForSeries(I);const{points:y}=s.handles,f=function(e,t){const{metadata:n,data:o}=e,{cachedStats:i}=o,{referencedImageId:a}=n;if(!Object.keys(i).length)return;const r=[];return Object.keys(i).forEach(e=>{const n=i[e];if(!a)throw new Error("Non-acquisition plane measurement mapping not supported");const{SOPInstanceUID:o,SeriesInstanceUID:s,frameNumber:l}=Q(a),c=t.getDisplaySetForSOPInstanceUID(o,s,l),{SeriesNumber:d}=c,{xValues:m,yValues:p,units:u,isUnitless:g,isHorizontal:h}=n;r.push({SeriesInstanceUID:s,SOPInstanceUID:o,SeriesNumber:d,frameNumber:l,xValues:m,yValues:p,units:u,isUnitless:g,isHorizontal:h})}),r}(a,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{xValues:o,yValues:i,units:a,isUnitless:r,SeriesNumber:s,SOPInstanceUID:l,frameNumber:c}=e[0],d=t.instances.find(e=>e.SOPInstanceUID===l);let m;d&&(m=d.InstanceNumber);const u=m?` I: ${m}`:"",g=t.isMultiFrame?` F: ${c}`:"",h=`S: ${s}${u}${g}`;if(void 0===o||void 0===i)return n;if(r)n.primary.push(`${p.Wp.roundNumber(o[0],2)} ${a[0]}`);else{const e=Math.abs(o[1]-o[0]),t=Math.abs(i[1]-i[0]);n.primary.push(`${p.Wp.roundNumber(e)} ${a[0]}`),n.primary.push(`${p.Wp.roundNumber(t)} ${a[1]}`)}return n.secondary.push(h),n}(f,v);return{uid:l,SOPInstanceUID:h,FrameOfReferenceUID:g,points:y,metadata:r,referenceSeriesUID:I,referenceStudyUID:S,frameNumber:f?.[0]?.frameNumber||1,toolName:r.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],i=[];o.push("AnnotationType"),i.push("Cornerstone:UltrasoundDirectional"),e.forEach(e=>{const{xValues:t,yValues:n,units:a,isUnitless:r}=e;if(r)o.push("Length"+a[0]),i.push(p.Wp.roundNumber(t[0],2));else{const e=Math.abs(t[1]-t[0]),r=Math.abs(n[1]-n[0]);o.push("Time"+a[0]),i.push(p.Wp.roundNumber(e,2)),o.push("Length"+a[1]),i.push(p.Wp.roundNumber(r,2))}}),n&&(o.push("FrameOfReferenceUID"),i.push(n));t&&(o.push("points"),i.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:i}}(f,y,g),isLocked:c,isVisible:d}}},fe=(e,t,n,o)=>{const i=e=>{const{POLYLINE:t,ELLIPSE:n,CIRCLE:o,RECTANGLE:i,BIDIRECTIONAL:a,POINT:r,ANGLE:s}=p.C5.VALUE_TYPES;return{Length:t,EllipticalROI:n,CircleROI:o,RectangleROI:i,PlanarFreehandROI:t,Bidirectional:a,ArrowAnnotate:r,CobbAngle:s,Angle:s,SplineROI:t,LivewireContour:t,Probe:r,UltrasoundDirectional:t}[e]};return{Length:{toAnnotation:ee.toAnnotation,toMeasurement:e=>ee.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]},Bidirectional:{toAnnotation:re.toAnnotation,toMeasurement:e=>re.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2},{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]},EllipticalROI:{toAnnotation:le.toAnnotation,toMeasurement:e=>le.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.ELLIPSE}]},CircleROI:{toAnnotation:ce.toAnnotation,toMeasurement:e=>ce.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.CIRCLE}]},RectangleROI:{toAnnotation:ge.toAnnotation,toMeasurement:e=>ge.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},PlanarFreehandROI:{toAnnotation:ue.toAnnotation,toMeasurement:e=>ue.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},SplineROI:{toAnnotation:he.toAnnotation,toMeasurement:e=>he.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},LivewireContour:{toAnnotation:Se.toAnnotation,toMeasurement:e=>Se.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},ArrowAnnotate:{toAnnotation:de.toAnnotation,toMeasurement:e=>de.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POINT,points:1}]},Probe:{toAnnotation:ve.toAnnotation,toMeasurement:e=>ve.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POINT,points:1}]},CobbAngle:{toAnnotation:me.toAnnotation,toMeasurement:e=>me.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.ANGLE}]},Angle:{toAnnotation:pe.toAnnotation,toMeasurement:e=>pe.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.ANGLE}]},UltrasoundDirectional:{toAnnotation:ye.toAnnotation,toMeasurement:e=>ye.toMeasurement(e,t,n,i,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]}}};var we=n(52606);const{rM:Ee,yK:Te}=o,{removeAnnotation:De}=l.annotation.state,be=l.Enums.Events,Oe=e=>{const{measurementService:t,displaySetService:n,cornerstoneViewportService:o,customizationService:i}=e.services,a=((e,t,n,o)=>{const{Length:i,Bidirectional:a,EllipticalROI:r,CircleROI:s,ArrowAnnotate:l,Angle:c,CobbAngle:d,RectangleROI:m,PlanarFreehandROI:p,SplineROI:u,LivewireContour:g,Probe:h,UltrasoundDirectional:I}=fe(e,t,n,o),S=e.createSource(Ee,Te);return e.addMapping(S,"Length",i.matchingCriteria,i.toAnnotation,i.toMeasurement),e.addMapping(S,"Crosshairs",i.matchingCriteria,()=>null,()=>null),e.addMapping(S,"Bidirectional",a.matchingCriteria,a.toAnnotation,a.toMeasurement),e.addMapping(S,"EllipticalROI",r.matchingCriteria,r.toAnnotation,r.toMeasurement),e.addMapping(S,"CircleROI",s.matchingCriteria,s.toAnnotation,s.toMeasurement),e.addMapping(S,"ArrowAnnotate",l.matchingCriteria,l.toAnnotation,l.toMeasurement),e.addMapping(S,"CobbAngle",d.matchingCriteria,d.toAnnotation,d.toMeasurement),e.addMapping(S,"Angle",c.matchingCriteria,c.toAnnotation,c.toMeasurement),e.addMapping(S,"RectangleROI",m.matchingCriteria,m.toAnnotation,m.toMeasurement),e.addMapping(S,"PlanarFreehandROI",p.matchingCriteria,p.toAnnotation,p.toMeasurement),e.addMapping(S,"SplineROI",u.matchingCriteria,u.toAnnotation,u.toMeasurement),e.addMapping(S,"CalibrationLine",i.matchingCriteria,i.toAnnotation,i.toMeasurement),e.addMapping(S,"Disease",m.matchingCriteria,m.toAnnotation,m.toMeasurement),e.addMapping(S,"LivewireContour",g.matchingCriteria,g.toAnnotation,g.toMeasurement),e.addMapping(S,"Probe",h.matchingCriteria,h.toAnnotation,h.toMeasurement),e.addMapping(S,"UltrasoundDirectionalTool",I.matchingCriteria,I.toAnnotation,I.toMeasurement),S})(t,n,o,i);Ce(t,o);const{annotationToMeasurement:r,remove:l}=a;function c(t){try{const n=t.detail,{annotation:{metadata:i,annotationUID:a}}=n,{toolName:s}=i;t.type===p&&s===Y.CalibrationLine?T(e,t).then(()=>{console.log("Calibration applied.")},()=>!0).finally(()=>{De(a),d(t),o.resize()}):(n.uid=a,r(s,n))}catch(e){console.warn("Failed to add measurement:",e)}}function d(e){try{const n=e.detail,{annotation:{annotationUID:o}}=n;t.getMeasurement(o)&&l(o,n)}catch(e){console.warn("Failed to remove measurement:",e)}}const m=be.ANNOTATION_ADDED,p=be.ANNOTATION_COMPLETED,u=be.ANNOTATION_MODIFIED,g=be.ANNOTATION_REMOVED,h=be.ANNOTATION_SELECTION_CHANGE;return s.eventTarget.addEventListener(m,c),s.eventTarget.addEventListener(p,c),s.eventTarget.addEventListener(u,function(e){try{const n=e.detail,{annotation:{metadata:o,annotationUID:i}}=n;if(!t.getMeasurement(i))return;const{toolName:a}=o;n.uid=i,r(a,n,!0)}catch(e){console.warn("Failed to update measurement:",e)}}),s.eventTarget.addEventListener(g,d),s.eventTarget.addEventListener(h,function(e){try{const n=e.detail,{added:o,removed:i}=n;i&&i.forEach(e=>t.setMeasurementSelected(e,!1)),o&&o.forEach(e=>t.setMeasurementSelected(e,!0))}catch(e){console.warn("Failed to select/unselect measurements:",e)}}),a},Ce=(e,t)=>{const{MEASUREMENT_REMOVED:n,MEASUREMENTS_CLEARED:o,MEASUREMENT_UPDATED:i,RAW_MEASUREMENT_ADDED:a}=e.EVENTS;e.subscribe(o,({measurements:e})=>{if(Object.keys(e).length){for(const t of Object.values(e)){const{uid:e,source:n}=t;n.name===Ee&&De(e)}t.getRenderingEngine().render()}}),e.subscribe(i,({source:e,measurement:n,notYetUpdatedAtSource:o})=>{if(e.name!==Ee)return;if(!1===o)return;const{uid:i,label:a,isLocked:r,isVisible:s}=n,c=l.annotation.state.getAnnotation(i),{data:d,metadata:m}=c;if(!d)return;d.label!==a&&(d.label=a),"ArrowAnnotate"===m.toolName&&(d.text=a),l.annotation.locking.setAnnotationLocked(i,r),l.annotation.visibility.setAnnotationVisibility(i,s);const p=t.getRenderingEngine().getViewports().map(e=>e.id);(0,we.triggerAnnotationRenderForViewportIds)(p)}),e.subscribe(a,({source:e,measurement:t,data:n,dataSource:o})=>{if(e.name!==Ee)return;const{referenceSeriesUID:i,referenceStudyUID:a,SOPInstanceUID:r}=t,s=p.H8.getInstance(a,i,r);let c,d=1;t?.metadata?.referencedImageId?(c=t.metadata.referencedImageId,d=Q(t.metadata.referencedImageId).frameNumber):c=o.getImageIdsForInstance({instance:s});l.annotation.state.getAnnotationManager().addAnnotation({annotationUID:t.uid,highlighted:!1,isLocked:!1,invalidated:!1,metadata:{toolName:t.toolName,FrameOfReferenceUID:t.FrameOfReferenceUID,referencedImageId:c},data:{...n.annotation.data||{},text:n.annotation.data.text,handles:{...n.annotation.data.handles},cachedStats:{...n.annotation.data.cachedStats},label:n.annotation.data.label,frameNumber:d}})}),e.subscribe(n,({source:e,measurement:n})=>{if(e?.name&&e.name!==Ee)return;De(n);t.getRenderingEngine().render()})};function Ae(e,t){const{viewportGridService:n,cornerstoneViewportService:o}=e.services,{viewports:i}=n.getState(),a=i.get(t);if("volume"!==a?.viewportOptions?.viewportType)return[];const r=o.getCornerstoneViewport(t),l=r?function(e){const t=e.getAllVolumeIds().map(e=>s.cache.getVolume(e));return t.find(e=>e.isDynamicVolume())??t[0]}(r):null;if(!l?.isDynamicVolume())return[];const{volumeId:c}=l;return Array.from(i.values()).filter(({viewportId:e})=>{const n=o.getCornerstoneViewport(e);return e!==t&&n?.hasVolumeId(c)}).map(({viewportId:e})=>({viewportId:e}))}const Me=function(e){const{cineService:t}=e.services;t.setServiceImplementation({getSyncedViewports:t=>Ae(e,t),playClip:(e,t)=>l.utilities.cine.playClip(e,t),stopClip:(e,t)=>l.utilities.cine.stopClip(e,t)})};const Re=function(e){const{studyPrefetcherService:t}=e.services;t.requestType=s.Enums.RequestType.Prefetch,t.imageLoadPoolManager=s.imageLoadPoolManager,t.imageLoader=s.imageLoader,t.cache={isImageCached:e=>!!s.cache.getImageLoadObject(e)},t.imageLoadEventsManager={addEventListeners:(e,t)=>(s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOADED,e),s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOAD_FAILED,t),[{unsubscribe:()=>s.eventTarget.removeEventListener(s.EVENTS.IMAGE_LOADED,e)},{unsubscribe:()=>s.eventTarget.removeEventListener(s.EVENTS.IMAGE_LOAD_FAILED,t)}])}};var Ne=n(637);const Ve=new Map,Pe=new Map;function Ue({data:{viewportId:e,volumeInputArray:t},displaySetsMatchDetails:n,viewportMatchDetails:o}){Pe.set(e,t);for(const e of t){const{volumeId:t}=e,n=s.cache.getVolume(t);if(!n)return;if(!Ve.has(t)){const{metadata:e}=n;Ve.set(t,e.SeriesInstanceUID)}}const i=new Set;Pe.forEach((e,t)=>{e.forEach(e=>{const{volumeId:t}=e;i.add(t)})});const a=new Set;o.forEach(e=>{const{displaySetsInfo:t}=e;t.forEach(({displaySetInstanceUID:e})=>{a.add(e)})});const r=Array.from(Ve.keys()).slice().map(e=>s.cache.getVolume(e)),l=[];r.forEach(e=>{const t=e.getImageLoadRequests();if(!t.length||!t[0]||!t[0].imageId)return;const n=function(e){const t=e.length-1,n=Math.floor(e.length/2);let o=n,i=n;const a=[{imageId:e[n],imageIdIndex:n}],r={currentPositionDownToMinimum:!1,currentPositionUpToMaximum:!1};for(0===n?r.currentPositionDownToMinimum=!0:n===t&&(r.currentPositionUpToMaximum=!0);!r.currentPositionDownToMinimum||!r.currentPositionUpToMaximum;)r.currentPositionDownToMinimum||(o--,a.push({imageId:e[o],imageIdIndex:o}),0===o&&(r.currentPositionDownToMinimum=!0)),r.currentPositionUpToMaximum||(i++,a.push({imageId:e[i],imageIdIndex:i}),i===t&&(r.currentPositionUpToMaximum=!0));return a}(t.map(e=>e.imageId)).map(({imageId:e})=>t.find(t=>t.imageId===e));l.push(n)});const c=(0,Ne.compact)((0,Ne.flatten)((0,Ne.zip)(...l))),d=[];c.forEach(e=>{const{imageId:t}=e;l.forEach(e=>{const n=e.find(e=>e.imageId===t);n&&d.push(n)})});const m=s.Enums.RequestType.Prefetch;d.forEach(({callLoadImage:e,additionalDetails:t,imageId:n,imageIdIndex:o,options:i})=>{const a=e.bind(null,n,o,i);s.imageLoadPoolManager.addRequest(a,m,t,0)}),Ve.clear();const p=new Map(Pe);return Pe.clear(),p}const xe=new Map,_e=new Map;function Le({data:{viewportId:e,volumeInputArray:t},displaySetsMatchDetails:n}){_e.set(e,t);for(const e of t){const{volumeId:t}=e,n=s.cache.getVolume(t);if(!n)return void console.log("interleaveNthLoader::No volume, can't load it");if(!xe.has(t)){const{metadata:e}=n;xe.set(t,e.SeriesInstanceUID)}}const o=function(e){if(!e||!e.length)return[];if(1===e.length)return e[0];console.time("interleave");const t=[...e],n=[];for(let e=0;t.length>0;e++)for(const o of t)e>=o.length?t.splice(t.indexOf(o),1):n.push(o[e]);return console.timeEnd("interleave"),n}(Array.from(xe.keys()).slice().map(e=>s.cache.getVolume(e)).map(e=>e.getImageLoadRequests()).filter(e=>e?.[0]?.imageId).map(e=>function(e){const t=[[],[],[],[],[]],n=e.length/2-3,o=n+6;for(let i=0;i<e.length;i++)i<2||i>e.length-4||i>n&&i<o?t[0].push(e[i]):i%7==2?t[1].push(e[i]):i%7==5?t[2].push(e[i]):t[i%2+3].push(e[i]);return[...t[0],...t[1],...t[2],...t[3],...t[4]]}(e))),i=s.Enums.RequestType.Prefetch;o.forEach(({callLoadImage:e,additionalDetails:t,imageId:n,imageIdIndex:o,options:a})=>{const r=e.bind(null,n,o,a);s.imageLoadPoolManager.addRequest(r,i,t,0)}),xe.clear();const a=new Map(_e);return _e.clear(),a}const Fe=new Map,Ge=new Map;function ke({data:{viewportId:e,volumeInputArray:t},displaySetsMatchDetails:n,viewportMatchDetails:o}){Ge.set(e,t);for(const e of t){const{volumeId:t}=e,n=s.cache.getVolume(t);if(!n)return;if(!Fe.has(t)){const{metadata:e}=n;Fe.set(t,e.SeriesInstanceUID)}}const i=[],a=new Set;Array.from(o.values()).forEach(e=>{const{displaySetsInfo:t}=e;let n=0;t.forEach(({displaySetInstanceUID:e,displaySetOptions:t})=>{t?.options?.skipLoading||(n++,a.add(e))}),n&&i.push(e)});const r=new Set;Ge.forEach((e,t)=>{e.forEach(e=>{const{volumeId:t}=e;r.add(t)})});const l=new Set;if(o.forEach(e=>{const{displaySetsInfo:t}=e;t.forEach(({displaySetInstanceUID:e})=>{l.add(e)})}),r.size!==l.size)return;const c=Array.from(Fe.keys()).slice().map(e=>s.cache.getVolume(e)),d=[];c.forEach(e=>{const t=e.getImageLoadRequests();t?.[0]?.imageId&&d.push(t.reverse())});const m=(0,Ne.compact)((0,Ne.flatten)((0,Ne.zip)(...d))),p=[];m.forEach(e=>{const{imageId:t}=e;d.forEach(e=>{const n=e.find(e=>e.imageId===t);n&&p.push(n)})});const u=s.Enums.RequestType.Prefetch;p.forEach(({callLoadImage:e,additionalDetails:t,imageId:n,imageIdIndex:o,options:i})=>{const a=e.bind(null,n,o,i);s.imageLoadPoolManager.addRequest(a,u,t,0)}),Fe.clear();const g=new Map(Ge);return Ge.clear(),g}const Be=(e,t)=>{if(!t?.detail)return;const{element:n,currentPoints:o}=t.detail;return e.runCommand("getNearbyAnnotation",{element:n,canvasCoordinates:o?.canvas},"CORNERSTONE")},ze=l.Enums.Events,$e={button1:{commands:[{commandName:"closeContextMenu"}]},button3:{commands:[{commandName:"showCornerstoneContextMenu",commandOptions:{requireNearbyToolData:!0,menuId:"measurementsContextMenu"}}]}};const We=function({cornerstoneViewportService:e,customizationService:t,commandsManager:n}){const o=e=>{const o=function(e){const t=e.detail.event.which,n=[];return e.detail.event.altKey&&n.push("alt"),e.detail.event.ctrlKey&&n.push("ctrl"),e.detail.event.shiftKey&&n.push("shift"),n.push("button"),n.push(t),n.join("")}(e);((e,o)=>{const i=(t.get("cornerstoneViewportClickCommands")||$e)[e];if(!i)return;let a=null;i.commands.some(e=>e.commandOptions?.requireNearbyToolData)&&(a=Be(n,o));const r={nearbyToolData:a,event:o};n.run(i,r)})(o,e)};s.eventTarget.addEventListener(s.EVENTS.ELEMENT_ENABLED,function(t){const{viewportId:n,element:i}=t.detail;e.getViewportInfo(n)&&((0,v.ye)(n,i),i.addEventListener(ze.MOUSE_CLICK,o))}.bind(null)),s.eventTarget.addEventListener(s.EVENTS.ELEMENT_DISABLED,function(e){const{element:t}=e.detail;t.removeEventListener(ze.MOUSE_CLICK,o)}.bind(null))},He=l.Enums.Events,je={doubleClick:{commandName:"toggleOneUp",commandOptions:{}}};const qe=function({customizationService:e,commandsManager:t}){const n=n=>{if(Be(t,n))return;const o=function(e){const t=[];return e.detail.event.altKey&&t.push("alt"),e.detail.event.ctrlKey&&t.push("ctrl"),e.detail.event.shiftKey&&t.push("shift"),t.push("doubleClick"),t.join("")}(n),i=e.get("cornerstoneViewportClickCommands")||je,a=i[o];console.log("toRun",a,i,o),a&&t.run(a)};s.eventTarget.addEventListener(s.EVENTS.ELEMENT_ENABLED,function(e){const{element:t}=e.detail;t.addEventListener(He.MOUSE_DOUBLE_CLICK,n)}.bind(null)),s.eventTarget.addEventListener(s.EVENTS.ELEMENT_DISABLED,function(e){const{element:t}=e.detail;t.removeEventListener(He.MOUSE_DOUBLE_CLICK,n)}.bind(null))},Ye=[],Ke={viewportsWaiting:0};function Ze(e){if("preRender"===e.detail.viewportStatus)return;const{W:t}=p.fX;p.Rm.timeEnd(t.DISPLAY_SETS_TO_FIRST_IMAGE),p.Rm.timeEnd(t.STUDY_TO_FIRST_IMAGE),p.Rm.timeEnd(t.SCRIPT_TO_VIEW),Ke.viewportsWaiting-=1,e.detail.element.removeEventListener(s.EVENTS.IMAGE_RENDERED,Ze),Ke.viewportsWaiting||p.Rm.timeEnd(t.DISPLAY_SETS_TO_ALL_IMAGES)}const Xe=[{ColorSpace:"RGB",Name:"Grayscale",name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1],description:"Grayscale"},{ColorSpace:"RGB",Name:"X Ray",name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0],description:"X Ray"},{ColorSpace:"RGB",Name:"hsv",name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0],description:"HSV"},{ColorSpace:"RGB",Name:"hot_iron",name:"hot_iron",RGBPoints:[0,.0039215686,.0039215686,.0156862745,.00392156862745098,.0039215686,.0039215686,.0156862745,.00784313725490196,.0039215686,.0039215686,.031372549,.011764705882352941,.0039215686,.0039215686,.0470588235,.01568627450980392,.0039215686,.0039215686,.062745098,.0196078431372549,.0039215686,.0039215686,.0784313725,.023529411764705882,.0039215686,.0039215686,.0941176471,.027450980392156862,.0039215686,.0039215686,.1098039216,.03137254901960784,.0039215686,.0039215686,.1254901961,.03529411764705882,.0039215686,.0039215686,.1411764706,.0392156862745098,.0039215686,.0039215686,.1568627451,.043137254901960784,.0039215686,.0039215686,.1725490196,.047058823529411764,.0039215686,.0039215686,.1882352941,.050980392156862744,.0039215686,.0039215686,.2039215686,.054901960784313725,.0039215686,.0039215686,.2196078431,.05882352941176471,.0039215686,.0039215686,.2352941176,.06274509803921569,.0039215686,.0039215686,.2509803922,.06666666666666667,.0039215686,.0039215686,.262745098,.07058823529411765,.0039215686,.0039215686,.2784313725,.07450980392156863,.0039215686,.0039215686,.2941176471,.0784313725490196,.0039215686,.0039215686,.3098039216,.08235294117647059,.0039215686,.0039215686,.3254901961,.08627450980392157,.0039215686,.0039215686,.3411764706,.09019607843137255,.0039215686,.0039215686,.3568627451,.09411764705882353,.0039215686,.0039215686,.3725490196,.09803921568627451,.0039215686,.0039215686,.3882352941,.10196078431372549,.0039215686,.0039215686,.4039215686,.10588235294117647,.0039215686,.0039215686,.4196078431,.10980392156862745,.0039215686,.0039215686,.4352941176,.11372549019607843,.0039215686,.0039215686,.4509803922,.11764705882352942,.0039215686,.0039215686,.4666666667,.12156862745098039,.0039215686,.0039215686,.4823529412,.12549019607843137,.0039215686,.0039215686,.4980392157,.12941176470588237,.0039215686,.0039215686,.5137254902,.13333333333333333,.0039215686,.0039215686,.5294117647,.13725490196078433,.0039215686,.0039215686,.5450980392,.1411764705882353,.0039215686,.0039215686,.5607843137,.1450980392156863,.0039215686,.0039215686,.5764705882,.14901960784313725,.0039215686,.0039215686,.5921568627,.15294117647058825,.0039215686,.0039215686,.6078431373,.1568627450980392,.0039215686,.0039215686,.6235294118,.1607843137254902,.0039215686,.0039215686,.6392156863,.16470588235294117,.0039215686,.0039215686,.6549019608,.16862745098039217,.0039215686,.0039215686,.6705882353,.17254901960784313,.0039215686,.0039215686,.6862745098,.17647058823529413,.0039215686,.0039215686,.7019607843,.1803921568627451,.0039215686,.0039215686,.7176470588,.1843137254901961,.0039215686,.0039215686,.7333333333,.18823529411764706,.0039215686,.0039215686,.7490196078,.19215686274509805,.0039215686,.0039215686,.7607843137,.19607843137254902,.0039215686,.0039215686,.7764705882,.2,.0039215686,.0039215686,.7921568627,.20392156862745098,.0039215686,.0039215686,.8078431373,.20784313725490197,.0039215686,.0039215686,.8235294118,.21176470588235294,.0039215686,.0039215686,.8392156863,.21568627450980393,.0039215686,.0039215686,.8549019608,.2196078431372549,.0039215686,.0039215686,.8705882353,.2235294117647059,.0039215686,.0039215686,.8862745098,.22745098039215686,.0039215686,.0039215686,.9019607843,.23137254901960785,.0039215686,.0039215686,.9176470588,.23529411764705885,.0039215686,.0039215686,.9333333333,.23921568627450984,.0039215686,.0039215686,.9490196078,.24313725490196078,.0039215686,.0039215686,.9647058824,.24705882352941178,.0039215686,.0039215686,.9803921569,.25098039215686274,.0039215686,.0039215686,.9960784314,.2549019607843137,.0039215686,.0039215686,.9960784314,.25882352941176473,.0156862745,.0039215686,.9803921569,.2627450980392157,.031372549,.0039215686,.9647058824,.26666666666666666,.0470588235,.0039215686,.9490196078,.27058823529411763,.062745098,.0039215686,.9333333333,.27450980392156865,.0784313725,.0039215686,.9176470588,.2784313725490196,.0941176471,.0039215686,.9019607843,.2823529411764706,.1098039216,.0039215686,.8862745098,.28627450980392155,.1254901961,.0039215686,.8705882353,.2901960784313726,.1411764706,.0039215686,.8549019608,.29411764705882354,.1568627451,.0039215686,.8392156863,.2980392156862745,.1725490196,.0039215686,.8235294118,.30196078431372547,.1882352941,.0039215686,.8078431373,.3058823529411765,.2039215686,.0039215686,.7921568627,.30980392156862746,.2196078431,.0039215686,.7764705882,.3137254901960784,.2352941176,.0039215686,.7607843137,.3176470588235294,.2509803922,.0039215686,.7490196078,.3215686274509804,.262745098,.0039215686,.7333333333,.3254901960784314,.2784313725,.0039215686,.7176470588,.32941176470588235,.2941176471,.0039215686,.7019607843,.3333333333333333,.3098039216,.0039215686,.6862745098,.33725490196078434,.3254901961,.0039215686,.6705882353,.3411764705882353,.3411764706,.0039215686,.6549019608,.34509803921568627,.3568627451,.0039215686,.6392156863,.34901960784313724,.3725490196,.0039215686,.6235294118,.35294117647058826,.3882352941,.0039215686,.6078431373,.3568627450980392,.4039215686,.0039215686,.5921568627,.3607843137254902,.4196078431,.0039215686,.5764705882,.36470588235294116,.4352941176,.0039215686,.5607843137,.3686274509803922,.4509803922,.0039215686,.5450980392,.37254901960784315,.4666666667,.0039215686,.5294117647,.3764705882352941,.4823529412,.0039215686,.5137254902,.3803921568627451,.4980392157,.0039215686,.4980392157,.3843137254901961,.5137254902,.0039215686,.4823529412,.38823529411764707,.5294117647,.0039215686,.4666666667,.39215686274509803,.5450980392,.0039215686,.4509803922,.396078431372549,.5607843137,.0039215686,.4352941176,.4,.5764705882,.0039215686,.4196078431,.403921568627451,.5921568627,.0039215686,.4039215686,.40784313725490196,.6078431373,.0039215686,.3882352941,.4117647058823529,.6235294118,.0039215686,.3725490196,.41568627450980394,.6392156863,.0039215686,.3568627451,.4196078431372549,.6549019608,.0039215686,.3411764706,.4235294117647059,.6705882353,.0039215686,.3254901961,.42745098039215684,.6862745098,.0039215686,.3098039216,.43137254901960786,.7019607843,.0039215686,.2941176471,.43529411764705883,.7176470588,.0039215686,.2784313725,.4392156862745098,.7333333333,.0039215686,.262745098,.44313725490196076,.7490196078,.0039215686,.2509803922,.4470588235294118,.7607843137,.0039215686,.2352941176,.45098039215686275,.7764705882,.0039215686,.2196078431,.4549019607843137,.7921568627,.0039215686,.2039215686,.4588235294117647,.8078431373,.0039215686,.1882352941,.4627450980392157,.8235294118,.0039215686,.1725490196,.4666666666666667,.8392156863,.0039215686,.1568627451,.4705882352941177,.8549019608,.0039215686,.1411764706,.4745098039215686,.8705882353,.0039215686,.1254901961,.4784313725490197,.8862745098,.0039215686,.1098039216,.48235294117647065,.9019607843,.0039215686,.0941176471,.48627450980392156,.9176470588,.0039215686,.0784313725,.49019607843137253,.9333333333,.0039215686,.062745098,.49411764705882355,.9490196078,.0039215686,.0470588235,.4980392156862745,.9647058824,.0039215686,.031372549,.5019607843137255,.9803921569,.0039215686,.0156862745,.5058823529411764,.9960784314,.0039215686,.0039215686,.5098039215686274,.9960784314,.0156862745,.0039215686,.5137254901960784,.9960784314,.031372549,.0039215686,.5176470588235295,.9960784314,.0470588235,.0039215686,.5215686274509804,.9960784314,.062745098,.0039215686,.5254901960784314,.9960784314,.0784313725,.0039215686,.5294117647058824,.9960784314,.0941176471,.0039215686,.5333333333333333,.9960784314,.1098039216,.0039215686,.5372549019607843,.9960784314,.1254901961,.0039215686,.5411764705882353,.9960784314,.1411764706,.0039215686,.5450980392156862,.9960784314,.1568627451,.0039215686,.5490196078431373,.9960784314,.1725490196,.0039215686,.5529411764705883,.9960784314,.1882352941,.0039215686,.5568627450980392,.9960784314,.2039215686,.0039215686,.5607843137254902,.9960784314,.2196078431,.0039215686,.5647058823529412,.9960784314,.2352941176,.0039215686,.5686274509803921,.9960784314,.2509803922,.0039215686,.5725490196078431,.9960784314,.262745098,.0039215686,.5764705882352941,.9960784314,.2784313725,.0039215686,.5803921568627451,.9960784314,.2941176471,.0039215686,.5843137254901961,.9960784314,.3098039216,.0039215686,.5882352941176471,.9960784314,.3254901961,.0039215686,.592156862745098,.9960784314,.3411764706,.0039215686,.596078431372549,.9960784314,.3568627451,.0039215686,.6,.9960784314,.3725490196,.0039215686,.6039215686274509,.9960784314,.3882352941,.0039215686,.6078431372549019,.9960784314,.4039215686,.0039215686,.611764705882353,.9960784314,.4196078431,.0039215686,.615686274509804,.9960784314,.4352941176,.0039215686,.6196078431372549,.9960784314,.4509803922,.0039215686,.6235294117647059,.9960784314,.4666666667,.0039215686,.6274509803921569,.9960784314,.4823529412,.0039215686,.6313725490196078,.9960784314,.4980392157,.0039215686,.6352941176470588,.9960784314,.5137254902,.0039215686,.6392156862745098,.9960784314,.5294117647,.0039215686,.6431372549019608,.9960784314,.5450980392,.0039215686,.6470588235294118,.9960784314,.5607843137,.0039215686,.6509803921568628,.9960784314,.5764705882,.0039215686,.6549019607843137,.9960784314,.5921568627,.0039215686,.6588235294117647,.9960784314,.6078431373,.0039215686,.6627450980392157,.9960784314,.6235294118,.0039215686,.6666666666666666,.9960784314,.6392156863,.0039215686,.6705882352941176,.9960784314,.6549019608,.0039215686,.6745098039215687,.9960784314,.6705882353,.0039215686,.6784313725490196,.9960784314,.6862745098,.0039215686,.6823529411764706,.9960784314,.7019607843,.0039215686,.6862745098039216,.9960784314,.7176470588,.0039215686,.6901960784313725,.9960784314,.7333333333,.0039215686,.6941176470588235,.9960784314,.7490196078,.0039215686,.6980392156862745,.9960784314,.7607843137,.0039215686,.7019607843137254,.9960784314,.7764705882,.0039215686,.7058823529411765,.9960784314,.7921568627,.0039215686,.7098039215686275,.9960784314,.8078431373,.0039215686,.7137254901960784,.9960784314,.8235294118,.0039215686,.7176470588235294,.9960784314,.8392156863,.0039215686,.7215686274509804,.9960784314,.8549019608,.0039215686,.7254901960784313,.9960784314,.8705882353,.0039215686,.7294117647058823,.9960784314,.8862745098,.0039215686,.7333333333333333,.9960784314,.9019607843,.0039215686,.7372549019607844,.9960784314,.9176470588,.0039215686,.7411764705882353,.9960784314,.9333333333,.0039215686,.7450980392156863,.9960784314,.9490196078,.0039215686,.7490196078431373,.9960784314,.9647058824,.0039215686,.7529411764705882,.9960784314,.9803921569,.0039215686,.7568627450980392,.9960784314,.9960784314,.0039215686,.7607843137254902,.9960784314,.9960784314,.0196078431,.7647058823529411,.9960784314,.9960784314,.0352941176,.7686274509803922,.9960784314,.9960784314,.0509803922,.7725490196078432,.9960784314,.9960784314,.0666666667,.7764705882352941,.9960784314,.9960784314,.0823529412,.7803921568627451,.9960784314,.9960784314,.0980392157,.7843137254901961,.9960784314,.9960784314,.1137254902,.788235294117647,.9960784314,.9960784314,.1294117647,.792156862745098,.9960784314,.9960784314,.1450980392,.796078431372549,.9960784314,.9960784314,.1607843137,.8,.9960784314,.9960784314,.1764705882,.803921568627451,.9960784314,.9960784314,.1921568627,.807843137254902,.9960784314,.9960784314,.2078431373,.8117647058823529,.9960784314,.9960784314,.2235294118,.8156862745098039,.9960784314,.9960784314,.2392156863,.8196078431372549,.9960784314,.9960784314,.2509803922,.8235294117647058,.9960784314,.9960784314,.2666666667,.8274509803921568,.9960784314,.9960784314,.2823529412,.8313725490196079,.9960784314,.9960784314,.2980392157,.8352941176470589,.9960784314,.9960784314,.3137254902,.8392156862745098,.9960784314,.9960784314,.3333333333,.8431372549019608,.9960784314,.9960784314,.3490196078,.8470588235294118,.9960784314,.9960784314,.3647058824,.8509803921568627,.9960784314,.9960784314,.3803921569,.8549019607843137,.9960784314,.9960784314,.3960784314,.8588235294117647,.9960784314,.9960784314,.4117647059,.8627450980392157,.9960784314,.9960784314,.4274509804,.8666666666666667,.9960784314,.9960784314,.4431372549,.8705882352941177,.9960784314,.9960784314,.4588235294,.8745098039215686,.9960784314,.9960784314,.4745098039,.8784313725490196,.9960784314,.9960784314,.4901960784,.8823529411764706,.9960784314,.9960784314,.5058823529,.8862745098039215,.9960784314,.9960784314,.5215686275,.8901960784313725,.9960784314,.9960784314,.537254902,.8941176470588236,.9960784314,.9960784314,.5529411765,.8980392156862745,.9960784314,.9960784314,.568627451,.9019607843137255,.9960784314,.9960784314,.5843137255,.9058823529411765,.9960784314,.9960784314,.6,.9098039215686274,.9960784314,.9960784314,.6156862745,.9137254901960784,.9960784314,.9960784314,.631372549,.9176470588235294,.9960784314,.9960784314,.6470588235,.9215686274509803,.9960784314,.9960784314,.6666666667,.9254901960784314,.9960784314,.9960784314,.6823529412,.9294117647058824,.9960784314,.9960784314,.6980392157,.9333333333333333,.9960784314,.9960784314,.7137254902,.9372549019607843,.9960784314,.9960784314,.7294117647,.9411764705882354,.9960784314,.9960784314,.7450980392,.9450980392156864,.9960784314,.9960784314,.7568627451,.9490196078431372,.9960784314,.9960784314,.7725490196,.9529411764705882,.9960784314,.9960784314,.7882352941,.9568627450980394,.9960784314,.9960784314,.8039215686,.9607843137254903,.9960784314,.9960784314,.8196078431,.9647058823529413,.9960784314,.9960784314,.8352941176,.9686274509803922,.9960784314,.9960784314,.8509803922,.9725490196078431,.9960784314,.9960784314,.8666666667,.9764705882352941,.9960784314,.9960784314,.8823529412,.9803921568627451,.9960784314,.9960784314,.8980392157,.984313725490196,.9960784314,.9960784314,.9137254902,.9882352941176471,.9960784314,.9960784314,.9294117647,.9921568627450981,.9960784314,.9960784314,.9450980392,.996078431372549,.9960784314,.9960784314,.9607843137,1,.9960784314,.9960784314,.9607843137],description:"Hot Iron"},{ColorSpace:"RGB",Name:"red_hot",name:"red_hot",RGBPoints:[0,0,0,0,.00392156862745098,0,0,0,.00784313725490196,0,0,0,.011764705882352941,0,0,0,.01568627450980392,.0039215686,.0039215686,.0039215686,.0196078431372549,.0039215686,.0039215686,.0039215686,.023529411764705882,.0039215686,.0039215686,.0039215686,.027450980392156862,.0039215686,.0039215686,.0039215686,.03137254901960784,.0039215686,.0039215686,.0039215686,.03529411764705882,.0156862745,0,0,.0392156862745098,.0274509804,0,0,.043137254901960784,.0392156863,0,0,.047058823529411764,.0509803922,0,0,.050980392156862744,.062745098,0,0,.054901960784313725,.0784313725,0,0,.05882352941176471,.0901960784,0,0,.06274509803921569,.1058823529,0,0,.06666666666666667,.1176470588,0,0,.07058823529411765,.1294117647,0,0,.07450980392156863,.1411764706,0,0,.0784313725490196,.1529411765,0,0,.08235294117647059,.1647058824,0,0,.08627450980392157,.1764705882,0,0,.09019607843137255,.1882352941,0,0,.09411764705882353,.2039215686,0,0,.09803921568627451,.2156862745,0,0,.10196078431372549,.2274509804,0,0,.10588235294117647,.2392156863,0,0,.10980392156862745,.2549019608,0,0,.11372549019607843,.2666666667,0,0,.11764705882352942,.2784313725,0,0,.12156862745098039,.2901960784,0,0,.12549019607843137,.3058823529,0,0,.12941176470588237,.3176470588,0,0,.13333333333333333,.3294117647,0,0,.13725490196078433,.3411764706,0,0,.1411764705882353,.3529411765,0,0,.1450980392156863,.3647058824,0,0,.14901960784313725,.3764705882,0,0,.15294117647058825,.3882352941,0,0,.1568627450980392,.4039215686,0,0,.1607843137254902,.4156862745,0,0,.16470588235294117,.431372549,0,0,.16862745098039217,.4431372549,0,0,.17254901960784313,.4588235294,0,0,.17647058823529413,.4705882353,0,0,.1803921568627451,.4823529412,0,0,.1843137254901961,.4941176471,0,0,.18823529411764706,.5098039216,0,0,.19215686274509805,.5215686275,0,0,.19607843137254902,.5333333333,0,0,.2,.5450980392,0,0,.20392156862745098,.5568627451,0,0,.20784313725490197,.568627451,0,0,.21176470588235294,.5803921569,0,0,.21568627450980393,.5921568627,0,0,.2196078431372549,.6078431373,0,0,.2235294117647059,.6196078431,0,0,.22745098039215686,.631372549,0,0,.23137254901960785,.6431372549,0,0,.23529411764705885,.6588235294,0,0,.23921568627450984,.6705882353,0,0,.24313725490196078,.6823529412,0,0,.24705882352941178,.6941176471,0,0,.25098039215686274,.7098039216,0,0,.2549019607843137,.7215686275,0,0,.25882352941176473,.7333333333,0,0,.2627450980392157,.7450980392,0,0,.26666666666666666,.7568627451,0,0,.27058823529411763,.768627451,0,0,.27450980392156865,.7843137255,0,0,.2784313725490196,.7960784314,0,0,.2823529411764706,.8117647059,0,0,.28627450980392155,.8235294118,0,0,.2901960784313726,.8352941176,0,0,.29411764705882354,.8470588235,0,0,.2980392156862745,.862745098,0,0,.30196078431372547,.8745098039,0,0,.3058823529411765,.8862745098,0,0,.30980392156862746,.8980392157,0,0,.3137254901960784,.9137254902,0,0,.3176470588235294,.9254901961,0,0,.3215686274509804,.937254902,0,0,.3254901960784314,.9490196078,0,0,.32941176470588235,.9607843137,0,0,.3333333333333333,.968627451,0,0,.33725490196078434,.9803921569,.0039215686,0,.3411764705882353,.9882352941,.0078431373,0,.34509803921568627,1,.0117647059,0,.34901960784313724,1,.0235294118,0,.35294117647058826,1,.0352941176,0,.3568627450980392,1,.0470588235,0,.3607843137254902,1,.062745098,0,.36470588235294116,1,.0745098039,0,.3686274509803922,1,.0862745098,0,.37254901960784315,1,.0980392157,0,.3764705882352941,1,.1137254902,0,.3803921568627451,1,.1254901961,0,.3843137254901961,1,.137254902,0,.38823529411764707,1,.1490196078,0,.39215686274509803,1,.1647058824,0,.396078431372549,1,.1764705882,0,.4,1,.1882352941,0,.403921568627451,1,.2,0,.40784313725490196,1,.2156862745,0,.4117647058823529,1,.2274509804,0,.41568627450980394,1,.2392156863,0,.4196078431372549,1,.2509803922,0,.4235294117647059,1,.2666666667,0,.42745098039215684,1,.2784313725,0,.43137254901960786,1,.2901960784,0,.43529411764705883,1,.3019607843,0,.4392156862745098,1,.3176470588,0,.44313725490196076,1,.3294117647,0,.4470588235294118,1,.3411764706,0,.45098039215686275,1,.3529411765,0,.4549019607843137,1,.368627451,0,.4588235294117647,1,.3803921569,0,.4627450980392157,1,.3921568627,0,.4666666666666667,1,.4039215686,0,.4705882352941177,1,.4156862745,0,.4745098039215686,1,.4274509804,0,.4784313725490197,1,.4392156863,0,.48235294117647065,1,.4509803922,0,.48627450980392156,1,.4666666667,0,.49019607843137253,1,.4784313725,0,.49411764705882355,1,.4941176471,0,.4980392156862745,1,.5058823529,0,.5019607843137255,1,.5215686275,0,.5058823529411764,1,.5333333333,0,.5098039215686274,1,.5450980392,0,.5137254901960784,1,.5568627451,0,.5176470588235295,1,.568627451,0,.5215686274509804,1,.5803921569,0,.5254901960784314,1,.5921568627,0,.5294117647058824,1,.6039215686,0,.5333333333333333,1,.6196078431,0,.5372549019607843,1,.631372549,0,.5411764705882353,1,.6431372549,0,.5450980392156862,1,.6549019608,0,.5490196078431373,1,.6705882353,0,.5529411764705883,1,.6823529412,0,.5568627450980392,1,.6941176471,0,.5607843137254902,1,.7058823529,0,.5647058823529412,1,.7215686275,0,.5686274509803921,1,.7333333333,0,.5725490196078431,1,.7450980392,0,.5764705882352941,1,.7568627451,0,.5803921568627451,1,.7725490196,0,.5843137254901961,1,.7843137255,0,.5882352941176471,1,.7960784314,0,.592156862745098,1,.8078431373,0,.596078431372549,1,.8196078431,0,.6,1,.831372549,0,.6039215686274509,1,.8470588235,0,.6078431372549019,1,.8588235294,0,.611764705882353,1,.8745098039,0,.615686274509804,1,.8862745098,0,.6196078431372549,1,.8980392157,0,.6235294117647059,1,.9098039216,0,.6274509803921569,1,.9254901961,0,.6313725490196078,1,.937254902,0,.6352941176470588,1,.9490196078,0,.6392156862745098,1,.9607843137,0,.6431372549019608,1,.9764705882,0,.6470588235294118,1,.9803921569,.0039215686,.6509803921568628,1,.9882352941,.0117647059,.6549019607843137,1,.9921568627,.0156862745,.6588235294117647,1,1,.0235294118,.6627450980392157,1,1,.0352941176,.6666666666666666,1,1,.0470588235,.6705882352941176,1,1,.0588235294,.6745098039215687,1,1,.0745098039,.6784313725490196,1,1,.0862745098,.6823529411764706,1,1,.0980392157,.6862745098039216,1,1,.1098039216,.6901960784313725,1,1,.1254901961,.6941176470588235,1,1,.137254902,.6980392156862745,1,1,.1490196078,.7019607843137254,1,1,.1607843137,.7058823529411765,1,1,.1764705882,.7098039215686275,1,1,.1882352941,.7137254901960784,1,1,.2,.7176470588235294,1,1,.2117647059,.7215686274509804,1,1,.2274509804,.7254901960784313,1,1,.2392156863,.7294117647058823,1,1,.2509803922,.7333333333333333,1,1,.262745098,.7372549019607844,1,1,.2784313725,.7411764705882353,1,1,.2901960784,.7450980392156863,1,1,.3019607843,.7490196078431373,1,1,.3137254902,.7529411764705882,1,1,.3294117647,.7568627450980392,1,1,.3411764706,.7607843137254902,1,1,.3529411765,.7647058823529411,1,1,.3647058824,.7686274509803922,1,1,.3803921569,.7725490196078432,1,1,.3921568627,.7764705882352941,1,1,.4039215686,.7803921568627451,1,1,.4156862745,.7843137254901961,1,1,.431372549,.788235294117647,1,1,.4431372549,.792156862745098,1,1,.4549019608,.796078431372549,1,1,.4666666667,.8,1,1,.4784313725,.803921568627451,1,1,.4901960784,.807843137254902,1,1,.5019607843,.8117647058823529,1,1,.5137254902,.8156862745098039,1,1,.5294117647,.8196078431372549,1,1,.5411764706,.8235294117647058,1,1,.5568627451,.8274509803921568,1,1,.568627451,.8313725490196079,1,1,.5843137255,.8352941176470589,1,1,.5960784314,.8392156862745098,1,1,.6078431373,.8431372549019608,1,1,.6196078431,.8470588235294118,1,1,.631372549,.8509803921568627,1,1,.6431372549,.8549019607843137,1,1,.6549019608,.8588235294117647,1,1,.6666666667,.8627450980392157,1,1,.6823529412,.8666666666666667,1,1,.6941176471,.8705882352941177,1,1,.7058823529,.8745098039215686,1,1,.7176470588,.8784313725490196,1,1,.7333333333,.8823529411764706,1,1,.7450980392,.8862745098039215,1,1,.7568627451,.8901960784313725,1,1,.768627451,.8941176470588236,1,1,.7843137255,.8980392156862745,1,1,.7960784314,.9019607843137255,1,1,.8078431373,.9058823529411765,1,1,.8196078431,.9098039215686274,1,1,.8352941176,.9137254901960784,1,1,.8470588235,.9176470588235294,1,1,.8588235294,.9215686274509803,1,1,.8705882353,.9254901960784314,1,1,.8823529412,.9294117647058824,1,1,.8941176471,.9333333333333333,1,1,.9098039216,.9372549019607843,1,1,.9215686275,.9411764705882354,1,1,.937254902,.9450980392156864,1,1,.9490196078,.9490196078431372,1,1,.9607843137,.9529411764705882,1,1,.9725490196,.9568627450980394,1,1,.9882352941,.9607843137254903,1,1,.9882352941,.9647058823529413,1,1,.9921568627,.9686274509803922,1,1,.9960784314,.9725490196078431,1,1,1,.9764705882352941,1,1,1,.9803921568627451,1,1,1,.984313725490196,1,1,1,.9882352941176471,1,1,1,.9921568627450981,1,1,1,.996078431372549,1,1,1,1,1,1,1],description:"Red Hot"},{ColorSpace:"RGB",Name:"s_pet",name:"s_pet",RGBPoints:[0,.0156862745,.0039215686,.0156862745,.00392156862745098,.0156862745,.0039215686,.0156862745,.00784313725490196,.0274509804,.0039215686,.031372549,.011764705882352941,.0352941176,.0039215686,.0509803922,.01568627450980392,.0392156863,.0039215686,.0666666667,.0196078431372549,.0509803922,.0039215686,.0823529412,.023529411764705882,.062745098,.0039215686,.0980392157,.027450980392156862,.0705882353,.0039215686,.1176470588,.03137254901960784,.0745098039,.0039215686,.1333333333,.03529411764705882,.0862745098,.0039215686,.1490196078,.0392156862745098,.0980392157,.0039215686,.1647058824,.043137254901960784,.1058823529,.0039215686,.1843137255,.047058823529411764,.1098039216,.0039215686,.2,.050980392156862744,.1215686275,.0039215686,.2156862745,.054901960784313725,.1333333333,.0039215686,.231372549,.05882352941176471,.137254902,.0039215686,.2509803922,.06274509803921569,.1490196078,.0039215686,.262745098,.06666666666666667,.1607843137,.0039215686,.2784313725,.07058823529411765,.168627451,.0039215686,.2941176471,.07450980392156863,.1725490196,.0039215686,.3137254902,.0784313725490196,.1843137255,.0039215686,.3294117647,.08235294117647059,.1960784314,.0039215686,.3450980392,.08627450980392157,.2039215686,.0039215686,.3607843137,.09019607843137255,.2078431373,.0039215686,.3803921569,.09411764705882353,.2196078431,.0039215686,.3960784314,.09803921568627451,.231372549,.0039215686,.4117647059,.10196078431372549,.2392156863,.0039215686,.4274509804,.10588235294117647,.2431372549,.0039215686,.4470588235,.10980392156862745,.2509803922,.0039215686,.462745098,.11372549019607843,.262745098,.0039215686,.4784313725,.11764705882352942,.2666666667,.0039215686,.4980392157,.12156862745098039,.2666666667,.0039215686,.4980392157,.12549019607843137,.262745098,.0039215686,.5137254902,.12941176470588237,.2509803922,.0039215686,.5294117647,.13333333333333333,.2431372549,.0039215686,.5450980392,.13725490196078433,.2392156863,.0039215686,.5607843137,.1411764705882353,.231372549,.0039215686,.5764705882,.1450980392156863,.2196078431,.0039215686,.5921568627,.14901960784313725,.2078431373,.0039215686,.6078431373,.15294117647058825,.2039215686,.0039215686,.6235294118,.1568627450980392,.1960784314,.0039215686,.6392156863,.1607843137254902,.1843137255,.0039215686,.6549019608,.16470588235294117,.1725490196,.0039215686,.6705882353,.16862745098039217,.168627451,.0039215686,.6862745098,.17254901960784313,.1607843137,.0039215686,.7019607843,.17647058823529413,.1490196078,.0039215686,.7176470588,.1803921568627451,.137254902,.0039215686,.7333333333,.1843137254901961,.1333333333,.0039215686,.7490196078,.18823529411764706,.1215686275,.0039215686,.7607843137,.19215686274509805,.1098039216,.0039215686,.7764705882,.19607843137254902,.1058823529,.0039215686,.7921568627,.2,.0980392157,.0039215686,.8078431373,.20392156862745098,.0862745098,.0039215686,.8235294118,.20784313725490197,.0745098039,.0039215686,.8392156863,.21176470588235294,.0705882353,.0039215686,.8549019608,.21568627450980393,.062745098,.0039215686,.8705882353,.2196078431372549,.0509803922,.0039215686,.8862745098,.2235294117647059,.0392156863,.0039215686,.9019607843,.22745098039215686,.0352941176,.0039215686,.9176470588,.23137254901960785,.0274509804,.0039215686,.9333333333,.23529411764705885,.0156862745,.0039215686,.9490196078,.23921568627450984,.0078431373,.0039215686,.9647058824,.24313725490196078,.0039215686,.0039215686,.9960784314,.24705882352941178,.0039215686,.0039215686,.9960784314,.25098039215686274,.0039215686,.0196078431,.9647058824,.2549019607843137,.0039215686,.0392156863,.9490196078,.25882352941176473,.0039215686,.0549019608,.9333333333,.2627450980392157,.0039215686,.0745098039,.9176470588,.26666666666666666,.0039215686,.0901960784,.9019607843,.27058823529411763,.0039215686,.1098039216,.8862745098,.27450980392156865,.0039215686,.1254901961,.8705882353,.2784313725490196,.0039215686,.1450980392,.8549019608,.2823529411764706,.0039215686,.1607843137,.8392156863,.28627450980392155,.0039215686,.1803921569,.8235294118,.2901960784313726,.0039215686,.1960784314,.8078431373,.29411764705882354,.0039215686,.2156862745,.7921568627,.2980392156862745,.0039215686,.231372549,.7764705882,.30196078431372547,.0039215686,.2509803922,.7607843137,.3058823529411765,.0039215686,.262745098,.7490196078,.30980392156862746,.0039215686,.2823529412,.7333333333,.3137254901960784,.0039215686,.2980392157,.7176470588,.3176470588235294,.0039215686,.3176470588,.7019607843,.3215686274509804,.0039215686,.3333333333,.6862745098,.3254901960784314,.0039215686,.3529411765,.6705882353,.32941176470588235,.0039215686,.368627451,.6549019608,.3333333333333333,.0039215686,.3882352941,.6392156863,.33725490196078434,.0039215686,.4039215686,.6235294118,.3411764705882353,.0039215686,.4235294118,.6078431373,.34509803921568627,.0039215686,.4392156863,.5921568627,.34901960784313724,.0039215686,.4588235294,.5764705882,.35294117647058826,.0039215686,.4745098039,.5607843137,.3568627450980392,.0039215686,.4941176471,.5450980392,.3607843137254902,.0039215686,.5098039216,.5294117647,.36470588235294116,.0039215686,.5294117647,.5137254902,.3686274509803922,.0039215686,.5450980392,.4980392157,.37254901960784315,.0039215686,.5647058824,.4784313725,.3764705882352941,.0039215686,.5803921569,.462745098,.3803921568627451,.0039215686,.6,.4470588235,.3843137254901961,.0039215686,.6156862745,.4274509804,.38823529411764707,.0039215686,.6352941176,.4117647059,.39215686274509803,.0039215686,.6509803922,.3960784314,.396078431372549,.0039215686,.6705882353,.3803921569,.4,.0039215686,.6862745098,.3607843137,.403921568627451,.0039215686,.7058823529,.3450980392,.40784313725490196,.0039215686,.7215686275,.3294117647,.4117647058823529,.0039215686,.7411764706,.3137254902,.41568627450980394,.0039215686,.7529411765,.2941176471,.4196078431372549,.0039215686,.7960784314,.2784313725,.4235294117647059,.0039215686,.7960784314,.262745098,.42745098039215684,.0392156863,.8039215686,.2509803922,.43137254901960786,.0745098039,.8117647059,.231372549,.43529411764705883,.1098039216,.8196078431,.2156862745,.4392156862745098,.1450980392,.8274509804,.2,.44313725490196076,.1803921569,.8352941176,.1843137255,.4470588235294118,.2156862745,.8431372549,.1647058824,.45098039215686275,.2509803922,.8509803922,.1490196078,.4549019607843137,.2823529412,.8588235294,.1333333333,.4588235294117647,.3176470588,.8666666667,.1176470588,.4627450980392157,.3529411765,.8745098039,.0980392157,.4666666666666667,.3882352941,.8823529412,.0823529412,.4705882352941177,.4235294118,.8901960784,.0666666667,.4745098039215686,.4588235294,.8980392157,.0509803922,.4784313725490197,.4941176471,.9058823529,.0431372549,.48235294117647065,.5294117647,.9137254902,.031372549,.48627450980392156,.5647058824,.9215686275,.0196078431,.49019607843137253,.6,.9294117647,.0078431373,.49411764705882355,.6352941176,.937254902,.0039215686,.4980392156862745,.6705882353,.9450980392,.0039215686,.5019607843137255,.7058823529,.9490196078,.0039215686,.5058823529411764,.7411764706,.9568627451,.0039215686,.5098039215686274,.7725490196,.9607843137,.0039215686,.5137254901960784,.8078431373,.968627451,.0039215686,.5176470588235295,.8431372549,.9725490196,.0039215686,.5215686274509804,.8784313725,.9803921569,.0039215686,.5254901960784314,.9137254902,.9843137255,.0039215686,.5294117647058824,.9490196078,.9921568627,.0039215686,.5333333333333333,.9960784314,.9960784314,.0039215686,.5372549019607843,.9960784314,.9960784314,.0039215686,.5411764705882353,.9960784314,.9921568627,.0039215686,.5450980392156862,.9960784314,.9843137255,.0039215686,.5490196078431373,.9960784314,.9764705882,.0039215686,.5529411764705883,.9960784314,.968627451,.0039215686,.5568627450980392,.9960784314,.9607843137,.0039215686,.5607843137254902,.9960784314,.9529411765,.0039215686,.5647058823529412,.9960784314,.9450980392,.0039215686,.5686274509803921,.9960784314,.937254902,.0039215686,.5725490196078431,.9960784314,.9294117647,.0039215686,.5764705882352941,.9960784314,.9215686275,.0039215686,.5803921568627451,.9960784314,.9137254902,.0039215686,.5843137254901961,.9960784314,.9058823529,.0039215686,.5882352941176471,.9960784314,.8980392157,.0039215686,.592156862745098,.9960784314,.8901960784,.0039215686,.596078431372549,.9960784314,.8823529412,.0039215686,.6,.9960784314,.8745098039,.0039215686,.6039215686274509,.9960784314,.8666666667,.0039215686,.6078431372549019,.9960784314,.8588235294,.0039215686,.611764705882353,.9960784314,.8509803922,.0039215686,.615686274509804,.9960784314,.8431372549,.0039215686,.6196078431372549,.9960784314,.8352941176,.0039215686,.6235294117647059,.9960784314,.8274509804,.0039215686,.6274509803921569,.9960784314,.8196078431,.0039215686,.6313725490196078,.9960784314,.8117647059,.0039215686,.6352941176470588,.9960784314,.8039215686,.0039215686,.6392156862745098,.9960784314,.7960784314,.0039215686,.6431372549019608,.9960784314,.7882352941,.0039215686,.6470588235294118,.9960784314,.7803921569,.0039215686,.6509803921568628,.9960784314,.7725490196,.0039215686,.6549019607843137,.9960784314,.7647058824,.0039215686,.6588235294117647,.9960784314,.7568627451,.0039215686,.6627450980392157,.9960784314,.7490196078,.0039215686,.6666666666666666,.9960784314,.7450980392,.0039215686,.6705882352941176,.9960784314,.737254902,.0039215686,.6745098039215687,.9960784314,.7294117647,.0039215686,.6784313725490196,.9960784314,.7215686275,.0039215686,.6823529411764706,.9960784314,.7137254902,.0039215686,.6862745098039216,.9960784314,.7058823529,.0039215686,.6901960784313725,.9960784314,.6980392157,.0039215686,.6941176470588235,.9960784314,.6901960784,.0039215686,.6980392156862745,.9960784314,.6823529412,.0039215686,.7019607843137254,.9960784314,.6745098039,.0039215686,.7058823529411765,.9960784314,.6666666667,.0039215686,.7098039215686275,.9960784314,.6588235294,.0039215686,.7137254901960784,.9960784314,.6509803922,.0039215686,.7176470588235294,.9960784314,.6431372549,.0039215686,.7215686274509804,.9960784314,.6352941176,.0039215686,.7254901960784313,.9960784314,.6274509804,.0039215686,.7294117647058823,.9960784314,.6196078431,.0039215686,.7333333333333333,.9960784314,.6117647059,.0039215686,.7372549019607844,.9960784314,.6039215686,.0039215686,.7411764705882353,.9960784314,.5960784314,.0039215686,.7450980392156863,.9960784314,.5882352941,.0039215686,.7490196078431373,.9960784314,.5803921569,.0039215686,.7529411764705882,.9960784314,.5725490196,.0039215686,.7568627450980392,.9960784314,.5647058824,.0039215686,.7607843137254902,.9960784314,.5568627451,.0039215686,.7647058823529411,.9960784314,.5490196078,.0039215686,.7686274509803922,.9960784314,.5411764706,.0039215686,.7725490196078432,.9960784314,.5333333333,.0039215686,.7764705882352941,.9960784314,.5254901961,.0039215686,.7803921568627451,.9960784314,.5176470588,.0039215686,.7843137254901961,.9960784314,.5098039216,.0039215686,.788235294117647,.9960784314,.5019607843,.0039215686,.792156862745098,.9960784314,.4941176471,.0039215686,.796078431372549,.9960784314,.4862745098,.0039215686,.8,.9960784314,.4784313725,.0039215686,.803921568627451,.9960784314,.4705882353,.0039215686,.807843137254902,.9960784314,.462745098,.0039215686,.8117647058823529,.9960784314,.4549019608,.0039215686,.8156862745098039,.9960784314,.4470588235,.0039215686,.8196078431372549,.9960784314,.4392156863,.0039215686,.8235294117647058,.9960784314,.431372549,.0039215686,.8274509803921568,.9960784314,.4235294118,.0039215686,.8313725490196079,.9960784314,.4156862745,.0039215686,.8352941176470589,.9960784314,.4078431373,.0039215686,.8392156862745098,.9960784314,.4,.0039215686,.8431372549019608,.9960784314,.3921568627,.0039215686,.8470588235294118,.9960784314,.3843137255,.0039215686,.8509803921568627,.9960784314,.3764705882,.0039215686,.8549019607843137,.9960784314,.368627451,.0039215686,.8588235294117647,.9960784314,.3607843137,.0039215686,.8627450980392157,.9960784314,.3529411765,.0039215686,.8666666666666667,.9960784314,.3450980392,.0039215686,.8705882352941177,.9960784314,.337254902,.0039215686,.8745098039215686,.9960784314,.3294117647,.0039215686,.8784313725490196,.9960784314,.3215686275,.0039215686,.8823529411764706,.9960784314,.3137254902,.0039215686,.8862745098039215,.9960784314,.3058823529,.0039215686,.8901960784313725,.9960784314,.2980392157,.0039215686,.8941176470588236,.9960784314,.2901960784,.0039215686,.8980392156862745,.9960784314,.2823529412,.0039215686,.9019607843137255,.9960784314,.2705882353,.0039215686,.9058823529411765,.9960784314,.2588235294,.0039215686,.9098039215686274,.9960784314,.2509803922,.0039215686,.9137254901960784,.9960784314,.2431372549,.0039215686,.9176470588235294,.9960784314,.231372549,.0039215686,.9215686274509803,.9960784314,.2196078431,.0039215686,.9254901960784314,.9960784314,.2117647059,.0039215686,.9294117647058824,.9960784314,.2,.0039215686,.9333333333333333,.9960784314,.1882352941,.0039215686,.9372549019607843,.9960784314,.1764705882,.0039215686,.9411764705882354,.9960784314,.168627451,.0039215686,.9450980392156864,.9960784314,.1568627451,.0039215686,.9490196078431372,.9960784314,.1450980392,.0039215686,.9529411764705882,.9960784314,.1333333333,.0039215686,.9568627450980394,.9960784314,.1254901961,.0039215686,.9607843137254903,.9960784314,.1137254902,.0039215686,.9647058823529413,.9960784314,.1019607843,.0039215686,.9686274509803922,.9960784314,.0901960784,.0039215686,.9725490196078431,.9960784314,.0823529412,.0039215686,.9764705882352941,.9960784314,.0705882353,.0039215686,.9803921568627451,.9960784314,.0588235294,.0039215686,.984313725490196,.9960784314,.0470588235,.0039215686,.9882352941176471,.9960784314,.0392156863,.0039215686,.9921568627450981,.9960784314,.0274509804,.0039215686,.996078431372549,.9960784314,.0156862745,.0039215686,1,.9960784314,.0156862745,.0039215686],description:"S PET"},{ColorSpace:"RGB",Name:"perfusion",name:"perfusion",RGBPoints:[0,0,0,0,.00392156862745098,.0078431373,.0235294118,.0235294118,.00784313725490196,.0078431373,.031372549,.0470588235,.011764705882352941,.0078431373,.0392156863,.062745098,.01568627450980392,.0078431373,.0470588235,.0862745098,.0196078431372549,.0078431373,.0549019608,.1019607843,.023529411764705882,.0078431373,.0549019608,.1254901961,.027450980392156862,.0078431373,.062745098,.1411764706,.03137254901960784,.0078431373,.0705882353,.1647058824,.03529411764705882,.0078431373,.0784313725,.1803921569,.0392156862745098,.0078431373,.0862745098,.2039215686,.043137254901960784,.0078431373,.0862745098,.2196078431,.047058823529411764,.0078431373,.0941176471,.2431372549,.050980392156862744,.0078431373,.1019607843,.2666666667,.054901960784313725,.0078431373,.1098039216,.2823529412,.05882352941176471,.0078431373,.1176470588,.3058823529,.06274509803921569,.0078431373,.1176470588,.3215686275,.06666666666666667,.0078431373,.1254901961,.3450980392,.07058823529411765,.0078431373,.1333333333,.3607843137,.07450980392156863,.0078431373,.1411764706,.3843137255,.0784313725490196,.0078431373,.1490196078,.4,.08235294117647059,.0078431373,.1490196078,.4235294118,.08627450980392157,.0078431373,.1568627451,.4392156863,.09019607843137255,.0078431373,.1647058824,.462745098,.09411764705882353,.0078431373,.1725490196,.4784313725,.09803921568627451,.0078431373,.1803921569,.5019607843,.10196078431372549,.0078431373,.1803921569,.5254901961,.10588235294117647,.0078431373,.1882352941,.5411764706,.10980392156862745,.0078431373,.1960784314,.5647058824,.11372549019607843,.0078431373,.2039215686,.5803921569,.11764705882352942,.0078431373,.2117647059,.6039215686,.12156862745098039,.0078431373,.2117647059,.6196078431,.12549019607843137,.0078431373,.2196078431,.6431372549,.12941176470588237,.0078431373,.2274509804,.6588235294,.13333333333333333,.0078431373,.2352941176,.6823529412,.13725490196078433,.0078431373,.2431372549,.6980392157,.1411764705882353,.0078431373,.2431372549,.7215686275,.1450980392156863,.0078431373,.2509803922,.737254902,.14901960784313725,.0078431373,.2588235294,.7607843137,.15294117647058825,.0078431373,.2666666667,.7843137255,.1568627450980392,.0078431373,.2745098039,.8,.1607843137254902,.0078431373,.2745098039,.8235294118,.16470588235294117,.0078431373,.2823529412,.8392156863,.16862745098039217,.0078431373,.2901960784,.862745098,.17254901960784313,.0078431373,.2980392157,.8784313725,.17647058823529413,.0078431373,.3058823529,.9019607843,.1803921568627451,.0078431373,.3058823529,.9176470588,.1843137254901961,.0078431373,.2980392157,.9411764706,.18823529411764706,.0078431373,.3058823529,.9568627451,.19215686274509805,.0078431373,.2980392157,.9803921569,.19607843137254902,.0078431373,.2980392157,.9882352941,.2,.0078431373,.2901960784,.9803921569,.20392156862745098,.0078431373,.2901960784,.9647058824,.20784313725490197,.0078431373,.2823529412,.9568627451,.21176470588235294,.0078431373,.2823529412,.9411764706,.21568627450980393,.0078431373,.2745098039,.9333333333,.2196078431372549,.0078431373,.2666666667,.9176470588,.2235294117647059,.0078431373,.2666666667,.9098039216,.22745098039215686,.0078431373,.2588235294,.9019607843,.23137254901960785,.0078431373,.2588235294,.8862745098,.23529411764705885,.0078431373,.2509803922,.8784313725,.23921568627450984,.0078431373,.2509803922,.862745098,.24313725490196078,.0078431373,.2431372549,.8549019608,.24705882352941178,.0078431373,.2352941176,.8392156863,.25098039215686274,.0078431373,.2352941176,.831372549,.2549019607843137,.0078431373,.2274509804,.8235294118,.25882352941176473,.0078431373,.2274509804,.8078431373,.2627450980392157,.0078431373,.2196078431,.8,.26666666666666666,.0078431373,.2196078431,.7843137255,.27058823529411763,.0078431373,.2117647059,.7764705882,.27450980392156865,.0078431373,.2039215686,.7607843137,.2784313725490196,.0078431373,.2039215686,.7529411765,.2823529411764706,.0078431373,.1960784314,.7450980392,.28627450980392155,.0078431373,.1960784314,.7294117647,.2901960784313726,.0078431373,.1882352941,.7215686275,.29411764705882354,.0078431373,.1882352941,.7058823529,.2980392156862745,.0078431373,.1803921569,.6980392157,.30196078431372547,.0078431373,.1803921569,.6823529412,.3058823529411765,.0078431373,.1725490196,.6745098039,.30980392156862746,.0078431373,.1647058824,.6666666667,.3137254901960784,.0078431373,.1647058824,.6509803922,.3176470588235294,.0078431373,.1568627451,.6431372549,.3215686274509804,.0078431373,.1568627451,.6274509804,.3254901960784314,.0078431373,.1490196078,.6196078431,.32941176470588235,.0078431373,.1490196078,.6039215686,.3333333333333333,.0078431373,.1411764706,.5960784314,.33725490196078434,.0078431373,.1333333333,.5882352941,.3411764705882353,.0078431373,.1333333333,.5725490196,.34509803921568627,.0078431373,.1254901961,.5647058824,.34901960784313724,.0078431373,.1254901961,.5490196078,.35294117647058826,.0078431373,.1176470588,.5411764706,.3568627450980392,.0078431373,.1176470588,.5254901961,.3607843137254902,.0078431373,.1098039216,.5176470588,.36470588235294116,.0078431373,.1019607843,.5098039216,.3686274509803922,.0078431373,.1019607843,.4941176471,.37254901960784315,.0078431373,.0941176471,.4862745098,.3764705882352941,.0078431373,.0941176471,.4705882353,.3803921568627451,.0078431373,.0862745098,.462745098,.3843137254901961,.0078431373,.0862745098,.4470588235,.38823529411764707,.0078431373,.0784313725,.4392156863,.39215686274509803,.0078431373,.0705882353,.431372549,.396078431372549,.0078431373,.0705882353,.4156862745,.4,.0078431373,.062745098,.4078431373,.403921568627451,.0078431373,.062745098,.3921568627,.40784313725490196,.0078431373,.0549019608,.3843137255,.4117647058823529,.0078431373,.0549019608,.368627451,.41568627450980394,.0078431373,.0470588235,.3607843137,.4196078431372549,.0078431373,.0470588235,.3529411765,.4235294117647059,.0078431373,.0392156863,.337254902,.42745098039215684,.0078431373,.031372549,.3294117647,.43137254901960786,.0078431373,.031372549,.3137254902,.43529411764705883,.0078431373,.0235294118,.3058823529,.4392156862745098,.0078431373,.0235294118,.2901960784,.44313725490196076,.0078431373,.0156862745,.2823529412,.4470588235294118,.0078431373,.0156862745,.2745098039,.45098039215686275,.0078431373,.0078431373,.2588235294,.4549019607843137,.0235294118,.0078431373,.2509803922,.4588235294117647,.0078431373,.0078431373,.2352941176,.4627450980392157,.0078431373,.0078431373,.2274509804,.4666666666666667,.0078431373,.0078431373,.2117647059,.4705882352941177,.0078431373,.0078431373,.2039215686,.4745098039215686,.0078431373,.0078431373,.1960784314,.4784313725490197,.0078431373,.0078431373,.1803921569,.48235294117647065,.0078431373,.0078431373,.1725490196,.48627450980392156,.0078431373,.0078431373,.1568627451,.49019607843137253,.0078431373,.0078431373,.1490196078,.49411764705882355,.0078431373,.0078431373,.1333333333,.4980392156862745,.0078431373,.0078431373,.1254901961,.5019607843137255,.0078431373,.0078431373,.1176470588,.5058823529411764,.0078431373,.0078431373,.1019607843,.5098039215686274,.0078431373,.0078431373,.0941176471,.5137254901960784,.0078431373,.0078431373,.0784313725,.5176470588235295,.0078431373,.0078431373,.0705882353,.5215686274509804,.0078431373,.0078431373,.0549019608,.5254901960784314,.0078431373,.0078431373,.0470588235,.5294117647058824,.0235294118,.0078431373,.0392156863,.5333333333333333,.031372549,.0078431373,.0235294118,.5372549019607843,.0392156863,.0078431373,.0156862745,.5411764705882353,.0549019608,.0078431373,0,.5450980392156862,.062745098,.0078431373,0,.5490196078431373,.0705882353,.0078431373,0,.5529411764705883,.0862745098,.0078431373,0,.5568627450980392,.0941176471,.0078431373,0,.5607843137254902,.1019607843,.0078431373,0,.5647058823529412,.1098039216,.0078431373,0,.5686274509803921,.1254901961,.0078431373,0,.5725490196078431,.1333333333,.0078431373,0,.5764705882352941,.1411764706,.0078431373,0,.5803921568627451,.1568627451,.0078431373,0,.5843137254901961,.1647058824,.0078431373,0,.5882352941176471,.1725490196,.0078431373,0,.592156862745098,.1882352941,.0078431373,0,.596078431372549,.1960784314,.0078431373,0,.6,.2039215686,.0078431373,0,.6039215686274509,.2117647059,.0078431373,0,.6078431372549019,.2274509804,.0078431373,0,.611764705882353,.2352941176,.0078431373,0,.615686274509804,.2431372549,.0078431373,0,.6196078431372549,.2588235294,.0078431373,0,.6235294117647059,.2666666667,.0078431373,0,.6274509803921569,.2745098039,0,0,.6313725490196078,.2901960784,.0156862745,0,.6352941176470588,.2980392157,.0235294118,0,.6392156862745098,.3058823529,.0392156863,0,.6431372549019608,.3137254902,.0470588235,0,.6470588235294118,.3294117647,.0549019608,0,.6509803921568628,.337254902,.0705882353,0,.6549019607843137,.3450980392,.0784313725,0,.6588235294117647,.3607843137,.0862745098,0,.6627450980392157,.368627451,.1019607843,0,.6666666666666666,.3764705882,.1098039216,0,.6705882352941176,.3843137255,.1176470588,0,.6745098039215687,.4,.1333333333,0,.6784313725490196,.4078431373,.1411764706,0,.6823529411764706,.4156862745,.1490196078,0,.6862745098039216,.431372549,.1647058824,0,.6901960784313725,.4392156863,.1725490196,0,.6941176470588235,.4470588235,.1803921569,0,.6980392156862745,.462745098,.1960784314,0,.7019607843137254,.4705882353,.2039215686,0,.7058823529411765,.4784313725,.2117647059,0,.7098039215686275,.4862745098,.2274509804,0,.7137254901960784,.5019607843,.2352941176,0,.7176470588235294,.5098039216,.2431372549,0,.7215686274509804,.5176470588,.2588235294,0,.7254901960784313,.5333333333,.2666666667,0,.7294117647058823,.5411764706,.2745098039,0,.7333333333333333,.5490196078,.2901960784,0,.7372549019607844,.5647058824,.2980392157,0,.7411764705882353,.5725490196,.3058823529,0,.7450980392156863,.5803921569,.3215686275,0,.7490196078431373,.5882352941,.3294117647,0,.7529411764705882,.6039215686,.337254902,0,.7568627450980392,.6117647059,.3529411765,0,.7607843137254902,.6196078431,.3607843137,0,.7647058823529411,.6352941176,.368627451,0,.7686274509803922,.6431372549,.3843137255,0,.7725490196078432,.6509803922,.3921568627,0,.7764705882352941,.6588235294,.4,0,.7803921568627451,.6745098039,.4156862745,0,.7843137254901961,.6823529412,.4235294118,0,.788235294117647,.6901960784,.431372549,0,.792156862745098,.7058823529,.4470588235,0,.796078431372549,.7137254902,.4549019608,0,.8,.7215686275,.462745098,0,.803921568627451,.737254902,.4784313725,0,.807843137254902,.7450980392,.4862745098,0,.8117647058823529,.7529411765,.4941176471,0,.8156862745098039,.7607843137,.5098039216,0,.8196078431372549,.7764705882,.5176470588,0,.8235294117647058,.7843137255,.5254901961,0,.8274509803921568,.7921568627,.5411764706,0,.8313725490196079,.8078431373,.5490196078,0,.8352941176470589,.8156862745,.5568627451,0,.8392156862745098,.8235294118,.5725490196,0,.8431372549019608,.8392156863,.5803921569,0,.8470588235294118,.8470588235,.5882352941,0,.8509803921568627,.8549019608,.6039215686,0,.8549019607843137,.862745098,.6117647059,0,.8588235294117647,.8784313725,.6196078431,0,.8627450980392157,.8862745098,.6352941176,0,.8666666666666667,.8941176471,.6431372549,0,.8705882352941177,.9098039216,.6509803922,0,.8745098039215686,.9176470588,.6666666667,0,.8784313725490196,.9254901961,.6745098039,0,.8823529411764706,.9411764706,.6823529412,0,.8862745098039215,.9490196078,.6980392157,0,.8901960784313725,.9568627451,.7058823529,0,.8941176470588236,.9647058824,.7137254902,0,.8980392156862745,.9803921569,.7294117647,0,.9019607843137255,.9882352941,.737254902,0,.9058823529411765,.9960784314,.7450980392,0,.9098039215686274,.9960784314,.7607843137,0,.9137254901960784,.9960784314,.768627451,0,.9176470588235294,.9960784314,.7764705882,0,.9215686274509803,.9960784314,.7921568627,0,.9254901960784314,.9960784314,.8,0,.9294117647058824,.9960784314,.8078431373,0,.9333333333333333,.9960784314,.8235294118,0,.9372549019607843,.9960784314,.831372549,0,.9411764705882354,.9960784314,.8392156863,0,.9450980392156864,.9960784314,.8549019608,0,.9490196078431372,.9960784314,.862745098,.0549019608,.9529411764705882,.9960784314,.8705882353,.1098039216,.9568627450980394,.9960784314,.8862745098,.1647058824,.9607843137254903,.9960784314,.8941176471,.2196078431,.9647058823529413,.9960784314,.9019607843,.2666666667,.9686274509803922,.9960784314,.9176470588,.3215686275,.9725490196078431,.9960784314,.9254901961,.3764705882,.9764705882352941,.9960784314,.9333333333,.431372549,.9803921568627451,.9960784314,.9490196078,.4862745098,.984313725490196,.9960784314,.9568627451,.5333333333,.9882352941176471,.9960784314,.9647058824,.5882352941,.9921568627450981,.9960784314,.9803921569,.6431372549,.996078431372549,.9960784314,.9882352941,.6980392157,1,.9960784314,.9960784314,.7450980392],description:"Perfusion"},{ColorSpace:"RGB",Name:"rainbow_2",name:"rainbow_2",RGBPoints:[0,0,0,0,.00392156862745098,.0156862745,0,.0117647059,.00784313725490196,.0352941176,0,.0274509804,.011764705882352941,.0509803922,0,.0392156863,.01568627450980392,.0705882353,0,.0549019608,.0196078431372549,.0862745098,0,.0745098039,.023529411764705882,.1058823529,0,.0901960784,.027450980392156862,.1215686275,0,.1098039216,.03137254901960784,.1411764706,0,.1254901961,.03529411764705882,.1568627451,0,.1490196078,.0392156862745098,.1764705882,0,.168627451,.043137254901960784,.1960784314,0,.1882352941,.047058823529411764,.2117647059,0,.2078431373,.050980392156862744,.2274509804,0,.231372549,.054901960784313725,.2392156863,0,.2470588235,.05882352941176471,.2509803922,0,.2666666667,.06274509803921569,.2666666667,0,.2823529412,.06666666666666667,.2705882353,0,.3019607843,.07058823529411765,.2823529412,0,.3176470588,.07450980392156863,.2901960784,0,.337254902,.0784313725490196,.3019607843,0,.3568627451,.08235294117647059,.3098039216,0,.3725490196,.08627450980392157,.3137254902,0,.3921568627,.09019607843137255,.3215686275,0,.4078431373,.09411764705882353,.3254901961,0,.4274509804,.09803921568627451,.3333333333,0,.4431372549,.10196078431372549,.3294117647,0,.462745098,.10588235294117647,.337254902,0,.4784313725,.10980392156862745,.3411764706,0,.4980392157,.11372549019607843,.3450980392,0,.5176470588,.11764705882352942,.337254902,0,.5333333333,.12156862745098039,.3411764706,0,.5529411765,.12549019607843137,.3411764706,0,.568627451,.12941176470588237,.3411764706,0,.5882352941,.13333333333333333,.3333333333,0,.6039215686,.13725490196078433,.3294117647,0,.6235294118,.1411764705882353,.3294117647,0,.6392156863,.1450980392156863,.3294117647,0,.6588235294,.14901960784313725,.3254901961,0,.6784313725,.15294117647058825,.3098039216,0,.6941176471,.1568627450980392,.3058823529,0,.7137254902,.1607843137254902,.3019607843,0,.7294117647,.16470588235294117,.2980392157,0,.7490196078,.16862745098039217,.2784313725,0,.7647058824,.17254901960784313,.2745098039,0,.7843137255,.17647058823529413,.2666666667,0,.8,.1803921568627451,.2588235294,0,.8196078431,.1843137254901961,.2352941176,0,.8392156863,.18823529411764706,.2274509804,0,.8549019608,.19215686274509805,.2156862745,0,.8745098039,.19607843137254902,.2078431373,0,.8901960784,.2,.1803921569,0,.9098039216,.20392156862745098,.168627451,0,.9254901961,.20784313725490197,.1568627451,0,.9450980392,.21176470588235294,.1411764706,0,.9607843137,.21568627450980393,.1294117647,0,.9803921569,.2196078431372549,.0980392157,0,1,.2235294117647059,.0823529412,0,1,.22745098039215686,.062745098,0,1,.23137254901960785,.0470588235,0,1,.23529411764705885,.0156862745,0,1,.23921568627450984,0,0,1,.24313725490196078,0,.0156862745,1,.24705882352941178,0,.031372549,1,.25098039215686274,0,.062745098,1,.2549019607843137,0,.0823529412,1,.25882352941176473,0,.0980392157,1,.2627450980392157,0,.1137254902,1,.26666666666666666,0,.1490196078,1,.27058823529411763,0,.1647058824,1,.27450980392156865,0,.1803921569,1,.2784313725490196,0,.2,1,.2823529411764706,0,.2156862745,1,.28627450980392155,0,.2470588235,1,.2901960784313726,0,.262745098,1,.29411764705882354,0,.2823529412,1,.2980392156862745,0,.2980392157,1,.30196078431372547,0,.3294117647,1,.3058823529411765,0,.3490196078,1,.30980392156862746,0,.3647058824,1,.3137254901960784,0,.3803921569,1,.3176470588235294,0,.4156862745,1,.3215686274509804,0,.431372549,1,.3254901960784314,0,.4470588235,1,.32941176470588235,0,.4666666667,1,.3333333333333333,0,.4980392157,1,.33725490196078434,0,.5137254902,1,.3411764705882353,0,.5294117647,1,.34509803921568627,0,.5490196078,1,.34901960784313724,0,.5647058824,1,.35294117647058826,0,.5960784314,1,.3568627450980392,0,.6156862745,1,.3607843137254902,0,.631372549,1,.36470588235294116,0,.6470588235,1,.3686274509803922,0,.6823529412,1,.37254901960784315,0,.6980392157,1,.3764705882352941,0,.7137254902,1,.3803921568627451,0,.7333333333,1,.3843137254901961,0,.7647058824,1,.38823529411764707,0,.7803921569,1,.39215686274509803,0,.7960784314,1,.396078431372549,0,.8156862745,1,.4,0,.8470588235,1,.403921568627451,0,.862745098,1,.40784313725490196,0,.8823529412,1,.4117647058823529,0,.8980392157,1,.41568627450980394,0,.9137254902,1,.4196078431372549,0,.9490196078,1,.4235294117647059,0,.9647058824,1,.42745098039215684,0,.9803921569,1,.43137254901960786,0,1,1,.43529411764705883,0,1,.9647058824,.4392156862745098,0,1,.9490196078,.44313725490196076,0,1,.9333333333,.4470588235294118,0,1,.9137254902,.45098039215686275,0,1,.8823529412,.4549019607843137,0,1,.862745098,.4588235294117647,0,1,.8470588235,.4627450980392157,0,1,.831372549,.4666666666666667,0,1,.7960784314,.4705882352941177,0,1,.7803921569,.4745098039215686,0,1,.7647058824,.4784313725490197,0,1,.7490196078,.48235294117647065,0,1,.7333333333,.48627450980392156,0,1,.6980392157,.49019607843137253,0,1,.6823529412,.49411764705882355,0,1,.6666666667,.4980392156862745,0,1,.6470588235,.5019607843137255,0,1,.6156862745,.5058823529411764,0,1,.5960784314,.5098039215686274,0,1,.5803921569,.5137254901960784,0,1,.5647058824,.5176470588235295,0,1,.5294117647,.5215686274509804,0,1,.5137254902,.5254901960784314,0,1,.4980392157,.5294117647058824,0,1,.4823529412,.5333333333333333,0,1,.4470588235,.5372549019607843,0,1,.431372549,.5411764705882353,0,1,.4156862745,.5450980392156862,0,1,.4,.5490196078431373,0,1,.3803921569,.5529411764705883,0,1,.3490196078,.5568627450980392,0,1,.3294117647,.5607843137254902,0,1,.3137254902,.5647058823529412,0,1,.2980392157,.5686274509803921,0,1,.262745098,.5725490196078431,0,1,.2470588235,.5764705882352941,0,1,.231372549,.5803921568627451,0,1,.2156862745,.5843137254901961,0,1,.1803921569,.5882352941176471,0,1,.1647058824,.592156862745098,0,1,.1490196078,.596078431372549,0,1,.1333333333,.6,0,1,.0980392157,.6039215686274509,0,1,.0823529412,.6078431372549019,0,1,.062745098,.611764705882353,0,1,.0470588235,.615686274509804,0,1,.031372549,.6196078431372549,0,1,0,.6235294117647059,.0156862745,1,0,.6274509803921569,.031372549,1,0,.6313725490196078,.0470588235,1,0,.6352941176470588,.0823529412,1,0,.6392156862745098,.0980392157,1,0,.6431372549019608,.1137254902,1,0,.6470588235294118,.1294117647,1,0,.6509803921568628,.1647058824,1,0,.6549019607843137,.1803921569,1,0,.6588235294117647,.2,1,0,.6627450980392157,.2156862745,1,0,.6666666666666666,.2470588235,1,0,.6705882352941176,.262745098,1,0,.6745098039215687,.2823529412,1,0,.6784313725490196,.2980392157,1,0,.6823529411764706,.3137254902,1,0,.6862745098039216,.3490196078,1,0,.6901960784313725,.3647058824,1,0,.6941176470588235,.3803921569,1,0,.6980392156862745,.3960784314,1,0,.7019607843137254,.431372549,1,0,.7058823529411765,.4470588235,1,0,.7098039215686275,.4666666667,1,0,.7137254901960784,.4823529412,1,0,.7176470588235294,.5137254902,1,0,.7215686274509804,.5294117647,1,0,.7254901960784313,.5490196078,1,0,.7294117647058823,.5647058824,1,0,.7333333333333333,.6,1,0,.7372549019607844,.6156862745,1,0,.7411764705882353,.631372549,1,0,.7450980392156863,.6470588235,1,0,.7490196078431373,.662745098,1,0,.7529411764705882,.6980392157,1,0,.7568627450980392,.7137254902,1,0,.7607843137254902,.7333333333,1,0,.7647058823529411,.7490196078,1,0,.7686274509803922,.7803921569,1,0,.7725490196078432,.7960784314,1,0,.7764705882352941,.8156862745,1,0,.7803921568627451,.831372549,1,0,.7843137254901961,.8666666667,1,0,.788235294117647,.8823529412,1,0,.792156862745098,.8980392157,1,0,.796078431372549,.9137254902,1,0,.8,.9490196078,1,0,.803921568627451,.9647058824,1,0,.807843137254902,.9803921569,1,0,.8117647058823529,1,1,0,.8156862745098039,1,.9803921569,0,.8196078431372549,1,.9490196078,0,.8235294117647058,1,.9333333333,0,.8274509803921568,1,.9137254902,0,.8313725490196079,1,.8980392157,0,.8352941176470589,1,.8666666667,0,.8392156862745098,1,.8470588235,0,.8431372549019608,1,.831372549,0,.8470588235294118,1,.8156862745,0,.8509803921568627,1,.7803921569,0,.8549019607843137,1,.7647058824,0,.8588235294117647,1,.7490196078,0,.8627450980392157,1,.7333333333,0,.8666666666666667,1,.6980392157,0,.8705882352941177,1,.6823529412,0,.8745098039215686,1,.6666666667,0,.8784313725490196,1,.6470588235,0,.8823529411764706,1,.631372549,0,.8862745098039215,1,.6,0,.8901960784313725,1,.5803921569,0,.8941176470588236,1,.5647058824,0,.8980392156862745,1,.5490196078,0,.9019607843137255,1,.5137254902,0,.9058823529411765,1,.4980392157,0,.9098039215686274,1,.4823529412,0,.9137254901960784,1,.4666666667,0,.9176470588235294,1,.431372549,0,.9215686274509803,1,.4156862745,0,.9254901960784314,1,.4,0,.9294117647058824,1,.3803921569,0,.9333333333333333,1,.3490196078,0,.9372549019607843,1,.3333333333,0,.9411764705882354,1,.3137254902,0,.9450980392156864,1,.2980392157,0,.9490196078431372,1,.2823529412,0,.9529411764705882,1,.2470588235,0,.9568627450980394,1,.231372549,0,.9607843137254903,1,.2156862745,0,.9647058823529413,1,.2,0,.9686274509803922,1,.1647058824,0,.9725490196078431,1,.1490196078,0,.9764705882352941,1,.1333333333,0,.9803921568627451,1,.1137254902,0,.984313725490196,1,.0823529412,0,.9882352941176471,1,.0666666667,0,.9921568627450981,1,.0470588235,0,.996078431372549,1,.031372549,0,1,1,0,0],description:"Rainbow"},{ColorSpace:"RGB",Name:"suv",name:"suv",RGBPoints:[0,1,1,1,.00392156862745098,1,1,1,.00784313725490196,1,1,1,.011764705882352941,1,1,1,.01568627450980392,1,1,1,.0196078431372549,1,1,1,.023529411764705882,1,1,1,.027450980392156862,1,1,1,.03137254901960784,1,1,1,.03529411764705882,1,1,1,.0392156862745098,1,1,1,.043137254901960784,1,1,1,.047058823529411764,1,1,1,.050980392156862744,1,1,1,.054901960784313725,1,1,1,.05882352941176471,1,1,1,.06274509803921569,1,1,1,.06666666666666667,1,1,1,.07058823529411765,1,1,1,.07450980392156863,1,1,1,.0784313725490196,1,1,1,.08235294117647059,1,1,1,.08627450980392157,1,1,1,.09019607843137255,1,1,1,.09411764705882353,1,1,1,.09803921568627451,1,1,1,.10196078431372549,.737254902,.737254902,.737254902,.10588235294117647,.737254902,.737254902,.737254902,.10980392156862745,.737254902,.737254902,.737254902,.11372549019607843,.737254902,.737254902,.737254902,.11764705882352942,.737254902,.737254902,.737254902,.12156862745098039,.737254902,.737254902,.737254902,.12549019607843137,.737254902,.737254902,.737254902,.12941176470588237,.737254902,.737254902,.737254902,.13333333333333333,.737254902,.737254902,.737254902,.13725490196078433,.737254902,.737254902,.737254902,.1411764705882353,.737254902,.737254902,.737254902,.1450980392156863,.737254902,.737254902,.737254902,.14901960784313725,.737254902,.737254902,.737254902,.15294117647058825,.737254902,.737254902,.737254902,.1568627450980392,.737254902,.737254902,.737254902,.1607843137254902,.737254902,.737254902,.737254902,.16470588235294117,.737254902,.737254902,.737254902,.16862745098039217,.737254902,.737254902,.737254902,.17254901960784313,.737254902,.737254902,.737254902,.17647058823529413,.737254902,.737254902,.737254902,.1803921568627451,.737254902,.737254902,.737254902,.1843137254901961,.737254902,.737254902,.737254902,.18823529411764706,.737254902,.737254902,.737254902,.19215686274509805,.737254902,.737254902,.737254902,.19607843137254902,.737254902,.737254902,.737254902,.2,.737254902,.737254902,.737254902,.20392156862745098,.431372549,0,.568627451,.20784313725490197,.431372549,0,.568627451,.21176470588235294,.431372549,0,.568627451,.21568627450980393,.431372549,0,.568627451,.2196078431372549,.431372549,0,.568627451,.2235294117647059,.431372549,0,.568627451,.22745098039215686,.431372549,0,.568627451,.23137254901960785,.431372549,0,.568627451,.23529411764705885,.431372549,0,.568627451,.23921568627450984,.431372549,0,.568627451,.24313725490196078,.431372549,0,.568627451,.24705882352941178,.431372549,0,.568627451,.25098039215686274,.431372549,0,.568627451,.2549019607843137,.431372549,0,.568627451,.25882352941176473,.431372549,0,.568627451,.2627450980392157,.431372549,0,.568627451,.26666666666666666,.431372549,0,.568627451,.27058823529411763,.431372549,0,.568627451,.27450980392156865,.431372549,0,.568627451,.2784313725490196,.431372549,0,.568627451,.2823529411764706,.431372549,0,.568627451,.28627450980392155,.431372549,0,.568627451,.2901960784313726,.431372549,0,.568627451,.29411764705882354,.431372549,0,.568627451,.2980392156862745,.431372549,0,.568627451,.30196078431372547,.431372549,0,.568627451,.3058823529411765,.2509803922,.3333333333,.6509803922,.30980392156862746,.2509803922,.3333333333,.6509803922,.3137254901960784,.2509803922,.3333333333,.6509803922,.3176470588235294,.2509803922,.3333333333,.6509803922,.3215686274509804,.2509803922,.3333333333,.6509803922,.3254901960784314,.2509803922,.3333333333,.6509803922,.32941176470588235,.2509803922,.3333333333,.6509803922,.3333333333333333,.2509803922,.3333333333,.6509803922,.33725490196078434,.2509803922,.3333333333,.6509803922,.3411764705882353,.2509803922,.3333333333,.6509803922,.34509803921568627,.2509803922,.3333333333,.6509803922,.34901960784313724,.2509803922,.3333333333,.6509803922,.35294117647058826,.2509803922,.3333333333,.6509803922,.3568627450980392,.2509803922,.3333333333,.6509803922,.3607843137254902,.2509803922,.3333333333,.6509803922,.36470588235294116,.2509803922,.3333333333,.6509803922,.3686274509803922,.2509803922,.3333333333,.6509803922,.37254901960784315,.2509803922,.3333333333,.6509803922,.3764705882352941,.2509803922,.3333333333,.6509803922,.3803921568627451,.2509803922,.3333333333,.6509803922,.3843137254901961,.2509803922,.3333333333,.6509803922,.38823529411764707,.2509803922,.3333333333,.6509803922,.39215686274509803,.2509803922,.3333333333,.6509803922,.396078431372549,.2509803922,.3333333333,.6509803922,.4,.2509803922,.3333333333,.6509803922,.403921568627451,.2509803922,.3333333333,.6509803922,.40784313725490196,0,.8,1,.4117647058823529,0,.8,1,.41568627450980394,0,.8,1,.4196078431372549,0,.8,1,.4235294117647059,0,.8,1,.42745098039215684,0,.8,1,.43137254901960786,0,.8,1,.43529411764705883,0,.8,1,.4392156862745098,0,.8,1,.44313725490196076,0,.8,1,.4470588235294118,0,.8,1,.45098039215686275,0,.8,1,.4549019607843137,0,.8,1,.4588235294117647,0,.8,1,.4627450980392157,0,.8,1,.4666666666666667,0,.8,1,.4705882352941177,0,.8,1,.4745098039215686,0,.8,1,.4784313725490197,0,.8,1,.48235294117647065,0,.8,1,.48627450980392156,0,.8,1,.49019607843137253,0,.8,1,.49411764705882355,0,.8,1,.4980392156862745,0,.8,1,.5019607843137255,0,.8,1,.5058823529411764,0,.6666666667,.5333333333,.5098039215686274,0,.6666666667,.5333333333,.5137254901960784,0,.6666666667,.5333333333,.5176470588235295,0,.6666666667,.5333333333,.5215686274509804,0,.6666666667,.5333333333,.5254901960784314,0,.6666666667,.5333333333,.5294117647058824,0,.6666666667,.5333333333,.5333333333333333,0,.6666666667,.5333333333,.5372549019607843,0,.6666666667,.5333333333,.5411764705882353,0,.6666666667,.5333333333,.5450980392156862,0,.6666666667,.5333333333,.5490196078431373,0,.6666666667,.5333333333,.5529411764705883,0,.6666666667,.5333333333,.5568627450980392,0,.6666666667,.5333333333,.5607843137254902,0,.6666666667,.5333333333,.5647058823529412,0,.6666666667,.5333333333,.5686274509803921,0,.6666666667,.5333333333,.5725490196078431,0,.6666666667,.5333333333,.5764705882352941,0,.6666666667,.5333333333,.5803921568627451,0,.6666666667,.5333333333,.5843137254901961,0,.6666666667,.5333333333,.5882352941176471,0,.6666666667,.5333333333,.592156862745098,0,.6666666667,.5333333333,.596078431372549,0,.6666666667,.5333333333,.6,0,.6666666667,.5333333333,.6039215686274509,0,.6666666667,.5333333333,.6078431372549019,.4,1,.4,.611764705882353,.4,1,.4,.615686274509804,.4,1,.4,.6196078431372549,.4,1,.4,.6235294117647059,.4,1,.4,.6274509803921569,.4,1,.4,.6313725490196078,.4,1,.4,.6352941176470588,.4,1,.4,.6392156862745098,.4,1,.4,.6431372549019608,.4,1,.4,.6470588235294118,.4,1,.4,.6509803921568628,.4,1,.4,.6549019607843137,.4,1,.4,.6588235294117647,.4,1,.4,.6627450980392157,.4,1,.4,.6666666666666666,.4,1,.4,.6705882352941176,.4,1,.4,.6745098039215687,.4,1,.4,.6784313725490196,.4,1,.4,.6823529411764706,.4,1,.4,.6862745098039216,.4,1,.4,.6901960784313725,.4,1,.4,.6941176470588235,.4,1,.4,.6980392156862745,.4,1,.4,.7019607843137254,.4,1,.4,.7058823529411765,1,.9490196078,0,.7098039215686275,1,.9490196078,0,.7137254901960784,1,.9490196078,0,.7176470588235294,1,.9490196078,0,.7215686274509804,1,.9490196078,0,.7254901960784313,1,.9490196078,0,.7294117647058823,1,.9490196078,0,.7333333333333333,1,.9490196078,0,.7372549019607844,1,.9490196078,0,.7411764705882353,1,.9490196078,0,.7450980392156863,1,.9490196078,0,.7490196078431373,1,.9490196078,0,.7529411764705882,1,.9490196078,0,.7568627450980392,1,.9490196078,0,.7607843137254902,1,.9490196078,0,.7647058823529411,1,.9490196078,0,.7686274509803922,1,.9490196078,0,.7725490196078432,1,.9490196078,0,.7764705882352941,1,.9490196078,0,.7803921568627451,1,.9490196078,0,.7843137254901961,1,.9490196078,0,.788235294117647,1,.9490196078,0,.792156862745098,1,.9490196078,0,.796078431372549,1,.9490196078,0,.8,1,.9490196078,0,.803921568627451,1,.9490196078,0,.807843137254902,.9490196078,.6509803922,.2509803922,.8117647058823529,.9490196078,.6509803922,.2509803922,.8156862745098039,.9490196078,.6509803922,.2509803922,.8196078431372549,.9490196078,.6509803922,.2509803922,.8235294117647058,.9490196078,.6509803922,.2509803922,.8274509803921568,.9490196078,.6509803922,.2509803922,.8313725490196079,.9490196078,.6509803922,.2509803922,.8352941176470589,.9490196078,.6509803922,.2509803922,.8392156862745098,.9490196078,.6509803922,.2509803922,.8431372549019608,.9490196078,.6509803922,.2509803922,.8470588235294118,.9490196078,.6509803922,.2509803922,.8509803921568627,.9490196078,.6509803922,.2509803922,.8549019607843137,.9490196078,.6509803922,.2509803922,.8588235294117647,.9490196078,.6509803922,.2509803922,.8627450980392157,.9490196078,.6509803922,.2509803922,.8666666666666667,.9490196078,.6509803922,.2509803922,.8705882352941177,.9490196078,.6509803922,.2509803922,.8745098039215686,.9490196078,.6509803922,.2509803922,.8784313725490196,.9490196078,.6509803922,.2509803922,.8823529411764706,.9490196078,.6509803922,.2509803922,.8862745098039215,.9490196078,.6509803922,.2509803922,.8901960784313725,.9490196078,.6509803922,.2509803922,.8941176470588236,.9490196078,.6509803922,.2509803922,.8980392156862745,.9490196078,.6509803922,.2509803922,.9019607843137255,.9490196078,.6509803922,.2509803922,.9058823529411765,.9490196078,.6509803922,.2509803922,.9098039215686274,1,0,0,.9137254901960784,1,0,0,.9176470588235294,1,0,0,.9215686274509803,1,0,0,.9254901960784314,1,0,0,.9294117647058824,1,0,0,.9333333333333333,1,0,0,.9372549019607843,1,0,0,.9411764705882354,1,0,0,.9450980392156864,1,0,0,.9490196078431372,1,0,0,.9529411764705882,1,0,0,.9568627450980394,1,0,0,.9607843137254903,1,0,0,.9647058823529413,1,0,0,.9686274509803922,1,0,0,.9725490196078431,1,0,0,.9764705882352941,1,0,0,.9803921568627451,1,0,0,.984313725490196,1,0,0,.9882352941176471,1,0,0,.9921568627450981,1,0,0,.996078431372549,1,0,0,1,1,0,0],description:"SUV"},{ColorSpace:"RGB",Name:"ge_256",name:"ge_256",RGBPoints:[0,.0039215686,.0078431373,.0078431373,.00392156862745098,.0039215686,.0078431373,.0078431373,.00784313725490196,.0039215686,.0078431373,.0117647059,.011764705882352941,.0039215686,.0117647059,.0156862745,.01568627450980392,.0039215686,.0117647059,.0196078431,.0196078431372549,.0039215686,.0156862745,.0235294118,.023529411764705882,.0039215686,.0156862745,.0274509804,.027450980392156862,.0039215686,.0196078431,.031372549,.03137254901960784,.0039215686,.0196078431,.0352941176,.03529411764705882,.0039215686,.0235294118,.0392156863,.0392156862745098,.0039215686,.0235294118,.0431372549,.043137254901960784,.0039215686,.0274509804,.0470588235,.047058823529411764,.0039215686,.0274509804,.0509803922,.050980392156862744,.0039215686,.031372549,.0549019608,.054901960784313725,.0039215686,.031372549,.0588235294,.05882352941176471,.0039215686,.0352941176,.062745098,.06274509803921569,.0039215686,.0352941176,.0666666667,.06666666666666667,.0039215686,.0392156863,.0705882353,.07058823529411765,.0039215686,.0392156863,.0745098039,.07450980392156863,.0039215686,.0431372549,.0784313725,.0784313725490196,.0039215686,.0431372549,.0823529412,.08235294117647059,.0039215686,.0470588235,.0862745098,.08627450980392157,.0039215686,.0470588235,.0901960784,.09019607843137255,.0039215686,.0509803922,.0941176471,.09411764705882353,.0039215686,.0509803922,.0980392157,.09803921568627451,.0039215686,.0549019608,.1019607843,.10196078431372549,.0039215686,.0549019608,.1058823529,.10588235294117647,.0039215686,.0588235294,.1098039216,.10980392156862745,.0039215686,.0588235294,.1137254902,.11372549019607843,.0039215686,.062745098,.1176470588,.11764705882352942,.0039215686,.062745098,.1215686275,.12156862745098039,.0039215686,.0666666667,.1254901961,.12549019607843137,.0039215686,.0666666667,.1294117647,.12941176470588237,.0039215686,.0705882353,.1333333333,.13333333333333333,.0039215686,.0705882353,.137254902,.13725490196078433,.0039215686,.0745098039,.1411764706,.1411764705882353,.0039215686,.0745098039,.1450980392,.1450980392156863,.0039215686,.0784313725,.1490196078,.14901960784313725,.0039215686,.0784313725,.1529411765,.15294117647058825,.0039215686,.0823529412,.1568627451,.1568627450980392,.0039215686,.0823529412,.1607843137,.1607843137254902,.0039215686,.0862745098,.1647058824,.16470588235294117,.0039215686,.0862745098,.168627451,.16862745098039217,.0039215686,.0901960784,.1725490196,.17254901960784313,.0039215686,.0901960784,.1764705882,.17647058823529413,.0039215686,.0941176471,.1803921569,.1803921568627451,.0039215686,.0941176471,.1843137255,.1843137254901961,.0039215686,.0980392157,.1882352941,.18823529411764706,.0039215686,.0980392157,.1921568627,.19215686274509805,.0039215686,.1019607843,.1960784314,.19607843137254902,.0039215686,.1019607843,.2,.2,.0039215686,.1058823529,.2039215686,.20392156862745098,.0039215686,.1058823529,.2078431373,.20784313725490197,.0039215686,.1098039216,.2117647059,.21176470588235294,.0039215686,.1098039216,.2156862745,.21568627450980393,.0039215686,.1137254902,.2196078431,.2196078431372549,.0039215686,.1137254902,.2235294118,.2235294117647059,.0039215686,.1176470588,.2274509804,.22745098039215686,.0039215686,.1176470588,.231372549,.23137254901960785,.0039215686,.1215686275,.2352941176,.23529411764705885,.0039215686,.1215686275,.2392156863,.23921568627450984,.0039215686,.1254901961,.2431372549,.24313725490196078,.0039215686,.1254901961,.2470588235,.24705882352941178,.0039215686,.1294117647,.2509803922,.25098039215686274,.0039215686,.1294117647,.2509803922,.2549019607843137,.0078431373,.1254901961,.2549019608,.25882352941176473,.0156862745,.1254901961,.2588235294,.2627450980392157,.0235294118,.1215686275,.262745098,.26666666666666666,.031372549,.1215686275,.2666666667,.27058823529411763,.0392156863,.1176470588,.2705882353,.27450980392156865,.0470588235,.1176470588,.2745098039,.2784313725490196,.0549019608,.1137254902,.2784313725,.2823529411764706,.062745098,.1137254902,.2823529412,.28627450980392155,.0705882353,.1098039216,.2862745098,.2901960784313726,.0784313725,.1098039216,.2901960784,.29411764705882354,.0862745098,.1058823529,.2941176471,.2980392156862745,.0941176471,.1058823529,.2980392157,.30196078431372547,.1019607843,.1019607843,.3019607843,.3058823529411765,.1098039216,.1019607843,.3058823529,.30980392156862746,.1176470588,.0980392157,.3098039216,.3137254901960784,.1254901961,.0980392157,.3137254902,.3176470588235294,.1333333333,.0941176471,.3176470588,.3215686274509804,.1411764706,.0941176471,.3215686275,.3254901960784314,.1490196078,.0901960784,.3254901961,.32941176470588235,.1568627451,.0901960784,.3294117647,.3333333333333333,.1647058824,.0862745098,.3333333333,.33725490196078434,.1725490196,.0862745098,.337254902,.3411764705882353,.1803921569,.0823529412,.3411764706,.34509803921568627,.1882352941,.0823529412,.3450980392,.34901960784313724,.1960784314,.0784313725,.3490196078,.35294117647058826,.2039215686,.0784313725,.3529411765,.3568627450980392,.2117647059,.0745098039,.3568627451,.3607843137254902,.2196078431,.0745098039,.3607843137,.36470588235294116,.2274509804,.0705882353,.3647058824,.3686274509803922,.2352941176,.0705882353,.368627451,.37254901960784315,.2431372549,.0666666667,.3725490196,.3764705882352941,.2509803922,.0666666667,.3764705882,.3803921568627451,.2549019608,.062745098,.3803921569,.3843137254901961,.262745098,.062745098,.3843137255,.38823529411764707,.2705882353,.0588235294,.3882352941,.39215686274509803,.2784313725,.0588235294,.3921568627,.396078431372549,.2862745098,.0549019608,.3960784314,.4,.2941176471,.0549019608,.4,.403921568627451,.3019607843,.0509803922,.4039215686,.40784313725490196,.3098039216,.0509803922,.4078431373,.4117647058823529,.3176470588,.0470588235,.4117647059,.41568627450980394,.3254901961,.0470588235,.4156862745,.4196078431372549,.3333333333,.0431372549,.4196078431,.4235294117647059,.3411764706,.0431372549,.4235294118,.42745098039215684,.3490196078,.0392156863,.4274509804,.43137254901960786,.3568627451,.0392156863,.431372549,.43529411764705883,.3647058824,.0352941176,.4352941176,.4392156862745098,.3725490196,.0352941176,.4392156863,.44313725490196076,.3803921569,.031372549,.4431372549,.4470588235294118,.3882352941,.031372549,.4470588235,.45098039215686275,.3960784314,.0274509804,.4509803922,.4549019607843137,.4039215686,.0274509804,.4549019608,.4588235294117647,.4117647059,.0235294118,.4588235294,.4627450980392157,.4196078431,.0235294118,.462745098,.4666666666666667,.4274509804,.0196078431,.4666666667,.4705882352941177,.4352941176,.0196078431,.4705882353,.4745098039215686,.4431372549,.0156862745,.4745098039,.4784313725490197,.4509803922,.0156862745,.4784313725,.48235294117647065,.4588235294,.0117647059,.4823529412,.48627450980392156,.4666666667,.0117647059,.4862745098,.49019607843137253,.4745098039,.0078431373,.4901960784,.49411764705882355,.4823529412,.0078431373,.4941176471,.4980392156862745,.4901960784,.0039215686,.4980392157,.5019607843137255,.4980392157,.0117647059,.4980392157,.5058823529411764,.5058823529,.0156862745,.4901960784,.5098039215686274,.5137254902,.0235294118,.4823529412,.5137254901960784,.5215686275,.0274509804,.4745098039,.5176470588235295,.5294117647,.0352941176,.4666666667,.5215686274509804,.537254902,.0392156863,.4588235294,.5254901960784314,.5450980392,.0470588235,.4509803922,.5294117647058824,.5529411765,.0509803922,.4431372549,.5333333333333333,.5607843137,.0588235294,.4352941176,.5372549019607843,.568627451,.062745098,.4274509804,.5411764705882353,.5764705882,.0705882353,.4196078431,.5450980392156862,.5843137255,.0745098039,.4117647059,.5490196078431373,.5921568627,.0823529412,.4039215686,.5529411764705883,.6,.0862745098,.3960784314,.5568627450980392,.6078431373,.0941176471,.3882352941,.5607843137254902,.6156862745,.0980392157,.3803921569,.5647058823529412,.6235294118,.1058823529,.3725490196,.5686274509803921,.631372549,.1098039216,.3647058824,.5725490196078431,.6392156863,.1176470588,.3568627451,.5764705882352941,.6470588235,.1215686275,.3490196078,.5803921568627451,.6549019608,.1294117647,.3411764706,.5843137254901961,.662745098,.1333333333,.3333333333,.5882352941176471,.6705882353,.1411764706,.3254901961,.592156862745098,.6784313725,.1450980392,.3176470588,.596078431372549,.6862745098,.1529411765,.3098039216,.6,.6941176471,.1568627451,.3019607843,.6039215686274509,.7019607843,.1647058824,.2941176471,.6078431372549019,.7098039216,.168627451,.2862745098,.611764705882353,.7176470588,.1764705882,.2784313725,.615686274509804,.7254901961,.1803921569,.2705882353,.6196078431372549,.7333333333,.1882352941,.262745098,.6235294117647059,.7411764706,.1921568627,.2549019608,.6274509803921569,.7490196078,.2,.2509803922,.6313725490196078,.7529411765,.2039215686,.2431372549,.6352941176470588,.7607843137,.2117647059,.2352941176,.6392156862745098,.768627451,.2156862745,.2274509804,.6431372549019608,.7764705882,.2235294118,.2196078431,.6470588235294118,.7843137255,.2274509804,.2117647059,.6509803921568628,.7921568627,.2352941176,.2039215686,.6549019607843137,.8,.2392156863,.1960784314,.6588235294117647,.8078431373,.2470588235,.1882352941,.6627450980392157,.8156862745,.2509803922,.1803921569,.6666666666666666,.8235294118,.2549019608,.1725490196,.6705882352941176,.831372549,.2588235294,.1647058824,.6745098039215687,.8392156863,.2666666667,.1568627451,.6784313725490196,.8470588235,.2705882353,.1490196078,.6823529411764706,.8549019608,.2784313725,.1411764706,.6862745098039216,.862745098,.2823529412,.1333333333,.6901960784313725,.8705882353,.2901960784,.1254901961,.6941176470588235,.8784313725,.2941176471,.1176470588,.6980392156862745,.8862745098,.3019607843,.1098039216,.7019607843137254,.8941176471,.3058823529,.1019607843,.7058823529411765,.9019607843,.3137254902,.0941176471,.7098039215686275,.9098039216,.3176470588,.0862745098,.7137254901960784,.9176470588,.3254901961,.0784313725,.7176470588235294,.9254901961,.3294117647,.0705882353,.7215686274509804,.9333333333,.337254902,.062745098,.7254901960784313,.9411764706,.3411764706,.0549019608,.7294117647058823,.9490196078,.3490196078,.0470588235,.7333333333333333,.9568627451,.3529411765,.0392156863,.7372549019607844,.9647058824,.3607843137,.031372549,.7411764705882353,.9725490196,.3647058824,.0235294118,.7450980392156863,.9803921569,.3725490196,.0156862745,.7490196078431373,.9882352941,.3725490196,.0039215686,.7529411764705882,.9960784314,.3843137255,.0156862745,.7568627450980392,.9960784314,.3921568627,.031372549,.7607843137254902,.9960784314,.4039215686,.0470588235,.7647058823529411,.9960784314,.4117647059,.062745098,.7686274509803922,.9960784314,.4235294118,.0784313725,.7725490196078432,.9960784314,.431372549,.0941176471,.7764705882352941,.9960784314,.4431372549,.1098039216,.7803921568627451,.9960784314,.4509803922,.1254901961,.7843137254901961,.9960784314,.462745098,.1411764706,.788235294117647,.9960784314,.4705882353,.1568627451,.792156862745098,.9960784314,.4823529412,.1725490196,.796078431372549,.9960784314,.4901960784,.1882352941,.8,.9960784314,.5019607843,.2039215686,.803921568627451,.9960784314,.5098039216,.2196078431,.807843137254902,.9960784314,.5215686275,.2352941176,.8117647058823529,.9960784314,.5294117647,.2509803922,.8156862745098039,.9960784314,.5411764706,.262745098,.8196078431372549,.9960784314,.5490196078,.2784313725,.8235294117647058,.9960784314,.5607843137,.2941176471,.8274509803921568,.9960784314,.568627451,.3098039216,.8313725490196079,.9960784314,.5803921569,.3254901961,.8352941176470589,.9960784314,.5882352941,.3411764706,.8392156862745098,.9960784314,.6,.3568627451,.8431372549019608,.9960784314,.6078431373,.3725490196,.8470588235294118,.9960784314,.6196078431,.3882352941,.8509803921568627,.9960784314,.6274509804,.4039215686,.8549019607843137,.9960784314,.6392156863,.4196078431,.8588235294117647,.9960784314,.6470588235,.4352941176,.8627450980392157,.9960784314,.6588235294,.4509803922,.8666666666666667,.9960784314,.6666666667,.4666666667,.8705882352941177,.9960784314,.6784313725,.4823529412,.8745098039215686,.9960784314,.6862745098,.4980392157,.8784313725490196,.9960784314,.6980392157,.5137254902,.8823529411764706,.9960784314,.7058823529,.5294117647,.8862745098039215,.9960784314,.7176470588,.5450980392,.8901960784313725,.9960784314,.7254901961,.5607843137,.8941176470588236,.9960784314,.737254902,.5764705882,.8980392156862745,.9960784314,.7450980392,.5921568627,.9019607843137255,.9960784314,.7529411765,.6078431373,.9058823529411765,.9960784314,.7607843137,.6235294118,.9098039215686274,.9960784314,.7725490196,.6392156863,.9137254901960784,.9960784314,.7803921569,.6549019608,.9176470588235294,.9960784314,.7921568627,.6705882353,.9215686274509803,.9960784314,.8,.6862745098,.9254901960784314,.9960784314,.8117647059,.7019607843,.9294117647058824,.9960784314,.8196078431,.7176470588,.9333333333333333,.9960784314,.831372549,.7333333333,.9372549019607843,.9960784314,.8392156863,.7490196078,.9411764705882354,.9960784314,.8509803922,.7607843137,.9450980392156864,.9960784314,.8588235294,.7764705882,.9490196078431372,.9960784314,.8705882353,.7921568627,.9529411764705882,.9960784314,.8784313725,.8078431373,.9568627450980394,.9960784314,.8901960784,.8235294118,.9607843137254903,.9960784314,.8980392157,.8392156863,.9647058823529413,.9960784314,.9098039216,.8549019608,.9686274509803922,.9960784314,.9176470588,.8705882353,.9725490196078431,.9960784314,.9294117647,.8862745098,.9764705882352941,.9960784314,.937254902,.9019607843,.9803921568627451,.9960784314,.9490196078,.9176470588,.984313725490196,.9960784314,.9568627451,.9333333333,.9882352941176471,.9960784314,.968627451,.9490196078,.9921568627450981,.9960784314,.9764705882,.9647058824,.996078431372549,.9960784314,.9882352941,.9803921569,1,.9960784314,.9882352941,.9803921569],description:"GE 256"},{ColorSpace:"RGB",Name:"ge",name:"ge",RGBPoints:[0,.0078431373,.0078431373,.0078431373,.00392156862745098,.0078431373,.0078431373,.0078431373,.00784313725490196,.0078431373,.0078431373,.0078431373,.011764705882352941,.0078431373,.0078431373,.0078431373,.01568627450980392,.0078431373,.0078431373,.0078431373,.0196078431372549,.0078431373,.0078431373,.0078431373,.023529411764705882,.0078431373,.0078431373,.0078431373,.027450980392156862,.0078431373,.0078431373,.0078431373,.03137254901960784,.0078431373,.0078431373,.0078431373,.03529411764705882,.0078431373,.0078431373,.0078431373,.0392156862745098,.0078431373,.0078431373,.0078431373,.043137254901960784,.0078431373,.0078431373,.0078431373,.047058823529411764,.0078431373,.0078431373,.0078431373,.050980392156862744,.0078431373,.0078431373,.0078431373,.054901960784313725,.0078431373,.0078431373,.0078431373,.05882352941176471,.0117647059,.0078431373,.0078431373,.06274509803921569,.0078431373,.0156862745,.0156862745,.06666666666666667,.0078431373,.0235294118,.0235294118,.07058823529411765,.0078431373,.031372549,.031372549,.07450980392156863,.0078431373,.0392156863,.0392156863,.0784313725490196,.0078431373,.0470588235,.0470588235,.08235294117647059,.0078431373,.0549019608,.0549019608,.08627450980392157,.0078431373,.062745098,.062745098,.09019607843137255,.0078431373,.0705882353,.0705882353,.09411764705882353,.0078431373,.0784313725,.0784313725,.09803921568627451,.0078431373,.0901960784,.0862745098,.10196078431372549,.0078431373,.0980392157,.0941176471,.10588235294117647,.0078431373,.1058823529,.1019607843,.10980392156862745,.0078431373,.1137254902,.1098039216,.11372549019607843,.0078431373,.1215686275,.1176470588,.11764705882352942,.0078431373,.1294117647,.1254901961,.12156862745098039,.0078431373,.137254902,.1333333333,.12549019607843137,.0078431373,.1450980392,.1411764706,.12941176470588237,.0078431373,.1529411765,.1490196078,.13333333333333333,.0078431373,.1647058824,.1568627451,.13725490196078433,.0078431373,.1725490196,.1647058824,.1411764705882353,.0078431373,.1803921569,.1725490196,.1450980392156863,.0078431373,.1882352941,.1803921569,.14901960784313725,.0078431373,.1960784314,.1882352941,.15294117647058825,.0078431373,.2039215686,.1960784314,.1568627450980392,.0078431373,.2117647059,.2039215686,.1607843137254902,.0078431373,.2196078431,.2117647059,.16470588235294117,.0078431373,.2274509804,.2196078431,.16862745098039217,.0078431373,.2352941176,.2274509804,.17254901960784313,.0078431373,.2470588235,.2352941176,.17647058823529413,.0078431373,.2509803922,.2431372549,.1803921568627451,.0078431373,.2549019608,.2509803922,.1843137254901961,.0078431373,.262745098,.2509803922,.18823529411764706,.0078431373,.2705882353,.2588235294,.19215686274509805,.0078431373,.2784313725,.2666666667,.19607843137254902,.0078431373,.2862745098,.2745098039,.2,.0078431373,.2941176471,.2823529412,.20392156862745098,.0078431373,.3019607843,.2901960784,.20784313725490197,.0078431373,.3137254902,.2980392157,.21176470588235294,.0078431373,.3215686275,.3058823529,.21568627450980393,.0078431373,.3294117647,.3137254902,.2196078431372549,.0078431373,.337254902,.3215686275,.2235294117647059,.0078431373,.3450980392,.3294117647,.22745098039215686,.0078431373,.3529411765,.337254902,.23137254901960785,.0078431373,.3607843137,.3450980392,.23529411764705885,.0078431373,.368627451,.3529411765,.23921568627450984,.0078431373,.3764705882,.3607843137,.24313725490196078,.0078431373,.3843137255,.368627451,.24705882352941178,.0078431373,.3960784314,.3764705882,.25098039215686274,.0078431373,.4039215686,.3843137255,.2549019607843137,.0078431373,.4117647059,.3921568627,.25882352941176473,.0078431373,.4196078431,.4,.2627450980392157,.0078431373,.4274509804,.4078431373,.26666666666666666,.0078431373,.4352941176,.4156862745,.27058823529411763,.0078431373,.4431372549,.4235294118,.27450980392156865,.0078431373,.4509803922,.431372549,.2784313725490196,.0078431373,.4588235294,.4392156863,.2823529411764706,.0078431373,.4705882353,.4470588235,.28627450980392155,.0078431373,.4784313725,.4549019608,.2901960784313726,.0078431373,.4862745098,.462745098,.29411764705882354,.0078431373,.4941176471,.4705882353,.2980392156862745,.0078431373,.5019607843,.4784313725,.30196078431372547,.0117647059,.5098039216,.4862745098,.3058823529411765,.0196078431,.5019607843,.4941176471,.30980392156862746,.0274509804,.4941176471,.5058823529,.3137254901960784,.0352941176,.4862745098,.5137254902,.3176470588235294,.0431372549,.4784313725,.5215686275,.3215686274509804,.0509803922,.4705882353,.5294117647,.3254901960784314,.0588235294,.462745098,.537254902,.32941176470588235,.0666666667,.4549019608,.5450980392,.3333333333333333,.0745098039,.4470588235,.5529411765,.33725490196078434,.0823529412,.4392156863,.5607843137,.3411764705882353,.0901960784,.431372549,.568627451,.34509803921568627,.0980392157,.4235294118,.5764705882,.34901960784313724,.1058823529,.4156862745,.5843137255,.35294117647058826,.1137254902,.4078431373,.5921568627,.3568627450980392,.1215686275,.4,.6,.3607843137254902,.1294117647,.3921568627,.6078431373,.36470588235294116,.137254902,.3843137255,.6156862745,.3686274509803922,.1450980392,.3764705882,.6235294118,.37254901960784315,.1529411765,.368627451,.631372549,.3764705882352941,.1607843137,.3607843137,.6392156863,.3803921568627451,.168627451,.3529411765,.6470588235,.3843137254901961,.1764705882,.3450980392,.6549019608,.38823529411764707,.1843137255,.337254902,.662745098,.39215686274509803,.1921568627,.3294117647,.6705882353,.396078431372549,.2,.3215686275,.6784313725,.4,.2078431373,.3137254902,.6862745098,.403921568627451,.2156862745,.3058823529,.6941176471,.40784313725490196,.2235294118,.2980392157,.7019607843,.4117647058823529,.231372549,.2901960784,.7098039216,.41568627450980394,.2392156863,.2823529412,.7176470588,.4196078431372549,.2470588235,.2745098039,.7254901961,.4235294117647059,.2509803922,.2666666667,.7333333333,.42745098039215684,.2509803922,.2588235294,.7411764706,.43137254901960786,.2588235294,.2509803922,.7490196078,.43529411764705883,.2666666667,.2509803922,.7490196078,.4392156862745098,.2745098039,.2431372549,.7568627451,.44313725490196076,.2823529412,.2352941176,.7647058824,.4470588235294118,.2901960784,.2274509804,.7725490196,.45098039215686275,.2980392157,.2196078431,.7803921569,.4549019607843137,.3058823529,.2117647059,.7882352941,.4588235294117647,.3137254902,.2039215686,.7960784314,.4627450980392157,.3215686275,.1960784314,.8039215686,.4666666666666667,.3294117647,.1882352941,.8117647059,.4705882352941177,.337254902,.1803921569,.8196078431,.4745098039215686,.3450980392,.1725490196,.8274509804,.4784313725490197,.3529411765,.1647058824,.8352941176,.48235294117647065,.3607843137,.1568627451,.8431372549,.48627450980392156,.368627451,.1490196078,.8509803922,.49019607843137253,.3764705882,.1411764706,.8588235294,.49411764705882355,.3843137255,.1333333333,.8666666667,.4980392156862745,.3921568627,.1254901961,.8745098039,.5019607843137255,.4,.1176470588,.8823529412,.5058823529411764,.4078431373,.1098039216,.8901960784,.5098039215686274,.4156862745,.1019607843,.8980392157,.5137254901960784,.4235294118,.0941176471,.9058823529,.5176470588235295,.431372549,.0862745098,.9137254902,.5215686274509804,.4392156863,.0784313725,.9215686275,.5254901960784314,.4470588235,.0705882353,.9294117647,.5294117647058824,.4549019608,.062745098,.937254902,.5333333333333333,.462745098,.0549019608,.9450980392,.5372549019607843,.4705882353,.0470588235,.9529411765,.5411764705882353,.4784313725,.0392156863,.9607843137,.5450980392156862,.4862745098,.031372549,.968627451,.5490196078431373,.4941176471,.0235294118,.9764705882,.5529411764705883,.4980392157,.0156862745,.9843137255,.5568627450980392,.5058823529,.0078431373,.9921568627,.5607843137254902,.5137254902,.0156862745,.9803921569,.5647058823529412,.5215686275,.0235294118,.9647058824,.5686274509803921,.5294117647,.0352941176,.9490196078,.5725490196078431,.537254902,.0431372549,.9333333333,.5764705882352941,.5450980392,.0509803922,.9176470588,.5803921568627451,.5529411765,.062745098,.9019607843,.5843137254901961,.5607843137,.0705882353,.8862745098,.5882352941176471,.568627451,.0784313725,.8705882353,.592156862745098,.5764705882,.0901960784,.8549019608,.596078431372549,.5843137255,.0980392157,.8392156863,.6,.5921568627,.1098039216,.8235294118,.6039215686274509,.6,.1176470588,.8078431373,.6078431372549019,.6078431373,.1254901961,.7921568627,.611764705882353,.6156862745,.137254902,.7764705882,.615686274509804,.6235294118,.1450980392,.7607843137,.6196078431372549,.631372549,.1529411765,.7490196078,.6235294117647059,.6392156863,.1647058824,.737254902,.6274509803921569,.6470588235,.1725490196,.7215686275,.6313725490196078,.6549019608,.1843137255,.7058823529,.6352941176470588,.662745098,.1921568627,.6901960784,.6392156862745098,.6705882353,.2,.6745098039,.6431372549019608,.6784313725,.2117647059,.6588235294,.6470588235294118,.6862745098,.2196078431,.6431372549,.6509803921568628,.6941176471,.2274509804,.6274509804,.6549019607843137,.7019607843,.2392156863,.6117647059,.6588235294117647,.7098039216,.2470588235,.5960784314,.6627450980392157,.7176470588,.2509803922,.5803921569,.6666666666666666,.7254901961,.2588235294,.5647058824,.6705882352941176,.7333333333,.2666666667,.5490196078,.6745098039215687,.7411764706,.2784313725,.5333333333,.6784313725490196,.7490196078,.2862745098,.5176470588,.6823529411764706,.7490196078,.2941176471,.5019607843,.6862745098039216,.7529411765,.3058823529,.4862745098,.6901960784313725,.7607843137,.3137254902,.4705882353,.6941176470588235,.768627451,.3215686275,.4549019608,.6980392156862745,.7764705882,.3333333333,.4392156863,.7019607843137254,.7843137255,.3411764706,.4235294118,.7058823529411765,.7921568627,.3529411765,.4078431373,.7098039215686275,.8,.3607843137,.3921568627,.7137254901960784,.8078431373,.368627451,.3764705882,.7176470588235294,.8156862745,.3803921569,.3607843137,.7215686274509804,.8235294118,.3882352941,.3450980392,.7254901960784313,.831372549,.3960784314,.3294117647,.7294117647058823,.8392156863,.4078431373,.3137254902,.7333333333333333,.8470588235,.4156862745,.2980392157,.7372549019607844,.8549019608,.4274509804,.2823529412,.7411764705882353,.862745098,.4352941176,.2666666667,.7450980392156863,.8705882353,.4431372549,.2509803922,.7490196078431373,.8784313725,.4549019608,.2431372549,.7529411764705882,.8862745098,.462745098,.2274509804,.7568627450980392,.8941176471,.4705882353,.2117647059,.7607843137254902,.9019607843,.4823529412,.1960784314,.7647058823529411,.9098039216,.4901960784,.1803921569,.7686274509803922,.9176470588,.4980392157,.1647058824,.7725490196078432,.9254901961,.5098039216,.1490196078,.7764705882352941,.9333333333,.5176470588,.1333333333,.7803921568627451,.9411764706,.5294117647,.1176470588,.7843137254901961,.9490196078,.537254902,.1019607843,.788235294117647,.9568627451,.5450980392,.0862745098,.792156862745098,.9647058824,.5568627451,.0705882353,.796078431372549,.9725490196,.5647058824,.0549019608,.8,.9803921569,.5725490196,.0392156863,.803921568627451,.9882352941,.5843137255,.0235294118,.807843137254902,.9921568627,.5921568627,.0078431373,.8117647058823529,.9921568627,.6039215686,.0274509804,.8156862745098039,.9921568627,.6117647059,.0509803922,.8196078431372549,.9921568627,.6196078431,.0745098039,.8235294117647058,.9921568627,.631372549,.0980392157,.8274509803921568,.9921568627,.6392156863,.1215686275,.8313725490196079,.9921568627,.6470588235,.1411764706,.8352941176470589,.9921568627,.6588235294,.1647058824,.8392156862745098,.9921568627,.6666666667,.1882352941,.8431372549019608,.9921568627,.6784313725,.2117647059,.8470588235294118,.9921568627,.6862745098,.2352941176,.8509803921568627,.9921568627,.6941176471,.2509803922,.8549019607843137,.9921568627,.7058823529,.2705882353,.8588235294117647,.9921568627,.7137254902,.2941176471,.8627450980392157,.9921568627,.7215686275,.3176470588,.8666666666666667,.9921568627,.7333333333,.3411764706,.8705882352941177,.9921568627,.7411764706,.3647058824,.8745098039215686,.9921568627,.7490196078,.3843137255,.8784313725490196,.9921568627,.7529411765,.4078431373,.8823529411764706,.9921568627,.7607843137,.431372549,.8862745098039215,.9921568627,.7725490196,.4549019608,.8901960784313725,.9921568627,.7803921569,.4784313725,.8941176470588236,.9921568627,.7882352941,.4980392157,.8980392156862745,.9921568627,.8,.5215686275,.9019607843137255,.9921568627,.8078431373,.5450980392,.9058823529411765,.9921568627,.8156862745,.568627451,.9098039215686274,.9921568627,.8274509804,.5921568627,.9137254901960784,.9921568627,.8352941176,.6156862745,.9176470588235294,.9921568627,.8470588235,.6352941176,.9215686274509803,.9921568627,.8549019608,.6588235294,.9254901960784314,.9921568627,.862745098,.6823529412,.9294117647058824,.9921568627,.8745098039,.7058823529,.9333333333333333,.9921568627,.8823529412,.7294117647,.9372549019607843,.9921568627,.8901960784,.7490196078,.9411764705882354,.9921568627,.9019607843,.7647058824,.9450980392156864,.9921568627,.9098039216,.7882352941,.9490196078431372,.9921568627,.9215686275,.8117647059,.9529411764705882,.9921568627,.9294117647,.8352941176,.9568627450980394,.9921568627,.937254902,.8588235294,.9607843137254903,.9921568627,.9490196078,.8784313725,.9647058823529413,.9921568627,.9568627451,.9019607843,.9686274509803922,.9921568627,.9647058824,.9254901961,.9725490196078431,.9921568627,.9764705882,.9490196078,.9764705882352941,.9921568627,.9843137255,.9725490196,.9803921568627451,.9921568627,.9921568627,.9921568627,.984313725490196,.9921568627,.9921568627,.9921568627,.9882352941176471,.9921568627,.9921568627,.9921568627,.9921568627450981,.9921568627,.9921568627,.9921568627,.996078431372549,.9921568627,.9921568627,.9921568627,1,.9921568627,.9921568627,.9921568627],description:"GE"},{ColorSpace:"RGB",Name:"siemens",name:"siemens",RGBPoints:[0,.0078431373,.0039215686,.1254901961,.00392156862745098,.0078431373,.0039215686,.1254901961,.00784313725490196,.0078431373,.0039215686,.1882352941,.011764705882352941,.0117647059,.0039215686,.2509803922,.01568627450980392,.0117647059,.0039215686,.3098039216,.0196078431372549,.0156862745,.0039215686,.3725490196,.023529411764705882,.0156862745,.0039215686,.3725490196,.027450980392156862,.0156862745,.0039215686,.3725490196,.03137254901960784,.0156862745,.0039215686,.3725490196,.03529411764705882,.0156862745,.0039215686,.3725490196,.0392156862745098,.0156862745,.0039215686,.3725490196,.043137254901960784,.0156862745,.0039215686,.3725490196,.047058823529411764,.0156862745,.0039215686,.3725490196,.050980392156862744,.0156862745,.0039215686,.3725490196,.054901960784313725,.0156862745,.0039215686,.3725490196,.05882352941176471,.0156862745,.0039215686,.3725490196,.06274509803921569,.0156862745,.0039215686,.3882352941,.06666666666666667,.0156862745,.0039215686,.4078431373,.07058823529411765,.0156862745,.0039215686,.4235294118,.07450980392156863,.0156862745,.0039215686,.4431372549,.0784313725490196,.0156862745,.0039215686,.462745098,.08235294117647059,.0156862745,.0039215686,.4784313725,.08627450980392157,.0156862745,.0039215686,.4980392157,.09019607843137255,.0196078431,.0039215686,.5137254902,.09411764705882353,.0196078431,.0039215686,.5333333333,.09803921568627451,.0196078431,.0039215686,.5529411765,.10196078431372549,.0196078431,.0039215686,.568627451,.10588235294117647,.0196078431,.0039215686,.5882352941,.10980392156862745,.0196078431,.0039215686,.6039215686,.11372549019607843,.0196078431,.0039215686,.6235294118,.11764705882352942,.0196078431,.0039215686,.6431372549,.12156862745098039,.0235294118,.0039215686,.6588235294,.12549019607843137,.0235294118,.0039215686,.6784313725,.12941176470588237,.0235294118,.0039215686,.6980392157,.13333333333333333,.0235294118,.0039215686,.7137254902,.13725490196078433,.0235294118,.0039215686,.7333333333,.1411764705882353,.0235294118,.0039215686,.7490196078,.1450980392156863,.0235294118,.0039215686,.7647058824,.14901960784313725,.0235294118,.0039215686,.7843137255,.15294117647058825,.0274509804,.0039215686,.8,.1568627450980392,.0274509804,.0039215686,.8196078431,.1607843137254902,.0274509804,.0039215686,.8352941176,.16470588235294117,.0274509804,.0039215686,.8549019608,.16862745098039217,.0274509804,.0039215686,.8745098039,.17254901960784313,.0274509804,.0039215686,.8901960784,.17647058823529413,.0274509804,.0039215686,.9098039216,.1803921568627451,.031372549,.0039215686,.9294117647,.1843137254901961,.031372549,.0039215686,.9254901961,.18823529411764706,.0509803922,.0039215686,.9098039216,.19215686274509805,.0705882353,.0039215686,.8901960784,.19607843137254902,.0901960784,.0039215686,.8705882353,.2,.1137254902,.0039215686,.8509803922,.20392156862745098,.1333333333,.0039215686,.831372549,.20784313725490197,.1529411765,.0039215686,.8117647059,.21176470588235294,.1725490196,.0039215686,.7921568627,.21568627450980393,.1960784314,.0039215686,.7725490196,.2196078431372549,.2156862745,.0039215686,.7529411765,.2235294117647059,.2352941176,.0039215686,.737254902,.22745098039215686,.2509803922,.0039215686,.7176470588,.23137254901960785,.2745098039,.0039215686,.6980392157,.23529411764705885,.2941176471,.0039215686,.6784313725,.23921568627450984,.3137254902,.0039215686,.6588235294,.24313725490196078,.3333333333,.0039215686,.6392156863,.24705882352941178,.3568627451,.0039215686,.6196078431,.25098039215686274,.3764705882,.0039215686,.6,.2549019607843137,.3960784314,.0039215686,.5803921569,.25882352941176473,.4156862745,.0039215686,.5607843137,.2627450980392157,.4392156863,.0039215686,.5411764706,.26666666666666666,.4588235294,.0039215686,.5215686275,.27058823529411763,.4784313725,.0039215686,.5019607843,.27450980392156865,.4980392157,.0039215686,.4823529412,.2784313725490196,.5215686275,.0039215686,.4666666667,.2823529411764706,.5411764706,.0039215686,.4470588235,.28627450980392155,.5607843137,.0039215686,.4274509804,.2901960784313726,.5803921569,.0039215686,.4078431373,.29411764705882354,.6039215686,.0039215686,.3882352941,.2980392156862745,.6235294118,.0039215686,.368627451,.30196078431372547,.6431372549,.0039215686,.3490196078,.3058823529411765,.662745098,.0039215686,.3294117647,.30980392156862746,.6862745098,.0039215686,.3098039216,.3137254901960784,.7058823529,.0039215686,.2901960784,.3176470588235294,.7254901961,.0039215686,.2705882353,.3215686274509804,.7450980392,.0039215686,.2509803922,.3254901960784314,.7647058824,.0039215686,.2352941176,.32941176470588235,.7843137255,.0039215686,.2156862745,.3333333333333333,.8039215686,.0039215686,.1960784314,.33725490196078434,.8235294118,.0039215686,.1764705882,.3411764705882353,.8470588235,.0039215686,.1568627451,.34509803921568627,.8666666667,.0039215686,.137254902,.34901960784313724,.8862745098,.0039215686,.1176470588,.35294117647058826,.9058823529,.0039215686,.0980392157,.3568627450980392,.9294117647,.0039215686,.0784313725,.3607843137254902,.9490196078,.0039215686,.0588235294,.36470588235294116,.968627451,.0039215686,.0392156863,.3686274509803922,.9921568627,.0039215686,.0235294118,.37254901960784315,.9529411765,.0039215686,.0588235294,.3764705882352941,.9529411765,.0078431373,.0549019608,.3803921568627451,.9529411765,.0156862745,.0549019608,.3843137254901961,.9529411765,.0235294118,.0549019608,.38823529411764707,.9529411765,.031372549,.0549019608,.39215686274509803,.9529411765,.0352941176,.0549019608,.396078431372549,.9529411765,.0431372549,.0549019608,.4,.9529411765,.0509803922,.0549019608,.403921568627451,.9529411765,.0588235294,.0549019608,.40784313725490196,.9529411765,.062745098,.0549019608,.4117647058823529,.9529411765,.0705882353,.0549019608,.41568627450980394,.9529411765,.0784313725,.0509803922,.4196078431372549,.9529411765,.0862745098,.0509803922,.4235294117647059,.9568627451,.0941176471,.0509803922,.42745098039215684,.9568627451,.0980392157,.0509803922,.43137254901960786,.9568627451,.1058823529,.0509803922,.43529411764705883,.9568627451,.1137254902,.0509803922,.4392156862745098,.9568627451,.1215686275,.0509803922,.44313725490196076,.9568627451,.1254901961,.0509803922,.4470588235294118,.9568627451,.1333333333,.0509803922,.45098039215686275,.9568627451,.1411764706,.0509803922,.4549019607843137,.9568627451,.1490196078,.0470588235,.4588235294117647,.9568627451,.1568627451,.0470588235,.4627450980392157,.9568627451,.1607843137,.0470588235,.4666666666666667,.9568627451,.168627451,.0470588235,.4705882352941177,.9607843137,.1764705882,.0470588235,.4745098039215686,.9607843137,.1843137255,.0470588235,.4784313725490197,.9607843137,.1882352941,.0470588235,.48235294117647065,.9607843137,.1960784314,.0470588235,.48627450980392156,.9607843137,.2039215686,.0470588235,.49019607843137253,.9607843137,.2117647059,.0470588235,.49411764705882355,.9607843137,.2196078431,.0431372549,.4980392156862745,.9607843137,.2235294118,.0431372549,.5019607843137255,.9607843137,.231372549,.0431372549,.5058823529411764,.9607843137,.2392156863,.0431372549,.5098039215686274,.9607843137,.2470588235,.0431372549,.5137254901960784,.9607843137,.2509803922,.0431372549,.5176470588235295,.9647058824,.2549019608,.0431372549,.5215686274509804,.9647058824,.262745098,.0431372549,.5254901960784314,.9647058824,.2705882353,.0431372549,.5294117647058824,.9647058824,.2745098039,.0431372549,.5333333333333333,.9647058824,.2823529412,.0392156863,.5372549019607843,.9647058824,.2901960784,.0392156863,.5411764705882353,.9647058824,.2980392157,.0392156863,.5450980392156862,.9647058824,.3058823529,.0392156863,.5490196078431373,.9647058824,.3098039216,.0392156863,.5529411764705883,.9647058824,.3176470588,.0392156863,.5568627450980392,.9647058824,.3254901961,.0392156863,.5607843137254902,.9647058824,.3333333333,.0392156863,.5647058823529412,.9647058824,.337254902,.0392156863,.5686274509803921,.968627451,.3450980392,.0392156863,.5725490196078431,.968627451,.3529411765,.0352941176,.5764705882352941,.968627451,.3607843137,.0352941176,.5803921568627451,.968627451,.368627451,.0352941176,.5843137254901961,.968627451,.3725490196,.0352941176,.5882352941176471,.968627451,.3803921569,.0352941176,.592156862745098,.968627451,.3882352941,.0352941176,.596078431372549,.968627451,.3960784314,.0352941176,.6,.968627451,.4,.0352941176,.6039215686274509,.968627451,.4078431373,.0352941176,.6078431372549019,.968627451,.4156862745,.0352941176,.611764705882353,.968627451,.4235294118,.031372549,.615686274509804,.9725490196,.431372549,.031372549,.6196078431372549,.9725490196,.4352941176,.031372549,.6235294117647059,.9725490196,.4431372549,.031372549,.6274509803921569,.9725490196,.4509803922,.031372549,.6313725490196078,.9725490196,.4588235294,.031372549,.6352941176470588,.9725490196,.462745098,.031372549,.6392156862745098,.9725490196,.4705882353,.031372549,.6431372549019608,.9725490196,.4784313725,.031372549,.6470588235294118,.9725490196,.4862745098,.031372549,.6509803921568628,.9725490196,.4941176471,.0274509804,.6549019607843137,.9725490196,.4980392157,.0274509804,.6588235294117647,.9725490196,.5058823529,.0274509804,.6627450980392157,.9764705882,.5137254902,.0274509804,.6666666666666666,.9764705882,.5215686275,.0274509804,.6705882352941176,.9764705882,.5254901961,.0274509804,.6745098039215687,.9764705882,.5333333333,.0274509804,.6784313725490196,.9764705882,.5411764706,.0274509804,.6823529411764706,.9764705882,.5490196078,.0274509804,.6862745098039216,.9764705882,.5529411765,.0274509804,.6901960784313725,.9764705882,.5607843137,.0235294118,.6941176470588235,.9764705882,.568627451,.0235294118,.6980392156862745,.9764705882,.5764705882,.0235294118,.7019607843137254,.9764705882,.5843137255,.0235294118,.7058823529411765,.9764705882,.5882352941,.0235294118,.7098039215686275,.9764705882,.5960784314,.0235294118,.7137254901960784,.9803921569,.6039215686,.0235294118,.7176470588235294,.9803921569,.6117647059,.0235294118,.7215686274509804,.9803921569,.6156862745,.0235294118,.7254901960784313,.9803921569,.6235294118,.0235294118,.7294117647058823,.9803921569,.631372549,.0196078431,.7333333333333333,.9803921569,.6392156863,.0196078431,.7372549019607844,.9803921569,.6470588235,.0196078431,.7411764705882353,.9803921569,.6509803922,.0196078431,.7450980392156863,.9803921569,.6588235294,.0196078431,.7490196078431373,.9803921569,.6666666667,.0196078431,.7529411764705882,.9803921569,.6745098039,.0196078431,.7568627450980392,.9803921569,.6784313725,.0196078431,.7607843137254902,.9843137255,.6862745098,.0196078431,.7647058823529411,.9843137255,.6941176471,.0196078431,.7686274509803922,.9843137255,.7019607843,.0156862745,.7725490196078432,.9843137255,.7098039216,.0156862745,.7764705882352941,.9843137255,.7137254902,.0156862745,.7803921568627451,.9843137255,.7215686275,.0156862745,.7843137254901961,.9843137255,.7294117647,.0156862745,.788235294117647,.9843137255,.737254902,.0156862745,.792156862745098,.9843137255,.7411764706,.0156862745,.796078431372549,.9843137255,.7490196078,.0156862745,.8,.9843137255,.7529411765,.0156862745,.803921568627451,.9843137255,.7607843137,.0156862745,.807843137254902,.9882352941,.768627451,.0156862745,.8117647058823529,.9882352941,.768627451,.0156862745,.8156862745098039,.9843137255,.7843137255,.0117647059,.8196078431372549,.9843137255,.8,.0117647059,.8235294117647058,.9843137255,.8156862745,.0117647059,.8274509803921568,.9803921569,.831372549,.0117647059,.8313725490196079,.9803921569,.8431372549,.0117647059,.8352941176470589,.9803921569,.8588235294,.0078431373,.8392156862745098,.9803921569,.8745098039,.0078431373,.8431372549019608,.9764705882,.8901960784,.0078431373,.8470588235294118,.9764705882,.9058823529,.0078431373,.8509803921568627,.9764705882,.9176470588,.0078431373,.8549019607843137,.9764705882,.9333333333,.0039215686,.8588235294117647,.9725490196,.9490196078,.0039215686,.8627450980392157,.9725490196,.9647058824,.0039215686,.8666666666666667,.9725490196,.9803921569,.0039215686,.8705882352941177,.9725490196,.9960784314,.0039215686,.8745098039215686,.9725490196,.9960784314,.0039215686,.8784313725490196,.9725490196,.9960784314,.0352941176,.8823529411764706,.9725490196,.9960784314,.0666666667,.8862745098039215,.9725490196,.9960784314,.0980392157,.8901960784313725,.9725490196,.9960784314,.1294117647,.8941176470588236,.9725490196,.9960784314,.1647058824,.8980392156862745,.9764705882,.9960784314,.1960784314,.9019607843137255,.9764705882,.9960784314,.2274509804,.9058823529411765,.9764705882,.9960784314,.2549019608,.9098039215686274,.9764705882,.9960784314,.2901960784,.9137254901960784,.9764705882,.9960784314,.3215686275,.9176470588235294,.9803921569,.9960784314,.3529411765,.9215686274509803,.9803921569,.9960784314,.3843137255,.9254901960784314,.9803921569,.9960784314,.4156862745,.9294117647058824,.9803921569,.9960784314,.4509803922,.9333333333333333,.9803921569,.9960784314,.4823529412,.9372549019607843,.9843137255,.9960784314,.5137254902,.9411764705882354,.9843137255,.9960784314,.5450980392,.9450980392156864,.9843137255,.9960784314,.5803921569,.9490196078431372,.9843137255,.9960784314,.6117647059,.9529411764705882,.9843137255,.9960784314,.6431372549,.9568627450980394,.9882352941,.9960784314,.6745098039,.9607843137254903,.9882352941,.9960784314,.7058823529,.9647058823529413,.9882352941,.9960784314,.7411764706,.9686274509803922,.9882352941,.9960784314,.768627451,.9725490196078431,.9882352941,.9960784314,.8,.9764705882352941,.9921568627,.9960784314,.831372549,.9803921568627451,.9921568627,.9960784314,.8666666667,.984313725490196,.9921568627,.9960784314,.8980392157,.9882352941176471,.9921568627,.9960784314,.9294117647,.9921568627450981,.9921568627,.9960784314,.9607843137,.996078431372549,.9960784314,.9960784314,.9607843137,1,.9960784314,.9960784314,.9607843137],description:"Siemens"}];var Je=n(99737),Qe=n(10182),et=n(44646),tt=n(2847),nt=n(49035);const{registerColormap:ot}=s.utilities.colormap;async function it({servicesManager:e,commandsManager:t,extensionManager:n,appConfig:o}){await(0,s.init)({peerImport:o.peerImport}),s.setUseCPURendering(Boolean(o.useCPURendering)),s.setConfiguration({...s.getConfiguration(),rendering:{...s.getConfiguration().rendering,strictZSpacingForVolumeViewport:o.strictZSpacingForVolumeViewport}});const{maxCacheSize:i}=o;i&&s.cache.setMaxCacheSize(i),function(e={}){l.CrosshairsTool.isAnnotation=!1,l.ReferenceLinesTool.isAnnotation=!1,l.AdvancedMagnifyTool.isAnnotation=!1,l.PlanarFreehandContourSegmentationTool.isAnnotation=!1,(0,l.init)(e),(0,l.addTool)(l.PanTool),(0,l.addTool)(l.WindowLevelTool),(0,l.addTool)(l.StackScrollTool),(0,l.addTool)(l.VolumeRotateTool),(0,l.addTool)(l.ZoomTool),(0,l.addTool)(l.ProbeTool),(0,l.addTool)(l.MIPJumpToClickTool),(0,l.addTool)(l.LengthTool),(0,l.addTool)(l.RectangleROITool),(0,l.addTool)(l.RectangleROIThresholdTool),(0,l.addTool)(l.RectangleROIStartEndThresholdTool),(0,l.addTool)(l.EllipticalROITool),(0,l.addTool)(l.CircleROITool),(0,l.addTool)(l.BidirectionalTool),(0,l.addTool)(l.ArrowAnnotateTool),(0,l.addTool)(l.DragProbeTool),(0,l.addTool)(l.AngleTool),(0,l.addTool)(l.CobbAngleTool),(0,l.addTool)(l.MagnifyTool),(0,l.addTool)(l.CrosshairsTool),(0,l.addTool)(l.RectangleScissorsTool),(0,l.addTool)(l.SphereScissorsTool),(0,l.addTool)(l.CircleScissorsTool),(0,l.addTool)(l.BrushTool),(0,l.addTool)(l.PaintFillTool),(0,l.addTool)(l.ReferenceLinesTool),(0,l.addTool)(E),(0,l.addTool)(l.TrackballRotateTool),(0,l.addTool)(M),(0,l.addTool)(l.AdvancedMagnifyTool),(0,l.addTool)(l.UltrasoundDirectionalTool),(0,l.addTool)(l.PlanarFreehandROITool),(0,l.addTool)(l.SplineROITool),(0,l.addTool)(l.LivewireContourTool),(0,l.addTool)(l.OrientationMarkerTool),(0,l.addTool)(l.WindowLevelRegionTool),(0,l.addTool)(l.PlanarFreehandContourSegmentationTool),(0,l.addTool)(q);const t=l.annotation.config.style.getDefaultToolStyles();l.annotation.config.style.setDefaultToolStyles({global:{...t.global,textBoxFontSize:"15px",lineWidth:"1.5"}})}(),s.Settings.getRuntimeSettings().set("useCursors",Boolean(o.useCursors));const{userAuthenticationService:a,customizationService:r,uiModalService:c,uiNotificationService:d,cornerstoneViewportService:m,hangingProtocolService:S,viewportGridService:v}=e.services;window.services=e.services,window.extensionManager=n,window.commandsManager=t,o.showCPUFallbackMessage&&s.getShouldUseCPURendering()&&function(e,t){const n=t=>{if(100===t)return e.show({content:rt,title:"OHIF Fell Back to CPU Rendering"}),!0},{unsubscribe:o}=t.subscribe(t.EVENTS.PROTOCOL_CHANGED,()=>{n(100)&&o()})}(c,S);const{getPresentationId:y}=Qe.I.getState(),{getPresentationId:f}=tt.v.getState(),{getPresentationId:w}=et.q.getState();v.addPresentationIdProvider("positionPresentationId",w),v.addPresentationIdProvider("lutPresentationId",y),v.addPresentationIdProvider("segmentationPresentationId",f),l.segmentation.config.style.setStyle({type:Je.SegmentationRepresentations.Contour},{renderFill:!1});const T=p.Ay.classes.MetadataProvider;s.volumeLoader.registerVolumeLoader("cornerstoneStreamingImageVolume",u.FC),s.volumeLoader.registerVolumeLoader("cornerstoneStreamingDynamicImageVolume",u.Mr);const D={interleaveCenter:Ue,interleaveTopToBottom:ke,nth:Le};Object.entries(D).forEach(([e,t])=>{S.registerImageLoadStrategy(e,at(t))}),s.metaData.addProvider(s.utilities.calibratedPixelSpacingMetadataProvider.get.bind(s.utilities.calibratedPixelSpacingMetadataProvider)),s.metaData.addProvider(T.get.bind(T),9999),s.imageLoadPoolManager.maxNumRequests={[g.A.Interaction]:o?.maxNumRequests?.interaction||10,[g.A.Thumbnail]:o?.maxNumRequests?.thumbnail||5,[g.A.Prefetch]:o?.maxNumRequests?.prefetch||5,[g.A.Compute]:o?.maxNumRequests?.compute||10},function(e,t,n){I("cornerstoneStreamingImageVolume",u.FC),I("cornerstoneStreamingDynamicImageVolume",u.Mr),h.Ay.init({maxWebWorkers:Math.min(Math.max(navigator.hardwareConcurrency-1,1),t.maxNumberOfWebWorkers),beforeSend:function(t){const o=n.getActiveDataSource()?.[0].getConfig()??{},i=e.getAuthorizationHeader(),a={Accept:p.Wp.generateAcceptHeader(o.acceptHeader,o.requestTransferSyntaxUID,o.omitQuotationForMultipartRequest)};return i&&Object.assign(a,i),a},errorInterceptor:e=>{p.r_.getHTTPErrorHandler(e)}})}(a,o,n),this.measurementServiceSource=Oe(e),Me(e),Re(e),S.subscribe(S.EVENTS.CUSTOM_IMAGE_LOAD_PERFORMED,e=>{const{lutPresentationStore:t}=Qe.I.getState(),{segmentationPresentationStore:n}=tt.v.getState(),{positionPresentationStore:o}=et.q.getState();for(const i of e.entries()){const[e,a]=i,r=m.getCornerstoneViewport(e),s=m.getViewportInfo(e),{presentationIds:l}=s.getViewportOptions(),c={positionPresentation:o[l?.positionPresentationId],lutPresentation:t[l?.lutPresentationId],segmentationPresentation:n[l?.segmentationPresentationId]};m.setVolumesForViewport(r,a,c)}}),v.subscribe(v.EVENTS.GRID_SIZE_CHANGED,()=>{m.resize(!0)}),We({cornerstoneViewportService:m,customizationService:r,commandsManager:t}),qe({customizationService:r,commandsManager:t});const b=({detail:e})=>{p.r_.getHTTPErrorHandler()(e.error)};s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOAD_FAILED,b),s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOAD_ERROR,b),s.eventTarget.addEventListener(s.EVENTS.ELEMENT_ENABLED,function(e){const{element:n}=e.detail;n.addEventListener(s.EVENTS.CAMERA_RESET,e=>{const{element:n}=e.detail,o=(0,s.getEnabledElement)(n);if(!o)return;const{viewportId:i}=o;t.runCommand("resetCrosshairs",{viewportId:i})}),function({element:e}){if(!Ye.length){const{W:e}=p.fX;Ye.push(e.DISPLAY_SETS_TO_ALL_IMAGES,e.DISPLAY_SETS_TO_FIRST_IMAGE,e.STUDY_TO_FIRST_IMAGE)}Ye.find(e=>p.Rm.timingKeys[e])&&(Ke.viewportsWaiting+=1,e.addEventListener(s.EVENTS.IMAGE_RENDERED,Ze))}({element:n})}.bind(null)),Xe.forEach(ot),s.eventTarget.addEventListenerDebounced(s.EVENTS.ERROR_EVENT,({detail:e})=>{d.show({title:e.type,message:e.message,type:"error"})},100),function(e){const t=new Map;s.eventTarget.addEventListener(s.EVENTS.WEB_WORKER_PROGRESS,({detail:n})=>{const{progress:o,type:i,id:a}=n,r=`${i}-${a}`;if(0!==o||t.has(r)){if(100===o){const{resolve:e}=t.get(r);e({progress:o,type:i}),t.delete(r)}}else{const n=new Promise((e,n)=>{t.set(r,{resolve:e,reject:n})});e.show({id:r,title:`${i}`,message:`${i}: ${o}%`,autoClose:!1,promise:n,promiseMessages:{loading:"Computing...",success:"Completed successfully",error:"Web Worker failed"}})}})}(e.services.uiNotificationService)}window.cornerstone=s,window.cornerstoneTools=l;const at=e=>t=>{const n=nt.imageRetrieveMetadataProvider.clone();nt.imageRetrieveMetadataProvider.clear();try{return e(t)}finally{setTimeout(()=>{nt.imageRetrieveMetadataProvider.restore(n)},10)}};function rt(){return r.createElement("div",null,r.createElement("p",null,"Your computer does not have enough GPU power to support the default GPU rendering mode. OHIF has switched to CPU rendering mode. Please note that CPU rendering does not support all features such as Volume Rendering, Multiplanar Reconstruction, and Segmentation Overlays."))}const st={CT:[{description:"Soft tissue",window:"400",level:"40"},{description:"Lung",window:"1500",level:"-600"},{description:"Liver",window:"150",level:"90"},{description:"Bone",window:"2500",level:"480"},{description:"Brain",window:"80",level:"40"}],PT:[{description:"Default",window:"5",level:"2.5"},{description:"SUV",window:"0",level:"3"},{description:"SUV",window:"0",level:"5"},{description:"SUV",window:"0",level:"7"},{description:"SUV",window:"0",level:"8"},{description:"SUV",window:"0",level:"10"},{description:"SUV",window:"0",level:"15"}]};var lt=n(5791);const{VIEWPORT_PRESETS:ct}=s.CONSTANTS,dt={active:[{toolName:Y.WindowLevel,bindings:[{mouseButton:l.Enums.MouseBindings.Primary}]},{toolName:Y.Pan,bindings:[{mouseButton:l.Enums.MouseBindings.Auxiliary}]},{toolName:Y.Zoom,bindings:[{mouseButton:l.Enums.MouseBindings.Secondary}]},{toolName:Y.StackScroll,bindings:[{mouseButton:l.Enums.MouseBindings.Wheel}]}],enabled:[{toolName:Y.PlanarFreehandContourSegmentation,configuration:{displayOnePointAsCrosshairs:!0}}]};const mt=function(){return[{name:"default",value:[lt.JX,{id:"cornerstone.overlayViewportTools",tools:dt},{id:"cornerstone.windowLevelPresets",presets:st},{id:"cornerstone.colorbar",width:"16px",colorbarTickPosition:"left",colormaps:Xe,colorbarContainerPosition:"right",colorbarInitialColormap:"Grayscale"},{id:"cornerstone.3dVolumeRendering",volumeRenderingPresets:ct,volumeRenderingQualityRange:{min:1,max:4,step:1}},{id:"cornerstone.measurements",Angle:{displayText:[],report:[]},CobbAngle:{displayText:[],report:[]},ArrowAnnotate:{displayText:[],report:[]},RectangleROi:{displayText:[],report:[]},CircleROI:{displayText:[],report:[]},EllipticalROI:{displayText:[],report:[]},Bidirectional:{displayText:[],report:[]},Length:{displayText:[],report:[]},LivewireContour:{displayText:[],report:[]},SplineROI:{displayText:[{displayName:"Area",value:"area",type:"value"},{value:"areaUnits",for:["area"],type:"unit"}],report:[{displayName:"Area",value:"area",type:"value"},{displayName:"Unit",value:"areaUnits",type:"value"}]},PlanarFreehandROI:{displayTextOpen:[{displayName:"Length",value:"length",type:"value"}],displayText:[{displayName:"Mean",value:"mean",type:"value"},{displayName:"Max",value:"max",type:"value"},{displayName:"Area",value:"area",type:"value"},{value:"pixelValueUnits",for:["mean","max"],type:"unit"},{value:"areaUnits",for:["area"],type:"unit"}],report:[{displayName:"Mean",value:"mean",type:"value"},{displayName:"Max",value:"max",type:"value"},{displayName:"Area",value:"area",type:"value"},{displayName:"Unit",value:"unit",type:"value"}]}}]}]};var pt=n(3823),ut=n(91037),gt=n(93213);const ht=512,It=1e4,St="cornerstone-viewport-download-form",vt=({onClose:e,activeViewportId:t,cornerstoneViewportService:n})=>{const o=(0,v.kJ)(t),i=o?.element,a=(0,s.getEnabledElement)(i),{viewportId:c,renderingEngineId:d,viewport:m}=a,p=l.ToolGroupManager.getToolGroupForViewport(c,d),u=Object.keys(p.toolOptions).reduce((e,t)=>{const n=p.toolOptions[t],{mode:o,bindings:i}=n;return{...e,[t]:{mode:o,bindings:i}}},{});(0,r.useEffect)(()=>()=>{Object.keys(u).forEach(e=>{const{mode:t,bindings:n}=u[e];p.setToolMode(e,t,{bindings:n})})},[]);return r.createElement(gt.VS,{onClose:e,minimumSize:100,maximumSize:It,defaultSize:ht,activeViewportElement:i,enableViewport:e=>{if(e){const{renderingEngine:t,viewport:n}=(0,s.getEnabledElement)(i),o={viewportId:St,element:e,type:n.type,defaultOptions:{background:n.defaultOptions.background,orientation:n.defaultOptions.orientation}};t.enableElement(o)}},disableViewport:e=>{if(e){const{renderingEngine:t}=(0,s.getEnabledElement)(e);return new Promise(e=>{t.disableElement(St)})}},updateViewportPreview:(e,t,n)=>new Promise(t=>{const o=(0,s.getEnabledElement)(e),{viewport:i,renderingEngine:a}=o;a.resize(),i.render(),e.addEventListener(s.Enums.Events.IMAGE_RENDERED,function o(a){const r=(0,s.getEnabledElement)(a.target),{viewport:l}=r,{element:c}=l,d=(0,s.getOrCreateCanvas)(c),p="image/"+n,u=d.toDataURL(p,1);let g=c.offsetHeight,h=c.offsetWidth;if(g>ht||h>ht){const e=ht/Math.max(g,h);h*=e,g*=e}t({dataUrl:u,width:g,height:h}),e.removeEventListener(s.Enums.Events.IMAGE_RENDERED,o),i.resetCamera();const I=m.getViewPresentation();i.setView&&i.setView(m.getViewReference(),I),i.render()})}),loadImage:(e,t,o,i)=>new Promise(a=>{if(e&&t){const t=(0,s.getEnabledElement)(e);if(!t)return;const{viewport:r}=t,l=n.getRenderingEngine().getViewport(St);if(l instanceof s.StackViewport){const e=r.getCurrentImageId(),t=r.getProperties();l.setStack([e]).then(()=>{try{l.setProperties(t);const e=Math.min(o||image.width,It),n=Math.min(i||image.height,It);a({width:e,height:n})}catch(e){console.warn("Unable to set properties",e)}})}else if(l instanceof s.BaseVolumeViewport){r.getActors().forEach(e=>{l.addActor(e)}),l.render();const e=Math.min(o||image.width,It),t=Math.min(i||image.height,It);a({width:e,height:t})}}}),toggleAnnotations:(e,t,n)=>{const o=(0,s.getEnabledElement)(n),i=(0,s.getEnabledElement)(t),{viewportId:a,renderingEngineId:r}=o,{viewportId:c}=i;if(!o||!i)return;const d=l.ToolGroupManager.getToolGroupForViewport(a,r);d.addViewport(c,r),Object.keys(d.getToolInstances()).forEach(t=>{if(e&&"Crosshairs"!==t)try{d.setToolEnabled(t)}catch(e){console.log(e)}else d.setToolDisabled(t)})},downloadBlob:(e,t)=>{const n=`${e}.${t}`,o=document.querySelector(`div[data-viewport-uid="${St}"]`);(0,ut.A)(o).then(e=>{const o=document.createElement("a");o.download=n,o.href=e.toDataURL(t,1),o.click()})}})};function yt(e,t){let{viewports:n}=e.getState();return n=[...n.values()],n=n.filter(e=>e.displaySetInstanceUIDs&&e.displaySetInstanceUIDs.length),n=n.filter(e=>{const{displaySetInstanceUIDs:n}=e;for(const e of n){const n=t.getDisplaySetByUID(e);return!(!n||!n.isReconstructable)}}),n}const ft=e=>`VOI_SYNC_${e}`;function wt(e,t,n){const{syncGroupService:o,cornerstoneViewportService:i}=n.services;e.forEach(e=>{const{viewportId:n}=e.viewportOptions,a=i.getCornerstoneViewport(n);a&&o.removeViewportFromSyncGroup(a.id,a.getRenderingEngine().id,t)})}var Et=n(68578);const Tt={imageSlice:function({servicesManager:e,viewports:t,syncId:n}){const{syncGroupService:o,viewportGridService:i,displaySetService:a,cornerstoneViewportService:r}=e.services;n||="IMAGE_SLICE_SYNC";const s=t||yt(i,a);if(s.some(e=>!!o.getSynchronizersForViewport(e.viewportOptions.viewportId).find(e=>e.id===n)))return function(e,t){const{syncGroupService:n,viewportGridService:o,displaySetService:i,cornerstoneViewportService:a}=t.services,r=yt(o,i);r.forEach(t=>{const{viewportId:o}=t.viewportOptions,i=a.getCornerstoneViewport(o);i&&n.removeViewportFromSyncGroup(i.id,i.getRenderingEngine().id,e)})}(n,e);s.forEach(e=>{const{viewportId:t}=e.viewportOptions,i=r.getCornerstoneViewport(t);i&&o.addViewportToSyncGroup(t,i.getRenderingEngine().id,{type:"imageSlice",id:n,source:!0,target:!0})})},voi:function({servicesManager:e,viewports:t,syncId:n}){const{syncGroupService:o,viewportGridService:i,displaySetService:a,cornerstoneViewportService:r}=e.services,s=t||function(e,t){let{viewports:n}=e.getState();return n=[...n.values()],n.reduce((e,n)=>{const{displaySetInstanceUIDs:o}=n,i=o[0],a=t.getDisplaySetByUID(i).Modality;return e[a]||(e[a]=[]),e[a].push(n),e},{})}(i,a);for(const[t,i]of Object.entries(s)){const a=n||ft(t);if(i.some(e=>!!o.getSynchronizersForViewport(e.viewportOptions.viewportId).find(e=>e.id===a)))return wt(i,a,e);i.forEach(e=>{const{viewportId:t}=e.viewportOptions,n=r.getCornerstoneViewport(t);n&&o.addViewportToSyncGroup(t,n.getRenderingEngine().id,{type:"voi",id:a,source:!0,target:!0})})}}};const Dt=function({servicesManager:e,extensionManager:t,commandsManager:n}){const{viewportGridService:o,toolGroupService:i,cineService:a,uiDialogService:r,cornerstoneViewportService:c,uiNotificationService:d,measurementService:m,customizationService:p,colorbarService:u,hangingProtocolService:g,syncGroupService:h,cornerstoneCacheService:I}=e.services,{measurementServiceSource:v}=this;function f(){return y(o)}function w(){const e=f();return i.getToolGroupForViewport(e.id)}const E={showCornerstoneContextMenu:e=>{const t=f()?.viewport?.element,o={...e,element:t},{useSelectedAnnotation:i,nearbyToolData:a,event:r}=o;if(i&&!a){const e=ie();if(!(!o.allowedSelectedTools||o.allowedSelectedTools.includes(e?.metadata?.toolName)))return;o.nearbyToolData=e}o.defaultPointsPosition=[],o.selectorProps={toolName:o.nearbyToolData?.metadata?.toolName,value:o.nearbyToolData,uid:o.nearbyToolData?.annotationUID,nearbyToolData:o.nearbyToolData,event:r,...o.selectorProps},n.run(e,o)},updateStoredSegmentationPresentation:({displaySet:e,type:t})=>{const{addSegmentationPresentationItem:n}=tt.v.getState();n(e.referencedDisplaySetInstanceUID,{segmentationId:e.displaySetInstanceUID,hydrated:!0,type:t})},updateStoredPositionPresentation:({viewportId:e,displaySetInstanceUID:t})=>{const n=c.getPresentations(e),{positionPresentationStore:o,setPositionPresentation:i,getPositionPresentationId:a}=et.q.getState(),r=Object.entries(o).find(([n,o])=>n.includes(t)&&o.viewportId===e)?.[0];if(r)return void i(r,n.positionPresentation);i(a({displaySetInstanceUIDs:[t],viewportId:e}),n.positionPresentation)},getNearbyToolData:({nearbyToolData:e,element:t,canvasCoordinates:n})=>e??l.utilities.getAnnotationNearPoint(t,n),getNearbyAnnotation({element:e,canvasCoordinates:t}){const n=E.getNearbyToolData({nearbyToolData:null,element:e,canvasCoordinates:t});return n?.metadata?.toolName&&(t=>{const n=(0,s.getEnabledElement)(e);if(!n)return;const{renderingEngineId:o,viewportId:i}=n,a=l.ToolGroupManager.getToolGroupForViewport(i,o).getToolInstance(t);return a?.constructor?.isAnnotation??!0})(n.metadata.toolName)?n:null},deleteMeasurement:({uid:e})=>{e&&v.remove(e)},setMeasurementLabel:({uid:e})=>{const t=p.get("measurementLabels"),n=m.getMeasurement(e);(0,S.showLabelAnnotationPopup)(n,r,t).then(t=>{m.update(e,{...t},!0)})},updateMeasurement:e=>{const{code:t,uid:n,textLabel:o,label:i}=e,a={...m.getMeasurement(n)};if(void 0!==o&&(a.label=o),void 0!==t){const e=t.type||"finding";if(t.ref&&!t.CodeValue){const e=t.ref.indexOf(":");t.CodeValue=t.ref.substring(e+1),t.CodeMeaning=t.text||i,t.CodingSchemeDesignator=t.ref.substring(0,e)}a[e]=t,"finding"!==e&&(a.findingSites?(a.findingSites=a.findingSites.filter(t=>t.type!==e),a.findingSites.push(t)):a.findingSites=[t])}m.update(a.uid,a,!0)},getActiveViewportEnabledElement:f,setViewportActive:({viewportId:e})=>{c.getViewportInfo(e)?o.setActiveViewportId(e):console.warn("No viewport found for viewportId:",e)},arrowTextCallback:({callback:e,data:t,uid:n})=>{const o=p.get("measurementLabels");(0,S.callLabelAutocompleteDialog)(r,e,{},o)},toggleCine:()=>{const{viewports:e}=o.getState(),{isCineEnabled:t}=a.getState();a.setIsCineEnabled(!t),e.forEach((e,t)=>a.setCine({id:t,isPlaying:!1}))},setViewportWindowLevel({viewportId:e,window:t,level:n}){const o=Number(t),i=Number(n),a=c.getRenderingEngine().getViewport(e),{lower:r,upper:l}=s.utilities.windowLevel.toLowHighRange(o,i);a.setProperties({voiRange:{upper:l,lower:r}}),a.render()},toggleViewportColorbar:({viewportId:e,displaySetInstanceUIDs:t,options:n={}})=>{u.hasColorbar(e)?u.removeColorbar(e):u.addColorbar(e,t,n)},setWindowLevel(e){const{toolGroupId:t}=e,{viewportId:n}=f(),o=i.getToolGroupForViewport(n);t&&t!==o||E.setViewportWindowLevel({...e,viewportId:n})},setToolEnabled:({toolName:e,toggle:t,toolGroupId:n})=>{const{viewports:a}=o.getState();if(!a.size)return;const r=i.getToolGroup(n??null);if(!r||!r.hasTool(e))return;const s=r.getToolOptions(e).mode===l.Enums.ToolModes.Enabled;t&&s?r.setToolDisabled(e):r.setToolEnabled(e);c.getRenderingEngine().render()},toggleEnabledDisabledToolbar({value:e,itemId:t,toolGroupId:n}){const o=t||e;n=n??w();const a=i.getToolGroup(n);if(!a||!a.hasTool(o))return;a.getToolOptions(o).mode===l.Enums.ToolModes.Enabled?a.setToolDisabled(o):a.setToolEnabled(o)},toggleActiveDisabledToolbar({value:e,itemId:t,toolGroupId:n}){const o=t||e;n=n??w();const a=i.getToolGroup(n);if(!a||!a.hasTool(o))return;const r=[l.Enums.ToolModes.Active,l.Enums.ToolModes.Enabled,l.Enums.ToolModes.Passive].includes(a.getToolOptions(o).mode);if(r?a.setToolDisabled(o):E.setToolActive({toolName:o,toolGroupId:n}),r){const e=a.getPrevActivePrimaryToolName();e!==o&&E.setToolActive({toolName:e,toolGroupId:n})}},setToolActiveToolbar:({value:e,itemId:t,toolName:n,toolGroupIds:o=[]})=>{n=n||t||e,(o=o.length?o:i.getToolGroupIds()).forEach(e=>{E.setToolActive({toolName:n,toolGroupId:e})})},setToolActive:({toolName:e,toolGroupId:t=null})=>{const{viewports:n}=o.getState();if(!n.size)return;const a=i.getToolGroup(t);if(!a)return;if(!a.hasTool(e))return;const r=a.getActivePrimaryMouseButtonTool();if(r){const e=a.getToolConfiguration(r);e?.disableOnPassive?a.setToolDisabled(r):a.setToolPassive(r)}a.setToolActive(e,{bindings:[{mouseButton:l.Enums.MouseBindings.Primary}]})},showDownloadViewportModal:()=>{const{activeViewportId:t}=o.getState();if(!c.getCornerstoneViewport(t))return void d.show({title:"Download Image",message:"Image cannot be downloaded",type:"error"});const{uiModalService:n}=e.services;n&&n.show({content:vt,title:"Download High Quality Image",contentProps:{activeViewportId:t,onClose:n.hide,cornerstoneViewportService:c},containerDimensions:"w-[70%] max-w-[900px]"})},rotateViewport:({rotation:e})=>{const t=f();if(!t)return;const{viewport:n}=t;if(n instanceof s.BaseVolumeViewport){const t=n.getCamera(),o=e*Math.PI/180,i=pt.pB.identity(new Float32Array(16));pt.pB.rotate(i,i,o,t.viewPlaneNormal);const a=pt.eR.transformMat4(pt.eR.create(),t.viewUp,i);n.setCamera({viewUp:a}),n.render()}else if(void 0!==n.getRotation){const t=n.getViewPresentation(),{rotation:o}=t,i=(o+e)%360;n.setViewPresentation({rotation:i}),n.render()}},flipViewportHorizontal:()=>{const e=f();if(!e)return;const{viewport:t}=e,{flipHorizontal:n}=t.getCamera();t.setCamera({flipHorizontal:!n}),t.render()},flipViewportVertical:()=>{const e=f();if(!e)return;const{viewport:t}=e,{flipVertical:n}=t.getCamera();t.setCamera({flipVertical:!n}),t.render()},invertViewport:({element:e})=>{let t;if(t=void 0===e?f():e,!t)return;const{viewport:n}=t,{invert:o}=n.getProperties();n.setProperties({invert:!o}),n.render()},resetViewport:()=>{const e=f();if(!e)return;const{viewport:t}=e;t.resetProperties?.(),t.resetCamera(),t.render()},scaleViewport:({direction:e})=>{const t=f(),n=e>0?.9:1.1;if(!t)return;const{viewport:o}=t;if(o instanceof s.StackViewport)if(e){const{parallelScale:e}=o.getCamera();o.setCamera({parallelScale:e*n}),o.render()}else o.resetCamera(),o.render()},jumpToImage:({imageIndex:e,viewport:t})=>{let n;if(t)n=c.getCornerstoneViewport(t.id);else{const e=f();if(!e)return;n=e.viewport}let o=0;if(n instanceof s.StackViewport)o=n.getImageIds().length;else{if(!(n instanceof s.VolumeViewport))throw new Error("Unsupported viewport type");o=s.utilities.getImageSliceDataForVolumeViewport(n).numberOfSlices}const i=e<0?o+e:e;if(i>=o||i<0)throw new Error(`Can't jump to ${e}`);const a={imageIndex:i};s.utilities.jumpToSlice(n.element,a)},scroll:({direction:e})=>{const t=f();if(!t)return;const{viewport:n}=t,o={delta:e};s.utilities.scroll(n,o)},setAllViewportsColorMap:({window:e,level:t,toolGroupId:n})=>{const{viewportId:o}=f(),a=i.getToolGroupForViewport(o);if(n&&n!==a)return;const r=c.getRenderingEngine().getViewport(o);r.setProperties({colormap:"hot_iron"}),r.render()},setViewportColormap:({viewportId:e,displaySetInstanceUID:t,colormap:n,opacity:i=1,immediate:a=!1})=>{const r=c.getCornerstoneViewport(e);let l;const{viewportMatchDetails:d}=g.getActiveProtocol(),m=d.get(e)?.displaySetsInfo;if(m){const e=m.find(e=>e.displaySetInstanceUID===t);l=e?.displaySetOptions?.options?.colormap?.opacity}if(n={...n,opacity:l||i},r instanceof s.StackViewport&&r.setProperties({colormap:n}),r instanceof s.VolumeViewport){if(!t){const{viewports:n}=o.getState();t=n.get(e)?.displaySetInstanceUIDs[0]}const i=r.getVolumeId();r.setProperties({colormap:n},i)}a&&r.render()},changeActiveViewport:({direction:e=1})=>{const{activeViewportId:t,viewports:n}=o.getState(),i=Array.from(n.keys()),a=(i.indexOf(t)+e+i.length)%i.length;o.setActiveViewportId(i[a])},toggleSynchronizer:({type:t,viewports:n,syncId:o})=>{const i=h.getSynchronizer(o);if(i)return void(i.isDisabled()?i.setEnabled(!0):i.setEnabled(!1));const a=Tt[t];a&&a({servicesManager:e,viewports:n,syncId:o})},setSourceViewportForReferenceLinesTool:({viewportId:e})=>{if(!e){const{activeViewportId:t}=o.getState();e=t??"default"}const t=i.getToolGroupForViewport(e);t?.setToolConfiguration(l.ReferenceLinesTool.toolName,{sourceViewportId:e},!0);c.getRenderingEngine().render()},storePresentation:({viewportId:e})=>{c.storePresentation({viewportId:e})},updateVolumeData:({volume:e})=>{const{imageData:t,vtkOpenGLTexture:n}=e,o=t.getDimensions()[2];[...Array(o).keys()].forEach(e=>{n.setUpdatedFrame(e)}),t.modified()},attachProtocolViewportDataListener:({protocol:e,stageIndex:t})=>{const o=c.EVENTS.VIEWPORT_DATA_CHANGED,i=e.callbacks.onViewportDataInitialized,a=e.stages?.[t]?.viewports.length??1;let r=0;const{unsubscribe:s}=c.subscribe(o,e=>{r++,r===a&&(n.run(...i),s(o))})},setViewportPreset:({viewportId:e,preset:t})=>{const n=c.getCornerstoneViewport(e);n&&(n.setProperties({preset:t}),n.render())},setVolumeRenderingQulaity:({viewportId:e,volumeQuality:t})=>{const n=c.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],i=o.getMapper(),a=i.getInputData(),r=a.getDimensions(),s=a.getSpacing(),l=pt.eR.length(pt.eR.fromValues(r[0]*s[0],r[1]*s[1],r[2]*s[2]));let d=s.reduce((e,t)=>e+t)/3;d/=t>1?.5*t**2:1;const m=l/d+1;i.setMaximumSamplesPerRay(m),i.setSampleDistance(d),n.render()},shiftVolumeOpacityPoints:({viewportId:e,shift:t})=>{const n=c.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],i=o.getProperty().getScalarOpacity(0),a=[],r=i.getSize();for(let e=0;e<r;e++){const t=[0,0,0,0];i.getNodeValue(e,t),a.push(t)}a.forEach(e=>{e[0]+=t}),i.removeAllPoints(),a.forEach(e=>{i.addPoint(...e)}),n.render()},setVolumeLighting:({viewportId:e,options:t})=>{const n=c.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],i=o.getProperty();void 0!==t.shade&&i.setShade(t.shade),void 0!==t.ambient&&i.setAmbient(t.ambient),void 0!==t.diffuse&&i.setDiffuse(t.diffuse),void 0!==t.specular&&i.setSpecular(t.specular),n.render()},resetCrosshairs:({viewportId:e})=>{const t=[],n=e=>{const n=i.getToolGroup(e);t.push(n.getToolInstance("Crosshairs"))};if(e){n(i.getToolGroupForViewport(e).id)}else{i.getToolGroupIds().forEach(n)}t.forEach(e=>{e?.computeToolCenter()})},createLabelmapForViewport:async({viewportId:t,options:n={}})=>{const{viewportGridService:o,displaySetService:i,segmentationService:a}=e.services,{viewports:r}=o.getState(),c=t,d=r.get(c),m=n.displaySetInstanceUID||d.displaySetInstanceUIDs[0],p=a.getSegmentations(),u=n.label||`Segmentation ${p.length+1}`,g=n.segmentationId||`${s.utilities.uuidv4()}`,h=i.getDisplaySetByUID(m),I=await a.createLabelmapForDisplaySet(h,{label:u,segmentationId:g,segments:n.createInitialSegment?{1:{label:"Segment 1",active:!0,color:[255,0,0],opacity:255,visibility:!0,isLocked:!1}}:{}});return await a.addSegmentationRepresentation(t,{segmentationId:g,type:l.Enums.SegmentationRepresentations.Labelmap}),I},setActiveSegmentation:({segmentationId:t,viewportId:n})=>{const{viewportGridService:o,segmentationService:i}=e.services;n=n||o.getActiveViewportId(),i.setActiveSegmentation(n,t)},addSegmentCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.addSegment(t)},setActiveSegmentAndCenterCommand:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o}=e.services;o.setActiveSegment(t,n),o.jumpToSegmentCenter(t,n)},toggleSegmentVisibilityCommand:({segmentationId:t,segmentIndex:n,type:o,viewportId:i})=>{const{segmentationService:a,viewportGridService:r}=e.services;i=i||r.getActiveViewportId(),a.toggleSegmentVisibility(i,t,n,o)},toggleSegmentLockCommand:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o}=e.services;o.toggleSegmentLocked(t,n)},toggleSegmentationVisibilityCommand:({segmentationId:t,type:n,viewportId:o})=>{const{segmentationService:i,viewportGridService:a}=e.services;o=o||a.getActiveViewportId(),i.toggleSegmentationRepresentationVisibility(o,{segmentationId:t,type:n})},downloadSegmentationCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.downloadSegmentation(t)},storeSegmentationCommand:async({segmentationId:o,viewportId:i})=>{const{segmentationService:a,viewportGridService:r}=e.services,s=t.getActiveDataSource(),l=await(0,S.createReportAsync)({servicesManager:e,getReport:()=>n.runCommand("storeSegmentation",{segmentationId:o,dataSource:s[0]}),reportType:"Segmentation"});l&&(a.remove(o),i=i||r.getActiveViewportId(),r.setDisplaySetsForViewport({viewportId:i,displaySetInstanceUIDs:l}))},downloadRTSSCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.downloadRTSS(t)},setSegmentationStyleCommand:({type:t,key:n,value:o})=>{const{segmentationService:i}=e.services;i.setStyle({type:t},{[n]:o})},deleteSegmentCommand:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o}=e.services;o.removeSegment(t,n)},deleteSegmentationCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.remove(t)},removeSegmentationFromViewportCommand:({segmentationId:t,viewportId:n})=>{const{segmentationService:o,viewportGridService:i}=e.services;n=n||i.getActiveViewportId(),o.removeSegmentationRepresentations(n,{segmentationId:t})},toggleRenderInactiveSegmentationsCommand:({viewportId:t})=>{const{segmentationService:n,viewportGridService:o}=e.services;t=t||o.getActiveViewportId();const i=n.getRenderInactiveSegmentations(t);n.setRenderInactiveSegmentations(t,!i)},setFillAlphaCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{fillAlpha:n})},setOutlineWidthCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{outlineWidth:n})},setRenderFillCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{renderFill:n})},setRenderOutlineCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{renderOutline:n})},setFillAlphaInactiveCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{fillAlphaInactive:n})},editSegmentLabel:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o,uiDialogService:i}=e.services,a=o.getSegmentation(t);if(!a)return;const r=a.segments[n],{label:s}=r;(0,S.callInputDialog)(i,s,(e,i)=>{""!==e&&o.setSegmentLabel(t,n,e)},!1,{dialogTitle:"Edit Segment Label",inputLabel:"Enter new label"})},editSegmentationLabel:({segmentationId:t})=>{const{segmentationService:n,uiDialogService:o}=e.services,i=n.getSegmentation(t);if(!i)return;const{label:a}=i;(0,S.callInputDialog)(o,a,(e,o)=>{""!==e&&n.addOrUpdateSegmentation({segmentationId:t,label:e})},!1,{dialogTitle:"Edit Segmentation Label",inputLabel:"Enter new label"})},editSegmentColor:({segmentationId:t,segmentIndex:n,viewportId:o})=>{const{segmentationService:i,uiDialogService:a,viewportGridService:r}=e.services;o=o||r.getActiveViewportId();const s=i.getSegmentColor(o,t,n),l={r:s[0],g:s[1],b:s[2],a:s[3]/255};(0,S.colorPickerDialog)(a,l,(e,a)=>{if("cancel"===a)return;const r=[e.r,e.g,e.b,255*e.a];i.setSegmentColor(o,t,n,r)})},getRenderInactiveSegmentations:t=>{const{segmentationService:n,viewportGridService:o}=e.services;return t=t||o.getActiveViewportId(),n.getRenderInactiveSegmentations(t)},mprView:({reset:e})=>{const{protocol:t}=g.getActiveProtocol();t&&(e||"mprAnd3DVolumeViewport"!==t.id)&&n.runCommand("setHangingProtocol",{protocolId:"mprAnd3DVolumeViewport",stageIndex:0,reset:e})},panoramicView:({reset:e})=>{const{protocol:t}=g.getActiveProtocol();t&&(e||"panoramicViewport"!==t.id)&&n.runCommand("setHangingProtocol",{protocolId:"panoramicViewport",stageIndex:0,reset:e})},undo:()=>{I.undo()},redo:()=>{I.redo()}},T={showCornerstoneContextMenu:{commandFn:E.showCornerstoneContextMenu,options:{menuCustomizationId:"measurementsContextMenu",useSelectedAnnotation:!0,commands:[{commandName:"showContextMenu"}]}},getNearbyToolData:{commandFn:E.getNearbyToolData},getNearbyAnnotation:{commandFn:E.getNearbyAnnotation,storeContexts:[],options:{}},toggleViewportColorbar:{commandFn:E.toggleViewportColorbar},deleteMeasurement:{commandFn:E.deleteMeasurement},setMeasurementLabel:{commandFn:E.setMeasurementLabel},updateMeasurement:{commandFn:E.updateMeasurement},setViewportWindowLevel:{commandFn:E.setViewportWindowLevel},setWindowLevel:{commandFn:E.setWindowLevel},setToolActive:{commandFn:E.setToolActive},setToolActiveToolbar:{commandFn:E.setToolActiveToolbar},setToolEnabled:{commandFn:E.setToolEnabled},rotateViewportCW:{commandFn:E.rotateViewport,options:{rotation:90}},rotateViewportCCW:{commandFn:E.rotateViewport,options:{rotation:-90}},incrementActiveViewport:{commandFn:E.changeActiveViewport},decrementActiveViewport:{commandFn:E.changeActiveViewport,options:{direction:-1}},flipViewportHorizontal:{commandFn:E.flipViewportHorizontal},flipViewportVertical:{commandFn:E.flipViewportVertical},invertViewport:{commandFn:E.invertViewport},resetViewport:{commandFn:E.resetViewport},scaleUpViewport:{commandFn:E.scaleViewport,options:{direction:1}},scaleDownViewport:{commandFn:E.scaleViewport,options:{direction:-1}},fitViewportToWindow:{commandFn:E.scaleViewport,options:{direction:0}},nextImage:{commandFn:E.scroll,options:{direction:1}},previousImage:{commandFn:E.scroll,options:{direction:-1}},firstImage:{commandFn:E.jumpToImage,options:{imageIndex:0}},lastImage:{commandFn:E.jumpToImage,options:{imageIndex:-1}},jumpToImage:{commandFn:E.jumpToImage},showDownloadViewportModal:{commandFn:E.showDownloadViewportModal},toggleCine:{commandFn:E.toggleCine},arrowTextCallback:{commandFn:E.arrowTextCallback},setViewportActive:{commandFn:E.setViewportActive},setAllViewportsColorMap:{commandFn:E.setAllViewportsColorMap},setViewportColormap:{commandFn:E.setViewportColormap},setSourceViewportForReferenceLinesTool:{commandFn:E.setSourceViewportForReferenceLinesTool},storePresentation:{commandFn:E.storePresentation},attachProtocolViewportDataListener:{commandFn:E.attachProtocolViewportDataListener},setViewportPreset:{commandFn:E.setViewportPreset},setVolumeRenderingQulaity:{commandFn:E.setVolumeRenderingQulaity},shiftVolumeOpacityPoints:{commandFn:E.shiftVolumeOpacityPoints},setVolumeLighting:{commandFn:E.setVolumeLighting},resetCrosshairs:{commandFn:E.resetCrosshairs},toggleSynchronizer:{commandFn:E.toggleSynchronizer},updateVolumeData:{commandFn:E.updateVolumeData},toggleEnabledDisabledToolbar:{commandFn:E.toggleEnabledDisabledToolbar},toggleActiveDisabledToolbar:{commandFn:E.toggleActiveDisabledToolbar},updateStoredPositionPresentation:{commandFn:E.updateStoredPositionPresentation},updateStoredSegmentationPresentation:{commandFn:E.updateStoredSegmentationPresentation},createLabelmapForViewport:{commandFn:E.createLabelmapForViewport},setActiveSegmentation:{commandFn:E.setActiveSegmentation},addSegment:{commandFn:E.addSegmentCommand},setActiveSegmentAndCenter:{commandFn:E.setActiveSegmentAndCenterCommand},toggleSegmentVisibility:{commandFn:E.toggleSegmentVisibilityCommand},toggleSegmentLock:{commandFn:E.toggleSegmentLockCommand},toggleSegmentationVisibility:{commandFn:E.toggleSegmentationVisibilityCommand},downloadSegmentation:{commandFn:E.downloadSegmentationCommand},storeSegmentation:{commandFn:E.storeSegmentationCommand},downloadRTSS:{commandFn:E.downloadRTSSCommand},setSegmentationStyle:{commandFn:E.setSegmentationStyleCommand},deleteSegment:{commandFn:E.deleteSegmentCommand},deleteSegmentation:{commandFn:E.deleteSegmentationCommand},removeSegmentationFromViewport:{commandFn:E.removeSegmentationFromViewportCommand},toggleRenderInactiveSegmentations:{commandFn:E.toggleRenderInactiveSegmentationsCommand},setFillAlpha:{commandFn:E.setFillAlphaCommand},setOutlineWidth:{commandFn:E.setOutlineWidthCommand},setRenderFill:{commandFn:E.setRenderFillCommand},setRenderOutline:{commandFn:E.setRenderOutlineCommand},setFillAlphaInactive:{commandFn:E.setFillAlphaInactiveCommand},editSegmentLabel:{commandFn:E.editSegmentLabel},editSegmentationLabel:{commandFn:E.editSegmentationLabel},editSegmentColor:{commandFn:E.editSegmentColor},getRenderInactiveSegmentations:{commandFn:E.getRenderInactiveSegmentations},mprView:{commandFn:E.mprView},panoramicView:{commandFn:E.panoramicView},undo:{commandFn:E.undo},redo:{commandFn:E.redo}};return{actions:E,definitions:T,defaultContext:"CORNERSTONE"}},bt={id:"fourUp",locked:!0,name:"3D four up",icon:"layout-advanced-3d-four-up-wediag",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"fourUpStage",name:"fourUp",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]}]}]},Ot={id:"main3D",locked:!0,name:"3D main",icon:"layout-advanced-3d-main",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"main3DStage",name:"main3D",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3,layoutOptions:[{x:0,y:0,width:1,height:.5},{x:0,y:.5,width:1/3,height:.5},{x:1/3,y:.5,width:1/3,height:.5},{x:2/3,y:.5,width:1/3,height:.5}]}},viewports:[{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]}]}]},Ct={type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}},At={type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}},Mt={id:"mpr",name:"MPR",locked:!0,icon:"layout-advanced-mpr",isPreset:!0,createdDate:"2021-02-23",modifiedDate:"2023-08-15",availableTo:{},editableBy:{},numberOfPriorsReferenced:0,protocolMatchingRules:[],imageLoadStrategy:"nth",callbacks:{},displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{name:"MPR 1x3",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3,layoutOptions:[{x:0,y:0,width:1/3,height:1},{x:1/3,y:0,width:1/3,height:1},{x:2/3,y:0,width:1/3,height:1}]}},viewports:[{viewportOptions:{viewportId:"mpr-axial",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[Ct,At]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"mpr-sagittal",toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[Ct,At]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"mpr-coronal",toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[Ct,At]},displaySets:[{id:"activeDisplaySet"}]}]}]},Rt={type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}},Nt={type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}},Vt={id:"mprAnd3DVolumeViewport",locked:!0,name:"mpr",createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"Modality",constraint:{equals:{value:"CT"}},required:!0},{attribute:"isSeriesUIDFromURL",constraint:{equals:{value:!0}}}]}},stages:[{id:"mpr3Stage",name:"mpr",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[Rt,Nt]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[Rt,Nt]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[Rt,Nt]},displaySets:[{id:"activeDisplaySet"}]}]}]},Pt={id:"only3D",locked:!0,name:"3D only",icon:"layout-advanced-3d-only",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"only3DStage",name:"only3D",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]}]}]},Ut={type:"voi",id:"dentascanvoi",source:!0,target:!0,options:{syncColormap:!0}},xt={type:"hydrateseg",id:"dentascanhydrateseg",source:!0,target:!0},_t={id:"panoramicViewport",locked:!0,name:"Panoramic",icon:"layout-advanced-panoramic",createdDate:"2023-07-10T16:35:08.894Z",modifiedDate:"2023-07-10",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{mprDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"Modality",constraint:{equals:{value:"CT"}},required:!0},{attribute:"isSeriesUIDFromURL",constraint:{equals:{value:!0}}}]},panoramicDisplaySet:{seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:1}},required:!0},{attribute:"Modality",constraint:{equals:{value:"OT"}}},{attribute:"isPanoramicDerivedFromSeriesURL",constraint:{equals:{value:!0}},required:!0}]},dentascanDisplaySet:{seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:1}}},{attribute:"Modality",constraint:{equals:{value:"OT"}}},{attribute:"isDentascanDerivedFromSeriesURL",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"panoramicStage",name:"mpr",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:7,layoutOptions:[{x:0,y:0,width:.3,height:.5},{x:.3,y:0,width:.7,height:.5},{x:0,y:.5,width:1/7,height:.5},{x:1/7,y:.5,width:1/7,height:.5},{x:2/7,y:.5,width:1/7,height:.5},{x:3/7,y:.5,width:1/7,height:.5},{x:4/7,y:.5,width:1/7,height:.5},{x:5/7,y:.5,width:1/7,height:.5},{x:6/7,y:.5,width:1/7,height:.5}]}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"}},displaySets:[{id:"mprDisplaySet"}]},{viewportOptions:{viewportId:"panoramic",toolGroupId:"default",viewportType:"stack"},displaySets:[{id:"panoramicDisplaySet"}]},{viewportOptions:{viewportId:"dentascan-3",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]},{viewportOptions:{viewportId:"dentascan-2",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]},{viewportOptions:{viewportId:"dentascan-1",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]},{viewportOptions:{viewportId:"dentascan",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]},{viewportOptions:{viewportId:"dentascan1",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]},{viewportOptions:{viewportId:"dentascan2",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]},{viewportOptions:{viewportId:"dentascan3",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]}]},{id:"panoramicStage",name:"mpr",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:7,layoutOptions:[{x:0,y:0,width:.6,height:.5},{x:0,y:.5,width:.6,height:.5},{x:.6,y:0,width:.4,height:1}]}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"mprDisplaySet"}]},{viewportOptions:{viewportId:"panoramic",toolGroupId:"default",viewportType:"stack"},displaySets:[{id:"panoramicDisplaySet"}]},{viewportOptions:{viewportId:"dentascan",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",syncGroups:[Ut,xt]},displaySets:[{id:"dentascanDisplaySet",options:{voi:{windowWidth:255,windowCenter:128}}}]}]}]},Lt={id:"primary3D",locked:!0,name:"3D primary",icon:"layout-advanced-3d-primary",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"primary3DStage",name:"primary3D",viewportStructure:{layoutType:"grid",properties:{rows:3,columns:3,layoutOptions:[{x:0,y:0,width:2/3,height:1},{x:2/3,y:0,width:1/3,height:1/3},{x:2/3,y:1/3,width:1/3,height:1/3},{x:2/3,y:2/3,width:1/3,height:1/3}]}},viewports:[{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]}]}]},Ft={id:"primaryAxial",locked:!0,name:"Axial Primary",icon:"layout-advanced-axial-primary",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"primaryAxialStage",name:"primaryAxial",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3,layoutOptions:[{x:0,y:0,width:2/3,height:1},{x:2/3,y:0,width:1/3,height:.5},{x:2/3,y:.5,width:1/3,height:.5}]}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[{type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"activeDisplaySet"}]}]}]};const Gt=function(){return[{name:Mt.id,protocol:Mt},{name:Vt.id,protocol:Vt},{name:bt.id,protocol:bt},{name:Ot.id,protocol:Ot},{name:Ft.id,protocol:Ft},{name:Pt.id,protocol:Pt},{name:Lt.id,protocol:Lt},{name:_t.id,protocol:_t}]},kt=e=>e?"!text-default":"!text-default hover:!bg-hoverBackground hover:!text-hoverText hover:!opacity-100",Bt=e=>({disabled:!0,className:"!text-common-bright ohif-disabled",disabledText:e??"Not available on the current viewport"});function zt({viewportId:e,toolbarService:t,button:n,disabledText:o,offModes:i,toolGroupService:a}){const r=a.getToolGroupForViewport(e);if(!r)return;const s=t.getToolNameForButton(n);if(!r.hasTool(s))return Bt(o);const l=i.includes(r.getToolOptions(s).mode);return{className:kt(!l)}}var $t;const Wt={VIEWPORT_ADDED:"event::cornerstone::toolgroupservice:viewportadded",TOOLGROUP_CREATED:"event::cornerstone::toolgroupservice:toolgroupcreated",TOOL_ACTIVATED:"event::cornerstone::toolgroupservice:toolactivated",PRIMARY_TOOL_ACTIVATED:"event::cornerstone::toolgroupservice:primarytoolactivated"};class Ht{constructor(e){this.servicesManager=void 0,this.cornerstoneViewportService=void 0,this.viewportGridService=void 0,this.uiNotificationService=void 0,this.toolGroupIds=new Set,this.listeners=void 0,this.EVENTS=void 0,this._onToolActivated=e=>{const{toolGroupId:t,toolName:n,toolBindingsOptions:o}=e.detail,i=o.bindings?.some(e=>e.mouseButton===l.Enums.MouseBindings.Primary),a={toolGroupId:t,toolName:n,toolBindingsOptions:o};this._broadcastEvent(Wt.TOOL_ACTIVATED,a),i&&this._broadcastEvent(Wt.PRIMARY_TOOL_ACTIVATED,a)};const{cornerstoneViewportService:t,viewportGridService:n,uiNotificationService:o}=e.services;this.cornerstoneViewportService=t,this.viewportGridService=n,this.uiNotificationService=o,this.listeners={},this.EVENTS=Wt,Object.assign(this,p.Ml),this._init()}onModeExit(){this.destroy()}_init(){s.eventTarget.addEventListener(l.Enums.Events.TOOL_ACTIVATED,this._onToolActivated)}getToolGroup(e){let t=e;if(!t){const e=y(this.viewportGridService);if(!e)return;const{renderingEngineId:n,viewportId:o}=e,i=l.ToolGroupManager.getToolGroupForViewport(o,n);if(!i)return void console.warn("No tool group found for viewportId:",o,"and renderingEngineId:",n);t=i.id}return l.ToolGroupManager.getToolGroup(t)}getToolGroupIds(){return Array.from(this.toolGroupIds)}getToolGroupForViewport(e){const t=this.cornerstoneViewportService.getRenderingEngine();return l.ToolGroupManager.getToolGroupForViewport(e,t.id)}getActiveToolForViewport(e){const t=this.getToolGroupForViewport(e);if(t)return t.getActivePrimaryMouseButtonTool()}destroy(){l.ToolGroupManager.destroy(),this.toolGroupIds=new Set,s.eventTarget.removeEventListener(l.Enums.Events.TOOL_ACTIVATED,this._onToolActivated)}destroyToolGroup(e){l.ToolGroupManager.destroyToolGroup(e),this.toolGroupIds.delete(e)}removeViewportFromToolGroup(e,t,n){const o=l.ToolGroupManager.getToolGroupForViewport(e,t);if(!o)return;o.removeViewports(t,e);0===o.getViewportIds().length&&n&&l.ToolGroupManager.destroyToolGroup(o.id)}addViewportToToolGroup(e,t,n){if(n){let o=l.ToolGroupManager.getToolGroup(n);o||(o=this.createToolGroup(n)),o.addViewport(e,t)}else{l.ToolGroupManager.getAllToolGroups().forEach(n=>{n.addViewport(e,t)})}this._broadcastEvent(Wt.VIEWPORT_ADDED,{viewportId:e,toolGroupId:n})}createToolGroup(e){if(this.getToolGroup(e))throw new Error(`ToolGroup ${e} already exists`);const t=l.ToolGroupManager.createToolGroup(e);return this.toolGroupIds.add(e),this._broadcastEvent(Wt.TOOLGROUP_CREATED,{toolGroupId:e}),t}addToolsToToolGroup(e,t,n={}){const o=l.ToolGroupManager.getToolGroup(e);this._addTools(o,t,n),this._setToolsMode(o,t)}createToolGroupAndAddTools(e,t){const n=this.createToolGroup(e);return this.addToolsToToolGroup(e,t),n}getToolConfiguration(e,t){const n=l.ToolGroupManager.getToolGroup(e);if(!n)return null;const o=n.getToolInstance(t);return o?o.configuration:null}setToolConfiguration(e,t,n){l.ToolGroupManager.getToolGroup(e).getToolInstance(t).configuration=n}getActivePrimaryMouseButtonTool(e){return this.getToolGroup(e)?.getActivePrimaryMouseButtonTool()}_setToolsMode(e,t){const{active:n,passive:o,enabled:i,disabled:a}=t;n&&n.forEach(({toolName:t,bindings:n})=>{e.setToolActive(t,{bindings:n})}),o&&o.forEach(({toolName:t})=>{e.setToolPassive(t)}),i&&i.forEach(({toolName:t})=>{e.setToolEnabled(t)}),a&&a.forEach(({toolName:t})=>{e.setToolDisabled(t)})}_addTools(e,t){const n=t=>{t.forEach(({toolName:t,parentTool:n,configuration:o})=>{n?e.addToolInstance(t,n,{...o}):e.addTool(t,{...o})})};t.active&&n(t.active),t.passive&&n(t.passive),t.enabled&&n(t.enabled),t.disabled&&n(t.disabled)}}$t=Ht,Ht.REGISTRATION={name:"toolGroupService",altName:"ToolGroupService",create:({servicesManager:e})=>new $t(e)};const jt=Ht,{createSynchronizer:qt}=l.SynchronizerManager,{SEGMENTATION_REPRESENTATION_ADDED:Yt}=l.Enums.Events;function Kt(e,{servicesManager:t,...n}){return qt(e,Yt,(e,o,i,a)=>Zt(e,o,i,a,{servicesManager:t,options:n}),{eventSource:"eventTarget"})}const Zt=async(e,t,n,o,{servicesManager:i,options:a})=>{const r=o,{segmentationId:l,viewportId:c}=r.detail,{segmentationService:d,hangingProtocolService:m}=i.services,p=n.viewportId,{viewport:u}=(0,s.getEnabledElementByViewportId)(p);if(!u.getFrameOfReferenceUID())return void console.debug("No frame of reference UID found for the target viewport");if(d.getSegmentationRepresentations(p,{segmentationId:l}).length>0)return;const g=d.getSegmentationRepresentations(t.viewportId,{segmentationId:l})[0].type;await d.addSegmentationRepresentation(p,{segmentationId:l,type:g})};var Xt;const Jt={TOOL_GROUP_CREATED:"event::cornerstone::syncgroupservice:toolgroupcreated"},Qt="cameraposition",en="voi",tn="zoompan",nn="stackimage",on="imageslice",an="hydrateseg";class rn{constructor(e){this.servicesManager=void 0,this.listeners={},this.EVENTS=void 0,this.synchronizerCreators={[Qt]:l.synchronizers.createCameraPositionSynchronizer,[en]:l.synchronizers.createVOISynchronizer,[tn]:l.synchronizers.createZoomPanSynchronizer,[nn]:l.synchronizers.createImageSliceSynchronizer,[on]:l.synchronizers.createImageSliceSynchronizer,[an]:Kt},this.synchronizersByType={},this.servicesManager=e,this.listeners={},this.EVENTS=Jt,Object.assign(this,p.Ml)}_createSynchronizer(e,t,n){this.synchronizersByType[e]=this.synchronizersByType[e]||[];const o=this.synchronizerCreators[e.toLowerCase()];if(o){const i=o(t,{...n,servicesManager:this.servicesManager});if(i)return this.synchronizersByType[e].push(i),i}else console.debug(`Unknown synchronizer type: ${e}, id: ${t}`)}getSyncCreatorForType(e){return this.synchronizerCreators[e.toLowerCase()]}addSynchronizerType(e,t){this.synchronizerCreators[e.toLowerCase()]=t}getSynchronizer(e){return l.SynchronizerManager.getSynchronizer(e)}registerCustomSynchronizer(e,t){this.synchronizerCreators[e]=t}getSynchronizersOfType(e){return this.synchronizersByType[e]}_getOrCreateSynchronizer(e,t,n){let o=l.SynchronizerManager.getSynchronizer(t);return o||(o=this._createSynchronizer(e,t,n)),o}addViewportToSyncGroup(e,t,n){if(!n)return;(Array.isArray(n)?n:[n]).forEach(n=>{const o=(e=>"string"==typeof e?{type:e}:e)(n),{type:i,target:a=!0,source:r=!0,options:s={},id:l=i}=o,c=this._getOrCreateSynchronizer(i,l,s);if(!c)return;c.setOptions(e,s);const d={viewportId:e,renderingEngineId:t};a&&r?c.add(d):r?c.addSource(d):a&&c.addTarget(d)})}destroy(){l.SynchronizerManager.destroy()}getSynchronizersForViewport(e){const t=(0,s.getRenderingEngines)().find(t=>t.getViewports().find(t=>t.id===e))||(0,s.getRenderingEngines)()[0];return l.SynchronizerManager.getAllSynchronizers().filter(n=>n.hasSourceViewport(t.id,e)||n.hasTargetViewport(t.id,e))}removeViewportFromSyncGroup(e,t,n){const o=l.SynchronizerManager.getAllSynchronizers();(n?o.filter(e=>e.id===n):o).forEach(n=>{if(!n)return;this.isImageSliceSyncronizer(n)&&this.unRegisterSpatialRegistration(n),n.remove({viewportId:e,renderingEngineId:t});const o=n.getSourceViewports(),i=n.getTargetViewports();o.length||i.length||l.SynchronizerManager.destroySynchronizer(n.id)})}unRegisterSpatialRegistration(e){const t=e.getSourceViewports().map(e=>e.viewportId),n=e.getTargetViewports().map(e=>e.viewportId);t.map(e=>n.map(t=>[t,e])).reduce((e,t)=>e.concat(t),[]).forEach(e=>{s.utilities.spatialRegistrationMetadataProvider.add(e,void 0)})}isImageSliceSyncronizer(e){return this.getSynchronizerType(e).toLowerCase()===on}getSynchronizerType(e){return Object.keys(this.synchronizersByType).find(t=>this.getSynchronizersOfType(t).includes(e))}}Xt=rn,rn.REGISTRATION={name:"syncGroupService",altName:"SyncGroupService",create:({servicesManager:e})=>new Xt(e)};const sn=rn;function ln(e,t){const n=1-t;return e<1/4?4*Math.pow(2*e,3)*n+t:e<.5?(1-Math.pow(-4*e+2,3)/2)*n+t:e<3/4?(1-Math.pow(4*e-2,3)/2)*n+t:-4*Math.pow(2*e-2,3)*n+t}var cn,dn=n(4714),mn=n(70906),pn=n(31749),un=n(78231),gn=n(26047),hn=n(6273),In=n(1300);const Sn=l.Enums.SegmentationRepresentations.Labelmap,vn=l.Enums.SegmentationRepresentations.Contour,yn={SEGMENTATION_MODIFIED:"event::segmentation_modified",SEGMENTATION_ADDED:"event::segmentation_added",SEGMENTATION_DATA_MODIFIED:"event::segmentation_data_modified",SEGMENTATION_REMOVED:"event::segmentation_removed",SEGMENTATION_REPRESENTATION_MODIFIED:"event::segmentation_representation_modified",SEGMENTATION_REPRESENTATION_REMOVED:"event::segmentation_representation_removed",SEGMENT_LOADING_COMPLETE:"event::segment_loading_complete",SEGMENTATION_LOADING_COMPLETE:"event::segmentation_loading_complete"};class fn extends p.Rc{constructor({servicesManager:e}){super(yn),this._segmentationIdToColorLUTIndexMap=void 0,this.servicesManager=void 0,this.highlightIntervalId=null,this.EVENTS=yn,this.destroy=()=>{s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_MODIFIED,this._onSegmentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_REMOVED,this._onSegmentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_DATA_MODIFIED,this._onSegmentationDataModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_ADDED,this._onSegmentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_ADDED,this._onSegmentationAddedFromSource),this.listeners={}},this.getStyle=e=>l.segmentation.config.style.getStyle(e),this.setStyle=(e,t)=>{l.segmentation.config.style.setStyle(e,t)},this.resetToGlobalStyle=()=>{l.segmentation.config.style.resetToGlobalStyle()},this.toggleSegmentationRepresentationVisibility=(e,{segmentationId:t,type:n})=>{this._toggleSegmentationRepresentationVisibility(e,t,n)},this.getViewportIdsWithSegmentation=e=>l.segmentation.state.getViewportIdsWithSegmentation(e),this._toggleSegmentationRepresentationVisibility=(e,t,n)=>{const o=this.getSegmentationRepresentations(e,{segmentationId:t,type:n})[0],i=0===l.segmentation.config.visibility.getHiddenSegmentIndices(e,{segmentationId:t,type:o.type}).size;this._setSegmentationRepresentationVisibility(e,t,o.type,!i)},this._onSegmentationDataModifiedFromSource=e=>{const{cornerstoneCacheService:t}=this.servicesManager.services,{segmentationId:n}=e.detail;t.lastUndo&&(t.lastUndo=!1),this._broadcastEvent(this.EVENTS.SEGMENTATION_DATA_MODIFIED,{segmentationId:n})},this._onSegmentationRepresentationModifiedFromSource=e=>{const{segmentationId:t,viewportId:n}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,{segmentationId:t,viewportId:n})},this._onSegmentationModifiedFromSource=e=>{const{segmentationId:t}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_MODIFIED,{segmentationId:t})},this._onSegmentationAddedFromSource=e=>{const{segmentationId:t}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_ADDED,{segmentationId:t})},this._segmentationIdToColorLUTIndexMap=new Map,this.servicesManager=e}onModeEnter(){this._initSegmentationService()}onModeExit(){this.destroy()}getSegmentation(e){return l.segmentation.state.getSegmentation(e)}getSegmentations(){return l.segmentation.state.getSegmentations()}getAxialSegmentations(){return this.getSegmentations().filter(e=>!e.segmentationId.startsWith("dentascan")&&!e.segmentationId.startsWith("panoramic"))}getDentascanSegmentations(){return this.getSegmentations().filter(e=>e.segmentationId.startsWith("dentascan"))}getHiddenSegmentation(e){const t=this.getAxialSegmentations(),n=this.getDentascanSegmentations();if(!n?.length)return;const o=t.findIndex(t=>t.segmentationId===e);if(-1!==o)return n[o];const i=n.findIndex(t=>t.segmentationId===e);return-1!==i?t[i]:void 0}getGeneratedSegmentation(){return this.getAxialSegmentations().filter(e=>"Generated segmentation"===e.label)?.[0]}getGeneratedDentascanSegmentation(){return this.getDentascanSegmentations().filter(e=>"Generated segmentation"===e.label)?.[0]}getPresentation(e){const t=[],n=new Map,o=this.getSegmentationRepresentations(e);for(const e of o){const{segmentationId:t}=e;if(!e)continue;const{type:o}=e;n.set(t,{segmentationId:t,type:o,hydrated:!0,config:e.config||{}})}return t.push(...n.values()),t}getRepresentationsForSegmentation(e){return l.segmentation.state.getSegmentationRepresentationsBySegmentationId(e)}getSegmentationRepresentations(e,t={}){return l.segmentation.state.getSegmentationRepresentations(e,t).map(t=>this._toOHIFSegmentationRepresentation(e,t))}async addSegmentationRepresentation(e,{segmentationId:t,type:n,suppressEvents:o=!1}){const i=this.getSegmentation(t),a=this.getAndValidateViewport(e),r=this._segmentationIdToColorLUTIndexMap.get(t),s=l.Enums.SegmentationRepresentations.Labelmap;let c=n||s,d=!1;if(n===l.Enums.SegmentationRepresentations.Labelmap){const{isVolumeViewport:n,isVolumeSegmentation:o}=this.determineViewportAndSegmentationType(a,i);({representationTypeToUse:c,isConverted:d}=await this.handleViewportConversion(n,o,a,i,e,t,c))}await this._addSegmentationRepresentation(e,t,c,r,d),o||this._broadcastEvent(this.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,{segmentationId:t})}async createLabelmapForDisplaySet(e,t){const n=t?.segmentationId??`${s.utilities.uuidv4()}`,o=e.isDynamicVolume;let i=e.imageIds;if(o){const t=e.dynamicVolumeInfo.timePoints;i=t[Math.floor(t.length/2)]}const a=await s.imageLoader.createAndCacheDerivedLabelmapImages(i),r=this.getSegmentations(),l=t.label||`Segmentation ${r.length+1}`,c=a.map(e=>e.imageId),d={segmentationId:n,representation:{type:Sn,data:{imageIds:c,referencedVolumeId:this._getVolumeIdForDisplaySet(e),referencedImageIds:i}},config:{label:l,segments:t.segments&&Object.keys(t.segments).length>0?t.segments:{1:{label:"Segment 1",active:!0}},cachedStats:{info:`S${e.SeriesNumber}: ${e.SeriesDescription}`}}};return this.addOrUpdateSegmentation(d),n}async createSegmentationForSEGDisplaySet(e,t={type:Sn}){const{type:n}=t;let{segmentationId:o}=t;const{labelmapBufferArray:i}=e;if(n!==Sn)throw new Error("Only labelmap type is supported for SEG display sets right now");if(!i)throw new Error("SEG reading failed");o=o??e.displaySetInstanceUID;const a=e.referencedDisplaySetInstanceUID,r=this.servicesManager.services.displaySetService.getDisplaySetByUID(a),l=r.instances;if(!l.length)throw new Error("No instances were provided for the referenced display set of the SEG");const c=l.map(e=>e.imageId),d=await s.imageLoader.createAndCacheDerivedLabelmapImages(c);e.images=d;const m=e.segMetadata.data,p={},u=[];m.forEach((t,n)=>{if(0===n)return void u.push([0,0,0,0]);const{SegmentedPropertyCategoryCodeSequence:o,SegmentNumber:i,SegmentLabel:a,SegmentAlgorithmType:r,SegmentAlgorithmName:s,SegmentedPropertyTypeCodeSequence:l,rgba:c}=t;u.push(c);const d=Number(i),m=e.centroids.get(n).image||{x:0,y:0,z:0},g=e.centroids.get(n).world||{x:0,y:0,z:0};p[d]={segmentIndex:d,label:a||`Segment ${i}`,locked:!1,active:!1,cachedStats:{center:{image:[m.x,m.y,m.z],world:[g.x,g.y,g.z]},modifiedTime:e.SeriesDate,category:o?o.CodeMeaning:"",type:l?l.CodeMeaning:"",algorithmType:r,algorithmName:s}}});const g=(0,mn.u)();(0,dn.u)(u,g),this._segmentationIdToColorLUTIndexMap.set(o,g);const h=new Uint8Array(i[0]);let I=null;for(let e=0;e<d.length;e++){const t=d[e].voxelManager,n=t.getScalarData(),o=h.slice(e*n.length,(e+1)*n.length);n.set(o),t.setScalarData(n),!I&&o.some(e=>0!==e)&&(I=d[e].referencedImageId)}e.firstSegmentedSliceImageId=I,this._broadcastEvent(yn.SEGMENTATION_LOADING_COMPLETE,{segmentationId:o,segDisplaySet:e});const S={segmentationId:o,representation:{type:Sn,data:{imageIds:d.map(e=>e.imageId),referencedVolumeId:this._getVolumeIdForDisplaySet(r),referencedImageIds:c}},config:{label:e.SeriesDescription,segments:p}};return e.isLoaded=!0,this.addOrUpdateSegmentation(S),o}async createSegmentationForRTDisplaySet(e,t={type:vn}){const{type:n}=t;let{segmentationId:o}=t;if(n!==vn)throw new Error("Only contour type is supported for RT display sets right now");o=o??e.displaySetInstanceUID;const{structureSet:i}=e;if(!i)throw new Error("To create the contours from RT displaySet, the displaySet should be loaded first. You can perform rtDisplaySet.load() before calling this method.");const a=e.displaySetInstanceUID,r=this.servicesManager.services.displaySetService.getDisplaySetByUID(e.referencedDisplaySetInstanceUID),l=Array.from(i.ReferencedSOPInstanceUIDsSet),c=r.instances.map(e=>e.imageId).find(e=>l.some(t=>e.includes(t)));e.firstSegmentedSliceImageId=c;const d=function(e,t){return e.ROIContours.map(({contourPoints:e,ROINumber:n,ROIName:o,colorArray:i})=>{const a=o||n;return{data:e.map(({points:e,...t})=>({...t,points:e.map(({x:e,y:t,z:n})=>[e,t,n])})),id:a,segmentIndex:n,color:i,geometryId:`${t}:${a}:segmentIndex-${n}`}})}(i,a);d.sort((e,t)=>e.segmentIndex-t.segmentIndex);const m=d.map(({geometryId:e})=>e),p={segmentationId:o,representation:{type:vn,data:{geometryIds:m}},config:{label:e.SeriesDescription}};if(!i.ROIContours?.length)throw new Error("The structureSet does not contain any ROIContours. Please ensure the structureSet is loaded first.");const u={};let g={};for(const t of d){const{data:n,id:o,color:a,segmentIndex:r,geometryId:l}=t;try{const t=(await s.geometryLoader.createAndCacheGeometry(l,{geometryData:{data:n,id:o,color:a,frameOfReferenceUID:i.frameOfReferenceUID,segmentIndex:r},type:s.Enums.GeometryType.CONTOUR})).data;g={center:{world:t.centroid},modifiedTime:e.SeriesDate},u[r]={label:o,segmentIndex:r,cachedStats:g,locked:!1,active:!1};const c=Object.keys(g).length,m=Math.round(c/d.length*100);this._broadcastEvent(yn.SEGMENT_LOADING_COMPLETE,{percentComplete:m,numSegments:d.length})}catch(e){console.warn(`Error initializing contour for segment ${r}:`,e);continue}}return p.config.segments=u,this._broadcastEvent(yn.SEGMENTATION_LOADING_COMPLETE,{segmentationId:o,rtDisplaySet:e}),e.isLoaded=!0,this.addOrUpdateSegmentation(p),o}addOrUpdateSegmentation(e){const t=e.segmentationId;l.segmentation.state.getSegmentation(t)?this.updateSegmentationInSource(t,e):this.addSegmentationToSource(e)}setActiveSegmentation(e,t){l.segmentation.activeSegmentation.setActiveSegmentation(e,t)}getActiveSegmentation(e){return l.segmentation.activeSegmentation.getActiveSegmentation(e)}getActiveSegment(e){const t=this.getActiveSegmentation(e);if(!t)return;const{segments:n}=t;let o;for(const e of Object.values(n))if(e.active){o=e;break}return o}hasCustomStyles(e){return l.segmentation.config.style.hasCustomStyle(e)}addSegment(e,t={}){if(0===t?.segmentIndex)throw new Error('Segment index 0 is reserved for "no label"');const n=this.getCornerstoneSegmentation(e);let o=t.segmentIndex;o||(o=Math.max(...Object.keys(n.segments).map(Number))+1),t.label||(t.label=`Segment ${o}`);const i=n.segments;l.segmentation.updateSegmentations([{segmentationId:e,payload:{segments:{...i,[o]:{...i[o],segmentIndex:o,cachedStats:{},locked:!1,...t}}}}]),this.setActiveSegment(e,o),void 0!==t.isLocked&&this._setSegmentLockedStatus(e,o,t.isLocked);this.getViewportIdsWithSegmentation(e).forEach(n=>{void 0!==t.color&&this.setSegmentColor(n,e,o,t.color),void 0!==t.visibility&&this.setSegmentVisibility(n,e,o,t.visibility)})}removeSegment(e,t){l.segmentation.removeSegment(e,t)}setSegmentVisibility(e,t,n,o,i){this._setSegmentVisibility(e,t,n,o,i)}setSegmentLocked(e,t,n){this._setSegmentLockedStatus(e,t,n)}toggleSegmentLocked(e,t){const n=l.segmentation.segmentLocking.isSegmentIndexLocked(e,t);this._setSegmentLockedStatus(e,t,!n)}toggleSegmentVisibility(e,t,n,o){const i=l.segmentation.config.visibility.getSegmentIndexVisibility(e,{segmentationId:t,type:o},n);this._setSegmentVisibility(e,t,n,!i,o)}setSegmentColor(e,t,n,o){l.segmentation.config.color.setSegmentIndexColor(e,t,n,o)}getSegmentColor(e,t,n){return l.segmentation.config.color.getSegmentIndexColor(e,t,n)}getLabelmapVolume(e){const t=l.segmentation.state.getSegmentation(e).representationData[Je.SegmentationRepresentations.Labelmap];if(!t||!t.volumeId)return null;const{volumeId:n}=t;return s.cache.getVolume(n)}setSegmentLabel(e,t,n){this._setSegmentLabel(e,t,n)}setActiveSegment(e,t){this._setActiveSegment(e,t)}setRenderInactiveSegmentations(e,t){l.segmentation.config.style.setRenderInactiveSegmentations(e,t)}getRenderInactiveSegmentations(e){return l.segmentation.config.style.getRenderInactiveSegmentations(e)}clearSegmentationRepresentations(e){this.removeSegmentationRepresentations(e)}remove(e){l.segmentation.state.removeSegmentation(e)}removeAllSegmentations(){l.segmentation.state.removeAllSegmentations()}removeSegmentationRepresentations(e,t={}){l.segmentation.removeSegmentationRepresentations(e,t)}jumpToSegmentCenter(e,t,n,o=.9,i=!0,a=750,r=!1,l="ease-in-out"){const c=this._getSegmentCenter(e,t);if(!c)return;const{world:d}=c;(n?[n]:this.getViewportIdsWithSegmentation(e)).forEach(n=>{const{viewport:l}=(0,s.getEnabledElementByViewportId)(n);l.jumpToWorld(d),i&&this.highlightSegment(e,t,n,o,a,r)})}highlightSegment(e,t,n,o=.9,i=750,a=!0,r="ease-in-out"){this.highlightIntervalId&&clearInterval(this.highlightIntervalId);const s=this.getCornerstoneSegmentation(e);(n?[n]:this.getViewportIdsWithSegmentation(e)).forEach(n=>{const r=this.getSegmentationRepresentations(n,{segmentationId:e})[0],{type:l}=r,c=s.segments;(l===Sn?this._highlightLabelmap.bind(this):this._highlightContour.bind(this))(t,l===Sn?o:1-o,a,c,n,i,r)})}getAndValidateViewport(e){const t=this.servicesManager.services.cornerstoneViewportService.getCornerstoneViewport(e);if(!t)throw new Error(`Viewport with id ${e} not found.`);return t}_setSegmentationRepresentationVisibility(e,t,n,o){this.getSegmentationRepresentations(e,{segmentationId:t,type:n})[0]?l.segmentation.config.visibility.setSegmentationRepresentationVisibility(e,{segmentationId:t,type:n},o):console.debug("No segmentation representation found for the given viewportId and segmentationId")}determineViewportAndSegmentationType(e,t){return{isVolumeViewport:e.type===pn.ViewportType.ORTHOGRAPHIC||e.type===pn.ViewportType.VOLUME_3D,isVolumeSegmentation:"volumeId"in t.representationData[Sn]}}async handleViewportConversion(e,t,n,o,i,a,r){let s=r,l=!1;const c=e?this.handleVolumeViewportCase:this.handleStackViewportCase;return({representationTypeToUse:s,isConverted:l}=await c.apply(this,[n,o,t,i,a])),{representationTypeToUse:s,isConverted:l}}async handleVolumeViewportCase(e,t,n){return e.type===pn.ViewportType.VOLUME_3D?{representationTypeToUse:Je.SegmentationRepresentations.Surface,isConverted:!1}:(await this.handleVolumeViewport(e,t,n),{representationTypeToUse:Je.SegmentationRepresentations.Labelmap,isConverted:!1})}async handleStackViewportCase(e,t,n,o,i){if(n){const t=await this.convertStackToVolumeViewport(e);return{representationTypeToUse:Je.SegmentationRepresentations.Labelmap,isConverted:t}}if((0,un.t)(o,i))return{representationTypeToUse:Je.SegmentationRepresentations.Labelmap,isConverted:!1};const a=await this.attemptStackToVolumeConversion(e,t,o,i);return{representationTypeToUse:Je.SegmentationRepresentations.Labelmap,isConverted:a}}async _addSegmentationRepresentation(e,t,n,o,i){const a={type:n,segmentationId:t,config:{colorLUTOrIndex:o}},r=()=>l.segmentation.addSegmentationRepresentations(e,[a]);if(i){const{viewportGridService:e}=this.servicesManager.services;await new Promise(t=>{const{unsubscribe:n}=e.subscribe(e.EVENTS.GRID_STATE_CHANGED,()=>{r(),n(),t()})})}else r()}async handleVolumeViewport(e,t,n){if(n)return;const o=e.getFrameOfReferenceUID(),i=(0,In.getLabelmapImageIds)(t.segmentationId),a=s.cache.getImage(i[0]);a?.FrameOfReferenceUID===o&&await(0,hn.p)(t)}async convertStackToVolumeViewport(e){const{viewportGridService:t,cornerstoneViewportService:n}=this.servicesManager.services,o=t.getState().viewports.get(e.id),i=e.getViewPresentation(),a=e.getViewReference(),r=n.getCornerstoneViewport(e.id),{element:l}=r,c=()=>{const t=n.getCornerstoneViewport(e.id);t.setViewPresentation(i),t.setViewReference(a),t.render(),l.removeEventListener(s.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,c)};return l.addEventListener(s.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,c),t.setDisplaySetsForViewport({viewportId:e.id,displaySetInstanceUIDs:o.displaySetInstanceUIDs,viewportOptions:{...o.viewportOptions,viewportType:pn.ViewportType.ORTHOGRAPHIC}}),!0}async attemptStackToVolumeConversion(e,t,n,o){const i=(0,In.getLabelmapImageIds)(t.segmentationId),a=e.getFrameOfReferenceUID(),r=s.cache.getImage(i[0]);if(r?.FrameOfReferenceUID&&a&&r.FrameOfReferenceUID===a){const t=await this.convertStackToVolumeViewport(e);return(0,gn.triggerSegmentationRepresentationModified)(n,o,Je.SegmentationRepresentations.Labelmap),t}}addSegmentationToSource(e){l.segmentation.addSegmentations([e])}updateSegmentationInSource(e,t){l.segmentation.updateSegmentations([{segmentationId:e,payload:t}])}_toOHIFSegmentationRepresentation(e,t){const{segmentationId:n,type:o,active:i,visible:a}=t,{colorLUTIndex:r}=t,s={},c=l.segmentation.state.getSegmentation(n);if(!c)throw new Error(`Segmentation with ID ${n} not found.`);const d=Object.keys(c.segments);for(const t of d){const i=parseInt(t,10),a=l.segmentation.config.color.getSegmentIndexColor(e,n,i),r=l.segmentation.config.visibility.getSegmentIndexVisibility(e,{segmentationId:n,type:o},i);s[i]={color:a,segmentIndex:i,opacity:a[3],visible:r}}const m=l.segmentation.config.style.getStyle({viewportId:e,segmentationId:n,type:o});return{id:`${n}-${o}-${e}`,segmentationId:n,label:c.label,active:i,type:o,visible:a,segments:s,styles:m,viewportId:e,colorLUTIndex:r,config:{}}}_initSegmentationService(){s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_MODIFIED,this._onSegmentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REMOVED,this._onSegmentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_DATA_MODIFIED,this._onSegmentationDataModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_MODIFIED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_ADDED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_REMOVED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_ADDED,this._onSegmentationAddedFromSource)}getCornerstoneSegmentation(e){return l.segmentation.state.getSegmentation(e)}_highlightLabelmap(e,t,n,o,i,a,r){const{segmentationId:s}=r;if(n)throw new Error("hideOthers is not working right now");const{fillAlpha:c}=this.getStyle({viewportId:i,segmentationId:s,type:Sn,segmentIndex:e});let d=null;const m=t=>{null===d&&(d=t);const n=t-d,o=Math.min(n/a,1);l.segmentation.config.style.setStyle({segmentationId:s,segmentIndex:e,type:Sn},{fillAlpha:ln(o,c)}),o<1?requestAnimationFrame(m):l.segmentation.config.style.setStyle({segmentationId:s,segmentIndex:e,type:Sn},{})};requestAnimationFrame(m)}_highlightContour(e,t,n,o,i,a,r){const{segmentationId:s}=r,c=performance.now(),d=l.segmentation.config.style.getStyle({viewportId:i,segmentationId:s,type:vn,segmentIndex:e}).outlineWidth,m=Math.max(3.5*d,5),p=t=>{const n=(t-c)/a;if(n>=1)return void l.segmentation.config.style.setStyle({segmentationId:s,segmentIndex:e,type:vn},{});const o=function(e,t){return 1-ln(e,t)+t}(n,m);l.segmentation.config.style.setStyle({segmentationId:s,segmentIndex:e,type:vn},{outlineWidth:o}),requestAnimationFrame(p)};requestAnimationFrame(p)}_setActiveSegment(e,t){l.segmentation.segmentIndex.setActiveSegmentIndex(e,t)}_getVolumeIdForDisplaySet(e){return`${e.volumeLoaderSchema??"cornerstoneStreamingImageVolume"}:${e.displaySetInstanceUID}`}_getSegmentCenter(e,t){const n=this.getSegmentation(e);if(!n)return;const{segments:o}=n,{cachedStats:i}=o[t];if(!i)return;const{center:a}=i;return a}_setSegmentLockedStatus(e,t,n){l.segmentation.segmentLocking.setSegmentIndexLocked(e,t,n)}_setSegmentVisibility(e,t,n,o,i){l.segmentation.config.visibility.setSegmentIndexVisibility(e,{segmentationId:t,type:i},n,o)}_setSegmentLabel(e,t,n){const o=this.getCornerstoneSegmentation(e),{segments:i}=o;i[t].label=n,l.segmentation.updateSegmentations([{segmentationId:e,payload:{segments:i}}])}}cn=fn,fn.REGISTRATION={name:"segmentationService",altName:"SegmentationService",create:({servicesManager:e})=>new cn({servicesManager:e})};const wn=fn;function En(e,t){const n=t?.[0]?.viewportType?.toLowerCase()||e.toLowerCase();if("stack"===n)return s.Enums.ViewportType.STACK;if("video"===n)return s.Enums.ViewportType.VIDEO;if("wholeslide"===n)return s.Enums.ViewportType.WHOLE_SLIDE;if("volume"===n||"orthographic"===n)return s.Enums.ViewportType.ORTHOGRAPHIC;if("volume3d"===n)return s.Enums.ViewportType.VOLUME_3D;throw new Error(`Invalid viewport type: ${e}. Valid types are: stack, volume, video, wholeslide`)}var Tn;const Dn="cornerstoneStreamingImageVolume";class bn{constructor(e){this.MAX_CACHE_LENGTH=10,this.currentCacheIndex=0,this.cachedSegVolumesMap=new Map,this.lastUndo=!1,this.cbctSegmentationMetadata=null,this.surfaceActorEntries=[],this.stackImageIds=new Map,this.volumeImageIds=new Map,this.servicesManager=void 0,this.setCbctSegmentationMetadata=e=>{this.cbctSegmentationMetadata=e},this.getCbctSegmentationMetadata=()=>this.cbctSegmentationMetadata,this.setSurfaceActorEntries=e=>{this.surfaceActorEntries=e},this.getSurfaceActorEntries=()=>this.surfaceActorEntries,this.saveSegmentation=e=>{const{segmentationService:t}=this.servicesManager.services,{voxelManager:n}=t.getLabelmapVolume(e),o=n.getCompleteScalarDataArray();if(!this.cachedSegVolumesMap.has(e)){const t=new o.constructor(o.length);this.cachedSegVolumesMap.set(e,[t])}const i=this.cachedSegVolumesMap.get(e);i.length>=50?i.shift():i.length=this.currentCacheIndex+1,this.lastUndo=!1,i.push(o.slice()),this.currentCacheIndex=i.length-1},this.applyReplace=e=>{const{segmentationService:t,viewportGridService:n}=this.servicesManager.services,o=n.getActiveViewportId(),i=t.getActiveSegmentation(o);if(!i)return;const a=this.cachedSegVolumesMap.get(i.segmentationId),r=a?.[e];if(r){t.getLabelmapVolume(i.segmentationId).voxelManager.setCompleteScalarDataArray(r),l.segmentation.triggerSegmentationEvents.triggerSegmentationDataModified(i.segmentationId),this.lastUndo=!0}this.currentCacheIndex=e},this.undo=()=>{this.currentCacheIndex>0&&this.applyReplace(this.currentCacheIndex-1)},this.redo=()=>{this.currentCacheIndex<50&&this.applyReplace(this.currentCacheIndex+1)},this.servicesManager=e}getCacheSize(){return s.cache.getCacheSize()}getCacheFreeSpace(){return s.cache.getBytesAvailable()}async createViewportData(e,t,n,o){const i=En(t.viewportType,e);let a;return a=i===s.Enums.ViewportType.ORTHOGRAPHIC||i===s.Enums.ViewportType.VOLUME_3D?await this._getVolumeViewportData(n,e,o,i):i===s.Enums.ViewportType.STACK?await this._getStackViewportData(n,e,o,i):await this._getOtherViewportData(n,e,o,i),a.viewportType=i,a}async invalidateViewportData(e,t,n,o){if(e.viewportType===s.Enums.ViewportType.STACK){const e=o.getDisplaySetByUID(t),i=this._getCornerstoneStackImageIds(e,n);return i.forEach(e=>{s.cache.getImageLoadObject(e)&&s.cache.removeImageLoadObject(e)}),{viewportType:s.Enums.ViewportType.STACK,data:{StudyInstanceUID:e.StudyInstanceUID,displaySetInstanceUID:t,imageIds:i}}}const i=`${Dn}:${t}`,a=s.cache.getVolume(i);a&&(a.imageIds&&a.imageIds.forEach(e=>{s.cache.getImageLoadObject(e)&&s.cache.removeImageLoadObject(e)}),s.cache._volumeCache.delete(i),this.volumeImageIds.delete(i));const r=e.data.map(({displaySetInstanceUID:e})=>o.getDisplaySetByUID(e));return await this._getVolumeViewportData(n,r,e.viewportType)}async _getOtherViewportData(e,t,n,o){const[i]=t;i.imageIds||(i.imagesIds=this._getCornerstoneStackImageIds(i,e));const{imageIds:a,viewportType:r}=i;return{viewportType:r||o,data:t}}async _getStackViewportData(e,t,n,o){const{uiNotificationService:i}=this.servicesManager.services,a=t.filter(e=>e.isOverlayDisplaySet);for(const e of a)if(e.load&&e.load instanceof Function){const{userAuthenticationService:t}=this.servicesManager.services,n=t.getAuthorizationHeader();try{await e.load({headers:n})}catch(e){i.show({title:"Error loading displaySet",message:e.message,type:"error"}),console.error(e)}}const r=[];for(const o of t){const{displaySetInstanceUID:t,StudyInstanceUID:a,isCompositeStack:s}=o;if(o.load&&o.load instanceof Function){const{userAuthenticationService:e}=this.servicesManager.services,t=e.getAuthorizationHeader();try{await o.load({headers:t})}catch(e){i.show({title:"Error loading displaySet",message:e.message,type:"error"}),console.error(e)}}let l=this.stackImageIds.get(o.displaySetInstanceUID);l||(l=this._getCornerstoneStackImageIds(o,e),o.imageIds=l,this.stackImageIds.set(o.displaySetInstanceUID,l)),r.push({StudyInstanceUID:a,displaySetInstanceUID:t,isCompositeStack:s,imageIds:l,initialImageIndex:n})}return{viewportType:o,data:r}}async _getVolumeViewportData(e,t,n,o){const i=[];for(const o of t){const{Modality:t}=o,a="PMAP"===t,r="SEG"===t;if(o.load&&o.load instanceof Function){const{userAuthenticationService:e}=this.servicesManager.services,t=e.getAuthorizationHeader();try{await o.load({headers:t})}catch(e){const{uiNotificationService:t}=this.servicesManager.services;t.show({title:"Error loading displaySet",message:e.message,type:"error"}),console.error(e)}if(!a){i.push({studyInstanceUID:o.StudyInstanceUID,displaySetInstanceUID:o.displaySetInstanceUID});continue}}const l=`${o.volumeLoaderSchema??Dn}:${o.displaySetInstanceUID}`;let c=this.volumeImageIds.get(o.displaySetInstanceUID),d=s.cache.getVolume(l);a||r||c&&d||(c=this._getCornerstoneVolumeImageIds(o,e),d=await s.volumeLoader.createAndCacheVolume(l,{imageIds:c}),this.volumeImageIds.set(o.displaySetInstanceUID,c),o.imageIds=c),i.push({StudyInstanceUID:o.StudyInstanceUID,displaySetInstanceUID:o.displaySetInstanceUID,volume:d,volumeId:l,imageIds:c,isDynamicVolume:o.isDynamicVolume,initialImageIndex:n})}return{viewportType:o,data:i}}_getCornerstoneStackImageIds(e,t){return t.getImageIdsForDisplaySet(e)}_getCornerstoneVolumeImageIds(e,t){if(e.imageIds)return e.imageIds;return this._getCornerstoneStackImageIds(e,t)}}Tn=bn,bn.REGISTRATION={name:"cornerstoneCacheService",altName:"CornerstoneCacheService",create:({servicesManager:e})=>new Tn(e)};const On=bn,Cn="OHIFCornerstoneRenderingEngine";const An="default",Mn=({data:e,displaySetUID:t,imageId:n,viewport:o})=>{if(n&&e.isCompositeStack&&e.imageIds)return!!e.imageIds.find(e=>e===n);if(n&&(e.volumeId||o instanceof s.VolumeViewport)){if(!!!o.getCurrentImageId())return!1;const e=s.utilities.imageIdToURI(n);if(o.hasImageURI(e))return!0}return e.displaySetInstanceUID===t};const Rn=class{constructor(e){this.viewportId="",this.element=void 0,this.viewportOptions=void 0,this.displaySetOptions=void 0,this.viewportData=void 0,this.renderingEngineId=void 0,this.viewReference=void 0,this.destroy=()=>{this.element=null,this.viewportData=null,this.viewportOptions=null,this.displaySetOptions=null},this.viewportId=e,this.setPublicViewportOptions({}),this.setPublicDisplaySetOptions([{}])}contains(e,t){if(!this.viewportData?.data)return!1;const{viewport:n}=(0,s.getEnabledElementByViewportId)(this.viewportId)||{};return this.viewportData.data.length?!!this.viewportData.data.find(o=>Mn({data:o,displaySetUID:e,imageId:t,viewport:n})):Mn({data:this.viewportData.data,displaySetUID:e,imageId:t,viewport:n})}setRenderingEngineId(e){this.renderingEngineId=e}getRenderingEngineId(){return this.renderingEngineId}setViewportId(e){this.viewportId=e}setElement(e){this.element=e}setViewportData(e){this.viewportData=e}getViewportData(){return this.viewportData}getElement(){return this.element}getViewportId(){return this.viewportId}getViewReference(){return this.viewportOptions?.viewReference}setPublicDisplaySetOptions(e){const t=this.mapDisplaySetOptions(e);return this.setDisplaySetOptions(t),this.displaySetOptions}hasDisplaySet(e){let t=this.getViewportData();return t.viewportType===s.Enums.ViewportType.ORTHOGRAPHIC||t.viewportType===s.Enums.ViewportType.VOLUME_3D?t.data.some(({displaySetInstanceUID:t})=>t===e):t.data.displaySetInstanceUID===e}setPublicViewportOptions(e,t){const n=t||e.viewportType||"stack",{presentationIds:o}=e;let{toolGroupId:i=An}=e;const a=function(e){if(e)switch(e.toLowerCase()){case"axial":return s.Enums.OrientationAxis.AXIAL;case"sagittal":return s.Enums.OrientationAxis.SAGITTAL;case"coronal":return s.Enums.OrientationAxis.CORONAL;default:return s.Enums.OrientationAxis.ACQUISITION}return s.Enums.OrientationAxis.ACQUISITION}(e.orientation),r=En(n);return i||(i=An),this.setViewportOptions({...e,viewportId:this.viewportId,viewportType:r,orientation:a,toolGroupId:i,presentationIds:o}),this.viewportOptions}setViewportOptions(e){this.viewportOptions=e}getViewportOptions(){return this.viewportOptions}getPresentationIds(){const{presentationIds:e}=this.viewportOptions;return e}setDisplaySetOptions(e){this.displaySetOptions=e}getSyncGroups(){return this.viewportOptions.syncGroups||=[],this.viewportOptions.syncGroups}getDisplaySetOptions(){return this.displaySetOptions}getViewportType(){return this.viewportOptions.viewportType||s.Enums.ViewportType.STACK}getToolGroupId(){return this.viewportOptions.toolGroupId}getBackground(){return this.viewportOptions.background||[0,0,0]}getOrientation(){return this.viewportOptions.orientation}getDisplayArea(){return this.viewportOptions.displayArea}getInitialImageOptions(){return this.viewportOptions.initialImageOptions}mapDisplaySetOptions(e=[{}]){const t=[];return e.forEach(e=>{let n=e?.options||e;n||(n={blendMode:void 0,slabThickness:void 0,colormap:void 0,voi:{},voiInverted:!1});const o=function(e){if(!e)return s.Enums.BlendModes.COMPOSITE;if("mip"===e.toLowerCase())return s.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND;if("minip"===e.toLowerCase())return s.Enums.BlendModes.MINIMUM_INTENSITY_BLEND;if("avg"===e.toLowerCase())return s.Enums.BlendModes.AVERAGE_INTENSITY_BLEND;throw new Error(`Unsupported blend mode: ${e}`)}(n.blendMode);t.push({voi:n.voi,voiInverted:n.voiInverted,colormap:n.colormap,slabThickness:n.slabThickness,blendMode:o,displayPreset:n.displayPreset})}),t}};var Nn=function(e){return e.First="first",e.Last="last",e.Middle="middle",e}(Nn||{});const Vn=Nn;var Pn;const Un={VIEWPORT_DATA_CHANGED:"event::cornerstoneViewportService:viewportDataChanged",VIEWPORT_VOLUMES_CHANGED:"event::cornerstoneViewportService:viewportVolumesChanged"};class xn extends p.Rc{constructor(e){super(Un),this.renderingEngine=void 0,this.viewportsById=new Map,this.viewportGridResizeObserver=void 0,this.viewportsDisplaySets=new Map,this.beforeResizePositionPresentations=new Map,this.enableResizeDetector=void 0,this.resizeRefreshRateMs=void 0,this.resizeRefreshMode=void 0,this.servicesManager=null,this.resizeQueue=[],this.viewportResizeTimer=null,this.gridResizeDelay=50,this.gridResizeTimeOut=null,this.hangingProtocolService=void 0,this.viewportsInfo=void 0,this.sceneVolumeInputs=void 0,this.viewportDivElements=void 0,this.ViewportPropertiesMap=void 0,this.volumeUIDs=void 0,this.displaySetsNeedRerendering=void 0,this.viewportDisplaySets=void 0,this.renderingEngine=null,this.viewportGridResizeObserver=null,this.servicesManager=e}enableViewport(e,t){const n=new Rn(e);n.setElement(t),this.viewportsById.set(e,n)}getViewportIds(){return Array.from(this.viewportsById.keys())}getRenderingEngine(){const e=(0,s.getRenderingEngine)(Cn);return e?(this.renderingEngine=e,this.renderingEngine):(e&&!e.hasBeenDestroyed||(this.renderingEngine=new s.RenderingEngine(Cn)),this.renderingEngine)}resize(e=!1){Array.from(this.viewportsById.values()).every(e=>{const t=e.getElement();return 0===t.clientWidth&&0===t.clientHeight})?console.warn("Ignoring resize when viewports have size 0"):e?(this.performResize(),this.resetGridResizeTimeout(),this.resizeQueue=[],clearTimeout(this.viewportResizeTimer)):this.enqueueViewportResizeRequest()}destroy(){this._removeResizeObserver(),this.viewportGridResizeObserver=null;try{this.renderingEngine?.destroy?.()}catch(e){console.warn("Rendering engine not destroyed",e)}this.viewportsDisplaySets.clear(),this.renderingEngine=null,s.cache.purgeCache()}disableElement(e){this.renderingEngine?.disableElement(e),this.viewportsById.delete(e),this.viewportsDisplaySets.delete(e)}setPresentations(e,t){const n=this.getCornerstoneViewport(e);if(!n||!t)return;const{lutPresentation:o,positionPresentation:i,segmentationPresentation:a}=t;this._setSegmentationPresentation(n,a),this._setLutPresentation(n,o),this._setPositionPresentation(n,{...i,viewportId:e})}storePresentation({viewportId:e}){const t=this.getPresentationIds(e),{syncGroupService:n}=this.servicesManager.services,o=n.getSynchronizersForViewport(e);if(!t||0===Object.keys(t).length)return null;const{lutPresentationId:i,positionPresentationId:a,segmentationPresentationId:r}=t,s=this._getPositionPresentation(e),l=this._getLutPresentation(e),c=this._getSegmentationPresentation(e),{setLutPresentation:d}=Qe.I.getState(),{setPositionPresentation:m}=et.q.getState(),{setSynchronizers:p}=Et.U.getState(),{setSegmentationPresentation:u}=tt.v.getState();i&&d(i,l),a&&m(a,s),r&&u(r,c),o?.length&&p(e,o.map(e=>({id:e.id,sourceViewports:[...e.getSourceViewports()],targetViewports:[...e.getTargetViewports()]})))}getPresentations(e){return{positionPresentation:this._getPositionPresentation(e),lutPresentation:this._getLutPresentation(e),segmentationPresentation:this._getSegmentationPresentation(e)}}getPresentationIds(e){const t=this.viewportsById.get(e);return t?t.getPresentationIds():null}_getPositionPresentation(e){const t=this.getCornerstoneViewport(e);if(!t)return;return{viewportType:this.viewportsById.get(e).getViewportType(),viewReference:t instanceof s.VolumeViewport3D?null:t.getViewReference(),viewPresentation:t.getViewPresentation({pan:!0,zoom:!0}),viewportId:e}}_getLutPresentation(e){const t=this.getCornerstoneViewport(e);if(!t)return;const n=e=>(e?.isComputedVOI&&(delete e?.voiRange,delete e?.VOILUTFunction),e),o=t instanceof s.BaseVolumeViewport?new Map:n(t.getProperties());if(o instanceof Map){const e=t.getAllVolumeIds();e?.forEach(e=>{const i=n(t.getProperties(e));o.set(e,i)})}return{viewportType:this.viewportsById.get(e).getViewportType(),properties:o}}_getSegmentationPresentation(e){const{segmentationService:t}=this.servicesManager.services;return t.getPresentation(e)}setViewportData(e,t,n,o,i){const a=this.getRenderingEngine();if(t.viewportType===s.Enums.ViewportType.STACK&&!t.data[0].imageIds?.length)return;const r=this.viewportsById.get(e);if(this.storePresentation({viewportId:r.getViewportId()}),this.servicesManager.services.segmentationService.clearSegmentationRepresentations(r.getViewportId()),!r)throw new Error("element is not enabled for the given viewportId");const l=r.setPublicDisplaySetOptions(o),c=r.setPublicViewportOptions(n,t.viewportType),d=r.getElement(),m=r.getViewportType(),p=r.getBackground(),u=r.getOrientation(),g=r.getDisplayArea(),h={viewportId:e,element:d,type:m,defaultOptions:{background:p,orientation:u,displayArea:g}};r.setRenderingEngineId(a.id),a.enableElement(h),r.setViewportOptions(c),r.setDisplaySetOptions(l),r.setViewportData(t),r.setViewportId(e),this.viewportsById.set(e,r);const I=a.getViewport(e);this._setDisplaySets(I,t,r,i).then(()=>{this._broadcastEvent(this.EVENTS.VIEWPORT_DATA_CHANGED,{viewportData:t,viewportId:e})})}getCornerstoneViewport(e){if(!this.getViewportInfo(e)||!this.renderingEngine||this.renderingEngine.hasBeenDestroyed)return null;return this.renderingEngine.getViewport(e)}getViewportInfo(e){return this.viewportsById.get(e)}getViewportIdToJump(e,t){const n=this.getCornerstoneViewport(e);if(n.isReferenceViewable(t,{withNavigation:!0}))return e;for(const e of this.viewportsById.keys()){const n=this.getCornerstoneViewport(e);if(n?.isReferenceViewable(t,{withNavigation:!0}))return e}if(n.isReferenceViewable(t,{withNavigation:!0,withOrientation:!0}))return e;for(const e of this.viewportsById.keys()){const n=this.getCornerstoneViewport(e);if(n?.isReferenceViewable(t,{withNavigation:!0,withOrientation:!0}))return e}return null}async _setOtherViewport(e,t,n,o={}){const[i]=t.data;return e.setDataIds(i.imageIds,{groupId:i.displaySetInstanceUID,viewReference:n.getViewReference()})}async _setStackViewport(e,t,n,o={}){const i=n.getDisplaySetOptions(),a=t.data.map(e=>e.displaySetInstanceUID);this.viewportsDisplaySets.set(e.id,[...a]);const{initialImageIndex:r,imageIds:c}=t.data[0];let d=o?.positionPresentation?.initialImageIndex??r;const{rotation:m,flipHorizontal:p,displayArea:u}=n.getViewportOptions(),g={...o.lutPresentation?.properties};if(!o.lutPresentation?.properties){const{voi:e,voiInverted:t,colormap:n}=i[0];if(e&&(e.windowWidth||e.windowCenter)){const{lower:t,upper:n}=s.utilities.windowLevel.toLowHighRange(e.windowWidth,e.windowCenter);g.voiRange={lower:t,upper:n}}g.invert=t??g.invert,g.colormap=n??g.colormap}e.element.addEventListener(s.Enums.Events.VIEWPORT_NEW_IMAGE_SET,t=>{const{element:n}=t.detail;n===e.element&&l.utilities.stackContextPrefetch.enable(n)});let h=c;const I=this._processExtraDisplaySetsForViewport(e);h=I?.imageIds??h;const S=o?.positionPresentation?.viewReference?.referencedImageId;return S&&(d=h.indexOf(S)),null==d&&(d=this._getInitialImageIndexForViewport(n,c)||0),e.setStack(h,d).then(()=>{e.setProperties({...g}),this.setPresentations(e.id,o,n),I?.addOverlayFn&&I.addOverlayFn(),u&&e.setDisplayArea(u),m&&e.setProperties({rotation:m}),p&&e.setCamera({flipHorizontal:!0})})}_getInitialImageIndexForViewport(e,t){const n=e.getInitialImageOptions();if(!n)return;const{index:o,preset:i}=n,a=e.getViewportType();let r;if(a===s.Enums.ViewportType.STACK)r=t.length;else{if(a!==s.Enums.ViewportType.ORTHOGRAPHIC)return;{const t=this.getCornerstoneViewport(e.getViewportId()),n=s.utilities.getImageSliceDataForVolumeViewport(t);if(!n)return;({numberOfSlices:r}=n)}}return this._getInitialImageIndex(r,o,i)}_getInitialImageIndex(e,t,n){const o=e-1;return void 0!==t?s.utilities.clip(t,0,o):n===Vn.First?0:n===Vn.Last?o:n===Vn.Middle?o%2==0?o/2:(o+1)/2:0}async _setVolumeViewport(e,t,n,o={}){const i=[],a=n.getDisplaySetOptions(),{hangingProtocolService:r}=this.servicesManager.services,s=[],l=[];for(const[e,n]of t.data.entries()){const{volume:t,imageIds:o,displaySetInstanceUID:r}=n;if(l.push(r),!t){console.log("Volume display set not found");continue}s.push(t);const c=a[e],{volumeId:d}=t;i.push({imageIds:o,volumeId:d,blendMode:c.blendMode,slabThickness:this._getSlabThickness(c,d)})}this.viewportsDisplaySets.set(e.id,l);const c=s.filter(e=>!1===e.loadStatus?.loaded);if(c.length){if(r.getShouldPerformCustomImageLoad())return r.runImageLoadStrategy({viewportId:e.id,volumeInputArray:i});c.forEach(e=>{!e.loadStatus?.loading&&e.load instanceof Function&&e.load()})}return this.setVolumesForViewport(e,i,o)}async setVolumesForViewport(e,t,n){const{cornerstoneCacheService:o,displaySetService:i,panoramicService:a,viewportGridService:r}=this.servicesManager.services,l=this.getViewportInfo(e.id),c=l.getDisplaySetOptions(),d=r.getDisplaySetsUIDsForViewport(e.id),m=i.getDisplaySetByUID(d[0]),p=m?.Modality,u=t.map((e,t)=>{const{volumeId:n}=e,o=c[t],{voi:i,voiInverted:a,colormap:r,displayPreset:l}=o,d={};if(i&&(i.windowWidth||i.windowCenter)){const{lower:e,upper:t}=s.utilities.windowLevel.toLowHighRange(i.windowWidth,i.windowCenter);d.voiRange={lower:e,upper:t}}return void 0!==a&&(d.invert=a),void 0!==r&&(d.colormap=r),void 0!==l&&(d.preset=l[p]||l.default),{properties:d,volumeId:n}}),{addOverlayFn:g}=this._processExtraDisplaySetsForViewport(e)||{};var h;e.type===s.Enums.ViewportType.VOLUME_3D&&await(h=()=>{const e=s.cache.getVolume(t[0].volumeId);return e&&!(!1===e.loadStatus?.loaded)},new Promise((e,t)=>{const n=()=>{const t=h();if(t)return e(t);setTimeout(()=>n(),50)};n()})),await e.setVolumes(t),g&&g(),u.forEach(({properties:t,volumeId:n})=>{e.setProperties(t,n)}),this.setPresentations(e.id,n,l);const I=this._getInitialImageIndexForViewport(l);if(void 0!==I&&s.utilities.jumpToSlice(e.element,{imageIndex:I}),e.type===s.Enums.ViewportType.VOLUME_3D){const t=o.getSurfaceActorEntries();if(t.length){const n=e.getActors();for(const{volumeId:t}of n)e.setOpacity({opacity:0},t);e.setActors(n),e.addActors(t,{resetCamera:!0})}}if(e.render(),this._broadcastEvent(this.EVENTS.VIEWPORT_VOLUMES_CHANGED,{viewportInfo:l}),e.type===s.Enums.ViewportType.VOLUME_3D){const e=r.getDisplaySetsUIDsForViewport("default")[0];a.getPanoramicState(e)||a.initializePanoramicService()}}_processExtraDisplaySetsForViewport(e){const{displaySetService:t}=this.servicesManager.services,n=this.viewportsDisplaySets.get(e.id).map(t.getDisplaySetByUID).find(e=>e?.isOverlayDisplaySet&&["SEG","RTSTRUCT"].includes(e.Modality));if(!n)return;return{imageIds:t.getDisplaySetByUID(n.referencedDisplaySetInstanceUID).images.map(e=>e.imageId),addOverlayFn:()=>this.addOverlayRepresentationForDisplaySet(n,e)}}addOverlayRepresentationForDisplaySet(e,t){const{segmentationService:n}=this.servicesManager.services,o=e.displaySetInstanceUID,i="SEG"===e.Modality?l.Enums.SegmentationRepresentations.Labelmap:l.Enums.SegmentationRepresentations.Contour;n.addSegmentationRepresentation(t.id,{segmentationId:o,type:i}),this.storePresentation({viewportId:t.id})}updateViewport(e,t,n,o=!1){const i=this.getViewportInfo(e),a=this.getCornerstoneViewport(e),r=a.getCamera();let l;(a instanceof s.VolumeViewport||a instanceof s.VolumeViewport3D)&&(l=this._setVolumeViewport(a,t,i).then(()=>{o&&(a.setCamera(r),a.render())})),a instanceof s.StackViewport&&(l=this._setStackViewport(a,t,i)),l.then(()=>{this._broadcastEvent(this.EVENTS.VIEWPORT_DATA_CHANGED,{viewportData:t,viewportId:e})})}_setDisplaySetInURL(e){if(!e)return;const t=new URLSearchParams(window.location.search);if(t.get("displaySetInstanceUID")!==e){t.set("displaySetInstanceUID",e);const n=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+t.toString();window.history.pushState({path:n},"",n)}}_setSeriesUIDInURL(e){if(!e)return;const t=s.metaData.get("generalSeriesModule",e).seriesInstanceUID,n=new URLSearchParams(window.location.search);if(!t.includes(n.get("seriesUID"))){n.set("seriesUID",t);const e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+n.toString();window.history.pushState({path:e},"",e)}}_setDisplaySets(e,t,n,o={}){return this._setSeriesUIDInURL(t?.data[0]?.imageIds[0]),e instanceof s.StackViewport?this._setStackViewport(e,t,n,o):[s.VolumeViewport,s.VolumeViewport3D].some(t=>e instanceof t)?this._setVolumeViewport(e,t,n,o):this._setOtherViewport(e,t,n,o)}_removeResizeObserver(){this.viewportGridResizeObserver&&this.viewportGridResizeObserver.disconnect()}_getSlabThickness(e,t){const{blendMode:n}=e;if(void 0!==n&&void 0!==e.slabThickness){if("number"==typeof e.slabThickness)return e.slabThickness;if("fullvolume"===e.slabThickness.toLowerCase()){const e=s.cache.getVolume(t),{dimensions:n,spacing:o}=e;return Math.sqrt(Math.pow(n[0]*o[0],2)+Math.pow(n[1]*o[1],2)+Math.pow(n[2]*o[2],2))}}}_getFrameOfReferenceUID(e){const{displaySetService:t}=this.servicesManager.services,n=t.getDisplaySetByUID(e);if(!n)return;if(n.frameOfReferenceUID)return n.frameOfReferenceUID;if("SEG"===n.Modality){const{instance:e}=n;return e.FrameOfReferenceUID}if("RTSTRUCT"===n.Modality){const{instance:e}=n;return e.ReferencedFrameOfReferenceSequence.FrameOfReferenceUID}const{images:o}=n;return o&&o.length?o[0].FrameOfReferenceUID:void 0}enqueueViewportResizeRequest(){this.resizeQueue.push(!1),clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=setTimeout(()=>{this.processViewportResizeQueue()},this.gridResizeDelay)}processViewportResizeQueue(){const e=this.resizeQueue.some(e=>e);this.resizeQueue.length>0&&!e&&!this.gridResizeTimeOut&&this.performResize(),this.resizeQueue=[]}performResize(){const e=!1;try{this.getRenderingEngine().getViewports().forEach(({id:e})=>{const t=this._getPositionPresentation(e);delete t.viewReference?.sliceIndex,this.beforeResizePositionPresentations.set(e,t)});const t=this.renderingEngine;t.resize(e),t.render(),this.beforeResizePositionPresentations.forEach((e,t)=>{this.setPresentations(t,{positionPresentation:e})}),t.resize(e),t.render()}catch(e){console.warn("Caught resize exception",e)}}resetGridResizeTimeout(){clearTimeout(this.gridResizeTimeOut),this.gridResizeTimeOut=setTimeout(()=>{this.gridResizeTimeOut=null},this.gridResizeDelay)}_setLutPresentation(e,t){if(!t)return;const{properties:n}=t;e instanceof s.BaseVolumeViewport&&n instanceof Map?n.forEach((t,n)=>{e.setProperties(t,n)}):e.setProperties(n)}_setPositionPresentation(e,t){const n=t?.viewReference;n&&e.setViewReference(n);const o=t?.viewPresentation;o&&e.setViewPresentation(o)}_setSegmentationPresentation(e,t){if(!t)return;const{segmentationService:n}=this.servicesManager.services;t.forEach(t=>{const{segmentationId:o,type:i,hydrated:a}=t;a&&n.addSegmentationRepresentation(e.id,{segmentationId:o,type:i})})}}Pn=xn,xn.REGISTRATION={name:"cornerstoneViewportService",altName:"CornerstoneViewportService",create:({servicesManager:e})=>new Pn(e)};const _n=xn;let Ln=function(e){return e.Removed="removed",e.Added="added",e.Modified="modified",e}({});var Fn;const{ViewportColorbar:Gn}=l.utilities.voi.colorbar;class kn extends p.Rc{constructor(){super(kn.EVENTS),this.colorbars={}}getVolumeIdForIdentifier(e,t){const n=e.getAllVolumeIds?.()||[];return n.length>0&&n.find(e=>e.includes(t))||null}addColorbar(e,t,n={}){const o=(0,s.getRenderingEngine)(Cn).getViewport(e);if(!o)return;const{element:i}=o,a=o.getActors();if(!a||0===a.length)return;const{position:r,width:l,activeColormapName:c,colormaps:d}=n,m=t.length,p=this.createContainers(m,i,r,l,e);t.forEach((t,a)=>{const r=this.getVolumeIdForIdentifier(o,t),l=o?.getProperties(r),m=l?.colormap;c&&!m&&this.setViewportColormap(e,t,d[c],!0);const u=p[a],g=new Gn({id:`ctColorbar-${e}-${a}`,element:i,colormaps:n.colormaps||{},activeColormapName:m?.name||n?.activeColormapName||"Grayscale",container:u,ticks:{...kn.defaultTickStyles,...n.ticks},volumeId:o instanceof s.VolumeViewport?r:void 0});this.colorbars[e]?this.colorbars[e].push({colorbar:g,container:u}):this.colorbars[e]=[{colorbar:g,container:u}]}),this._broadcastEvent(kn.EVENTS.STATE_CHANGED,{viewportId:e,changeType:Ln.Added})}removeColorbar(e){const t=this.colorbars[e];t&&(t.forEach(({colorbar:e,container:t})=>{t.parentNode.removeChild(t)}),delete this.colorbars[e],this._broadcastEvent(kn.EVENTS.STATE_CHANGED,{viewportId:e,changeType:Ln.Removed}))}hasColorbar(e){return!!this.colorbars[e]}getState(){return this.colorbars}getViewportColorbar(e){return this.colorbars[e]}onModeExit(){Object.keys(this.colorbars).forEach(e=>{this.removeColorbar(e)})}setViewportColormap(e,t,n,o=!1){const i=(0,s.getRenderingEngine)(Cn).getViewport(e),a=i?.getActors();if(!i||!a||0===a.length)return;const r=(e,t)=>{const o=this.getVolumeIdForIdentifier(e,t);e.setProperties({colormap:n},o)};i instanceof s.StackViewport&&r(i,e),i instanceof s.VolumeViewport&&r(i,t),o&&i.render()}createContainers(e,t,n,o,i){const a=[],r={1:50,2:33}[e]||50/e;return Array.from({length:e}).forEach((e,s)=>{const l=document.createElement("div");l.id=`ctColorbarContainer-${i}-${s+1}`,Object.assign(l.style,kn.defaultStyles),["top","bottom"].includes(n)?Object.assign(l.style,{width:`${r}%`,height:o||"2.5%",left:(s+1)*r+"%",transform:"translateX(-50%)",...kn.positionStyles[n]}):["left","right"].includes(n)&&Object.assign(l.style,{height:`${r}%`,width:o||"2.5%",top:(s+1)*r+"%",transform:"translateY(-50%)",...kn.positionStyles[n]}),t.appendChild(l),a.push(l)}),a}}Fn=kn,kn.EVENTS={STATE_CHANGED:"event::ColorbarService:stateChanged"},kn.defaultStyles={position:"absolute",boxSizing:"border-box",border:"solid 1px #555",cursor:"initial"},kn.positionStyles={left:{left:"5%"},right:{right:"5%"},top:{top:"5%"},bottom:{bottom:"5%"}},kn.defaultTickStyles={position:"left",style:{font:"12px Arial",color:"#fff",maxNumTicks:8,tickSize:5,tickWidth:1,labelMargin:3}},kn.REGISTRATION={name:"colorbarService",create:()=>new Fn};const Bn=kn;var zn,$n=n(6322);function Wn(e){return new Promise((t,n)=>{const o=()=>{const n=e();if(n)return t(n);setTimeout(()=>o(),50)};o()})}class Hn extends p.Rc{constructor(e,t,n){super(Hn.EVENTS),this.displayed=!1,this.editing=!1,this.processing=!1,this.subscriptions=[],this.panoramicStates={},this.dentascanIndex=void 0,this.commandsManager=void 0,this.servicesManager=void 0,this.extensionManager=void 0,this.EVENTS={STATUS_DISPLAYED_CHANGED:"event::PanoramicService:statusDisplayedChanged",STATUS_EDITING_CHANGED:"event::PanoramicService:statusEditingChanged",PANORAMIC_STATE_UPDATED:"event::PanoramicService:panoramicStateUpdated",PANORAMIC_PROCESSING:"event::PanoramicService:panoramicProcessing",DENTASCAN_INDEX_UPDATED:"event::PanoramicService:dentascanIndexUpdated",TEETH_AXES_UPDATED:"event::PanoramicService:teethAxesUpdated"},this.isDisplayed=()=>this.displayed,this.setDisplayed=e=>{this.displayed=e,this._broadcastEvent(this.EVENTS.STATUS_DISPLAYED_CHANGED,{displayed:e})},this.isEditing=()=>this.editing,this.setEditing=e=>{this.editing=e,this._broadcastEvent(this.EVENTS.STATUS_EDITING_CHANGED,{editing:e})},this.isProcessing=()=>this.processing,this.getPanoramicState=e=>this.panoramicStates[e],this.setPanoramicState=(e,t)=>{this.panoramicStates[e]=t,this._broadcastEvent(this.EVENTS.PANORAMIC_STATE_UPDATED,{displaySetInstanceUID:e})},this.setDentascanIndex=(e,t)=>{this.dentascanIndex=t,this._broadcastEvent(this.EVENTS.DENTASCAN_INDEX_UPDATED,{displaySetInstanceUID:e})},this.setTeethAxes=(e,t)=>{this.panoramicStates[e].teethAxes=t,this._broadcastEvent(this.EVENTS.TEETH_AXES_UPDATED,{displaySetInstanceUID:e})},this.setPanoramicProcessingPourcent=e=>{this._broadcastEvent(this.EVENTS.PANORAMIC_PROCESSING,{percent:e})},this._getImageId=e=>{const{displaySetService:t}=this.servicesManager.services,n=t.getDisplaySetByUID(e),o=p.H8.getSeries(n.StudyInstanceUID,n.SeriesInstanceUID),i=o.instances[0].frameNumber;return o.instances[0].imageId+(i?"&frame="+i:"")},this._getControlPoints=(e,t,n)=>{const{measurementService:o}=this.servicesManager.services,i=o.getMeasurements().filter(t=>"ArrowAnnotate"===t.toolName&&t.metadata.handmade&&t.displaySetInstanceUID===e);if(!i.length)return[];const[[a,r],[s,l]]=n;let c=i[0].points.map(e=>{let[n,o,i]=t.worldToIndex(e);return n=Math.min(Math.max(Math.round(n),a),r),o=Math.min(Math.max(Math.round(o),s),l),{x:n,y:o}});return c.sort((e,t)=>e.x-t.x),c},this.initializePanoramicService=()=>{const{hangingProtocolService:e,viewportGridService:t}=this.servicesManager.services,n=t.getDisplaySetsUIDsForViewport("default")[0];this.setPanoramicState(n,void 0);const o=e.EVENTS.PROTOCOL_CHANGED;e.subscribe(o,({protocol:e})=>{"panoramicViewport"!==e.id||this.isDisplayed()?"panoramicViewport"!==e.id&&this.isDisplayed()&&this.handleProtocolExit(n):this.handleProtocolEnter(n)}),this.panoramicPipeline(n)},this.showOrHideAnnotations=(e,t)=>{const{cornerstoneViewportService:n}=this.servicesManager.services;for(const n of e)l.annotation.visibility.setAnnotationVisibility(n,t);const o=n.getRenderingEngine().getViewports().map(e=>e.id);l.utilities.triggerAnnotationRenderForViewportIds(o)},this.handleProtocolEnter=async e=>{const{cornerstoneViewportService:t,hangingProtocolService:n}=this.servicesManager.services,o=n.getActiveProtocol().viewportMatchDetails.size;await Wn(()=>t.getViewportIds().length===o),await Wn(()=>0===t.getRenderingEngine()._needsRender.size),this.setDisplayed(!0),this.addSubscriptions(),this.addViewportListeners();const i=this.getPanoramicState(e);if(i){const t=this.isEditing()?[i.annotationUIDs[0]]:i.annotationUIDs?.slice(1);this.showOrHideAnnotations(t,!0),await this.waitPanoramicDisplay();const n=Math.round(i.panoramicDimensions[0]/2)-1;this.setDentascanIndex(e,n),this.initializeDentascanSegmentations()}},this.handleProtocolExit=async e=>{const t=this.getPanoramicState(e);t&&this.showOrHideAnnotations(t.annotationUIDs,!1),this.removeViewportListeners();for(const e of this.subscriptions)e();this.subscriptions=[],this.setDisplayed(!1)},this.initializeDentascanSegmentations=async()=>{const{displaySetService:e,panoramicService:t,segmentationService:n}=this.servicesManager.services,o=n.getAxialSegmentations();if(!o?.length)return;const i=n.getDentascanSegmentations();if(i?.length)for(const e of i)n.remove(e.segmentationId);const a=e.getActiveDisplaySets().find(e=>e.SeriesInstanceUID.includes("dentascan"));await Promise.all(o.map(async e=>{const{segmentationId:o,segments:i,label:r}=e,s="dentascan_"+o;if(await n.createLabelmapForDisplaySet(a,{segmentationId:s,segments:i,label:r}),t.isDisplayed()){const e=n._segmentationIdToColorLUTIndexMap.get(o);n._segmentationIdToColorLUTIndexMap.set(s,e),await n.addSegmentationRepresentation("dentascan",{segmentationId:s,type:l.Enums.SegmentationRepresentations.Labelmap}),n.setActiveSegmentation("dentascan",s)}})),this.copySegmentationVolumesForDentascan()},this.getDentascanPointIndex=e=>{const{element:t,currentPoints:n}=e.detail,{viewport:o}=(0,s.getEnabledElement)(t),{imageData:i}=o.getImageData(),[a,r,l]=i.worldToIndex(n.world);return[a,r,Math.round(l)]},this.getAxialPointIndex=(e,t,n)=>{const o=e.minPoint,[i,a]=e.direction;return[o[0]+t*i,o[1]+t*a,e.shape[1]+e.minLayer-n]},this.getAxialOperationData=(e,t,n)=>{const{cornerstoneViewportService:o,segmentationService:i}=this.servicesManager.services,a=o.getCornerstoneViewport("default"),r=a.element,s=o.getViewportInfo("default").getViewportData().data[0],l=s.volume.imageData,c=s.displaySetInstanceUID,d=this.getPanoramicState(c),[m,p,u]=this.getDentascanPointIndex(e),g=d.dentascans[u],[h,I,S]=this.getAxialPointIndex(g,m,p),v=l.indexToWorld([h,I,S]);t._hoverData=t.createHoverData(r),t._calculateCursor(r,v);const{points:y}=t._hoverData.brushCursor.data.handles,f=t.createEditData(r),{preview:w,strategySpecificConfiguration:E,eraseFocusIndex:T}=t.configuration,{viewPlaneNormal:D,viewUp:b}=a.getCamera(),{segmentationId:O}=i.getActiveSegmentation("default");return{...f,points:y,segmentIndex:n,previewColors:w.enabled?w.previewColors:null,viewPlaneNormal:D,toolGroupId:"mpr",segmentationId:O,viewUp:b,strategySpecificConfiguration:E,eraseFocusIndex:T,preview:t._previewData?.preview}},this._downCallBack=e=>{const{toolGroupService:t}=this.servicesManager.services,{viewportId:n,element:o,mouseButton:i}=e.detail,a=t.getToolGroup("mpr");1===i&&a.currentActivePrimaryToolName.includes("Brush")&&("default"!==n&&o.addEventListener(l.Enums.Events.MOUSE_DRAG,this._dragCallBack),o.addEventListener(l.Enums.Events.MOUSE_UP,this._endCallBack),o.addEventListener(l.Enums.Events.MOUSE_CLICK,this._endCallBack))},this.copySegmentationVolumesForDentascan=()=>{const{segmentationService:e,cornerstoneViewportService:t}=this.servicesManager.services,{displaySetInstanceUID:n,volume:o}=t.getViewportInfo("default").getViewportData().data[0],[i,a,r]=o.dimensions,s=e.getAxialSegmentations(),c=e.getDentascanSegmentations();if(!s||!c)return;const d=(e,t,n,o,r)=>{const s=e+r*n,l=t+r*o,c=e+(r+1)*n,d=t+(r+1)*o,[m,p,u,g]=[Math.floor(s),Math.floor(c),Math.floor(l),Math.floor(d)];if(s<0||l<0||c>=i||d>=a)return{};let h=m,I=u;if(m!==p&&u===g){(m<p?(1-s%1)/n:-s%1/n)>=.5&&(h=p)}else if(m===p&&u!==g){(u<g?(1-l%1)/o:-l%1/o)>=.5&&(I=g)}else if(m!==p&&u!==g){const e=m<p?(1-s%1)/n:-s%1/n,t=u<g?(1-l%1)/o:-l%1/o;e<t?t<=.5?(h=p,I=g):e<.5&&(h=p):e<=.5?(h=p,I=g):t<.5&&(I=g)}return{px:h,py:I}};s.forEach((t,o)=>{const{voxelManager:s}=e.getLabelmapVolume(t.segmentationId),m=s.getCompleteScalarDataArray(),p=c[o].segmentationId,{voxelManager:u}=e.getLabelmapVolume(p),g=u.getCompleteScalarDataArray().slice(),{dentascans:h}=this.getPanoramicState(n);h.forEach((e,t)=>{const n=e.minPoint,[o,s]=n.map(Math.floor),[l,c]=e.direction,[p,u]=e.shape,h=[];for(let e=0;e<p;e++)h.push(d(o,s,l,c,e));for(let n=0;n<r;n++)for(let o=0;o<p;o++){const{px:r,py:s}=h[o];if(void 0===r)continue;const l=(u+e.minLayer-n)*i*a+s*i+r;g[t*p*u+n*p+o]=m[l]}}),u.setCompleteScalarDataArray(g),l.segmentation.triggerSegmentationEvents.triggerSegmentationDataModified(p)})},this._endCallBack=e=>{const{viewportId:t,element:n}=e.detail;"default"!==t&&n.removeEventListener(l.Enums.Events.MOUSE_DRAG,this._dragCallBack),n.removeEventListener(l.Enums.Events.MOUSE_UP,this._endCallBack),n.removeEventListener(l.Enums.Events.MOUSE_CLICK,this._endCallBack),this.copySegmentationVolumesForDentascan()},this._dragCallBack=e=>{const{cornerstoneViewportService:t,segmentationService:n,toolGroupService:o}=this.servicesManager.services,i=o.getToolGroup("mpr"),a=i.getToolInstance(i.currentActivePrimaryToolName),{segmentIndex:r}=n.getActiveSegment("dentascan"),l=this.getAxialOperationData(e,a,r),c=t.getCornerstoneViewport("default").element,d=(0,s.getEnabledElement)(c);a.applyActiveStrategy(d,l)},this.panoramicPipeline=async e=>{if((0,$n.yB)({commandsManager:this.commandsManager,extensionManager:this.extensionManager,servicesManager:this.servicesManager}),this.isDisplayed()){this.commandsManager.runCommand("panoramicView",{reset:!0});const t=this.getPanoramicState(e);this.showOrHideAnnotations(t.annotationUIDs.slice(1),!0),await this.waitPanoramicDisplay();const n=Math.round(t.panoramicDimensions[0]/2)-1;this.setDentascanIndex(e,n)}this.initializeDentascanSegmentations()},this.deletePanoramicAnnotation=()=>{const{measurementService:e,toolGroupService:t}=this.servicesManager.services,n=t.getToolGroupForViewport("panoramic").getToolInstance("ArrowAnnotate"),o=e.getMeasurements().filter(e=>"ArrowAnnotate"===e.toolName);for(const e of o)e.metadata.dentascan&&(this.commandsManager.runCommand("deleteMeasurement",{uid:e.uid}),n.removeArrowAnnotation(e.uid))},this._addDiseaseAnnotation=(e,t,n,o,i,a,r)=>{const c=e.getCamera(),{viewPlaneNormal:d,viewUp:m}=c,p=e.getFrameOfReferenceUID(),{imageData:u}=e.getImageData(),g=u.indexToWorld([o,i,0]),h=u.indexToWorld([o+a,i,0]),I=u.indexToWorld([o,i+r,0]),S=u.indexToWorld([o+a,i+r,0]),v={invalidated:!0,highlighted:!1,metadata:{toolName:"Disease",viewPlaneNormal:[...d],viewUp:[...m],FrameOfReferenceUID:p,referencedImageId:e.getViewReferenceId().split("imageId:")[1],...e.getViewReference({points:[g]})},data:{label:t.EN,subtype:n,handles:{points:[[...g],[...h],[...I],[...S]],activeHandleIndex:null},textbox:{},cachedStats:{}},annotationUID:s.utilities.uuidv4()};return l.annotation.state.addAnnotation(v,e.element),v},this.generateNewPanoramicAnnotation=(e,t)=>{const{toolGroupService:n}=this.servicesManager.services,o=n.getToolGroupForViewport("panoramic").getToolInstance("ArrowAnnotate"),i=this.getPanoramicState(e),[a,r]=[0,i.panoramicDimensions[1]-1],{imageData:s}=t.getImageData(),l=s.indexToWorld([this.dentascanIndex,a,0]),c=s.indexToWorld([this.dentascanIndex,r,0]);o.addNewAnnotationWithMode(t.element,[l,c],"dentascan","rgb(255, 255, 255)")},this.generateDiseaseAnnotations=(e,t)=>{if(l.annotation.state.getAnnotations("Disease",t.element).length>0)return;const n=this.getPanoramicState(e);if(n.diseases)for(const e of n.diseases)if(["10","89","120"].includes(e.subtype)){const{pos:o,subtype:i}=e,{show_on_image:a,translation:r}=n.diseasesCategories[i];if(a){const{x:e,y:n,width:a,height:s}=o;this._addDiseaseAnnotation(t,r,i,e,n,a,s)}}},this.displayDentascans=()=>{const{cornerstoneViewportService:e}=this.servicesManager.services,t=e.getViewportIds(),n=t.length-2;if(n>0){const o=Math.floor(n/2);for(let i=0;i<n;i++){const{element:n}=e.getCornerstoneViewport(t[i+2]);s.utilities.jumpToSlice(n,{imageIndex:this.dentascanIndex+2*(i-o),debounceLoading:!0})}}},this.addSubscriptions=()=>{const e=this.EVENTS.DENTASCAN_INDEX_UPDATED,{unsubscribe:t}=this.subscribe(e,({displaySetInstanceUID:e})=>{this.renderPanoramicAnnotation(e)});this.subscriptions.push(t)},this.addViewportListeners=()=>{const{cornerstoneViewportService:e}=this.servicesManager.services,{element:t}=e.getCornerstoneViewport("default");t.addEventListener(l.Enums.Events.MOUSE_DOWN,this._downCallBack);const n=e.getViewportIds();for(let t=2;t<n.length;t++){const{element:o}=e.getCornerstoneViewport(n[t]);o.addEventListener(l.Enums.Events.MOUSE_DOWN,this._downCallBack)}},this.removeViewportListeners=()=>{const{cornerstoneViewportService:e}=this.servicesManager.services,{element:t}=e.getCornerstoneViewport("default");t.removeEventListener(l.Enums.Events.MOUSE_DOWN,this._downCallBack)},this.renderPanoramicAnnotation=async e=>{const{cornerstoneViewportService:t,hangingProtocolService:n}=this.servicesManager.services;await Wn(()=>0===t.getRenderingEngine()._needsRender.size);const o=n.getActiveProtocol().viewportMatchDetails.size;await Wn(()=>t.getViewportIds().length===o);const i=t.getCornerstoneViewport("panoramic");i&&(this.deletePanoramicAnnotation(),this.generateNewPanoramicAnnotation(e,i),this.generateDiseaseAnnotations(e,i),this.displayDentascans())},this.waitPanoramicDisplay=async()=>{const{cornerstoneViewportService:e,displaySetService:t,viewportGridService:n}=this.servicesManager.services,o=t.getActiveDisplaySets().find(e=>e.SeriesInstanceUID.includes("panoramic"));await Wn(()=>o.displaySetInstanceUID===n.getDisplaySetsUIDsForViewport("panoramic")?.[0]),await Wn(()=>e.getCornerstoneViewport("panoramic").getImageData())},this.commandsManager=e,this.servicesManager=t,this.extensionManager=n}}zn=Hn,Hn.REGISTRATION={name:"panoramicService",create:({commandsManager:e,servicesManager:t,extensionManager:n})=>new zn(e,t,n)};const jn=Hn;var qn=n(83562);const Yn=e=>{if(e)return"function"==typeof e.getImageId?e.getImageId():e.url},Kn=e=>(Array.isArray(e)?e:[e]).some(e=>!e),Zn=e=>e&&e.images&&e.images[0],Xn=e=>Yn(e),Jn=(e,t=p.ll.getAuthorizationHeader())=>fetch(e,t).then(e=>e.arrayBuffer()),Qn=e=>s.imageLoader.loadAndCacheImage(e).then(e=>e&&e.data&&e.data.byteArray.buffer),eo=(e,t,n,o,i=p.ll.getAuthorizationHeader(),a=p.r_.getHTTPErrorHandler())=>{const r={url:e,headers:i,errorInterceptor:a};return new qn.FH.DICOMwebClient(r).retrieveInstance({studyInstanceUID:t,seriesInstanceUID:n,sopInstanceUID:o})};const to=new class{getLocalData(e,t){const n=Zn(e),o=(e=>e&&e.instance)(e);if(!n&&!o||!o.imageId?.startsWith("dicomfile"))return;let i=Xn(n||o);return Kn(i)&&(i=((e,t)=>{const n=e.find(e=>e.displaySets.some(e=>e.displaySetInstanceUID===t)),{series:o=[]}=n,{instances:i=[]}=o[0]||{},a=i[0];return Yn(a)})(t,e.displaySetInstanceUID)),Kn(i)?void 0:h.Ay.wadouri.loadFileRequest(i)}getDataByImageType(e){const t=Zn(e);if(t){const e=Xn(t);let n=Jn;const o=(e=>{const t=/^\w+\:/,n=t.exec(e);return 0===t.lastIndex&&n&&n[0]&&n[0].replace(":","")||""})(e);switch(o){case"dicomfile":n=Qn.bind(this,e);break;case"wadors":const o=t.getData().wadoRoot,i=t.getStudyInstanceUID(),a=t.getSeriesInstanceUID(),r=t.getSOPInstanceUID();if(Kn([o,i,a,r]))return;n=eo.bind(this,o,i,a,r);break;case"wadouri":if(e=e.substring(e.indexOf(":")+1),Kn(e))return;n=Jn.bind(this,e);break;default:return}return n()}}getDataByDatasetType(e){const{StudyInstanceUID:t,SeriesInstanceUID:n,SOPInstanceUID:o,authorizationHeaders:i,wadoRoot:a,wadoUri:r,instance:s}=e;if(!Kn(a))return eo(a,t,n,o,i);if(!Kn(r))return Jn(r,{headers:i});if(!Kn(s?.url)){const e=s.url,t=e.startsWith("http")?e:e.substring(e.indexOf(":")+1);return Jn(t,{headers:i})}}*getLoaderIterator(e,t,n){yield this.getLocalData(e,t),yield this.getDataByImageType(e),yield this.getDataByDatasetType(e)}findDicomDataPromise(e,t,n){e.authorizationHeaders=n;const o=this.getLoaderIterator(e,t);for(const e of o)if(e)return e;throw new Error("Invalid dicom data loader")}},no=JSON.parse('{"UU":"@ohif/extension-cornerstone"}').UU;var oo=n(77954),io=n(76255);const ao=(e,t,n)=>{const o=(0,s.getRenderingEngine)(n.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const i=o.getViewport(t.viewportId),{viewportIndex:a}=e.getOptions(n.viewportId),{viewportIndex:r}=e.getOptions(t.viewportId);if(void 0===a||void 0===r)throw new Error("No viewportIndex provided");const l=o.getViewport(n.viewportId),c=i.getSliceIndex()+(Number(a)-Number(r));c!==l.getSliceIndex()&&s.utilities.jumpToSlice(l.element,{imageIndex:c})},ro=e=>l.SynchronizerManager.createSynchronizer(e,s.EVENTS.CAMERA_MODIFIED,ao);var so=n(5842);const{MetadataModules:lo}=s.Enums,{utils:co}=p.Ay,{denaturalizeDataset:mo}=so.Ay.data.DicomMetaDictionary,{transferDenaturalizedDataset:po,fixMultiValueKeys:uo}=S.dicomWebUtils,go="1.2.840.10008.5.1.4.1.1.77.1.6";function ho(e,t,n){if(!e||!e.length)throw new Error("No instances were provided");const o=e[0];let i=o,a=+i.NumberOfFrames||1;for(const t of e){const e=+t.NumberOfFrames||1;e<a&&(i=t,a=e)}let r=null;const l=n.getActiveDataSource()[0];i&&(1==a&&(r=i.imageId),r||(r=l.getImageIdsForInstance({instance:i,thumbnail:!0})));const{FrameOfReferenceUID:c,SeriesDescription:d,ContentDate:m,ContentTime:p,SeriesNumber:u,StudyInstanceUID:g,SeriesInstanceUID:h,SOPInstanceUID:I,SOPClassUID:S}=o,v=(e=e.map(e=>(e.FrameOfReferenceUID=o.FrameOfReferenceUID,e))).filter(e=>e).map(e=>e.FrameOfReferenceUID).filter((e,t,n)=>n.indexOf(e)===t);v.length>1&&console.warn("Expected FrameOfReferenceUID of difference instances within a series to be the same, found multiple different values",v);const y={plugin:"microscopy",Modality:"SM",viewportType:s.Enums.ViewportType.WHOLE_SLIDE,altImageText:"Microscopy",displaySetInstanceUID:co.guid(),SOPInstanceUID:I,SeriesInstanceUID:h,StudyInstanceUID:g,FrameOfReferenceUID:c,SOPClassHandlerId:"@ohif/extension-cornerstone.sopClassHandlerModule.DicomMicroscopySopClassHandler",SOPClassUID:S,SeriesDescription:d||"Microscopy Data",SeriesDate:m,SeriesTime:p,SeriesNumber:u,firstInstance:i,instance:o,numImageFrames:0,numInstances:1,imageIdForThumbnail:r,others:e,instances:e,othersFrameOfReferenceUID:v,imageIds:e.map(e=>e.imageId)},f=l.retrieve.getWadoDicomWebClient?.(),w=new Map;if(e.forEach(e=>w.set(e.imageId,e)),f){const e=Object.create(f);e.getDICOMwebMetadata=Io.bind(e,w),s.utilities.genericMetadataProvider.addRaw(y.imageIds[0],{type:lo.WADO_WEB_CLIENT,metadata:e})}return[y]}function Io(e,t){return e.get(t)?po(mo(uo(e.get(t)))):(console.warn("Metadata not already found for",t,"in",e),this.super.getDICOMwebMetadata(t))}function So({servicesManager:e,extensionManager:t}){return{name:"DicomMicroscopySopClassHandler",sopClassUids:[go],getDisplaySetsFromSeries:e=>ho(e,0,t)}}var vo=n(62051),yo=n.n(vo);const fo=["SM","DOC","ECG"];function wo(e,t){const{label:n,segments:o}=e,{readableText:i}=t.getCustomization("PanelSegmentation.readableText",{});function a(e,t=0){const n=[],o="  ".repeat(t);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const s=e[r],l=i?.[r];if(!l)continue;"object"!=typeof s||null===s||Array.isArray(s)?n.push(`${o}${l}: ${(0,D.Wf)(s,2)}`):(n.length>0&&n.push(""),n.push(`${o}${l}`),n.push(...a(s,t+1)))}return n}const r=e=>{const t={primary:[],secondary:[]};if(e.cachedStats){const n=a(e.cachedStats);t.primary=n}return t},s={};return Object.entries(o).forEach(([e,t])=>{s[e]={...t,displayText:r(t)}}),{...e,label:n,segments:s}}function Eo({servicesManager:e,subscribeToDataModified:t=!1,debounceTime:n=0}){const{segmentationService:o,viewportGridService:i,customizationService:a,displaySetService:s}=e.services,[l,c]=(0,r.useState)({segmentationsWithRepresentations:[],disabled:!1});return(0,r.useEffect)(()=>{const e=()=>{const e=i.getActiveViewportId(),t=i.getDisplaySetsUIDsForViewport(e);if(!t?.length)return;const n=s.getDisplaySetByUID(t[0]);if(!n)return;if(fo.includes(n.Modality))return void c(e=>({segmentationsWithRepresentations:[],disabled:!0}));const r=o.getSegmentations();if(!r?.length)return void c(e=>({segmentationsWithRepresentations:[],disabled:!1}));const l=o.getSegmentationRepresentations(e).map(e=>({representation:e,segmentation:wo(o.getSegmentation(e.segmentationId),a)}));c({segmentationsWithRepresentations:l,disabled:!1})},r=n>0?yo()(e,n,{leading:!0,trailing:!0}):e;e();const l=[o.subscribe(o.EVENTS.SEGMENTATION_MODIFIED,r),o.subscribe(o.EVENTS.SEGMENTATION_REMOVED,r),o.subscribe(o.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,r),i.subscribe(i.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,r),i.subscribe(i.EVENTS.GRID_STATE_CHANGED,r)];return t&&l.push(o.subscribe(o.EVENTS.SEGMENTATION_DATA_MODIFIED,r)),()=>{l.forEach(e=>e.unsubscribe()),n>0&&r.cancel()}},[o,i,a,s,n,t]),l}function To(e,{measurementFilter:t}){const{measurementService:n,displaySetService:o}=e.services,[i,a]=(0,r.useState)([]);return(0,r.useEffect)(()=>{const e=()=>{let e=n.getMeasurements();t&&(e=e.filter(t));const i=e.map(e=>function(e,t){const{referenceSeriesUID:n}=e,o=t.getDisplaySetsForSeries(n);if(!o[0]?.instances)throw new Error('The tracked measurements panel should only be tracking "stack" displaySets.');const{findingSites:i,finding:a,label:r,displayText:s}=e,l=i?.[0],c=r||a?.text||l?.text||"(empty)",d={primary:[],secondary:s?.secondary||[]};return s&&d.primary.push(...s.primary),i&&i.forEach(e=>{e?.text&&e.text!==c&&d.primary.push(e.text)}),a&&a.text&&a.text!==c&&d.primary.push(a.text),{...e,displayText:d,label:c}}(e,o));a(e=>JSON.stringify(e)!==JSON.stringify(i)?i:e)},i=yo()(e,100);e();const r=[n.EVENTS.MEASUREMENT_ADDED,n.EVENTS.RAW_MEASUREMENT_ADDED,n.EVENTS.MEASUREMENT_UPDATED,n.EVENTS.MEASUREMENT_REMOVED,n.EVENTS.MEASUREMENTS_CLEARED].map(e=>n.subscribe(e,i).unsubscribe);return()=>{r.forEach(e=>e()),i.cancel()}},[n,t,o]),i}var Do=n(66071),bo=n(24571),Oo=n(62672),Co=n.n(Oo),Ao=n(26899),Mo=n.n(Ao),Ro=n(41135);const No=function({segmentationService:e,uiNotificationService:t,hangingProtocolService:n,viewportGridService:o,cornerstoneCacheService:i,displaySetService:a}){return r.createElement("div",{className:"font-inter flex min-h-0 flex-col font-[300]"},r.createElement("div",{className:"bg-primary-dark pb-[6px] pt-[6px]"},r.createElement("p",{className:"flex pb-[6px] pl-[9px] pr-[9px] text-[12px] font-[300] text-[#d8d8d8]"},"Segmentation"),r.createElement("div",{className:"flex justify-evenly text-[12px] font-[300] text-[#d8d8d8]"},r.createElement(gt.$n,{size:gt.Ny.Ej.small,onClick:()=>{if(!o.getDisplaySetsUIDsForViewport("default")[0])return void t.show({title:"Import Segmentation",message:"Default viewport not found",type:"info",duration:3e3});const n=document.createElement("input");n.type="file",n.webkitdirectory=!0,n.onchange=async i=>{const r=Array.from(n.files),s=r.filter(e=>"application/json"===e.type)[0],c=r.filter(e=>"application/octet-stream"===e.type)[0];s&&c?((n=>{const i=o.getDisplaySetsUIDsForViewport("default")[0];if(!i)return void t.show({title:"Import Segmentation",message:"Default viewport not found",type:"info",duration:3e3});const r=new FileReader;r.onload=async function(t){try{if("string"!=typeof t.target.result)return void console.error("ERROR::JSON_READING::CORRUPTED_CONTENT");const o=n.name.split("_").pop().replace(/\.[^/.]+$/,""),r=a.getDisplaySetByUID(i),s={segments:JSON.parse(t.target.result),label:o},c=await e.createLabelmapForDisplaySet(r,s);await e.addSegmentationRepresentation("default",{segmentationId:c,type:l.Enums.SegmentationRepresentations.Labelmap}),e.setActiveSegmentation("default",c)}catch(e){console.error("ERROR::JSON_READING",e)}},r.readAsText(n)})(s),(async n=>{const o=new FileReader;o.onload=async function(o){const i=new Uint8Array(o.target.result),a=n.name.split("_").pop().replace(/\.[^/.]+$/,""),r=e.getSegmentations().filter(e=>e.label===a)[0];if(!r)return void t.show({title:"Import Segmentation",message:`Segmentation with name ${a} does not match segmentation of configuration file`,type:"info",duration:3e3});const{voxelManager:s}=e.getLabelmapVolume(r.segmentationId);s.setCompleteScalarDataArray(i),l.segmentation.triggerSegmentationEvents.triggerSegmentationDataModified(r.segmentationId)},o.readAsArrayBuffer(n)})(c)):t.show({title:"Import Segmentation",message:"Missing configuration or binary file",type:"info",duration:3e3})},n.click()}},"Import"),r.createElement(gt.$n,{size:gt.Ny.Ej.small,onClick:async()=>{let o=e.getActiveSegmentation("default");if(!o)return void t.show({title:"Export Active Segmentation",message:"No active segmentation detected",type:"info",duration:3e3});const{segments:i,label:a,segmentationId:r}=o,{dimensions:s,voxelManager:l}=e.getLabelmapVolume(o.segmentationId),c=l.getCompleteScalarDataArray(),d=s[0]*s[1],m=s[2],u=new(Co());for(let t=0;t<m;t++){const n=new Uint8ClampedArray(4*d).fill(0);for(let o=0;o<d;o++){const i=c[t*d+o];if(0!==i){const t=e.getSegmentColor("default",r,i);n[4*o]=t[0],n[4*o+1]=t[1],n[4*o+2]=t[2]}n[4*o+3]=255}const o=document.createElement("canvas"),i=o.getContext("2d");o.width=s[0],o.height=s[1];const a=new ImageData(n,s[0],s[1],{colorSpace:"srgb"});i.putImageData(a,0,0),i.putImageData(a,0,0);const l=await new Promise((e,t)=>{o.toBlob(n=>n?e(n):t(new Error("Conversion to blob failed")),"image/png")});u.file(`layer_${t}.png`,l)}const g=new Blob([new Uint8ClampedArray(l.getCompleteScalarDataArray())],{type:"application/octet-stream"});u.file(`labelmapVolume_${a}.bin`,g);const h=new Blob([JSON.stringify(i,null,"\t")],{type:"text/plain;charset=utf-8"});u.file(`segmentsInfo_${a}.json`,h);const{activeStudyUID:I}=n.getState(),S=p.H8.getStudy(I),{StudyDate:v,PatientName:y}=S?.series[0]?.instances[0],f=p.Wp.formatPN(y[0]),w=await u.generateAsync({type:"blob"});(0,bo.saveAs)(w,`${v??""}_${f??""}_${a}.zip`)}},"Export")),r.createElement("p",{className:"flex pb-[6px] pl-[9px] pr-[9px] text-[12px] font-[300] text-[#d8d8d8]"},"Generated segmentation"),r.createElement("div",{className:"flex justify-evenly text-[12px] font-[300] text-[#d8d8d8]"},r.createElement(gt.$n,{size:gt.Ny.Ej.small,onClick:async()=>{const{cbctSegmentationUUID:n,accessKey:o}=i.getCbctSegmentationMetadata();if(!n||!o)return void t.show({title:"Export Generated Segmentation",message:"No credentials found",type:"info",duration:3e3});const a=e.getGeneratedSegmentation();if(!a)return void t.show({title:"Export Generated Segmentation",message:"No generated segmentation detected",type:"info",duration:3e3});const{voxelManager:r}=e.getLabelmapVolume(a.segmentationId),s=JSON.stringify(a.segments);try{const e=new FormData,t=Ro.Ay.deflate(r.getCompleteScalarDataArray());e.append("modified_volume",new Blob([t]),`${n}.zlib`),e.append("modified_config",s);const i=`https://localhost/api/v1/cbct/${n}/`,a={method:"put",url:i,headers:o?{Authorization:"Bearer "+o}:void 0,data:e},l=await Mo()(a);return console.log("Server response for segmented volume export",l.data),l}catch(e){console.error("Server error for segmented volume export",e)}}},"Export generated segmentation"))))};function Vo({servicesManager:e,commandsManager:t,children:n}){const{customizationService:o,viewportGridService:i,displaySetService:a,panoramicService:l,segmentationService:c,cornerstoneCacheService:d,uiNotificationService:m,toolGroupService:p,hangingProtocolService:u}=e.services,{segmentationsWithRepresentations:g,disabled:h}=Eo({servicesManager:e}),I={onSegmentationAdd:async()=>{if(l.isDisplayed()){const e=`Segmentation ${c.getAxialSegmentations().length+1}`,n=await t.run("createLabelmapForViewport",{viewportId:"default",options:{label:e}});t.run("createLabelmapForViewport",{viewportId:"dentascan",options:{label:e,segmentationId:"dentascan_"+n}})}else{const e=i.getState().activeViewportId;t.run("createLabelmapForViewport",{viewportId:e})}},onSegmentationClick:e=>{if(l.isDisplayed()){const n=e.startsWith("dentascan")?"dentascan":"default";t.run("setActiveSegmentation",{segmentationId:e,viewportId:n});const o=c.getHiddenSegmentation(e),i=e.startsWith("dentascan")?"default":"dentascan";t.run("setActiveSegmentation",{segmentationId:o.segmentationId,viewportId:i})}else t.run("setActiveSegmentation",{segmentationId:e})},onSegmentAdd:e=>{if(t.run("addSegment",{segmentationId:e}),l.isDisplayed()){const n=c.getHiddenSegmentation(e);t.run("addSegment",{segmentationId:n.segmentationId})}},onSegmentClick:(e,n)=>{if(t.run("setActiveSegmentAndCenter",{segmentationId:e,segmentIndex:n}),l.isDisplayed()){const o=c.getHiddenSegmentation(e);t.run("setActiveSegmentAndCenter",{segmentationId:o.segmentationId,segmentIndex:n})}},onSegmentEdit:(e,n)=>{if(t.run("editSegmentLabel",{segmentationId:e,segmentIndex:n}),l.isDisplayed()){const o=c.getHiddenSegmentation(e);t.run("editSegmentLabel",{segmentationId:o.segmentationId,segmentIndex:n})}},onSegmentationEdit:e=>{if(t.run("editSegmentationLabel",{segmentationId:e}),l.isDisplayed()){const n=c.getHiddenSegmentation(e);t.run("editSegmentationLabel",{segmentationId:n.segmentationId})}},onSegmentColorClick:(e,n)=>{if(l.isDisplayed()){const o=e.startsWith("dentascan")?"dentascan":"default";t.run("editSegmentColor",{segmentationId:e,segmentIndex:n,viewportId:o});const i=c.getHiddenSegmentation(e),a=e.startsWith("dentascan")?"default":"dentascan";t.run("editSegmentColor",{segmentationId:i.segmentationId,segmentIndex:n,viewportId:a})}else t.run("editSegmentColor",{segmentationId:e,segmentIndex:n})},onSegmentDelete:(e,n)=>{if(t.run("deleteSegment",{segmentationId:e,segmentIndex:n}),l.isDisplayed()){const o=c.getHiddenSegmentation(e);t.run("deleteSegment",{segmentationId:o.segmentationId,segmentIndex:n})}},onToggleSegmentVisibility:(e,n,o)=>{if(l.isDisplayed()){const i=e.startsWith("dentascan")?"dentascan":"default";t.run("toggleSegmentVisibility",{segmentationId:e,segmentIndex:n,type:o,viewportId:i});const a=c.getHiddenSegmentation(e),r=e.startsWith("dentascan")?"default":"dentascan";t.run("toggleSegmentVisibility",{segmentationId:a.segmentationId,segmentIndex:n,type:o,viewportId:r})}else t.run("toggleSegmentVisibility",{segmentationId:e,segmentIndex:n,type:o})},onToggleSegmentLock:(e,n)=>{if(t.run("toggleSegmentLock",{segmentationId:e,segmentIndex:n}),l.isDisplayed()){const o=c.getHiddenSegmentation(e);t.run("toggleSegmentLock",{segmentationId:o.segmentationId,segmentIndex:n})}},onToggleSegmentationRepresentationVisibility:(e,n)=>{if(l.isDisplayed()){const o=e.startsWith("dentascan")?"dentascan":"default";t.run("toggleSegmentationVisibility",{segmentationId:e,type:n,viewportId:o});const i=c.getHiddenSegmentation(e),a=e.startsWith("dentascan")?"default":"dentascan";t.run("toggleSegmentationVisibility",{segmentationId:i.segmentationId,type:n,viewportId:a})}else t.run("toggleSegmentationVisibility",{segmentationId:e,type:n})},onSegmentationDownload:e=>{if(t.run("downloadSegmentation",{segmentationId:e}),l.isDisplayed()){const n=c.getHiddenSegmentation(e);t.run("downloadSegmentation",{segmentationId:n.segmentationId})}},storeSegmentation:async e=>{if(l.isDisplayed()){const n=e.startsWith("dentascan")?"dentascan":"default";t.run("storeSegmentation",{segmentationId:e,viewportId:n});const o=c.getHiddenSegmentation(e),i=e.startsWith("dentascan")?"default":"dentascan";t.run("storeSegmentation",{segmentationId:o.segmentationId,viewportId:i})}else t.run("storeSegmentation",{segmentationId:e})},onSegmentationDownloadRTSS:e=>{if(t.run("downloadRTSS",{segmentationId:e}),l.isDisplayed()){const n=c.getHiddenSegmentation(e);t.run("downloadRTSS",{segmentationId:n.segmentationId})}},setStyle:(e,n,o,i)=>{if(t.run("setSegmentationStyle",{segmentationId:e,type:n,key:o,value:i}),l.isDisplayed()){const a=c.getHiddenSegmentation(e);t.run("setSegmentationStyle",{segmentationId:a.segmentationId,type:n,key:o,value:i})}},toggleRenderInactiveSegmentations:()=>{l.isDisplayed()?(t.run("toggleRenderInactiveSegmentations",{viewportId:"default"}),t.run("toggleRenderInactiveSegmentations",{viewportId:"dentascan"})):t.run("toggleRenderInactiveSegmentations")},onSegmentationRemoveFromViewport:e=>{if(l.isDisplayed()){const n=e.startsWith("dentascan")?"dentascan":"default";t.run("removeSegmentationFromViewport",{segmentationId:e,viewportId:n});const o=c.getHiddenSegmentation(e),i=e.startsWith("dentascan")?"default":"dentascan";t.run("removeSegmentationFromViewport",{segmentationId:o.segmentationId,viewportId:i})}else t.run("removeSegmentationFromViewport",{segmentationId:e})},onSegmentationDelete:e=>{if(t.run("deleteSegmentation",{segmentationId:e}),l.isDisplayed()){const n=c.getHiddenSegmentation(e);t.run("deleteSegmentation",{segmentationId:n.segmentationId})}},setFillAlpha:({type:e},n)=>{t.run("setFillAlpha",{type:e,value:n})},setOutlineWidth:({type:e},n)=>{t.run("setOutlineWidth",{type:e,value:n})},setRenderFill:({type:e},n)=>{t.run("setRenderFill",{type:e,value:n})},setRenderOutline:({type:e},n)=>{t.run("setRenderOutline",{type:e,value:n})},setFillAlphaInactive:({type:e},n)=>{t.run("setFillAlphaInactive",{type:e,value:n})},getRenderInactiveSegmentations:()=>t.run("getRenderInactiveSegmentations")},{mode:S}=o.getCustomization("PanelSegmentation.tableMode",{id:"default.segmentationTable.mode",mode:"collapsed"}),{onSegmentationAdd:v}=o.getCustomization("PanelSegmentation.onSegmentationAdd",{id:"segmentation.onSegmentationAdd",onSegmentationAdd:I.onSegmentationAdd}),{disableEditing:y}=o.getCustomization("PanelSegmentation.disableEditing",{id:"default.disableEditing",disableEditing:!1}),{showAddSegment:f}=o.getCustomization("PanelSegmentation.showAddSegment",{id:"default.showAddSegment",showAddSegment:!0}),w=g.map(({segmentation:e})=>{const{representationData:t,segmentationId:n}=e,{Labelmap:o}=t;if(!o)return{segmentationId:n,isExportable:!0};const i=o.referencedImageIds[0],r=s.metaData.get("instance",i);if(!r)return{segmentationId:n,isExportable:!1};const{SOPInstanceUID:l,SeriesInstanceUID:c}=r,d=a.getDisplaySetForSOPInstanceUID(l,c);return{segmentationId:n,isExportable:d?.isReconstructable}});return r.createElement("div",{className:"min-h-0F mt-1 flex flex-auto flex-col"},r.createElement(Do.R4,{disabled:h,data:g,mode:S,title:"Segmentations",exportOptions:w,disableEditing:y,onSegmentationAdd:v,onSegmentationClick:I.onSegmentationClick,onSegmentationDelete:I.onSegmentationDelete,showAddSegment:f,onSegmentAdd:I.onSegmentAdd,onSegmentClick:I.onSegmentClick,onSegmentEdit:I.onSegmentEdit,onSegmentationEdit:I.onSegmentationEdit,onSegmentColorClick:I.onSegmentColorClick,onSegmentDelete:I.onSegmentDelete,onToggleSegmentVisibility:I.onToggleSegmentVisibility,onToggleSegmentLock:I.onToggleSegmentLock,onToggleSegmentationRepresentationVisibility:I.onToggleSegmentationRepresentationVisibility,onSegmentationDownload:I.onSegmentationDownload,storeSegmentation:I.storeSegmentation,onSegmentationDownloadRTSS:I.onSegmentationDownloadRTSS,setStyle:I.setStyle,toggleRenderInactiveSegmentations:I.toggleRenderInactiveSegmentations,onSegmentationRemoveFromViewport:I.onSegmentationRemoveFromViewport,setFillAlpha:I.setFillAlpha,setOutlineWidth:I.setOutlineWidth,setRenderFill:I.setRenderFill,setRenderOutline:I.setRenderOutline,setFillAlphaInactive:I.setFillAlphaInactive,renderInactiveSegmentations:I.getRenderInactiveSegmentations()},n,r.createElement(Do.R4.Config,null),r.createElement(Do.R4.AddSegmentationRow,null),"collapsed"===S?r.createElement(Do.R4.Collapsed,null,r.createElement(Do.R4.SelectorHeader,null),r.createElement(Do.R4.AddSegmentRow,null),r.createElement(Do.R4.Segments,null)):r.createElement(Do.R4.Expanded,null,r.createElement(Do.R4.Header,null),r.createElement(Do.R4.Segments,null))),r.createElement("div",{className:"h-[6px] bg-black"}),r.createElement(No,{segmentationService:c,uiNotificationService:m,hangingProtocolService:u,viewportGridService:i,cornerstoneCacheService:d,displaySetService:a}))}var Po=n(97598),Uo=n.n(Po),xo=n(50761);const _o=(0,s.getWebWorkerManager)(),Lo={maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:1e3}},Fo=()=>new Worker(new URL(n.p+n.u(3054),n.b),{name:"histogram-worker"}),Go=(e,t)=>{const n=[];return e.getProperty().getScalarOpacity(0).getNodeValue(t,n),n[1]},ko=async(e,t,n)=>{if(!e)return[];const o=e.getAllVolumeIds(),i=e.getProperties(),{voiRange:a}=i,r=a?{windowWidth:a.upper-a.lower,windowCenter:a.lower+(a.upper-a.lower)/2}:void 0,l=await Promise.all(o.map(async(o,i)=>{const a=s.cache.getVolume(o),l=n(e,o),{metadata:c,scaling:d}=a,m=c.Modality,p={min:"PT"===m?.1:-999,max:"PT"===m?5:1e4},u=await(async(e,t,n)=>{if(_o.registerWorker("histogram-worker",Fo,Lo),!e.getImageData(t.volumeId))return;let o=t.scalarData;if(t.numTimePoints>1){const e=t.numTimePoints-1;o=t.voxelManager.getTimePointScalarData(e)}else o=t.voxelManager.getCompleteScalarDataArray();if(!o?.length)return;const{dimensions:i,origin:a,direction:r,spacing:s}=t,l=await _o.executeTask("histogram-worker","getRange",{dimensions:i,origin:a,direction:r,spacing:s,scalarData:o}),{minimum:c,maximum:d}=l;if(c===1/0||d===-1/0)return;const m={numBins:256,min:Math.max(c,n?.min??c),max:Math.min(d,n?.max??d)};return await _o.executeTask("histogram-worker","calcHistogram",{data:o,options:m})})(e,a,p);if(!u||u.range.min===u.range.max)return null;if(!t.displaySetOptions||!t.displaySetOptions[i])return null;const{voi:g,colormap:h}=t.displaySetOptions[i];let I;h&&(I=s.utilities.colormap.getColormap(h.name)??xo.A.getPresetByName(h.name));const S=i?g:r??g;return{viewportId:t.viewportId,modality:m,volumeId:o,volumeIndex:i,voi:S,histogram:u,colormap:I,step:d?.PT?.05:1,opacity:l,showOpacitySlider:1===i&&void 0!==l}}));return l.filter(Boolean)},{Events:Bo}=s.Enums,zo=({servicesManager:e,viewportId:t})=>{const{cornerstoneViewportService:n}=e.services,[o,i]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),c=(0,p.BZ)({servicesManager:e}),d=(0,r.useCallback)(e=>n.getRenderingEngine().getVolumeViewports().filter(t=>{const n=t.getActors().map(e=>e.referencedId);return e.length===n.length&&e.every(e=>n.includes(e))}),[n]),m=(0,r.useCallback)((e,t)=>{const n=e.getActors().find(e=>e.referencedId===t)?.actor;return((e,t)=>{const n=s.cache.getVolume(e);if(!n||"PT"!==n.metadata.Modality)return!1;const o=t.getProperty().getScalarOpacity(0);if(o.getSize()<2)return!1;const i=[],a=[];if(o.getNodeValue(0,i),o.getNodeValue(1,a),0!==i[0]||0!==i[1]||.1!==a[0])return!1;const r=a[1],l=o.getSize(),c=[];for(let e=2;e<l;e++)if(o.getNodeValue(e,c),c[1]!==r)return!1;return!0})(t,n)?Go(n,1):(e=>{const t=e.getProperty().getScalarOpacity(0),n=t.getSize(),o=[];t.getNodeValue(0,o);const i=o[1];for(let e=0;e<n;e++){const e=[];if(t.getNodeValue(0,e),e[1]!==i)return!1}return!0})(n)?Go(n,0):void 0},[]),u=(0,r.useCallback)(()=>{const e=n.getCornerstoneViewport(t),o=n.getViewportInfo(t);ko(e,o,m).then(e=>{i(e)})},[t,n,m]),g=(0,r.useCallback)(e=>{const{detail:t}=e,{volumeId:n,range:a}=t,r=o.find(e=>e.volumeId===n);if(!r)return;const s=r.voi,l=a.upper-a.lower,c=a.lower+l/2;if(l===s.windowWidth&&c===s.windowCenter)return;const d={...r,voi:{windowWidth:l,windowCenter:c}};i(o.map(e=>e===r?d:e))},[o]),h=(0,r.useMemo)(()=>yo()(g,100),[g]),I=(0,r.useCallback)((e,o)=>{const i=n.getCornerstoneViewport(t),a={lower:o.windowCenter-o.windowWidth/2,upper:o.windowCenter+o.windowWidth/2};i.setProperties({voiRange:a},e),i.render()},[n,t]),S=(0,r.useCallback)((e,t,o,i)=>{const a=n.getCornerstoneViewport(e);if(!a)return;const r=a.getActors().map(e=>e.referencedId);d(r).forEach(e=>{e.setProperties({colormap:{opacity:i}},o),e.render()})},[d,n]),v=(0,r.useCallback)(()=>{l(!1),u()},[u]);(0,r.useEffect)(()=>{document.addEventListener(Bo.VOI_MODIFIED,h,!0),s.eventTarget.addEventListener(Bo.IMAGE_VOLUME_LOADING_COMPLETED,v);const e=setInterval(()=>{a&&u()},1e3);return()=>{document.removeEventListener(Bo.VOI_MODIFIED,h,!0),s.eventTarget.removeEventListener(Bo.IMAGE_VOLUME_LOADING_COMPLETED,v),clearInterval(e)}},[u,h,v,a]);const y=(0,r.useMemo)(()=>c?.map(e=>e.displaySetInstanceUID).sort()||[],[c]);return(0,r.useEffect)(()=>{const{unsubscribe:e}=n.subscribe(n.EVENTS.VIEWPORT_VOLUMES_CHANGED,({viewportInfo:e})=>{e.viewportId===t&&u()});return y.length&&!a&&u(),()=>{e()}},[t,n,u,y,a]),r.createElement(gt.aU,{title:"Window Level"},o.map((e,t)=>e.histogram?r.createElement(gt.bL,{key:e.volumeId,title:`${e.modality}`,histogram:e.histogram,voi:e.voi,step:e.step,showOpacitySlider:e.showOpacitySlider,colormap:e.colormap,onVOIChange:t=>I(e.volumeId,t),opacity:e.opacity,onOpacityChange:n=>S(e.viewportId,t,e.volumeId,n)}):null))};zo.propTypes={servicesManager:Uo().object.isRequired,viewportId:Uo().string.isRequired};const $o=zo,Wo=({servicesManager:e})=>{const[t]=(0,gt.ih)(),{activeViewportId:n}=t;return r.createElement(r.Fragment,null,n&&r.createElement($o,{servicesManager:e,viewportId:n}))};Wo.propTypes={servicesManager:Uo().object.isRequired};const Ho=Wo;function jo({servicesManager:e,customHeader:t,measurementFilter:n}){const o=(0,r.useRef)(null),[i]=(0,gt.ih)(),{measurementService:a,customizationService:s,uiDialogService:l}=e.services,c=To(e,{measurementFilter:n});(0,r.useEffect)(()=>{c.length>0&&yo()(()=>{o.current.scrollTop=o.current.scrollHeight},300)()},[c.length]);const d=e=>{a.jumpToMeasurement(i.activeViewportId,e),((e,t)=>{if(t)return;const n=[...c],o=n.find(t=>t.uid===e);n.forEach(t=>t.isActive=t.uid===e),o.isActive=!0})(e,!0)},m=e=>{a.remove(e)},p=e=>{d(e);const t=s.get("measurementLabels"),n=a.getMeasurement(e);(0,S.showLabelAnnotationPopup)(n,l,t).then(t=>{a.update(e,{...t},!0)})},u=e=>{a.toggleLockMeasurement(e)},g=e=>{a.toggleVisibilityMeasurement(e)},h=c.filter(e=>e.measurementType!==a.VALUE_TYPES.POINT&&e.referencedImageId),I=c.filter(e=>e.measurementType===a.VALUE_TYPES.POINT&&e.referencedImageId);return r.createElement(r.Fragment,null,r.createElement("div",{className:"invisible-scrollbar overflow-y-auto overflow-x-hidden",ref:o,"data-cy":"trackedMeasurements-panel"},r.createElement(Do.V,{title:"Measurements",data:h,onClick:d,onDelete:m,onToggleVisibility:g,onToggleLocked:u,onRename:p},r.createElement(Do.V.Header,null,t&&r.createElement(r.Fragment,null,"function"==typeof t?t({additionalFindings:I,measurements:h}):t)),r.createElement(Do.V.Body,null)),I.length>0&&r.createElement(Do.V,{data:I,title:"Additional Findings",onClick:d,onDelete:m,onToggleVisibility:g,onToggleLocked:u,onRename:p},r.createElement(Do.V.Body,null))))}const qo=({commandsManager:e,servicesManager:t,extensionManager:n})=>[{name:"activeViewportWindowLevel",component:()=>r.createElement(Ho,{servicesManager:t})},{name:"panelMeasurement",iconName:"tab-linear",iconLabel:"Measure",label:"Measurement",component:({configuration:o})=>r.createElement(jo,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o}})},{name:"panelSegmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:({configuration:o})=>r.createElement(Vo,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o}})},{name:"panelSegmentationNoHeader",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:({configuration:o})=>r.createElement(Vo,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o}})},{name:"panelSegmentationWithTools",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:({configuration:o})=>{const[i]=(0,gt.ih)();return"panoramic"!==i.activeViewportId&&r.createElement(r.Fragment,null,r.createElement(Do.OO,{commandsManager:e,servicesManager:t,extensionManager:n,buttonSectionId:"segmentationToolbox",title:"Segmentation Tools",configuration:{...o}}),r.createElement(Vo,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o}}))}}];var Yo=n(85252),Ko=n(55530),Zo=n.n(Ko);const Xo={PROGRESS:"event:DicomFileUploader:progress"};let Jo=function(e){return e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Success=2]="Success",e[e.Failed=3]="Failed",e[e.Cancelled=4]="Cancelled",e}({});class Qo{constructor(e,t){this.message=void 0,this.status=void 0,this.message=t,this.status=e}}class ei extends p.Rc{constructor(e,t){super(Xo),this._file=void 0,this._fileId=void 0,this._dataSource=void 0,this._loadPromise=void 0,this._abortController=new AbortController,this._status=Jo.NotStarted,this._percentComplete=0,this._file=e,this._fileId=h.Ay.wadouri.fileManager.add(e),this._dataSource=t}getFileId(){return this._fileId}getFileName(){return this._file.name}getFileSize(){return this._file.size}cancel(){this._abortController.abort()}getStatus(){return this._status}getPercentComplete(){return this._percentComplete}async load(){return this._loadPromise||(this._loadPromise=new Promise((e,t)=>{const n={progress:e=>{e.lengthComputable&&(this._status=Jo.InProgress,this._percentComplete=Math.round(100*e.loaded/e.total),this._broadcastEvent(Xo.PROGRESS,{fileId:this._fileId,percentComplete:this._percentComplete}))},timeout:()=>{this._reject(t,new Qo(Jo.Failed,"The request timed out."))},abort:()=>{this._reject(t,new Qo(Jo.Cancelled,"Cancelled"))},error:()=>{this._reject(t,new Qo(Jo.Failed,"The request failed."))}};h.Ay.wadouri.loadFileRequest(this._fileId).then(o=>{if(this._abortController.signal.aborted)return void this._reject(t,new Qo(Jo.Cancelled,"Cancelled"));if(!this._checkDicomFile(o))return void this._reject(t,new Qo(Jo.Failed,"Not a valid DICOM file."));const i=new XMLHttpRequest;return this._addRequestCallbacks(i,n),this._dataSource.store.dicom(o,i).then(()=>{this._status=Jo.Success,e()}).catch(e=>{this._reject(t,e)})}).catch(e=>{this._reject(t,e)})})),this._loadPromise}_isRejected(){return this._status===Jo.Failed||this._status===Jo.Cancelled}_reject(e,t){if(!this._isRejected()){if(t instanceof Qo)return this._status=t.status,void e(t);this._status=Jo.Failed,t.message?e(new Qo(Jo.Failed,t.message)):e(new Qo(Jo.Failed,t))}}_addRequestCallbacks(e,t){const n=()=>e.abort();this._abortController.signal.addEventListener("abort",n);for(const[n,o]of Object.entries(t))e.upload.addEventListener(n,o);const o=()=>{this._abortController.signal.removeEventListener("abort",n);for(const[n,o]of Object.entries(t))e.upload.removeEventListener(n,o);e.removeEventListener("loadend",o)};e.addEventListener("loadend",o)}_checkDicomFile(e){if(e.length<=132)return!1;const t=new Uint8Array(e.slice(128,132));return Array.from("DICM").every((e,n)=>e.charCodeAt(0)===t[n])}}const ti=(0,r.memo)(({dicomFileUploader:e})=>{const[t,n]=(0,r.useState)(e.getPercentComplete()),[o,i]=(0,r.useState)(""),[a,s]=(0,r.useState)(e.getStatus()),l=(0,r.useCallback)(()=>a===Jo.Failed||a===Jo.Cancelled||a===Jo.Success,[a]);(0,r.useEffect)(()=>{const t=e.subscribe(Xo.PROGRESS,e=>{n(e.percentComplete)});return e.load().catch(e=>{s(e.status),i(e.message??"")}).finally(()=>s(e.getStatus())),()=>t.unsubscribe()},[]);const c=(0,r.useCallback)(()=>{e.cancel()},[]);return r.createElement("div",{className:"min-h-14 border-secondary-light flex w-full items-center overflow-hidden border-b p-2.5 text-lg"},r.createElement("div",{className:"self-top flex w-0 shrink grow flex-col gap-1"},r.createElement("div",{className:"flex gap-4"},r.createElement("div",{className:"flex w-6 shrink-0 items-center justify-center"},(()=>{switch(e.getStatus()){case Jo.Success:return r.createElement(gt.In,{name:"status-tracked",className:"text-primary-light"});case Jo.InProgress:return r.createElement(gt.In,{name:"icon-transferring"});case Jo.Failed:return r.createElement(gt.In,{name:"icon-alert-small"});case Jo.Cancelled:return r.createElement(gt.In,{name:"icon-alert-outline"});default:return r.createElement(r.Fragment,null)}})()),r.createElement("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap"},e.getFileName())),o&&r.createElement("div",{className:"pl-10"},o)),r.createElement("div",{className:"flex w-24 items-center"},!l()&&r.createElement(r.Fragment,null,e.getStatus()===Jo.InProgress&&r.createElement("div",{className:"w-10 text-right"},t,"%"),r.createElement("div",{className:"ml-auto flex cursor-pointer"},r.createElement(gt.In,{className:"text-primary-active self-center",name:"close",onClick:c})))))});ti.propTypes={dicomFileUploader:Uo().instanceOf(ei).isRequired};const ni=ti,oi=1e3,ii=6e4,ai=36e5,ri=15e3,si="text-ellipsis whitespace-nowrap overflow-hidden";function li({dicomFileUploaderArr:e,onComplete:t}){const[n]=(0,r.useState)(e.reduce((e,t)=>e+t.getFileSize(),0)),o=(0,r.useRef)(0),i=(0,r.useRef)(0),[a,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(0),[d,m]=(0,r.useState)(0),[p,u]=(0,r.useState)(0),[g,h]=(0,r.useState)(!1),I=(0,r.useRef)();(0,r.useEffect)(()=>{let e,t=0,a=Date.now();const r=()=>{const s=o.current-t,l=Date.now(),c=l-a;i.current=s/c,t=o.current,a=l,n-o.current>0&&(e=i.current>=75?setTimeout(r,ri):setTimeout(r,3e4))};return e=setTimeout(r,ri),()=>{clearTimeout(e)}},[]),(0,r.useEffect)(()=>{let t=null;const a=e.map(e=>{let a=0;const r=r=>{const l=a;if(a=Math.round(r/100*e.getFileSize()),o.current=Math.min(n,o.current-l+a),c(o.current/n*100),0!==i.current){const e=n-o.current,a=Math.round(e/i.current);if(null===t)return t=a,void s(t);if(a<ii){const e=Math.ceil(t/oi),n=Math.ceil(a/oi)-e;return void((n<0||n>2)&&(t=a,s(t)))}if(a<ai){const e=Math.ceil(t/ii),n=Math.ceil(a/ii)-e;return void((n<0||n>2)&&(t=a,s(t)))}t=a,s(t)}};return e.load().catch(e=>{e.status===Jo.Failed&&u(e=>e+1)}).finally(()=>{r(100),m(e=>e+1)}),e.subscribe(Xo.PROGRESS,e=>{r(e.percentComplete)})});return()=>{a.forEach(e=>e.unsubscribe())}},[]);const S=(0,r.useCallback)(async()=>{for(const t of e){new Promise((e,n)=>{setTimeout(()=>{t.cancel(),e()},0)})}},[]),v=(0,r.useCallback)(()=>{if(null==a)return"";if(a<ii){const e=Math.ceil(a/oi);return`${e} ${1===e?"second":"seconds"}`}if(a<ai){const e=Math.ceil(a/ii);return`${e} ${1===e?"minute":"minutes"}`}const e=Math.ceil(a/ai);return`${e} ${1===e?"hour":"hours"}`},[a]),y=(0,r.useCallback)(()=>Math.min(100,Math.round(l)),[l]),f=(0,r.useCallback)(()=>y()<1&&(I?.current?.offsetWidth??0)*(l/100)<1,[y,l]),w=(0,r.useCallback)(()=>({width:`${2*e.length.toString().length+4}ch`}),[]),E=()=>r.createElement("div",{className:"ml-auto flex w-6 justify-center"},p>0&&r.createElement("div",{onClick:()=>h(e=>!e)},r.createElement(gt.In,{className:"cursor-pointer",name:"icon-status-alert"})));return r.createElement("div",{className:"flex grow flex-col"},r.createElement("div",{className:"bg-primary-dark flex h-14 items-center px-1 pb-4 text-lg"},d===e.length?r.createElement(r.Fragment,null,r.createElement("span",{className:si},`${e.length} ${e.length>1?"files":"file"} completed.`),r.createElement(gt.$n,{disabled:!1,className:"ml-auto",onClick:t},"Close")):r.createElement(r.Fragment,null,r.createElement("span",{style:w(),className:Zo()(si,"text-end")},`${d} of ${e.length}`," "),r.createElement("span",{className:si}," files completed."," "),r.createElement("span",{className:si},a?`Less than ${v()} remaining. `:""),r.createElement("span",{className:Zo()(si,"text-primary-active hover:text-primary-light active:text-aqua-pale ml-auto cursor-pointer"),onClick:S},"Cancel All Uploads"))),r.createElement("div",{className:"flex grow flex-col overflow-hidden bg-black text-lg"},r.createElement("div",{className:"ohif-scrollbar border-secondary-light overflow-y-scroll border-b px-2"},r.createElement("div",{className:"min-h-14 flex w-full items-center p-2.5"},d===e.length?r.createElement(r.Fragment,null,r.createElement("div",{className:"text-primary-light text-xl"},p>0?`Completed with ${p} ${p>1?"errors":"error"}!`:"Completed!"),E()):r.createElement(r.Fragment,null,r.createElement("div",{ref:I,className:"flex-grow"},r.createElement(gt.dD,{progress:f()?void 0:Math.min(100,l)})),r.createElement("div",{className:"ml-1 flex w-24 items-center"},r.createElement("div",{className:"w-10 text-right"},`${y()}%`),E())))),r.createElement("div",{className:"ohif-scrollbar h-1 grow overflow-y-scroll px-2"},e.filter(e=>!g||e.getStatus()===Jo.Failed).map(e=>r.createElement(ni,{key:e.getFileId(),dicomFileUploader:e})))))}li.propTypes={dicomFileUploaderArr:Uo().arrayOf(Uo().instanceOf(ei)).isRequired,onComplete:Uo().func.isRequired};const ci=li;function di(){return di=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},di.apply(null,arguments)}function mi({dataSource:e,onComplete:t,onStarted:n}){const o="min-h-[480px] flex flex-col bg-black select-none",[i,a]=(0,r.useState)([]),s=(0,r.useCallback)(async t=>{n(),a(t.map(t=>new ei(t,e)))},[]);return r.createElement(r.Fragment,null,i.length?r.createElement("div",{className:Zo()("h-[calc(100vh-300px)]",o)},r.createElement(ci,{dicomFileUploaderArr:Array.from(i),onComplete:t})):r.createElement("div",{className:Zo()("h-[480px]",o)},r.createElement(Yo.A,{onDrop:e=>{s(e)},noClick:!0},({getRootProps:e})=>r.createElement("div",di({},e(),{className:"dicom-upload-drop-area-border-dash m-5 flex h-full flex-col items-center justify-center"}),r.createElement("div",{className:"flex gap-3"},r.createElement(Yo.A,{onDrop:s,noDrag:!0},({getRootProps:e,getInputProps:t})=>r.createElement("div",e(),r.createElement(gt.$n,{disabled:!1,onClick:()=>{}},"Add files",r.createElement("input",t())))),r.createElement(Yo.A,{onDrop:s,noDrag:!0},({getRootProps:e,getInputProps:t})=>r.createElement("div",e(),r.createElement(gt.$n,{type:gt.Ny.NW.secondary,disabled:!1,onClick:()=>{}},"Add folder",r.createElement("input",di({},t(),{webkitdirectory:"true",mozdirectory:"true"})))))),r.createElement("div",{className:"pt-5"},"or drag images or folders here"),r.createElement("div",{className:"text-aqua-pale pt-3 text-lg"},"(DICOM files supported)")))))}mi.propTypes={dataSource:Uo().object.isRequired,onComplete:Uo().func.isRequired,onStarted:Uo().func.isRequired};const pi=mi;var ui=n(73421);function gi(){return gi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},gi.apply(null,arguments)}const{imageRetrieveMetadataProvider:hi}=s.utilities,Ii=r.lazy(()=>n.e(9611).then(n.bind(n,69611))),Si=e=>r.createElement(r.Suspense,{fallback:r.createElement("div",null,"Loading...")},r.createElement(Ii,e)),vi={retrieveOptions:{single:{streaming:!0,decodeLevel:1}}},yi={id:no,onModeEnter:({servicesManager:e})=>{const{cornerstoneViewportService:t,toolbarService:n,segmentationService:o}=e.services;n.registerEventForToolbarUpdate(t,[t.EVENTS.VIEWPORT_DATA_CHANGED]),n.registerEventForToolbarUpdate(o,[o.EVENTS.SEGMENTATION_REMOVED,o.EVENTS.SEGMENTATION_MODIFIED]),n.registerEventForToolbarUpdate(s.eventTarget,[l.Enums.Events.TOOL_ACTIVATED]),hi.clear(),hi.add("volume",s.ProgressiveRetrieveImages.interleavedRetrieveStages),hi.add("stack",vi)},getPanelModule:qo,onModeExit:({servicesManager:e})=>{const{cineService:t,segmentationService:n}=e.services;Object.values(s.Enums.RequestType).forEach(e=>{s.imageLoadPoolManager.clearRequestStack(e),s.imageRetrievalPoolManager.clearRequestStack(e)}),t.setIsCineEnabled(!1),(0,v.cL)(),Qe.I.getState().clearLutPresentationStore(),et.q.getState().clearPositionPresentationStore(),Et.U.getState().clearSynchronizersStore(),S.useToggleOneUpViewportGridStore.getState().clearToggleOneUpViewportGridStore(),tt.v.getState().clearSegmentationPresentationStore(),n.removeAllSegmentations()},preRegistration:function(e){const{servicesManager:t,serviceProvidersManager:n}=e;t.registerService(_n.REGISTRATION),t.registerService(jt.REGISTRATION),t.registerService(sn.REGISTRATION),t.registerService(wn.REGISTRATION),t.registerService(On.REGISTRATION),t.registerService(oo.A.REGISTRATION),t.registerService(Bn.REGISTRATION),t.registerService(jn.REGISTRATION),n.registerProvider(oo.A.REGISTRATION.name,io.It);const{syncGroupService:o}=t.services;return o.registerCustomSynchronizer("frameview",ro),t.services.customizationService.setGlobalCustomization("dicomUploadComponent",{component:e=>r.createElement(pi,e)}),it.call(this,e)},getToolbarModule:function({commandsManager:e,servicesManager:t}){const{toolGroupService:n,toolbarService:o,syncGroupService:i,cornerstoneViewportService:a,hangingProtocolService:r,displaySetService:s,viewportGridService:c,panoramicService:d}=t.services;return[{name:"evaluate.viewport.supported",evaluate:({viewportId:e,unsupportedViewportTypes:t,disabledText:n})=>{const o=a.getCornerstoneViewport(e);if(o&&t?.includes(o.type))return Bt(n)}},{name:"evaluate.modality.supported",evaluate:({viewportId:e,unsupportedModalities:t,supportedModalities:n,disabledText:o})=>{const i=c.getDisplaySetsUIDsForViewport(e);if(!i?.length)return;const a=i.map(s.getDisplaySetByUID);if(t?.length){if(a.some(e=>t.includes(e?.Modality)))return Bt(o)}if(n?.length){if(!a.some(e=>n.includes(e?.Modality)))return Bt(o||"Tool not available for this modality")}}},{name:"evaluate.cornerstoneTool",evaluate:({viewportId:e,button:t,toolNames:i,disabledText:a})=>{const r=n.getToolGroupForViewport(e);if(!r)return;const s=o.getToolNameForButton(t);if(!r||!r.hasTool(s)&&!i)return Bt(a);const l=i?i.includes(r.getActivePrimaryMouseButtonTool()):r.getActivePrimaryMouseButtonTool()===s;return{disabled:!1,className:l?"!text-default !bg-selectedBackground rounded":"!text-default hover:!bg-hoverBackground hover:!opacity-100 hover:!text-hoverText rounded",isActive:l}}},{name:"evaluate.group.promoteToPrimaryIfCornerstoneToolNotActiveInTheList",evaluate:({viewportId:e,button:t,itemId:i})=>{const{items:a}=t.props,r=n.getToolGroupForViewport(e);if(!r)return{primary:t.props.primary,items:a};const s=r.getActivePrimaryMouseButtonTool(),l=a.findIndex(e=>o.getToolNameForButton(e)===s);if(l>-1)return{primary:a[l],items:a};if(!i)return{primary:t.props.primary,items:a};return{primary:a.find(e=>e.id===i||e.itemId===i),items:a}}},{name:"evaluate.action",evaluate:({viewportId:e,button:t})=>({className:"!text-default hover:!bg-hoverBackground hover:!opacity-100 hover:!text-hoverText"})},{name:"evaluate.cornerstoneTool.toggle.ifStrictlyDisabled",evaluate:({viewportId:e,button:t,disabledText:i})=>zt({viewportId:e,button:t,toolbarService:o,disabledText:i,offModes:[l.Enums.ToolModes.Disabled],toolGroupService:n})},{name:"evaluate.cornerstoneTool.toggle",evaluate:({viewportId:e,button:t,disabledText:i})=>zt({viewportId:e,button:t,toolbarService:o,disabledText:i,offModes:[l.Enums.ToolModes.Disabled,l.Enums.ToolModes.Passive],toolGroupService:n})},{name:"evaluate.cornerstone.synchronizer",evaluate:({viewportId:e,button:t})=>{let n=i.getSynchronizersForViewport(e);if(!n?.length)return{className:kt(!1)};const o=Array.isArray(t.commands)?t.commands?.[0].commandOptions.type:t.commands?.commandOptions.type;if(n=i.getSynchronizersOfType(o),!n?.length)return{className:kt(!1)};const a=n[0],r=a?._enabled;return{className:kt(r)}}},{name:"evaluate.notProcessing",evaluate:({viewportId:e,disabledText:t})=>{if(d.isProcessing())return{disabled:!0,className:"!text-default ohif-disabled",disabledText:t??"Not available while processing panoramic"}}},{name:"evaluate.viewportProperties.toggle",evaluate:({viewportId:e,button:t})=>{const n=a.getCornerstoneViewport(e);if(!n||n.isDisabled)return;const o=t.id,i=n.getProperties(),r=n.getCamera(),s=r?.[o]||i?.[o];if(!s)return{disabled:!1,className:"!text-default hover:!bg-hoverBackground hover:!text-hoverText"};return{className:kt(s)}}},{name:"evaluate.mpr",evaluate:({viewportId:e,disabledText:t="Selected viewport is not reconstructable"})=>{const{protocol:n}=r.getActiveProtocol(),o=c.getDisplaySetsUIDsForViewport(e);if(!o?.length)return;if(!o.map(s.getDisplaySetByUID).every(e=>e?.isReconstructable))return Bt(t);return{disabled:!1,className:kt("mpr"===n?.id)}}}]},getHangingProtocolModule:Gt,getViewportModule:({servicesManager:e,commandsManager:t})=>[{name:"cornerstone",component:n=>{const{toolbarService:o}=e.services;return r.createElement(Si,gi({},n,{toolbarService:o,servicesManager:e,commandsManager:t}))}}],getCommandsModule:Dt,getCustomizationModule:mt,getUtilityModule:({servicesManager:e})=>[{name:"common",exports:{getCornerstoneLibraries:()=>({cornerstone:s,cornerstoneTools:l}),getEnabledElement:v.kJ,dicomLoaderService:to}},{name:"core",exports:{Enums:s.Enums}},{name:"tools",exports:{toolNames:Y,Enums:l.Enums}},{name:"volumeLoader",exports:{getDynamicVolumeInfo:nt.getDynamicVolumeInfo}}],getSopClassHandlerModule:function(e){return[So(e)]}},fi=yi},77954:(e,t,n)=>{n.d(t,{A:()=>s});var o,i=n(80818),a=n(93213);class r extends i.Rc{constructor(){super(r.EVENTS),this.serviceImplementation={},this.LOCATIONS=r.LOCATIONS,this.serviceImplementation={}}setServiceImplementation({getState:e,addComponent:t,addComponents:n,clear:o}){e&&(this.serviceImplementation._getState=e),t&&(this.serviceImplementation._addComponent=t),n&&(this.serviceImplementation._addComponents=n),o&&(this.serviceImplementation._clear=o)}getState(){return this.serviceImplementation._getState()}addComponent(e){this.serviceImplementation._addComponent(e)}addComponents(e){this.serviceImplementation._addComponents(e)}clear(e){this.serviceImplementation._clear(e)}}o=r,r.EVENTS={},r.LOCATIONS=a.ld,r.REGISTRATION={name:"viewportActionCornersService",altName:"ViewportActionCornersService",create:({configuration:e={}})=>new o};const s=r},71353:(e,t,n)=>{n.d(t,{cL:()=>r,kJ:()=>a,ye:()=>i});const o={DEFAULT_CONTEXT:"CORNERSTONE",enabledElements:{}},i=(e,t,n)=>{const i=n||o.DEFAULT_CONTEXT;o.enabledElements[e]={element:t,context:i}},a=e=>o.enabledElements[e],r=()=>{o.enabledElements={}}},46026:(e,t,n)=>{n.d(t,{FG:()=>o,H7:()=>a,gS:()=>i});const o="&",i="default",a=(e,t,n,i)=>{if(e.push(0),!i)for(let i=0;i<128;i++){e[e.length-1]=i;const a=e.join(o);if(!Array.from(n.values()).find(e=>e.viewportOptions?.presentationIds?.[t]===a))break}}},10182:(e,t,n)=>{n.d(t,{I:()=>l});var o=n(78713),i=(n(21978),n(46026));const a="lutPresentationId",r=(e,{viewport:t,viewports:n,isUpdatingSameViewport:o})=>{if(e!==a)return;if(!t||!t.viewportOptions||!t.displaySetInstanceUIDs?.length)return;const{displaySetOptions:r,displaySetInstanceUIDs:s}=t,l=[(e=>{if(!e||!e.options)return i.gS;if(e.options.id)return e.options.id;const t=Object.entries(e.options).map(([e,t])=>`${e}=${t}`);return t.length?t.join(i.FG):i.gS})(r[0])];for(const e of s)l.push(e);return(0,i.H7)(l,a,n,o),l.join(i.FG)},s=e=>({type:a,lutPresentationStore:{},setLutPresentation:(t,n)=>e(e=>({lutPresentationStore:{...e.lutPresentationStore,[t]:n}}),!1,"setLutPresentation"),clearLutPresentationStore:()=>e({lutPresentationStore:{}},!1,"clearLutPresentationStore"),getPresentationId:r}),l=(0,o.vt)()(s)},44646:(e,t,n)=>{n.d(t,{q:()=>c});var o=n(78713),i=(n(21978),n(46026));const a="positionPresentationId",r=(e,{viewport:t,viewports:n,isUpdatingSameViewport:o})=>{if(e===a&&t?.viewportOptions&&t.displaySetInstanceUIDs?.length)return s(t,n,o)};function s(e,t,n){const{viewportOptions:o={},displaySetInstanceUIDs:r=[],displaySetOptions:s=[]}=e,{id:l,orientation:c}=o,d=[c||"acquisition"];l&&d.push(l),s?.some(e=>e.options?.blendMode||e.options?.displayPreset)&&d.push("custom");for(const e of r)d.push(e);return t&&t.length&&void 0!==n?(0,i.H7)(d,a,t,n):d.push(0),d.join(i.FG)}const l=e=>({type:a,positionPresentationStore:{},setPositionPresentation:(t,n)=>e(e=>({positionPresentationStore:{...e.positionPresentationStore,[t]:n}}),!1,"setPositionPresentation"),clearPositionPresentationStore:()=>e({positionPresentationStore:{}},!1,"clearPositionPresentationStore"),getPresentationId:r,getPositionPresentationId:s}),c=(0,o.vt)()(l)},2847:(e,t,n)=>{n.d(t,{v:()=>m});var o=n(78713),i=(n(21978),n(46026)),a=n(15327);const{MPR_CAMERA_VALUES:r}=a.CONSTANTS,s="segmentationPresentationId",l=(e,{viewport:t,viewports:n,isUpdatingSameViewport:o,servicesManager:i})=>{if(e===s)return c({viewport:t,viewports:n,isUpdatingSameViewport:o,servicesManager:i})},c=({viewport:e,viewports:t,isUpdatingSameViewport:n,servicesManager:o})=>{if(!e?.viewportOptions||!e.displaySetInstanceUIDs?.length)return;const{displaySetInstanceUIDs:s,viewportOptions:l}=e;let c=l.orientation;if(!c){const e=o.services.displaySetService.getDisplaySetByUID(s[0]),t=e.images?.[0],n=t?.ImageOrientationPatient;c=(e=>{if(!e||6!==e.length)return;const t=e.slice(0,3),n=e.slice(3,6),o=[-n[0],-n[1],-n[2]];return a.utilities.isEqual(t,r.axial.viewRight)&&a.utilities.isEqual(o,r.axial.viewUp)?"axial":a.utilities.isEqual(t,r.sagittal.viewRight)&&a.utilities.isEqual(o,r.sagittal.viewUp)?"sagittal":a.utilities.isEqual(t,r.coronal.viewRight)&&a.utilities.isEqual(o,r.coronal.viewUp)?"coronal":void 0})(n)}const d=[];return d.push(...s),(0,i.H7)(d,"segmentationPresentationId",t,!1),d.join(i.FG)},d=e=>({type:s,segmentationPresentationStore:{},clearSegmentationPresentationStore:()=>e({segmentationPresentationStore:{}},!1,"clearSegmentationPresentationStore"),addSegmentationPresentationItem:(t,n)=>e(e=>({segmentationPresentationStore:{...e.segmentationPresentationStore,[t]:[...e.segmentationPresentationStore[t]||[],n]}}),!1,"addSegmentationPresentationItem"),setSegmentationPresentation:(t,n)=>e(e=>({segmentationPresentationStore:{...e.segmentationPresentationStore,[t]:n}}),!1,"setSegmentationPresentation"),getPresentationId:l,getSegmentationPresentationId:c}),m=(0,o.vt)()(d)},68578:(e,t,n)=>{n.d(t,{U:()=>a});var o=n(78713);n(21978);const i=e=>({synchronizersStore:{},type:"synchronizersStoreId",setSynchronizers:(t,n)=>{e(e=>({synchronizersStore:{...e.synchronizersStore,[t]:n}}),!1,"setSynchronizers")},clearSynchronizersStore:()=>{e({synchronizersStore:{}},!1,"clearSynchronizersStore")}}),a=(0,o.vt)()(i)}}]);
//# sourceMappingURL=2860.bundle.bf0cedf818f52ba9d3ff.js.map