(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[497],{42001:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Ce});const a=JSON.parse('{"u2":"@ohif/extension-cornerstone-dicom-seg"}').u2,o=`${a}.sopClassHandlerModule.dicom-seg`;var r=n(32735),s=n(92780),i=n(48501),l=n(22737);const{DicomMessage:c,DicomMetaDictionary:m}=l.default.data,d=["1.2.840.10008.5.1.4.1.1.66.4"];let p={};function u(e,t,n){const a=e[0],{StudyInstanceUID:r,SeriesInstanceUID:u,SOPInstanceUID:g,SeriesDescription:E,SeriesNumber:f,SeriesDate:x,SOPClassUID:S,wadoRoot:v,wadoUri:I,wadoUriRoot:h}=a,y={Modality:"SEG",loading:!1,isReconstructable:!0,displaySetInstanceUID:i.utils.guid(),SeriesDescription:E,SeriesNumber:f,SeriesDate:x,SOPInstanceUID:g,SeriesInstanceUID:u,StudyInstanceUID:r,SOPClassHandlerId:o,SOPClassUID:S,referencedImages:null,referencedSeriesInstanceUID:null,referencedDisplaySetInstanceUID:null,isDerivedDisplaySet:!0,isLoaded:!1,isHydrated:!1,segments:{},sopClassUids:d,instance:a,instances:[a],wadoRoot:v,wadoUriRoot:h,wadoUri:I,isOverlayDisplaySet:!0},N=a.ReferencedSeriesSequence;if(!N)throw new Error("ReferencedSeriesSequence is missing for the SEG");const w=N[0];return y.referencedImages=a.ReferencedSeriesSequence.ReferencedInstanceSequence,y.referencedSeriesInstanceUID=w.SeriesInstanceUID,y.getReferenceDisplaySet=()=>{const{displaySetService:e}=t.services,n=e.getDisplaySetsForSeries(y.referencedSeriesInstanceUID);if(!n||0===n.length)throw new Error("Referenced DisplaySet is missing for the SEG");const a=n[0];y.referencedDisplaySetInstanceUID=a.displaySetInstanceUID,y.referencedVolumeURI=a.displaySetInstanceUID;const o=`cornerstoneStreamingImageVolume:${y.referencedVolumeURI}`;return y.referencedVolumeId=o,a},y.load=async({headers:e})=>await function(e,t,n,a){const{SOPInstanceUID:o}=e,{segmentationService:r}=t.services;if((e.loading||e.isLoaded)&&p[o]&&function(e,t){return t.getSegmentation(e.displaySetInstanceUID)}(e,r))return p[o];return e.loading=!0,p[o]=new Promise((async(t,o)=>{if(!e.segments||0===Object.keys(e.segments).length){const t=await async function(e,t,n){const a=e.getModuleEntry("@ohif/extension-cornerstone.utilityModule.common"),{dicomLoaderService:o}=a.exports,r=await o.findDicomDataPromise(t,null,n),i=c.readFile(r),d=m.naturalizeDataset(i.dict);d._meta=m.namifyDataset(i.meta),Array.isArray(d.SegmentSequence)||(d.SegmentSequence=[d.SegmentSequence]);const p=function(e){const t={};return e.SegmentSequence.forEach((e=>{const n=e.RecommendedDisplayCIELabValue,a=l.default.data.Colors.dicomlab2RGB(n).map((e=>Math.round(255*e)));a.push(255);const o=e.SegmentNumber;t[o]={color:a,functionalGroups:[],offset:null,size:null,pixelData:null,label:e.SegmentLabel}})),e.PerFrameFunctionalGroupsSequence.forEach((e=>{const n=e.SegmentIdentificationSequence.ReferencedSegmentNumber;t[n].functionalGroups.push(e)})),function(e,t){let n=Math.ceil(e.Rows*e.Columns/8),a=0;return Object.keys(t).forEach((o=>{const r=t[o];r.numberOfFrames=r.functionalGroups.length,r.size=r.numberOfFrames*n,r.offset=a,a=r.offset+r.size;const i=e.PixelData[0].slice(r.offset,a);r.pixelData=l.default.data.BitArray.unpack(i),r.geometry=function(e,t){let n=e.SharedFunctionalGroupsSequence.PixelMeasuresSequence,a=e.SharedFunctionalGroupsSequence.PlaneOrientationSequence,o=t[0].PlanePositionSequence;const r={};let i=n.SpacingBetweenSlices;i||n.SliceThickness&&(console.log("Using SliceThickness as SpacingBetweenSlices"),i=n.SliceThickness);r.spacing=[n.PixelSpacing[1],n.PixelSpacing[0],i].map(Number),r.dimensions=[e.Columns,e.Rows,t.length].map(Number);let l=a.ImageOrientationPatient.map(Number);const c=l.slice(0,3),m=l.slice(3,6);r.planeNormal=[],s.ZP.cross(c,m,r.planeNormal);let d=t[0].PlanePositionSequence.ImagePositionPatient.map(Number),p=t[t.length-1].PlanePositionSequence.ImagePositionPatient.map(Number);return r.sliceStep=[],s.ZP.subtract(p,d,r.sliceStep),s.ZP.normalize(r.sliceStep),r.direction=c.concat(m).concat(r.sliceStep),r.origin=o.ImagePositionPatient.map(Number),r}(e,r.functionalGroups)})),t}(e,t)}(d);return p}(n,e,a);e.segments=t}const i=!0;r.createSegmentationForSEGDisplaySet(e,null,i).then((()=>{e.loading=!1,t()})).catch((t=>{e.loading=!1,o(t)}))})),p[o]}(y,t,n,e),[y]}const g=function({servicesManager:e,extensionManager:t}){return[{name:"dicom-seg",sopClassUids:d,getDisplaySetsFromSeries:n=>u(n,e,t)}]};var E=n(60216),f=n.n(E),x=n(22605);const S=function(e,t,n){const a="enter-segment-label",o=({action:t,value:o})=>{switch(t.id){case"save":n(o.label,t.id);break;case"cancel":n("",t.id)}e.dismiss({id:a})};e&&e.create({id:a,centralize:!0,isDraggable:!1,showOverlay:!0,content:x.Vq,contentProps:{title:"Segment",value:{label:t},noCloseButton:!0,onClose:()=>e.dismiss({id:a}),actions:[{id:"cancel",text:"Cancel",type:"primary"},{id:"save",text:"Confirm",type:"secondary"}],onSubmit:o,body:({value:e,setValue:t})=>r.createElement(x.II,{label:"Enter the segment label",labelClassName:"text-white text-[14px] leading-[1.2]",autoFocus:!0,className:"bg-black border-primary-main",type:"text",value:e.label,onChange:e=>{e.persist(),t((t=>({...t,label:e.target.value})))},onKeyPress:t=>{"Enter"===t.key&&o({value:e,action:{id:"save"}})}})}})};var v=n(72853),I=n(95685),h=n.n(I),y=n(96665),N=n(20777),w=n(81122);const b=({value1:e,value2:t,onChange:n,minValue:a,maxValue:o,step:s=1,unit:i="",containerClassName:l,inputClassName:c,labelClassName:m,labelVariant:d,showLabel:p=!0,labelPosition:u="",trackColor:g})=>{const[E,f]=(0,r.useState)(e),[S,v]=(0,r.useState)(t);(0,r.useEffect)((()=>{e<a||(f(e),t>o||v(t))}),[e,t]);const I=e=>{const t=Number(e.target.value);t<a||(f(t),n(t,S))},y=e=>{const t=Number(e.target.value);t>o||(v(t),n(E,t))},N=s>=1?E.toFixed(0):E.toFixed(1),b=s>=1?S.toFixed(0):S.toFixed(1);return r.createElement("div",{style:{flexDirection:"column"},className:`flex items-center cursor-pointer space-x-1 ${l||""}`},p&&"left"===u&&r.createElement(r.Fragment,null,r.createElement(w.Z,{variant:d??"subtitle",component:"p",className:h()("w-8",m??"text-white")},N,i),r.createElement(w.Z,{variant:d??"subtitle",component:"p",className:h()("w-8",m??"text-white")},b,i)),r.createElement("div",{style:{flexDirection:"row"},className:"flex pb-[5px]"},r.createElement("input",{type:"range",min:a,max:o,value:E,className:`appearance-none h-[3px] rounded-lg input-range-thumb-design ${c||""}`,style:{background:"#3a3f99"},onChange:I,id:"myRange1",step:s}),r.createElement("input",{type:"range",min:a,max:o,value:S,className:`appearance-none h-[3px] rounded-lg input-range-thumb-design ${c||""}`,style:{background:"#3a3f99"},onChange:y,id:"myRange2",step:s})),p&&(!u||"right"===u)&&r.createElement("div",{style:{flexDirection:"row",width:"100%"},className:"flex pb-[5px]"},r.createElement(w.Z,{variant:d??"subtitle",component:"p",className:h()("w-1/2",m??"text-white","flex","justify-center")},"Min : ",N,i),r.createElement(w.Z,{variant:d??"subtitle",component:"p",className:h()("w-1/2",m??"text-white","flex","justify-center")},"Max : ",b,i)),r.createElement("div",{className:"flex",style:{width:"100%"}},r.createElement("div",{className:"flex w-1/2 justify-center"},r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{I({target:{value:E-10}})}},"--"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{I({target:{value:E-1}})}},"-"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{I({target:{value:E+1}})}},"+"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{I({target:{value:E+10}})}},"++")),r.createElement("div",{className:"flex w-1/2 justify-center"},r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:S-10}})}},"--"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:S-1}})}},"-"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:S+1}})}},"+"),r.createElement(x.zx,{size:"small",color:"black",onClick:()=>{y({target:{value:S+10}})}},"++"))))};var C=n(21572),T=n(98386);const{Enums:D}=v,{MouseBindings:R,Events:V}=D,O=({label:e,t,eraseFocus:n})=>{const a=e===n;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",a&&"bg-primary-dark",a?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},e))};var k=function(e){return e.FILL_INSIDE_CIRCLE="FILL_INSIDE_CIRCLE",e.THRESHOLD_INSIDE_CIRCLE="THRESHOLD_INSIDE_CIRCLE",e.THRESHOLD_INSIDE_SPHERE="THRESHOLD_INSIDE_SPHERE",e.ERASE_INSIDE_CIRCLE="ERASE_INSIDE_CIRCLE",e.FILL_INSIDE_SPHERE="FILL_INSIDE_SPHERE",e.ERASE_INSIDE_SPHERE="ERASE_INSIDE_SPHERE",e}(k||{});const A=[];function _({cornerstoneViewportService:e,segmentationService:t}){const{t:n}=(0,C.$G)("Buttons"),[a,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!0),[l,c]=(0,r.useState)("All"),[m,d]=(0,r.useState)({active:!1,minimum:!0}),[{activeViewportIndex:p,viewports:u},g]=(0,x.O_)(),[E,f]=(0,r.useState)(k.FILL_INSIDE_CIRCLE),[S,I]=(0,r.useState)(25),[w,D]=(0,r.useState)([-1e3,5e3]),[_,M]=(0,r.useState)([]);(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(p).id,e.getCornerstoneViewportByIndex(p).renderingEngineId),a=n.getToolInstance("Brush");f(a.configuration.activeStrategy),I(a.configuration.brushSize),D(a.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold);const o=t.getSegmentations().filter((e=>e.isActive))[0];M([{label:"All",segmentIndex:0},...o.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:n}=e;c(t),a.setConfiguration({eraseFocusIndex:n})}})))),n.setToolActive("Undo",{bindings:[{mouseButton:R.Primary}]})}),[]),(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(p).id,e.getCornerstoneViewportByIndex(p).renderingEngineId).getToolInstance("Brush"),a=t.EVENTS.SEGMENTATION_ADDED,o=t.EVENTS.SEGMENTATION_UPDATED,r=t.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((e=>{t.subscribe(e,(()=>{const e=t.getSegmentations().filter((e=>e.isActive))[0];M([{label:"All",segmentIndex:0},...e.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;n.setConfiguration({eraseFocusIndex:a}),c(t)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(p).id,e.getCornerstoneViewportByIndex(p).renderingEngineId).getToolInstance("Brush").setConfiguration({brushSize:S,activeStrategy:E,strategySpecificConfiguration:{THRESHOLD_INSIDE_CIRCLE:{threshold:w}}})}),[S,E,w]);return(0,r.useEffect)((()=>{const t=e.getCornerstoneViewportByIndex(p),n=v.ToolGroupManager.getToolGroupForViewport(t.id,t.renderingEngineId),a=t.element;a.addEvent=(e,t)=>{A[e]&&(a.removeEventListener(e,A[e]),A[e]=null),A[e]=t,a.addEventListener(e,t)},a.removeEvent=e=>{a.removeEventListener(e,A[e]),A[e]=null},m.active?(n.setToolPassive("Brush"),n.setToolActive("DragProbe",{bindings:[{mouseButton:R.Primary}]}),a.addEvent(V.MOUSE_DRAG,(t=>{((t,n)=>{if(1===t.detail.mouseButton){const a=e.getCornerstoneViewportByIndex(p),o=t.detail.currentPoints.world,r=a.getImageData(),s=r.imageData.worldToIndex(o).map(Math.round);s[0]=Math.round(s[0]),s[1]=Math.round(s[1]),s[2]=Math.round(s[2]);const{scalarData:i,dimensions:l}=r;if(T.utilities.indexWithinDimensions(s,l)){const e=l[0],t=l[0]*l[1],a=i[s[2]*t+s[1]*e+s[0]];D(n?[a,w[1]]:[w[0],a])}}})(t,m.minimum)}))):(n.setToolPassive("DragProbe"),n.setToolActive("Brush",{bindings:[{mouseButton:R.Primary}]}),a.removeEvent(V.MOUSE_DRAG))}),[m.active,m.minimum]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Paint Brush Tool Edit")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Filling mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:E===k.FILL_INSIDE_CIRCLE?"primary":"secondary",onClick:()=>{f(k.FILL_INSIDE_CIRCLE)}},"Circle"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:E===k.THRESHOLD_INSIDE_CIRCLE?"primary":"secondary",onClick:()=>{f(k.THRESHOLD_INSIDE_CIRCLE)}},"Circle Threshold")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:E===k.FILL_INSIDE_SPHERE?"primary":"secondary",onClick:()=>{f(k.FILL_INSIDE_SPHERE)}},"Sphere"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:E===k.THRESHOLD_INSIDE_SPHERE?"primary":"secondary",onClick:()=>{f(k.THRESHOLD_INSIDE_SPHERE)}},"Sphere Threshold")),r.createElement("div",{className:"h-[1px] bg-[#212456] mb-[8px] mx-1"}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Erase mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:E===k.ERASE_INSIDE_CIRCLE?"primary":"secondary",onClick:()=>{f(k.ERASE_INSIDE_CIRCLE)}},"Circle"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:E===k.ERASE_INSIDE_SPHERE?"primary":"secondary",onClick:()=>{f(k.ERASE_INSIDE_SPHERE)}},"Sphere")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),i(!s)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!s})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!s&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:_,renderer:e=>O({...e,t:n,eraseFocus:l})})))),r.createElement("div",{className:"h-[1px] bg-[#212456] mb-[8px] mx-1 mt-[8px]"}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Attributes"),r.createElement("div",{className:"flex items-center col-span-2"},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]"},"Radius"),r.createElement(N.Z,{minValue:0,maxValue:100,value:S,onChange:e=>{I(e)},step:1,containerClassName:"mt-[4px] mb-[4px]",inputClassName:"w-[64px]",labelClassName:"text-white text-[12px]",unit:"px"})),(E===k.THRESHOLD_INSIDE_CIRCLE||E===k.THRESHOLD_INSIDE_SPHERE)&&r.createElement("div",{className:"flex items-center col-span-2",style:{flexDirection:"column",width:"100%"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]",style:{width:"100%"}},"Threshold values"),r.createElement(b,{minValue:-1e3,maxValue:5e3,value1:w[0],value2:w[1],onChange:(e,t)=>{D([e,t])},step:5,containerClassName:"mt-[4px] mb-[4px] w-full",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:"HU"}),r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]",style:{width:"100%"}},"Select threshold value with pipette for :"),r.createElement("div",{className:"flex flex-row justify-evenly w-full mb-[8px]"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{d({active:!0,minimum:!0})}},"Minimum"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{d({active:!0,minimum:!1})}},"Maximum")),m.active&&r.createElement(x.zx,{size:"small",color:"secondary",onClick:()=>{d({active:!1,minimum:!0})}},"Back to annotation"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const M=({label:e,t,eraseFocus:n})=>{const a=e===n;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",a&&"bg-primary-dark",a?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},e))};var L=function(e){return e.FILL_INSIDE="FILL_INSIDE",e.ERASE_INSIDE="ERASE_INSIDE",e}(L||{});function P({cornerstoneViewportService:e,segmentationService:t}){const{t:n}=(0,C.$G)("Buttons"),[a,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(L.FILL_INSIDE),[{activeViewportIndex:l,viewports:c},m]=(0,x.O_)(),[d,p]=(0,r.useState)([]),[u,g]=(0,r.useState)(!0),[E,f]=(0,r.useState)("All");return(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("CircleScissor"),a=t.EVENTS.SEGMENTATION_ADDED,o=t.EVENTS.SEGMENTATION_UPDATED,r=t.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((e=>{t.subscribe(e,(()=>{const e=t.getSegmentations().filter((e=>e.isActive))[0];p([{label:"All",segmentIndex:0},...e.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;n.setConfiguration({eraseFocusIndex:a}),f(t)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("CircleScissor");i(n.configuration.activeStrategy);const a=t.getSegmentations().filter((e=>e.isActive))[0];p([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;f(t),n.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("CircleScissor").setConfiguration({activeStrategy:s})}),[s]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Circle Segmentation Tool Edit")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:s===L.FILL_INSIDE?"primary":"secondary",onClick:()=>{i(L.FILL_INSIDE)}},"Fill"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:s===L.ERASE_INSIDE?"primary":"secondary",onClick:()=>{i(L.ERASE_INSIDE)}},"Erase")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),g(!u)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!u})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!u&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:d,renderer:e=>M({...e,t:n,eraseFocus:E})}))))),r.createElement("div",{className:"h-[6px] bg-black "})))}function F({}){const[e,t]=(0,r.useState)(!1);return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:n=>{n.stopPropagation(),t(!e)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!e})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Fill Holes Tool Edit")),!e&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"No configurations for this tool")),r.createElement("div",{className:"h-[6px] bg-black "})))}const{Enums:G}=v,{MouseBindings:z,Events:B}=G,U=[];function H({segmentationService:e,cornerstoneViewportService:t,commandsManager:n}){const[a,o]=(0,r.useState)(!1),[{activeViewportIndex:s,viewports:i},l]=(0,x.O_)(),[c,m]=(0,r.useState)([-1e3,5e3]),[d,p]=(0,r.useState)(0),[u,g]=(0,r.useState)({active:!1,minimum:!0});(0,r.useEffect)((()=>{const e=v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(s).id,t.getCornerstoneViewportByIndex(s).renderingEngineId).getToolInstance("RectangleROIStartEndThreshold");p(e.configuration.numSlicesToPropagate)}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(t.getCornerstoneViewportByIndex(s).id,t.getCornerstoneViewportByIndex(s).renderingEngineId).getToolInstance("RectangleROIStartEndThreshold").setConfiguration({numSlicesToPropagate:d}),console.log("SET CONFIGURATION",d)}),[d]);(0,r.useEffect)((()=>{const e=t.getCornerstoneViewportByIndex(s),n=v.ToolGroupManager.getToolGroupForViewport(e.id,e.renderingEngineId),a=e.element;a.addEvent=(e,t)=>{U[e]&&(a.removeEventListener(e,U[e]),U[e]=null),U[e]=t,a.addEventListener(e,t)},a.removeEvent=e=>{a.removeEventListener(e,U[e]),U[e]=null},u.active?(n.setToolPassive("RectangleROIStartEndThreshold"),n.setToolActive("DragProbe",{bindings:[{mouseButton:z.Primary}]}),a.addEvent(B.MOUSE_DRAG,(e=>{((e,n)=>{if(1===e.detail.mouseButton){const a=t.getCornerstoneViewportByIndex(s),o=e.detail.currentPoints.world,r=a.getImageData(),i=r.imageData.worldToIndex(o).map(Math.round);i[0]=Math.round(i[0]),i[1]=Math.round(i[1]),i[2]=Math.round(i[2]);const{scalarData:l,dimensions:d}=r;if(T.utilities.indexWithinDimensions(i,d)){const e=d[0],t=d[0]*d[1],a=l[i[2]*t+i[1]*e+i[0]];m(n?[a,c[1]]:[c[0],a])}}})(e,u.minimum)}))):(n.setToolPassive("DragProbe"),n.setToolActive("RectangleROIStartEndThreshold",{bindings:[{mouseButton:z.Primary}]}),a.removeEvent(B.MOUSE_DRAG))}),[u.active,u.minimum]);return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"3D Rectangle Threshold Segmentation Tool Edit")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"flex items-center col-span-2",style:{flexDirection:"column",width:"100%"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]",style:{width:"100%"}},"Threshold values"),r.createElement(b,{minValue:-1e3,maxValue:5e3,value1:c[0],value2:c[1],onChange:(e,t)=>{m([e,t])},step:5,containerClassName:"mt-[4px] mb-[4px] w-full",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:""}),r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]",style:{width:"100%"}},"Select threshold value with pipette for :"),r.createElement("div",{className:"flex flex-row justify-evenly w-full mb-[8px]"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{g({active:!0,minimum:!0})}},"Minimum"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{g({active:!0,minimum:!1})}},"Maximum")),u.active&&r.createElement(x.zx,{size:"small",color:"secondary",onClick:()=>{g({active:!1,minimum:!0})}},"Back to annotation")),r.createElement("div",{className:"flex items-center col-span-2",style:{width:"100%",flexDirection:"column"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px]",style:{width:"100%"}},"Slices Propagation"),r.createElement(N.Z,{minValue:0,maxValue:200,value:d,onChange:e=>{p(e)},step:1,containerClassName:"mt-[4px] mb-[4px] w-full",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:""})),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const n=t.getCornerstoneViewportByIndex(s).getActors().map((e=>{const t=e.referenceId??e.uid;return T.cache.getVolume(t)})).filter((e=>!!e)),a=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIStartEndThreshold");if(!a)throw new Error("No annotation selected ");const o=a[0];if(!v.annotation.state.getAnnotation(o))return;const r=n.filter((e=>e.imageIds))[0],i=n.filter((e=>!e.imageIds))[0],l=e.getSegmentations();v.utilities.segmentation.rectangleROIThresholdVolumeByRange(a,i,[{volume:r,lower:c[0],upper:c[1]}],{numSlicesToProject:0,overwrite:!1,overlapType:1,segmentIndex:l[0].activeSegmentIndex})})()}},"Compute Threshold")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const e=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIStartEndThreshold");if(!e)throw new Error("No annotation selected ");console.log("selected annotation uid",e);const n=e[0];console.log("CSTOOLS STATE",v.annotation.state),v.annotation.state.removeAnnotation(n),t.getCornerstoneViewportByIndex(s).render()})()}},"Delete selected region"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const{Enums:W}=v,{MouseBindings:j,Events:q}=W,Z=[];function $({segmentationService:e,cornerstoneViewportService:t,commandsManager:n}){const[a,o]=(0,r.useState)(!1),[{activeViewportIndex:s,viewports:i},l]=(0,x.O_)(),[c,m]=(0,r.useState)([-1e3,5e3]),[d,p]=(0,r.useState)({active:!1,minimum:!0});(0,r.useEffect)((()=>{const e=t.getCornerstoneViewportByIndex(s),n=v.ToolGroupManager.getToolGroupForViewport(e.id,e.renderingEngineId),a=e.element;a.addEvent=(e,t)=>{Z[e]&&(a.removeEventListener(e,Z[e]),Z[e]=null),Z[e]=t,a.addEventListener(e,t)},a.removeEvent=e=>{a.removeEventListener(e,Z[e]),Z[e]=null},d.active?(n.setToolPassive("RectangleROIThreshold"),n.setToolActive("DragProbe",{bindings:[{mouseButton:j.Primary}]}),a.addEvent(q.MOUSE_DRAG,(e=>{((e,n)=>{if(1===e.detail.mouseButton){const a=t.getCornerstoneViewportByIndex(s),o=e.detail.currentPoints.world,r=a.getImageData(),i=r.imageData.worldToIndex(o).map(Math.round);i[0]=Math.round(i[0]),i[1]=Math.round(i[1]),i[2]=Math.round(i[2]);const{scalarData:l,dimensions:d}=r;if(T.utilities.indexWithinDimensions(i,d)){const e=d[0],t=d[0]*d[1],a=l[i[2]*t+i[1]*e+i[0]];m(n?[a,c[1]]:[c[0],a])}}})(e,d.minimum)}))):(n.setToolPassive("DragProbe"),n.setToolActive("RectangleROIThreshold",{bindings:[{mouseButton:j.Primary}]}),a.removeEvent(q.MOUSE_DRAG))}),[d.active,d.minimum]);return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Rectangle Threshold Segmentation Tool Edit")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"flex items-center col-span-2 pb-[9px]",style:{flexDirection:"column",width:"100%"}},r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pb-[3px]",style:{width:"100%"}},"Threshold values"),r.createElement(b,{minValue:-1e3,maxValue:5e3,value1:c[0],value2:c[1],onChange:(e,t)=>{m([e,t])},step:5,containerClassName:"mt-[4px] mb-[4px] w-full pb-[3px]",inputClassName:"w-full",labelClassName:"text-white text-[12px] w-full",unit:"HU"}),r.createElement("div",{className:"text-[#ffffff] text-[12px] pr-[9px] pt-[9px] mb-[3px]",style:{width:"100%"}},"Select threshold value with pipette for :"),r.createElement("div",{className:"flex flex-row justify-evenly w-full mb-[8px]"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{p({active:!0,minimum:!0})}},"Minimum"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{p({active:!0,minimum:!1})}},"Maximum")),d.active&&r.createElement(x.zx,{size:"small",color:"secondary",onClick:()=>{p({active:!1,minimum:!0})}},"Back to annotation")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const n=t.getCornerstoneViewportByIndex(s).getActors().map((e=>{const t=e.referenceId??e.uid;return T.cache.getVolume(t)})).filter((e=>!!e)),a=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIThreshold");if(!a)throw new Error("No annotation selected ");const o=a[0];if(!v.annotation.state.getAnnotation(o))return;const r=n.filter((e=>e.imageIds))[0],i=n.filter((e=>!e.imageIds))[0],l=e.getSegmentations();console.log("SEGMENTATION",l),v.utilities.segmentation.rectangleROIThresholdVolumeByRange(a,i,[{volume:r,lower:c[0],upper:c[1]}],{numSlicesToProject:0,overwrite:!1,overlapType:1,segmentIndex:l[0].activeSegmentIndex})})()}},"Compute Threshold")),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{(()=>{const e=v.annotation.selection.getAnnotationsSelectedByToolName("RectangleROIThreshold");if(!e)throw new Error("No annotation selected ");console.log("selected annotation uid",e);const n=e[0];console.log("CSTOOLS STATE",v.annotation.state),v.annotation.state.removeAnnotation(n),t.getCornerstoneViewportByIndex(s).render()})()}},"Delete selected region"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const J=({label:e,t,eraseFocus:n})=>{const a=e===n;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",a&&"bg-primary-dark",a?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},e))};var Q=function(e){return e.FILL_INSIDE="FILL_INSIDE",e.ERASE_INSIDE="ERASE_INSIDE",e}(Q||{});function X({cornerstoneViewportService:e,segmentationService:t}){const{t:n}=(0,C.$G)("Buttons"),[a,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(Q.FILL_INSIDE),[{activeViewportIndex:l,viewports:c},m]=(0,x.O_)(),[d,p]=(0,r.useState)([]),[u,g]=(0,r.useState)(!0),[E,f]=(0,r.useState)("All");return(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("RectangleScissor"),a=t.EVENTS.SEGMENTATION_ADDED,o=t.EVENTS.SEGMENTATION_UPDATED,r=t.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((e=>{t.subscribe(e,(()=>{const e=t.getSegmentations().filter((e=>e.isActive))[0];p([{label:"All",segmentIndex:0},...e.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;n.setConfiguration({eraseFocusIndex:a}),f(t)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("RectangleScissor");i(n.configuration.activeStrategy);const a=t.getSegmentations().filter((e=>e.isActive))[0];p([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;f(t),n.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("RectangleScissor").setConfiguration({activeStrategy:s})}),[s]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Rectangle Scissors Tool Edit")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:s===Q.FILL_INSIDE?"primary":"secondary",onClick:()=>{i(Q.FILL_INSIDE)}},"Fill"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:s===Q.ERASE_INSIDE?"primary":"secondary",onClick:()=>{i(Q.ERASE_INSIDE)}},"Erase")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),g(!u)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!u})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!u&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:d,renderer:e=>J({...e,t:n,eraseFocus:E})}))))),r.createElement("div",{className:"h-[6px] bg-black "})))}const K=({label:e,t,eraseFocus:n})=>{const a=e===n;return r.createElement("div",{className:h()("flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark","text-base whitespace-pre",a&&"bg-primary-dark",a?"text-[#348CFD]":"text-common-bright hover:bg-primary-dark hover:text-primary-light")},r.createElement("span",{className:"mr-5"},e))};var Y=function(e){return e.FILL_INSIDE="FILL_INSIDE",e.ERASE_INSIDE="ERASE_INSIDE",e}(Y||{});function ee({cornerstoneViewportService:e,segmentationService:t}){const{t:n}=(0,C.$G)("Buttons"),[a,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(Y.FILL_INSIDE),[{activeViewportIndex:l,viewports:c},m]=(0,x.O_)(),[d,p]=(0,r.useState)([]),[u,g]=(0,r.useState)(!0),[E,f]=(0,r.useState)("All");return(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("RectangleScissor"),a=t.EVENTS.SEGMENTATION_ADDED,o=t.EVENTS.SEGMENTATION_UPDATED,r=t.EVENTS.SEGMENTATION_REMOVED,s=[];return[a,o,r].forEach((e=>{t.subscribe(e,(()=>{const e=t.getSegmentations().filter((e=>e.isActive))[0];p([{label:"All",segmentIndex:0},...e.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;n.setConfiguration({eraseFocusIndex:a}),f(t)}}))))}))})),()=>{s.forEach((e=>{e()}))}}),[]),(0,r.useEffect)((()=>{const n=v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("SphereScissor");i(n.configuration.activeStrategy);const a=t.getSegmentations().filter((e=>e.isActive))[0];p([{label:"All",segmentIndex:0},...a.segments.filter((e=>e))].map((e=>({...e,onClick:e=>{const{label:t,segmentIndex:a}=e;f(t),n.setConfiguration({eraseFocusIndex:a})}}))))}),[]),(0,r.useEffect)((()=>{v.ToolGroupManager.getToolGroupForViewport(e.getCornerstoneViewportByIndex(l).id,e.getCornerstoneViewportByIndex(l).renderingEngineId).getToolInstance("SphereScissor").setConfiguration({activeStrategy:s})}),[s]),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Sphere Scissors Tool Edit")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]"},"Mode"),r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:s===Y.FILL_INSIDE?"primary":"secondary",onClick:()=>{i(Y.FILL_INSIDE)}},"Fill"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:s===Y.ERASE_INSIDE?"primary":"secondary",onClick:()=>{i(Y.ERASE_INSIDE)}},"Erase")),r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),g(!u)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!u})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Erase Options")),!u&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[6px]"},"Erase focus on :"),r.createElement(x.QE,{items:d,renderer:e=>K({...e,t:n,eraseFocus:E})}))))),r.createElement("div",{className:"h-[6px] bg-black "})))}const{Enums:te}=v,{Events:ne}=te;const ae=10,oe=new class extends Array{constructor(e){super(),this.maxLength=void 0,this.maxLength=e}push(...e){const t=super.push(...e);if(this.length>this.maxLength){const e=this.length-this.maxLength;this.splice(0,e)}return t}}(ae);function re({cornerstoneViewportService:e,segmentationService:t}){const{t:n}=(0,C.$G)("Buttons"),[a,o]=(0,r.useState)(!1),[{activeViewportIndex:s,viewports:i},l]=(0,x.O_)(),[c,m]=(0,r.useState)(oe.length);(0,r.useEffect)((()=>{e.getCornerstoneViewportByIndex(s).element.addEventListener(ne.MOUSE_DOWN,(e=>{const n=t.getSegmentations()[0],a=new Uint8ClampedArray(t.getLabelmapVolume(n.id).getScalarData());oe.push(a),m(oe.length)}))}),[]);const d=t=>{const n=e.getCornerstoneViewportByIndex(s).element,a=oe[t];if(!a)return;const o=new CustomEvent("UNDO_REDO_TOOL",{detail:{element:n,oldScalarData:a}});window.dispatchEvent(o),m(t)};return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),o(!a)}},r.createElement(y.Z,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!a})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Undo / Redo Segmentation")),!a&&r.createElement("div",{className:"pl-2 pb-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] pb-[9px]",style:{display:"inline-flex",justifyContent:"space-evenly"}},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{0!==c&&d(c-1)}},"Undo"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{c!==ae&&d(c+1)}},"Redo"))),r.createElement("div",{className:"h-[6px] bg-black "})))}const{Enums:se}=v,{Events:ie}=se,{state:le}=v,ce=["Brush","CircleScissor","PaintFill","RectangleROIStartEndThreshold","RectangleROIThreshold","RectangleScissor","SphereScissor"];function me({segmentationService:e,toolbarService:t,toolGroupService:n,cornerstoneViewportService:a,commandsManager:o}){const[{activeViewportIndex:s,viewports:i},l]=(0,x.O_)(),[c,m]=(0,r.useState)(null),d=()=>{const e=le.toolGroups.filter((e=>"mpr"===e.id))[0]?.toolOptions;e||m(null);const t=Object.keys(e).map((function(t){return[t,e[t]]}));let n=!1;t.forEach((e=>{if(ce.includes(e[0])&&"Active"===e[1].mode)return n=!0,void m(e[0])})),n||m(null)};(0,r.useEffect)((()=>{d()}),[]),(0,r.useEffect)((()=>{const{unsubscribe:e}=t.subscribe(t.EVENTS.TOOL_BAR_STATE_MODIFIED,d);return()=>{e()}}),[t]);return r.createElement("div",null,c&&r.createElement(re,{cornerstoneViewportService:a,segmentationService:e}),(()=>{switch(c){case"Brush":return r.createElement(_,{cornerstoneViewportService:a,segmentationService:e});case"CircleScissor":return r.createElement(P,{cornerstoneViewportService:a,segmentationService:e});case"PaintFill":return r.createElement(F,null);case"RectangleROIStartEndThreshold":return r.createElement(H,{segmentationService:e,cornerstoneViewportService:a,commandsManager:o});case"RectangleROIThreshold":return r.createElement($,{segmentationService:e,cornerstoneViewportService:a,commandsManager:o});case"RectangleScissor":return r.createElement(X,{cornerstoneViewportService:a,segmentationService:e});case"SphereScissor":return r.createElement(ee,{cornerstoneViewportService:a,segmentationService:e});default:return null}})())}var de=n(45546);function pe({segmentationService:e,segmentations:t}){const[n,a]=(0,r.useState)(!1),[{activeViewportIndex:o,viewports:s},i]=(0,x.O_)();return r.createElement("div",{className:"flex flex-col min-h-0 font-inter font-[300]"},r.createElement("div",{className:"bg-primary-dark"},r.createElement("div",{className:"flex cursor-pointer items-center",onClick:e=>{e.stopPropagation(),a(!n)}},r.createElement(x.JO,{name:"panel-group-open-close",className:h()("w-5 h-5 text-white transition duration-300 cursor-pointer",{"transform rotate-90":!n})}),r.createElement("span",{className:"text-[#d8d8d8] text-[12px] font-[300]"},"Segments Configuration I/O")),!n&&r.createElement("div",{className:"pl-2 pb-[9px] pt-[9px]",style:{display:"flex",flexDirection:"column"}},r.createElement("div",{className:"text-[#d8d8d8] text-[12px] font-[300] justify-evenly flex"},r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{console.log("SEGS AT IMPORT",t);const n=document.createElement("input");n.type="file",n.accept="application/json",n.onchange=a=>{const r=Array.from(n.files)[0],i=new FileReader;i.onload=function(n){try{if("string"==typeof n.target.result){for(let n=1;n<t[0].segments.length;n++)e.removeSegment(t[0].id,n);JSON.parse(n.target.result).forEach((n=>{if(n){const{segmentIndex:a}=n;e.addSegment(t[0].id,a,s[o].viewportOptions.toolGroupId,n,!0)}}))}else console.error("ERROR::JSON_READING::CORRUPTED_CONTENT")}catch(e){console.error("ERROR::JSON_READING",e)}},i.readAsText(r)},n.click()}},"Import File"),r.createElement(x.zx,{fullWidth:!0,size:"small",color:"secondary",onClick:()=>{const e=JSON.stringify(t[0].segments),n=new Blob([e],{type:"text/plain;charset=utf-8"});(0,de.saveAs)(n,"segments_configuration.json")}},"Export File"))),r.createElement("div",{className:"h-[6px] bg-black "})))}pe.propTypes={segmentations:f().array.isRequired};const ue=pe;var ge=n(62467),Ee=n.n(ge),fe=n(22148);function xe({segmentationService:e,segmentations:t}){const[n,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)(0);(0,r.useEffect)((()=>{n&&(s(0),setTimeout(i,500))}),[n]);const i=()=>{const n=e.getLabelmapVolume(t[0].id),{dimensions:o,direction:r,scalarData:i}=n,l=t[0].segments,c=l.map(((e,t)=>{if(e)return t})).filter((e=>e)),m=new Uint32Array(i);console.log("START COMPUTING INDEX ARRAY...");const d=new Array(o[2]-1);for(let e=0;e<m.length;e+=o[0]*o[1]){const t=e/(o[0]*o[1]),n=new Uint8ClampedArray(o[0]*o[1]*4).fill(0).map(((e,t)=>(t-3)%4==0?255:e)),a=m.slice(e,e+o[0]*o[1]);Promise.allSettled(c.map((e=>(e=>a.map(((t,n)=>{if(0!==t&&t===e)return n})).filter((e=>0!==e)))(e)))).then((e=>{e.forEach(((e,t)=>{const a=e.value;if(0!==a.length){const e=c[t],o=[...l[e].color,255];a.forEach((e=>{n[4*e]=o[0],n[4*e+1]=o[1],n[4*e+2]=o[2]}))}}));new Promise(((e,a)=>{const r=document.createElement("canvas"),s=r.getContext("2d");r.width=o[0],r.height=o[1];const i=new ImageData(n,o[0],o[1]);s.putImageData(i,0,0),r.toBlob((n=>{n&&(d[t]=n,e())}),"image/png")})).then((()=>{const e=d.filter((e=>e)).length;s(~~(100*e/o[2]))}))}))}new Promise(((e,t)=>{!function t(){if(d.filter((e=>e)).length===o[2])return e();setTimeout(t,500)}()})).then((()=>{const e=new(Ee());d.forEach(((t,n)=>{e.file(`layer_${n}.png`,t)}));const n=JSON.stringify(t[0].segments,null,"\t"),o=new Blob([n],{type:"text/plain;charset=utf-8"});e.file("segmentation_informations.json",o),e.generateAsync({type:"blob"}).then((e=>{(0,de.saveAs)(e,"segmentation.zip"),a(!1)}))}))};return r.createElement("div",{className:"flex flex-col w-full h-74 justify-between"},r.createElement(x.zx,{className:"pt-1/10 pb-1/10 w-full",onClick:()=>{a(!0)}},"Export Segmentation"),n&&r.createElement("div",{className:"w-full mt-[9px]"},r.createElement("p",{style:{color:"white"}},"Processing layers..."),r.createElement(fe.Z,{className:"w-full mt-[3px]",bgColor:o<100?"#5ACCE6":"#50C878",completed:o,transitionDuration:"0.05s",transitionTimingFunction:"linear"})))}xe.propTypes={segmentations:f().array.isRequired};const Se=xe,ve=v.Enums.SegmentationRepresentations.Labelmap;function Ie({servicesManager:e,commandsManager:t}){const[{activeViewportIndex:n,viewports:a},o]=(0,x.O_)(),{segmentationService:s,uiDialogService:i,cornerstoneViewportService:l,toolGroupService:c,toolbarService:m,uiNotificationService:d}=e.services,{t:p}=(0,C.$G)("PanelSegmentation"),[u,g]=(0,r.useState)(null),[E,f]=(0,r.useState)(s.getConfiguration()),[v,I]=(0,r.useState)((()=>s.getSegmentations())),[h,y]=(0,r.useState)({}),N=(0,r.useCallback)((e=>{y((t=>({...t,[e]:!t[e]})))}),[y]);(0,r.useEffect)((()=>{const e=v[v.length-1]?.id;e&&y((t=>({...t,[e]:!1})))}),[v,y]),(0,r.useEffect)((()=>{const e=s.EVENTS.SEGMENTATION_ADDED,t=s.EVENTS.SEGMENTATION_UPDATED,n=s.EVENTS.SEGMENTATION_REMOVED,a=[];return[e,t,n].forEach((e=>{const{unsubscribe:t}=s.subscribe(e,(()=>{const e=s.getSegmentations();I(e),f(s.getConfiguration())}));a.push(t)})),()=>{a.forEach((e=>{e()}))}}),[]);const w=e=>s.getToolGroupIdsWithSegmentation(e),b=(0,r.useCallback)(((e,t,n)=>{s.setConfiguration({segmentationId:e,[t]:n})}),[s]),T=()=>{const e=a.filter((e=>e.viewportIndex===n))[0]?.displaySetInstanceUIDs[0];return v.filter((t=>t.displaySetInstanceUID===e)).length>0};return r.createElement("div",{className:"flex flex-col flex-auto min-h-0F mt-1"},r.createElement(me,{segmentationService:s,cornerstoneViewportService:l,toolGroupService:c,toolbarService:m,commandsManager:t}),T()&&r.createElement(ue,{segmentationService:s,segmentations:v}),T()?r.createElement(x.cX,{title:p("Segmentations"),showAddSegment:!0,segmentations:v,isMinimized:h,activeSegmentationId:u||"",onSegmentationClick:e=>{s.setActiveSegmentationForToolGroup(e)},onSegmentationDelete:e=>{s.remove(e)},onSegmentationEdit:e=>{const t=s.getSegmentation(e),{label:n}=t;S(i,n,((t,n)=>{""!==t&&s.addOrUpdateSegmentation({id:e,label:t},!1,!0)}))},onSegmentClick:(e,t)=>{s.setActiveSegmentForSegmentation(e,t);w(e).forEach((n=>{s.setActiveSegmentationForToolGroup(e,n),s.jumpToSegmentCenter(e,t,n)}))},onSegmentEdit:(e,t)=>{const n=s.getSegmentation(e).segments[t],{label:a}=n;S(i,a,((n,a)=>{""!==n&&s.setSegmentLabelForSegmentation(e,t,n)}))},onSegmentAdd:e=>{const t=s.getSegmentation(e);s.addSegment(e,t.segments.length,a[n].viewportOptions.toolGroupId,{label:`Segmentation ${t.segmentCount+1}`,color:[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],opacity:255,visibility:!0,isLocked:!1,active:!0})},onSegmentColorChange:(e,t,o)=>{s.setSegmentColor(e,t,o,a[n].viewportOptions.toolGroupId)},onSegmentDelete:(e,t)=>{s.removeSegment(e,t)},onToggleSegmentVisibility:(e,t)=>{const n=!s.getSegmentation(e).segments[t].isVisible;w(e).forEach((a=>{s.setSegmentVisibility(e,t,n,a)}))},onToggleSegmentationVisibility:e=>{s.toggleSegmentationVisibility(e)},onToggleMinimizeSegmentation:N,segmentationConfig:{initialConfig:E},setRenderOutline:e=>b(u,"renderOutline",e),setOutlineOpacityActive:e=>b(u,"outlineOpacity",e),setRenderFill:e=>b(u,"renderFill",e),setRenderInactiveSegmentations:e=>b(u,"renderInactiveSegmentations",e),setOutlineWidthActive:e=>b(u,"outlineWidthActive",e),setFillAlpha:e=>b(u,"fillAlpha",e),setFillAlphaInactive:e=>b(u,"fillAlphaInactive",e)}):null,T()?r.createElement(Se,{segmentationService:s,segmentations:v}):0===v.length&&r.createElement(x.zx,{className:"pt-1/10 pb-1/10",onClick:()=>{a.forEach((e=>{if(e.viewportIndex===n){if("volume3d"===e.viewportOptions.viewportType)return void d.show({title:"Create Segmentation",message:"Can't create segmentation in viewport 3D, select a 2D viewport",type:"error"});console.log("SEG VP",e),s.createSegmentationForDisplaySet(e.displaySetInstanceUIDs[0]).then((t=>{const o=s.getSegmentation(t);console.log("CREATED SEGMENTATION",o),s.addSegmentationRepresentationToToolGroup(e.viewportOptions.toolGroupId,t,!0,ve).then((()=>{s.setActiveSegmentationForToolGroup(t,e.viewportOptions.toolGroupId),s.addSegment(t,1,a[n].viewportOptions.toolGroupId,{label:"Segmentation 1",color:[255,0,0],opacity:255,visibility:!0,isLocked:!1,active:!0}),console.log("MTOOLS",m.getButtonSection("MeasurementTools",{})),m.createButtonSection("primary",["MeasurementTools","Zoom","WindowLevel","Pan","Capture","Crosshairs","MoreTools","SegmentationTools"])}))}))}}))}},"Create Segmentation For Selected Viewport"))}Ie.propTypes={commandsManager:f().shape({runCommand:f().func.isRequired}),servicesManager:f().shape({services:f().shape({segmentationService:f().shape({getSegmentation:f().func.isRequired,getSegmentations:f().func.isRequired,toggleSegmentationVisibility:f().func.isRequired,subscribe:f().func.isRequired,EVENTS:f().object.isRequired}).isRequired}).isRequired}).isRequired};const he={id:"@ohif/seg",hasUpdatedPriorsInformation:!1,name:"Segmentations",protocolMatchingRules:[],toolGroupIds:["default"],numberOfPriorsReferenced:0,defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"segDisplaySetId",matchedDisplaySetsIndex:-1}]},displaySetSelectors:{segDisplaySetId:{seriesMatchingRules:[{attribute:"Modality",constraint:{equals:"SEG"}}]}},stages:[{name:"Segmentations",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{allowUnmatchedView:!0},displaySets:[{id:"segDisplaySetId"}]}]}]};const ye=function(){return[{name:he.id,protocol:he}]};function Ne(){return Ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ne.apply(this,arguments)}const we=r.lazy((()=>n.e(569).then(n.bind(n,33569)))),be=e=>r.createElement(r.Suspense,{fallback:r.createElement("div",null,"Loading...")},r.createElement(we,e)),Ce={id:a,getPanelModule:({servicesManager:e,commandsManager:t,extensionManager:n})=>[{name:"panelSegmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:()=>r.createElement(Ie,{commandsManager:t,servicesManager:e,extensionManager:n})}],getViewportModule:({servicesManager:e,extensionManager:t})=>[{name:"dicom-seg",component:n=>r.createElement(be,Ne({servicesManager:e,extensionManager:t},n))}],getSopClassHandlerModule:g,getHangingProtocolModule:ye}},78753:()=>{}}]);
//# sourceMappingURL=497.bundle.db86f087571c1b1acdb5.js.map