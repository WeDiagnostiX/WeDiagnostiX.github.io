"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[604],{97604:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function i(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function u(e){for(var t=new Uint8Array(e.length),r=0,n=e.length;r<n;r++)t[r]=e.charCodeAt(r);return t}function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r+t.length>e.length)return!1;for(var n=r,a=0;a<t.length;a++){if(t[a]!==e[n])return!1;n+=1}return!0}function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,a=e.length;n&&(a=Math.min(r+n,e.length));for(var i=r;i<a;i++)if(e[i]===t[0]&&d(e,t,i))return i;return-1}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"".concat(e()+e(),"-").concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e()).concat(e()).concat(e())}(),r="Content-Type: ".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/dicom"),n="\r\n--".concat(t,"\r\n").concat(r,"\r\n\r\n"),a="\r\n--".concat(t,"--"),i=u(n),s=u(a),o=i.length,c=s.length,d=0,p=e.map((function(e){var t=new Uint8Array(e),r=t.length;return d+=o+r,t}));d+=c;var f=new Uint8Array(d);f.set(i,0);var l=0;return p.forEach((function(e){f.set(i,l),f.set(e,l+o),l+=o+e.length})),f.set(s,l),{data:f.buffer,boundary:t}}function l(e){var t=ArrayBuffer.isView(e)?e:new Uint8Array(e),r=u("\r\n\r\n"),n=p(t,r,0,1e3);if(-1===n)throw new Error("Response message has no multipart mime header");var a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(arguments.length>2?arguments[2]:void 0)||e.length-t,n="",a=t;a<t+r;a++)n+=String.fromCharCode(e[a]);return n}(t,0,n),i=function(e){for(var t=e.split("\r\n"),r=0;r<t.length;r++)if("--"===t[r].substr(0,2))return t[r];return null}(a);if(!i)throw new Error("Header of response message does not specify boundary");for(var s,o=u(i),c=o.length,d=[],f=c;-1!==s&&-1!==(s=p(t,o,f));){var l=p(t,r,f,1e3);if(-1===l)throw new Error("Response message part has no mime header");f=l+r.length;var h=e.slice(f,s-2);d.push(h),f=s+c}return d}function h(e){return"object"===n(e)&&null!==e}function y(e){return 0===Object.keys(e).length&&e.constructor===Object}r.d(t,{api:()=>w});var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{instance:e.instance||new XMLHttpRequest,progressCallback:e.progressCallback||!1,withCredentials:e.withCredentials||!1,responseType:e.responseType}},v=function(e){return e[0]},I={DICOM:"application/dicom",DICOM_JSON:"application/dicom+json",OCTET_STREAM:"application/octet-stream",PDF:"application/pdf",JPEG:"image/jpeg",PNG:"image/png"},g=function(){};var w={DICOMwebClient:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseURL=t.url,this.baseURL||console.error("no DICOMweb base url provided - calls that require a URL will fail"),"username"in t&&(this.username=t.username,"password"in t||console.error("no password provided to authenticate with DICOMweb service"),this.password=t.password),"qidoURLPrefix"in t?(g("use URL prefix for QIDO-RS: ".concat(t.qidoURLPrefix)),this.qidoURL="".concat(this.baseURL,"/").concat(t.qidoURLPrefix)):this.qidoURL=this.baseURL,"wadoURLPrefix"in t?(g("use URL prefix for WADO-RS: ".concat(t.wadoURLPrefix)),this.wadoURL="".concat(this.baseURL,"/").concat(t.wadoURLPrefix)):this.wadoURL=this.baseURL,"stowURLPrefix"in t?(g("use URL prefix for STOW-RS: ".concat(t.stowURLPrefix)),this.stowURL="".concat(this.baseURL,"/").concat(t.stowURLPrefix)):this.stowURL=this.baseURL,t.singlepart?(g("use singlepart",t.singlepart),this.singlepart=!0===t.singlepart?"bulkdata,video,image":t.singlepart):this.singlepart="","requestHooks"in t&&(this.requestHooks=t.requestHooks),this.headers=t.headers||{},this.errorInterceptor=t.errorInterceptor||function(){},this.verbose=!1!==t.verbose,this.setDebug(t.debug)}var t,r,o;return t=e,r=[{key:"setDebug",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.debugLevel=!!e,g=t||e?console.log:function(){}}},{key:"getDebug",value:function(){return this.debugLevel}},{key:"setVerbose",value:function(e){this.verbose=e}},{key:"getVerbose",value:function(){return this.verbose}},{key:"_httpRequest",value:function(e,t){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this.errorInterceptor,o=this.requestHooks;return new Promise((function(c,u){var d=i.instance?i.instance:new XMLHttpRequest;d.open(t,e,!0),"responseType"in i&&(d.responseType=i.responseType),"object"===n(a)&&Object.keys(a).forEach((function(e){d.setRequestHeader(e,a[e])}));var p,f=r.headers;if(Object.keys(f).forEach((function(e){d.setRequestHeader(e,f[e])})),d.onloadstart=function(){g("upload started: ",e)},d.onloadend=function(){g("upload finished")},d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var e=d.getResponseHeader("Content-Type");e&&-1!==e.indexOf("multipart")?c(l(d.response)):"arraybuffer"===d.responseType?c([d.response]):c(d.response)}else if(202===d.status)r.verbose&&console.warn("some resources already existed: ",d),c(d.response);else if(204===d.status)r.verbose&&console.warn("empty response for request: ",d),c([]);else{var t=new Error("request failed");t.request=d,t.response=d.response,t.status=d.status,r.verbose&&(console.error("request failed: ",d),console.error(t),console.error(t.response)),s(t),u(t)}},"progressCallback"in i&&"function"==typeof i.progressCallback&&(d.onprogress=i.progressCallback),o&&function(e){var t=Array.isArray(e)&&e.every((function(e){return"function"==typeof e&&2===e.length}));return t||console.warn("Request hooks should have the following signature: function requestHook(request, metadata) { return request; }"),t}(o)){var h=Object.assign({},a,r.headers),y={method:t,url:e,headers:h},m=(p=o,function(e){return p.reduce((function(e,t){return t(e,y)}),e)});d=m(d)}"withCredentials"in i&&i.withCredentials&&(d.withCredentials=!0),"data"in i?d.send(i.data):d.send()}))}},{key:"_httpGet",value:function(e,t,r){return this._httpRequest(e,"get",t,r)}},{key:"_httpGetApplicationJson",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t;"object"===n(r)&&(y(r)||(i+=e._parseQueryParameters(r)));var s={Accept:I.DICOM_JSON};return a.responseType="json",this._httpGet(i,s,a)}},{key:"_httpGetApplicationPdf",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t;"object"===n(r)&&(y(r)||(i+=e._parseQueryParameters(r)));var s={Accept:I.PDF};return a.responseType="json",this._httpGet(i,s,a)}},{key:"_httpGetImage",value:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=t;"object"===n(a)&&(y(a)||(s+=e._parseQueryParameters(a)));var o={Accept:e._buildAcceptHeaderFieldValue(r,["image/","image/*","image/jpeg","image/jp2","image/gif","image/png"])};return i.responseType="arraybuffer",this._httpGet(s,o,i)}},{key:"_httpGetText",value:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=t;"object"===n(a)&&(y(a)||(s+=e._parseQueryParameters(a)));var o={Accept:e._buildAcceptHeaderFieldValue(r,["text/","text/*","text/html","text/plain","text/rtf","text/xml"])};return i.responseType="arraybuffer",this._httpGet(s,o,i)}},{key:"_httpGetVideo",value:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=t;"object"===n(a)&&(y(a)||(s+=e._parseQueryParameters(a)));var o={Accept:e._buildAcceptHeaderFieldValue(r,["video/","video/*","video/mpeg","video/mp4","video/H265"])};return i.responseType="arraybuffer",this._httpGet(s,o,i)}},{key:"_httpGetMultipartImage",value:function(t,r,n,a){var i,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o={};return arguments.length>4&&void 0!==arguments[4]&&arguments[4]?i=["image/jpeg","image/gif","image/png","image/jp2"]:(i={"1.2.840.10008.1.2.5":["image/x-dicom-rle"],"1.2.840.10008.1.2.4.50":["image/jpeg"],"1.2.840.10008.1.2.4.51":["image/jpeg"],"1.2.840.10008.1.2.4.57":["image/jpeg"],"1.2.840.10008.1.2.4.70":["image/jpeg"],"1.2.840.10008.1.2.4.80":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.81":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.90":["image/jp2"],"1.2.840.10008.1.2.4.91":["image/jp2"],"1.2.840.10008.1.2.4.92":["image/jpx"],"1.2.840.10008.1.2.4.93":["image/jpx"]},n&&(o.Range=e._buildRangeHeaderFieldValue(n))),o.Accept=e._buildMultipartAcceptHeaderFieldValue(r,i),s.responseType="arraybuffer",this._httpGet(t,o,s)}},{key:"_httpGetMultipartVideo",value:function(t,r,n,a){var i,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o={};return arguments.length>4&&void 0!==arguments[4]&&arguments[4]?i=["video/","video/*","video/mpeg2","video/mp4","video/H265"]:(i={"1.2.840.10008.1.2.4.100":["video/mpeg2"],"1.2.840.10008.1.2.4.101":["video/mpeg2"],"1.2.840.10008.1.2.4.102":["video/mp4"],"1.2.840.10008.1.2.4.103":["video/mp4"],"1.2.840.10008.1.2.4.104":["video/mp4"],"1.2.840.10008.1.2.4.105":["video/mp4"],"1.2.840.10008.1.2.4.106":["video/mp4"]},n&&(o.Range=e._buildRangeHeaderFieldValue(n))),o.Accept=e._buildMultipartAcceptHeaderFieldValue(r,i),s.responseType="arraybuffer",this._httpGet(t,o,s)}},{key:"_httpGetMultipartApplicationDicom",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={},s="application/dicom",o={"1.2.840.10008.1.2.1":[s],"1.2.840.10008.1.2.5":[s],"1.2.840.10008.1.2.4.50":[s],"1.2.840.10008.1.2.4.51":[s],"1.2.840.10008.1.2.4.57":[s],"1.2.840.10008.1.2.4.70":[s],"1.2.840.10008.1.2.4.80":[s],"1.2.840.10008.1.2.4.81":[s],"1.2.840.10008.1.2.4.90":[s],"1.2.840.10008.1.2.4.91":[s],"1.2.840.10008.1.2.4.92":[s],"1.2.840.10008.1.2.4.93":[s],"1.2.840.10008.1.2.4.100":[s],"1.2.840.10008.1.2.4.101":[s],"1.2.840.10008.1.2.4.102":[s],"1.2.840.10008.1.2.4.103":[s],"1.2.840.10008.1.2.4.104":[s],"1.2.840.10008.1.2.4.105":[s],"1.2.840.10008.1.2.4.106":[s]},c=r;return r||(c=[{mediaType:s}]),i.Accept=e._buildMultipartAcceptHeaderFieldValue(c,o),a.responseType="arraybuffer",this._httpGet(t,i,a)}},{key:"_httpGetMultipartApplicationOctetStream",value:function(t,r,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={},c={"1.2.840.10008.1.2.1":s(Object.values(I))},u=r;return r||(u=[{mediaType:"application/octet-stream"}]),n&&(o.Range=e._buildRangeHeaderFieldValue(n)),o.Accept=e._buildMultipartAcceptHeaderFieldValue(u,c),i.responseType="arraybuffer",this._httpGet(t,o,i)}},{key:"_httpPost",value:function(e,t,r,n){return this._httpRequest(e,"post",t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach((function(t){i(e,t,r[t])}))}return e}({},n,{data:r}))}},{key:"_httpPostApplicationJson",value:function(e,t,r){var n={"Content-Type":I.DICOM_JSON};return this._httpPost(e,n,t,r)}},{key:"searchForStudies",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g("search for studies");var r="".concat(this.qidoURL,"/studies");"queryParams"in t&&(r+=e._parseQueryParameters(t.queryParams));var n=m(t.request);return this._httpGetApplicationJson(r,{},n)}},{key:"retrieveStudyMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of study metadata");g("retrieve metadata of study ".concat(e.studyInstanceUID));var t="".concat(this.wadoURL,"/studies/").concat(e.studyInstanceUID,"/metadata"),r=m(e.request);return this._httpGetApplicationJson(t,{},r)}},{key:"searchForSeries",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.qidoURL;"studyInstanceUID"in t&&(g("search series of study ".concat(t.studyInstanceUID)),r+="/studies/".concat(t.studyInstanceUID)),r+="/series","queryParams"in t&&(r+=e._parseQueryParameters(t.queryParams));var n=m(t.request);return this._httpGetApplicationJson(r,{},n)}},{key:"retrieveSeriesMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of series metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of series metadata");g("retrieve metadata of series ".concat(e.seriesInstanceUID));var t="".concat(this.wadoURL,"/studies/").concat(e.studyInstanceUID,"/series/").concat(e.seriesInstanceUID,"/metadata");return m(e.request),this._httpGetApplicationJson(t,{},!1,withCredentials)}},{key:"searchForInstances",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.qidoURL;"studyInstanceUID"in t?(r+="/studies/".concat(t.studyInstanceUID),"seriesInstanceUID"in t?(g("search for instances of series ".concat(t.seriesInstanceUID)),r+="/series/".concat(t.seriesInstanceUID)):g("search for instances of study ".concat(t.studyInstanceUID))):g("search for instances"),r+="/instances","queryParams"in t&&(r+=e._parseQueryParameters(t.queryParams));var n=m(t.request);return this._httpGetApplicationJson(r,{},n)}},{key:"buildInstanceWadoURIUrl",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required.");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required.");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required.");var t=e.contentType||I.DICOM,r=e.transferSyntax||"*",n=[];n.push("requestType=WADO"),n.push("studyUID=".concat(e.studyInstanceUID)),n.push("seriesUID=".concat(e.seriesInstanceUID)),n.push("objectUID=".concat(e.sopInstanceUID)),n.push("contentType=".concat(t)),n.push("transferSyntax=".concat(r));var a=n.join("&");return"".concat(this.wadoURL,"?").concat(a)}},{key:"retrieveInstanceMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of instance metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of instance metadata");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required for retrieval of instance metadata");g("retrieve metadata of instance ".concat(e.sopInstanceUID));var t="".concat(this.wadoURL,"/studies/").concat(e.studyInstanceUID,"/series/").concat(e.seriesInstanceUID,"/instances/").concat(e.sopInstanceUID,"/metadata"),r=m(e.request);return this._httpGetApplicationJson(t,{},r)}},{key:"retrieveInstanceFrames",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of instance frames");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of instance frames");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of instance frames");if(!("frameNumbers"in t))throw new Error("frame numbers are required for retrieval of instance frames");g("retrieve frames ".concat(t.frameNumbers.toString()," of instance ").concat(t.sopInstanceUID));var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/frames/").concat(t.frameNumbers.toString()),n=t.mediaTypes,a=m(t.request);if(!n)return this._httpGetMultipartApplicationOctetStream(r,!1,!1,!1,a);if(e._getSharedMediaTypes(n).length>1){var i={Accept:e._buildMultipartAcceptHeaderFieldValue(n,{"1.2.840.10008.1.2.1":["application/octet-stream"],"1.2.840.10008.1.2.5":["image/x-dicom-rle"],"1.2.840.10008.1.2.4.50":["image/jpeg"],"1.2.840.10008.1.2.4.51":["image/jpeg"],"1.2.840.10008.1.2.4.57":["image/jpeg"],"1.2.840.10008.1.2.4.70":["image/jpeg"],"1.2.840.10008.1.2.4.80":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.81":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.90":["image/jp2"],"1.2.840.10008.1.2.4.91":["image/jp2"],"1.2.840.10008.1.2.4.92":["image/jpx"],"1.2.840.10008.1.2.4.93":["image/jpx"],"1.2.840.10008.1.2.4.201":["image/jhc"],"1.2.840.10008.1.2.4.202":["image/jhc"]})};return a.responseType="arraybuffer",this._httpGet(r,i,a)}var s=e._getCommonMediaType(n);if(s.startsWith("application"))return this._httpGetMultipartApplicationOctetStream(r,n,!1,!1,a);if(s.startsWith("image"))return this._httpGetMultipartImage(r,n,!1,!1,!1,a);if(s.startsWith("video"))return this._httpGetMultipartVideo(r,n,!1,!1,!1,a);throw new Error("Media type ".concat(s," is not supported for retrieval of frames."))}},{key:"retrieveInstanceRendered",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance");var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/rendered"),n=t.mediaTypes,a=t.queryParams,i=m(t.request);if(!n)return i.responseType="arraybuffer",a&&(r+=e._parseQueryParameters(a)),this._httpGet(r,{},i);var s=e._getCommonMediaType(n);if(s.startsWith("image"))return this._httpGetImage(r,n,a,i);if(s.startsWith("video"))return this._httpGetVideo(r,n,a,i);if(s.startsWith("text"))return this._httpGetText(r,n,a,i);if(s===I.PDF)return this._httpGetApplicationPdf(r,a,i);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered instance.")}},{key:"retrieveInstanceThumbnail",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance");var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/thumbnail"),n=t.mediaTypes,a=t.queryParams,i=m(t.request);if(!n)return i.responseType="arraybuffer",a&&(r+=e._parseQueryParameters(a)),this._httpGet(r,{},i);var s=e._getCommonMediaType(n);if(s.startsWith("image"))return this._httpGetImage(r,n,a,i);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered instance.")}},{key:"retrieveInstanceFramesRendered",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance frames");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance frames");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance frames");if(!("frameNumbers"in t))throw new Error("frame numbers are required for retrieval of rendered instance frames");g("retrieve rendered frames ".concat(t.frameNumbers.toString()," of instance ").concat(t.sopInstanceUID));var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/frames/").concat(t.frameNumbers.toString(),"/rendered"),n=t.mediaTypes,a=t.queryParams,i=m(t.request);if(!n)return a&&(i.responseType="arraybuffer",r+=e._parseQueryParameters(a)),this._httpGet(r,{},i);var s=e._getCommonMediaType(n);if(s.startsWith("image"))return this._httpGetImage(r,n,a,i);if(s.startsWith("video"))return this._httpGetVideo(r,n,a,i);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered frame.")}},{key:"retrieveInstanceFramesThumbnail",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance frames");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance frames");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance frames");if(!("frameNumbers"in t))throw new Error("frame numbers are required for retrieval of rendered instance frames");console.debug("retrieve rendered frames ".concat(t.frameNumbers.toString()," of instance ").concat(t.sopInstanceUID));var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/frames/").concat(t.frameNumbers.toString(),"/thumbnail"),n=t.mediaTypes,a=t.queryParams,i=m(t.request);if(!n)return i.responseType="arraybuffer",a&&(r+=e._parseQueryParameters(a)),this._httpGet(r,{},i);var s=e._getCommonMediaType(n);if(s.startsWith("image"))return this._httpGetImage(r,n,a,i);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered frame.")}},{key:"retrieveInstance",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required");var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID),n=t.mediaTypes,a=m(t.request);if(!n)return this._httpGetMultipartApplicationDicom(r,!1,!1,a).then(v);var i=e._getCommonMediaType(n);if(i===I.DICOM)return this._httpGetMultipartApplicationDicom(r,n,!1,a).then(v);throw new Error("Media type ".concat(i," is not supported for retrieval of instance."))}},{key:"retrieveSeries",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required");var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID),n=t.mediaTypes,a=m(t.request);if(!n)return this._httpGetMultipartApplicationDicom(r,!1,!1,a);var i=e._getCommonMediaType(n);if(i===I.DICOM)return this._httpGetMultipartApplicationDicom(r,n,!1,a);throw new Error("Media type ".concat(i," is not supported for retrieval of series."))}},{key:"retrieveStudy",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required");var r="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID),n=t.mediaTypes,a=m(t.request);if(!n)return this._httpGetMultipartApplicationDicom(r,!1,!1,a);var i=e._getCommonMediaType(n);if(i===I.DICOM)return this._httpGetMultipartApplicationDicom(r,n,!1,a);throw new Error("Media type ".concat(i," is not supported for retrieval of study."))}},{key:"retrieveBulkData",value:function(t){if(!("BulkDataURI"in t))throw new Error("BulkDataURI is required.");var r=t.BulkDataURI,n=t.mediaTypes,a=t.byteRange,i=m(t.request);if(-1!==this.singlepart.indexOf("bulkdata"))return i.responseType="arraybuffer",this._httpGet(r,t.headers,i);if(n)try{if("image/"===e._getCommonMediaType(n))return this._httpGetMultipartImage(r,n,a,!1,!1,progressCallback,withCredentials)}catch(e){}return this._httpGetMultipartApplicationOctetStream(r,n,a,!1,i)}},{key:"storeInstances",value:function(e){if(!("datasets"in e))throw new Error("datasets are required for storing");var t="".concat(this.stowURL,"/studies");"studyInstanceUID"in e&&(t+="/".concat(e.studyInstanceUID));var r=f(e.datasets),n=r.data,a=r.boundary,i={"Content-Type":'multipart/related; type="application/dicom"; boundary="'.concat(a,'"')},s=m(e.request);return this._httpPost(t,i,n,s)}}],o=[{key:"_parseQueryParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="?";return Object.keys(e).forEach((function(r,n){0!==n&&(t+="&"),t+="".concat(r,"=").concat(encodeURIComponent(e[r]))})),t}},{key:"_assertMediaTypeIsValid",value:function(e){if(!e)throw new Error("Not a valid media type: ".concat(e));var t=e.indexOf("/");if(-1===t)throw new Error("Not a valid media type: ".concat(e));var r=e.slice(0,t);if(!["application","image","text","video"].includes(r))throw new Error("Not a valid media type: ".concat(e));if(e.slice(t+1).includes("/"))throw new Error("Not a valid media type: ".concat(e))}},{key:"_parseMediaType",value:function(t){return e._assertMediaTypeIsValid(t),t.split("/")}},{key:"_buildAcceptHeaderFieldValue",value:function(t,r){if(!Array.isArray(t))throw new Error("Acceptable media types must be provided as an Array");return t.map((function(t){var n=t.mediaType;if(e._assertMediaTypeIsValid(n),!r.includes(n))throw new Error("Media type ".concat(n," is not supported for requested resource"));return n})).join(", ")}},{key:"_buildMultipartAcceptHeaderFieldValue",value:function(t,r){var n=this;if(!Array.isArray(t))throw new Error("Acceptable media types must be provided as an Array");if(!Array.isArray(r)&&!h(r))throw new Error("Supported media types must be provided as an Array or an Object");var a=[];if(t.forEach((function(t){var i=t.transferSyntaxUID,s=t.mediaType;e._assertMediaTypeIsValid(s);var o='multipart/related; type="'.concat(s,'"');if(h(r)){if(!(Object.values(r).flat(1).includes(s)||s.endsWith("/*")&&s.endsWith("/")))return void g("Media type ".concat(s," is not supported for requested resource"));if(i){if("*"!==i){if(!Object.keys(r).includes(i))throw new Error("Transfer syntax ".concat(i," is not supported for requested resource"));var c=r[i];if(!c.includes(s)){var u=e._parseMediaType(s)[0];c.map((function(t){var r=e._parseMediaType(t)[0];if(u!==r||!s.endsWith("/*")&&!s.endsWith("/"))throw new Error("Transfer syntax ".concat(i," is not supported for requested resource"))}))}}o+="; transfer-syntax=".concat(i)}}else if(Array.isArray(r)&&!r.includes(s))return void(n.verbose&&console.warn("Media type ".concat(s," is not supported for requested resource")));a.push(o)})),!a.length)throw new Error("No acceptable media types found among ".concat(JSON.stringify(t)));return a.join(", ")}},{key:"_buildRangeHeaderFieldValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return 1===e.length?"bytes=".concat(e[0],"-"):2===e.length?"bytes=".concat(e[0],"-").concat(e[1]):"bytes=0-"}},{key:"_getSharedMediaTypes",value:function(t){var r=new Set;return t&&t.length?(t.forEach((function(t){var n=t.mediaType,a=e._parseMediaType(n)[0];r.add("".concat(a,"/"))})),Array.from(r)):r}},{key:"_getCommonMediaType",value:function(t){if(!t||!t.length)throw new Error("No acceptable media types provided");var r=e._getSharedMediaTypes(t);if(0===r.length)throw new Error("No common acceptable media type could be identified.");if(r.length>1)throw new Error("Acceptable media types must have the same type.");return r[0]}}],r&&a(t.prototype,r),o&&a(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}}]);
//# sourceMappingURL=604.bundle.80ea1ab0264c20b7e545.js.map