"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[4438,2591,4182,1801],{23121:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(86326),s=n(97598),a=n.n(s),i=n(93213);const o=0,l=5;const c=function({servicesManager:e,rtDisplaySet:t,viewportId:n,preHydrateCallbacks:r,hydrateRTDisplaySet:s}){const{uiViewportDialogService:a}=e.services,c=e._extensionManager._appConfig;return new Promise(async function(p,u){const d=c?.disableConfirmationPrompts?l:await function(e,t){return new Promise(function(n,r){const s="Do you want to open this Segmentation?",a=[{id:"no-hydrate",type:i.Ny.NW.secondary,text:"No",value:o},{id:"yes-hydrate",type:i.Ny.NW.primary,text:"Yes",value:l}],c=t=>{e.hide(),n(t)};e.show({id:"promptHydrateRT",viewportId:t,type:"info",message:s,actions:a,onSubmit:c,onOutsideClick:()=>{e.hide(),n(o)},onKeyPress:e=>{"Enter"===e.key&&c(l)}})})}(a,n);if(d===l){r?.forEach(e=>{e()});p(await s({rtDisplaySet:t,viewportId:n,servicesManager:e}))}})};var p=n(99993);function u({isHydrated:e,onStatusClick:t}){let n=null,s=null;switch(e){case!0:s=()=>r.createElement(i.In,{name:"status-alert"}),n=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:s=()=>r.createElement(i.In,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>r.createElement("div",null,"Click LOAD to load RTSTRUCT.")}const a=()=>{const{t:n}=(0,p.Bd)("Common"),a=n("LOAD");return r.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},r.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},r.createElement(s,null),r.createElement("span",{className:"ml-1"},"RTSTRUCT")),!e&&r.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},a))};return r.createElement(r.Fragment,null,n&&r.createElement(i.m_,{content:r.createElement(n,null),position:"bottom-left"},r.createElement(a,null)),!n&&r.createElement(a,null))}const d=function(e,t,n){const{tools:r}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,r)};var m=n(90285);function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},S.apply(null,arguments)}function y(e){const{children:t,displaySets:n,viewportOptions:s,servicesManager:a,extensionManager:o,commandsManager:l}=e,{displaySetService:p,toolGroupService:y,segmentationService:v,uiNotificationService:g,customizationService:I,viewportActionCornersService:w}=a.services,f=s.viewportId,E=`RTToolGroup-${f}`;if(n.length>1)throw new Error("RT viewport should only have a single display set");const h=n[0],[b,T]=(0,i.ih)(),[D,C]=(0,r.useState)(1),{setPositionPresentation:N}=(0,m.usePositionPresentationStore)(),[k,P]=(0,r.useState)(h.isHydrated),[O,x]=(0,r.useState)(!h.isLoaded),[M,R]=(0,r.useState)(null),[A,U]=(0,r.useState)({percentComplete:null,totalSegments:null}),L=(0,r.useRef)(null),{viewports:G,activeViewportId:_}=b,V=h.referencedDisplaySetInstanceUID,H=p.getDisplaySetByUID(V),j=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(H);L.current={displaySet:H,metadata:j};const B=()=>{R(null)},F=(0,r.useCallback)(()=>{b?.viewports.forEach(({viewportId:e})=>{l.runCommand("storePresentation",{viewportId:e})})},[b]),q=(0,r.useCallback)(({rtDisplaySet:e,viewportId:t})=>{l.runCommand("hydrateRTSDisplaySet",{displaySet:e,viewportId:t})},[l]),W=(0,r.useCallback)(()=>{const{component:t}=o.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=L.current;return r.createElement(t,S({},e,{displaySets:[n,h],viewportOptions:{viewportType:"stack",toolGroupId:E,orientation:s.orientation,viewportId:s.viewportId,presentationIds:s.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{R(e.detail.element)})(t)},onElementDisabled:B}))},[f,h,E]),Y=(0,r.useCallback)(e=>{const t=h.displaySetInstanceUID,n=v.getSegmentation(t),{segments:r}=n,s=Object.keys(r).length;let a=D+e;a>=s-1?a=1:0===a&&(a=s-1),v.jumpToSegmentCenter(t,a,f),C(a)},[D,v]);(0,r.useEffect)(()=>{O||c({servicesManager:a,viewportId:f,rtDisplaySet:h,preHydrateCallbacks:[F],hydrateRTDisplaySet:q}).then(e=>{e&&P(!0)})},[a,f,h,O]),(0,r.useEffect)(()=>{const{unsubscribe:e}=v.subscribe(v.EVENTS.SEGMENTATION_LOADING_COMPLETE,e=>{if(e.rtDisplaySet.displaySetInstanceUID===h.displaySetInstanceUID&&x(!1),h?.firstSegmentedSliceImageId&&s?.presentationIds){const{firstSegmentedSliceImageId:e}=h,{presentationIds:t}=s;N(t.positionPresentationId,{viewportType:"stack",viewReference:{referencedImageId:e},viewPresentation:{}})}e.overlappingSegments&&g.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})});return()=>{e()}},[h]),(0,r.useEffect)(()=>{const{unsubscribe:e}=v.subscribe(v.EVENTS.SEGMENT_LOADING_COMPLETE,({percentComplete:e,numSegments:t})=>{U({percentComplete:e,totalSegments:t})});return()=>{e()}},[h]),(0,r.useEffect)(()=>{const e=p.subscribe(p.EVENTS.DISPLAY_SETS_REMOVED,({displaySetInstanceUIDs:e})=>{const t=G.get(_);e.includes(t.displaySetInstanceUID)&&T.setDisplaySetsForViewport({viewportId:_,displaySetInstanceUIDs:[]})});return()=>{e.unsubscribe()}},[]),(0,r.useEffect)(()=>{let e=y.getToolGroup(E);if(!e)return e=d(y,I,E),()=>{v.removeSegmentationRepresentations(f),y.destroyToolGroup(E)}},[]),(0,r.useEffect)(()=>(P(h.isHydrated),()=>{v.removeSegmentationRepresentations(f),L.current=null}),[h]);const $=(0,r.useCallback)(async()=>{F();const e=await q({rtDisplaySet:h,viewportId:f});P(e)},[q,h,F,f]);let z=null;return L.current&&H.displaySetInstanceUID===L.current.displaySet.displaySetInstanceUID?(t&&t.length&&(z=t.map((e,t)=>e&&r.cloneElement(e,{viewportId:f,key:t}))),(0,r.useEffect)(()=>{w.addComponents([{viewportId:f,id:"viewportStatusComponent",component:u({isHydrated:k,onStatusClick:$}),indexPriority:-100,location:w.LOCATIONS.topLeft},{viewportId:f,id:"viewportActionArrowsComponent",component:r.createElement(i.$I,{key:"actionArrows",onArrowsClick:Y,className:f===_?"visible":"invisible group-hover/pane:visible"}),indexPriority:0,location:w.LOCATIONS.topRight}])},[_,k,Y,$,w,f]),r.createElement(r.Fragment,null,r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},O&&r.createElement(i.pT,{className:"h-full w-full",totalNumbers:A.totalSegments,percentComplete:A.percentComplete,loadingText:"Loading RTSTRUCT..."}),W(),z))):null}y.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node};const v=y}}]);
//# sourceMappingURL=4438.bundle.f4028e075404f3453706.js.map