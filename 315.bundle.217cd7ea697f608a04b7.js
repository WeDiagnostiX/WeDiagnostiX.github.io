"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[315],{88315:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(3827),a=n.n(r),s=n(43001),o=n(69190),i=n(49023);const l=function(e,t,n){const{tools:r}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,r)},c=0,u=5;const p=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:r,hydrateSEGDisplaySet:a}){const{uiViewportDialogService:s}=e.services,o=e._extensionManager._appConfig;return new Promise((async function(e,l){const p=o?.disableConfirmationPrompts?u:await function(e,t){return new Promise((function(n,r){const a="Do you want to open this Segmentation?",s=[{id:"no-hydrate",type:i.LZ.dt.secondary,text:"No",value:c},{id:"yes-hydrate",type:i.LZ.dt.primary,text:"Yes",value:u}],o=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:a,actions:s,onSubmit:o,onOutsideClick:()=>{e.hide(),n(c)},onKeyPress:e=>{"Enter"===e.key&&o(u)}})}))}(s,n);p===u&&(r?.forEach((e=>{e()})),window.setTimeout((async()=>{const r=await a({segDisplaySet:t,viewportId:n});e(r)}),0))}))};function d({isHydrated:e,onStatusClick:t}){let n=null,r=null;switch(e){case!0:r=()=>s.createElement(i.JO,{name:"status-alert"}),n=()=>s.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:r=()=>s.createElement(i.JO,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>s.createElement("div",null,"Click LOAD to load segmentation.")}const a=()=>{const{t:n}=(0,o.$G)("Common"),a=n("LOAD");return s.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},s.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},s.createElement(r,null),s.createElement("span",{className:"ml-1"},"SEG")),!e&&s.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},a))};return s.createElement(s.Fragment,null,n&&s.createElement(i.u,{content:s.createElement(n,null),position:"bottom-left"},s.createElement(a,null)),!n&&s.createElement(a,null))}function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(null,arguments)}function S(e){const{children:t,displaySets:n,viewportOptions:r,servicesManager:a,extensionManager:c,commandsManager:u}=e,{t:S}=(0,o.$G)("SEGViewport"),y=r.viewportId,{displaySetService:g,toolGroupService:v,segmentationService:w,customizationService:E,viewportActionCornersService:f}=a.services,I=`SEGToolGroup-${y}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const b=n[0],[h,D]=(0,i.O_)(),[C,T]=(0,s.useState)(1),[k,N]=(0,s.useState)(b.isHydrated),[P,x]=(0,s.useState)(!b.isLoaded),[G,O]=(0,s.useState)(null),[A,M]=(0,s.useState)({percentComplete:null,totalSegments:null}),L=(0,s.useRef)(null),{viewports:U,activeViewportId:V}=h,_=b.getReferenceDisplaySet(),F=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,r=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:a}=r,s=Array.isArray(a)?a[0]:a,{SpacingBetweenSlices:o,SliceThickness:i}=s,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||i,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||o};return c}(_,b);L.current={displaySet:_,metadata:F};const R=()=>{O(null)},j=(0,s.useCallback)((()=>{h?.viewports.forEach((({viewportId:e})=>{u.runCommand("storePresentation",{viewportId:e})}))}),[h]),H=(0,s.useCallback)((()=>{const{component:t}=c.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=L.current;return s.createElement(t,m({},e,{displaySets:[n,b],viewportOptions:{viewportType:"volume",toolGroupId:I,orientation:r.orientation,viewportId:r.viewportId},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{O(e.detail.element)})(t)},onElementDisabled:R}))}),[y,b,I]),q=(0,s.useCallback)((e=>{const t=b.displaySetInstanceUID,n=w.getSegmentation(t),{segments:r}=n,a=Object.keys(r).length;let s=C+e;s>a-1?s=1:0===s&&(s=a-1),w.jumpToSegmentCenter(t,s,I),T(s)}),[C]);(0,s.useEffect)((()=>{P||p({servicesManager:a,viewportId:y,segDisplaySet:b,preHydrateCallbacks:[j],hydrateSEGDisplaySet:B}).then((e=>{e&&N(!0)}))}),[a,y,b,P]),(0,s.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===b.displaySetInstanceUID&&x(!1)}));return()=>{e()}}),[b]),(0,s.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{M({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[b]),(0,s.useEffect)((()=>{const e=g.subscribe(g.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=U.get(V);e.includes(t.displaySetInstanceUID)&&D.setDisplaySetsForViewport({viewportId:V,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,s.useEffect)((()=>{let e=v.getToolGroup(I);if(!e)return e=l(v,E,I),()=>{w.removeSegmentationRepresentationFromToolGroup(I),v.destroyToolGroup(I)}}),[]),(0,s.useEffect)((()=>(N(b.isHydrated),()=>{w.removeSegmentationRepresentationFromToolGroup(I),L.current=null})),[b]);const B=(0,s.useCallback)((({segDisplaySet:e,viewportId:t})=>{u.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})}),[u]),$=(0,s.useCallback)((async()=>{j();const e=await B({segDisplaySet:b,viewportId:y});N(e)}),[B,b,j,y]);(0,s.useEffect)((()=>{f.setComponents([{viewportId:y,id:"viewportStatusComponent",component:d({isHydrated:k,onStatusClick:$}),indexPriority:-100,location:f.LOCATIONS.topLeft},{viewportId:y,id:"viewportActionArrowsComponent",component:s.createElement(i.PG,{key:"actionArrows",onArrowsClick:q,className:y===V?"visible":"invisible group-hover:visible"}),indexPriority:0,location:f.LOCATIONS.topRight}])}),[V,k,q,$,f,y]);let J=null;if(!L.current||_.displaySetInstanceUID!==L.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(J=t.map(((e,t)=>e&&s.cloneElement(e,{viewportId:y,key:t}))));const{PatientID:Y,PatientName:Z,PatientSex:z,PatientAge:K,SliceThickness:Q,ManufacturerModelName:W,StudyDate:X,SeriesDescription:ee,SpacingBetweenSlices:te}=L.current.metadata;return s.createElement(s.Fragment,null,s.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},P&&s.createElement(i.bk,{className:"h-full w-full",totalNumbers:A.totalSegments,percentComplete:A.percentComplete,loadingText:"Loading SEG..."}),H(),J))}S.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node};const y=S}}]);
//# sourceMappingURL=315.bundle.217cd7ea697f608a04b7.js.map