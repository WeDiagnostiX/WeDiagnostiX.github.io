"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[658],{43658:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(43001),o=n(3827),s=n.n(o),a=n(47316);const i=0,l=5;const c=function({servicesManager:e,rtDisplaySet:t,viewportId:n,toolGroupId:r="default",preHydrateCallbacks:o,hydrateRTDisplaySet:s}){const{uiViewportDialogService:c}=e.services,u=e._extensionManager._appConfig;return new Promise((async function(p,d){const m=u?.disableConfirmationPrompts?l:await function(e,t){return new Promise((function(n,r){const o="Do you want to open this Segmentation?",s=[{id:"no-hydrate",type:a.LZ.dt.secondary,text:"No",value:i},{id:"yes-hydrate",type:a.LZ.dt.primary,text:"Yes",value:l}],c=t=>{e.hide(),n(t)};e.show({id:"promptHydrateRT",viewportId:t,type:"info",message:o,actions:s,onSubmit:c,onOutsideClick:()=>{e.hide(),n(i)},onKeyPress:e=>{"Enter"===e.key&&c(l)}})}))}(c,n);m===l&&(o?.forEach((e=>{e()})),window.setTimeout((async()=>{const o=await s({rtDisplaySet:t,viewportId:n,toolGroupId:r,servicesManager:e});p(o)}),0))}))};var u=n(69190);function p({isHydrated:e,onStatusClick:t}){let n=null,o=null;switch(e){case!0:o=()=>r.createElement(a.JO,{name:"status-alert"}),n=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:o=()=>r.createElement(a.JO,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>r.createElement("div",null,"Click LOAD to load RTSTRUCT.")}const s=()=>{const{t:n}=(0,u.$G)("Common"),s=n("LOAD");return r.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},r.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},r.createElement(o,null),r.createElement("span",{className:"ml-1"},"RTSTRUCT")),!e&&r.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},s))};return r.createElement(r.Fragment,null,n&&r.createElement(a.u,{content:r.createElement(n,null),position:"bottom-left"},r.createElement(s,null)),!n&&r.createElement(s,null))}const d=function(e,t,n){const{tools:r}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,r)};function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(null,arguments)}function S(e){const{children:t,displaySets:n,viewportOptions:o,servicesManager:s,extensionManager:i,commandsManager:l}=e,{displaySetService:u,toolGroupService:S,segmentationService:y,uiNotificationService:v,customizationService:g,viewportActionCornersService:w}=s.services,f=o.viewportId,E=`RTToolGroup-${f}`;if(n.length>1)throw new Error("RT viewport should only have a single display set");const I=n[0],[b,h]=(0,a.O_)(),[T,D]=(0,r.useState)(!1),[C,N]=(0,r.useState)(1),[k,O]=(0,r.useState)(I.isHydrated),[x,P]=(0,r.useState)(!I.isLoaded),[M,R]=(0,r.useState)(null),[A,G]=(0,r.useState)({percentComplete:null,totalSegments:null}),L=(0,r.useRef)(null),{viewports:U,activeViewportId:V}=b,_=I.getReferenceDisplaySet(),H=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(_);L.current={displaySet:_,metadata:H};const j=()=>{R(null)},F=(0,r.useCallback)((()=>{b?.viewports.forEach((({viewportId:e})=>{l.runCommand("storePresentation",{viewportId:e})}))}),[b]),q=({rtDisplaySet:e,viewportId:t})=>{l.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})},B=(0,r.useCallback)((()=>{const{component:t}=i.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=L.current;return r.createElement(t,m({},e,{displaySets:[n,I],viewportOptions:{viewportType:"stack",toolGroupId:E,orientation:o.orientation,viewportId:o.viewportId},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{R(e.detail.element)})(t)},onElementDisabled:j}))}),[f,I,E]),J=(0,r.useCallback)((e=>{const t=I.displaySetInstanceUID,n=y.getSegmentation(t),{segments:r}=n,o=Object.keys(r).length;let s=C+e;s>=o-1?s=1:0===s&&(s=o-1),y.jumpToSegmentCenter(t,s,E),N(s)}),[C]);(0,r.useEffect)((()=>{x||c({servicesManager:s,viewportId:f,rtDisplaySet:I,preHydrateCallbacks:[F],hydrateRTDisplaySet:q}).then((e=>{e&&O(!0)}))}),[s,f,I,x]),(0,r.useEffect)((()=>{const{unsubscribe:e}=y.subscribe(y.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.rtDisplaySet.displaySetInstanceUID===I.displaySetInstanceUID&&P(!1),e.overlappingSegments&&v.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[I]),(0,r.useEffect)((()=>{const{unsubscribe:e}=y.subscribe(y.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{G({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[I]),(0,r.useEffect)((()=>{const e=u.subscribe(u.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=U.get(V);e.includes(t.displaySetInstanceUID)&&h.setDisplaySetsForViewport({viewportId:V,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=S.getToolGroup(E);if(!e)return e=d(S,g,E),D(!0),()=>{y.removeSegmentationRepresentationFromToolGroup(E),S.destroyToolGroup(E)}}),[]),(0,r.useEffect)((()=>(O(I.isHydrated),()=>{y.removeSegmentationRepresentationFromToolGroup(E),L.current=null})),[I]);let Y=null;if(!L.current||_.displaySetInstanceUID!==L.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(Y=t.map(((e,t)=>e&&r.cloneElement(e,{viewportId:f,key:t}))));const Z=(0,r.useCallback)((async()=>{F();const e=await q({rtDisplaySet:I,viewportId:f});O(e)}),[q,I,F,f]);return(0,r.useEffect)((()=>{w.setComponents([{viewportId:f,id:"viewportStatusComponent",component:p({isHydrated:k,onStatusClick:Z}),indexPriority:-100,location:w.LOCATIONS.topLeft},{viewportId:f,id:"viewportActionArrowsComponent",component:r.createElement(a.PG,{key:"actionArrows",onArrowsClick:J,className:f===V?"visible":"invisible group-hover:visible"}),indexPriority:0,location:w.LOCATIONS.topRight}])}),[V,k,J,Z,w,f]),r.createElement(r.Fragment,null,r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},x&&r.createElement(a.bk,{className:"h-full w-full",totalNumbers:A.totalSegments,percentComplete:A.percentComplete,loadingText:"Loading RTSTRUCT..."}),B(),Y))}S.propTypes={displaySets:s().arrayOf(s().object),viewportId:s().string.isRequired,dataSource:s().object,children:s().node};const y=S}}]);
//# sourceMappingURL=658.bundle.2c0255129a5f83ddac9b.js.map