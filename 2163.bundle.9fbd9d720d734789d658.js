/*! For license information please see 2163.bundle.9fbd9d720d734789d658.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[2163,7513],{94372:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ae});const n=JSON.parse('{"u2":"@ohif/extension-tmtv"}').u2,o={viewportOptions:{viewportId:"ctAXIAL",viewportType:"volume",orientation:"axial",toolGroupId:"ctToolGroup",initialImageOptions:{preset:"first"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"ctDisplaySet"}]},r={viewportOptions:{viewportId:"ctSAGITTAL",viewportType:"volume",orientation:"sagittal",toolGroupId:"ctToolGroup",syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"ctDisplaySet"}]},i={viewportOptions:{viewportId:"ctCORONAL",viewportType:"volume",orientation:"coronal",toolGroupId:"ctToolGroup",syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0,options:{syncColormap:!0}}]},displaySets:[{id:"ctDisplaySet"}]},s={viewportOptions:{viewportId:"ptAXIAL",viewportType:"volume",background:[1,1,1],orientation:"axial",toolGroupId:"ptToolGroup",initialImageOptions:{preset:"first"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!0,target:!1,options:{syncColormap:!1}}]},displaySets:[{options:{voi:{custom:"getPTVOIRange"},voiInverted:!0},id:"ptDisplaySet"}]},c={viewportOptions:{viewportId:"ptSAGITTAL",viewportType:"volume",orientation:"sagittal",background:[1,1,1],toolGroupId:"ptToolGroup",syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!0,target:!1,options:{syncColormap:!1}}]},displaySets:[{options:{voi:{custom:"getPTVOIRange"},voiInverted:!0},id:"ptDisplaySet"}]},l={viewportOptions:{viewportId:"ptCORONAL",viewportType:"volume",orientation:"coronal",background:[1,1,1],toolGroupId:"ptToolGroup",syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!0,target:!1,options:{syncColormap:!1}}]},displaySets:[{options:{voi:{custom:"getPTVOIRange"},voiInverted:!0},id:"ptDisplaySet"}]},u={viewportOptions:{viewportId:"fusionAXIAL",viewportType:"volume",orientation:"axial",toolGroupId:"fusionToolGroup",initialImageOptions:{preset:"first"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncColormap:!1}}]},displaySets:[{id:"ctDisplaySet"},{id:"ptDisplaySet",options:{colormap:{name:"hsv",opacity:[{value:0,opacity:0},{value:.1,opacity:.9},{value:1,opacity:.95}]},voi:{custom:"getPTVOIRange"}}}]},p={viewportOptions:{viewportId:"fusionSAGITTAL",viewportType:"volume",orientation:"sagittal",toolGroupId:"fusionToolGroup",syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncColormap:!1}}]},displaySets:[{id:"ctDisplaySet"},{id:"ptDisplaySet",options:{colormap:{name:"hsv",opacity:[{value:0,opacity:0},{value:.1,opacity:.9},{value:1,opacity:.95}]},voi:{custom:"getPTVOIRange"}}}]},m={viewportOptions:{viewportId:"fusionCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:"fusionToolGroup",syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncColormap:!1}}]},displaySets:[{id:"ctDisplaySet"},{id:"ptDisplaySet",options:{colormap:{name:"hsv",opacity:[{value:0,opacity:0},{value:.1,opacity:.9},{value:1,opacity:.95}]},voi:{custom:"getPTVOIRange"}}}]},d={viewportOptions:{viewportId:"mipSagittal",viewportType:"volume",orientation:"sagittal",background:[1,1,1],toolGroupId:"mipToolGroup",syncGroups:[{type:"voi",id:"ptWLSync",source:!0,target:!0,options:{syncColormap:!0}},{type:"voi",id:"ptFusionWLSync",source:!0,target:!1,options:{syncColormap:!1}}],customViewportProps:{hideOverlays:!0}},displaySets:[{options:{blendMode:"MIP",slabThickness:"fullVolume",voi:{custom:"getPTVOIRange"},voiInverted:!0},id:"ptDisplaySet"}]},g={id:"@ohif/extension-tmtv.hangingProtocolModule.ptCT",locked:!0,name:"Default",createdDate:"2021-02-23T19:22:08.894Z",modifiedDate:"2022-10-04T19:22:08.894Z",availableTo:{},editableBy:{},imageLoadStrategy:"interleaveTopToBottom",protocolMatchingRules:[{attribute:"ModalitiesInStudy",constraint:{contains:["CT","PT"]}},{attribute:"StudyDescription",constraint:{contains:"PETCT"}},{attribute:"StudyDescription",constraint:{contains:"PET/CT"}}],displaySetSelectors:{ctDisplaySet:{seriesMatchingRules:[{attribute:"Modality",constraint:{equals:{value:"CT"}},required:!0},{attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"SeriesDescription",constraint:{contains:"CT"}},{attribute:"SeriesDescription",constraint:{contains:"CT WB"}}]},ptDisplaySet:{seriesMatchingRules:[{attribute:"Modality",constraint:{equals:"PT"},required:!0},{attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"SeriesDescription",constraint:{contains:"Corrected"}},{weight:2,attribute:"SeriesDescription",constraint:{doesNotContain:{value:"Uncorrected"}}}]}},stages:[{name:"default",viewportStructure:{layoutType:"grid",properties:{rows:3,columns:4,layoutOptions:[{x:0,y:0,width:1/4,height:1/3},{x:1/4,y:0,width:1/4,height:1/3},{x:.5,y:0,width:1/4,height:1/3},{x:0,y:1/3,width:1/4,height:1/3},{x:1/4,y:1/3,width:1/4,height:1/3},{x:.5,y:1/3,width:1/4,height:1/3},{x:0,y:2/3,width:1/4,height:1/3},{x:1/4,y:2/3,width:1/4,height:1/3},{x:.5,y:2/3,width:1/4,height:1/3},{x:3/4,y:0,width:1/4,height:1}]}},viewports:[o,r,i,s,c,l,u,p,m,d],createdDate:"2021-02-23T18:32:42.850Z"},{name:"Fusion 2x2",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[o,u,s,d]},{name:"2x3-layout",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3}},viewports:[o,r,i,s,c,l]},{name:"2x4-layout",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:4,layoutOptions:[{x:0,y:0,width:1/4,height:.5},{x:1/4,y:0,width:1/4,height:.5},{x:.5,y:0,width:1/4,height:.5},{x:3/4,y:0,width:1/4,height:1},{x:0,y:.5,width:1/4,height:.5},{x:1/4,y:.5,width:1/4,height:.5},{x:.5,y:.5,width:1/4,height:.5}]}},viewports:[l,c,s,d,m,p,u]}],numberOfPriorsReferenced:-1};const h=function(){return[{name:g.id,protocol:g}]};var f=a(43001),y=a(3827),v=a.n(y),S=a(47316),b=a(84793),T=a(69190);const I={PatientWeight:null,PatientSex:null,SeriesTime:null,RadiopharmaceuticalInformationSequence:{RadionuclideTotalDose:null,RadionuclideHalfLife:null,RadiopharmaceuticalStartTime:null}};function w({servicesManager:e,commandsManager:t}){const{t:a}=(0,T.$G)("PanelSUV"),{displaySetService:n,toolGroupService:o,toolbarService:r,hangingProtocolService:i}=e.services,[s,c]=(0,f.useState)(I),[l,u]=(0,f.useState)(null),p=e=>{c((t=>{const a={...t};return Object.keys(e).forEach((n=>{"object"==typeof e[n]?a[n]={...t[n],...e[n]}:a[n]=e[n]})),a}))},m=e=>{const a=t.runCommand("getMatchingPTDisplaySet",{viewportMatchDetails:e});if(!a)return;return{ptDisplaySet:a,metadata:t.runCommand("getPTMetadata",{ptDisplaySet:a})}};return(0,f.useEffect)((()=>{const e=n.getActiveDisplaySets(),{viewportMatchDetails:t}=i.getMatchDetails();if(!e.length)return;const a=m(t);if(!a)return;const{ptDisplaySet:o,metadata:r}=a;u(o),c(r)}),[]),(0,f.useEffect)((()=>{const{unsubscribe:e}=i.subscribe(i.EVENTS.PROTOCOL_CHANGED,(({viewportMatchDetails:e})=>{const t=m(e);if(!t)return;const{ptDisplaySet:a,metadata:n}=t;u(a),c(n)}));return()=>{e()}}),[]),f.createElement("div",{className:"ohif-scrollbar flex min-h-0 flex-auto select-none flex-col justify-between overflow-auto"},f.createElement("div",{className:"flex min-h-0 flex-1 flex-col bg-black text-[13px] font-[300]"},f.createElement(S.cw,{title:a("Patient Information")},f.createElement("div",{className:"flex flex-col"},f.createElement("div",{className:"bg-primary-dark flex flex-col gap-4 p-2"},f.createElement(S.II,{containerClassName:"!flex-row !justify-between items-center",label:a("Patient Sex"),labelClassName:"text-[13px] font-inter text-white",className:"!m-0 !h-[26px] !w-[117px]",value:s.PatientSex||"",onChange:e=>{p({PatientSex:e.target.value})}}),f.createElement(S.II,{containerClassName:"!flex-row !justify-between items-center",label:a("Weight"),labelChildren:f.createElement("span",{className:"text-aqua-pale"}," kg"),labelClassName:"text-[13px] font-inter text-white",className:"!m-0 !h-[26px] !w-[117px]",value:s.PatientWeight||"",onChange:e=>{p({PatientWeight:e.target.value})},id:"weight-input"}),f.createElement(S.II,{containerClassName:"!flex-row !justify-between items-center",label:a("Total Dose"),labelChildren:f.createElement("span",{className:"text-aqua-pale"}," bq"),labelClassName:"text-[13px] font-inter text-white",className:"!m-0 !h-[26px] !w-[117px]",value:s.RadiopharmaceuticalInformationSequence.RadionuclideTotalDose||"",onChange:e=>{p({RadiopharmaceuticalInformationSequence:{RadionuclideTotalDose:e.target.value}})}}),f.createElement(S.II,{containerClassName:"!flex-row !justify-between items-center",label:a("Half Life"),labelChildren:f.createElement("span",{className:"text-aqua-pale"}," s"),labelClassName:"text-[13px] font-inter text-white",className:"!m-0 !h-[26px] !w-[117px]",value:s.RadiopharmaceuticalInformationSequence.RadionuclideHalfLife||"",onChange:e=>{p({RadiopharmaceuticalInformationSequence:{RadionuclideHalfLife:e.target.value}})}}),f.createElement(S.II,{containerClassName:"!flex-row !justify-between items-center",label:a("Injection Time"),labelChildren:f.createElement("span",{className:"text-aqua-pale"}," s"),labelClassName:"text-[13px] font-inter text-white",className:"!m-0 !h-[26px] !w-[117px]",value:s.RadiopharmaceuticalInformationSequence.RadiopharmaceuticalStartTime||"",onChange:e=>{p({RadiopharmaceuticalInformationSequence:{RadiopharmaceuticalStartTime:e.target.value}})}}),f.createElement(S.II,{containerClassName:"!flex-row !justify-between items-center",label:a("Acquisition Time"),labelChildren:f.createElement("span",{className:"text-aqua-pale"}," s"),labelClassName:"text-[13px] font-inter text-white",className:"!m-0 !h-[26px] !w-[117px]",value:s.SeriesTime||"",onChange:()=>{}}),f.createElement(S.zx,{className:"!h-[26px] !w-[115px] self-end !p-0",onClick:function(){if(!l)throw new Error("No ptDisplaySet found");b.DicomMetadataStore.updateMetadataForSeries(l.StudyInstanceUID,l.SeriesInstanceUID,s),n.setDisplaySetMetadataInvalidated(l.displaySetInstanceUID),setTimeout((()=>{t.runCommand("resetCrosshairs")}),0)}},"Reload Data"))))))}w.propTypes={servicesManager:v().shape({services:v().shape({measurementService:v().shape({getMeasurements:v().func.isRequired,subscribe:v().func.isRequired,EVENTS:v().object.isRequired,VALUE_TYPES:v().object.isRequired}).isRequired}).isRequired}).isRequired};var x=a(62709),E=a(93725);function R({servicesManager:e,commandsManager:t}){const{segmentationService:a,uiNotificationService:n}=e.services,{t:o}=(0,T.$G)("PanelSUVExport"),[r,i]=(0,f.useState)((()=>a.getSegmentations())),[s,c]=(0,f.useState)(null);if((0,f.useEffect)((()=>{const e=a.EVENTS.SEGMENTATION_ADDED,t=a.EVENTS.SEGMENTATION_UPDATED,n=a.EVENTS.SEGMENTATION_REMOVED,o=[];return[e,t,n].forEach((e=>{const{unsubscribe:t}=a.subscribe(e,(()=>{const e=a.getSegmentations();i(e);const t=e.filter((e=>e.isActive));c(t[0])}));o.push(t)})),()=>{o.forEach((e=>{e()}))}}),[]),(0,f.useEffect)((()=>{const e=async e=>{const{detail:o}=e,{segmentationId:r}=o;if(!r)return;await(async({segmentationId:e,commandsManager:t,segmentationService:a,config:n={}})=>{const o=a.getSegmentation(e),r={};o.segments=await Promise.all(o.segments.map((async a=>{if(!a||!a.segmentIndex)return a;const n=x.cache.getVolume(e),o=a.segmentIndex,i=t.run("getLesionStats",{labelmap:n,segmentIndex:o}),s=await t.run("calculateSuvPeak",{labelmap:n,segmentIndex:o}),c={lesionStats:i,suvPeak:s,lesionGlyoclysisStats:i.volume*i.meanValue};return a.cachedStats=c,a.displayText=[`SUV Peak: ${s.suvPeak.toFixed(2)}`,`Volume: ${i.volume.toFixed(2)} mm3`],r[o]=c,a})));const i=a.getSegmentations(),s=t.run("calculateTMTV",{segmentations:i});o.cachedStats=Object.assign(o.cachedStats,r,{tmtv:{value:s.toFixed(3),config:{...n}}}),a.addOrUpdateSegmentation({...o},!1,!0)})({segmentationId:r,commandsManager:t,segmentationService:a});const i=a.getSegmentation(r),{cachedStats:s}=i;if(!s)return;const c=s?.[1]?.suvPeak?.suvPeak;Number.isNaN(c)&&n.show({title:"SUV Peak",message:"Segmented volume does not allow SUV Peak calculation",type:"warning"})};return x.eventTarget.addEventListenerDebounced(E.Enums.Events.SEGMENTATION_DATA_MODIFIED,e,250),()=>{x.eventTarget.removeEventListenerDebounced(E.Enums.Events.SEGMENTATION_DATA_MODIFIED,e)}}),[]),!s)return null;const l=s.cachedStats?.tmtv?.value||null,u=s.cachedStats?.tmtv?.config||{},p=[{label:"Export CSV",onClick:()=>{t.runCommand("exportTMTVReportCSV",{segmentations:r,tmtv:l,config:u})},disabled:null===l},{label:"Export RT Report",onClick:()=>{t.runCommand("createTMTVRTReport")},disabled:null===l}];return f.createElement(f.Fragment,null,f.createElement("div",{className:"mt-2 mb-10 flex flex-col"},f.createElement("div",{className:"invisible-scrollbar overflow-y-auto overflow-x-hidden"},null!==l?f.createElement("div",{className:"bg-secondary-dark flex items-baseline justify-between px-2 py-1"},f.createElement("span",{className:"text-base font-bold uppercase tracking-widest text-white"},"TMTV:"),f.createElement("div",{className:"text-white"},`${l} mL`)):null,f.createElement("div",{className:"mt-2 flex justify-center"},f.createElement(S.EY,{actions:p,t:o})))),f.createElement("div",{className:"absolute bottom-1 left-[50px] flex cursor-pointer items-center justify-center text-blue-400 opacity-50 hover:opacity-80",onClick:()=>{window.open("https://github.com/OHIF/Viewers/blob/master/modes/tmtv/README.md","_blank")}},f.createElement(S.JO,{width:"15px",height:"15px",name:"info",className:"text-primary-active ml-4 mr-3"}),f.createElement("span",null,"User Guide")))}R.propTypes={commandsManager:v().shape({runCommand:v().func.isRequired}),servicesManager:v().shape({services:v().shape({segmentationService:v().shape({getSegmentation:v().func.isRequired,getSegmentations:v().func.isRequired,toggleSegmentationVisibility:v().func.isRequired,subscribe:v().func.isRequired,EVENTS:v().object.isRequired}).isRequired}).isRequired}).isRequired};const D=R;const M=function({commandsManager:e,extensionManager:t,servicesManager:a}){return[{name:"petSUV",iconName:"tab-patient-info",iconLabel:"Patient Info",label:"Patient Info",component:()=>f.createElement(w,{commandsManager:e,servicesManager:a})},{name:"tmtvBox",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation Toolbox",component:()=>f.createElement(f.Fragment,null,f.createElement(S.vb,{commandsManager:e,servicesManager:a,extensionManager:t,buttonSectionId:"ROIThresholdToolbox",title:"Threshold Tools"}))},{name:"tmtvExport",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation Export",component:()=>f.createElement(f.Fragment,null,f.createElement(D,{commandsManager:e,servicesManager:a}))}]},N=["RectangleROIStartEndThreshold"];function C(e){if(e)return function(e){const t=x.metaData.get("instance",e);return{SOPInstanceUID:t.SOPInstanceUID,SeriesInstanceUID:t.SeriesInstanceUID,StudyInstanceUID:t.StudyInstanceUID,frameNumber:t.frameNumber||1}}(e)}const P={toAnnotation:(e,t)=>{},toMeasurement:(e,t,a)=>{const{annotation:n,viewportId:o}=e,{metadata:r,data:i,annotationUID:s}=n;if(!r||!i)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:c,referencedImageId:l,FrameOfReferenceUID:u}=r;if(!N.includes(c))throw new Error("Tool not supported");const{SOPInstanceUID:p,SeriesInstanceUID:m,StudyInstanceUID:d}=C(l);let g;return g=p?t.getDisplaySetForSOPInstanceUID(p,m):t.getDisplaySetsForSeries(m),{uid:s,SOPInstanceUID:p,FrameOfReferenceUID:u,metadata:r,referenceSeriesUID:m,referenceStudyUID:d,toolName:r.toolName,displaySetInstanceUID:g.displaySetInstanceUID,label:r.label,data:i.cachedStats,type:"RectangleROIStartEndThreshold"}}},O=(e,t,a)=>({RectangleROIStartEndThreshold:{toAnnotation:P.toAnnotation,toMeasurement:e=>P.toMeasurement(e,t,a),matchingCriteria:[{valueType:e.VALUE_TYPES.ROI_THRESHOLD_MANUAL}]}});var L=a(72076);function V(e,t){const{imageData:a}=e,n=a.getPointData().getScalars().getData(),{fn:o,baseValue:r}=function(){const e=-1/0,t=(e,t)=>(e>t&&(t=e),t);return{fn:t,baseValue:e}}();let i=r;const s=E.utilities.rectangleROITool.getBoundsIJKFromRectangleAnnotations(t,e),[[c,l],[u,p],[m,d]]=s;for(let e=c;e<=l;e++)for(let t=u;t<=p;t++)for(let r=m;r<=d;r++){i=o(n[a.computeOffsetIndex([e,t,r])],i)}return i}const A=function(e,t,a){if("range"===a.strategy)return{ptLower:Number(a.ptLower),ptUpper:Number(a.ptUpper),ctLower:Number(a.ctLower),ctUpper:Number(a.ctUpper)};const{weight:n}=a,o=e.map((e=>E.annotation.state.getAnnotation(e)));return{ctLower:-1/0,ctUpper:1/0,ptLower:n*V(t[0],o),ptUpper:1/0}};const U=function(e,t=1){const a=E.utilities.segmentation.createMergedLabelmapForIndex(e,t,"mergedLabelmap"),{imageData:n,spacing:o}=a;return.001*n.getPointData().getScalars().getData().reduce(((e,t)=>t>0?e+1:e),0)*o[0]*o[1]*o[2]};var j=a(67540),F=a(91202);const{datasetToBlob:k}=j.default.data,G=b.classes.MetadataProvider;const q=function(e){const t=F.adaptersRT.Cornerstone3D.RTSS.generateRTSSFromAnnotations(e,G,b.DicomMetadataStore),a=k(t);var n=URL.createObjectURL(a);window.location.assign(n)},_=b.classes.MetadataProvider,W=["RectangleROIStartEndThreshold","RectangleROIThreshold"],B=E.Enums.SegmentationRepresentations.Labelmap,$=(0,x.getWebWorkerManager)(),H={maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:3e3}},z=()=>new Worker(new URL(a.p+a.u(7607),a.b),{name:"suv-peak-worker"}),J=({servicesManager:e,commandsManager:t,extensionManager:a})=>{const{viewportGridService:n,uiNotificationService:o,displaySetService:r,hangingProtocolService:i,toolGroupService:s,cornerstoneViewportService:c,segmentationService:l}=e.services,u=a.getModuleEntry("@ohif/extension-cornerstone.utilityModule.common"),{getEnabledElement:p}=u.exports;function m(){const{activeViewportId:e}=n.getState(),{element:t}=p(e)||{};return x.getEnabledElement(t)}function d(){const{viewportMatchDetails:e}=i.getMatchDetails(),t=[];return e.forEach((e=>{const{viewportOptions:a}=e,{toolGroupId:n}=a;-1===t.indexOf(n)&&t.push(n)})),t}function g(e){return e.reduce(((e,t)=>{const a=E.annotation.selection.getAnnotationsSelectedByToolName(t);return e.concat(a)}),[])}const h={getMatchingPTDisplaySet:({viewportMatchDetails:e})=>{let t=null;for(const[a,n]of e){const{displaySetsInfo:e}=n,a=e.map((({displaySetInstanceUID:e})=>r.getDisplaySetByUID(e)));if(a&&0!==a.length&&(t=a.find((e=>"PT"===e.Modality)),t))break}return t},getPTMetadata:({ptDisplaySet:e})=>{const t=a.getDataSources()[0].getImageIdsForDisplaySet(e)[0],n=_.get("instance",t);if("PT"!==n.Modality)return;return{SeriesTime:n.SeriesTime,Modality:n.Modality,PatientSex:n.PatientSex,PatientWeight:n.PatientWeight,RadiopharmaceuticalInformationSequence:{RadionuclideTotalDose:n.RadiopharmaceuticalInformationSequence[0].RadionuclideTotalDose,RadionuclideHalfLife:n.RadiopharmaceuticalInformationSequence[0].RadionuclideHalfLife,RadiopharmaceuticalStartTime:n.RadiopharmaceuticalInformationSequence[0].RadiopharmaceuticalStartTime,RadiopharmaceuticalStartDateTime:n.RadiopharmaceuticalInformationSequence[0].RadiopharmaceuticalStartDateTime}}},createNewLabelmapFromPT:async({label:e})=>{const{viewportMatchDetails:t}=i.getMatchDetails(),a=h.getMatchingPTDisplaySet({viewportMatchDetails:t});if(!a)return void o.error("No matching PT display set found");const n=l.getSegmentations(),r=await l.createSegmentationForDisplaySet(a.displaySetInstanceUID,{label:`Segmentation ${n.length+1}`}),s=d(),c=B;for(const e of s){const t=!0;await l.addSegmentationRepresentationToToolGroup(e,r,t,c),l.setActiveSegmentationForToolGroup(r,e)}return l.addSegment(r,{segmentIndex:1,properties:{label:"Segment 1"}}),r},setSegmentationActiveForToolGroups:({segmentationId:e})=>{d().forEach((t=>{l.setActiveSegmentationForToolGroup(e,t)}))},thresholdSegmentationByRectangleROITool:({segmentationId:e,config:t,segmentIndex:a})=>{const r=E.segmentation.state.getSegmentation(e),{representationData:s}=r,{displaySetMatchDetails:c}=i.getMatchDetails(),l=`cornerstoneStreamingImageVolume:${c.get("ctDisplaySet").displaySetInstanceUID}`,{volumeId:u}=s[B],{referencedVolumeId:p}=x.cache.getVolume(u),m=g(W);if(0===m.length)return void o.show({title:"Commands Module",message:"No ROIThreshold Tool is Selected",type:"error"});const d=x.cache.getVolume(e);let h=x.cache.getVolume(p);const f=x.cache.getVolume(l);if(!h)throw new Error("No Reference volume found");if(!d)throw new Error("No Reference labelmap found");const y=E.annotation.state.getAnnotation(m[0]),{metadata:{enabledElement:{viewport:v}}}=y;if(!v.hasVolumeId(p)){n.getDisplaySetsUIDsForViewport(v.id).forEach((e=>{const t=x.cache.getVolumes().find((t=>t.volumeId.includes(e)));x.utilities.isEqual(t.dimensions,d.dimensions)&&x.utilities.isEqual(t.spacing,d.spacing)&&(h=t)}))}const{ptLower:S,ptUpper:b,ctLower:T,ctUpper:I}=A(m,[h,f],t);return E.utilities.segmentation.rectangleROIThresholdVolumeByRange(m,d,[{volume:h,lower:S,upper:b},{volume:f,lower:T,upper:I}],{overwrite:!0,segmentIndex:a})},calculateSuvPeak:async({labelmap:e,segmentIndex:t})=>{$.registerWorker("suv-peak-worker",z,H);const{referencedVolumeId:a}=e,n=x.cache.getVolume(a),o=g(W).map((e=>E.annotation.state.getAnnotation(e))),r={dimensions:e.dimensions,origin:e.origin,direction:e.direction,spacing:e.spacing,scalarData:e.scalarData,metadata:e.metadata},i={dimensions:n.dimensions,origin:n.origin,direction:n.direction,spacing:n.spacing,scalarData:n.scalarData,metadata:n.metadata},s=o.map((e=>({...e,metadata:{...e.metadata,enabledElement:{...e.metadata.enabledElement,viewport:null,renderingEngine:null,element:null}}}))),c=await $.executeTask("suv-peak-worker","calculateSuvPeak",{labelmapProps:r,referenceVolumeProps:i,annotations:s,segmentIndex:t});return{suvPeak:c.mean,suvMax:c.max,suvMaxIJK:c.maxIJK,suvMaxLPS:c.maxLPS}},getLesionStats:({labelmap:e,segmentIndex:t=1})=>{const{scalarData:a,spacing:n}=e,o=x.cache.getVolume(e.referencedVolumeId).getScalarData();let r=-1/0,i=1/0;const s=[];let c=0;for(let e=0;e<a.length;e++)if(a[e]===t){const t=o[e];s.push(t),t>r&&(r=t),t<i&&(i=t),c++}const l=s.reduce(((e,t)=>e+t),0)/c;return{minValue:i,maxValue:r,meanValue:l,stdValue:Math.sqrt(s.map((e=>(e-l)**2)).reduce(((e,t)=>e+t),0)/c),volume:c*n[0]*n[1]*n[2]*.001}},calculateLesionGlycolysis:({lesionStats:e})=>{const{meanValue:t,volume:a}=e;return{lesionGlyoclysisStats:a*t}},calculateTMTV:({segmentations:e})=>{const t=e.map((e=>l.getLabelmapVolume(e.id)));if(t.length)return U(t)},exportTMTVReportCSV:({segmentations:e,tmtv:a,config:n,options:o})=>{const r=t.runCommand("getSegmentationCSVReport",{segmentations:e}),i=[{key:"Total Lesion Glycolysis",value:{tlg:h.getTotalLesionGlycolysis({segmentations:e}).toFixed(4)}},{key:"Threshold Configuration",value:{...n}}];void 0!==a&&i.unshift({key:"Total Metabolic Tumor Volume",value:{tmtv:a}}),function(e,t,a={}){const n=e[Object.keys(e)[0]],o=Object.keys(n),r=[o.join(",")];Object.values(e).forEach((e=>{const t=[];o.forEach((a=>{t.push(Array.isArray(e[a])?e[a].join(" "):e[a])})),r.push(t.join(","))})),r.push(""),r.push(""),r.push(""),r.push(`Patient ID,${n.PatientID}`),r.push(`Study Date,${n.StudyDate}`),r.push(""),t.forEach((({key:e,value:t})=>{const a=[];a.push(`${e}`),Object.keys(t).forEach((e=>{a.push(`${e}`),a.push(`${t[e]}`)})),r.push(a.join(","))}));const i=new Blob([r.join("\n")],{type:"text/csv;charset=utf-8"}),s=URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download=a.filename??`${n.PatientID}_tmtv.csv`,c.click()}(r,i,o)},getTotalLesionGlycolysis:({segmentations:e})=>{const t=e.map((e=>l.getLabelmapVolume(e.id)));let a;try{a=E.utilities.segmentation.createMergedLabelmapForIndex(t)}catch(e){return void console.error("commandsModule::getTotalLesionGlycolysis",e)}const{referencedVolumeId:n,spacing:o}=t[0];n||console.error("commandsModule::getTotalLesionGlycolysis:No referencedVolumeId found");const r=x.cache.getVolume(n),i=a.getScalarData();i.length!==r.getScalarData().length&&console.error("commandsModule::getTotalLesionGlycolysis:Labelmap and ptVolume are not the same size");let s=0,c=0;for(let e=0;e<i.length;e++)0!==i[e]&&(s+=r.getScalarData()[e],c+=1);return s/c*c*o[0]*o[1]*o[2]*.001},setStartSliceForROIThresholdTool:()=>{const{viewport:e}=m(),{focalPoint:t,viewPlaneNormal:a}=e.getCamera(),n=g(W)[0],o=E.annotation.state.getAnnotation(n),{handles:r}=o.data,{points:i}=r,s=e.getCurrentImageIdIndex();o.data.startSlice=s;const c=i.map((e=>{const n=L.R3.create();L.R3.subtract(n,t,e);const o=L.R3.dot(n,a),r=L.R3.create();return L.R3.scaleAndAdd(r,e,a,o),r}));r.points=c,o.invalidated=!0,e.render()},setEndSliceForROIThresholdTool:()=>{const{viewport:e}=m(),t=g(W)[0],a=E.annotation.state.getAnnotation(t),n=e.getCurrentImageIdIndex();a.data.endSlice=n,a.invalidated=!0,e.render()},createTMTVRTReport:()=>{const e=E.annotation.state.getAnnotationManager(),a=[];Object.keys(e.annotations).forEach((t=>{const n=e.annotations[t],o=W.reduce(((e,t)=>[...e,...n[t]??[]]),[]);a.push(...o)})),t.runCommand("exportRTReportForAnnotations",{annotations:a})},getSegmentationCSVReport:({segmentations:e})=>{e&&e.length||(e=l.getSegmentations());const t={};for(const a of e){const{id:e,label:n,cachedStats:o}=a,r={id:e,label:n};if(!o){t[e]=r;continue}Object.keys(o).forEach((e=>{"object"!=typeof o[e]?r[e]=o[e]:Object.keys(o[e]).forEach((t=>{r[`${e}_${t}`]=o[e][t]}))}));const i=l.getLabelmapVolume(e);if(!i){t[e]=r;continue}const s=i.referencedVolumeId;r.referencedVolumeId=s;const c=l.getLabelmapVolume(s);if(!c){t[e]=r;continue}if(!c.imageIds||!c.imageIds.length){t[e]=r;continue}const u=c.imageIds[0],p=b.default.classes.MetadataProvider.get("instance",u);p?t[e]={...r,PatientID:p.PatientID??"000000",PatientName:p.PatientName.Alphabetic,StudyInstanceUID:p.StudyInstanceUID,SeriesInstanceUID:p.SeriesInstanceUID,StudyDate:p.StudyDate}:t[e]=r}return t},exportRTReportForAnnotations:({annotations:e})=>{q(e)},setFusionPTColormap:({toolGroupId:e,colormap:a})=>{const n=s.getToolGroup(e),{viewportMatchDetails:o}=i.getMatchDetails(),r=h.getMatchingPTDisplaySet({viewportMatchDetails:o});if(!r)return;const l=n.getViewportIds(),u=[];l.forEach((e=>{t.runCommand("setViewportColormap",{viewportId:e,displaySetInstanceUID:r.displaySetInstanceUID,colormap:{name:a}}),u.push(c.getCornerstoneViewport(e))})),u.forEach((e=>{e.render()}))}},f={setEndSliceForROIThresholdTool:{commandFn:h.setEndSliceForROIThresholdTool},setStartSliceForROIThresholdTool:{commandFn:h.setStartSliceForROIThresholdTool},getMatchingPTDisplaySet:{commandFn:h.getMatchingPTDisplaySet},getPTMetadata:{commandFn:h.getPTMetadata},createNewLabelmapFromPT:{commandFn:h.createNewLabelmapFromPT},setSegmentationActiveForToolGroups:{commandFn:h.setSegmentationActiveForToolGroups},thresholdSegmentationByRectangleROITool:{commandFn:h.thresholdSegmentationByRectangleROITool},getTotalLesionGlycolysis:{commandFn:h.getTotalLesionGlycolysis},calculateSuvPeak:{commandFn:h.calculateSuvPeak},getLesionStats:{commandFn:h.getLesionStats},calculateTMTV:{commandFn:h.calculateTMTV},exportTMTVReportCSV:{commandFn:h.exportTMTVReportCSV},createTMTVRTReport:{commandFn:h.createTMTVRTReport},getSegmentationCSVReport:{commandFn:h.getSegmentationCSVReport},exportRTReportForAnnotations:{commandFn:h.exportRTReportForAnnotations},setFusionPTColormap:{commandFn:h.setFusionPTColormap}};return{actions:h,definitions:f,defaultContext:"TMTV:CORNERSTONE"}},K="roi_stat",X=[{value:K,label:"Max",placeHolder:"Max"},{value:"range",label:"Range",placeHolder:"Range"}];const Y=function({config:e,dispatch:t,runCommand:a}){const{t:n}=(0,T.$G)("ROIThresholdConfiguration");return f.createElement("div",{className:"bg-primary-dark flex flex-col space-y-4"},f.createElement("div",{className:"flex items-end space-x-2"},f.createElement("div",{className:"flex w-1/2 flex-col"},f.createElement(S.Ph,{label:n("Strategy"),closeMenuOnSelect:!0,className:"border-primary-main mr-2 bg-black text-white ",options:X,placeholder:X.find((t=>t.value===e.strategy)).placeHolder,value:e.strategy,onChange:({value:e})=>{t({type:"setStrategy",payload:{strategy:e}})}})),f.createElement("div",{className:"w-1/2"},f.createElement(S.HO,null,f.createElement(S.mN,{size:"initial",className:"px-2 py-2 text-base text-white",color:"primaryLight",variant:"outlined",onClick:()=>a("setStartSliceForROIThresholdTool")},n("Start")),f.createElement(S.mN,{size:"initial",color:"primaryLight",variant:"outlined",className:"px-2 py-2 text-base text-white",onClick:()=>a("setEndSliceForROIThresholdTool")},n("End"))))),e.strategy===K&&f.createElement(S.II,{label:n("Percentage of Max SUV"),labelClassName:"text-[13px] font-inter text-white",className:"border-primary-main bg-black",type:"text",containerClassName:"mr-2",value:e.weight,onChange:e=>{t({type:"setWeight",payload:{weight:e.target.value}})}}),e.strategy!==K&&f.createElement("div",{className:"mr-2 text-sm"},f.createElement("table",null,f.createElement("tbody",null,f.createElement("tr",{className:"mt-2"},f.createElement("td",{className:"pr-4",colSpan:"3"},f.createElement(S.__,{className:"font-inter text-[13px] text-white",text:"Lower & Upper Ranges"}))),f.createElement("tr",{className:"mt-2"},f.createElement("td",{className:"pr-4 pt-2 text-center"},f.createElement(S.__,{className:"text-white",text:"CT"})),f.createElement("td",null,f.createElement("div",{className:"flex justify-between"},f.createElement(S.II,{label:n(""),labelClassName:"text-white",className:"border-primary-main mt-2 bg-black",type:"text",containerClassName:"mr-2",value:e.ctLower,onChange:e=>{t({type:"setThreshold",payload:{ctLower:e.target.value}})}}),f.createElement(S.II,{label:n(""),labelClassName:"text-white",className:"border-primary-main mt-2 bg-black",type:"text",containerClassName:"mr-2",value:e.ctUpper,onChange:e=>{t({type:"setThreshold",payload:{ctUpper:e.target.value}})}})))),f.createElement("tr",null,f.createElement("td",{className:"pr-4 pt-2 text-center"},f.createElement(S.__,{className:"text-white",text:"PT"})),f.createElement("td",null,f.createElement("div",{className:"flex justify-between"},f.createElement(S.II,{label:n(""),labelClassName:"text-white",className:"border-primary-main mt-2 bg-black",type:"text",containerClassName:"mr-2",value:e.ptLower,onChange:e=>{t({type:"setThreshold",payload:{ptLower:e.target.value}})}}),f.createElement(S.II,{label:n(""),labelClassName:"text-white",className:"border-primary-main mt-2 bg-black",type:"text",containerClassName:"mr-2",value:e.ptUpper,onChange:e=>{t({type:"setThreshold",payload:{ptUpper:e.target.value}})}}))))))))},Z=K;function Q(e,t){const{payload:a}=t,{strategy:n,ctLower:o,ctUpper:r,ptLower:i,ptUpper:s,weight:c}=a;switch(t.type){case"setStrategy":return{...e,strategy:n};case"setThreshold":return{...e,ctLower:o||e.ctLower,ctUpper:r||e.ctUpper,ptLower:i||e.ptLower,ptUpper:s||e.ptUpper};case"setWeight":return{...e,weight:c};default:return e}}const ee=function({servicesManager:e,commandsManager:t}){const{segmentationService:a}=e.services,[n,o]=(0,f.useState)(null),r=(0,f.useCallback)(((e,a={})=>t.runCommand(e,a)),[t]),[i,s]=(0,f.useReducer)(Q,{strategy:Z,ctLower:-1024,ctUpper:1024,ptLower:2.5,ptUpper:100,weight:.41}),c=(0,f.useCallback)((()=>{const e=n,t=E.segmentation.segmentIndex.getActiveSegmentIndex(e);r("thresholdSegmentationByRectangleROITool",{segmentationId:e,config:i,segmentIndex:t})}),[n,i]);return(0,f.useEffect)((()=>{const e=a.getSegmentations();if(!e.length)return;const t=e.find((e=>e.isActive));o(t.id)}),[]),(0,f.useEffect)((()=>{const e=a.EVENTS.SEGMENTATION_ADDED,t=a.EVENTS.SEGMENTATION_UPDATED,n=[];return[e,t].forEach((e=>{const{unsubscribe:t}=a.subscribe(e,(()=>{const e=a.getSegmentations();if(!e.length)return;const t=e.find((e=>e.isActive));o(t.id)}));n.push(t)})),()=>{n.forEach((e=>{e()}))}}),[]),f.createElement("div",{className:"invisible-scrollbar mb-2 flex flex-col overflow-y-auto overflow-x-hidden"},f.createElement(Y,{config:i,dispatch:s,runCommand:r}),null!==n&&f.createElement(S.zx,{className:"mt-2 !h-[26px] !w-[75px]",onClick:c},"Run"))};const te={id:n,preRegistration({servicesManager:e,commandsManager:t,extensionManager:a,configuration:n={}}){!function({servicesManager:e}){const{measurementService:t,displaySetService:a,cornerstoneViewportService:n}=e.services;(0,E.addTool)(E.RectangleROIStartEndThresholdTool);const{RectangleROIStartEndThreshold:o}=O(t,a,n),r=t.getSource("Cornerstone3DTools","0.1");t.addMapping(r,"RectangleROIStartEndThreshold",o.matchingCriteria,o.toAnnotation,o.toMeasurement)}({servicesManager:e,commandsManager:t,extensionManager:a,configuration:n})},getToolbarModule:function({commandsManager:e,servicesManager:t}){return[{name:"tmtv.RectangleROIThresholdOptions",defaultComponent:()=>ee({commandsManager:e,servicesManager:t})}]},getPanelModule:M,getHangingProtocolModule:h,getCommandsModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>J({servicesManager:e,commandsManager:t,extensionManager:a})},ae=te},27318:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),a=0;a<e;++a)t[a]=a;return t}},8516:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},87513:(e,t,a)=>{var n=a(27318),o=a(8516),r="undefined"!=typeof Float64Array;function i(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,a=new Array(t.length);for(e=0;e<a.length;++e)a[e]=[Math.abs(t[e]),e];a.sort(i);var n=new Array(a.length);for(e=0;e<n.length;++e)n[e]=a[e][1];return n}function c(e,t){var a=["View",t,"d",e].join("");t<0&&(a="View_Nil"+e);var o="generic"===e;if(-1===t){var r="function "+a+"(a){this.data=a;};var proto="+a+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+a+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+a+"(a){return new "+a+"(a);}";return new Function(r)()}if(0===t){r="function "+a+"(a,d) {this.data = a;this.offset = d};var proto="+a+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+a+"_copy() {return new "+a+"(this.data,this.offset)};proto.pick=function "+a+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+a+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+a+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+a+"(a,b,c,d){return new "+a+"(a,d)}";return new Function("TrivialArray",r)(l[e][0])}r=["'use strict'"];var i=n(t),c=i.map((function(e){return"i"+e})),u="this.offset+"+i.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),p=i.map((function(e){return"b"+e})).join(","),m=i.map((function(e){return"c"+e})).join(",");r.push("function "+a+"(a,"+p+","+m+",d){this.data=a","this.shape=["+p+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+a+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),r.push("Object.defineProperty(proto,'size',{get:function "+a+"_size(){return "+i.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),t<4?(r.push("function "+a+"_order(){"),2===t?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+a+"_set("+c.join(",")+",v){"),o?r.push("return this.data.set("+u+",v)}"):r.push("return this.data["+u+"]=v}"),r.push("proto.get=function "+a+"_get("+c.join(",")+"){"),o?r.push("return this.data.get("+u+")}"):r.push("return this.data["+u+"]}"),r.push("proto.index=function "+a+"_index(",c.join(),"){return "+u+"}"),r.push("proto.hi=function "+a+"_hi("+c.join(",")+"){return new "+a+"(this.data,"+i.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+i.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=i.map((function(e){return"a"+e+"=this.shape["+e+"]"})),g=i.map((function(e){return"c"+e+"=this.stride["+e+"]"}));r.push("proto.lo=function "+a+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+g.join(","));for(var h=0;h<t;++h)r.push("if(typeof i"+h+"==='number'&&i"+h+">=0){d=i"+h+"|0;b+=c"+h+"*d;a"+h+"-=d}");r.push("return new "+a+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"c"+e})).join(",")+",b)}"),r.push("proto.step=function "+a+"_step("+c.join(",")+"){var "+i.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+i.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(h=0;h<t;++h)r.push("if(typeof i"+h+"==='number'){d=i"+h+"|0;if(d<0){c+=b"+h+"*(a"+h+"-1);a"+h+"=ceil(-a"+h+"/d)}else{a"+h+"=ceil(a"+h+"/d)}b"+h+"*=d}");r.push("return new "+a+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"b"+e})).join(",")+",c)}");var f=new Array(t),y=new Array(t);for(h=0;h<t;++h)f[h]="a[i"+h+"]",y[h]="b[i"+h+"]";r.push("proto.transpose=function "+a+"_transpose("+c+"){"+c.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+a+"(this.data,"+f.join(",")+","+y.join(",")+",this.offset)}"),r.push("proto.pick=function "+a+"_pick("+c+"){var a=[],b=[],c=this.offset");for(h=0;h<t;++h)r.push("if(typeof i"+h+"==='number'&&i"+h+">=0){c=(c+this.stride["+h+"]*i"+h+")|0}else{a.push(this.shape["+h+"]);b.push(this.stride["+h+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+a+"(data,shape,stride,offset){return new "+a+"(data,"+i.map((function(e){return"shape["+e+"]"})).join(",")+","+i.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(l[e],s)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,a,n){if(void 0===e)return(0,l.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===a){a=new Array(i);for(var s=i-1,u=1;s>=0;--s)a[s]=u,u*=t[s]}if(void 0===n){n=0;for(s=0;s<i;++s)a[s]<0&&(n-=(t[s]-1)*a[s])}for(var p=function(e){if(o(e))return"buffer";if(r)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),m=l[p];m.length<=i+1;)m.push(c(p,m.length-1));return(0,m[i+1])(e,t,a,n)}}}]);
//# sourceMappingURL=2163.bundle.9fbd9d720d734789d658.js.map